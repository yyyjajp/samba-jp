<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE refentry PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<refentry id="vfs_fileid.8" lang="ja">

<refmeta>
	<refentrytitle>vfs_fileid</refentrytitle>
	<manvolnum>8</manvolnum>
	<refmiscinfo class="source">Samba</refmiscinfo>
	<refmiscinfo class="manual">システム管理ツール</refmiscinfo>
	<refmiscinfo class="version">&doc.version;</refmiscinfo>
</refmeta>


<refnamediv>
	<refname>vfs_fileid</refname>
	<refpurpose>クラスター構成時で使えるように、
	ユニークなデバイス ID 値で file_id 構造体を生成する
	</refpurpose>
</refnamediv>

<refsynopsisdiv>
	<cmdsynopsis>
		<command>vfs objects = fileid</command>
	</cmdsynopsis>
</refsynopsisdiv>

<refsect1>
	<title>説明</title>

	<para>この VFS モジュールは
	<citerefentry><refentrytitle>samba</refentrytitle>
	<manvolnum>7</manvolnum></citerefentry>
	システムの一部である。</para>

	<para>
    ファイルロックの際、Samba は file_id 構造体を使ってファイルを一意に
    特定する。デフォルトでは、file_id には <command>stat()</command>
    システムコールで返されたデバイスおよび inode 番号が格納されている。
    file_id はファイルの一意な識別子であるため、これはある特定のクラスター
    構成のの中では、すべてのノードで同じ値である必要がある。
    このモジュールは <command>SMB_VFS_FILE_ID_CREATE()</command> の動作を
    オーバーライドし、設定されたアルゴリズム（ "fileid:algorithm"
    オプションを参照のこと）に従ってデバイス番号を生成する。
	</para>
<!--	Samba 4.8.0
        <para>When using the fsname or fsid algorithm a
        <command>stat()</command> and <command>statfs()</command> call is
        required for all mounted file systems to generate the file_id. If e.g.
        an NFS file system is unresponsive such a call might block and the smbd
        process will become unresponsive. Use the "fileid:fstype deny",
        "fileid:fstype allow", "fileid:mntdir deny", or "fileid:mntdir allow"
        options to ignore potentially unresponsive file systems.
        </para>
-->
        <para>fsname 又は fsid アルゴリズムを使う場合、file_id を生成するために、
	すべてのマウントされたファイルシステムにおいて、
        <command>stat()</command> と <command>statfs() </command>呼び出しが必要である。
	たとえば、NFS ファイルシステムが応答しなくなると、そのような呼び出しは
	ブロックされ、smbd プロセスが応答しなくなる。
	"fileid:fstype deny"、"fileid:fstype allow"、"fileid:mntdir deny"、
	または "fileid:mntdir allow" オプションを使うことで、潜在的に応答しない
	ファイルシステムを無視する。
        </para>
</refsect1>


<refsect1>
	<title>オプション</title>

	<variablelist>

		<varlistentry>
		<term>fileid:algorithm = ALGORITHM</term>
		<listitem>
		<para>
		指定できるアルゴリズムは<command>fsname</command>、
		<command>fsname_nodirs</command>、<command>fsid</command>と
		<command>hostname</command>である。デフォルト値は
		<command>fsname</command>である。
		</para>
		<para><command>fsname</command> アルゴリズムでは、
		デバイス ID を カーネルのデバイス名から生成する。
		</para>
<!-- Samba 4.8.0
                <para>The <command>fsname_nodirs</command> algorithm generates
                device id by hashing the kernel device name for files and by hashing
                the hostname for directories. This can be used to deliberately
                break lock coherency for directories in a cluster.
                </para>
-->		
                <para><command>fsname_nodirs</command> アルゴリズムは、ファイルの
		カーネルのデバイス名をハッシュし、ディレクトリのホスト名を
		ハッシュすることで、デバイス ID を生成する。これは、意図的に、
		クラスタ中のディレクトリの一貫性を破るために使用できる。
                </para>
		<para><command>fsid</command> アルゴリズムは、デバイス ID を
		<command>statfs()</command>システムコールで返された
		<command>f_fsid</command>から生成する。
<!-- Samba 4.8.0
                <para>The <command>hostname</command> algorithm generates device
                id by hashing the hostname. This can be used to deliberately
                break lock coherency in a cluster.
                </para>
                <para>The <command>fsname_norootdir</command> algorithm
                generates device ids by hashing the kernel device name, except
                for the root directory of shares where it will use the hostname
                algorithm. This can be used to deliberately break lock coherency
                in a cluster for the root directory of a share.
		</para>
-->
<!-- Samba-4.12.0
                <para>The <command>fsname_norootdir_ext</command> algorithm
                generates device ids by hashing the kernel device name, except
                for the root directory of shares where it will use the hostname
                algorithm. Additionally it generates an extid based on the
                process pid. This can be used to deliberately break lock
                coherency between all smbd processes in the whole cluster for
                the root directory of a share.
                </para>
-->
                <para><command>hostname</command> アルゴリズムは、
		ホスト名をハッシュしてデバイス IDを生成する。これは、
		クラスタ中のロックの一貫性を破るために使用できる。
                </para>
                <para><command>fsname_norootdir</command> アルゴリズムは、
		hostname アルゴリズムで使われる、共有のルートディレクトリを除き、
		カーネルデバイス名をハッシュして、デバイス IDを生成する。
		これは、共有のルートディレクトリのクラスタ中の、ロックの
		一貫性を破るのに使われる。
		</para>
                <para><command>fsname_norootdir_ext</command>アルゴリズムは
		カーネルデバイス名をハッシュすることにより、デバイス id を生成するが、
		ホスト名アルゴリズムを使う共有のルートディレクトリでは行わない。
		さらに、プロセスの pid をベースにした extid も生成する。
		これは、共有のルートディレクトリ用の、クラスタ全体中で、すべての
		smbd プロセス間でのロックの一貫性を意図的に解除することができる。
                </para>
		</para>
		</listitem>
		</varlistentry>

		<varlistentry>
		<term>fileid:mapping = ALGORITHM</term>
		<listitem>
        <para>このオプションは<command>fileid:algorithm</command>オプションの
        レガシーな（古い）バージョンである。これは Samba 3.0 のカスタム
        バージョンにおいて、フィールドマッピング機能に関する以前のバージョンで
        使われていた。
		</para>
		</listitem>
		</varlistentry>
<!-- Samba-4.8.0
                <varlistentry>
                <term>fileid:fstype deny = LIST</term>
                <listitem>
                <para>List of file system types to be ignored for file_id
                generation.
                </para>
                </listitem>
                </varlistentry>

                <varlistentry>
                <term>fileid:fstype allow = LIST</term>
                <listitem>
                <para>List of file system types to be allowed for file_id
                generation. If this option is set, file system types not listed
                here are ignored.
                </para>
                </listitem>
                </varlistentry>
-->
                <varlistentry>
                <term>fileid:fstype deny = LIST</term>
                <listitem>
                <para>file_id 生成時に無視されるファイルシステムタイプの一覧。
                </para>
                </listitem>
                </varlistentry>

                <varlistentry>
                <term>fileid:fstype allow = LIST</term>
                <listitem>
                <para>file_id 生成時に有効となるファイルシステムタイプの一覧。
		このオプションが設定された場合、ここで指定されたファイルシステムタイプ
		以外は無視される。
                </para>
                </listitem>
                </varlistentry>

<!-- Samba-4.8.0
                <varlistentry>
                <term>fileid:mntdir deny = LIST</term>
                <listitem>
                <para>List of file system mount points to be ignored for
                file_id generation.
                </para>
                </listitem>
                </varlistentry>

                <varlistentry>
                <term>fileid:mntdir allow = LIST</term>
                <listitem>
                <para>List of file system mount points to be allowed for file_id
                generation. If this option is set, file system mount points
                not listed here are ignored.
                </para>
                </listitem>
                </varlistentry>
-->
                <varlistentry>
                <term>fileid:mntdir deny = LIST</term>
                <listitem>
                <para>file_id 生成時に無視される、ファイルシステムマウントポイント
		の一覧。
                </para>
                </listitem>
                </varlistentry>

                <varlistentry>
                <term>fileid:mntdir allow = LIST</term>
                <listitem>
                <para>file_id 生成時に有効となる、ファイルシステムマウントポイントの
		一覧。このオプションが設定された場合、ここで指定されたファイルシステム
		マウントポイント以外は無視される。
                </para>
                </listitem>
                </varlistentry>
<!-- Samba-4.8.0
                <varlistentry>
                <term>fileid:nolockinode</term>
                <listitem>
                <para>This option triggers use of the fileid hostname algorithm
                for the configured inode which can be used to deliberately break
                lock coherency for the corresponding file or directory in a
                cluster.
                </para>
                </listitem>
                </varlistentry>
-->
                <varlistentry>
                <term>fileid:nolockinode</term>
                <listitem>
                <para>このオプションは、クラスタ中にある、対応するファイルまたは
		ディレクトリのロックの一貫性を意図的に破るのに使用できる
		設定された inode に対する、fileid hostnameアルゴリスムの使用を
		トリガする。
                </para>
                </listitem>
                </varlistentry>
        </variablelist>
</refsect1>

<refsect1>
	<title>設定例</title>

	<para>
    <command>fsid</command> アルゴリズムを使って
    <command>fileid</command> モジュールを使う場合の例
	</para>

<programlisting>
        <smbconfsection name="[global]"/>
	<smbconfoption name="vfs objects">fileid</smbconfoption>
	<smbconfoption name="fileid:algorithm">fsid</smbconfoption>
</programlisting>

</refsect1>

<refsect1>
	<title>バージョン</title>

	<para>このマニュアルページは Samba バージョン &doc.version;  用である。
	</para>
</refsect1>

<refsect1>
	<title>著者</title>

	<para>
    オリジナルの Samba ソフトウェアと関連するユーティリティは、Andrew
    Tridgell によって作成された。現在 Samba は Samba Team に
    よって、Linuxカーネルの開発と同様のオープンソースプロジェクト
    として開発が行なわれている。
	</para>

</refsect1>
<refsect1>
    <title>日本語訳</title>
    <para>このマニュアルページは Samba 4.8.0 - 4.15.3 に対応する。</para>
    <para>このドキュメントの Samba 3.2.8 - 4.7.6 対応の翻訳は
    <itemizedlist>
        <listitem><para>堀田 倫英(hotta@net-newbie.com)</para></listitem>
    </itemizedlist>
    によって行なわれた。</para>
    <para>このドキュメントの Samba 4.8.0 - 4.15.3 対応の翻訳は
    <itemizedlist>
        <listitem><para>太田俊哉(ribbon@samba.gr.jp)</para></listitem>
    </itemizedlist>
    によって行なわれた。</para>
</refsect1>

</refentry>
