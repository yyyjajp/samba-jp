<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE refentry PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<refentry id="vfs_fruit.8">

<refmeta>
	<refentrytitle>vfs_fruit</refentrytitle>
	<manvolnum>8</manvolnum>
	<refmiscinfo class="source">Samba</refmiscinfo>
	<refmiscinfo class="manual">システム管理ツール</refmiscinfo>
	<refmiscinfo class="version">4.2</refmiscinfo>
</refmeta>


<refnamediv>
	<refname>vfs_fruit</refname>
	<refpurpose>OS X と Netatalk との相互運用性を強化する</refpurpose>
</refnamediv>

<refsynopsisdiv>
	<cmdsynopsis>
		<command>vfs objects = fruit</command>
	</cmdsynopsis>
</refsynopsisdiv>

<refsect1>
	<title>説明</title>

	<para>この VFS モジュールは
	<citerefentry><refentrytitle>samba</refentrytitle>
	<manvolnum>7</manvolnum></citerefentry>システムの一部である。</para>

	<para>The <command>vfs_fruit</command> モジュールは、Apple SMB クライアント
	との互換性向上と、Netatalk 3 AFP ファイルサーバとの相互運用性を提供する。
	</para>

	<para>このモジュールは、もしも文字変換をするのであれば、
	<command>vfs_catia</command> といっしょに使うべきであり、さらに、
	<command>vfs_streams_xattr</command> と共に使わなければならない。
	正しい設定方法は、例 の節を参照のこと。</para>

	<para>モジュールは、共有に対して、代替データストリーム(ADS)
	のサポートと、OS X 特有のストーリム "AFP_AfpInfo" と "AFP_Resource"
	を横取りし、それを特別な方法で扱う機能を有効にする。
	その他すべての名前付きストリームは、<command>vfs_fruit</command>
	といっしょにロードされねばならない<command>vfs_streams_xattr</command>
	にゆだねられる。</para>

	<para>OS Xクライアントに対する、ADSサポートが有効な共有
	があると言うことは、Apple固有のSMBサーバ実装の動作と似て、
	Sambaが大文字と小文字を区別することにより引き起こされる
	深刻なパフォーマンスの低下を回避すると言う点において価値がある。
	</para>

	<para>OS X メタデータとリソースフォークストリームは、Netatalk 3 と
	互換性のある方法で、下記のように設定することにより格納される。
	<command>fruit:resource = file</command> と
	<command>fruit:metadata = netatalk</command></para>

	<para>OS X は、NTFS の不正な文字を、SMB要求中で、Unicode
	のプライベート領域にマップする。
	<command>fruit:encoding = native</command> を設定することにより、
	すべてのマップされた文字は ネイティブなASCII文字に変換される。
	</para>

	<para>最後に、共有アクセスモードは、
	<command>fruit:locking = netatalk</command>
	を設定することにより、Netatalk AFP 共有モードに対して
	チェックすることもできる。</para>

	<para>このモジュールは、このマニュアルページで言及されている
	物以外に対してはスタックできない。</para>

</refsect1>

<refsect1>
	<title>オプション</title>

	<variablelist>

	  <varlistentry>
	    <term>fruit:resource = [ file | xattr | stream ]</term>
	    <listitem>
	      <para>どこに OSX リソースフォークを格納するかを制御する:</para>

	      <itemizedlist>
		<listitem><para><command>file (既定値)</command> -
		OS X と Netatalk 互換の ._ AppleDouble ファイル
		を使う。</para></listitem>

		<listitem><para><command>xattr</command> - use a
		xattr, requires a filesystem with large xattr support
		and a file IO API compatible with xattrs, this boils
		down to Solaris and derived platforms and
		ZFS
		拡張属性(xattr)を使用する。これは、大きなサイズの拡張属性をサポート
		するファイルシステムと、拡張属性に準拠した
		ファイルIO APIが必要となる。つまり、
		Solaris と Solaris派生プラットフォームのZFSが必須である。
		</para></listitem>

		<listitem><para><command>stream</command> - 
		VFSスタックの、次のモジュールに、ストリームを渡す</para></listitem>
	      </itemizedlist>

	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>fruit:metadata = [ stream | netatalk ]</term>
	    <listitem>
	      <para>OS X メタデータストリームが格納される場所を指定する:</para>

	      <itemizedlist>
		<listitem><para><command>netatalk (既定値)</command> - 
		Netatalk 互換の xattr を使う</para></listitem>

		<listitem><para><command>stream</command> - 
		VFSスタックの次のモジュールにストリームを渡す</para></listitem>
	      </itemizedlist>

	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>fruit:locking = [ netatalk | none ]</term>
	    <listitem>
	      <para></para>
	      <itemizedlist>
		<listitem><para><command>none (既定値)</command> - 
		cross protocol lockingを使わない</para></listitem>

		<listitem><para><command>netatalk</command> - 
		Netatalk で cross protocol locking を使う</para></listitem>

	      </itemizedlist>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>fruit:encoding = [ native | private ]</term>
	    <listitem>

	      <para>Controls how the set of illegal NTFS ASCII
	      character, commonly used by OS X clients, are stored in
	      the filesystem:</para>

	      <itemizedlist>

		<listitem><para><command>private (default)</command> -
		store characters as encoded by the OS X client: mapped
		to the Unicode private range</para></listitem>

		<listitem><para><command>native</command> - store
		characters with their native ASCII
		value</para></listitem>

	      </itemizedlist>
	    </listitem>
	  </varlistentry>

	  <varlistentry>
	    <term>fruit:aapl = yes | no</term>
	    <listitem>
	      <para>A global option whether to enable Apple's SMB2+
	      extension codenamed AAPL. Default
	      <emphasis>yes</emphasis>. This extension enhances
	      several deficiencies when connecting from Macs:</para>

	      <itemizedlist>
		<listitem><para>directory enumeration is enriched with
		Mac relevant filesystem metadata (UNIX mode,
		FinderInfo, resource fork size and effective
		permission), as a result the Mac client doesn't need
		to fetch this metadata individuallly per directory
		entry resulting in an often tremendous performance
		increase.</para></listitem>

		<listitem><para>The ability to query and modify the
		UNIX mode of directory entries.</para></listitem>
	      </itemizedlist>

	      <para>There's a set of per share options that can be
	      used to disable the computation of specific Mac metadata
	      in the directory enumeration context, all are enabled by
	      default:</para>

	      <itemizedlist>
		<listitem><para>readdir_attr:aapl_rsize = true | false</para></listitem>
		<listitem><para>readdir_attr:aapl_finder_info = true | false</para></listitem>
		<listitem><para>readdir_attr:aapl_max_access = true | false</para></listitem>
	      </itemizedlist>

	    </listitem>
	  </varlistentry>

	</variablelist>
</refsect1>

<refsect1>
	<title>EXAMPLES</title>

<programlisting>
        <smbconfsection name="[share]"/>
	<smbconfoption name="vfs objects">catia fruit streams_xattr</smbconfoption>
	<smbconfoption name="fruit:resource">file</smbconfoption>
	<smbconfoption name="fruit:metadata">netatalk</smbconfoption>
	<smbconfoption name="fruit:locking">netatalk</smbconfoption>
	<smbconfoption name="fruit:encoding">native</smbconfoption>
</programlisting>

</refsect1>

<refsect1>
	<title>AUTHOR</title>

	<para>The original Samba software and related utilities
	were created by Andrew Tridgell. Samba is now developed
	by the Samba Team as an Open Source project similar
	to the way the Linux kernel is developed.</para>

</refsect1>

</refentry>
