<samba:parameter name="security"
                 context="G"
				 type="enum"
                 basic="1" advanced="1" wizard="1" developer="1"
		 xmlns:samba="http://www.samba.org/samba/DTD/samba-doc">
		 <when_value value="security">
		 <requires option="encrypted passwords">/(yes|true)/</requires>
		 </when_value>
<description>
  <para>
    このパラメーターは、クライアントが Samba に応答する方式に影響し、
    <filename moreinfo="none">smb.conf</filename> 中でもっとも重要な設定の一つである。
  </para>
  <para>
    このパラメーターは、 <citerefentry><refentrytitle>smbd</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry> が、共有レベルのセキュリティを
    使用するか否かを指定するために、プロトコルネゴシエーションの
    レスポンスに設定する「Security Mode」ビットを制御する。
    クライアントは、このビットによって、ユーザーとパスワードの情報を
    サーバーに転送するか否か、また転送する際の方法を決定する。
  </para>
  <para>
    デフォルトは、 <command moreinfo="none">security = user</command> であり、
    これは Windows 98 と Windows NT との間で通信を行なうときに必要とされる
    もっとも一般的な設定 (訳注: ユーザーレベルのセキュリティ) である。
  </para>

  <para>これ以外の値には Samba の Windows ドメイン参加をサポートする
    <command moreinfo="none"> security = ads </command> と
    <command moreinfo="none"> security = domain </command> 、
    廃止予定となっている
    <command moreinfo="none">security = share</command> と
    <command moreinfo="none">security = server</command> がある。
  </para>

  <para>
    Samba 2.0.0 以前では、
    主に過去との互換性を保つ目的で、 <command moreinfo="none">security = share</command> がデフォルトであった。
  </para>

  <para>
    パスワードなしの共有 (ゲスト共有) の作成が主目的である場合は、
    <command moreinfo="none">security = user</command> と、
    <smbconfoption name="map to guest"/> を使用すること。
    この設定は、共有プリンターサーバーで使用することが多い。
  </para>

  <para>
    <smbconfoption name="NetBIOS aliases"/> を使用して複数の NetBIOS 名を
    付与することで、 <command moreinfo="none">smbd</command> を
    ユーザーレベルと共有レベルのセキュリティの両方を提供する
    形で運用することも可能である。
  </para>

    <para>以下、それ以外の設定について説明する。</para>

    <para><anchor id="SECURITYEQUALSUSER"/><emphasis>SECURITY = USER</emphasis></para>

  <para>
    これは
    デフォルトの値である。ユーザーレベルのセキュリティでは、クライアントは
    最初に有効なユーザー名 (<smbconfoption name="username map"/> により、
    別のユーザー名からマッピング可能) とパスワードによって「ログオン」する
    ことが求められる。このセキュリティモードでは、暗号化パスワード 
    (<smbconfoption name="encrypted passwords"/> パラメーターを参照) も
    使用できる。 <smbconfoption name="user"/> や
    <smbconfoption name="guest only"/> といったパラメーターを設定する
    ことで、コネクションで使用する UNIX ユーザーを変更することもできるが、
    この処理はユーザーが適切に認証された後に行われる。
  </para>

  <para>
    要求するリソース名は、サーバーによるクライアントの認証が成功するまで
    サーバーに<emphasis>送信されない</emphasis>ことに
    <emphasis>注意</emphasis>。ユーザーレベルのセキュリティにおける
    ゲスト共有は、サーバーが不明なユーザーを
    <smbconfoption name="guest account"/> に自動的にマッピングするように
    しないと動作しないのは、このためである。動作の
    詳細については、 <smbconfoption name="map to guest"/> を参照のこと。
  </para>

  <para>
    <emphasis>注意</emphasis>:
    要求するリソース名は、サーバーによるクライアントの認証が成功するまで
    サーバーに<emphasis>送信されない</emphasis> 。ユーザーレベルの
    セキュリティにおけるゲスト共有は、サーバーが不明なユーザーを
    <smbconfoption name="guest account"/> に自動的にマッピングするように
    しないと動作しないのは、このためである。動作の
    詳細については、 <smbconfoption name="map to guest"/> を参照のこと。
  </para>

    <para><link linkend="VALIDATIONSECT">NOTE ABOUT USERNAME/PASSWORD VALIDATION</link>節も参照のこと。</para>

  <para><anchor id="SECURITYEQUALSDOMAIN"/><emphasis>SECURITY = DOMAIN</emphasis></para>

  <para>
    このモードは、 <citerefentry><refentrytitle>net</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry> によって、サーバーが Windows 
    NT ドメインに参加しない限り適切に動作しない。併せて、
    <smbconfoption name="encrypted passwords"/> パラメーターが
    <constant>yes</constant> に設定されている必要がある。
    このモードの Samba は、 Windows NT サーバーと全く同じ方式で、
    Windows NT のプライマリドメインコントローラー、あるいはバックアップ
    ドメインコントローラーにユーザー名とパスワードを送信することで、
    認証を試行する。
  </para>

  <para>
    <emphasis>注意</emphasis>: 
    Samba はファイルにアクセスする際に有効な UNIX ユーザーを必要と
    するため、ドメインコントローラー上のアカウントだけではなく、
    有効な UNIX ユーザーも依然として必要である。
  </para>

  <para>
    <emphasis>注意</emphasis>: 
    クライアントから見ると、
    <command moreinfo="none">security = domain</command> も
    <command moreinfo="none">security = user</command> と同じである。
    この違いが影響するのは、認証処理をサーバーがどのように行うかだけで
    あり、クライアントとのやりとりには何ら影響しない。
  </para>

  <para>
    <emphasis>注意</emphasis>:
    要求するリソース名は、サーバーによるクライアントの認証が成功するまで
    サーバーに<emphasis>送信されない</emphasis> 。ユーザーレベルの
    セキュリティにおけるゲスト共有は、サーバーが不明なユーザーを
    <smbconfoption name="guest account"/> に自動的にマッピングするように
    しないと動作しないのは、このためである。動作の
    詳細については、 <smbconfoption name="map to guest"/> を参照のこと。
  </para>

    <para><link linkend="VALIDATIONSECT">
    NOTE ABOUT USERNAME/PASSWORD VALIDATION</link>節も参照のこと。</para>

  <para>
    <smbconfoption name="password server"/> パラメーターと
    <smbconfoption name="encrypted passwords"/> パラメーターも参照のこと。
  </para>

    <para><anchor id="SECURITYEQUALSSHARE"/><emphasis>SECURITY = SHARE</emphasis></para> 

  <note><para>
    この値は、 SMB2 との互換性がないため廃止予定である。
  </para></note>

    <para>共有レベルのセキュリティに構成されたサーバーに接続するクライアントは、
    共有リソースに接続しようとする際に、あらかじめ
    有効なユーザー名とパスワードでサーバーにログオンしておく必要がない
    (Windows 95/98 や Windows NT といった最近のクライアントは、
    <command moreinfo="none">security=share</command> 
    のサーバーと通信をする際にユーザー名を含むログオン要求を送信するが、
    パスワードは送信しない) 。
    代わりに、クライアントは、共有への接続時に共有毎の認証情報
    (パスワード) を送信する。
  </para>

  <para>
    <command moreinfo="none">smbd</command> がクライアントからのリクエストを
    処理する際には、<emphasis>常に</emphasis>
    いずれかの有効な UNIX ユーザーの権限で処理が行なわれる点に注意。これは、
    <command moreinfo="none">security=share</command> で構成されていた場合で
    あっても変わらない。
  </para>

    <para> 共有レベルのセキュリティでは、
    クライアントがユーザー名をサーバーに送信するように要求されないため、
    <command moreinfo="none">smbd</command> は、いくつかの方法を用いて、
   クライアントからのリクエストを処理する際に利用する UNIX ユーザーを決定する。  </para>

  <para>
    クライアントから送信されるパスワードの確認対象となる
    UNIX ユーザーのユーザー名のリストは、次のようにして作成される:
  </para>

    <itemizedlist>
        <listitem>
            <para> <smbconfoption name="guest only"/>
            パラメーターが設定されている場合、以下の手順は省略され、
            <smbconfoption name="guest account"/>
            に設定されたユーザー名のみが確認対象となる。
            </para>
        </listitem>

        <listitem>
            <para>共有への接続時にユーザー名も送信されてきた場合、
            該当のユーザー名 (マッピング後のもの、
            <smbconfoption name="username map"/> を参照のこと)
            が確認対象のユーザー名に追加される。
            </para>
        </listitem>

        <listitem>
            <para>クライアントが以前に <emphasis>ログオン</emphasis> 
	    リクエスト (SMB の SessionSetup) を行なっていた場合、
            その SMB で送信されたユーザー名が確認対象のユーザー名に追加される。
            </para>
        </listitem>

        <listitem>
            <para>クライアントが接続しようとしているサービスの名前が、
            確認対象のユーザー名に追加される。
            </para>
        </listitem>

        <listitem>
            <para> クライアントの NetBIOS 名が、
            確認対象のユーザー名に追加される。
            </para>
        </listitem>

	<listitem>
            <para> <smbconfoption name="user"/> パラメーターで指定された
            ユーザー名が確認対象のユーザー名に追加される。
	    </para>
	</listitem>
    </itemizedlist>

    <para> <parameter moreinfo="none">guest only</parameter> パラメーターが設定されていない場合は、
    このリスト中のユーザー名を用いて、送信されたパスワードの確認が行なわれる。
    送信されたパスワードが最初に一致したユーザーが、
    以降の処理に使用する UNIX ユーザーとなる。
  </para>

    <para> <parameter>guest only</parameter> パラメーターが yes に設定
    されているか、ここまでで使用する UNIX ユーザーを決定できなかった場合は、
    共有で <parameter moreinfo="none"> guest account </parameter> が利用可能であれば、
    ゲストアクセスが行なわれ、それ以外の場合はアクセスが拒否されることになる。</para>

    <para> 共有レベルのセキュリティでは、
    どの UNIX ユーザーを用いてパーミッションのチェックが行なわれるかの決定が、
    <emphasis>非常に</emphasis> 複雑になる事態が想定されることに注意。</para>

    <para><link linkend="VALIDATIONSECT">
    ユーザー名とパスワード認証についての注意点</link> セクションも参照のこと。</para>

    <para><anchor id="SECURITYEQUALSSERVER"/><emphasis>SECURITY = SERVER</emphasis></para>

  <para>
    このモードは廃止予定である。このモードの Samba は、Windows NT サーバー
    のような他の SMB サーバーにユーザー名とパスワードの認証を委任する。
    これに失敗すると、 <command moreinfo="none">security = user</command> 
    と同様に処理を行なう。このモードを用いる場合は、他のサーバーが対応
    していない場合を
    除き、<smbconfoption name="encrypted passwords"/>パラメーターを <constant>yes</constant>
    にする必要がある。なお、暗号化パスワードで認証処理が行なわれると、
    Samba 上で UNIX パスワードファイルでの認証 (平文認証) に変更できなく
    なるため、ユーザーの認証
    は <filename moreinfo="none">smbpasswd</filename> ファイルで行なう必要がある。
    設定方法の詳細は、 Samba HOWTO Collection の User Database 章を参照のこと。</para>

  <note><para>
    このモードの処理には、中間介入攻撃 (man-in-the-middle attack) や
    サーバーの偽装に脆弱であるという重大なセキュリティホールがある。
    また、ユーザーのセッションが継続している限り、アクティブな
    コネクションを維持しておく必要があるため、 PDC のリソースを大量に
    消費する恐れがある。
    さらに、このコネクションがいったん失われると回復させることができず、
    それ以降は (各クライアントがコネクションを一度切断するまで) 
    Samba サーバーに対する認証が失敗してしまう。
  </para></note>

  <note><para>
    クライアントが NTLMv2 認証を指定してきた場合、このモードの処理は
    <emphasis>失敗する</emphasis> 。
  </para></note>

  <note><para>クライアントから見ると、
    <command moreinfo="none">security = server</command> も
    <command moreinfo="none">security = user</command> も同じである。
    この違いが影響するのは、認証処理をサーバーがどのように行うかだけで
    あり、クライアントとのやりとりには何ら影響しない。
  </para></note>

  <note><para>このオプションは廃止予定であり、将来的には削除される。</para></note>

  <para>
    <emphasis>注意</emphasis>:
    要求するリソース名は、サーバーによるクライアントの認証が成功するまで
    サーバーに<emphasis>送信されない</emphasis> 。ユーザーレベルの
    セキュリティにおけるゲスト共有は、サーバーが不明なユーザーを
    <smbconfoption name="guest account"/> に自動的にマッピングするように
    しないと動作しないのは、このためである。動作の
    詳細については、 <smbconfoption name="map to guest"/> を参照のこと。
  </para>

    <para><link linkend="VALIDATIONSECT">
    ユーザー名とパスワード認証についての注意点</link> セクションも参照のこと。</para>

    <para>
    <smbconfoption name="password server"/>
    パラメーターおよび
    <smbconfoption name="encrypted passwords"/>
    パラメーターも参照のこと。</para>

    <para><anchor id="SECURITYEQUALSADS"/><emphasis>SECURITY = ADS</emphasis></para>

  <para>
    このモードの Samba は、 AD のドメインメンバーとして動作する。
    このモードで動作させるためには、 Samba が動作しているサーバーで
    Kerberos がインストールされて構成されている必要があり、 Samba は
    net コマンドを使用して AD に参加する必要がある。
  </para>

  <para>
    このモードは、 Samba を Active Ditectory のドメインコントローラー
    として動作させるものではないことに注意。
  </para>
	
  <para>詳細については、 HOWTO の Domain Membership を参照のこと。</para>
</description>
<related>realm</related>
<related>encrypt passwords</related>
<value type="default">USER</value>
<value type="example">DOMAIN</value>
</samba:parameter>
