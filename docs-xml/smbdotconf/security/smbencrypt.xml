<samba:parameter name="smb encrypt"
                 context="S"
				 type="enum"
                 basic="1"
		 xmlns:samba="http://www.samba.org/samba/DTD/samba-doc">
<description>
  <para>
    このパラメータは、リモートクライアントを許可するか、SMB暗号化を要求するかを
    制御する。これはSMB1またはSMB2以降の接続を使うかによって動作が異なる:
      </para>

        <itemizedlist>
        <listitem>
                <para>
		もしも接続がSMB1ならば、このオプションは、Unix拡張を使用する、
		Samba 3.2で導入された、Samba固有のSMBプロトコルの使用を制御する。
               </para>
        </listitem>

        <listitem>
               <para>
	       もしも、接続がSMB2以降であれば、このオプションは、SMBバージョン3
	       以降でサポートされる、Windows8以降で有効となっている、SMBレベルの
	       暗号化の使用を制御する。
                </para>
        </listitem>
       </itemizedlist>

       <para>
	 このパラメータはグローバルおよび共有単位で設定できる。設定可能な
	 値は以下の通り。
	 <emphasis>off</emphasis> (または <emphasis>disabled</emphasis>),
	 <emphasis>enabled</emphasis> (または <emphasis>auto</emphasis>, または
	 <emphasis>if_required</emphasis>),
	 <emphasis>desired</emphasis>,
	 と
	 <emphasis>required</emphasis>
	 (または <emphasis>mandatory</emphasis>).
	 特別な値 <emphasis>default</emphasis> は、既定値として
	 <emphasis>enabled</emphasis>に設定されている。
       </para>

       <variablelist>
	 <varlistentry>
	 <term><emphasis>SMB1における影響</emphasis></term>
	 <listitem>
	 <para>
	 SMB1におけるSamba固有の暗号化接続は、UNIX拡張の一部として
	 ネゴシエーションされる、SMBプロトコルの拡張である。SMB暗号化は
	 SMBプロトコルストリーム中で、リクエスト/応答を毎回暗号化および
	 署名する機能を持つGSSAPI(Windows上のSSPI)を使う。有効にすると、
	 sshで保護されたセッションのように、SMB/CIFS通信をセキュアにする
	 機能を提供するが、暗号化のネゴシエーションおよびキーの署名には
	 SMB/CIFSの認証を使う。現在これはSamba 3.2以降の smbclient のみ
	 でサポートされていて、そのうちLinuxのCIFSFSとMacOS/Xでサポート
	 されるかもしれない。Windowsクライアントはこの機能をサポートしない。
	 </para>

         <para>
	 これは共有単位で設定出来るが、クライアントは、指定された共有に対して
	 トラフィックではなく、全セッションを暗号化することを選べる。
	 もしも、これを mandatory に設定すると、共有へのすべてのトラフィックは
	 共有に対する接続がなされた後は、<emphasis>必ず</emphasis>
	 暗号化されなければならない。サーバは、そのような共有に対する、
	 暗号化されていないすべての要求には "access denied" を返す。
	 暗号化されたトラフィックを選ぶと、すべてのデータに対する暗号化および署名
	 を暗号化する時のオーバヘッドと同様、より小さなパケットサイズが使われるため
	 (巨大なUNIX系の読み/書き操作が許可されないため)、トラフィックが減少する。
	 </para>
	 <para>
	   This may be set on a per-share
	 basis, but clients may chose to encrypt the entire session, not
	 just traffic to a specific share. If this is set to mandatory
	 then all traffic to a share <emphasis>must</emphasis>
	 be encrypted once the connection has been made to the share.
	 The server would return "access denied" to all non-encrypted
	 requests on such a share. Selecting encrypted traffic reduces
	 throughput as smaller packet sizes must be used (no huge UNIX
	 style read/writes allowed) as well as the overhead of encrypting
	 and signing all the data.
	 </para>

	 <para>
	   もしも、SMB暗号化が選択された場合、
	   GSSAPIフラグが、データの署名とsealing両方を選択するのに使うように、
	   Windows形式のSMB署名
	   (<smbconfoption name="server signing"/>オプションを参照)は、
	   もはや必要ない。
	 </para>
	 <para>
	   If SMB encryption is selected, Windows style SMB signing (see
	   the <smbconfoption name="server signing"/> option) is no longer
	   necessary, as the GSSAPI flags use select both signing and
	   sealing of the data.
	 </para>

         <para>
	   auto または 既定値を設定すると、SMB暗号化機能は提供されるが、
	   強制はされない。mandatoryに設定すると、SMB暗号化が要求され、
	   disable を設定すると、SMB暗号化はネゴシエーション出来ない。
	 </para>
	 </listitem>
	 </varlistentry>
	 
         <varlistentry>
	 <term><emphasis>SMB2における影響</emphasis></term>
	 <listitem>
	 <para>
	 ネイティブなSMBトランスポート暗号化機能は SMB バージョン3.0以降で有効に
	 なっている。これは、<emphasis>server max protocol</emphasis>が
	 <emphasis>SMB3</emphasis>以降に設定された場合にのみ、提供される。
	 クライアントは、Windows 8以降、あるいはWindows Server 2012以降と、
	 Samba 4.1 以降のsmbclientで、このタイプの暗号化をサポートしている。
         </para>

	 <para>
	   このプロトコル実装にはいろいろなオプションがある:
	 </para>
	 
         <itemizedlist>
	   <listitem>
	     <para>
	       プロトコルネゴシエーション中にSMB暗号化のネゴシエーション実行
	       する機能がある。
	     </para>
	     <para>
	       The capability to perform SMB encryption can be
	       negotiated during protocol negotiation.
	     </para>
	   </listitem>
	   

	   <listitem>
	     <para>
	       データ暗号化はグローバルに有効に出来る。この場合、
	       暗号化対応なコネクションは、暗号化されたすべてのセッション中で
	       すべてのトラフィックを持つことになる。
	     </para>
	     <para>
	       Data encryption can be enabled globally. In that case,
	       an encryption-capable connection will have all traffic
	       in all its sessions encrypted. In particular all share
	       connections will be encrypted.
	     </para>
	   </listitem>

           <listitem>
	     <para>
	       データ暗号化は、グローバルに有効化されていない場合、
	       共有単位でも有効にできる。ある、暗号化対応なコネクションに対し、
	       暗号化が有効になっている共有へのすべてのコネクションは
	       暗号化される。
	     </para>
	     <para>
	       Data encryption can also be enabled per share if not
	       enabled globally. For an encryption-capable connection,
	       all connections to an encryption-enabled share will be
	       encrypted.
	     </para>
	   </listitem>

	   <listitem>
	     <para>
	       暗号化は強制することができる。このことは、データの暗号化が
	       グローバルに有効化されている場合、暗号化に対応していない
	       コネクションでは、セッションセットアップが拒否されることを
	       意味する。さらに、tree connectionは、データ暗号化が有効に
	       なっている場合、共有に対する暗号化に対応していないコネクションは
	       拒否される。
	     </para>
	     <para>
	       Encryption can be enforced. This means that session
	       setups will be denied on non-encryption-capable
	       connections if data encryption has been enabled
	       globally. And tree connections will be denied for
	       non-encryption capable connections to shares with data
	       encryption enabled.
	     </para>
	   </listitem>
	 </itemizedlist>
	 
         <para>
	   これらの機能は、以下のような<emphasis>smb encrypt</emphasis>
	   の設定で制御出来る:
	 </para>

         <itemizedlist>
	   <listitem>
	     <para>
	       明示的に<emphasis>default</emphasis>を設定して
	       既定値のままにするか、グローバルに<emphasis>enabled</emphasis>
	       と設定すると、暗号化のネゴシエーションを有効にするが、
	       グローバルあるいは共有単位のデータ暗号化を有効にはしない。
	     </para>
	     <para>
	       Leaving it as default, explicitly setting
	       <emphasis>default</emphasis>, or setting it to
	       <emphasis>enabled</emphasis> globally will enable
	       negotiation of encryption but will not turn on
	       data encryption globally or per share.
	     </para>
	   </listitem>

	   <listitem>
	     <para>
	       グローバルに<emphasis>desired</emphasis>を設定すると、
	       ネゴシエーションを有効にし、セッションと共有への接続において、
	       機能をサポートしているクライアントに対するデータ暗号化を有効にする。
	     </para>
	     <para>
	       Setting it to <emphasis>desired</emphasis> globally
	       will enable negotiation and will turn on data encryption
	       on sessions and share connections for those clients
	       that support it.
	     </para>
	   </listitem>

           <listitem>
	     <para>
	       グローバルに<emphasis>required</emphasis>を設定すると、
	       ネゴシエーションを有効にし、セッションと共有へのコネクション
	       でデータ暗号化を有効にする。暗号化をサポートしていない
	       クライアントではサーバへのアクセスが拒否される。
	     </para>
	   </listitem>

	   <listitem>
	     <para>
	       グローバルに<emphasis>off</emphasis>を設定すると、
	       暗号化機能を完全に無効にする。
	     </para>
	   </listitem>
	   
           <listitem>
	     <para>
	       共有上で<emphasis>desired</emphasis>を設定すると、
	       ネゴシエーションがグローバルに有効になっている場合、
	       暗号化をサポートしているクライアントに対してこの共有に
	       対するデータの暗号化を有効にする。
	     </para>
	   </listitem>

	   <listitem>
	     <para>
	       共有上で<emphasis>required</emphasis>を設定すると、
	       ネゴシエーションがグローバルで有効になっている場合、
	       この共有に対する暗号化が強制される。すなわち、暗号化を
	       サポートしていないクライアントはこの共有に対するアクセスが
	       拒否される。
	     </para>
             <para>
	       このことは、Windowsと比べ、Sambaで制御される共有単位の
	       強制は、Windowsと違うようになるということである。
	       Windowsでは、<emphasis>RejectUnencryptedAccess</emphasis>
	       はグローバルの設定で、これが設定された場合、データ暗号化が有効な
	       すべての共有は、自動的に暗号化が強制される。Samba上で
	       同じ事をSambaに行わせるためには、
	       グローバルに <emphasis>smb encrypt</emphasis>を
	       <emphasis>enabled</emphasis>に設定し、暗号化したい共有で
	       <emphasis>required</emphasis>を設定する。
	       さらに、Windowsではできない、
	       Note that this allows per-share enforcing to be
	       controlled in Samba differently from Windows:
	       In Windows, <emphasis>RejectUnencryptedAccess</emphasis>
	       is a global setting, and if it is set, all shares with
	       data encryption turned on
	       are automatically enforcing encryption. In order to
	       achieve the same effect in Samba, one
	       has to globally set <emphasis>smb encrypt</emphasis> to
	       <emphasis>enabled</emphasis>, and then set all shares
	       that should be encrypted to
	       <emphasis>required</emphasis>.
	       Additionally, it is possible in Samba to have some
	       shares with encryption <emphasis>required</emphasis>
	       and some other shares with encryption only
	       <emphasis>desired</emphasis>, which is not possible in
	       Windows.
	     </para>
	   </listitem>
	   
	 
</description>

<value type="default">auto</value>
</samba:parameter>
