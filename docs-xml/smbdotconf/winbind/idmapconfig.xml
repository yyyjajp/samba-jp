<samba:parameter name="idmap config"
                 context="G"
		 type="string"
                 advanced="1" developer="1" hide="1"
                 xmlns:samba="http://www.samba.org/samba/DTD/samba-doc">
<description>

  <para>
    Samba における ID マッピングとは、 Windows の ID と UNIX のユーザーや
    グループの UID や GID (UNIX ID) との間でのマッピングである。この処理は、
    モジュール形式のインターフェイスを用いて
    winbindd により行われる。 Samba の ID マッピングは、
    <smbconfoption name="idmap config"/> プレフィックスから始まるパラメーター
    によって設定される。
    idmap パラメーターは、 <smbconfoption name="idmap config"/> 
    プレフィックスに続く、ドメイン名もしくはアスタリスク「*」、コロン、
    指定されたドメインに対する idmap パラメーターから構成される。
  </para>
  <para>
    idmap パラメータの設定は、各ドメインに適用する設定と、
    特定のドメイン名の代わりに * を指定することで、固有の idmap の設定を
    持たないすべてのドメインに対して適用するデフォルト設定とに分けられる。
  </para>

  <para>
    三つの基本パラメーターが存在する:
  </para>

  <variablelist>
    <varlistentry>
      <term>backend = backend_name</term>
      <listitem>
	<para>
	  指定されたドメインに対するバックエンドとして適用する
	  idmap モジュール（ idmap バックエンド）を指定する。
	  標準で提供されているバックエンドは、 
	  tdb (<citerefentry><refentrytitle>idmap_tdb</refentrytitle> <manvolnum>8</manvolnum> </citerefentry>) 、
	  tdb2 (<citerefentry><refentrytitle>idmap_tdb2</refentrytitle> <manvolnum>8</manvolnum></citerefentry>) 、
	  ldap (<citerefentry><refentrytitle>idmap_ldap</refentrytitle> <manvolnum>8</manvolnum></citerefentry>) 、
	  rid (<citerefentry><refentrytitle>idmap_rid</refentrytitle> <manvolnum>8</manvolnum></citerefentry>) 、
	  hash (<citerefentry><refentrytitle>idmap_hash</refentrytitle> <manvolnum>8</manvolnum></citerefentry>) 、
	  autorid (<citerefentry><refentrytitle>idmap_autorid</refentrytitle> <manvolnum>8</manvolnum></citerefentry>) 、
	  ad (<citerefentry><refentrytitle>idmap_ad</refentrytitle> <manvolnum>8</manvolnum></citerefentry>) 、
	  nss (<citerefentry><refentrytitle>idmap_nss</refentrytitle> <manvolnum>8</manvolnum></citerefentry>) である。
	  対応するマニュアルページには詳細が記載されているが、以下に
	  概要を示す。
	</para>
	<para>
	  最初の三つのバックエンドは、内蔵の unixid カウンターを使用して
	  マッピング情報を生成し、データベースに格納する。
	  これらはデフォルトの idmap バックエンドとして使用することができる。
	  rid と hash バックエンドは、 SID から UNIX ID を生成する際に、
	  単純なアルゴリズムによる演算を使用している。
	  autorid バックエンドは、 tdb と rid バックエンドを併用した方式で
	  あり、ドメイン毎のレンジを設定し、自動的に構成された各ドメインに
	  対しては、 rid アルゴリズムを適用する。
	  ad バックエンドは、 Active Directory 標準の拡張スキーマに格納
	  された UNIX ID を使用する。
	  nss バックエンドは、通常の winbindd の挙動とは逆に、 NSS を用いて
	  名前から UNIX ID を取得する。これは LDAP による UNIX ID 管理を
	  行っている際に有用である。
      </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>range = low - high</term>
      <listitem>
	<para>
	  バックエンドの管轄下にあり、マッピング可能な UNIX ID の範囲を
	  指定する。 ID の割り当てを行うバックエンドでは、
	  新規の一意な ID を割り当て可能な範囲も指定する。
	</para>
	<para>
	  Winbind は、このパラメーターを使って UNIX ID と SID のマッピングを
	  管轄するバックエンドを特定するため、このパラメータは、各ドメイン
	  およびデフォルトの設定各々で指定する必要がある。また指定する範囲が
	  重複してはならない。
	</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>read only = yes|no</term>
      <listitem>
	<para>
	  このパラメーターは、ID の割り当てが可能な
	  tdb 、 tdb2 、 ldap バックエンドを読み取り専用（ ID の割り当てを
	  行わない）モードにするために使用する。
	  これは、たとえば、あらかじめマッピング情報が格納されており、
	  自動的に拡張（新規割り当てを実施）することが好ましくない
	  データベースを使用する場合などに有用である。
	</para>
      </listitem>

    </varlistentry>
  </variablelist>

  <para>
    次の例は CORP ドメインに <citerefentry><refentrytitle>idmap_ad</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry> バックエンドを、
    その他のドメインに <citerefentry><refentrytitle>idmap_tdb</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry> バックエンドを指定する際の
    設定を示したものである。
    この設定では、 CORP ドメインの管理者が 1000000 未満の UNIX ID を SFU
    経由でマッピングし、 Winbind は次の 1000000 個の ID を信頼するドメイン
    の UNIX ID や、ローカルグループなどを独自にマッピングするために
    使用することを想定している。
  </para>
	
  <programlisting>
    idmap backend = tdb
    idmap config * : backend = tdb
    idmap config * : range = 1000000-1999999

    idmap config CORP : backend  = ad
    idmap config CORP : range = 1000-999999
  </programlisting>
	
</description>
</samba:parameter>
