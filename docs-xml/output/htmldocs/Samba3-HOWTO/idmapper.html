<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 14. 識別情報のマッピング(IDMAP)</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="NetCommand.html" title="Chapter 13. リモートとローカル管理:Netコマンド"><link rel="next" href="rights.html" title="Chapter 15. User Rights and Privileges"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 14. 識別情報のマッピング(IDMAP)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="NetCommand.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="rights.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 14. 識別情報のマッピング(IDMAP)"><div class="titlepage"><div><div><h2 class="title"><a name="idmapper"></a>Chapter 14. 識別情報のマッピング(IDMAP)</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="idmapper.html#id2617369">SambaサーバのサーバタイプとIDMAP</a></span></dt><dd><dl><dt><span class="sect2"><a href="idmapper.html#id2617396">スタンドアロンSambaサーバ</a></span></dt><dt><span class="sect2"><a href="idmapper.html#id2617467">ドメインメンバサーバかドメインメンバクライアント</a></span></dt><dt><span class="sect2"><a href="idmapper.html#id2618560">プライマリドメインコントローラ</a></span></dt><dt><span class="sect2"><a href="idmapper.html#id2618816">バックアップドメインコントローラ</a></span></dt></dl></dd><dt><span class="sect1"><a href="idmapper.html#id2618896">IDMAPバックエンドの使用例</a></span></dt><dd><dl><dt><span class="sect2"><a href="idmapper.html#id2618960">規定値のWinbind TDB</a></span></dt><dt><span class="sect2"><a href="idmapper.html#id2619729">IDMAP_RIDを使うWinbind</a></span></dt><dt><span class="sect2"><a href="idmapper.html#id2620366">Winbindを使ったIDMAPデータのLDAPへの格納</a></span></dt><dt><span class="sect2"><a href="idmapper.html#id2621000">RFC2307bis Schema拡張を使ったADSからのIDMAPとNSSに対するLDAPの使用</a></span></dt></dl></dd></dl></div><p><a class="indexterm" name="id2617041"></a><a class="indexterm" name="id2617048"></a><a class="indexterm" name="id2617055"></a><a class="indexterm" name="id2617062"></a><a class="indexterm" name="id2617071"></a><a class="indexterm" name="id2617078"></a><a class="indexterm" name="id2617084"></a>Microsoft Windows オペレーティングシステムは、Sambaを実装したOSとの間での相互運用性を行うために、難しい問題を要求してくるといういくつかの特徴がある。この章では、SambaサーバをMicrosoft Windowsネットワーク環境に統合するための難問の1つを解決するために使う、Samba-3(バージョン 3.0.8以降)のメカニズムについて明示的に説明する。この章では、Windowsのセキュリティ識別子(SID)をUNIXのUIDとGIDについての識別情報マッピング(IDMAP)について説明する。</p><p>いろいろな場面において十分に適用出来るようにするため、各可能なSambaの配布タイプについて解説を行う。これは、どのようにIDMAP機能が実装されたかについての概要によってフォローされる。</p><p><a class="indexterm" name="id2617117"></a><a class="indexterm" name="id2617124"></a><a class="indexterm" name="id2617131"></a><a class="indexterm" name="id2617138"></a>IDMAP機能は、複数のSambaサーバ(またはSambaネットワーククライアント)がドメイン中でインストールされている場合に重要である。単一のSambaサーバにおいては、IDMAP基盤については余り気にかける必要はない。既定値におけるSambaの動作はほとんどの場合、十分に使えるものである。複数のSambaサーバが使われる場合、あるサーバから別のサーバにデータを移動する時にはしばしばこれが必要で、それはやっかい事が始まる所でもある!</p><p><a class="indexterm" name="id2617172"></a><a class="indexterm" name="id2617178"></a><a class="indexterm" name="id2617184"></a><a class="indexterm" name="id2617191"></a><a class="indexterm" name="id2617197"></a><a class="indexterm" name="id2617204"></a><a class="indexterm" name="id2617212"></a><a class="indexterm" name="id2617219"></a>LDAPディレクトリ中にユーザとグループアカウント情報が格納されている場合、すべてのサーバはユーザとグループに対して一貫したUIDとGIDを使うことが出来る。これは、NSSとnss_ldapツールを使うことで出来る。Sambaはローカルアカウントのみを使うように設定出来、その場合、IDMAPでの問題が発生する範囲は若干少なくなる。これは、サーバが単一のドメインに属していて、ドメイン間の信頼関係が必要ない時に有効に動作する。別の言い方をすると、もしもSambaサーバがNT4ドメインのメンバかADSのドメインメンバである場合か、不慮のクロスオーバがないように、セキュリティ名前空間を保持する必要がある場合、(すなわち、ユーザ<code class="literal">DOMINICUS\FJones</code>は<code class="literal">FRANCISCUS\FJones</code>というユーザのアカウントリソースへのアクセスが出来ないようにしなければならない)<sup>[<a name="id2617270" href="#ftn.id2617270" class="footnote">4</a>]</sup>クローズする試みは、IDMAP機能が設定されているという方法に対して提供されなければならない。</p><p><a class="indexterm" name="id2617299"></a><a class="indexterm" name="id2617306"></a><a class="indexterm" name="id2617313"></a><a class="indexterm" name="id2617320"></a><a class="indexterm" name="id2617326"></a><a class="indexterm" name="id2617333"></a>IDMAPの使用は、Sambaサーバが一つ以上のドメインからワークステーションまたはサーバによってアクセスされる場合に重要であり、そのような場合、winbindを動作させることが重要で、そうすると、外部のSIDをローカルのUNIX UIDとGIDに解決(IDマッピング)することが出来るようになる。</p><p><a class="indexterm" name="id2617353"></a>IDMAP機能は、Samba起動時に<code class="literal">winbindd</code>の実行を必要とする。</p><div class="sect1" title="SambaサーバのサーバタイプとIDMAP"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2617369"></a>SambaサーバのサーバタイプとIDMAP</h2></div></div></div><p><a class="indexterm" name="id2617378"></a>4つの基本的なサーバタイプがあり、これは、 <a class="link" href="ServerType.html" title="Chapter 3. サーバタイプとセキュリティモード">サーバタイプとセキュリティモードの章</a>に説明がある。</p><div class="sect2" title="スタンドアロンSambaサーバ"><div class="titlepage"><div><div><h3 class="title"><a name="id2617396"></a>スタンドアロンSambaサーバ</h3></div></div></div><p>	<a class="indexterm" name="id2617404"></a>	<a class="indexterm" name="id2617411"></a>	<a class="indexterm" name="id2617418"></a>	スタンドアロンSambaサーバはWindows NT4ドメイン、Windows 200x Active Directory	ドメインかSambaドメインのメンバでない形で動く。	</p><p>	<a class="indexterm" name="id2617434"></a>	<a class="indexterm" name="id2617441"></a>	<a class="indexterm" name="id2617448"></a>	定義により、これは、ユーザとグループはローカルに作成/制御され、ネットワーク	ユーザの識別はローカルのUNIX/Linuxユーザログイン情報に一致しなければならない。	そのため、IDMAP機能はほとんど関心を払う必要はなく、winbindも不要で、IDMAP	機能は関連しないか、興味を持つべきものではない。	</p></div><div class="sect2" title="ドメインメンバサーバかドメインメンバクライアント"><div class="titlepage"><div><div><h3 class="title"><a name="id2617467"></a>ドメインメンバサーバかドメインメンバクライアント</h3></div></div></div><p>	<a class="indexterm" name="id2617476"></a>	<a class="indexterm" name="id2617483"></a>	<a class="indexterm" name="id2617489"></a>	<a class="indexterm" name="id2617496"></a>	<a class="indexterm" name="id2617503"></a>	Samba-3はWindows NT4 PDCまたはBDCとして動作でき、それによって、Windows NT4と	互換性を持つドメイン制御プロトコルを提供する。Samba-3のファイルと印刷共有	プロトコルはすべてのバージョンのMicrosoft Windows製品と互換がある。Windows NT4は	Microsoft Windows Active Directoryと同様、広範囲にWindows SIDを使用する。	</p><p>	<a class="indexterm" name="id2617523"></a>	<a class="indexterm" name="id2617530"></a>	<a class="indexterm" name="id2617537"></a>	Samba-3ドメインメンバサーバとクライアントはMicrosoft Windows SIDと正しく相互に	処理を行わなければならない。入力されたSIDはローカルのUNIX UIDとGIDに変換され	なければならない。Sambaサーバから出力する情報は、適切なSIDでMicrosoft Windows	クライアントとサーバに提供されなければならない。	</p><p>	<a class="indexterm" name="id2617557"></a>	<a class="indexterm" name="id2617563"></a>	Windowsネットワークドメイン(NT4形式またはADS)のメンバであるSambaはいろいろな	方法で識別情報のマッピングを扱うように設定出来る。使用するメカニズムは、	<code class="literal">winbindd</code>デーモンが使われるか否かとどのようにwinbindの	機能が設定されているかに依存する。設定オプションの簡単な説明は以下の通り:	</p><div class="variablelist"><dl><dt><span class="term">Winbindが使用されず、ユーザとグループがローカルの場合: </span></dt><dd><p>				<a class="indexterm" name="id2617601"></a>				<a class="indexterm" name="id2617608"></a>				<a class="indexterm" name="id2617615"></a>				<a class="indexterm" name="id2617622"></a>				<a class="indexterm" name="id2617629"></a>				<a class="indexterm" name="id2617636"></a>				<a class="indexterm" name="id2617642"></a>				<a class="indexterm" name="id2617649"></a>				<a class="indexterm" name="id2617656"></a>				<a class="indexterm" name="id2617663"></a>				<a class="indexterm" name="id2617670"></a>				<code class="literal">winbindd</code>が使われないと、Samba				(<code class="literal">smbd</code>)は、入力されたネットワークからの				情報の識別を解決するための、基本的なUNIX/Linuxメカニズムを				使用する。これは、セッションセットアップ要求時にLoginID				(アカウント名)を使い、getpwnam()システムファンクションコール				にそれを渡す。この呼び出しは最近のUNIX/Linuxシステム上では				ネームサービススイッチ(NSS)メカニズムを使うように実装されて				いる。"ユーザとグループがローカル"という場合、それらは				ローカルシステム上の、<code class="filename">/etc/passwd</code>と				<code class="filename">/etc/group</code>にそれぞれ格納されることを				意味する。				</p><p>				<a class="indexterm" name="id2617726"></a>				<a class="indexterm" name="id2617732"></a>				たとえば、ユーザ<code class="literal">BERYLIUM\WambatW</code>が				Sambaサーバに対して接続をオープンしようとする場合、				入力されるSessionSetupAndX要求は、<code class="filename">/etc/passwd</code>				ファイル中のユーザ<code class="literal">WambatW</code>を検索するために				システムを呼び出す。				</p><p>				<a class="indexterm" name="id2617766"></a>				<a class="indexterm" name="id2617773"></a>				<a class="indexterm" name="id2617780"></a>				<a class="indexterm" name="id2617786"></a>				<a class="indexterm" name="id2617793"></a>				<a class="indexterm" name="id2617799"></a>				<a class="indexterm" name="id2617806"></a>				<a class="indexterm" name="id2617813"></a>				この設定は、スタンドアロンSambaサーバ、ドメインメンバサーバ				(NT4またはADS)とsmbpasswdまたはtdbsamベースのSamba passdb				バックエンドを使うPDCに対して使うことが出来る。				</p></dd><dt><span class="term">Winbindは使わないが、ユーザとグループはNSS経由で解決する場合</span></dt><dd><p>				<a class="indexterm" name="id2617843"></a>				<a class="indexterm" name="id2617850"></a>				<a class="indexterm" name="id2617858"></a>				<a class="indexterm" name="id2617865"></a>				<a class="indexterm" name="id2617872"></a>				<a class="indexterm" name="id2617878"></a>				この場合、ユーザとグループアカウントは、ローカルアカウントとして				取り扱われる。ローカルアカウントそのものとただ1つ違う点は、				共有可能なリポジトリ内にアカウントが格納されると言うことである。				一般的には、これは、NIS形式のデータベースか、そうでなければ				LDAP内にあると言うことである。				</p><p>				<a class="indexterm" name="id2617898"></a>				<a class="indexterm" name="id2617906"></a>				<a class="indexterm" name="id2617913"></a>				<a class="indexterm" name="id2617919"></a>				<a class="indexterm" name="id2617926"></a>				<a class="indexterm" name="id2617932"></a>				<a class="indexterm" name="id2617939"></a>				この設定は、スタンドアロンSambaサーバ、ドメインメンバサーバ				(NT4またはADS)とsmbpasswdまたはtdbsamベースのSamba passdb                                バックエンドを使うPDCに対して使うことが出来る。				</p></dd><dt><span class="term">Winbind/NSSと既定値のローカルなIDMAPテーブルの場合: </span></dt><dd><p>				<a class="indexterm" name="id2617969"></a>				<a class="indexterm" name="id2617976"></a>				<a class="indexterm" name="id2617984"></a>				<a class="indexterm" name="id2617990"></a>				Windows NT4ドメインかADSドメインのメンバである単一のSamba				サーバか単純なSambaサーバのみを必要とするサイトは多数ある。				標準的なサーバの例は、ドメイン用のドメインコントローラ				からアカウント認証情報を入手するためにwinbindを使うように				設定され、ローカルアカウントを持たないアプライアンスの				ようなファイルサーバである。ドメイン制御機能は、Samba-3、				Microsoft Windows NT4かMicrosoft Windows Active Directory				によって提供される。				</p><p>				<a class="indexterm" name="id2618011"></a>				<a class="indexterm" name="id2618018"></a>				<a class="indexterm" name="id2618025"></a>				<a class="indexterm" name="id2618032"></a>				<a class="indexterm" name="id2618039"></a>				Winbindは、この状態においては非常に有益である。必要と				されるすべては、<code class="filename">smb.conf</code>ファイル中で定義することが出来る				UIDとGIDの値の範囲である。<code class="filename">/etc/nsswitch.conf</code>				ファイルは、入力されたSIDを適切なUIDとGIDにマッピングする				ための、すべての難しい作業をこなす<code class="literal">winbind</code>				を使うために設定される。SIDはwinbindがそれを受け取る順で				UID/GIDに割り当てられる。				</p><p>				<a class="indexterm" name="id2618080"></a>				<a class="indexterm" name="id2618087"></a>				<a class="indexterm" name="id2618094"></a>				<a class="indexterm" name="id2618100"></a>				この設定は、複数のSambaサーバにまたがってUID/GIDとユーザや				グループとのマッピングが同一であることが求められる環境(サイト)				では実用的でない。この方法の危険性の1つは、winbind機構の				IDMAPデータベースファイルが壊れるか喪失した場合、IDMAP				ファイル修正、再生成しても、UIDやGIDが以前と異なるユーザや				グループにマッピングされてしまい、結果としてSambaサーバ上に				格納されたWindowsファイルの所有者が不正になってしまう可能性				がある点である。				</p></dd><dt><span class="term">Winbind/NSSがRIDベースのIDMAPの場合: </span></dt><dd><p>				<a class="indexterm" name="id2618143"></a>				<a class="indexterm" name="id2618149"></a>				<a class="indexterm" name="id2618156"></a>				<a class="indexterm" name="id2618162"></a>				IDMAP_RID機能はSamba 3.0.8から提供された。これは、				ADSスキーマ拡張を適用しないMicrosoft ADSを使用する				ことに関わりがあり、IDMAPテーブルをメンテナンスする				目的のためにLDAPディレクトリサーバをインストールして				いない、たくさんのサイトのために作業を簡単にする。				もしも単一のADSドメイン(ドメインのフォレストではなく				複数のドメインツリーでない)で、IDMAPテーブル問題に				対して単純なステレオタイプの解決方法を望んでいるなら、				IDMAP_RIDは明らかな選択肢である。				</p><p>				<a class="indexterm" name="id2618196"></a>				<a class="indexterm" name="id2618203"></a>				<a class="indexterm" name="id2618209"></a>				<a class="indexterm" name="id2618216"></a>				<a class="indexterm" name="id2618223"></a>				<a class="indexterm" name="id2618229"></a>				<a class="indexterm" name="id2618236"></a>				<a class="indexterm" name="id2618243"></a>				この機能は<em class="parameter"><code>idmap uid</code></em>と				<em class="parameter"><code>idmap gid</code></em>のレンジを割り当てることを				要求し、それが、SIDの相対識別子(RID)の部分を直接UIDのベースにRIDの				値を足した分に、自動マッピングするための、このレンジの				サブセットを割り当てることが可能な				<em class="parameter"><code>idmap uid</code></em>の範囲内であることを要求する。				たとえば、もしも<em class="parameter"><code>idmap uid</code></em>の範囲が				<code class="constant">1000-100000000</code>で、				<em class="parameter"><code>idmap backend = idmap_rid:DOMAIN_NAME=1000-50000000</code></em>				で、発生したSIDが				<code class="constant">S-1-5-21-34567898-12529001-32973135-1234</code>				という値ならば、結果のUIDは<code class="constant">1000 + 1234 = 2234</code>である。				</p></dd><dt><span class="term">WinbindとNSS/LDAPバックエンドベースのIDMAP機能: </span></dt><dd><p>				<a class="indexterm" name="id2618316"></a>				<a class="indexterm" name="id2618323"></a>				<a class="indexterm" name="id2618330"></a>				<a class="indexterm" name="id2618336"></a>				<a class="indexterm" name="id2618343"></a>				<a class="indexterm" name="id2618349"></a>				<a class="indexterm" name="id2618356"></a>				<a class="indexterm" name="id2618363"></a>				この設定では、<code class="literal">winbind</code>は<code class="filename">smb.conf</code>ファイル内で				指定された<em class="parameter"><code>idmap uid</code></em>と				<em class="parameter"><code>idmap gid</code></em>の範囲からSIDからUIDとGIDに				解決を行うが、ローカルのwinbind IDMAPテーブルを使う代わりに、				すべてのドメインメンバマシン(クライアントとサーバ)が共通の				IDMAPテーブルを共有できるためのLDAPディレクトリ中に格納された				ものを使う。				</p><p>				<a class="indexterm" name="id2618410"></a>				<a class="indexterm" name="id2618417"></a>				<a class="indexterm" name="id2618424"></a>				すべてのLDAP IDMAPクライアントは、<code class="filename">smb.conf</code>ファイル中の				<em class="parameter"><code>idmap backend</code></em>機能がLDAPリダイレクトを				正しく扱えないため、マスタLDAPサーバのみを使うということは				重要である。				</p></dd><dt><span class="term">UNIX/LinuxのユーザとグループIDを解決するためにNSSを使うwinbindの場合: </span></dt><dd><p>				passdb バックエンドとしてのLDAPの使用はPDC、BDCとドメイン				メンバサーバに対する優れた解である。それは、UID、GIDと				一致したSIDがすべてのサーバ間で首尾一貫している事を				保証するきちんとした解である。				</p><p>				<a class="indexterm" name="id2618476"></a>				<a class="indexterm" name="id2618483"></a>				LDAPベースのpassdbバックエンドの使用は、PADL nss_ldap				ユーティリティか同等品を要求する。この状況の場合、				winbindは外部のSID、すなわち、スタンドアロン				WindowsクライアントからのSID(すなわち、このドメインの				メンバでない)を他のドメインからのSIDと同じように				扱うために使われる。外部のUID/GIDは、ローカルのIDMAP				テーブルでwinbindを使う時と同じ方法で正確に、				割り当てられた範囲(idmap uidとidmap gid)にマップされる。				</p><p>				<a class="indexterm" name="id2618503"></a>				<a class="indexterm" name="id2618510"></a>				<a class="indexterm" name="id2618517"></a>				nss_ldapツールセットはActive Directory経由と同様に、LDAP				経由でUIDとGIDにアクセスするために使われる。Active Directory				を使うために、AD4UNIXスキーマ拡張か、Microsoft Services for				UNIXバージョン3.5かそれ以降のどちらかをを、UNIXアカウント				認証情報を管理するために、ADSスキーマを	拡張するために				インストールしてADSスキーマを変更することが必要である。				ADSスキーマが拡張されると、Microsoft管理コンソール(MMC)				スナップインもADSのユーザとコンピュータ管理ツールから				UNIXの認証情報を設定/管理することが出来るようにインストール				される。各アカウントは、UIDとGIDデータがSambaによって使われる				ことが出来る前に、UNIXで有効な状態と分離されなければならない。				</p></dd></dl></div></div><div class="sect2" title="プライマリドメインコントローラ"><div class="titlepage"><div><div><h3 class="title"><a name="id2618560"></a>プライマリドメインコントローラ</h3></div></div></div><p>	<a class="indexterm" name="id2618568"></a>	<a class="indexterm" name="id2618576"></a>	<a class="indexterm" name="id2618582"></a>	<a class="indexterm" name="id2618589"></a>	Microsoft Windowsドメインセキュリティシステムは、アカウント作成のプロセスの	一部として、ユーザとグループSIDを生成する。WindowsはUNIXのUIDかGIDのような	概念を持たない。その代わり、固有のタイプのセキュリティ記述子を持つ。Sambaが	ドメインコントローラとして使われる時、各ユーザとグループに固有のSIDを生成する	手段を提供する。Sambaは、<code class="filename">smb.conf</code>ファイル中で指定されたベースの値にUID	またはGIDを2倍した値を足すという算術的に計算されたRIDを足すマシンとドメイン	SIDを生成する。この方法は<span class="quote">“<span class="quote">算術的マッピング</span>”</span>と呼ばれる。	</p><p>	<a class="indexterm" name="id2618623"></a>	例をあげると、もしもユーザのUIDが4321の場合、算術的なRIDベースが1000だとすると、	RIDは<code class="literal">1000 + (2 x 4321) = 9642</code>となる。そのため、もしもドメイン	SIDが<code class="literal">S-1-5-21-89238497-92787123-12341112</code>ならば、	結果のSIDは<code class="literal">S-1-5-21-89238497-92787123-12341112-9642</code>となる。	</p><p>	<a class="indexterm" name="id2618658"></a>	<a class="indexterm" name="id2618665"></a>	<a class="indexterm" name="id2618671"></a>	<a class="indexterm" name="id2618678"></a>	前述のタイプのSIDはSambaによって、自動的な機能としてその場で生成されるか	(<em class="parameter"><code>passdb backend = [tdbsam | smbpasswd]</code></em>を使った場合)、	あるいはLDAPベースのldapsam中でアカウントの一部として恒久的に格納されても	よい。	</p><p>	<a class="indexterm" name="id2618701"></a>	<a class="indexterm" name="id2618707"></a>	<a class="indexterm" name="id2618714"></a>	<a class="indexterm" name="id2618721"></a>	<a class="indexterm" name="id2618728"></a>	<a class="indexterm" name="id2618735"></a>	<a class="indexterm" name="id2618741"></a>	<a class="indexterm" name="id2618748"></a>	<a class="indexterm" name="id2618756"></a>	ADSはUIDとGIDのような追加のアカウント属性に適応するために拡張できるディレクトリ	スキーマを使う。Microsoft Service for UNIX 3.5をインストールすると、通常のADS	スキーマをUNIXアカウント属性を含むように拡張する。これらはもちろん通常の	ADSアカウント管理のMMCインタフェーススナップインモジュールを等して別途管理され	なければならない。	</p><p>	<a class="indexterm" name="id2618776"></a>	<a class="indexterm" name="id2618782"></a>	<a class="indexterm" name="id2618790"></a>	<a class="indexterm" name="id2618796"></a>	ドメイン内で使われるセキュリティ識別子は、競合を避けるためと完全性を保つために	管理されねばならない。NT4ドメインコンテキスト中で、PDCはすべてのセキュリティ	認証情報の、バックアップドメインコントローラ(BDC)への配布を管理する。現時点で、	そのような情報のために適したSambaドメインコントローラのpassdbバックエンドは、	LDAP中バックエンドのみである。	</p></div><div class="sect2" title="バックアップドメインコントローラ"><div class="titlepage"><div><div><h3 class="title"><a name="id2618816"></a>バックアップドメインコントローラ</h3></div></div></div><p>	<a class="indexterm" name="id2618824"></a>	<a class="indexterm" name="id2618831"></a>	<a class="indexterm" name="id2618838"></a>	<a class="indexterm" name="id2618845"></a>	<a class="indexterm" name="id2618852"></a>	<a class="indexterm" name="id2618859"></a>	<a class="indexterm" name="id2618866"></a>	ユーザとグループアカウントの中の情報の変更はBDCからPDCに送られる。PDCのみが	ディレクトリに対して書き込むことができる。	</p><p>	IDMAPの情報は、すべてのドメインコントローラがマスタ(書き込み可能な)LDAPサーバに	対してアクセス可能である限り、LDAPサーバに直接書き込める。Samba-3は現時点で	IDMAPバックエンド中でLDAPリダイレクトを扱えない。これは、IDMAP機能をスレーブ	(複製される)LDAPサーバで使うのは危険だということである。	</p></div></div><div class="sect1" title="IDMAPバックエンドの使用例"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2618896"></a>IDMAPバックエンドの使用例</h2></div></div></div><p><a class="indexterm" name="id2618905"></a><a class="indexterm" name="id2618914"></a><a class="indexterm" name="id2618924"></a><a class="indexterm" name="id2618930"></a><a class="indexterm" name="id2618937"></a><code class="literal">winbind</code>を使う誰にとっても、下記の設定例は有用である。多くの場合、<code class="literal">winbind</code>は、ドメインメンバサーバ(DMS)とドメインメンバクライアント(DMC)を使うために一番興味がある事項である。</p><div class="sect2" title="規定値のWinbind TDB"><div class="titlepage"><div><div><h3 class="title"><a name="id2618960"></a>規定値のWinbind TDB</h3></div></div></div><p>	2つの共通的な設定が使われる:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>		ネットワーク上にNT4 PDC(BDCがあってもなくても)かSambaPDC(BDCがあってもなくても)がある。		</p></li><li class="listitem"><p>		ネットワークは Microsoft Windows 200x ADSを使っている。		</p></li></ul></div><div class="sect3" title="NT4形式のドメイン(Sambaドメインを含む)"><div class="titlepage"><div><div><h4 class="title"><a name="id2618990"></a>NT4形式のドメイン(Sambaドメインを含む)</h4></div></div></div><p>	<a class="link" href="idmapper.html#idmapnt4dms" title="Example 14.1. NT4形式のドメインメンバサーバのsmb.conf">NT4ドメインメンバサーバのsmb.con</a>は、NT4	 DMSに対する<code class="filename">smb.conf</code>ファイルのグローバルセクション部分の例を示す。	</p><div class="example"><a name="idmapnt4dms"></a><p class="title"><b>Example 14.1. NT4形式のドメインメンバサーバのsmb.conf</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td># グローバルパラメータ</td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2619047"></a><em class="parameter"><code>workgroup = MEGANET2</code></em></td></tr><tr><td><a class="indexterm" name="id2619058"></a><em class="parameter"><code>security = DOMAIN</code></em></td></tr><tr><td><a class="indexterm" name="id2619070"></a><em class="parameter"><code>idmap uid = 10000-20000</code></em></td></tr><tr><td><a class="indexterm" name="id2619082"></a><em class="parameter"><code>idmap gid = 10000-20000</code></em></td></tr><tr><td><a class="indexterm" name="id2619094"></a><em class="parameter"><code>template primary group = "Domain Users"</code></em></td></tr><tr><td><a class="indexterm" name="id2619106"></a><em class="parameter"><code>template shell = /bin/bash</code></em></td></tr></table></div></div><br class="example-break"><p>	<a class="indexterm" name="id2619121"></a>	<a class="indexterm" name="id2619128"></a>	<code class="literal">winbind</code>の使用は、NSSの設定を必要とする。以下を含むように	<code class="filename">/etc/nsswitch.conf</code>のエントリを編集する:</p><pre class="screen">...passwd: files winbindshadow: files winbindgroup:  files winbind...hosts:  files [dns] wins...</pre><p>	ホストエントリでDNSを使う場合は、サイト上でDNSが使われている場合にのみ行う。	</p><p>	DMSを作成するには以下のような手順を踏む:	</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>		上記の設定を使って、<code class="filename">smb.conf</code>ファイルを作成するかインストールする。		</p></li><li class="step" title="Step 2"><p>		以下を実行する:</p><pre class="screen"><code class="prompt">root# </code> net rpc join -UAdministrator%passwordJoined domain MEGANET2.</pre><p>	<a class="indexterm" name="id2619202"></a>	ドメインへの参加が成功するかどうかは、以下のコマンドで確認できる:</p><pre class="screen"><code class="prompt">root# </code> net rpc testjoinJoin to 'MIDEARTH' is OK</pre><p>		ドメインへの参加が失敗した場合、以下のようなエラーメッセージが出力される:		<a class="indexterm" name="id2619228"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc testjoin[2004/11/05 16:34:12, 0] utils/net_rpc_join.c:net_rpc_join_ok(66)Join to domain 'MEGANET2' is not valid</pre><p>		</p></li><li class="step" title="Step 3"><p>		<a class="indexterm" name="id2619255"></a>		<a class="indexterm" name="id2619262"></a>		<a class="indexterm" name="id2619269"></a>		<code class="literal">nmbd, winbind,</code>と<code class="literal">smbd</code>をこの順番で起動する。		</p></li></ol></div></div><div class="sect3" title="ADSドメイン"><div class="titlepage"><div><div><h4 class="title"><a name="id2619292"></a>ADSドメイン</h4></div></div></div><p>	<a class="indexterm" name="id2619300"></a>	<a class="indexterm" name="id2619306"></a>	ADSドメインへの参加手続きは、NT4ドメインへの参加と似ているが、<code class="filename">smb.conf</code>ファイルは	<a class="link" href="idmapper.html#idmapadsdms" title="Example 14.2. ADSドメインメンバサーバのsmb.conf">ADSドメインメンバサーバのsmb.conf</a>で示された	内容の部分が異なる。	</p><div class="example"><a name="idmapadsdms"></a><p class="title"><b>Example 14.2. ADSドメインメンバサーバのsmb.conf</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td># グローバルパラメータ</td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2619363"></a><em class="parameter"><code>workgroup = BUTTERNET</code></em></td></tr><tr><td><a class="indexterm" name="id2619375"></a><em class="parameter"><code>netbios name = GARGOYLE</code></em></td></tr><tr><td><a class="indexterm" name="id2619387"></a><em class="parameter"><code>realm = BUTTERNET.BIZ</code></em></td></tr><tr><td><a class="indexterm" name="id2619399"></a><em class="parameter"><code>security = ADS</code></em></td></tr><tr><td><a class="indexterm" name="id2619410"></a><em class="parameter"><code>template shell = /bin/bash</code></em></td></tr><tr><td><a class="indexterm" name="id2619422"></a><em class="parameter"><code>idmap uid = 500-10000000</code></em></td></tr><tr><td><a class="indexterm" name="id2619434"></a><em class="parameter"><code>idmap gid = 500-10000000</code></em></td></tr><tr><td><a class="indexterm" name="id2619446"></a><em class="parameter"><code>winbind use default domain = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2619458"></a><em class="parameter"><code>winbind nested groups = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2619470"></a><em class="parameter"><code>printer admin = "BUTTERNET\Domain Admins"</code></em></td></tr></table></div></div><br class="example-break"><p>	<a class="indexterm" name="id2619485"></a>	<a class="indexterm" name="id2619492"></a>	<a class="indexterm" name="id2619499"></a>	<a class="indexterm" name="id2619506"></a>	<a class="indexterm" name="id2619512"></a>	<a class="indexterm" name="id2619519"></a>	<a class="indexterm" name="id2619526"></a>	ADSのDMS操作はkerberos(KRB)を使用すること要求する。これを動作させるため、	<code class="filename">krb5.conf</code>ファイルを設定する必要がある。正確な要求	内容は、どのバージョンのMITかHeimdal kerberosが使われているかに依存する。	現時点でMIT Kerberosのバージョンが1.3.5で、Heimdal が 0.61である最新の	バージョンのみを使うことを推奨する。	</p><p>	DMSを作成するには以下のステップを必要とする:	</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>		上記の設定で<code class="filename">smb.conf</code>ファイルを作成するかインストールする。		</p></li><li class="step" title="Step 2"><p>		上記で示されたように、<code class="filename">/etc/nsswitch.conf</code>ファイルを編集する。		</p></li><li class="step" title="Step 3"><p>		以下を実行する:		<a class="indexterm" name="id2619597"></a></p><pre class="screen"><code class="prompt">root# </code> net ads join -UAdministrator%passwordJoined domain BUTTERNET.</pre><p>	ドメインへの参加が成功するか失敗するかは以下のコマンドで確認出来る:</p><pre class="screen"><code class="prompt">root# </code> net ads testjoinUsing short domain name -- BUTTERNETJoined 'GARGOYLE' to realm 'BUTTERNET.BIZ'</pre><p>	</p><p>	ドメインへの参加が不正か失敗するかは以下を実行することで検出できる:</p><pre class="screen"><code class="prompt">root# </code> net ads testjoinGARGOYLE$@'s password:[2004/11/05 16:53:03, 0] utils/net_ads.c:ads_startup(186)  ads_connect: No results returnedJoin to domain is not valid</pre><p>		<a class="indexterm" name="id2619658"></a>		<a class="indexterm" name="id2619665"></a>		<a class="indexterm" name="id2619672"></a>		<a class="indexterm" name="id2619679"></a>		特定のエラーメッセージは、発生した不成功のタイプに依存するため、		上記とは異なるかもしれない。<em class="parameter"><code>log level</code></em>を10まで		増やし、テストを再実行し、失敗の真の原因を探るために､生成されたログ		ファイルを調べること。		</p></li><li class="step" title="Step 4"><p>		<code class="literal">nmbd</code>, <code class="literal">winbind</code>と <code class="literal">smbd</code>		デーモンをこの順番で起動する。		</p></li></ol></div></div></div><div class="sect2" title="IDMAP_RIDを使うWinbind"><div class="titlepage"><div><div><h3 class="title"><a name="id2619729"></a>IDMAP_RIDを使うWinbind</h3></div></div></div><p>	<a class="indexterm" name="id2619737"></a>	<a class="indexterm" name="id2619744"></a>	<a class="indexterm" name="id2619751"></a>	<a class="indexterm" name="id2619757"></a>	<code class="literal">idmap_rid</code>機能は、ネイティブなwinbindとは異なり、新しい	ツールで、MicrosoftのSIDをUNIXのUIDとGIDに、予測可能なマッピングを作成する。	Samba IDMAP機能にこの手法を実装する一番の利点は、集中したIDMAPデータを保存する	必要性をなくすということである。不都合な点は、単一のADSドメイン内のみで使う	事ができる事と、ドメイン間信頼機能とは互換性がないことである。	</p><p>	<a class="indexterm" name="id2619790"></a>	<a class="indexterm" name="id2619796"></a>	<a class="indexterm" name="id2619803"></a>	<a class="indexterm" name="id2619810"></a>	このSIDからUID/GIDへのマッピングにおける代替手法はidmap_ridプラグインを	使って実現できる。このプラグインは、RIDに指定されたベース値を加える事に	よってUIDとGIDを引き出すために、ユーザSIDのRIDを使う。このユーティリティは	複数のドメイン環境とは互換がない、<span class="quote">“<span class="quote">allow trusted domains = No</span>”</span>	パラメータを指定することを要求する。<em class="parameter"><code>idmap uid</code></em>と	<em class="parameter"><code>idmap gid</code></em>の範囲を指定する必要がある。	</p><p>	<a class="indexterm" name="id2619849"></a>	<a class="indexterm" name="id2619856"></a>	idmap_rid機能はNT4/Samba形式のドメインとActive Directoryで使える。これをNT4	ドメインで使うためには、<em class="parameter"><code>realm</code></em>パラメータを含んでは	いけない。さらに、ドメインに参加するために使う手法は、	<code class="constant">net rpc join</code>を使う。	</p><p>	ADSドメイン環境での<code class="filename">smb.conf</code>ファイルの例は、	<a class="link" href="idmapper.html#idmapadsridDMS" title="Example 14.3. idmap_ridを使うADSドメインメンバのsmb.conf">idmap_ridを使うADSドメインメンバのsmb.conf</a>	である。	</p><div class="example"><a name="idmapadsridDMS"></a><p class="title"><b>Example 14.3. idmap_ridを使うADSドメインメンバのsmb.conf</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td># グローバルパラメータ</td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2619930"></a><em class="parameter"><code>workgroup = KPAK</code></em></td></tr><tr><td><a class="indexterm" name="id2619942"></a><em class="parameter"><code>netbios name = BIGJOE</code></em></td></tr><tr><td><a class="indexterm" name="id2619953"></a><em class="parameter"><code>realm = CORP.KPAK.COM</code></em></td></tr><tr><td><a class="indexterm" name="id2619965"></a><em class="parameter"><code>server string = Office Server</code></em></td></tr><tr><td><a class="indexterm" name="id2619977"></a><em class="parameter"><code>security = ADS</code></em></td></tr><tr><td><a class="indexterm" name="id2619989"></a><em class="parameter"><code>allow trusted domains = No</code></em></td></tr><tr><td><a class="indexterm" name="id2620001"></a><em class="parameter"><code>idmap backend = idmap_rid:KPAK=500-100000000</code></em></td></tr><tr><td><a class="indexterm" name="id2620013"></a><em class="parameter"><code>idmap uid = 500-100000000</code></em></td></tr><tr><td><a class="indexterm" name="id2620025"></a><em class="parameter"><code>idmap gid = 500-100000000</code></em></td></tr><tr><td><a class="indexterm" name="id2620036"></a><em class="parameter"><code>template shell = /bin/bash</code></em></td></tr><tr><td><a class="indexterm" name="id2620048"></a><em class="parameter"><code>winbind use default domain = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2620060"></a><em class="parameter"><code>winbind enum users = No</code></em></td></tr><tr><td><a class="indexterm" name="id2620072"></a><em class="parameter"><code>winbind enum groups = No</code></em></td></tr><tr><td><a class="indexterm" name="id2620084"></a><em class="parameter"><code>winbind nested groups = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2620096"></a><em class="parameter"><code>printer admin = "Domain Admins"</code></em></td></tr></table></div></div><br class="example-break"><p>	<a class="indexterm" name="id2620111"></a>	<a class="indexterm" name="id2620118"></a>	<a class="indexterm" name="id2620125"></a>	<a class="indexterm" name="id2620132"></a>	たくさんのユーザが居る大きなドメイン中で、ユーザとグループを列挙することを無効に	することは避けられない。例えば、Active Directory中に22000人ものユーザが居る	サイトで、winbindベースのユーザとグループの解決は、<code class="literal">winbind</code>を	最初に開始する時点から12分以上利用できない。列挙を無効にすると、瞬間的に反応が	返る。ユーザとグループの列挙を無効にすると言うことは、<code class="literal">getent passwd</code>	と<code class="literal">getent group</code>コマンドを使ってユーザかグループの一覧を	表示することが出来ないと言うことである。特定のユーザのみを検索することは	以下のような方法で可能である。	</p><p>	<a class="indexterm" name="id2620177"></a>	<a class="indexterm" name="id2620184"></a>	このツールを使用するには、ネイティブなwinbindの使用ごとにNSSの設定を必要とする。	以下のパラメータを含むように<code class="filename">/etc/nsswitch.conf</code>ファイルを	編集する。</p><pre class="screen">...passwd: files winbindshadow: files winbindgroup:  files winbind...hosts:  files wins...</pre><p>	</p><p>	以下の手順でidmap_rid機能を使うことが出来る:	</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>		上記の設定で<code class="filename">smb.conf</code>ファイルを作成またはインストールする。		</p></li><li class="step" title="Step 2"><p>		    上記で示されたように<code class="filename">/etc/nsswitch.conf</code>ファイルを編集する。		</p></li><li class="step" title="Step 3"><p>		以下を実行する:</p><pre class="screen"><code class="prompt">root# </code> net ads join -UAdministrator%passwordUsing short domain name -- KPAKJoined 'BIGJOE' to realm 'CORP.KPAK.COM'</pre><p>		</p><p>		<a class="indexterm" name="id2620271"></a>		ドメインへの参加が不正または失敗するかは以下を実行することで検出できる:</p><pre class="screen"><code class="prompt">root# </code> net ads testjoinBIGJOE$@'s password:[2004/11/05 16:53:03, 0] utils/net_ads.c:ads_startup(186)  ads_connect: No results returnedJoin to domain is not valid</pre><p>		特定のエラーメッセージは、発生した問題のタイプに依存するため、上記と		異なるかもしれない。<em class="parameter"><code>log level</code></em>を10まであげて、		テストを再実行し、失敗の真の原因を識別するために生成したログファイルを		調べること。		</p></li><li class="step" title="Step 4"><p>		<code class="literal">nmbd</code>, <code class="literal">winbind</code>と<code class="literal">smbd</code>		デーモンをこの順番で起動する。		</p></li><li class="step" title="Step 5"><p>		この設定の動作は以下を実行することで検証できる:		<a class="indexterm" name="id2620344"></a></p><pre class="screen"><code class="prompt">root# </code> getent passwd administratoradministrator:x:1000:1013:Administrator:/home/BE/administrator:/bin/bash</pre><p>		</p></li></ol></div></div><div class="sect2" title="Winbindを使ったIDMAPデータのLDAPへの格納"><div class="titlepage"><div><div><h3 class="title"><a name="id2620366"></a>Winbindを使ったIDMAPデータのLDAPへの格納</h3></div></div></div><p>	<a class="indexterm" name="id2620375"></a>	<a class="indexterm" name="id2620382"></a>	IDMAPの情報をLDAP中に格納することは、NT4/Samba-3形式のドメインとADSドメインで	利用できる。OpenLDAPは、多くの標準準拠のLDAPサーバが使われているにもかかわらず、	この目的に多用されているLDAPサーバである。従って、このIDMAP設定を、Sun iPlanet	LDAP Server,Novell eDirectory, Microsoft ADS plus ADAMやその他で使うことは可能で	ある。	</p><p>	ADSドメインのための例は、	<a class="link" href="idmapper.html#idmapldapDMS" title="Example 14.4. LDAPを使うADSドメインメンバサーバ">LDAPを使うADSドメインメンバサーバ</a>にある。	</p><div class="example"><a name="idmapldapDMS"></a><p class="title"><b>Example 14.4. LDAPを使うADSドメインメンバサーバ</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td># グローバルパラメータ</td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2620444"></a><em class="parameter"><code>workgroup = SNOWSHOW</code></em></td></tr><tr><td><a class="indexterm" name="id2620455"></a><em class="parameter"><code>netbios name = GOODELF</code></em></td></tr><tr><td><a class="indexterm" name="id2620467"></a><em class="parameter"><code>realm = SNOWSHOW.COM</code></em></td></tr><tr><td><a class="indexterm" name="id2620479"></a><em class="parameter"><code>server string = Samba Server</code></em></td></tr><tr><td><a class="indexterm" name="id2620491"></a><em class="parameter"><code>security = ADS</code></em></td></tr><tr><td><a class="indexterm" name="id2620502"></a><em class="parameter"><code>log level = 1 ads:10 auth:10 sam:10 rpc:10</code></em></td></tr><tr><td><a class="indexterm" name="id2620514"></a><em class="parameter"><code>ldap admin dn = cn=Manager,dc=SNOWSHOW,dc=COM</code></em></td></tr><tr><td><a class="indexterm" name="id2620526"></a><em class="parameter"><code>ldap idmap suffix = ou=Idmap</code></em></td></tr><tr><td><a class="indexterm" name="id2620538"></a><em class="parameter"><code>ldap suffix = dc=SNOWSHOW,dc=COM</code></em></td></tr><tr><td><a class="indexterm" name="id2620550"></a><em class="parameter"><code>idmap backend = ldap:ldap://ldap.snowshow.com</code></em></td></tr><tr><td><a class="indexterm" name="id2620563"></a><em class="parameter"><code>idmap uid = 150000-550000</code></em></td></tr><tr><td><a class="indexterm" name="id2620574"></a><em class="parameter"><code>idmap gid = 150000-550000</code></em></td></tr><tr><td><a class="indexterm" name="id2620586"></a><em class="parameter"><code>template shell = /bin/bash</code></em></td></tr><tr><td><a class="indexterm" name="id2620598"></a><em class="parameter"><code>winbind use default domain = Yes</code></em></td></tr></table></div></div><br class="example-break"><p>	<a class="indexterm" name="id2620613"></a>	NT4またはSamba-3形式のドメインの場合、<em class="parameter"><code>realm</code></em>は使わず、	ドメインに参加するために使うコマンドは<code class="literal">net rpc join</code>である。	上記の例は、<a class="link" href="bugreport.html#dbglvl" title="デバッグレベル">バグの報告</a>に記述されている高度な	エラー報告のテクニックも示している。	</p><p>	<a class="indexterm" name="id2620649"></a>	<a class="indexterm" name="id2620656"></a>	<a class="indexterm" name="id2620663"></a>	MIT kerberosがインストールされている場合(バージョン 1.3.4以降)、以下の内容を	含むように<code class="filename">/etc/krb5.conf</code>を編集する:</p><pre class="screen">[logging] default = FILE:/var/log/krb5libs.log kdc = FILE:/var/log/krb5kdc.log admin_server = FILE:/var/log/kadmind.log[libdefaults] default_realm = SNOWSHOW.COM dns_lookup_realm = false dns_lookup_kdc = true[appdefaults] pam = {   debug = false   ticket_lifetime = 36000   renew_lifetime = 36000   forwardable = true   krb4_convert = false }</pre><p>	</p><p>	Heimdal kerberosがインストールされている場合、<code class="filename">/etc/krb5.conf</code>	ファイルは空白にするか(すなわち内容が無い)、以下の内容を含むように編集する:</p><pre class="screen">[libdefaults]        default_realm = SNOWSHOW.COM        clockskew = 300[realms]        SNOWSHOW.COM = {                kdc = ADSDC.SHOWSHOW.COM        }        [domain_realm]        .snowshow.com = SNOWSHOW.COM</pre><p>	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	Sambaは、<code class="filename">/etc/krb5.conf</code>ファイルがない時はHeimdalライブラリを	使えない。それが空白のファイルであるならば、Heimdal kerberosライブラリは使用可能	である。SambaがHeimdalライブラリを使う時には、自動的にこれを見つけることが出来る	ので、特に何も設定しなくても良い。	</p></div><p>	以下のエントリを含むようにNSS制御ファイル<code class="filename">/etc/nsswitch.conf</code>	を編集する:</p><pre class="screen">...passwd: files ldapshadow: files ldapgroup:  files ldap...hosts:  files wins...</pre><p>	</p><p>	<a class="indexterm" name="id2620761"></a>	<a class="indexterm" name="id2620768"></a>	この解決方法のためには、<a class="ulink" href="http://www.padl.com" target="_top">PADL</a>の	<code class="literal">nss_ldap</code>ツールセットが必要である。必要とされる情報を	<code class="filename">/etc/ldap.conf</code>ファイルに設定すること。以下は、	動作するファイルの例である:</p><pre class="screen">host    192.168.2.1base    dc=snowshow,dc=combinddn  cn=Manager,dc=snowshow,dc=combindpw  not24getpam_password exopnss_base_passwd ou=People,dc=snowshow,dc=com?onenss_base_shadow ou=People,dc=snowshow,dc=com?onenss_base_group  ou=Groups,dc=snowshow,dc=com?onessl     no</pre><p>	</p><p>	以下の手続きは動くようにするための設定手順である:	</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>		上記で示されたように<code class="filename">smb.conf</code>ファイルを設定する。		</p></li><li class="step" title="Step 2"><p>		上記で示されたように<code class="filename">/etc/krb5.conf</code>ファイルを作成する。		</p></li><li class="step" title="Step 3"><p>		上記で示されたように<code class="filename">/etc/nsswitch.conf</code>ファイルを設定する。		</p></li><li class="step" title="Step 4"><p>		PADL nss_ldapツールセットをダウンロードし、コンパイルし、インストールする。		上記で示されたように<code class="filename">/etc/ldap.conf</code>ファイルを設定する。		</p></li><li class="step" title="Step 5"><p>		LDAPサーバを設定し、以下のLDIFファイルで示されるような、IDMAPによって		必要とされるトップレベルのエントリをディレクトリに追加(初期化)する。</p><pre class="screen">dn: dc=snowshow,dc=comobjectClass: dcObjectobjectClass: organizationdc: snowshowo: The Greatest Snow Show in Singapore.description: Posix and Samba LDAP Identity Databasedn: cn=Manager,dc=snowshow,dc=comobjectClass: organizationalRolecn: Managerdescription: Directory Managerdn: ou=Idmap,dc=snowshow,dc=comobjectClass: organizationalUnitou: idmap</pre><p>		</p></li><li class="step" title="Step 6"><p>		Samba DMSをADSドメインに、以下のコマンドを使って参加させる:</p><pre class="screen"><code class="prompt">root# </code> net ads testjoinUsing short domain name -- SNOWSHOWJoined 'GOODELF' to realm 'SNOWSHOW.COM'</pre><p>		</p></li><li class="step" title="Step 7"><p>		以下のようにして、Sambaの<code class="filename">secrets.tdb</code>ファイルに		LDAPサーバへのアクセスパスワードを格納する:</p><pre class="screen"><code class="prompt">root# </code> smbpasswd -w not24get</pre><p>		</p></li><li class="step" title="Step 8"><p>		<code class="literal">nmbd</code>, <code class="literal">winbind</code>と<code class="literal">smbd</code>		デーモンをこの順番で起動する。		</p></li></ol></div><p>	<a class="indexterm" name="id2620981"></a>	ドメインへの参加が成功するか失敗するかを識別するため、この章の始めの方で	紹介された診断手続きに従うこと。多くの場合、失敗の理由が何も示されない	コマンドプロンプトの静かな結果によって、失敗は表示される。	</p></div><div class="sect2" title="RFC2307bis Schema拡張を使ったADSからのIDMAPとNSSに対するLDAPの使用"><div class="titlepage"><div><div><h3 class="title"><a name="id2621000"></a>RFC2307bis Schema拡張を使ったADSからのIDMAPとNSSに対するLDAPの使用</h3></div></div></div><p>	<a class="indexterm" name="id2621011"></a>	<a class="indexterm" name="id2621018"></a>	この方法はきれいなものではない。以下で提供される情報は手引きのみであり、かつ、	全くもって不確かで完全ではない。この方法は動く。数多くの巨大サイトで使用され、	耐えられるレベルのパフォーマンスを提供している。	</p><p>	<code class="filename">smb.conf</code>ファイルの例は	<a class="link" href="idmapper.html#idmaprfc2307" title="Example 14.5. NSS経由のRFC2307bisスキーマ拡張日付を使うADSドメインメンバサーバ">NSS経由のRFC2307bisスキーマ拡張日付を使うADSドメインメンバサーバ</a>	にある。	</p><div class="example"><a name="idmaprfc2307"></a><p class="title"><b>Example 14.5. NSS経由のRFC2307bisスキーマ拡張日付を使うADSドメインメンバサーバ</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td># グローバルパラメータ</td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2621089"></a><em class="parameter"><code>workgroup = BOBBY</code></em></td></tr><tr><td><a class="indexterm" name="id2621100"></a><em class="parameter"><code>realm = BOBBY.COM</code></em></td></tr><tr><td><a class="indexterm" name="id2621111"></a><em class="parameter"><code>security = ADS</code></em></td></tr><tr><td><a class="indexterm" name="id2621123"></a><em class="parameter"><code>idmap uid = 150000-550000</code></em></td></tr><tr><td><a class="indexterm" name="id2621135"></a><em class="parameter"><code>idmap gid = 150000-550000</code></em></td></tr><tr><td><a class="indexterm" name="id2621146"></a><em class="parameter"><code>template shell = /bin/bash</code></em></td></tr><tr><td><a class="indexterm" name="id2621158"></a><em class="parameter"><code>winbind cache time = 5</code></em></td></tr><tr><td><a class="indexterm" name="id2621170"></a><em class="parameter"><code>winbind use default domain = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2621182"></a><em class="parameter"><code>winbind trusted domains only = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2621195"></a><em class="parameter"><code>winbind nested groups = Yes</code></em></td></tr></table></div></div><br class="example-break"><p>	<a class="indexterm" name="id2621210"></a>	DMSは通常の手順でドメインに参加しなければならない。更に追加で、PADL nss_ldap	ツールセットのコンパイルとインストールが必要である。以下のようにしてこのツールを	構築する:</p><pre class="screen">./configure --enable-rfc2307bis --enable-schema-mappingmake install</pre><p> 	</p><p>	<a class="indexterm" name="id2621235"></a>	<code class="filename">/etc/nsswitch.conf</code>ファイル中には以下の内容が必要である:</p><pre class="screen">...passwd: files ldapshadow: files ldapgroup:  files ldap...hosts:  files wins...</pre><p>	</p><p>	<a class="indexterm" name="id2621259"></a>	<a class="indexterm" name="id2621266"></a>	<code class="filename">/etc/ldap.conf</code>も設定しなければならない。特定の説明に	ついては、PADLのドキュメントとnss_ldapのソースコードを参照のこと。	</p><p>	次のステップではADSスキーマの準備を必要とする。これは、この章の残りの部分で	簡単に説明する。	</p><div class="sect3" title="IDMAP, Active DirectoryとMicrosoftの Services for UNIX 3.5"><div class="titlepage"><div><div><h4 class="title"><a name="id2621291"></a>IDMAP, Active DirectoryとMicrosoftの Services for UNIX 3.5</h4></div></div></div><p>		<a class="indexterm" name="id2621300"></a>		Microsoft Windows Service for UNIX (SFU)バージョン3.5は、Microsoftの		Webサイト<a class="ulink" href="http://www.microsoft.com/windows/sfu/" target="_top">ダウンロード</a>		から自由にダウンロードできる。このツールをダウンロードする必要はあり、		以下のMicrosoftの手順に従ってインストールする。		</p></div><div class="sect3" title="IDMAP, Active Directory と AD4UNIX"><div class="titlepage"><div><div><h4 class="title"><a name="id2621325"></a>IDMAP, Active Directory と AD4UNIX</h4></div></div></div><p>		AD4UNIXツールの取得とインストールの手順は、		<a class="ulink" href="http://www.geekcomix.com/cgi-bin/classnotes/wiki.pl?LDAP01/An_Alternative_Approach" target="_top">		Geekcomix</a>		というWebサイトにある。		</p></div></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><code class="literal"><sup>[<a name="ftn.id2617270" href="#id2617270" class="literal">4</a>] </sup>DOMINICUS\FJones</code><code class="literal">FRANCISCUS\FJones</code><code class="literal">FJones</code></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="NetCommand.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="rights.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 13. リモートとローカル管理:Netコマンド </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 15. User Rights and Privileges</td></tr></table></div></body></html>