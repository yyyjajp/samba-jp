<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 43. 移植性</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="Appendix.html" title="Part VI. Reference Section"><link rel="prev" href="compiling.html" title="Chapter 42. Sambaのコンパイル方法"><link rel="next" href="Other-Clients.html" title="Chapter 44. Samba と他の CIFS クライアント"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 43. 移植性</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="compiling.html">Prev</a> </td><th width="60%" align="center">Part VI. Reference Section</th><td width="20%" align="right"> <a accesskey="n" href="Other-Clients.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 43. 移植性"><div class="titlepage"><div><div><h2 class="title"><a name="Portability"></a>Chapter 43. 移植性</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="Portability.html#id2714242">HPUX</a></span></dt><dt><span class="sect1"><a href="Portability.html#id2714368">SCO UNIX</a></span></dt><dt><span class="sect1"><a href="Portability.html#id2714433">DNIX</a></span></dt><dt><span class="sect1"><a href="Portability.html#id2714600">Red Hat Linux</a></span></dt><dt><span class="sect1"><a href="Portability.html#id2714656">AIX: シーケンシャル先読み</a></span></dt><dt><span class="sect1"><a href="Portability.html#id2714742">Solaris</a></span></dt><dd><dl><dt><span class="sect2"><a href="Portability.html#id2714748">ロックの改善</a></span></dt><dt><span class="sect2"><a href="Portability.html#winbind-solaris9">Solaris9上の Winbind</a></span></dt></dl></dd></dl></div><p><a class="indexterm" name="id2714217"></a><a class="indexterm" name="id2714224"></a>Samba は広い範囲のプラットフォームで機能する。しかし、すべてのプラットフォームの提供するインタフェースが常に互換性があるとは限らない。この章は Samba のコンパイルと利用についてプラットフォームに特化した情報を含む。</p><div class="sect1" title="HPUX"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2714242"></a>HPUX</h2></div></div></div><p><a class="indexterm" name="id2714250"></a><a class="indexterm" name="id2714257"></a>(歴史的な理由により)HPでは、補助グループの実装が非標準である。グループファイルには<code class="filename">/etc/group</code> と <code class="filename">/etc/logingroup</code>の2つがある。システムは、UIDから番号(訳注:GIDのことか)を前者のファイルを使用して割り当てるが、initgroups()は後者を参照する。コツを知っている大抵のシステム管理者は、シンボリックリンク<code class="filename">/etc/group</code> を <code class="filename">/etc/logingroup</code> へ張る(ここに記述することができない愚鈍な理由でハードリンクでは機能しない)。initgroups()は、<code class="filename">/etc/logingroup</code>の中で所属しているグループに不正なIDがあればエラーを出す。ここで言う不正なIDとは <code class="constant">[0..UID_MAX]</code>の範囲を超えた場合であり、HP-UX の<code class="constant">UID_MAX</code>は現在のところ60000である(訳注:HPのページで見る限り、現在は2147483647)。この範囲は、-2 と 65534 を除外している。これは通常 <code class="constant">nobody</code>のGIDである。</p><p>もしこの問題に遭遇した場合、initgroups()に失敗するプログラムを実行しているユーザが、許可された範囲外の GID のグループユーザでないことを確認すること。</p><p>このことは、HPのマニュアルページ setgroup(2)とpasswd(4)に記述されている。</p><p><a class="indexterm" name="id2714344"></a><a class="indexterm" name="id2714351"></a>HP-UXでは、gccまたはHP ANSIコンパイラを利用しなければならない。HP-UXに付属する無償のコンパイラは ANSI に準拠していないためSambaをコンパイルできない。</p></div><div class="sect1" title="SCO UNIX"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2714368"></a>SCO UNIX</h2></div></div></div><p>もし古いバージョンのSCO UNIXを稼働させているのなら、Sambaを正常に機能させるためには、TCP/IPの重要なパッチを入手する必要があるだろう。そのパッチがないと、Sambaを利用している際に転送データが破損する。</p><p>必要とするパッチは UOD385 Connection Drivers SLSである。SCO<a class="ulink" href="ftp://ftp.sco.com/" target="_top">ftp.sco.com</a> からディレクトリSLSの中にある、ファイル uod385a.Z と uod385a.ltr.Z が当該のものである。</p><p>ここで提供される情報は、SCO UNIXの古いバージョンを参照している。もしより新しいSCO UNIX のバイナリが必要ならば、インストール可能なパッケージを入手するためSCOに連絡すること。インストールするバイナリのためプラットフォームが最新であることも、SCOで確認しなければならない。これは、インストール作業にてデータ破損を避けるために重要なことである。SCO UNIX製品用にSambaをビルドする場合、 Samba のソースに大幅なパッチが必要となるかもしれない。SCO から直接バイナリパッケージを入手する方がとても容易である。</p></div><div class="sect1" title="DNIX"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2714433"></a>DNIX</h2></div></div></div><p>DNIX は seteuid() と setegid() に問題がある。これらのルーチンはSambaが正しく機能するために必要である。しかし、それらはいくつかの理由によりDNIX の Cライブラリから抜け落ちている。</p><p>この理由により、Sambaはincludes.hのDNIXセクションにて、既定値でNO_EIDマクロを定義している。この問題について、限られた方法ではなんとか機能する。しかし理想からは程遠く、いくつかの事柄はまだ正しく機能しないだろう。</p><p> この問題を正しく解決するため、以下の2つの関数をアセンブルする必要がある。そしてそれらをCライブラリに加えるか、Sambaにリンクすること。以下のコードを <code class="filename">setegid.s</code> の中に記述する。</p><pre class="programlisting">        .globl  _setegid_setegid:        moveq   #47,d0        movl    #100,a0        moveq   #1,d1        movl    4(sp),a1        trap    #9        bccs    1$        jmp     cerror1$:        clrl    d0        rts</pre><p>以下を <code class="filename">seteuid.s</code> の中に記述すること。</p><pre class="programlisting">        .globl  _seteuid_seteuid:        moveq   #47,d0        movl    #100,a0        moveq   #0,d1        movl    4(sp),a1        trap    #9        bccs    1$        jmp     cerror1$:        clrl    d0        rts</pre><p>ファイル作成後、これを以下のようにアセンブルする。</p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>as seteuid.s</code></strong><code class="prompt">$ </code><strong class="userinput"><code>as setegid.s</code></strong></pre><p>その結果、<code class="filename">seteuid.o</code> と　<code class="filename">setegid.o</code>が作成される。</p><p>次に、SambaのMakefileにて、DNIXセクションの中のLIBSM行にそれらを加える。LIBSM行は、以下のものに多少似た形になるだろう。</p><pre class="programlisting">LIBSM = setegid.o seteuid.o -ln</pre><p>次に、<code class="filename">includes.h</code> の DNIX セクションから</p><pre class="programlisting">#define NO_EID</pre><p>の行を削除する。</p></div><div class="sect1" title="Red Hat Linux"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2714600"></a>Red Hat Linux</h2></div></div></div><p>Red Hat Linuxのいくつかのバージョンでは、既定値を指定してインストールする間に、以下のようなエントリを <code class="filename">/etc/hosts</code> に追加する。</p><pre class="programlisting">127.0.0.1 loopback "hostname"."domainname"</pre><p></p><p><a class="indexterm" name="id2714630"></a>これは Samba にループバックインタフェースへループバックすることを引き起こす。結果として、 Samba は他の PC と正常に通信することに失敗する。ひいてはマスターブラウズリストの保有者とマスターブラウザが誰なのか正常にネゴシエートすることも失敗するだろう。</p><p>修正措置: 127.0.0.1 で始まる行の中で "loopback" という語の後のエントリを削除する。</p></div><div class="sect1" title="AIX: シーケンシャル先読み"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2714656"></a>AIX: シーケンシャル先読み</h2></div></div></div><p>シーケンシャル先読みを無効にすると、相対的に高度なマルチプログラミング(多数の smbd プロセスや他の負荷との混合)、充分でない物理メモリ、またはより遅いディスク技術がある場合に、Sambaの効率を著しく改善できる。これらは AIX に高いウエイト値の原因となる。シーケンシャル先読みを無効にすることは、またシステム上の他の負荷に対して反作用を及ぼすことがあるため、他のアプリケーションへのインパクトを評価する必要がある。</p><p>IBMによって提供される既定値の利用が推奨される。しかし多数のウエイトタイムを経験した場合、以下のコマンドで先読みを無効にすることを試すこと。</p><p>AIX 5.1 とそれ以前: <strong class="userinput"><code>vmtune -r 0</code></strong></p><p>AIX 5.2 とそれ以降の jfs ファイルシステム: <strong class="userinput"><code>ioo -o minpgahead=0</code></strong></p><p>AIX 5.2 とそれ以降の jfs2 ファイルシステム: <strong class="userinput"><code>ioo -o j2_minPageReadAhead=0</code></strong></p><p>もし、jfsとjfs2ファイルシステムが同一ホスト上に混合する場合、単純に双方のiooコマンドを利用する。</p></div><div class="sect1" title="Solaris"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2714742"></a>Solaris</h2></div></div></div><div class="sect2" title="ロックの改善"><div class="titlepage"><div><div><h3 class="title"><a name="id2714748"></a>ロックの改善</h3></div></div></div><p>Solaris上でSambaを稼働させて、F_SETLKW64/fcntlにまつわる問題を経験している人たちがいる。ビルトインのファイルロック機構はスケーラブルではなかった。プロセスがファイルのロックを試行するループへ入り込むまで、効率が低下するだろう。それは、ロックを試行し、失敗し、そして再び試行する。ロックする試みは、許可が与えられる前に失敗する。目に見える兆候は CPU を一握りのプロセスが占有することであり、もしもそれらが信頼されるのであれば、F_SETLKW64 のループから抜け出せなくなるだろう。</p><p>このバグを修正するために必要な最新のパッチを Sun のサポートに確認すること。Solaris 2.6 向けのパッチリビジョンは 105181-34 、Solaris 8 向けは 108528-19 、Solaris 9 向けは 112233-04 である。パッチをインストールした後、 Samba を再び構成しリビルドすることを推奨する。</p><p>この件について報告した Joe Meslovich に感謝する。</p></div><div class="sect2" title="Solaris9上の Winbind"><div class="titlepage"><div><div><h3 class="title"><a name="winbind-solaris9"></a>Solaris9上の Winbind</h3></div></div></div><p>Solaris 9 のnsswitchは、Winbind NSS モジュールの利用を拒絶する。この振る舞いは、<a class="ulink" href="http://sunsolve.sun.com/search/advsearch.do?collection=PATCH&type=collections&max=50&language=en&queryKey5=112960;rev=14&toDocument=yes" target="_top">112960-14</a>というSUNによるパッチにて修正されている。</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="compiling.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="Appendix.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="Other-Clients.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 42. Sambaのコンパイル方法 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 44. Samba と他の CIFS クライアント</td></tr></table></div></body></html>