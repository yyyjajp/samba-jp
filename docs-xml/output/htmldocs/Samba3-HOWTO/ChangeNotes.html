<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 9. Samba 3.xシリーズにおける重要で重大な変更点</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="optional.html" title="Part III. 詳細な設定方法"><link rel="next" href="NetworkBrowsing.html" title="Chapter 10. ネットワークブラウジング"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 9. Samba 3.xシリーズにおける重要で重大な変更点</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="optional.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="NetworkBrowsing.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 9. Samba 3.xシリーズにおける重要で重大な変更点"><div class="titlepage"><div><div><h2 class="title"><a name="ChangeNotes"></a>Chapter 9. Samba 3.xシリーズにおける重要で重大な変更点</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Gerald</span> <span class="othername">(Jerry)</span> <span class="surname">Carter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jerry@samba.org">jerry@samba.org</a>></code></p></div></div></div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="ChangeNotes.html#id2588288">重要な Samba-3.2.x の変更点</a></span></dt><dt><span class="sect1"><a href="ChangeNotes.html#id2588299">重要な Samba-3.0.x の変更点</a></span></dt><dd><dl><dt><span class="sect2"><a href="ChangeNotes.html#id2588376">ユーザとグループの変更</a></span></dt><dt><span class="sect2"><a href="ChangeNotes.html#id2588745">グループマッピングの基本</a></span></dt><dt><span class="sect2"><a href="ChangeNotes.html#id2588888">Passdbの変更</a></span></dt><dt><span class="sect2"><a href="ChangeNotes.html#id2588950">Samba-3.0.23でのグループマッピングの変更</a></span></dt><dt><span class="sect2"><a href="ChangeNotes.html#id2589078">Samba-3.0.23におけるLDAPの変更</a></span></dt></dl></dd></dl></div><p>Sambaをアップデートまたはアップグレードする前に、この章を注意深く読んでほしい。ここにはとても重大か、とても重要な情報のみが書いてある。包括的な変更記録とガイダンス情報は<a class="link" href="upgrading-to-3.0.html" title="Chapter 35. Sambaのアップデートとアップグレード">Sambaのアップデートとアップグレード</a>の章にある。</p><div class="sect1" title="重要な Samba-3.2.x の変更点"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2588288"></a>重要な Samba-3.2.x の変更点</h2></div></div></div><p>!!!!!!!!!!!!Add all critical update notes here!!!!!!!!!!!!!</p></div><div class="sect1" title="重要な Samba-3.0.x の変更点"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2588299"></a>重要な Samba-3.0.x の変更点</h2></div></div></div><p>以下の記述は、特にSamba 3.0.23からSamba 3.0.25c(あるいはより最新のSamba 3.0.25の更新版)に関連する。Sambaは常に変化しているプロジェクトである。3.0.xシリーズ中での変更点は、この文書中で記述されている。<a class="link" href="upgrading-to-3.0.html#oldupdatenotes" title="Samba-2.xからSamba-3.0.25へのアップグレード">Upgrading from Samba-2.x to Samba-3.0.25</a>を参照のこと。</p><p>時々、HOWTO文書の、新しい、あるいは変更された機能の影響を反映するために更新すべき部分を指示するのが難しいことがある。あるいは別の時点では、この文書を再構成することが必要であることが明白になる。</p><p>近年では、Samba のユーザも <a class="ulink" href="http://wiki.samba.org/" target="_top">Samba Wiki</a>構築の推進に加わった。新しく作成される Samba ドキュメントは、すべてここに集約される予定である。Wikiは規模の大きなコミュニティからの投稿に適していて、よりいっそう最新情報を提供できることを期待している。そのすばらしい夢が実現して、十分な価値が出てくるまでは、このHOWTO文書を維持管理することは必要である。この章では、このHOWTO文書の主要部分が再構成されるか変更される時点までの間での主要な変更点を文書化する。</p><p>この章は、Samba 3.0.23リリースでHOTWOに加わった。ここにはSambaソースコードリリース一式中に含まれる<code class="filename">WHATSNEW.txt</code>ファイル中で提供されているたくさんの注意点を含んでいる。</p><div class="sect2" title="ユーザとグループの変更"><div class="titlepage"><div><div><h3 class="title"><a name="id2588376"></a>ユーザとグループの変更</h3></div></div></div><p>マップされていないユーザとグループアカウントのみに影響する変更点はここで文書化されている。</p><p><a class="indexterm" name="id2588392"></a><a class="indexterm" name="id2588399"></a><a class="indexterm" name="id2588406"></a><a class="indexterm" name="id2588415"></a><a class="indexterm" name="id2588424"></a>ユーザとグループに対する内部管理ルーチンは割り当てられた相対識別子(RID)の重複を防ぐために書き直された。過去では、<code class="literal">net groupmap</code>コマンド又は<code class="literal">net rpc vampire</code>コマンドで<code class="literal">net rpc vampire</code>を実行してWindowsドメインをSambaドメインにマイグレートすることによって、手動でUnixグループにマッピングするときに問題が発生する可能性があった。</p><p><a class="indexterm" name="id2588469"></a><a class="indexterm" name="id2588476"></a><a class="indexterm" name="id2588482"></a><a class="indexterm" name="id2588489"></a>マップされていないユーザは、今回から<code class="literal">S-1-22-1</code>ドメイン中のSIDが割り当てられ、マップされていないグループは<code class="literal">S-1-22-2</code>ドメイン中のSIDを割り当てられる。以前はSambaサーバ上のSAM内のRIDを割り当てていた。ドメインコントローラにとって、これは、メンバサーバかスタンドアロンサーバ上のようなドメインSIDの権限の配下にあり、これはローカルSAM(<code class="literal">net getlocalsid</code>マニュアルページを参照)の権限下にあった。</p><p><a class="indexterm" name="id2588535"></a><a class="indexterm" name="id2588542"></a><a class="indexterm" name="id2588550"></a><a class="indexterm" name="id2588556"></a><a class="indexterm" name="id2588563"></a>結果は、アップグレードされたSambaドメインコントローラ上の、あるマップされていないユーザ又はグループは新しいSIDを割り当てられることになる。Windowsセキュリティ記述子中に名前というかSIDが格納されるので、これは、そのユーザがたとえば、SambaファイルサーバからローカルのWindowsクライアントNTFSパーティションにファイルがコピーされた場合、もはやリソースにアクセスできないという現象を引き起こす。Sambaサーバ上自身で格納された任意のファイルは、UNIXがUNIXのGIDを格納し、権限の検査にSIDを使わないために引き続きアクセスできる。</p><p>変更を図示するのに例題が役立つ:</p><p><a class="indexterm" name="id2588603"></a><a class="indexterm" name="id2588610"></a><a class="indexterm" name="id2588616"></a><a class="indexterm" name="id2588623"></a><span class="emphasis"><em>developers</em></span>という名前のグループがありそのUNIX GIDが782だとする。この場合、このグループはSambaのグループマップテーブル中には存在しない。このグループがACLエディタ中に現れることは全く通常通りである。Samba-3.0.23より前では、グループSIDは<code class="literal">S-1-5-21-647511796-4126122067-3123570092-2565</code>として表示される。</p><p><a class="indexterm" name="id2588654"></a><a class="indexterm" name="id2588661"></a><a class="indexterm" name="id2588667"></a><a class="indexterm" name="id2588674"></a>Samba-3.0.23のリリースから、グループSIDは<code class="literal">S-1-22-2-782</code>のように表示されるようになった。任意の、Windows NTFSパーティション上に格納されるファイルに付随するセキュリティ記述子は、ユーザが<code class="literal">S-1-5-21-647511796-4126122067-3123570092-2565</code>グループのメンバでない場合、グループパーミッションベースのアクセスを許可されない。このグループSIDが<code class="literal">S-1-22-2-782</code>で、ユーザトークン中に表示されないという理由で、たとえ両方のSIDが同じUNIXグループを参照するという観点においても、Windowsは認証に失敗する。</p><p><a class="indexterm" name="id2588714"></a><a class="indexterm" name="id2588721"></a>Samba 3.0.23より前での回避方法は、グループ<span class="emphasis"><em>developers</em></span>が<code class="literal">S-1-5-21-647511796-4126122067-3123570092-2565</code>というSIDを示すグループマップエントリを手動で作成することである。Samba-3.0.23のリリースから、この回避方法は不要になった。</p></div><div class="sect2" title="グループマッピングの基本"><div class="titlepage"><div><div><h3 class="title"><a name="id2588745"></a>グループマッピングの基本</h3></div></div></div><p>Samba 3.0.xシリーズの3.0.23より前のリリースでは、<code class="literal">Domain Admins, Domain Users, Domain Guests</code>というWindowsドメイングループに対するグループマッピングは自動的に作成された。Samba-3.0.23から、これらのマッピングはSamba管理者によって作成されなければならないようになった。これが失敗すると、正しい認証と、有効なドメインユーザの認識に失敗する結果となる。これが起きた場合、ユーザはWindowsクライアントにログオンできなくなる。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>グループマッピングは、SambaサーバがPDC/BDCとして動作している時にのみ重要である。スタンドアロンサーバはグループマッピングを必要としない。</p></div><p>以下のマッピングが必要である:</p><div class="table"><a name="TOSH-domgroups"></a><p class="title"><b>Table 9.1. 基本的なドメイングループのマッピング</b></p><div class="table-contents"><table summary="基本的なドメイングループのマッピング" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Domain Group</th><th align="center">RID</th><th align="center">UNIXグループ例</th></tr></thead><tbody><tr><td align="center">Domain Admins</td><td align="center">512</td><td align="center">root</td></tr><tr><td align="center">Domain Users</td><td align="center">513</td><td align="center">users</td></tr><tr><td align="center">Domain Guests</td><td align="center">514</td><td align="center">nobody</td></tr></tbody></table></div></div><br class="table-break"><p>POSIX(UNIX)グループがLDAP内に格納される場合、それぞれ<code class="literal">domadmins, domusers,domguests</code>と指定すると便利である(訳注:やや意訳です)。</p><p>グループマッピングに関するさらなる情報は<a class="link" href="groupmapping.html" title="Chapter 12. グループのマッピング: Microsoft Windows と UNIX">グループマッピング: Microsoft Windows と UNIX</a>を参照のこと。</p></div><div class="sect2" title="Passdbの変更"><div class="titlepage"><div><div><h3 class="title"><a name="id2588888"></a>Passdbの変更</h3></div></div></div><p><a class="indexterm" name="id2588896"></a><a class="indexterm" name="id2588903"></a><a class="indexterm" name="id2588910"></a><a class="indexterm" name="id2588916"></a>もはや<a class="link" href="smb.conf.5.html#PASSDBBACKEND" target="_top">passdb backend</a>パラメータは、複数のpassdbバックエンドを連続して設定できない。SQLとXML passdbバックエンドもSamba-3.0.23のリリースから取り除かれた。外部のSQL passdb サポートについてのより詳細な情報は<a class="ulink" href="http://pdbsql.sourceforge.net/" target="_top">pdbsql</a>ページを参照のこと。</p></div><div class="sect2" title="Samba-3.0.23でのグループマッピングの変更"><div class="titlepage"><div><div><h3 class="title"><a name="id2588950"></a>Samba-3.0.23でのグループマッピングの変更</h3></div></div></div><p><a class="indexterm" name="id2588959"></a><a class="indexterm" name="id2588966"></a><a class="indexterm" name="id2588973"></a><a class="indexterm" name="id2588980"></a><a class="indexterm" name="id2588986"></a><a class="indexterm" name="id2588994"></a><a class="indexterm" name="id2589001"></a><a class="indexterm" name="id2589007"></a><a class="indexterm" name="id2589014"></a><a class="indexterm" name="id2589021"></a><a class="indexterm" name="id2589028"></a><code class="literal">Domain Admins</code>のようなグループのための既定値のマッピングエントリはもはや<code class="literal">smbpasswd</code>ファイルか<code class="literal">tdbsam</code> passdbバックエンドを使う時に作成されない。このことは、グループマッピングを作成するためには、明示的に<code class="literal">net groupmap add</code>コマンドを実行することが必要であると言うことであり、WindowsのグループSIDをUNIXのGIDへのマッピングを作成するために、<code class="literal">net groupmap modify</code>を使うということである。この変更はドメイングループに対するwinbinddのIDMAP機能には何らの影響はない。</p></div><div class="sect2" title="Samba-3.0.23におけるLDAPの変更"><div class="titlepage"><div><div><h3 class="title"><a name="id2589078"></a>Samba-3.0.23におけるLDAPの変更</h3></div></div></div><p><a class="indexterm" name="id2589087"></a><a class="indexterm" name="id2589094"></a><a class="indexterm" name="id2589101"></a><a class="indexterm" name="id2589108"></a><a class="indexterm" name="id2589115"></a>Samba LDAPスキーマファイルに少々の変更がある。<code class="literal">sambaSID</code>属性定義にサブストリングマッチルールが追加された。OpenLDAPでは、これは、<code class="filename">slapd.conf</code>設定ファイルに<code class="literal">index sambaSID sub</code>を追加することが必要となる。実際のデータの内容については変更はない。</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="optional.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="NetworkBrowsing.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part III. 詳細な設定方法 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 10. ネットワークブラウジング</td></tr></table></div></body></html>