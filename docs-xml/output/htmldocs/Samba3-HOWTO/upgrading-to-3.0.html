<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 35. Sambaのアップデートとアップグレード</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="migration.html" title="Part IV. マイグレーションとアップグレード"><link rel="prev" href="migration.html" title="Part IV. マイグレーションとアップグレード"><link rel="next" href="NT4Migration.html" title="Chapter 36. NT4 PDC からSamba-3 PDCへの移行"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 35. Sambaのアップデートとアップグレード</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="migration.html">Prev</a> </td><th width="60%" align="center">Part IV. マイグレーションとアップグレード</th><td width="20%" align="right"> <a accesskey="n" href="NT4Migration.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 35. Sambaのアップデートとアップグレード"><div class="titlepage"><div><div><h2 class="title"><a name="upgrading-to-3.0"></a>Chapter 35. Sambaのアップデートとアップグレード</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Gerald</span> <span class="othername">(Jerry)</span> <span class="surname">Carter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jerry@samba.org">jerry@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">August 16, 2007</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="upgrading-to-3.0.html#id2699863">アップデート要求の要点</a></span></dt><dd><dl><dt><span class="sect2"><a href="upgrading-to-3.0.html#id2699908">Samba-3.0.xからSamba-3.2.0へのアップグレード</a></span></dt><dt><span class="sect2"><a href="upgrading-to-3.0.html#oldupdatenotes">Samba-2.xからSamba-3.0.25へのアップグレード</a></span></dt><dt><span class="sect2"><a href="upgrading-to-3.0.html#id2699964">お手軽移行ガイド</a></span></dt></dl></dd><dt><span class="sect1"><a href="upgrading-to-3.0.html#id2700140">Samba-3.xシリーズにおける新しい機能</a></span></dt><dd><dl><dt><span class="sect2"><a href="upgrading-to-3.0.html#id2700150">Samba-3.2.xシリーズにおける新しい機能</a></span></dt><dt><span class="sect2"><a href="upgrading-to-3.0.html#id2700162">Samba-3.0.xにおける新しい機能</a></span></dt><dt><span class="sect2"><a href="upgrading-to-3.0.html#id2701439">新しい機能</a></span></dt></dl></dd></dl></div><p>この章では、3.xシリーズのリリースの間に行われた変更の詳細な記録を提供する。この時点で、このシリーズはGNU GPLバージョン2でライセンスされる3.0.xとGNU GPLバージョン3でライセンスされる Samba 3.2.xシリーズがある。</p><div class="sect1" title="アップデート要求の要点"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2699863"></a>アップデート要求の要点</h2></div></div></div><p>Sambaは常時発展しているソフトウェアで、リリース間で明確な違いがある時もある。それらの変更点のいくつかは、公式のMicrosoftパッチとアップデートによるセキュリティか機能の更新の結果、Microsoft Windows ネットワーククライアントによって使われるプロトコルの変更の結果によってもたらされる。特に、Sambaそれ自身の内部操作に影響するものについては、Sambaはそのような変更に追従しなければならない。</p><p>使用しているSambaのバージョンに、明確に言及している、以下のどのような節をも参照してほしい。一般的に、新しいリリースに適用されるすべての変更は、それ以降のリリースにも適用される。例えば、Samba3.0.23における変更は、3.0.25を含むそのあとすべての新しいリリースに適用される。Samba 3.2.xは3.2.0固有の変更が適用される前に、Samba 3.0.25からオリジナルが分割された。3.0.xシリーズの機能が特に無効にされていないのならば、3.2.xシリーズの動作は、それ以前のパターンに沿うと推測できる。</p><div class="sect2" title="Samba-3.0.xからSamba-3.2.0へのアップグレード"><div class="titlepage"><div><div><h3 class="title"><a name="id2699908"></a>Samba-3.0.xからSamba-3.2.0へのアップグレード</h3></div></div></div><p></p></div><div class="sect2" title="Samba-2.xからSamba-3.0.25へのアップグレード"><div class="titlepage"><div><div><h3 class="title"><a name="oldupdatenotes"></a>Samba-2.xからSamba-3.0.25へのアップグレード</h3></div></div></div><p><a class="indexterm" name="id2699934"></a><a class="indexterm" name="id2699941"></a><a class="indexterm" name="id2699948"></a>この章では、主に、Samba-3.0.25とSamba-2.2.8a間での違いについて取り扱う。それは、設定パラメータが変更された点と、2.2.xから3.0.25への簡単なガイドを提供する。</p></div><div class="sect2" title="お手軽移行ガイド"><div class="titlepage"><div><div><h3 class="title"><a name="id2699964"></a>お手軽移行ガイド</h3></div></div></div><p>Samba-3.0.25の既定値の動作は、おおよそSamba-2.2.xと同じであるべきである。<code class="filename">smb.conf</code>ファイル中に新しいパラメータ<a class="link" href="smb.conf.5.html#PASSDBBACKEND" target="_top">passdb backend</a>が定義されていない場合の既定値の動作は、<a class="link" href="smb.conf.5.html#ENCRYPTPASSWORDS" target="_top">encrypt passwords = Yes</a>と<code class="filename">smbpasswd</code>データベースを使う、Samba-2.2.xの既定値の動作と同じになる。</p><p><a class="indexterm" name="id2700019"></a><a class="indexterm" name="id2700026"></a>なぜ、<span class="emphasis"><em>動作がおおよそSamba-2.2.xと同じであるべきである</em></span>と言うのか?なぜならば、Samba-3.0.25は、結果として異なったプロトコルコードパスを取るかもしれないネイティブなユニコードをサポートするような、新しいプロトコルを使うことが出来るからである。そのような環境における新しい動作は、古いものとは正確に同じではない。うれしいことに、ドメインとマシンSIDはアップグレードにおいて保存される。</p><p><a class="indexterm" name="id2700058"></a><a class="indexterm" name="id2700065"></a><a class="indexterm" name="id2700072"></a><a class="indexterm" name="id2700078"></a>もしも、Samba-2.2.xがLDAPを使っていて、LDAPデータベースを更新する時間がないならば、<code class="filename">smb.conf</code>ファイル中で<a class="link" href="smb.conf.5.html#PASSDBBACKEND" target="_top">passdb backend = ldapsam_compat</a>を指定する。その他の点に関しては、動作は多かれ少なかれ同じであるべきである。その後、Samba-3互換のLDAPバックエンドに切り替える時間があるとき、<code class="literal">pdbedit</code>を使って古いLDAPデータベースを新しいものに移行することは可能である。<a class="link" href="passdb.html#pdbeditthing" title="pdbeditツール">The <span class="emphasis"><em>pdbedit</em></span>コマンド</a>を参照のこと。</p></div></div><div class="sect1" title="Samba-3.xシリーズにおける新しい機能"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2700140"></a>Samba-3.xシリーズにおける新しい機能</h2></div></div></div><p></p><div class="sect2" title="Samba-3.2.xシリーズにおける新しい機能"><div class="titlepage"><div><div><h3 class="title"><a name="id2700150"></a>Samba-3.2.xシリーズにおける新しい機能</h3></div></div></div><p></p></div><div class="sect2" title="Samba-3.0.xにおける新しい機能"><div class="titlepage"><div><div><h3 class="title"><a name="id2700162"></a>Samba-3.0.xにおける新しい機能</h3></div></div></div><p>新機能のうち代表的なものは以下の通り:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="indexterm" name="id2700186"></a><a class="indexterm" name="id2700192"></a>	Active Directoryのサポート。このリリースはメンバサーバとしてADS realmに参加でき、	LDAP/Kerberosを使ってユーザの認証が出来る。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700209"></a><a class="indexterm" name="id2700216"></a>	ユニコードのサポート。Sambaはネットワーク上でUnicodeを使えるようになり、	マルチバイトとユニコード文字セットを扱うための、よりよい基盤を内部にもつ	ようになった。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700236"></a>	新しい認証システム。内部の認証システムはほとんど書き換えられた。変更の多くは	内部的なものであるが、新しい認証システムはとても自由に設定できる。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700255"></a>	新しい、ファイル名の短縮システム。ファイル名短縮システムは完全に書き換えられた。	内部データベースは、恒久的に短縮マップを格納する。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700273"></a>        新しい<span class="quote">“<span class="quote">net</span>”</span>コマンド。新しい<span class="quote">“<span class="quote">net</span>”</span>コマンドが追加された。	Windows中の<span class="quote">“<span class="quote">net</span>”</span>コマンドと幾分似ている。結局、たくさんある他の	ユーティリティ(たとえばsmbpasswd)を<span class="quote">“<span class="quote">net</span>”</span>中のサブコマンドで	置き換えることを計画している。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700303"></a>	Sambaはネットワーク上でNT形式のstatus32コードで通信できるようになった。	これはかなりエラーハンドリングを改善する。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700320"></a>	よりよいWindows 200x/XP印刷サポート。Active Directory中にプリンタ属性を	公開することを含む。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700336"></a><a class="indexterm" name="id2700343"></a><a class="indexterm" name="id2700350"></a>	新しい、passdbバックエンドと文字セット用の、ローダブルRPCモジュール。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700365"></a>	よりパフォーマンスを改善するために、既定値で、winbinddデーモンの二重化をサポート。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700382"></a><a class="indexterm" name="id2700388"></a><a class="indexterm" name="id2700395"></a>	Windows NT 4.0ドメインからSambaドメインへ、管理ユーザ、グループとドメインSIDの	移行サポート。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700411"></a><a class="indexterm" name="id2700418"></a>	Windows NT 4.0ドメインコントローラとの信頼関係の確立のサポート。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700432"></a><a class="indexterm" name="id2700440"></a><a class="indexterm" name="id2700448"></a>	SIDからUID/GIDマッピングをLDAPディレクトリに格納する事による、	分散Winbindアーキテクチャの新規サポート。	</p></li><li class="listitem"><p>	Samba文書構造の大規模な更新。	</p></li><li class="listitem"><p><a class="indexterm" name="id2700470"></a><a class="indexterm" name="id2700477"></a>	既定値のWindows 2003セキュリティ設定との互換を取るために、サーバと	クライアントにおけるSMB署名の完全なサポート。	</p></li></ol></div><p>さらに多くの改良がある!</p><div class="sect3" title="設定パラメータの変更"><div class="titlepage"><div><div><h4 class="title"><a name="id2700496"></a>設定パラメータの変更</h4></div></div></div><p>この節には、Samba-2.2.xシリーズからSamba-3.0.25を含むまでの<code class="filename">smb.conf</code>の変更の簡単な一覧がある。</p><p>新規、あるいは変更されたパラメータについての完全な説明は、smb.conf(5)のマニュアルページを参照のこと。</p><p>Sambaのアップデートあるいはアップグレードをするときはいつでも、Sambaの配布セットの一部である、<span class="emphasis"><em>WHATSNEW.txt</em></span>というファイルを読むことを強く推奨する。このファイルは、Sambaの<a class="ulink" href="http://www.samba.org/samba/" target="_top">webサイト</a>の、右側のカラム、Current Stable Releaseの下で、<span class="emphasis"><em>Release Notes</em></span>をクリックして入手してもよい。</p></div><div class="sect3" title="削除されたパラメータ"><div class="titlepage"><div><div><h4 class="title"><a name="id2700548"></a>削除されたパラメータ</h4></div></div></div><a class="indexterm" name="id2700554"></a><p>アルファベット順で、以下はSamba-2.2.xから3.0.35で削除されたパラメータの一覧である。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>admin log</p></li><li class="listitem"><p>alternate permissions</p></li><li class="listitem"><p>character set</p></li><li class="listitem"><p>client codepage</p></li><li class="listitem"><p>code page directory</p></li><li class="listitem"><p>coding system</p></li><li class="listitem"><p>domain admin group</p></li><li class="listitem"><p>domain guest group</p></li><li class="listitem"><p>enable rid algorithm</p></li><li class="listitem"><p>enable svcctl</p></li><li class="listitem"><p>force unknown acl user</p></li><li class="listitem"><p>hosts equiv</p></li><li class="listitem"><p>ldap filter</p></li><li class="listitem"><p>min password length</p></li><li class="listitem"><p>nt smb support</p></li><li class="listitem"><p>post script</p></li><li class="listitem"><p>printer admin</p></li><li class="listitem"><p>printer driver</p></li><li class="listitem"><p>printer driver file</p></li><li class="listitem"><p>printer driver location</p></li><li class="listitem"><p>read size</p></li><li class="listitem"><p>source environment</p></li><li class="listitem"><p>status </p></li><li class="listitem"><p>strip dot </p></li><li class="listitem"><p>total print jobs</p></li><li class="listitem"><p>unicode</p></li><li class="listitem"><p>use rhosts</p></li><li class="listitem"><p>valid chars</p></li><li class="listitem"><p>vfs options</p></li><li class="listitem"><p>winbind enable local accounts</p></li><li class="listitem"><p>winbind max idle children</p></li><li class="listitem"><p>wins partners</p></li></ul></div></div><div class="sect3" title="新しいパラメータ"><div class="titlepage"><div><div><h4 class="title"><a name="id2700722"></a>新しいパラメータ</h4></div></div></div><p>以下の新しいパラメータは、Samba 3.0.25までにリリースされたものである(機能毎にグルーピング:)</p><p>リモート管理</p><a class="indexterm" name="id2700737"></a><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>abort shutdown script</p></li><li class="listitem"><p>shutdown script</p></li></ul></div><p>ユーザとグループアカウント管理</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>add group script</p></li><li class="listitem"><p>add machine script</p></li><li class="listitem"><p>add user to group script</p></li><li class="listitem"><p>algorithmic rid base</p></li><li class="listitem"><p>delete group script</p></li><li class="listitem"><p>delete user from group script</p></li><li class="listitem"><p>passdb backend</p></li><li class="listitem"><p>rename user script</p></li><li class="listitem"><p>set primary group script</p></li><li class="listitem"><p>username map script</p></li></ul></div><p>認証</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>auth methods</p></li><li class="listitem"><p>ldap password sync</p></li><li class="listitem"><p>passdb expand explicit</p></li><li class="listitem"><p>realm</p></li></ul></div><p>プロトコルオプション</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>add port command</p></li><li class="listitem"><p>afs token lifetime</p></li><li class="listitem"><p>client lanman auth</p></li><li class="listitem"><p>client NTLMv2 auth</p></li><li class="listitem"><p>client schannel</p></li><li class="listitem"><p>client signing</p></li><li class="listitem"><p>client use spnego</p></li><li class="listitem"><p>defer sharing violations</p></li><li class="listitem"><p>disable netbios</p></li><li class="listitem"><p>dmapi support</p></li><li class="listitem"><p>enable privileges</p></li><li class="listitem"><p>use kerberos keytab</p></li><li class="listitem"><p>log nt token command</p></li><li class="listitem"><p>ntlm auth</p></li><li class="listitem"><p>paranoid server security </p></li><li class="listitem"><p>sendfile</p></li><li class="listitem"><p>server schannel</p></li><li class="listitem"><p>server signing</p></li><li class="listitem"><p>smb ports</p></li><li class="listitem"><p>svcctl list</p></li><li class="listitem"><p>use spnego</p></li></ul></div><p>ファイルサービス</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>allocation roundup size</p></li><li class="listitem"><p>acl check permissions</p></li><li class="listitem"><p>acl group control</p></li><li class="listitem"><p>acl map full control</p></li><li class="listitem"><p>aio read size</p></li><li class="listitem"><p>aio write size</p></li><li class="listitem"><p>dfree cache time</p></li><li class="listitem"><p>dfree command</p></li><li class="listitem"><p>ea support</p></li><li class="listitem"><p>enable asu support</p></li><li class="listitem"><p>fam change notify</p></li><li class="listitem"><p>force unknown acl user</p></li><li class="listitem"><p>get quota command</p></li><li class="listitem"><p>hide special files</p></li><li class="listitem"><p>hide unwriteable files</p></li><li class="listitem"><p>inherit owner</p></li><li class="listitem"><p>hostname lookups</p></li><li class="listitem"><p>kernel change notify</p></li><li class="listitem"><p>mangle prefix</p></li><li class="listitem"><p>map acl inherit</p></li><li class="listitem"><p>map read only</p></li><li class="listitem"><p>max stat cache size</p></li><li class="listitem"><p>msdfs proxy</p></li><li class="listitem"><p>open files database hash size</p></li><li class="listitem"><p>set quota command</p></li><li class="listitem"><p>store dos attributes</p></li><li class="listitem"><p>use sendfile</p></li><li class="listitem"><p>usershare allow guests</p></li><li class="listitem"><p>usershare max shares</p></li><li class="listitem"><p>usershare owner only</p></li><li class="listitem"><p>usershare path</p></li><li class="listitem"><p>usershare prefix allow list</p></li><li class="listitem"><p>usershare prefix deny list</p></li><li class="listitem"><p>usershare template share</p></li><li class="listitem"><p>vfs objects</p></li></ul></div><p>印刷</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>cups options</p></li><li class="listitem"><p>cups server</p></li><li class="listitem"><p>force printername</p></li><li class="listitem"><p>iprint server</p></li><li class="listitem"><p>max reported print jobs</p></li><li class="listitem"><p>printcap cache time</p></li></ul></div><p>ユニコードと文字セット</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>display charset</p></li><li class="listitem"><p>dos charset</p></li><li class="listitem"><p>UNIX charset</p></li></ul></div><p>SIDからUID/GIDへのマッピング</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>idmap backend</p></li><li class="listitem"><p>idmap gid</p></li><li class="listitem"><p>idmap uid</p></li><li class="listitem"><p>username map script</p></li><li class="listitem"><p>winbind nss info</p></li><li class="listitem"><p>winbind offline logon</p></li><li class="listitem"><p>winbind refresh tickets</p></li><li class="listitem"><p>winbind trusted domains only</p></li><li class="listitem"><p>template primary group</p></li></ul></div><p>LDAP</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ldap delete dn</p></li><li class="listitem"><p>ldap group suffix</p></li><li class="listitem"><p>ldap idmap suffix</p></li><li class="listitem"><p>ldap machine suffix</p></li><li class="listitem"><p>ldap passwd sync</p></li><li class="listitem"><p>ldap replication sleep</p></li><li class="listitem"><p>ldap timeout</p></li><li class="listitem"><p>ldap user suffix</p></li></ul></div><p>一般的な設定</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>eventlog list</p></li><li class="listitem"><p>preload modules</p></li><li class="listitem"><p>reset on zero vc</p></li><li class="listitem"><p>privatedir</p></li></ul></div></div><div class="sect3" title="変更されたパラメータ(動作が変わったもの)"><div class="titlepage"><div><div><h4 class="title"><a name="id2701290"></a>変更されたパラメータ(動作が変わったもの)</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>acl group control (新しい既定値は No, 廃止されるパラメータ)</p></li><li class="listitem"><p>change notify timeout (スコープが変更)</p></li><li class="listitem"><p>dos filemode (既定値で無効に)</p></li><li class="listitem"><p>dos filetimes (既定値で有効に)</p></li><li class="listitem"><p>enable asu support (既定値で無効に)</p></li><li class="listitem"><p>enable privileges (既定値で有効に)</p></li><li class="listitem"><p>encrypt passwords (既定値で有効に) </p></li><li class="listitem"><p>host msdfs (既定値で有効に)</p></li><li class="listitem"><p>mangling method (既定値でhash2を設定) </p></li><li class="listitem"><p>map to guest</p></li><li class="listitem"><p>only user (廃止)</p></li><li class="listitem"><p>passwd chat</p></li><li class="listitem"><p>passwd program</p></li><li class="listitem"><p>password server</p></li><li class="listitem"><p>restrict anonymous (整数値)</p></li><li class="listitem"><p>security (新しくadsが追加)</p></li><li class="listitem"><p>strict locking (既定値でautoに)</p></li><li class="listitem"><p>winbind cache time (5分に増加)</p></li><li class="listitem"><p>winbind enum groups (既定値で無効に)</p></li><li class="listitem"><p>winbind enum users (既定値で無効に)</p></li><li class="listitem"><p>winbind nested groups (既定値で有効に)</p></li><li class="listitem"><p>winbind uid (idmap uidのために廃止に)</p></li><li class="listitem"><p>winbind gid (idmap gidのために廃止に)</p></li><li class="listitem"><p>winbindd nss info</p></li><li class="listitem"><p>write cache (廃止)</p></li></ul></div></div></div><div class="sect2" title="新しい機能"><div class="titlepage"><div><div><h3 class="title"><a name="id2701439"></a>新しい機能</h3></div></div></div><p><a class="indexterm" name="id2701447"></a>	Samba-2.2.xシリーズからの主要な動作の変更点は、この節に記述してある。現在の	Sambaリリースのサポート期間中に行われた変更に関連する詳細情報を得るためには、	各Sambaリリースに同梱される<code class="filename">WHATSNEW.txt</code>を参照してほしい。	</p><div class="sect3" title="TDBデータファイル"><div class="titlepage"><div><div><h4 class="title"><a name="id2701470"></a>TDBデータファイル</h4></div></div></div><a class="indexterm" name="id2701477"></a><p>	<a class="link" href="install.html" title="Chapter 1. SAMBAのインストールとテスト方法">インストール、第一章</a>,	<a class="link" href="install.html#tdbdocs" title="TDBデータベースファイルの情報">第一章</a>に、Samba-3データファイルに関連する、	その配置とサーバ移行、アップデートとアップグレードにおいて保持しなければ	ならない情報があるので、参照してほしい。	</p><p><a class="indexterm" name="id2701508"></a>	Samba-3にアップグレードする前に、存在している${lock directory}/*tdbをバックアップ	する事を忘れないでほしい。もしも必要ならば、Sambaはオープンされているように	データベースをアップグレードする。Samba-3から2.2へのダウングレードか、	最新版のSamba-3より前のバージョンへの変更は、サポートされない手順である。	</p><p><a class="indexterm" name="id2701529"></a>	古いSamba-2.2.xのtdbファイルは<a class="link" href="upgrading-to-3.0.html#oldtdbfiledesc" title="Table 35.1. Samba-2.2.xのTDBファイルの説明">次のテーブル</a>	で説明されている。	</p><div class="table"><a name="oldtdbfiledesc"></a><p class="title"><b>Table 35.1. Samba-2.2.xのTDBファイルの説明</b></p><div class="table-contents"><table summary="Samba-2.2.xのTDBファイルの説明" border="1"><colgroup><col align="left"><col align="justify"><col align="left"></colgroup><thead><tr><th align="left">名前</th><th align="justify">説明</th><th align="center">バックアップ必要?</th></tr></thead><tbody><tr><td align="left">account_policy</td><td align="justify">ユーザポリシーの設定</td><td align="left">yes</td></tr><tr><td align="left">brlock</td><td align="justify">バイトレンジファイルロック情報</td><td align="left">no</td></tr><tr><td align="left">connections</td><td align="justify"><p>クライアント接続情報</p></td><td align="left">no</td></tr><tr><td align="left">locking</td><td align="justify">一時ファイルロックデータ</td><td align="left">no</td></tr><tr><td align="left">messages</td><td align="justify"><p>smbdによって生成されたメッセージの一時的な記憶場所</p></td><td align="left">no</td></tr><tr><td align="left">ntdrivers</td><td align="justify"><p>プリンタ毎のドライバ情報を格納</p></td><td align="left">yes</td></tr><tr><td align="left">ntforms</td><td align="justify"><p>プリンタ毎のフォーム情報を格納</p></td><td align="left">yes</td></tr><tr><td align="left">ntprinters</td><td align="justify"><p>プリンタ毎のdevmode設定情報を格納</p></td><td align="left">yes</td></tr><tr><td align="left">printing/*.tdb</td><td align="justify"><p>印刷サービス毎に作成されたlpqコマンドからのキャッシュされた出力</p></td><td align="left">no</td></tr><tr><td align="left">registry</td><td align="justify"><p>読み取り専用のSambaレジストリスケルトンで、winreg RPC経由で種々の			    データベーステーブルをエクスポートする機能を提供する。</p></td><td align="left">no</td></tr><tr><td align="left">sessionid</td><td align="justify"><p>その他のセッション情報のための一時的なキャッシュ。</p></td><td align="left">no</td></tr><tr><td align="left">share_info</td><td align="justify">共有のACL設定。</td><td align="left">yes</td></tr><tr><td align="left">unexpected</td><td align="justify"><p>どのプロセスもリッスンしていないパケットの受信用。</p></td><td align="left">no</td></tr><tr><td align="left">winbindd_cache</td><td align="justify"><p>NT4かADSドメインから受信した識別情報のキャッシュ。</p></td><td align="left">yes</td></tr><tr><td align="left">winbindd_idmap</td><td align="justify"><p>SIDからUNIXのUID/GIDへの新しいIDマップテーブル。</p></td><td align="left">yes</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect3" title="動作の変更点"><div class="titlepage"><div><div><h4 class="title"><a name="id2701840"></a>動作の変更点</h4></div></div></div><p>	以下の問題はSamba-2.2とSamba-3の間で、特定のインストール状態におけるSambaの動作の	変更点として知られている。	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="indexterm" name="id2701864"></a><a class="indexterm" name="id2701871"></a><a class="indexterm" name="id2701879"></a>		操作がWindowsドメインのメンバの場合、Samba-2.2は、もしもUIDがgetpwnam()		呼び出し経由で得られなかった場合、<span class="quote">“<span class="quote">guest account</span>”</span>に、リモート		DCによって認証された任意のユーザをマップする。Samba-3は、		<span class="quote">“<span class="quote">NT_STATUS_LOGON_FAILURE</span>”</span>というエラーメッセージで接続を		拒否する。Samba-2.2の動作を再度確立するための現時点での回避策はない。		</p></li><li class="listitem"><p><a class="indexterm" name="id2701907"></a><a class="indexterm" name="id2701914"></a>		Samba-2.2で制御されたドメインにマシンを追加するとき、		<span class="quote">“<span class="quote">add user script</span>”</span>はマシン信頼アカウントのUNIX識別子を		作成するのに使われる。Samba-3では新しい		<span class="quote">“<span class="quote">add machine script</span>”</span>という、この目的のために指定しなければ		ならないスクリプトを導入している。Samba-3は、		<span class="quote">“<span class="quote">add machine script</span>”</span>がない場合に、		<span class="quote">“<span class="quote">add user script</span>”</span>を使うように切り替える事はしない。		</p></li></ol></div></div><div class="sect3" title="passdbバックエンドと認証"><div class="titlepage"><div><div><h4 class="title"><a name="id2701947"></a>passdbバックエンドと認証</h4></div></div></div><p>	Samba-3に移動するときにSamba管理者が知っておくべきいくつかの新しい変更が	ある。	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="indexterm" name="id2701971"></a>		暗号化されたパスワードは、Windowsクライアントをそのまま使える事との		相互運用性を向上させるために、既定値で有効になった。これは、(a)		Sambaアカウントは各ユーザ毎に作成する必要があるか、(b)		<span class="quote">“<span class="quote">encrypt passwords = no</span>”</span>を明示的に <code class="filename">smb.conf</code>中で定義する		必要があるということである。		</p></li><li class="listitem"><p><a class="indexterm" name="id2702003"></a><a class="indexterm" name="id2702009"></a><a class="indexterm" name="id2702016"></a>		ネイティブなWindows Kerberos 5とLDAPプロトコルを使う、Active Directory		ドメインとの統合のための、新しい<a class="link" href="smb.conf.5.html#SECURITY" target="_top">security = ads</a>		オプションの包含。		</p></li></ol></div><p><a class="indexterm" name="id2702045"></a>	Samba-3は、認証方法を複数設定できる機能(<a class="link" href="smb.conf.5.html#AUTHMETHODS" target="_top">auth methods</a>)	と、アカウント格納バックエンドを複数設定できる機能(訳注:現在は無効)	(<a class="link" href="smb.conf.5.html#PASSDBBACKEND" target="_top">passdb backend</a>)がある。詳細は、<code class="filename">smb.conf</code>マニュアル	ページと<a class="link" href="passdb.html" title="Chapter 11. アカウント情報データベース">アカウント情報データベース</a>を参照して	ほしい。両方のパラメータが妥当な既定値を仮定している間、Sambaの動作を実際に	どの値が正しくさせているかを理解する必要があることはありえる。	</p><p><a class="indexterm" name="id2702101"></a><a class="indexterm" name="id2702107"></a><a class="indexterm" name="id2702114"></a>	<code class="literal">smbpasswd</code>の特定の機能は、新しい<code class="literal">smbpasswd</code>	ユーティリティ、<code class="literal">net</code>ツールと新しい<code class="literal">pdbedit</code>	ユーティリティの間で分割された。詳細は、それぞれのマニュアルページを参照のこと。	</p></div><div class="sect3" title="LDAP"><div class="titlepage"><div><div><h4 class="title"><a name="id2702152"></a>LDAP</h4></div></div></div><p>	この節では、Samba/LDAP統合に影響する新しい機能の概要を説明する。	</p><div class="sect4" title="新しいスキーマ"><div class="titlepage"><div><div><h5 class="title"><a name="id2702164"></a>新しいスキーマ</h5></div></div></div><p><a class="indexterm" name="id2702172"></a><a class="indexterm" name="id2702179"></a><a class="indexterm" name="id2702186"></a><a class="indexterm" name="id2702193"></a>		新しいオブジェクトクラス(sambaSamAccount)が古いsambaAccountを置き換える		ために導入された。この変更は、他のベンダからの属性を破壊するのを防ぐための、		属性の変更を支援する。LDIFファイルを新しいスキーマに変更するための変換		スクリプトがexamples/LDAP/convertSambaAccountにある。		</p><p>		例:<a class="indexterm" name="id2702214"></a>		</p><pre class="screen">		<code class="prompt">$ </code>ldapsearch .... -LLL -b "ou=people,dc=..." > old.ldif		<code class="prompt">$ </code>convertSambaAccount --sid <DOM SID> --input old.ldif --output new.ldif		</pre><p><a class="indexterm" name="id2702246"></a>		<DOM SID>は以下を、Samba PDC上で、rootで動かすことで入手できる。</p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>net getlocalsid <DOMAINNAME></code></strong></pre><p><a class="indexterm" name="id2702275"></a>		</p><p>		Samba-2.x下では、ドメインSIDは以下を実行することで得られる:<a class="indexterm" name="id2702288"></a></p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>smbpasswd -S <DOMAINNAME></code></strong></pre><p>		</p><p><a class="indexterm" name="id2702314"></a><a class="indexterm" name="id2702321"></a><a class="indexterm" name="id2702328"></a><a class="indexterm" name="id2702335"></a>		古い<code class="literal">sambaAccount</code>スキーマは、		<em class="parameter"><code>ldapsam_compat</code></em>passdb バックエンドを指定することで		引き続き使っても良い。しかし、sambaAccountと関連する属性はスキーマ		ファイルの歴史的セクションに移動済みで、もしも必要な場合、使う前に		コメントアウトしなければならない。<code class="literal">sambaAccount</code>		に対するSamba-2.2オブジェクトクラスの定義は、Samba-3の		<code class="filename">samba.schema</code>ファイル中では変更されていない。		</p><p>		他の新しいオブジェクトクラスとそれが使うものは以下の通り:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2702393"></a><a class="indexterm" name="id2702400"></a><a class="indexterm" name="id2702407"></a><a class="indexterm" name="id2702414"></a><a class="indexterm" name="id2702420"></a><a class="indexterm" name="id2702427"></a>			<code class="literal">sambaDomain</code> 必要に応じて			ユーザとグループのRIDを割り当てるために使われるドメイン情報。			もしもidmap UID/GIDの範囲が設定され、<span class="quote">“<span class="quote">ldapsam</span>”</span>			passdbバックエンドが選択された場合、属性は			<span class="quote">“<span class="quote">ldap suffix</span>”</span>ディレクトリエントリ中に、			自動的に追加される。			</p></li><li class="listitem"><p><a class="indexterm" name="id2702460"></a><a class="indexterm" name="id2702467"></a><a class="indexterm" name="id2702474"></a>			sambaGroupMapping は、posixGroupとWindowsのグループ/SID			との間で関連づけを行うためのオブジェクト。これらのエントリは			<span class="quote">“<span class="quote">ldap group suffix</span>”</span>中に格納され、			<span class="quote">“<span class="quote">net groupmap</span>”</span>コマンドによって管理される。			</p></li><li class="listitem"><p><a class="indexterm" name="id2702500"></a><a class="indexterm" name="id2702506"></a><a class="indexterm" name="id2702513"></a><a class="indexterm" name="id2702520"></a>			<code class="literal">sambaUNIXIdPool</code> 			<span class="quote">“<span class="quote">ldap idmap suffix</span>”</span>エントリ中に自動的に作成され、			次に有効な<span class="quote">“<span class="quote">idmap UID</span>”</span>と<span class="quote">“<span class="quote">idmap GID</span>”</span>			を格納している。			</p></li><li class="listitem"><p><a class="indexterm" name="id2702552"></a><a class="indexterm" name="id2702559"></a>			<code class="literal">sambaIdmapEntry</code> 			SIDとUNIXのUID/GID間でのマッピングを格納するオブジェクト。			これらのオブジェクトは必要に応じてidmap ldapモジュールにより			作成される。			</p></li></ul></div></div><div class="sect4" title="検索のための新しいサフィックス"><div class="titlepage"><div><div><h5 class="title"><a name="id2702585"></a>検索のための新しいサフィックス</h5></div></div></div><p><a class="indexterm" name="id2702594"></a><a class="indexterm" name="id2702600"></a><a class="indexterm" name="id2702607"></a><a class="indexterm" name="id2702614"></a><a class="indexterm" name="id2702621"></a><a class="indexterm" name="id2702628"></a><a class="indexterm" name="id2702635"></a>		以下の新しい<code class="filename">smb.conf</code>パラメータは、		<em class="parameter"><code>passdb backend = ldapsam://...</code></em>が指定された時に		特定のLDAPクエリを指示するのを支援するために追加された。		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ldap suffix          ユーザとコンピュータアカウントを検索するのに使用。</p></li><li class="listitem"><p>ldap user suffix     ユーザアカウントを格納するのに使用。</p></li><li class="listitem"><p>ldap machine suffix  マシン信頼アカウントを格納するのに使用。</p></li><li class="listitem"><p>ldap group suffix    posixGroup/sambaGroupMappingエントリの位置。</p></li><li class="listitem"><p>ldap idmap suffix    sambaIdmapEntryオブジェクトの位置。</p></li></ul></div><p><a class="indexterm" name="id2702712"></a><a class="indexterm" name="id2702718"></a>		もしも、<em class="parameter"><code>ldap suffix</code></em>が定義されていた場合、これは残りの		subsuffixパラメータに追加される。この場合、<code class="filename">smb.conf</code>中のサフィックスの		記述順序は重要である。常時、他のものよりも前に、		<em class="parameter"><code>ldap suffix</code></em>を記述すること。		</p><p>		Sambaの<code class="filename">smb.conf</code>解析の制限により、引用符でドメイン名を囲ってはいけない。		</p></div><div class="sect4" title="IdMap LDAPサポート"><div class="titlepage"><div><div><h5 class="title"><a name="id2702761"></a>IdMap LDAPサポート</h5></div></div></div><p><a class="indexterm" name="id2702769"></a>		Samba-3はidmapサブシステムにもLDAPバックエンドをサポートしている。以下の		オプションは、Sambaにidmapテーブルを、ディレクトリサーバ		<span class="emphasis"><em>onterose</em></span>の		ou=Idmap,dc=quenya,dc=org部分に格納する事を指示する。		</p><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td>...</td></tr><tr><td><a class="indexterm" name="id2702806"></a><em class="parameter"><code>idmap backend = ldap:ldap://onterose/</code></em></td></tr><tr><td><a class="indexterm" name="id2702818"></a><em class="parameter"><code>ldap idmap suffix = ou=Idmap</code></em></td></tr><tr><td><a class="indexterm" name="id2702829"></a><em class="parameter"><code>idmap uid = 40000-50000</code></em></td></tr><tr><td><a class="indexterm" name="id2702841"></a><em class="parameter"><code>idmap gid = 40000-50000</code></em></td></tr></table><p><a class="indexterm" name="id2702855"></a>		この設定では、UID/GID名前空間を複数のサーバ上で共有するWinbindの利用が		出来るようになり、Samba-2.2で存在していた、NFSとの相互運用の問題を		解決する。		</p></div></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="migration.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="migration.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="NT4Migration.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part IV. マイグレーションとアップグレード </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 36. NT4 PDC からSamba-3 PDCへの移行</td></tr></table></div></body></html>