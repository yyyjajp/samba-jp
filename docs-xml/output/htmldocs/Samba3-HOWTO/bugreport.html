<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 40. バグの報告</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="troubleshooting.html" title="Part V. トラブルシューティング"><link rel="prev" href="problems.html" title="Chapter 39. Sambaの問題の調査と解決方法"><link rel="next" href="tdb.html" title="Chapter 41. TDB ファイルの管理"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 40. バグの報告</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="problems.html">Prev</a> </td><th width="60%" align="center">Part V. トラブルシューティング</th><td width="20%" align="right"> <a accesskey="n" href="tdb.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 40. バグの報告"><div class="titlepage"><div><div><h2 class="title"><a name="bugreport"></a>Chapter 40. バグの報告</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Andrew</span> <span class="surname">Tridgell</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:tridge@samba.org">tridge@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate"> 27 June 1997 </p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="bugreport.html#id2710742">概要</a></span></dt><dt><span class="sect1"><a href="bugreport.html#id2710844">一般的な情報</a></span></dt><dt><span class="sect1"><a href="bugreport.html#dbglvl">デバッグレベル</a></span></dt><dd><dl><dt><span class="sect2"><a href="bugreport.html#id2711097">デバッグ固有の操作</a></span></dt></dl></dd><dt><span class="sect1"><a href="bugreport.html#id2711308">内部エラー</a></span></dt><dt><span class="sect1"><a href="bugreport.html#id2711475">稼働中のプロセスへのアタッチ</a></span></dt><dt><span class="sect1"><a href="bugreport.html#id2711627">パッチ</a></span></dt></dl></div><div class="sect1" title="概要"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2710742"></a>概要</h2></div></div></div><p><a class="indexterm" name="id2710750"></a><a class="indexterm" name="id2710757"></a>Sambaの<a class="ulink" href="https://bugzilla.samba.org/" target="_top">Bugzilla</a>機能を使ってバグを報告し、また、報告を投稿する前に、この章を読んでほしい。また、もしも、リリース間での変更があるかと、同様にある時点でバグ報告機能を変更したかもしれないことを調べてほしい。</p><p>自分自身で出来るだけバグを追い詰めてほしい。Sambaは、ボランティアで時間、技術、労力を提供している自主的なグループによって保守されている。問い合わせに対応しきれないメールを受け取っているので、早く修正できる形で、<span class="quote">“<span class="quote">開発者にわかりやすい</span>”</span>バグ報告を送ってもらえると、返事とバグ修正の機会が大きくなる。</p><p><a class="indexterm" name="id2710797"></a><a class="indexterm" name="id2710804"></a><a class="indexterm" name="id2710811"></a>もしも、comp.protocols.smbニュースグループか、メーリングリストに投稿した場合、それを開発者が読むと思ってはいけない。もしも、問題がバグではなくて、設定の問題だと推測したならば、手助けできる人がたくさんいるSambaメーリングリストに送った方がよい。</p><p><a class="ulink" href="http://samba.org/samba/" target="_top">http://samba.org/samba/</a>の、Samba Webページ上で便利にアクセスできる、最近のメーリングリストアーカイブを見る事を好むかもしれない。</p></div><div class="sect1" title="一般的な情報"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2710844"></a>一般的な情報</h2></div></div></div><p>バグレポートを投稿する前に、エラーに対する設定を確認する。設定を間違えているという明確なメッセージをログファイルの中でサポートする。正しい文法になっているか、設定ファイルをtestparmでチェックする。</p><p><a class="link" href="diagnosis.html" title="Chapter 38. Sambaチェックリスト">Sambaチェックリスト</a>を見てみたか?これはとても重要である。</p><p>もしも、バグレポートの中にログファイルを含めるならば、その時点でクライアント上で何をしたかということを正確に、その結果が何であるかを正確に注釈を付けること。</p></div><div class="sect1" title="デバッグレベル"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dbglvl"></a>デバッグレベル</h2></div></div></div><p>もしも、バグが、サーバとしてSambaの正しくない動作を何かしているならば(例えばファイルのオープンを断るなど)、ログファイルがとても便利に使えるだろう。現象にもよるが、ログレベル3から10の間が、適切に問題を表示するかもしれない。より大きなレベルはより詳細な結果が得られるが、とてもたくさんのディスクを消費する。</p><p><a class="indexterm" name="id2710913"></a><a class="indexterm" name="id2710919"></a>debug levelを設定するには、<code class="filename">smb.conf</code>中で<a class="link" href="smb.conf.5.html#LOGLEVEL" target="_top">log level</a>を指定する。また、特定のマシンだけログレベルを大きくし、各マシン毎に分離すると便利である。これを行うには、<code class="filename">smb.conf</code>中に以下の行を追加する:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2710960"></a><em class="parameter"><code>log level = 10</code></em></td></tr><tr><td><a class="indexterm" name="id2710972"></a><em class="parameter"><code>log file = /usr/local/samba/lib/log.%m</code></em></td></tr><tr><td><a class="indexterm" name="id2710983"></a><em class="parameter"><code>include = /usr/local/samba/lib/smb.conf.%m</code></em></td></tr></table><p>かつ、希望するコマンドを含む<code class="filename">smb.conf</code>を、新たに<code class="filename">/usr/local/samba/lib/smb.conf.<em class="replaceable"><code>machine</code></em></code>として作成する。例えば、<a class="link" href="smb.conf.5.html#LOGLEVEL" target="_top">log level</a>は便利に使えるだろう。これはまた、異なったセキュリティシステム、プロトコルレベルなどを1つのマシン上で体験することもできる。</p><p><code class="filename">smb.conf</code>のエントリ<a class="link" href="smb.conf.5.html#LOGLEVEL" target="_top">log level</a>は、古いバージョンのSambaで使われていたパラメータ<a class="link" href="smb.conf.5.html#DEBUGLEVEL" target="_top">debuglevel</a>と同義語であり、<code class="filename">smb.conf</code>ファイルの下位互換性のためにそのまま残っている。</p><p><a class="link" href="smb.conf.5.html#LOGLEVEL" target="_top">log level</a>の値を大きくすると、きわめて大量のデバッグ情報を記録することになる。多くのデバッグ作業において、この値を<code class="constant">3</code>より大きくする必要はないだろう。値を<code class="constant">10</code>にすると、ほとんどすべてのバグが記録されるが、大きなログデータ領域を準備する必要がある。</p><div class="sect2" title="デバッグ固有の操作"><div class="titlepage"><div><div><h3 class="title"><a name="id2711097"></a>デバッグ固有の操作</h3></div></div></div><p><a class="indexterm" name="id2711105"></a><a class="indexterm" name="id2711111"></a><a class="indexterm" name="id2711118"></a><a class="indexterm" name="id2711125"></a>	Samba-3.xはすべての操作に対する詳細なログが書かれるログファイル中で、	必要のない項目を外して特定の機能コンポーネントだけをデバッグ(ロギング)する	ことができる。これを行うための設定例は以下の通り:	</p><p></p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2711151"></a><em class="parameter"><code>log level = 0 tdb:3 passdb:5 auth:4 vfs:2</code></em></td></tr><tr><td><a class="indexterm" name="id2711162"></a><em class="parameter"><code>max log size = 0</code></em></td></tr><tr><td><a class="indexterm" name="id2711174"></a><em class="parameter"><code>log file = /var/log/samba/%U.%m.log</code></em></td></tr></table><p></p><p>	これは、上記で示されている値毎に各機能単位にデバッグクラス(ログレベル)を	渡すために詳細なレベルを拡張している。<em class="parameter"><code>log level</code></em>の	<code class="constant">0</code>という最初の値は、特定の機能単位に対するデバッグクラスを	除き、すべての不必要なデバッグ出力を抑止する。	<a class="link" href="bugreport.html#dbgclass" title="Table 40.1. デバッグ単位">デバッグ単位</a>の表は、Sambaが処理している各SMB	操作をとても正確に分析するのに使うことが出来るかもしれない。	</p><div class="table"><a name="dbgclass"></a><p class="title"><b>Table 40.1. デバッグ単位</b></p><div class="table-contents"><table summary="デバッグ単位" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">機能名</th><th align="center">機能名</th></tr></thead><tbody><tr><td align="center">all</td><td align="center">passdb</td></tr><tr><td align="center">tdb</td><td align="center">sam</td></tr><tr><td align="center">printdrivers</td><td align="center">auth</td></tr><tr><td align="center">lanman</td><td align="center">winbind</td></tr><tr><td align="center">smb</td><td align="center">vfs</td></tr><tr><td align="center">rpc_parse</td><td align="center">idmap</td></tr><tr><td align="center">rpc_srv</td><td align="center">quota</td></tr><tr><td align="center">rpc_cli</td><td align="center">acls</td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="sect1" title="内部エラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2711308"></a>内部エラー</h2></div></div></div><p>もしも、ログファイル中に、<span class="quote">“<span class="quote"><span class="errorname">INTERNAL ERROR</span></span>”</span>というメッセージがあったら、これはSambaが動作中に予期しないシグナルを受け取ったことを意味する。これはおそらくセグメンテーションフォルトで、多くの場合Sambaのバグである(ハードウェアの故障かシステムソフトゥエアのバグを除く)。</p><p>メッセージがsmbd由来であれば、smbが受け取った最後のSMBメッセージを詳細に説明するメッセージがおそらくあるだろう。この情報は、問題を解析するのにしばしば便利であるので、バグレポートの中に一緒に入れてほしい。</p><p>もしも可能ならば、どのように問題を再現するかについての詳細も説明してほしい。適度に詳細を記述してほしい。</p><p><a class="indexterm" name="id2711359"></a>Sambaログファイルが保存されているディレクトリの<code class="filename">corefiles</code>サブディレクトリにコアファイルが存在する場合があるかもしれない。このファイルは、バグを追跡するのに最も便利なものである。これを利用するには以下のようにする:<a class="indexterm" name="id2711378"></a><a class="indexterm" name="id2711384"></a></p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>gdb smbd core</code></strong></pre><p></p><p><a class="indexterm" name="id2711410"></a><a class="indexterm" name="id2711417"></a>smbdとcoreに対する適切なパスを追加すると、gdbはそれらを扱えることが出来る。もしもgdbを用意していないならば、<strong class="userinput"><code>dbx</code></strong>を試してみること。デバッガ内で<code class="literal">where</code>コマンドを使うと、どこで問題が発生したかのトレースが得られる。これをレポートに含める。</p><p><a class="indexterm" name="id2711447"></a>もしも、何らかのアセンブラ言語について知っているならば、どこで問題が発生したかを(もしもそれがライブラリルーチン内ならば、それを呼び出しているルーチンを逆アセンブルする)、<code class="literal">disass</code>で逆アセンブルし、そのコードの周辺を調べることで、正確にどこで現象が起きたかを調べてみる。アセンブラ言語について知らなくても、逆アセンブル結果をバグレポートに含めることは解析に役に立つ。</p></div><div class="sect1" title="稼働中のプロセスへのアタッチ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2711475"></a>稼働中のプロセスへのアタッチ</h2></div></div></div><p><a class="indexterm" name="id2711483"></a><a class="indexterm" name="id2711490"></a><a class="indexterm" name="id2711497"></a>不幸にも、いくつかのUNIX(特に最近のLinuxカーネルのいくつか)は、タスクがUIDを変えたとき(smbdはしばしばこれを行う)コアファイルの作成を抑制する。このような種類のシステムでデバッグするには、まず、<span class="application">smbstatus</span>で<em class="replaceable"><code>PID</code></em>を得、次に、<strong class="userinput"><code>gdb smbd <em class="replaceable"><code>PID</code></em></code></strong>を使って、稼働中のプロセスにアタッチしてみる。次に、<code class="literal">c</code>を使って処理を続行し、クライアントを使ってコアダンプを起こさせる。デバッガはフォルトを受け取り、どこでそれが起こったかを表示する。</p><p>時には、Samba Teamに問題を修正してもらうために、クラッシュした操作からの十分な情報をキャプチャすることを可能とさせるために、デバッグシンボルを持つSambaバイナリファイルを構築する必要がある。</p><p><code class="constant">-g</code>オプションを付けてコンパイルすると、シンボルが埋め込まれる。以下の行を、<code class="filename">smb.conf</code>ファイルのグローバルセクションに追加する:</p><pre class="screen">panic action = "/bin/sleep 90000"</pre><p>これにより任意のパニックをキャッチできる。もしも、<code class="literal">smbd</code>が固まってしまったように見えたら、sleepしているプロセスを捜す。もしも存在せず、空回りしてるように見えたら、空回りしているように見えるプロセスのPIDを調べ、以下のように入力する:</p><pre class="screen"><code class="prompt">root# </code> gdb /usr/local/samba/sbin/smbd</pre><p><a class="indexterm" name="id2711606"></a>次に、<span class="quote">“<span class="quote">attach `pid'</span>”</span>(pidは空回りしているプロセス)を行い、次にコールパス中のどこにsmbdがいるかを見るために<span class="quote">“<span class="quote">bt</span>”</span>を入力してバックトレースを取る。</p></div><div class="sect1" title="パッチ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2711627"></a>パッチ</h2></div></div></div><p><a class="indexterm" name="id2711635"></a><a class="indexterm" name="id2711642"></a>最も良い形のバグレポートは、修正を含むものである!もしも、パッチを送ってもらえるのであれば、使用しているdiffがサポートしているのであれば、<strong class="userinput"><code>diff -u</code></strong>で差分を取ってほしい。そうでない場合、<strong class="userinput"><code>diff -c4</code></strong>を使ってほしい。オリジナルのソースに対するdiffを取るようにすることと、正確にどのバージョンを使用しているかを知らせてほしい。</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="problems.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="troubleshooting.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="tdb.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 39. Sambaの問題の調査と解決方法 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 41. TDB ファイルの管理</td></tr></table></div></body></html>