<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 22. CUPS印刷環境のサポート</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="classicalprinting.html" title="Chapter 21. 旧式の印刷サポート"><link rel="next" href="VFS.html" title="Chapter 23. スタッカブルVFSモジュール"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 22. CUPS印刷環境のサポート</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="classicalprinting.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="VFS.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 22. CUPS印刷環境のサポート"><div class="titlepage"><div><div><h2 class="title"><a name="CUPS-printing"></a>Chapter 22. CUPS印刷環境のサポート</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Kurt</span> <span class="surname">Pfeifle</span></h3><div class="affiliation"><span class="orgname">Danka Deutschland GmbH <br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:kpfeifle@danka.de">kpfeifle@danka.de</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Ciprian</span> <span class="surname">Vizitiu</span></h3><span class="contrib">drawings</span> <div class="affiliation"><div class="address"><p><code class="email"><<a class="email" href="mailto:CVizitiu@gbif.org">CVizitiu@gbif.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><span class="contrib">drawings</span> <div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate"> (27 Jan 2004) </p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="CUPS-printing.html#id2649954">概要</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2649959">機能と利便性</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2650030">Overview</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2650177">基本的なCUPSサポート設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2650303">libcups.soを使ったsmbdとのリンク</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2650575">CUPSを使う簡単な<code class="filename">smb.conf</code>の設定</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2650834">より複雑なCUPS <code class="filename">smb.conf</code>設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2651229">高度な設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2651250">集中スプール対<span class="quote">“<span class="quote">ピアツーピア</span>”</span>印刷</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2651320">直接印刷機能:Windowsクライアント上のベンダドライバ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2651599">Windowsクライアントドライバのインストール</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#cups-raw"><span class="emphasis"><em>application/octet-stream</em></span>のための<span class="quote">“<span class="quote">raw</span>”</span>印刷を明示的に有効にする</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2651930">ドライバアップロード手法</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2652069">Postscriptドライバダウンロードを使う高度に賢い印刷</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#gdipost">Windows上でのGDI、UNIX上でのPostScript</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2652304">Windowsドライバ、GDIとEMF</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2652512">UNIX印刷ファイル変換とGUIの基礎</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#post-and-ghost">PostScriptとGhostscript</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2652952">Ghostscript: 非Postscriptプリンタに対するソフトウェアRIP</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2653132">PostScriptプリンタ定義(PPD)の仕様</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2653243">Windows形式のベンダPPDの使用</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2653388">非PostScriptプリンタのためにCUPSはPPDを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2653442">CUPSフィルタリングアーキテクチャ</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2653735">MIMEタイプとCUPSフィルタ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2654185">MIMEタイプ変換ルール</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2654406">フィルタリングの概要</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2654586">Prefilters</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2654785">pstops</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2654966">pstoraster</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2655281">imagetops と imagetoraster</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2655376">rasterto [プリンタ固有]</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2655602">CUPSバックエンド</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2656028"><em class="parameter"><code>cupsomatic/foomatic</code></em>の役割</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2656311">完全な図解</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2656326"><code class="filename">mime.convs</code></a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2656415"><span class="quote">“<span class="quote">Raw</span>”</span>印刷</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2656535">application/octet-stream 印刷</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2656839">非PostScriptプリンタのためのPostScriptプリンタ記述</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2657164"><span class="emphasis"><em>cupsomatic/foomatic-rip</em></span> 対 <span class="emphasis"><em>ネイティブなCUPS</em></span>印刷</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2657549">フィルタリングチェインの例</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2658023">CUPSドライバ/PPDの提供元</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2658176">インタフェーススクリプトを伴う印刷</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2658282">ネットワーク印刷(Windowsのみ)</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2658305">WindowsクライアントからNT印刷サーバへ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2658375">クライアント上でのドライバの実行</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2658453">サーバ上でのドライバの実行</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2658564">ネットワーク印刷(WindowsクライアントとUNIX/Samba印刷サーバ)</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2658585">WindowsクライアントからCUPS/Samba印刷サーバへ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2658801">Sambaによるジョブファイルの受け取りとCUPSへの引き渡し</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2658898">ネットワーク PostScript RIP</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2659014">UNIX上の、非PSプリンタのためのPPD</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2659083">Windows上の非PostScriptプリンタのためのPPD</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2659174">CUPSクライアントとしてのWindowsターミナルサーバ (WTS)</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2659195"><span class="quote">“<span class="quote">カーネルモード</span>”</span>でのプリンタドライバの実行は多くの問題を引き起こす</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2659249">Workarounds Impose Heavy Limitations</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2659270">CUPS: A <span class="quote">“<span class="quote">Magical Stone</span>”</span>?</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2659331">カーネルモードでもPostScriptドライバは大きな問題はない</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2659436">ドライバダウンロードを行うためのCUPSの設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2659466"><span class="emphasis"><em>cupsaddsmb</em></span>: 不明なユーティリティ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2659588"><code class="literal">cupsaddsmb</code>用の<code class="filename">smb.conf</code>の準備</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2659869">Windows NT/200x/XP用のCUPS<span class="quote">“<span class="quote">PostScript Driver</span>”</span></a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2660129">異なったドライバファイルの認識</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2660258">ドライバファイルの入手</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2660302">Windows NT/200x/XP用のESP Print Pro PostScriptドライバ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2660381">考慮すべき警告</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2660702">WindowsのCUPS PostScriptドライバ対Adobeドライバ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2660960">cupsaddsmbの実行(Quiet Mode)</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2661114">詳細な結果を表示するcupsaddsmbの実行</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2661265">cupsaddsmbについて理解する</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2661424">もしもcupsaddsmbが正しく終了した場合、どのように認識するか</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2661564">Samba PDCににおけるcupsaddsmb</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2661650">cupsaddsmbフローチャート</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2661734">クライアント上でのPostScriptドライバのインストール</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#cups-avoidps1">クライアント上での危険なPostScriptドライバ設定を防止する</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2662061">rpcclientを使ったPostScriptドライバファイルの手動インストール</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2662258">rpcclientマニュアルページのチェック</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2662449">rpcclientマニュアルページの理解</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2662650">Producing an Example by Querying a Windows Box</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2662807">adddriverとsetdriverを完了させるための要求事項</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2663103">15ステップでの手動ドライバインストール</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2664171">トラブルシューティング再考</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2664333">印刷関連の<code class="filename">*.tdb</code>ファイル</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2664540">Trivial Database Files</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2664613">バイナリ形式</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2664687"><code class="filename">*.tdb</code>ファイルの喪失</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2664740"><code class="literal">tdbbackup</code>の使用</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2664863">Linuxprinting.orgからのCUPSプリントドライバ</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2665058">foomatic-rip と Foomaticの説明</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2666149">foomatic-ripとFoomatic PPDのダウンロードとインストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2666703">CUPSによるページの課金</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2666751">Quotasの設定</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2666810">正しいあるいは不正な課金</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2666867">Windowsクライアント用のAdobeとCUPS PostScriptドライバ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2667028">page_logファイルの形式</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2667182">存在する欠点</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2667266">将来の構想</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2667311">他のアカウントツール</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2667329">追加の材料</a></span></dt><dt><span class="sect1"><a href="CUPS-printing.html#id2667591">CUPSスプールフィルタの自動削除または保存</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2667674">CUPS構成の設定の説明</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2667774">準備</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2667917">手動の設定</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2667967">Windowsに接続された印刷へのCUPSからの印刷</a></span></dt><dt><span class="sect1"><a href="CUPS-printing.html#id2668299">より詳細なCUPSフィルタリングチェーン</a></span></dt><dt><span class="sect1"><a href="CUPS-printing.html#id2668414">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="CUPS-printing.html#id2668420">Windows 9x/Meクライアントがドライバをインストール出来ない</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#root-ask-loop"><span class="quote">“<span class="quote">cupsaddsmb</span>”</span>が、無限にrootパスワードを問い合わせてくる</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668505"><span class="quote">“<span class="quote">cupsaddsmb</span>”</span>か<span class="quote">“<span class="quote">rpcclient addriver</span>”</span>がエラーを出す</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668545"><span class="quote">“<span class="quote">cupsaddsmb</span>”</span>のエラー</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668626">クライアントがSambaプリンタに接続できない</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668652">Windows 200x/Xpからの新しいアカウント再接続のトラブル</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668764">間違ったユーザでSambaサーバに接続されるのを防ぐ</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668821">AdobeドライバからCUPSドライバにアップグレードする</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668868">PDCであるSambaサーバ上で<span class="quote">“<span class="quote">cupsaddsmb</span>”</span>が使えない</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668907">削除されたWindows 200xプリンタドライバが引き続き表示されている</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668952">Windows 200x/XP ローカルセキュリティポリシー</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2668990">Administratorはすべてのローカルユーザに対してプリンタをインストールできない</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2669042">NTクライアント上での印刷の変更、機能の通知</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2669071">Windows XP SP1</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2669124">Windows 200x/XP上ですべてのユーザが印刷オプションを設定出来ない</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2669430">Windowsクライアント上でのドライバ設定における、多くに共通する失敗</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2669491"><code class="literal">cupsaddsmb</code>が、新しくインストールしたプリンタで動かない</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2669543"><code class="filename">/var/spool/samba/</code>のアクセス許可が、再起動後毎回リセットされる</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2669647"><span class="quote">“<span class="quote">lp</span>”</span>という名前の印刷キューが印刷ジョブを間違って扱ってしまう</a></span></dt><dt><span class="sect2"><a href="CUPS-printing.html#id2669733"><span class="quote">“<span class="quote">cupsaddsmb</span>”</span>に対するAdobe PostScriptドライバファイルの位置</a></span></dt></dl></dd><dt><span class="sect1"><a href="CUPS-printing.html#id2669789">CUPS印刷プロセスの概要</a></span></dt></dl></div><div class="sect1" title="概要"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2649954"></a>概要</h2></div></div></div><div class="sect2" title="機能と利便性"><div class="titlepage"><div><div><h3 class="title"><a name="id2649959"></a>機能と利便性</h3></div></div></div><p><a class="indexterm" name="id2649967"></a>		共通UNIX印刷システム(<a class="ulink" href="http://www.cups.org/" target="_top">CUPS</a>)は		現在非常に一般的になってきている。すべての主要なLinuxディストリビューションは		現在既定値の印刷システムとしてこれと導入している。ただ、残念ながら、これは		まだ非常に取っつきづらいツールである。ほとんどの場合、これはちゃんと動く。		多くの人は、これが動いている間は、その中身を覗きたくなく、それを		<span class="quote">“<span class="quote">ブラックボックス</span>”</span>として扱う傾向がある。しかし、ひとたび		小さな問題が発生すると、どこからデバッグしていいかということを見つける		困難が生じる。CUPSに関連したより多量の情報もある、		<a class="link" href="classicalprinting.html" title="Chapter 21. 旧式の印刷サポート">旧式の印刷サポート</a>も参照のこと。		</p><p><a class="indexterm" name="id2650011"></a>		CUPSは固有で強力な機能を持っている。その基本機能は容易に把握でき、		かつそれらは新しい。これは他のものと違い、より現代的な印刷システムであり、		この新しいシステムで印刷することに関する以前の知識を適用しないことが最も良い。		むしろ、最初からCUPSを理解することをすべきである。この文書はCUPSの完全な理解		を手助けする。まず基本的な点から最初に始めよう。		</p></div><div class="sect2" title="Overview"><div class="titlepage"><div><div><h3 class="title"><a name="id2650030"></a>Overview</h3></div></div></div><p><a class="indexterm" name="id2650038"></a><a class="indexterm" name="id2650045"></a><a class="indexterm" name="id2650052"></a><a class="indexterm" name="id2650059"></a><a class="indexterm" name="id2650066"></a><a class="indexterm" name="id2650075"></a><a class="indexterm" name="id2650085"></a><a class="indexterm" name="id2650092"></a>	CUPSは印刷スプールシステムというもの以上である。これは、新しいインターネット印刷	プロトコル(IPP)に従う完全な印刷管理システムである。IPPは産業製品であり、	ネットワーク印刷に関するInternet Engineering Task Force (IETF)標準である。	この機能の多くはWebブラウザ(CUPS印刷サーバにアクセスするプラットフォーム非依存の	アクセスを提供する)経由でリモート(またはローカル)から管理することが出来る。さらに	追加で、伝統的なコマンド行といくつかのより新しいGUIインタフェースを持っている	(GUIインタフェースはサードパーティによって開発され、たとえば、KDEのoverwhelming	<a class="ulink" href="http://printing.kde.org/" target="_top">KDEPrint</a>などである)。	</p><p><a class="indexterm" name="id2650135"></a><a class="indexterm" name="id2650142"></a>	CUPSは、<span class="emphasis"><em>smart</em></span>プリンタ(すなわち、CUPSがプリンタに対して要求	された時にファイル形式の変換を行う)と同じように、<span class="emphasis"><em>raw</em></span>プリンタ	すなわち、印刷ファイル形式を変換しない)の作成が出来る。多くの手段で、Microsoft Windows	印刷関しシステム同じような機能がCUPSにはある。もちろん、CUPSの推進者ならば、	CUPSの方がもっと良いと言うだろう!多くの場合、Samba経由でMicrosoft Windows印刷	クライアントとの間でCUPSがインタフェースを取るための設定方法を説明しよう。	</p></div></div><div class="sect1" title="基本的なCUPSサポート設定"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2650177"></a>基本的なCUPSサポート設定</h2></div></div></div><p><a class="indexterm" name="id2650185"></a><a class="indexterm" name="id2650192"></a><a class="indexterm" name="id2650199"></a><a class="indexterm" name="id2650206"></a><a class="indexterm" name="id2650213"></a>Samba-3.0(2.2.xから使える)でのCUPSを使った印刷環境の、最も基本的な<code class="filename">smb.conf</code>のセットアップは<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = cups</a>と<a class="link" href="smb.conf.5.html#PRINTCAP" target="_top">printcap = cups</a>という2つのパラメータを必要とする。CUPSはprintcapファイルを必要としない。しかし、<code class="filename">cupsd.conf</code>設定ファイルは、サードパーティアプリケーション(例えば<em class="parameter"><code>Printcap /etc/printcap</code></em>と<em class="parameter"><code>PrintcapFormat BSD</code></em>)に便利なように、どのように、CUPSによって自動的に作成され、管理されるファイルを制御する2つの関連するディレクトリを知っている。旧式のプログラムはしばしばprintcapファイルに含まれているプリンタ名が存在することを要求するので、そうでないと印刷を拒否してしまう。CUPSがprintcapファイルを作成して管理するようにしておくこと。詳細は、<code class="literal">man cupsd.conf</code>と、<a class="ulink" href="http://localhost:631/documentation.html" target="_top">CUPS</a>Webサイトにある、CUPSサーバそれ自身が提供する、関連する貴重な文書のようなCUPS関連の文書を参照のこと。	</p><div class="sect2" title="libcups.soを使ったsmbdとのリンク"><div class="titlepage"><div><div><h3 class="title"><a name="id2650303"></a>libcups.soを使ったsmbdとのリンク</h3></div></div></div><p><a class="indexterm" name="id2650312"></a>	SambaはCUPSと特別な関係がある。SambaはCUPSライブラリサポート機能を有効にして	コンパイルできる。最も最新のバージョンでは、このサポートを有効にしている。	既定値では、CUPSはsmbdとその他のSambaバイナリにリンクされる。もちろん、	<code class="filename">libcups.so</code>をSambaにリンクしなくてもCUPSを使う事が	できるが、要求されるあるいはサポートされる設定にいくつかの違いがある。	</p><p><a class="indexterm" name="id2650341"></a><a class="indexterm" name="id2650348"></a>	Sambaが<code class="filename">libcups</code>とリンクされ、コンパイルされた時、	<a class="link" href="smb.conf.5.html#PRINTCAP" target="_top">printcap = cups</a>は、プリンタ一覧の表示、	ジョブの投稿、キューの問い合わせなどにCUPS APIを使う。それ以外は、印刷のために、	これらの操作を、<code class="literal">-oraw</code>オプションを付加して、System Vの	コマンドにマップする。Linuxシステムでは、smbdが、libcupsライブラリにリンク	されているかを、<code class="literal">ldd</code>ユーティリティを使う事で知ることが出来る	(<code class="literal">ldd</code>は他のOSプラットフォーム上には無いかもしれないか、	その機能は別のコマンドによって行われるかもしれない):</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>ldd `which smbd`</code></strong>libssl.so.0.9.6 => /usr/lib/libssl.so.0.9.6 (0x4002d000)libcrypto.so.0.9.6 => /usr/lib/libcrypto.so.0.9.6 (0x4005a000)libcups.so.2 => /usr/lib/libcups.so.2 (0x40123000)[....]</pre><p>	</p><p><a class="indexterm" name="id2650423"></a>	<code class="computeroutput">libcups.so.2 => /usr/lib/libcups.so.2 (0x40123000)</code>	行は、このバージョンのSambaがCUPSサポートするようにコンパイルされていることを	示している。もしもこの場合で、printing = cupsが設定されている場合、	<span class="emphasis"><em>他の<code class="filename">smb.conf</code>中にある、手動で設定した印刷関係のコマンドは無視される</em></span>。	これは重要な点なので覚えておくこと!	</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>何らかの理由で、固有の印刷コマンドを設定するために、	<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = sysv</a>を設定することにより、これを行える	ようにする事が必要である。しかし、CUPSとSambaを密に統合する利便性のすべてを	失うことになる。これを行う場合、以下のように、印刷システムコマンドを手動で設定しなければ	ならない。	(最も重要: 	<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command</a>; other commands are	<a class="link" href="smb.conf.5.html#LPPAUSECOMMAND" target="_top">lppause command</a>,	<a class="link" href="smb.conf.5.html#LPRESUMECOMMAND" target="_top">lpresume command</a>,	<a class="link" href="smb.conf.5.html#LPQCOMMAND" target="_top">lpq command</a>,	<a class="link" href="smb.conf.5.html#LPRMCOMMAND" target="_top">lprm command</a>,	<a class="link" href="smb.conf.5.html#QUEUEPAUSECOMMAND" target="_top">queuepause command</a> and	<a class="link" href="smb.conf.5.html#QUEUERESUMECOMMAND" target="_top">queue resume command</a>).	</p></div></div><div class="sect2" title="CUPSを使う簡単なsmb.confの設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2650575"></a>CUPSを使う簡単な<code class="filename">smb.conf</code>の設定</h3></div></div></div><p>	<a class="link" href="CUPS-printing.html#cups-exam-simple" title="Example 22.1. 最も簡単な印刷関連のsmb.confファイル">最も簡単な印刷関連の<code class="filename">smb.conf</code>ファイル</a>	に、基本的なCUPSサポートを有効にする、最も簡単な印刷関連の<code class="filename">smb.conf</code>設定を	要約する:	</p><div class="example"><a name="cups-exam-simple"></a><p class="title"><b>Example 22.1. 最も簡単な印刷関連のsmb.confファイル</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2650638"></a><em class="parameter"><code>load printers = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2650649"></a><em class="parameter"><code>printing = cups</code></em></td></tr><tr><td><a class="indexterm" name="id2650660"></a><em class="parameter"><code>printcap name = cups</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[printers]</code></em></td></tr><tr><td><a class="indexterm" name="id2650681"></a><em class="parameter"><code>comment = All Printers</code></em></td></tr><tr><td><a class="indexterm" name="id2650693"></a><em class="parameter"><code>path = /var/spool/samba</code></em></td></tr><tr><td><a class="indexterm" name="id2650705"></a><em class="parameter"><code>browseable = no</code></em></td></tr><tr><td><a class="indexterm" name="id2650716"></a><em class="parameter"><code>guest ok = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2650728"></a><em class="parameter"><code>writable = no</code></em></td></tr><tr><td><a class="indexterm" name="id2650740"></a><em class="parameter"><code>printable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2650751"></a><em class="parameter"><code>printer admin = root, @ntadmins, @smbprintadm</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2650767"></a><a class="indexterm" name="id2650774"></a><a class="indexterm" name="id2650780"></a>	これはCUPSに対する基本的な印刷設定に必要なもののすべてである。Windowsクライアント	から投稿されたすべてのグラフィック、PDFとPostscriptファイルは印刷できる。	しかし、ほとんどのWindowsユーザは、GUIアプリケーションを開かないで、印刷する	ファイルの種類を送る方法を知らない。Windowsクライアントはインストールされた	ローカルのプリンタドライバを持つ傾向があり、GUIアプリケーションの印刷ボタンは、	プリンタドライバを開始する。ユーザは滅多にコマンド行からファイルを送らない。	UNIXクライアントとは違い、グラフィック、テキストあるいはPDFファイルを直接	スプーラに送らない。通常、アプリケーションのネイティブな形式と印刷データ	ストリームの間でホックされた<span class="quote">“<span class="quote">printer driver</span>”</span>を使うGUI	アプリケーションから排他的に印刷を行う。もしもバックエンドプリンタが	Postscriptデバイスでない場合、印刷データストリームは<span class="quote">“<span class="quote">バイナリ</span>”</span>で、	対象のプリンタのみが対象である。この問題が引き起こすこととそれを防ぐことを	学ぶために、この先を読み続けること。	</p></div><div class="sect2" title="より複雑なCUPS smb.conf設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2650834"></a>より複雑なCUPS <code class="filename">smb.conf</code>設定</h3></div></div></div><p>	<a class="link" href="CUPS-printing.html#overridesettings" title="Example 22.2. 1台のプリンタ用にグローバルなCUPS設定を上書きする">1台のプリンタ用にグローバルなCUPS設定を上書きする例</a> 	は、<code class="filename">smb.conf</code>用の、やや複雑な印刷関連設定である。これはすべてのプリンタに対して	一般的なCUPS印刷サポートを有効にするが、1台だけ設定が異なるプリンタ共有を定義する。	</p><div class="example"><a name="overridesettings"></a><p class="title"><b>Example 22.2. 1台のプリンタ用にグローバルなCUPS設定を上書きする</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2650895"></a><em class="parameter"><code>printing = cups</code></em></td></tr><tr><td><a class="indexterm" name="id2650906"></a><em class="parameter"><code>printcap name = cups</code></em></td></tr><tr><td><a class="indexterm" name="id2650918"></a><em class="parameter"><code>load printers = yes</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[printers]</code></em></td></tr><tr><td><a class="indexterm" name="id2650939"></a><em class="parameter"><code>comment = All Printers</code></em></td></tr><tr><td><a class="indexterm" name="id2650950"></a><em class="parameter"><code>path = /var/spool/samba</code></em></td></tr><tr><td><a class="indexterm" name="id2650962"></a><em class="parameter"><code>guest ok = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2650974"></a><em class="parameter"><code>writable = no</code></em></td></tr><tr><td><a class="indexterm" name="id2650985"></a><em class="parameter"><code>printable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2650997"></a><em class="parameter"><code>printer admin = root, @ntadmins, @smbprintadm</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[special_printer]</code></em></td></tr><tr><td><a class="indexterm" name="id2651018"></a><em class="parameter"><code>comment = A special printer with his own settings</code></em></td></tr><tr><td><a class="indexterm" name="id2651030"></a><em class="parameter"><code>path = /var/spool/samba-special</code></em></td></tr><tr><td><a class="indexterm" name="id2651042"></a><em class="parameter"><code>printing = sysv</code></em></td></tr><tr><td><a class="indexterm" name="id2651054"></a><em class="parameter"><code>printcap = lpstat</code></em></td></tr><tr><td><a class="indexterm" name="id2651066"></a><em class="parameter"><code>print command = echo "NEW: `date`: printfile %f" >> /tmp/smbprn.log ; echo "     `date`: p-%p s-%s f-%f" >> /tmp/smbprn.log ; echo "     `date`: j-%j J-%J z-%z c-%c" >> /tmp/smbprn.log ; rm %f </code></em></td></tr><tr><td><a class="indexterm" name="id2651082"></a><em class="parameter"><code>guest ok = no</code></em></td></tr><tr><td><a class="indexterm" name="id2651094"></a><em class="parameter"><code>writable = no</code></em></td></tr><tr><td><a class="indexterm" name="id2651105"></a><em class="parameter"><code>printable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2651117"></a><em class="parameter"><code>printer admin = kurt</code></em></td></tr><tr><td><a class="indexterm" name="id2651129"></a><em class="parameter"><code>hosts deny = 0.0.0.0</code></em></td></tr><tr><td><a class="indexterm" name="id2651141"></a><em class="parameter"><code>hosts allow = turbo_xp, 10.160.50.23, 10.160.51.60</code></em></td></tr></table></div></div><br class="example-break"><p>	この特別な共有は、テスト目的専用である。これは印刷ジョブをファイルに書かない。	これは、ジョブパラメータをSambaが認識する<code class="filename">/tmp/smbprn.log</code>	ファイルに記録し、ジョブファイルを削除する。さらに、この共有の	<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>は<span class="quote">“<span class="quote">kurt</span>”</span>で	(<span class="quote">“<span class="quote">@ntadmins</span>”</span>グループではなくて)、ゲストアクセスは許可されず、共有は	ネットワークコンピュータに公開されず(そのため、これが共有であることを知っておく	必要がある)、3つのホストのみからアクセスできる。その共有に対して、CUPSが起動し、	印刷ジョブ上で通信をすることを防ぐために、	<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = sysv</a>と	<a class="link" href="smb.conf.5.html#PRINTCAP" target="_top">printcap = lpstat</a>を設定する必要がある。	</p></div></div><div class="sect1" title="高度な設定"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2651229"></a>高度な設定</h2></div></div></div><p>	すべての設定オプションを確認する前に、いくつかの点について明確にする。	<span class="emphasis"><em>ネットワーク印刷は、きちんと計画されて、正しくセットアップされている	必要がある</em></span>。このことは頻繁には発生しない。旧来のシステムや	小さな業務用LAN環境では、しばしばデザインと良い保守が存在していない。	</p><div class="sect2" title="集中スプール対“ピアツーピア”印刷"><div class="titlepage"><div><div><h3 class="title"><a name="id2651250"></a>集中スプール対<span class="quote">“<span class="quote">ピアツーピア</span>”</span>印刷</h3></div></div></div><p><a class="indexterm" name="id2651262"></a>	<a class="indexterm" name="id2651269"></a>	<a class="indexterm" name="id2651278"></a>	多くの小規模オフィスや家庭用ネットワークでは、計画がひどい、より大きな環境と	同じように、各クライアントがネットワークプリンタへ直接アクセス出来るように	なっている。これは一般的には悪いアイデアである。他のクライアントのジョブが	印刷しているときに、あるクライアントのアクセスを頻繁にブロックしてしまう。	ジョブが終了するのを待っている間、最初のクライアントのアプリケーションは	フリーズしてしまうかもしれない。同様に、数多くのジョブが印刷しているとき、	それぞれが異なったページをまぜこぜにしてしまうという苦情もしばしば聞く。	よりよいコンセプトは、プリントサーバを使うことである。これは、すべてのジョブを	集中したシステムに一本化し、即時に反応し、複数の並列したクライアントから	ジョブを受け取り、正しい順序でプリンタに転送する。	</p></div><div class="sect2" title="直接印刷機能:Windowsクライアント上のベンダドライバ"><div class="titlepage"><div><div><h3 class="title"><a name="id2651320"></a>直接印刷機能:Windowsクライアント上のベンダドライバ</h3></div></div></div><p>	<a class="indexterm" name="id2651329"></a>	<a class="indexterm" name="id2651336"></a>	ほとんどの現代的に設定されたUNIX印刷サーバは、本当に単純なセットアップを意味する、	SambaのWindowsクライアントのために振る舞う。それらの唯一の業務は、Sambaによって	すべてのジョブが扱われる<span class="quote">“<span class="quote">直接</span>”</span>スプーリングを管理することである。	この試みは、Windowsクライアントが、印刷デバイスに送られる準備が出来た印刷ジョブ	ファイルを準備することが期待されるということである。この場合、ネイティブな	(ベンダが供給した)Windowsプリンタドライバは、各、およびすべてのクライアントで、	対象デバイスのものをインストールする必要がある。	</p><p><a class="indexterm" name="id2651374"></a><a class="indexterm" name="id2651381"></a>	同様に現代的な、簡単な方法で、CUPS、SambaとWindowsクライアントを設定することは	可能である。CUPSプリンタが直接印刷モード状態で設定されているならば、完全に	印刷ジョブ(ファイル)を描画することは、Sambaクライアントの責任である。ファイルは	プリンタに直接配信するのに適した形式で送られる必要がある。クライアントはこれを	行うために、ベンダが提供したドライバを動作させる必要がある。この場合、CUPSは	何ら印刷ファイル形式変換を行わない。	</p><p>	可能な、最も簡単な印刷設定は、直接印刷(raw print-through)である。これは、	Windowsクライアントに物理的に結合されているようにプリンタをインストールする	事によって行える。次に、それをrawネットワーク印刷キューにリダイレクトする。	この手続きは、以下の手順によって行えるだろう:	</p><div class="procedure" title="Procedure 22.1. 直接CUPS印刷サポートのための設定手順"><a name="id2651423"></a><p class="title"><b>Procedure 22.1. 直接CUPS印刷サポートのための設定手順</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p><a class="indexterm" name="id2651435"></a>		<code class="filename">/etc/cups/mime.types</code>の、ファイルの最後あたりにある		下記の行のコメントを外す: </p><pre class="screen">#application/octet-...</pre><p>		</p></li><li class="step" title="Step 2"><p><a class="indexterm" name="id2651463"></a>		<code class="filename">/etc/cups/mime.convs</code>に対しても同様に行う。		</p></li><li class="step" title="Step 3"><p>		Webインタフェースを使ってrawプリンタを追加する。ブラウザで		<code class="constant">http://localhost:631</code>をクリックする。		Administrationに入り、プロンプトに従ってプリンタを追加する。		ドライバをこれにインストールしてはならない。Rawを選択する。		<code class="constant">Raw Queue</code>というキュー名を選択する。		</p></li><li class="step" title="Step 4"><p>		<code class="filename">smb.conf</code>ファイル中の<code class="constant">[printers]</code>セクションに		<a class="link" href="smb.conf.5.html#USECLIENTDRIVER" target="_top">use client driver = Yes</a>を追加し、		<code class="constant">[global]</code>セクション中に、		<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = CUPS</a>と		<a class="link" href="smb.conf.5.html#PRINTCAP" target="_top">printcap = CUPS</a>を追加する。		</p></li><li class="step" title="Step 5"><p>		ローカルプリンタのようにプリンタをインストールし、結果、印刷先が		<code class="constant">LPT1:</code>となる。		</p></li><li class="step" title="Step 6"><p>		<span class="guimenu">Detail</span>タブ下の設定を編集し、上記で設定したrawプリンタ		キューを指し示す<code class="constant">local port</code>を作成する。例:		<code class="constant">\\server\raw_q</code>。ここで、<code class="constant">raw_q</code>		という名前はCUPS環境中で印刷キューに割り当てた名前である。		</p></li></ol></div></div><div class="sect2" title="Windowsクライアントドライバのインストール"><div class="titlepage"><div><div><h3 class="title"><a name="id2651599"></a>Windowsクライアントドライバのインストール</h3></div></div></div><p>	Windowsクライアント上のプリンタドライバは2つの機能的に異なった方法でインストール	できる:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>手動で各クライアント上にドライバを1つずつインストールする。	これは旧式のLanMan形式印刷環境を必要とし、	<code class="filename">\\sambaserver\printershare</code>タイプの接続を使う。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2651633"></a>	プリントサーバ(Samba)上でドライバ(後でダウンロードするための)の準備と配信を	行う。これは、プリンタに最初にアクセスするとき、半自動的にドライバを入手して	インストールする<span class="quote">“<span class="quote">ポイントアンドプリント</span>”</span>をクライアントが使う	ことが出来るようになる。この方法を使うと、NT/200x/XPクライアントは、	<span class="emphasis"><em>SPOOLSS/MS-RPC</em></span>タイプの印刷呼び出しを使う。	</p></li></ul></div><p>	二番目の方法は、管理コストの削減と、偶然異なったバージョンのドライバが使われる	ことを防ぐのに、最初のものを使うよりも推奨される。	</p></div><div class="sect2" title="application/octet-streamのための“raw”印刷を明示的に有効にする"><div class="titlepage"><div><div><h3 class="title"><a name="cups-raw"></a><span class="emphasis"><em>application/octet-stream</em></span>のための<span class="quote">“<span class="quote">raw</span>”</span>印刷を明示的に有効にする</h3></div></div></div><p>	<a class="indexterm" name="id2651690"></a>	<a class="indexterm" name="id2651697"></a>	<a class="indexterm" name="id2651704"></a>	もしも最初のオプション(ドライバはクライアントサイド上でインストールされる)を使う	場合、注意すべき設定が1つある:CUPSに対して、手の込んだ(バイナリ)ファイル形式	である<span class="quote">“<span class="quote">raw</span>”</span>印刷を許可するように設定する。rawモード印刷を動かす	ための、正しい設定する必要があるCUPSファイルは以下の通り:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">/etc/cups/mime.types</code></p></li><li class="listitem"><p><code class="filename">/etc/cups/mime.convs</code></p></li></ul></div><p>	両者はRAMモード操作を許可するためにコメントアウトしなければならないエントリ	(それぞれのファイルの最後の部分)を含む。<code class="filename">/etc/cups/mime.types</code>	中では下記の行が存在するようにする:</p><pre class="programlisting">application/octet-stream</pre><p>	<a class="indexterm" name="id2651770"></a>	<a class="indexterm" name="id2651777"></a>	<code class="filename">/etc/cups/mime.convs</code>では、この行が存在するようにする:	<a class="indexterm" name="id2651791"></a></p><pre class="programlisting">application/octet-stream   application/vnd.cups-raw   0   - </pre><p>	もしも、2つのファイルが、Windowsクライアントからの印刷に対して正しく設定されて	いない場合、恐ろしい<code class="computeroutput">Unable to convert file 0</code>	というメッセージが、が、CUPSの<code class="filename">error_log</code>ファイル中に現れる	だろう。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	<code class="filename">mime.convs</code>と<code class="filename">mime.types</code>ファイルを	<span class="quote">“<span class="quote">raw</span>”</span>印刷を<span class="emphasis"><em>行う</em></span>ことだけを	<span class="emphasis"><em>許可する</em></span>ように編集する。	</p></div><p title="背景"><b>背景. </b>	<a class="indexterm" name="id2651860"></a><a class="indexterm" name="id2651867"></a>	CUPSは、伝統的な印刷システムが既定値では印刷デバイスに手の込んだ(おそらく	バイナリ)のデータを、ユーザに送ることを認めていないと比べて、より	セキュリティに気づいている印刷システムである。これは、プリンタに対して、	少なくとも大量の紙とインクを無駄にすることとなる、	<span class="quote">“<span class="quote">サービス不能</span>”</span>攻撃を引き起こす不正な使い方を簡単に行える。	<span class="quote">“<span class="quote">不明な</span>”</span>データはCUPSによって、	<em class="parameter"><code>MIME type: application/octet-stream</code></em>とタグ付けられ、	プリンタに送ることを許可されない。既定値では、他の(既知の)MIMEタイプである	<span class="quote">“<span class="quote">raw</span>”</span>のみを送ることが出来る。<span class="quote">“<span class="quote">raw</span>”</span>を送ることは、	CUPSがそれらを変換せず、何もさわらないでプリンタに渡すことを意味する。	</p><p>	これが、ベンダドライバをローカルにインストールしたWindowsクライアントによって	準備された<span class="quote">“<span class="quote">raw</span>”</span>ファイルをCUPS/Sambaの協調印刷で行うときに知っておく	必要があることのすべてである。もしもより詳細なCUPS/Samba印刷についての背景	情報について興味がないならば、この章の残りの部分を読み飛ばせばよいだろう。	</p></div><div class="sect2" title="ドライバアップロード手法"><div class="titlepage"><div><div><h3 class="title"><a name="id2651930"></a>ドライバアップロード手法</h3></div></div></div><p>	この節では、プリンタドライバをアップロードする、3つのなじみやすい方法に、	さらに新しいもの1つについて説明する。	</p><p>	<a class="indexterm" name="id2651948"></a>	もしも、MS-RPCタイプの印刷を使いたいならば、最初にSambaサーバ上に	(<em class="parameter"><code>[print$]</code></em>共有)ドライバをアップロードしなければならない。	Sambaホスト上からプリンタドライバを配信する方法(結果、Windowsクライアントは	<span class="quote">“<span class="quote">ポイントアンドプリント</span>”</span>経由でダウンロードしそれを利用できる)	についての議論は、この資料の	<a class="link" href="classicalprinting.html" title="Chapter 21. 旧式の印刷サポート">旧式の印刷 の章</a>を参照のこと。	以下は、Sambaサーバ上にクライアントドライバを準備するための3つの方法への	説明又は参照である:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>		<a class="indexterm" name="id2651990"></a>		GUIである<span class="quote">“<span class="quote">Add Printer Wizard</span>”</span>を使う		<span class="emphasis"><em>Windowsクライアントからのアップロード</em></span>方法。		</p></li><li class="listitem"><p>		コマンドラインの<span class="quote">“<span class="quote">smbclient/rpcclient</span>”</span>を使う		UNIXワークステーションからのアップロード方法。		</p></li><li class="listitem"><p>		<a class="indexterm" name="id2652022"></a>		Imprintsツールセットを使う方法。		</p></li></ul></div><p> <a class="indexterm" name="id2652034"></a>	これらの3つの方法は、CUPSに対して同じように適用される。	<code class="literal">cupsaddsmb</code>ユーティリティは最新で、CUPSを使っている場合、	WindowsドライバをSamba中に起き、提供するより便利な方法である。	</p><p>	<code class="literal">cupsaddsmb</code>は、この章の後の方でより詳細に説明される。しかし、	まず初めにCUPSフィルタリングシステムを説明し、WindowsとUNIXの印刷アーキテクチャの	違いを比較する。	</p></div></div><div class="sect1" title="Postscriptドライバダウンロードを使う高度に賢い印刷"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2652069"></a>Postscriptドライバダウンロードを使う高度に賢い印刷</h2></div></div></div><p>	<a class="indexterm" name="id2652079"></a>	<span class="quote">“<span class="quote">dump</span>”</span>プリントサーバをセットアップする方法は分かっているが、それは	すなわち、プリントジョブを<span class="quote">“<span class="quote">raw</span>”</span>でスプールするサーバは、印刷データを	変更しないということである。	</p><p>	よりか指向違法方でCUPSをセットアップする必要があるかもしれない。その理由は	いろいろとある:	</p><a class="indexterm" name="id2652108"></a><a class="indexterm" name="id2652114"></a><a class="indexterm" name="id2652121"></a><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>もしかしたら、あなたの上司は月次の印刷統計報告を希望しているだろう。	すなわち、どのプリンタがどのくらいページを印刷したか?、印刷における平均的な	時間ピークはどのくらいか?、どの部署がどのくらい印刷したか?</p></li><li class="listitem"><p>もしかしたらプリントquotaシステムを設定したかと聞かれるだろう:	ユーザが、一定期間内での制限より超えたジョブを印刷出来ないという。</p></li><li class="listitem"><p>もしかしたら以前のネットワーク印刷の設定はひどい状態で、	一から再構成しなければならないだろう。</p></li><li class="listitem"><p>もしかしたらNT<span class="quote">“<span class="quote">kernelモード</span>”</span>で動作するあまりデバッグ	されていないプリンタドライバに起因する<span class="quote">“<span class="quote">ブルースクリーン</span>”</span>を、とても	たくさん体験しているだろう?</p></li></ul></div><p>	これらのゴールはraw印刷サーバによっては成し遂げることが出来ない。それらの要求に	auサーバを構築するためには、最初にどのようにCUPSが動作するかと、どのように	それらの機能を有効にするかを学ぶ必要がある。	</p><p>	以下では、WindowsとUNIX印刷環境における、いくつかの基本的なコンセプトの	比較をまず行い、次に、CUPSフィルタリングシステムについて、どのように動作するか、	どのように微調整できるかの説明を行う。	</p><div class="sect2" title="Windows上でのGDI、UNIX上でのPostScript"><div class="titlepage"><div><div><h3 class="title"><a name="gdipost"></a>Windows上でのGDI、UNIX上でのPostScript</h3></div></div></div><p>	<a class="indexterm" name="id2652214"></a>	<a class="indexterm" name="id2652221"></a>	ネットワーク印刷は最も複雑でエラーが発生しがちであり、ユーザや管理者が	遭遇しがちである日々の作業の1つである。これはすべてのOSプラットフォーム上で	真実であり、そうなる理由がある。	</p><p>	<a class="indexterm" name="id2652240"></a>	<a class="indexterm" name="id2652247"></a><a class="indexterm" name="id2652254"></a><a class="indexterm" name="id2652261"></a><a class="indexterm" name="id2652268"></a>	プリンタに任意のファイルフォーマットを送り込み、それが印刷されることを期待する	ことはできない。ファイルフォーマット変換を行う必要がある。問題は、すべての	メーカとプリンタタイプに共通の、共通標準印刷ファイルフォーマットがないという	ことである。Postscript(Adobeの商標)とその拡張であるPCL(HPの商標)はページ記述言語	(PDL)として使われていることにより、ほぼ公式な<span class="quote">“<span class="quote">標準</span>”</span>として開発されて	いる。しかし、多くのメーカは引き続き<span class="quote">“<span class="quote">固有のものを使っている</span>”</span>	(それらの理由は、プリンタ内蔵のPostscriptインタプリタの、受け入れられないような	ライセンス費用などである)。	</p></div><div class="sect2" title="Windowsドライバ、GDIとEMF"><div class="titlepage"><div><div><h3 class="title"><a name="id2652304"></a>Windowsドライバ、GDIとEMF</h3></div></div></div><p>	<a class="indexterm" name="id2652312"></a>	<a class="indexterm" name="id2652319"></a>	<a class="indexterm" name="id2652326"></a><a class="indexterm" name="id2652333"></a>	WindowsOSでは、フォーマット変換ジョブはプリンタドライバによって行われる。	Microsoft Windows OSプラットフォーム上ではすべてのアプリケーションプログラマは、	それらの基盤となるOSそれ自身の一部分、あるいは一区画として、自由に使える	組み込みのAPI、グラフィカルデバイスインタフェース(GDI)を使える。このGDIコアは	絵、フォントと文書を<span class="emphasis"><em>画面上に</em></span>描画するのと同様に	<span class="emphasis"><em>紙の上に</em></span>(印刷)する、すべてのWindowsプログラムにある1つの	共通基盤として使える。そのため、プリンタドライバ開発者はよく定義されたGDI出力を	固有のドライバ入力として標準化できる。WYSIWYG(What You See Is What You Get)の	実現は、スクリーン上のグラフィックプリミティブが紙上の描画オブジェクトと同じ	ようで、同じソースから来るために、相対的に容易である。このソース、すなわちGDIは、	しばしば拡張メタファイル(EMF)と呼ばれるファイルフォーマットを生成する。EMFは	プリンタドライバによって処理され、プリンタ固有のファイルフォーマットに変換される。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	<a class="indexterm" name="id2652390"></a><a class="indexterm" name="id2652396"></a><a class="indexterm" name="id2652403"></a>	Microsoft Windows中のGDI基盤に対して、Appleは紙と画面出力を、その(BSDUNIXベース	なのだがご存じだろうか?)Mac OS XとDarwinオペレーティングシステムという	<a class="indexterm" name="id2652417"></a>	<a class="indexterm" name="id2652424"></a>        <a class="indexterm" name="id2652431"></a>	<a class="indexterm" name="id2652437"></a>	同じ基盤上に置くことを選んだ。Appleの<span class="emphasis"><em>コアグラフィックエンジン</em></span>	は、すべての表示作業に<span class="emphasis"><em>PDF</em></span>派生のものを使う。	</p></div><p>	<a class="link" href="CUPS-printing.html#1small" title="Figure 22.1. ローカルプリンタに対するWindowsの印刷">ローカルプリンタに対するWindowsの印刷</a>中の例は、	ローカルWindows印刷を図示している。	</p><div class="figure"><a name="1small"></a><p class="title"><b>Figure 22.1. ローカルプリンタに対するWindowsの印刷</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/1small.png" alt="ローカルプリンタに対するWindowsの印刷"></div></div></div><br class="figure-break"></div><div class="sect2" title="UNIX印刷ファイル変換とGUIの基礎"><div class="titlepage"><div><div><h3 class="title"><a name="id2652512"></a>UNIX印刷ファイル変換とGUIの基礎</h3></div></div></div><p>	<a class="indexterm" name="id2652522"></a>	<a class="indexterm" name="id2652528"></a>	<a class="indexterm" name="id2652535"></a>	<a class="indexterm" name="id2652542"></a>	UNIXとLinuxでは、OSカーネルかX(画面表示)サーバ中に、構築された、類似のレイヤは	ない。すべてのアプリケーションはそれ自身でその印刷出力を作成することに責任が	ある。幸い、大部分がPostscriptを使い、それを何らかの共通基盤としている。	また、悪いことに、同じ文書を画面上に表示することとどのようにそれを紙に	印刷するかを行う、非常にたくさんの(そして何ら共通項がない)方法がある。	これは、数10年前にさかのぼってみると、グラフィカルユーザインタフェースのための	UNIX 基盤とプロトコルを設計したX.orgの前身は、幾人かがその時点で要求したように、	<span class="quote">“<span class="quote">紙出力</span>”</span>についての責任を取るのを拒否し、それ自身を	<span class="quote">“<span class="quote">画面表示のみ</span>”</span>に制限した(何年か後、<span class="quote">“<span class="quote">Xprint</span>”</span>	プロジェクトが開発中で、Xのフレームワーク中に、PostscriptとPCLドライバを含む	印刷サポートを構築することを試みたが、まだ完成していない)。この、余り好ましくない	遺産は、使用しているシステムの、種々の<span class="quote">“<span class="quote">font</span>”</span>ディレクトリ中で、今も	見ることができる。X表示用と印刷用に使うフォントが分かれている。	</p><p title="背景"><b>背景. </b>	<a class="indexterm" name="id2652612"></a><a class="indexterm" name="id2652619"></a><a class="indexterm" name="id2652625"></a><a class="indexterm" name="id2652632"></a><a class="indexterm" name="id2652639"></a><a class="indexterm" name="id2652646"></a><a class="indexterm" name="id2652653"></a><a class="indexterm" name="id2652659"></a><a class="indexterm" name="id2652666"></a><a class="indexterm" name="id2652673"></a>	Postscriptプログラミング言語はAdobeの<span class="quote">“<span class="quote">開発物</span>”</span>であるが、その仕様は	広範囲に公開されている。その能力は、その強力なグラフィカルオブジェクト	(フォント、シェープ、パターン、行、曲線、と点)を記述する能力、その属性	(色、線の幅)とそれらを操作する(拡大縮小、変形、回転、移動)ことによっている。	その公開された仕様により、能力がある誰でも、固有のPostscriptインタプリタ実装を	作成でき、画面あるいは紙状にPostscriptファイルを表示するのに使える。	ほとんどのグラフィック出力デバイスは <span class="quote">“<span class="quote">ラスタイメージ</span>”</span>か	<span class="quote">“<span class="quote">ピクセル</span>”</span>(ペンプロッタは特筆すべき例外)というコンセプトを基盤と	している。もちろん、テキスト形式でPostscriptファイルを見ることもでき、	ラスタライザによって解釈されるに必要な言語命令であるPostscriptコードを読む	ことも出来る。ラスタライザは、ビューワプログラムによって画面上で表示されるか、	プリンタによって印刷されるかする、ピクセルイメージを生成する。	</p></div><div class="sect2" title="PostScriptとGhostscript"><div class="titlepage"><div><div><h3 class="title"><a name="post-and-ghost"></a>PostScriptとGhostscript</h3></div></div></div><p>	<a class="indexterm" name="id2652740"></a>	<a class="indexterm" name="id2652747"></a>	<a class="indexterm" name="id2652756"></a><a class="indexterm" name="id2652765"></a><a class="indexterm" name="id2652772"></a>	UNIXは紙への印刷と画面上への表示についての共通基盤が欠けている。UNIXの、好ましく	ない遺産にもかかわらず、自由に使えるPostscriptプリンタを持っている場合、基本的な	印刷はかなり簡単である。その理由は、それらのデバイスは、ラスタイメージプロセッサ	(RIP)と呼ばれる内蔵PostScript言語<span class="quote">“<span class="quote">インタプリタ</span>”</span>を持っているという	(それにより、他のタイプのプリンタよりも値段が高い)ことである。それに向けて	PostScriptを送り込むと、印刷したページを出力する。RIPは紙の上で見る事ができる、	ビットマップの絵にPostScript描画コマンドを変換するすべての大変な仕事をこなし、	プリンタによってそれを処理してしまう。これは、Windows上からPostScript印刷を	行うのと何ら違いはない。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	<a class="indexterm" name="id2652817"></a><a class="indexterm" name="id2652824"></a><a class="indexterm" name="id2652831"></a>	一般的なUNIXプログラムと印刷システムが、PostScriptを使っている間は、主にPPDを	認識していない。PPDは<span class="quote">“<span class="quote">PostScriptプリンタ記述</span>”</span>ファイルである。これは	プリンタがサポートしているすべてのオプションを指定し、制御する事を可能にする。	そのオプションとは、たとえば、両面印刷、ステープル留めと穴空けである。そのため、	WindowsかAppleユーザとは違って、たくさんのサポートされたデバイスとジョブ	オプションを、UNIXユーザは長い時間選択できなかった。しかし、今では、CUPSがある。	<a class="link" href="CUPS-printing.html#2small" title="Figure 22.2. PostScript Printerによる印刷">PostScriptプリンタによる印刷</a>で図示されているように。	</p></div><div class="figure"><a name="2small"></a><p class="title"><b>Figure 22.2. PostScript Printerによる印刷</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/2small.png" alt="PostScript Printerによる印刷"></div></div></div><br class="figure-break"><p>	<a class="indexterm" name="id2652922"></a>	しかしながら、それ以外のタイプのプリンタもある。それらはどのようにPostscriptを	印刷するかが分からない。それらは、しばしばメーカ固有のPDLを使う。それらに対して	印刷を行う事の注文はもっと多い。利用しているUNIXアプリケーションはほとんどの	場合、Postscriptを生成し、それらのデバイスはPostscriptを理解しないので、	それに対してデータを送る前に、ホスト上で使用しているプリンタに合わせた印刷	ファイルのフォーマット変換を行う必要がある。	</p></div><div class="sect2" title="Ghostscript: 非Postscriptプリンタに対するソフトウェアRIP"><div class="titlepage"><div><div><h3 class="title"><a name="id2652952"></a>Ghostscript: 非Postscriptプリンタに対するソフトウェアRIP</h3></div></div></div><p>	<a class="indexterm" name="id2652962"></a>	ここからGhostscriptの説明を始める。Ghostscriptは、UNIXプラットフォームで	使われている、伝統的な(そしてとても強力な)Postscriptインタプリタである。	これはソフトウェアによるRIPであり、ソフトウェアファイルフォーマットと同様、	非常に広範囲のハードウェアデバイスへの、たくさんのファイル変換を行う能力がある。	Ghostscript技術とドライバは非PostscriptハードウェアでPostscript印刷を実行	できるようにするものである。これについては	<a class="link" href="CUPS-printing.html#3small" title="Figure 22.3. 非Postscriptプリンタに対するRIPとしてのGhostscript">非Postscriptプリンタに対するRIPとしてのGhostscript</a>	に説明がある。	</p><div class="figure"><a name="3small"></a><p class="title"><b>Figure 22.3. 非Postscriptプリンタに対するRIPとしてのGhostscript</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/3small.png" alt="非Postscriptプリンタに対するRIPとしてのGhostscript"></div></div></div><br class="figure-break"><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a class="indexterm" name="id2653034"></a><a class="indexterm" name="id2653040"></a><a class="indexterm" name="id2653047"></a>	使用しているGhostscriptバージョンの内蔵<span class="quote">“<span class="quote">デバイス</span>”</span>すべてを確認する	ために、<span class="quote">“<span class="quote">gs -h</span>”</span>コマンドを使う。もしも、使用しているGhostscriptの	コマンド行に<em class="parameter"><code>-sDEVICE=png256</code></em>というパラメータを指定した	ならば、入力をPNGファイルに変換するように、Ghostscriptに指定する。コマンド行上の	<span class="quote">“<span class="quote">device</span>”</span>の名前指定は、入力をどのように描画するかを正確に	Ghostscriptに指示するのに最も重要な単一パラメータである。新しいGhostscriptの	バージョンは、現在artofcode LCCにおいて、通常かなり間隔を空けてリリースされる。	通常最初は<span class="quote">“<span class="quote">AFPL</span>”</span>ライセンスで提供されるが、次のAFPLバージョンが	リリースされると、すぐにGNU GPLライセンスで再リリースされる。GNU Ghostscript	はおそらくほとんどのSambaシステム上にインストールされているバージョンである。	しかし、いくつかの違いがある。	<a class="indexterm" name="id2653103"></a>	そのため、ESP Ghostscriptは、たくさんのバグ修正、追加のデバイスと改善がある、	GNU Ghostscriptの拡張として開発されている。これは、CUPS, Gutenprint, MandrakeSoft,	SuSE, Red Hatと Debianからの開発者によって一緒に保守されている。それには	<span class="quote">“<span class="quote">cups</span>”</span>デバイス(CUPSから非PSプリンタに印刷する基本部分)を含む。	</p></div></div><div class="sect2" title="PostScriptプリンタ定義(PPD)の仕様"><div class="titlepage"><div><div><h3 class="title"><a name="id2653132"></a>PostScriptプリンタ定義(PPD)の仕様</h3></div></div></div><p>	<a class="indexterm" name="id2653141"></a><a class="indexterm" name="id2653147"></a><a class="indexterm" name="id2653154"></a>	Postscriptの本質がデバイス非依存の方式でページレイアウトを表現するための	PDLである間は、実世界での印刷上部は常時デバイス固有の機能を持ったハードウェア	上で最終的に出力される。ハードウェアの違いに気を遣うことと、機能改善を図るため、	Adobeは文法とPostscriptプリンタ定義(PPD)ファイルのファイルフォーマットを定義	してきた。すべてのPostscriptプリンタはそれらのファイルの1つを同梱して出荷されて	いる。	</p><p>	PPDは、そのプリンタに割り当てられた一般的および特別な機能についてのすべての情報を	含んでいる。扱える異なった解像度は何か?両面印刷ユニットがあるか?ペーパートレイは	いくつあるか?メディアのタイプとサイズは何が使えるか?それぞれの要素について、	プリンタに送られる特別なコマンド文字列を、それを有効にするために指定する事が	出来る(ほとんどの場合、Postscriptファイル中に)。	</p><p>	PPDからの情報はプリンタドライバによって考慮されることを意味する。そのため、	与えられたプリンタのための、Windows PostScriptドライバの一部としてインストール	されるものはプリンタのPPDである。それが意味をなす場合、PPD機能は、印刷	オプションをユーザに選択されるために表示される、ドライバのユーザインタフェース	ダイアログ中で提供される。最後に、ユーザの選択は、ドライバによって作成された	PostScriptファイル中に(特別なPostScript、PJL、JCLあるいはベンダ固有のコマンド	形式として)何らかの形で書かれる。	</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>	<a class="indexterm" name="id2653217"></a><a class="indexterm" name="id2653223"></a>	特定の印刷ジョブ出力を行うために、デバイス固有のコマンドを含んで作成された	特定のマシン上のPostScriptファイルは期待通りには印刷出来ないかもしれなく、	すべてのモデル上で印刷可能ではないかもしれない。それはソフトウェアによる	追加処理に適さないかもしれない(すなわち、PDF抽出プログラムによって)。	</p></div></div><div class="sect2" title="Windows形式のベンダPPDの使用"><div class="titlepage"><div><div><h3 class="title"><a name="id2653243"></a>Windows形式のベンダPPDの使用</h3></div></div></div><p><a class="indexterm" name="id2653251"></a><a class="indexterm" name="id2653258"></a><a class="indexterm" name="id2653265"></a>	CUPSはそのPostScriptモデルのための、開発元によって供給された、すべての仕様に	従っているPPDを扱うことが出来る。もしもベンダがマニュアルとパンフレットに	使用しているOSについての言及がなかったとしても、それらを安全に信用できる:	<span class="emphasis"><em>もしも、Windows NTバージョンのPPDを入手したならば、CUPS中で変更なしに利用でき</em></span>、	その結果、Windows NTユーザが出来るように使用するプリンタのすべての能力に	アクセスできる。	</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>	オンラインでどのようなPPDの仕様遵守状態を確認するためには、	<a class="ulink" href="http://www.cups.org/testppd.php" target="_top">http://www.cups.org/testppd.php</a>	に行き、PPDをアップロードする。すぐにその結果を見ることができる。バージョン	1.1.19以降のすべてのバージョンのCUPSは、よりずっと厳しい内蔵PPD解析と検査	コードが有効になっている。印刷トラブルが起きたら、このオンラインリソースを	最初に調べる場所としてほしい。	</p></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>	<a class="indexterm" name="id2653320"></a>	<a class="indexterm" name="id2653327"></a>	実際のPostScriptプリンタのためには、Linuxprinting.orgからの	<span class="emphasis"><em>Foomatic</em></span>か<span class="emphasis"><em>cupsomatic</em></span>PPDを	<span class="emphasis"><em>使ってはならない</em></span>。それらのデバイスには、オリジナルの	ベンダが提供したPPDが常時最初の選択肢となる。	</p></div><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a class="indexterm" name="id2653354"></a>	もしも、特定のデバイスに対するオリジナルのベンダ提供PPDを捜していて、LAN上の	NT4マシン(あるいは他の任意のWindowsマシン)がインストールされているPostScript	プリンタを持っている場合、すべてのプリンタドライバが格納されているWindows	ディレクトリにアクセスするために、	<code class="literal">smbclient //NT4-box/print\$ -U username</code>を使用する。	最初に、捜しているPPDのために、<code class="filename">W32X86/2</code>サブディレクトリを	捜してみる。	</p></div></div><div class="sect2" title="非PostScriptプリンタのためにCUPSはPPDを使う"><div class="titlepage"><div><div><h3 class="title"><a name="id2653388"></a>非PostScriptプリンタのためにCUPSはPPDを使う</h3></div></div></div><p><a class="indexterm" name="id2653396"></a><a class="indexterm" name="id2653403"></a><a class="indexterm" name="id2653410"></a>	CUPSは非PostScriptプリンタを扱うために、特別に作成されたPPDをも使う。それらの	PPDは通常ベンダから供給されない(そして、同じモデル名のPostScriptプリンタ用の	PPDファイルを使うことが出来ず、非PostScriptバージョンが動くことを期待することも	同じである)。非PostScriptプリンタに対してPPDがどのように適用されるかを知るため	には、最初にCUPSフィルタリングとファイルフォーマット変換アーキテクチャについて	深く言及する必要がある。引き続き読み続けること。	</p></div></div><div class="sect1" title="CUPSフィルタリングアーキテクチャ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2653442"></a>CUPSフィルタリングアーキテクチャ</h2></div></div></div><p><a class="indexterm" name="id2653451"></a><a class="indexterm" name="id2653459"></a><a class="indexterm" name="id2653466"></a><a class="indexterm" name="id2653473"></a><a class="indexterm" name="id2653480"></a>CUPSフィルタリングシステムの中核は、Ghostscriptによっている。Ghostscriptを追加する事で、CUPSはそれ自身固有のフィルタ以外のいくつかを使う。あなた自身(あるいはベンダ)はさらにフィルタを追加しても良い。CUPSはすべてのデータファイルフォーマットを種々のMIMEタイプのラベル配下で取り扱う。入力された各印刷ファイルは、最初に行われる自動タイプわけに基づいて扱われる。自動タイプわけにより、MIMEタイプが決定する。与えられたMIMEタイプは、選択された対象プリンタに、0またはそれ以上の、フィルタリングチェーンが自動的に(暗黙のうちに)設定される。この節では、どのようにMIMEタイプ認識と変換ルールが相互に作用するかについて説明する。それらは、与えられた入力データフォーマットに対する、動作させるフィルタリングチェーンを自動的に設定するために、CUPSによって使われる。</p><p>もしもCUPSがネイティブにビットマップにPostScriptファイルをラスタライズするならば、それは以下の2つのステージで行われる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2653533"></a><a class="indexterm" name="id2653540"></a>	最初のステージでは、<span class="quote">“<span class="quote">cups</span>”</span>という名前のGhostscriptデバイスを使い	(これは、バージョン1.15以降)、<span class="quote">“<span class="quote">CUPS raster</span>”</span>と呼ばれる一般的な	ラスタ形式を生成する。	</p></li><li class="listitem"><p><a class="indexterm" name="id2653562"></a>	第二のステージでは、標準的なCUPSラスタをデバイス固有のラスタに変換する、	<span class="quote">“<span class="quote">ラスタドライバ</span>”</span>を使う。	</p></li></ul></div><p><a class="indexterm" name="id2653582"></a><a class="indexterm" name="id2653588"></a><a class="indexterm" name="id2653595"></a>使用するGhostscriptのバージョンが<span class="quote">“<span class="quote">cups</span>”</span>デバイスをコンパイルしてあるようにしておくこと(これは<code class="literal">gs -h |grep cups</code>で調べられる。それ以外だと、CUPS CUPS error_logファイルに<code class="computeroutput">Unable to convert file 0</code>というエラーメッセージが表示されるだろう。使用しているGhostscript中にデバイスとして<span class="quote">“<span class="quote">cups</span>”</span>が含まれるようにするには、GNU Ghostscriptにパッチを当てて再コンパイルするか、<a class="indexterm" name="id2653632"></a><a class="ulink" href="http://www.cups.org/ghostscript.php" target="_top">ESP Ghostscript</a>を使う必要がある。良い代替はESP Ghostscriptである。これはCUPSサポートだけではなく、300もの他のデバイス(GNU Ghostscriptがおおよそ180くらいしかサポートしないのに対して)をサポートする。この広範囲なデバイスサポートがあるという理由で、ESC Ghostscriptは非CUPSスプーラ用の、最初の選択肢としても使える。すべてのスプーラに対して、Linuxprinting.orgによって現在は推奨されている。</p><p><a class="indexterm" name="id2653668"></a><a class="indexterm" name="id2653674"></a><a class="indexterm" name="id2653681"></a><a class="indexterm" name="id2653688"></a>CUPSプリンタは外部レンダリングパスを使うように設定しても良い。最も共通的なものは、<a class="ulink" href="http://www.linuxprinting.org/" target="_top">Linuxprinting.org</a>からのFoomatic/cupsomaticコンセプトによって提供されるものである。これは古いGhostscriptを用いて、すべてを1ステップで処理する。これは<span class="quote">“<span class="quote">cups</span>”</span>デバイスを使わないが、その他の多くを使う。しかし、Foomatic/cupsomaticの使用にもかかわらず、最も良い解と<a class="indexterm" name="id2653715"></a>広範囲のプリンタモデルのサポートはESC Ghostscriptによって提供される(Foomatic/cupsomaticについての詳細、現在<span class="emphasis"><em>foomatic-rip</em></span>と呼ばれている、特に新しいバージョンについては、以下を参照)。</p><div class="sect2" title="MIMEタイプとCUPSフィルタ"><div class="titlepage"><div><div><h3 class="title"><a name="id2653735"></a>MIMEタイプとCUPSフィルタ</h3></div></div></div><p>	<a class="indexterm" name="id2653744"></a>	<a class="indexterm" name="id2653753"></a><a class="indexterm" name="id2653760"></a><a class="indexterm" name="id2653767"></a><a class="indexterm" name="id2653774"></a>	CUPSは<code class="filename">/etc/cups/mime.types</code>(と、同じディレクトリ中にある、	すべての<code class="filename">*.types</code>ファイル)を起動時に読み込む。これらの	ファイルはCUPSがそのautotyping機能を動かしているときに適用されるMIMEタイプ	認識ルールを含む。ルールの文法は<code class="filename">mime.types</code>のマニュアル	ページと<code class="filename">mime.types</code>ファイルそれ自身のコメントセクションに	記述されている。簡単なルールは以下の通りである:	<a class="indexterm" name="id2653813"></a></p><pre class="programlisting">application/pdf         pdf string(0,%PDF)</pre><p><a class="indexterm" name="id2653826"></a><a class="indexterm" name="id2653833"></a>	これは、もしファイル名に<code class="filename">.pdf</code>という拡張子が付いているか、	あるいは、マジック文字列<span class="emphasis"><em>%PDF</em></span>がファイルそれ自身の先頭の	正しいところ(開始時点からオフセット0)にある場合、それはPDFファイルである	(<em class="parameter"><code>application/pdf</code></em>)。その他のルールは以下の通り:</p><pre class="programlisting">application/postscript  ai eps ps string(0,%!) string(0,<04>%!)</pre><p><a class="indexterm" name="id2653870"></a><a class="indexterm" name="id2653876"></a><a class="indexterm" name="id2653883"></a><a class="indexterm" name="id2653890"></a><a class="indexterm" name="id2653897"></a><a class="indexterm" name="id2653904"></a>	もしも、ファイル名が<code class="filename">.ai</code>, <code class="filename">.eps</code>,	<code class="filename">.ps</code>という拡張子のどれかを持つか、ファイルそれ自身が	<span class="emphasis"><em>%!</em></span>か<span class="emphasis"><em><04>%!</em></span>という文字列の	どれかで始まるならば、それは一般的なPostScriptファイルである	(<em class="parameter"><code>application/postscript</code></em>)。	</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a class="indexterm" name="id2653950"></a>	使用するシステムが、<code class="filename">/etc/cups/</code>ディレクトリ中のどれかを	使うかもしれない、他のmime.typesファイルと混同しないこと。	</p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2653971"></a><a class="indexterm" name="id2653978"></a><a class="indexterm" name="id2653984"></a><a class="indexterm" name="id2653991"></a><a class="indexterm" name="id2653998"></a>	CUPS中の2つの似たようなMIMEタイプとの間で、重要な違いがある。1つは	<em class="parameter"><code>application/postscript</code></em>で、もう一つは	<em class="parameter"><code>application/vnd.cups-postscript</code></em>である。	<em class="parameter"><code>application/postscript</code></em>がデバイス非依存を意味するので、	ファイルのジョブオプションは引き続きPSファイルの内容の外側にあり、CUPSによって	コマンドラインか環境変数中に埋め込まれ、	<em class="parameter"><code>application/vnd.cups-postscript</code></em>は、PostScriptそれ自身	中に埋め込まれるジョブオプションがあるかもしれない(適用可能ならば)。一般的な	PostScript(<em class="parameter"><code>application/postscript</code></em>)の、デバイス固有の	バージョン(<em class="parameter"><code>application/vnd.cups-postscript</code></em>)への変換は、	CUPSの<em class="parameter"><code>pstops</code></em>フィルタの責任である。pstopsは変換を行う	ためにPPD中に含まれる情報を使う。	</p></div><p><a class="indexterm" name="id2654066"></a><a class="indexterm" name="id2654073"></a><a class="indexterm" name="id2654080"></a><a class="indexterm" name="id2654086"></a><a class="indexterm" name="id2654093"></a><a class="indexterm" name="id2654099"></a><a class="indexterm" name="id2654106"></a><a class="indexterm" name="id2654112"></a><a class="indexterm" name="id2654119"></a><a class="indexterm" name="id2654126"></a><a class="indexterm" name="id2654133"></a><a class="indexterm" name="id2654140"></a><a class="indexterm" name="id2654147"></a><a class="indexterm" name="id2654154"></a><a class="indexterm" name="id2654160"></a><a class="indexterm" name="id2654167"></a>	CUPSはASCIIテキスト,HP-GL, PDF, PostScript, DVIと多くの画像イメージ形式	(GIF, PNG, TIFF, JPEG, Photo-CD, SUN-Raster,PNM, PBM, SGI-RGBやその他)と	それらに関連したMIMEタイプとそのフィルタを扱うことが出来る。	</p></div><div class="sect2" title="MIMEタイプ変換ルール"><div class="titlepage"><div><div><h3 class="title"><a name="id2654185"></a>MIMEタイプ変換ルール</h3></div></div></div><p>	<a class="indexterm" name="id2654193"></a>	<a class="indexterm" name="id2654200"></a><a class="indexterm" name="id2654207"></a><a class="indexterm" name="id2654214"></a><a class="indexterm" name="id2654221"></a>	CUPSは<code class="filename">/etc/cups/mime.convs</code>(と、同じディレクトリ中にある、	その他の<code class="filename">*.convs</code>というファイルも)を起動時に読み込む。	それらのファイルには入力MIMEタイプ、出力MIMEタイプ、入力タイプから出力を生成	できるフォーマット変換フィルタとその変換に関連する仮想のコストを意味する行を	含む。その1つの例は以下のようになる:</p><pre class="programlisting">application/pdf         application/postscript   33   pdftops</pre><p><a class="indexterm" name="id2654261"></a>	これは、<em class="parameter"><code>pdftops</code></em>フィルタが入力として	<em class="parameter"><code>application/pdf</code></em>を取り、出力として	<em class="parameter"><code>application/postscript</code></em>を生成する。この操作の仮想コストは	33 CUPS-$である。次のフィルタはより高価で、66 CUPS-$かかる:	<a class="indexterm" name="id2654290"></a></p><pre class="programlisting">application/vnd.hp-HPGL application/postscript   66   hpgltops</pre><p><a class="indexterm" name="id2654303"></a>	これは、HP-GLプロッタファイルをPostScriptへ変換処理する	<em class="parameter"><code>hpgltops</code></em>である。	<a class="indexterm" name="id2654319"></a></p><pre class="programlisting">application/octet-stream</pre><p>	さらに2つの例である:	<a class="indexterm" name="id2654333"></a><a class="indexterm" name="id2654340"></a><a class="indexterm" name="id2654347"></a><a class="indexterm" name="id2654354"></a></p><pre class="programlisting">application/x-shell     application/postscript   33    texttopstext/plain              application/postscript   33    texttops</pre><p><a class="indexterm" name="id2654369"></a>	最後の2つの例は<em class="parameter"><code>application/x-shell</code></em>上と同じように	<em class="parameter"><code>text/plain</code></em>で動作する<em class="parameter"><code>texttops</code></em>	フィルタを意味する(ヒント:この違いは、<em class="parameter"><code>texttops</code></em>の	特筆すべき機能の文法のために必要とされる)。	</p></div><div class="sect2" title="フィルタリングの概要"><div class="titlepage"><div><div><h3 class="title"><a name="id2654406"></a>フィルタリングの概要</h3></div></div></div><p>	<a class="indexterm" name="id2654414"></a>	<code class="filename">mime.convs</code>という名前の、よりたくさんの組み合わせがある。	しかし、あらかじめ定義してあるもの以外を使うことに制限はない。好みの、CUPS	フレームワークに対する任意のフィルタを追加できる。それは最小限の要求に適合	するか、させねばならない。もしも、ある種の効果的なフィルタを見つける(か書くか)	場合、CUPSの要求が要求するものに従い、適切な行を<code class="filename">mime.types</code>と	<code class="filename">mime.convs</code>に書く。そうするとCUPS内部でシームレスに動作する。	</p><div class="sect3" title="フィルタの要求"><div class="titlepage"><div><div><h4 class="title"><a name="id2654457"></a>フィルタの要求</h4></div></div></div><p>	フィルタに対する<span class="quote">“<span class="quote">CUPSの要求</span>”</span>は単純である。入力としてファイル名か	<code class="filename">標準入力</code>を取り、<code class="filename">標準出力</code>に出力する。	これはまた下記の引数を持つ:	</p><div class="variablelist"><dl><dt><span class="term">printer</span></dt><dd><p>			プリンタキューの名前(通常これは動かすフィルタの名前である)。			</p></dd><dt><span class="term">job</span></dt><dd><p>			印刷するジョブのジョブID値(数字)。			</p></dd><dt><span class="term">user</span></dt><dd><p>			オリジナルのユーザ名属性からの文字列。			</p></dd><dt><span class="term">title</span></dt><dd><p>			ジョブ名属性からの文字列。			</p></dd><dt><span class="term">copies</span></dt><dd><p>			コピー数属性からの数値。			</p></dd><dt><span class="term">options</span></dt><dd><p>			ジョブのオプション。			</p></dd><dt><span class="term">filename</span></dt><dd><p>			(オプション)印刷を要求するファイル(もしも指定されなければ、			フィルタは<code class="filename">標準入力</code>からのデータ供給を			仮定する)。ほとんどの場合、CUPSで動作するようにさせるための			存在するフィルタを囲む単純なラッパプログラムを書くことは			簡単である。			</p></dd></dl></div></div></div><div class="sect2" title="Prefilters"><div class="titlepage"><div><div><h3 class="title"><a name="id2654586"></a>Prefilters</h3></div></div></div><p>	<a class="indexterm" name="id2654594"></a><a class="indexterm" name="id2654601"></a><a class="indexterm" name="id2654608"></a>	以前に説明したように、PostScriptは、任意のUNIXベースの印刷システムにおいて	中核となるファイル形式である。PostScriptから、非PostScriptプリンタに送る	ためのラスタデータを、CUPSは生成する。	</p><p><a class="indexterm" name="id2654627"></a><a class="indexterm" name="id2654633"></a><a class="indexterm" name="id2654640"></a><a class="indexterm" name="id2654647"></a><a class="indexterm" name="id2654654"></a><a class="indexterm" name="id2654660"></a><a class="indexterm" name="id2654667"></a><a class="indexterm" name="id2654674"></a><a class="indexterm" name="id2654681"></a><a class="indexterm" name="id2654688"></a>	しかし、印刷するためにサポートされた非PSフォーマットのどれかを送る時に何が起きる	のだろうか?次にCUPSはPostScriptを最初に生成するために、それらの入力上で	<span class="quote">“<span class="quote">prefilters</span>”</span>を動かす。これは、ASCIIテキスト,PDF, DVI,かHP-GLから	PostScriptを生成するためのprefilterである。それらのフィルタからの出力は常時	<em class="parameter"><code>application/postscript</code></em>というMIMEタイプである	(これは任意のデバイス固有のオプションはCUPSによってまだPostScriptに埋め込まれて	おらず、呼ばれる次のフィルタはpstopsであることを意味する)。その出力は常時	<em class="parameter"><code>application/vnd.cups-postscript</code></em>というMIMEタイプである	(application/postscriptではない)場合、プリントオプションはすでにファイルに	埋め込まれている事を意味する。これは、	<a class="link" href="CUPS-printing.html#4small" title="Figure 22.4. PostScriptを整形するためのCUPS内のprefiltering">PostScriptを整形するためのCUPS内のprefiltering</a>	で説明されている。	</p><div class="figure"><a name="4small"></a><p class="title"><b>Figure 22.4. PostScriptを整形するためのCUPS内のprefiltering</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/4small.png" width="135" alt="PostScriptを整形するためのCUPS内のprefiltering"></div></div></div><br class="figure-break"></div><div class="sect2" title="pstops"><div class="titlepage"><div><div><h3 class="title"><a name="id2654785"></a>pstops</h3></div></div></div><p><a class="indexterm" name="id2654793"></a><a class="indexterm" name="id2654800"></a><a class="indexterm" name="id2654807"></a><a class="indexterm" name="id2654814"></a><a class="indexterm" name="id2654821"></a><a class="indexterm" name="id2654828"></a><a class="indexterm" name="id2654835"></a>	<span class="emphasis"><em>pstops</em></span>は、<em class="parameter"><code>application/postscript</code></em>を	<em class="parameter"><code>application/vnd.cups-postscript</code></em>に変換するために使われる	フィルタである。以前に説明したように、このフィルタはすべてのデバイス固有の印刷	オプション(両面印刷やstanpingと穴あけなどをプリンタに指示するコマンド)を、	PostScriptファイル中に挿入する。その例は、	<a class="link" href="CUPS-printing.html#5small" title="Figure 22.5. デバイス固有印刷オプションの追加">デバイス固有印刷オプションの追加</a>に例示されている。	</p><div class="figure"><a name="5small"></a><p class="title"><b>Figure 22.5. デバイス固有印刷オプションの追加</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/5small.png" width="135" alt="デバイス固有印刷オプションの追加"></div></div></div><br class="figure-break"><p>	これがすべてではない。これにより行われるその他の処理は以下の通り:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>		印刷ページ範囲を指定する(すなわち、<span class="quote">“<span class="quote">3, 6, 8-11, 16と19-21</span>”</span>		か、偶数ページのみ印刷することを選べる)。		</p></li><li class="listitem"><p>		1枚に2枚あるいはそれ以上のページを配置する(<span class="quote">“<span class="quote">数値-up</span>”</span>		機能と呼ばれる)。		</p></li><li class="listitem"><p><code class="filename">/var/log/cups/page_log</code>に、		課金情報を記録するための、ジョブのページ数をカウントする。		</p></li></ul></div></div><div class="sect2" title="pstoraster"><div class="titlepage"><div><div><h3 class="title"><a name="id2654966"></a>pstoraster</h3></div></div></div><p><a class="indexterm" name="id2654974"></a><a class="indexterm" name="id2654980"></a><a class="indexterm" name="id2654987"></a>	<em class="parameter"><code>pstoraster</code></em>はCUPSフィルタリングシステムの中核である。	これは、ラスタライズ処理の最初のステージに対して責任がある。その入力は	application/vnd.cups-postscriptというMIMEタイプである。その出力は、	application/vnd.cups-rasterである。この出力形式はまだ印刷可能にはなっていない。	その目的は、デバイス固有印刷データの生成を有効にする、より特殊化した	<span class="emphasis"><em>ラスタデバイス</em></span>のための汎用入力形式として提供することである。	これについては、	<a class="link" href="CUPS-printing.html#cups-raster" title="Figure 22.6. PostScriptから中間ラスタ形式への変換ダイアグラム">PostScriptから中間ラスタ形式への変換ダイアグラム</a>	を参照のこと。	</p><div class="figure"><a name="cups-raster"></a><p class="title"><b>Figure 22.6. PostScriptから中間ラスタ形式への変換ダイアグラム</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/6small.png" width="135" alt="PostScriptから中間ラスタ形式への変換ダイアグラム"></div></div></div><br class="figure-break"><p><a class="indexterm" name="id2655078"></a><a class="indexterm" name="id2655085"></a><a class="indexterm" name="id2655092"></a><a class="indexterm" name="id2655099"></a>	CUPSラスタは強力な機能を持つ汎用ラスタフォーマットである。これは、ページ単位	情報、色のプロファイルなど、下位のラスタドライバで使われるものを含むことが	出来る。そのMIMEタイプはIANAに登録されていてその仕様はもちろん完全に公開されて	いる。それを作るのはとても簡単で、選択したものに対応すべきプリンタモデル用に、	LinuxとUNIXラスタドライバを製造元が作成するために、費用がかからないように	設計されている。CUPSは常時ラスタライズする最初のステージに注意を払っているので、	ベンダはGhostscript互換について注意を払う必要はない(実際、CUPSラスタドライバの	開発の資金調達を行っている、1つ以上のベンダが現在存在する)。これは、	<a class="link" href="CUPS-printing.html#cups-raster2" title="Figure 22.7. Ghostscriptを使うCUPSラスタ生成の図解">Ghostscriptを使うCUPSラスタ生成の図解</a>	に図示している。	</p><div class="figure"><a name="cups-raster2"></a><p class="title"><b>Figure 22.7. Ghostscriptを使うCUPSラスタ生成の図解</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/7small.png" alt="Ghostscriptを使うCUPSラスタ生成の図解"></div></div></div><br class="figure-break"><p><a class="indexterm" name="id2655193"></a><a class="indexterm" name="id2655200"></a><a class="indexterm" name="id2655206"></a><a class="indexterm" name="id2655213"></a>	バージョン1.1.15より前のCUPSバージョンでは、バイナリ(あるいはソースコードで)、	<em class="parameter"><code>pstoraster</code></em>という名前の独立フィルタを提供していた。	<em class="parameter"><code>pstoraster</code></em>はGNU Ghostscript 5.50由来で、代替インストール	可能で、競合なしにGNUあるいはAFPL Ghostscriptパッケージに追加される。	</p><p>	バージョン1.1.15以降、この機能は変更された。このフィルタの機能は、Ghostscriptに	統合された(現在はGNU Ghostscript バージョン 7.05をベースとしている)。	<em class="parameter"><code>pstoraster</code></em>フィルタは現在<code class="literal">-sDEVICE=cups</code>	パラメータを付けた<code class="literal">gs</code>を呼び出す単純なシェルスクリプトである。	もしも、<code class="literal">gs -h |grep cups</code>を実行したときにGhostscriptがエラーに	なるならば、印刷は出来ないので、Ghostscriptをアップデートする必要がある。	</p></div><div class="sect2" title="imagetops と imagetoraster"><div class="titlepage"><div><div><h3 class="title"><a name="id2655281"></a>imagetops と imagetoraster</h3></div></div></div><p><a class="indexterm" name="id2655290"></a><a class="indexterm" name="id2655297"></a>	prefiltersについての節において、イメージ形式からPostScriptを生成するprefilter	について言及した。<em class="parameter"><code>imagetoraster</code></em>フィルタは中間PostScript	ステージなしにイメージからラスタに直接変換するために使われる。これは以前に	言及したprefilterよりもより頻繁に使われる。イメージファイルのフィルタリングに	ついての要約フローチャートは	<a class="link" href="CUPS-printing.html#small8" title="Figure 22.8. イメージ形式をCUPSラスタ形式に変換する流れ">イメージ形式をCUPSラスタ形式に変換する流れ</a>である。	</p><div class="figure"><a name="small8"></a><p class="title"><b>Figure 22.8. イメージ形式をCUPSラスタ形式に変換する流れ</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/8small.png" alt="イメージ形式をCUPSラスタ形式に変換する流れ"></div></div></div><br class="figure-break"></div><div class="sect2" title="rasterto [プリンタ固有]"><div class="titlepage"><div><div><h3 class="title"><a name="id2655376"></a>rasterto [プリンタ固有]</h3></div></div></div><p><a class="indexterm" name="id2655384"></a><a class="indexterm" name="id2655391"></a><a class="indexterm" name="id2655398"></a><a class="indexterm" name="id2655405"></a><a class="indexterm" name="id2655412"></a><a class="indexterm" name="id2655419"></a><a class="indexterm" name="id2655426"></a><a class="indexterm" name="id2655433"></a><a class="indexterm" name="id2655440"></a><a class="indexterm" name="id2655446"></a><a class="indexterm" name="id2655453"></a>	CUPSはCUPSラスタを処理するための非常に数多くのラスタドライバを提供している。	筆者の環境では、/usr/lib/cups/filter/配下に	<em class="parameter"><code>rastertoalps</code></em>,<em class="parameter"><code>rastertobj</code></em>,        <em class="parameter"><code>rastertoepson</code></em>,<em class="parameter"><code>rastertoescp</code></em>,	<em class="parameter"><code>rastertopcl</code></em>,<em class="parameter"><code>rastertoturboprint</code></em>,	<em class="parameter"><code>rastertoapdk</code></em>,<em class="parameter"><code>rastertodymo</code></em>,	<em class="parameter"><code>rastertoescp</code></em>, <em class="parameter"><code>rastertohp</code></em>と        <em class="parameter"><code>rastertoprinter</code></em>があった。これよりドライバの数が少なくても	心配することはない。上記のいくつかはCUPSに対する商用アドオンであり	(<em class="parameter"><code>rastertoturboprint</code></em>のような)、その他	(<em class="parameter"><code>rastertoprinter</code></em>のような)は、可能な限りCUPSと協調する	ことを望んでいるサードパーティドライバ開発プロジェクトに由来する	(たとえばGutenprint)。	<a class="link" href="CUPS-printing.html#small9" title="Figure 22.9. ラスタからプリンタ固有形式への変換図">ラスタからプリンタ固有形式への変換図</a>	を参照。	</p><div class="figure"><a name="small9"></a><p class="title"><b>Figure 22.9. ラスタからプリンタ固有形式への変換図</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/9small.png" alt="ラスタからプリンタ固有形式への変換図"></div></div></div><br class="figure-break"></div><div class="sect2" title="CUPSバックエンド"><div class="titlepage"><div><div><h3 class="title"><a name="id2655602"></a>CUPSバックエンド</h3></div></div></div><p><a class="indexterm" name="id2655611"></a><a class="indexterm" name="id2655618"></a>	CUPSフィルタリングチェーンについての最後の部分はバックエンドである。	バックエンドは、最終的なデバイスに印刷可能なファイルを送るための、特別な	プログラムである。ネットワーク経由でと、すべてのローカルなインタフェースに	印刷ジョブを送るための、任意の異なった分離されたバックエンドプログラムが	ある。すべてのCUPS印刷キューは、それに関連づけられているCUPS	<span class="quote">“<span class="quote">device-URI</span>”</span>を持つ必要がある。device URIは、その送付先にジョブを	送るときに使われる、バックエンドをエンコードする方法である。以下で一覧表示	されているもので分かるように、ネットワークdevice URLは記述の中に2つの	スラッシュ(斜線)を使い、ローカルdevice URLは1つのみを使う。ローカル	インタフェース名は、OSがLinux以外の場合、筆者の例では非常に自由度があっても	よいことを心にとめておくこと:	</p><div class="variablelist"><dl><dt><span class="term">usb</span></dt><dd><p>		このバックエンドはUSB接続のプリンタに印刷ファイルを送る。使用する		CUPS device URIの例は以下の通り。		<code class="filename">usb:/dev/usb/lp0</code>		</p></dd><dt><span class="term">serial</span></dt><dd><p>		このバックエンドはシリアル接続したプリンタに印刷ファイルを送る。使用する                CUPS device URIの例は以下の通り。		<code class="filename">serial:/dev/ttyS0?baud=11500</code>		</p></dd><dt><span class="term">parallel</span></dt><dd><p>		このバックエンドはパラレルポートに接続したプリンタに印刷ファイルを送る。使用する                CUPS device URIの例は以下の通り。		<code class="filename">parallel:/dev/lp0</code>		</p></dd><dt><span class="term">SCSI</span></dt><dd><p>		このバックエンドはSCSIインタフェースに接続されたプリンタに印刷ファイルを送る。使用する                CUPS device URIの例は以下の通り。		<code class="filename">scsi:/dev/sr1</code>		</p></dd><dt><span class="term">lpd</span></dt><dd><p>		このバックエンドはLPR/LPDで接続されたネットワークプリンタに印刷ファイルを送る。使用する                CUPS device URIの例は以下の通り。		<code class="filename">lpd://remote_host_name/remote_queue_name</code>		</p></dd><dt><span class="term">AppSocket/HP JetDirect</span></dt><dd><p>		このバックエンドはAppSocket(別名JetDirect)で接続されたネットワークプリンタに		印刷ファイルを送る。使用するCUPS device URIの例は以下の通り。		<code class="filename">socket://10.11.12.13:9100</code>		</p></dd><dt><span class="term">ipp</span></dt><dd><p>		このバックエンドはIPPで接続されたネットワークプリンタ(か他のCUPSサーバ)に		印刷ファイルを送る。使用するCUPS device URIの例は以下の通り。		<code class="filename">ipp:://192.193.194.195/ipp</code>		(多くのHPプリンタ用)と		<code class="filename">ipp://remote_cups_server/printers/remote_printer_name</code>		</p></dd><dt><span class="term">http</span></dt><dd><p>		このバックエンドはHTTPで接続されたプリンタにファイルを送る		(http:// CUPSバックエンドはipp://バックエンドの単なるシンボリックリンクである)。		CUPS device URIの例は以下の通り。		<code class="filename">http:://192.193.194.195:631/ipp</code>		(多くのHPプリンタ用)と		<code class="filename">http://remote_cups_server:631/printers/remote_printer_name</code>		</p></dd><dt><span class="term">smb</span></dt><dd><p>		このバックエンドはWindowsホストによって共有されているプリンタに印刷ファイルを送る。                CUPS device URIの例は以下の通り。		</p><p>		</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">smb://workgroup/server/printersharename</code></td></tr><tr><td><code class="filename">smb://server/printersharename</code></td></tr><tr><td><code class="filename">smb://username:password@workgroup/server/printersharename</code></td></tr><tr><td><code class="filename">smb://username:password@server/printersharename</code></td></tr></table><p>		</p><p>		The smb:// backendはSambaユーティリティ<em class="parameter"><code>smbspool</code></em>		(CUPSによって提供されていない)へのシンボリックリンクである。もしも		CUPSバックエンドディレクトリ中にシンボリックリンクがない場合、root		ユーザになって、		<code class="literal">ln -s `which smbspool' /usr/lib/cups/backend/smb</code>		を実行してこれを作ること。		</p></dd></dl></div><p>	CUPS印刷システムに対して任意の変更又は拡張の必要性がある場合、シェル又はPerl	スクリプトで固有のバックエンドを書くことは簡単である。印刷ジョブをメールとして	(<span class="quote">“<span class="quote">mailto:/</span>”</span>バックエンド経由で)送る、PDFに変換する	(<span class="quote">“<span class="quote">pdfgen:/</span>”</span>バックエンド経由で)、あるいは<span class="quote">“<span class="quote">/dev/null</span>”</span>に	ダンプするというような<span class="quote">“<span class="quote">特別な</span>”</span>プリンタを作成したいというような	希望が理由としてあげられる(実際、システム全体での既定値のプリンタとして、	devnull:/バックエンドに接続するプリンタを用意している)。とても多くの人が、	プリンタを指定しないでジョブを送信したり、スクリプトとプログラムがプリンタを	指定しない。システム全体での既定値はジョブを削除し、$USERに、	正しいプリンタ名を常時指定するようにという丁寧なメールを送る)。	</p><p><a class="indexterm" name="id2655977"></a><a class="indexterm" name="id2655984"></a>	説明したバックエンドすべて以外が使用しているシステム上にあるか、利用可能に	(ハードウェア設定に依存する)なっていてもよい。すべての有効なCUPSバックエンドを	調べる1つの方法は<span class="emphasis"><em>lpinfo</em></span>として提供されている。これを	<code class="option">-v</code>を付けて付こうと、すべての有効なバックエンドを下記のように	表示する:	</p><pre class="screen">	<code class="prompt">$ </code><strong class="userinput"><code>lpinfo -v</code></strong>	</pre></div><div class="sect2" title="cupsomatic/foomaticの役割"><div class="titlepage"><div><div><h3 class="title"><a name="id2656028"></a><em class="parameter"><code>cupsomatic/foomatic</code></em>の役割</h3></div></div></div><p>	<a class="indexterm" name="id2656041"></a>	<a class="indexterm" name="id2656048"></a><a class="indexterm" name="id2656055"></a><a class="indexterm" name="id2656061"></a><a class="indexterm" name="id2656069"></a>	<em class="parameter"><code>cupsomatic</code></em>フィルタはCUPSをインストールするときに最も広く	使われているだろう。これらはCUPS開発者によって開発されたものではないということを	明確にする必要がある。これらはCUPSに対するサードパーティアドオンである。これらは	CUPSのためにジョブをレンダリングする従来のGhostscriptデバイスを使う。	問題が発生したときの調査時にはその違いを知っておく必要がある。ここでは1ステージで	すべてのレンダリングプロセスがGhostscript内部で、対象のプリンタに適したデバイスを	使って行われる。<em class="parameter"><code>cupsomatic</code></em>は、Linuxprinting.orgにある	Foomaticプリンタドライバデータベースから生成されたPPDを使う。	</p><p>	You can recognize these PPDs from the line calling the	<em class="parameter"><code>cupsomatic</code></em> filter:</p><pre class="programlisting">*cupsFilter: "application/vnd.cups-postscript  0  cupsomatic"</pre><p>	PPDファイルの最初の40かそのあたりで、この行を見つけるかもしれない。	もしも、そのような、インストールされたPPDがあるならば、プリンタは	<em class="parameter"><code>foomatic</code></em>の名前部分に<em class="parameter"><code>foomatic</code></em>が	表示されたCUPS Webインタフェース中で表示される。	<em class="parameter"><code>cupsomatic</code></em>は、選択されたPPDとプリントジョブに与えられた	コマンドラインオプションから自動的に構成された、すべての複雑なコマンドライン	オプションを付けたGhostscriptを実行させるPerlスクリプトである。	</p><p>	<a class="indexterm" name="id2656160"></a><a class="indexterm" name="id2656167"></a><a class="indexterm" name="id2656174"></a><a class="indexterm" name="id2656181"></a><a class="indexterm" name="id2656188"></a><a class="indexterm" name="id2656195"></a><a class="indexterm" name="id2656202"></a><a class="indexterm" name="id2656209"></a><a class="indexterm" name="id2656216"></a><a class="indexterm" name="id2656223"></a><a class="indexterm" name="id2656230"></a>	しかし、<em class="parameter"><code>cupsomatic</code></em>は現在廃止されている。そのPPD(特に	最初に生成したものは、そこで引き続き頻繁に使用される)は、Adobeの仕様に適合して	いない。Windowsクライアントに<span class="quote">“<span class="quote">ポイントアンドプリント</span>”</span>でそれらを	ダウンロード仕様とするときに困難に遭遇するかもしれない。よりよい、かつ	強力な解決方法は現在提供されている。それは、<em class="parameter"><code>foomatic-rip</code></em>	と呼ばれる。CUPSでフィルタとして<em class="parameter"><code>foomatic-rip</code></em>を使うために、	似たようだが異なった行を持つ、新しいタイプのPPDが必要である:</p><pre class="programlisting">*cupsFilter: "application/vnd.cups-postscript  0  foomatic-rip"</pre><p>	Linuxprinting.orgにあるPPD生成エンジンは修正された。新しいPPDはAdobeの仕様に	従っている。これらは異なった品質レベル(高解像度の写真、通常の色、グレースケールと	ドラフトモード)をシングルクリックで、5つまたはそれ以上の異なった選択(メディア	タイプ、解像度、インク種別とディザリングアルゴリズム)を要求できる新しい方法を	提供する。ビルトインされた固有のサイズのメディアサポートもある。ジョブの中間で、	ページ毎に印刷オプションを切り替えることのサポートもある。さらに、最もすばらしい	ことは、新しい<code class="constant">foomatic-rip</code>は、印刷時にPPDを使うための	アクセスに対するサポートを、すべての旧式なスプーラ(LPRng,BSD-LPD, PDQ, PPRなど)	に対してもシームレスに動作するということである。	</p></div><div class="sect2" title="完全な図解"><div class="titlepage"><div><div><h3 class="title"><a name="id2656311"></a>完全な図解</h3></div></div></div><p>	すべてのフィルタの概要とどのようにそれらが関連するかを知りたい場合、	パズルの完全な図解はこの章の最後にある。	</p></div><div class="sect2" title="mime.convs"><div class="titlepage"><div><div><h3 class="title"><a name="id2656326"></a><code class="filename">mime.convs</code></h3></div></div></div><p>	CUPSは与えられたMIMEタイプとインストールされたすべてのプリンタに対する可能な	すべてのフィルタリングチェーンパスを自動構築する。しかし、どのようにして	優先するものや特定の選択肢を決めるのであろうか(2つ以上の、同じターゲット	プリンタに対するフィルタリングチェーンが存在するような場合があるだろう)?	簡単である。mime-convファイルの3番目のカラム中にある数字に気がついたかも	しれない。それはこのフィルタに割り当てられている仮想コストを表現している。	すべての可能なフィルタリングチェーンは全体の<span class="quote">“<span class="quote">フィルタコスト</span>”</span>	として集計される。CUPSは最も<span class="quote">“<span class="quote">コストの小さい</span>”</span>ルートを選ぶ。	</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a class="indexterm" name="id2656376"></a><a class="indexterm" name="id2656383"></a>	<code class="filename">cupsd.conf</code>中で<em class="parameter"><code>FilterLimit 1000</code></em>を	設定すると、仮想フィルタコストが合計1000を消費するより多く、フィルタが同時に動く	ことを許可しない。これは適切な<span class="quote">“<span class="quote">FilterLimit</span>”</span>値を設定することにより	CUPSサーバの負荷を制限する効率的な方法である。200というFilterLimitの値はおおよそ	一度に1つのジョブを許可し、FilterLimitを1000にするとおおよそ最大5つのジョブが	同時に動作する。	</p></div></div><div class="sect2" title="“Raw”印刷"><div class="titlepage"><div><div><h3 class="title"><a name="id2656415"></a><span class="quote">“<span class="quote">Raw</span>”</span>印刷</h3></div></div></div><p><a class="indexterm" name="id2656425"></a><a class="indexterm" name="id2656431"></a><a class="indexterm" name="id2656438"></a>	CUPSに対して任意の<span class="quote">“<span class="quote">raw</span>”</span>ファイルを印刷(ほとんど)させることが出来る。	<span class="quote">“<span class="quote">raw</span>”</span>はフィルタされないことを意味する。CUPSは、プリンタがそれを理解	できる時に、思い悩まずに<span class="quote">“<span class="quote">そのまま</span>”</span>プリンタに対してファイルを送る。	ユーザは賢明なデータ形式のみをそれらに送る事について注意を払う必要がある。raw	形式の印刷は、もしも<span class="quote">“<span class="quote"><em class="parameter"><code>-o raw</code></em></span>”</span>オプションが	コマンド行上で指定されたときにどのキューにおいても発生する。任意のPPDを単に関連	づけない事によってrawのみのキューを設定することも出来る。以下のように行う:</p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>lpadmin -P rawprinter -v socket://11.12.13.14:9100 -E</code></strong></pre><p>	これは、<span class="quote">“<span class="quote">rawprinter</span>”</span>という<span class="quote">“<span class="quote">socket</span>”</span>プロトコル	(別名<span class="quote">“<span class="quote">HP JetDirect</span>”</span>)経由で接続してポート9100のIPアドレス	11.12.1.3.14のデバイスに接続するように設定する(もしもこのコマンド行に	<code class="literal">-P /path/to/PPD</code>を付けたPPDを追加したならば、	<span class="quote">“<span class="quote">通常の</span>”</span>印刷キューとしてインストールされる。	</p><p>	CUPSは、もしもキューに関連づけられるPPDを見いだせない場合、自動的に各ジョブを	<span class="quote">“<span class="quote">raw</span>”</span>と見なしてキューに送るように扱う。しかし、CUPSは既知の	MIMEタイプ(CUPSが持つmime.typesファイルで定義されている)のみを送り、それ以外は	拒否する。	</p></div><div class="sect2" title="application/octet-stream 印刷"><div class="titlepage"><div><div><h3 class="title"><a name="id2656535"></a>application/octet-stream 印刷</h3></div></div></div><p><a class="indexterm" name="id2656544"></a><a class="indexterm" name="id2656551"></a>	<code class="filename">/etc/cups/mime.types</code>ファイル中にルールがない任意のMIME	タイプは、unknownか<em class="parameter"><code>application/octet-stream</code></em>と	見なされ、送信されない。既定値で不明なMIMEタイプの印刷をCUPSが拒否するので、	Windowsクライアント由来の印刷ジョブが印刷されないということを経験するかも	しれない。以下のようなエラーメッセージがCUPSログファイル中に見つかるかもしれない:	</p><p><code class="computeroutput">	 Unable to convert file 0 to printable format for job	</code></p><p>	<em class="parameter"><code>application/octet-stream</code></em>の印刷を有効にするためには、以下の	2つのファイルを編集する:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">/etc/cups/mime.convs</code></p></li><li class="listitem"><p><code class="filename">/etc/cups/mime.types</code></p></li></ul></div><p><a class="indexterm" name="id2656624"></a>	両方とも<em class="parameter"><code>application/octet-stream</code></em>のためのrawモード操作を	有効にするためにコメントアウトしなければならないエントリ(それぞれのファイルの	最後の所)を含む。下記の行が<code class="filename">/etc/cups/mime.types</code>に存在する	ようにすること:	<a class="indexterm" name="id2656648"></a></p><pre class="programlisting">application/octet-stream</pre><p>	自動タイプルールセットが指定されていないこの行は、他の行で	<em class="parameter"><code>application/octet-stream</code></em>のメンバが自動タイプされていない	限り、全てのファイルを作成する。<code class="filename">/etc/cups/mime.convs</code>中では	以下のような行になる:</p><pre class="programlisting">application/octet-stream   application/vnd.cups-raw   0   -</pre><p>	<a class="indexterm" name="id2656685"></a>	この行はCUPSに、<em class="parameter"><code>application/octet-stream</code></em>上で	(<span class="quote">“<span class="quote">-</span>”</span>で示される、何もしない)<span class="emphasis"><em>Null Filter</em></span>	を使うことを指示し、<em class="parameter"><code>application/vnd.cups-raw</code></em>として	結果をタグづける。この最後の部分は、プリンタに接続しファイルを送信するための	バックエンドに向けてCUPSスケジューラがいつでも今あるファイルを引き渡せるように	している。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	<code class="filename">mime.convs</code>と<code class="filename">mime.types</code>ファイルの編集は	<span class="quote">“<span class="quote">raw</span>”</span>印刷を<span class="emphasis"><em>強制せず</em></span>、それを	<span class="emphasis"><em>許可する</em></span>のみである。	</p></div><p title="Background"><b>Background. </b><a class="indexterm" name="id2656755"></a><a class="indexterm" name="id2656762"></a><a class="indexterm" name="id2656769"></a><a class="indexterm" name="id2656776"></a>	そのCUPSは従来のものよりセキュリティに気を払っている印刷システムで、既定値では、	印刷デバイスに対して手の込んだ(おそらくバイナリ)データを送ることを誰にも許可して	いない(これは、使用しているプリンタに対してサービス不能攻撃をかける不正使用が	簡単にでき、少なくとも大量の紙とインクが無駄になることが発生する)。	<span class="quote">“<span class="quote">不明な</span>”</span>データはCUPSによって、<span class="emphasis"><em>MIMEタイプ</em></span>	<span class="emphasis"><em>application/octet-stream</em></span>と見なされる。	<span class="quote">“<span class="quote">raw</span>”</span>形式でデータを送ることが<span class="emphasis"><em>できる</em></span>場合、	それらのMIMEタイプは、CUPSとそれによって許可された、既知のもののどれかでなければ	ならない。<code class="filename">/etc/cups/mime.types</code>というファイルはCUPSが	どのようにMIMEタイプを認識するかの<span class="quote">“<span class="quote">規則</span>”</span>を定義する。	<code class="filename">/etc/cups/mime.convs</code>というファイルはどのファイル変換	フィルタがそのMIMEタイプに適用されるかを定義する。	</p></div><div class="sect2" title="非PostScriptプリンタのためのPostScriptプリンタ記述"><div class="titlepage"><div><div><h3 class="title"><a name="id2656839"></a>非PostScriptプリンタのためのPostScriptプリンタ記述</h3></div></div></div><p>	<a class="indexterm" name="id2656847"></a><a class="indexterm" name="id2656854"></a><a class="indexterm" name="id2656861"></a><a class="indexterm" name="id2656868"></a><a class="indexterm" name="id2656874"></a><a class="indexterm" name="id2656881"></a>	オリジナルのPPDはPostScriptプリンタのみに使われることを意図していた。それらは	ジョブファイルを処理する、RIPのためのデバイス固有のコマンドと設定を送るための	手助けとなる。CUPSはPPDに対するこのスコープを拡張し、非PostScriptプリンタにも	カバーするようにした。これが標準化されたファイル形式のために、これを行うのは	難しくない。その方法は論理的でもある:CUPSはPostScriptを取り扱い、ジョブファイルを	処理するためにPostScript RIP(Ghostscript)を使う。唯一の違いはPostScriptプリンタは	RIPを内蔵していて、その他のタイプのプリンタはホストコンピュータ上でGhostscript	のRIPを動かすと言うことである。	</p><p>	非PostScriptプリンタに対するPPDはCUPS固有のいくつかの行を持っている。最も	重要なものは下記と似たようなものである:	<a class="indexterm" name="id2656925"></a></p><pre class="programlisting">*cupsFilter: application/vnd.cups-raster  66   rastertoprinter</pre><p>	これが CUPS フィルタリングの最後の難所のひとつである。この行では、CUPSデーモンに	対して、<em class="parameter"><code>rastertoprinter</code></em>を最後のフィルタとして使うように	設定している。このフィルタは <em class="parameter"><code>application/vnd.cups-raster</code></em>	というMIMEタイプのファイルが入力の際に用いられることになる。CUPSは指定されたMIME	タイプを最終的な出力とするようなフィルタのチェインを自動的に生成する。	次にこれは指定された<em class="parameter"><code>rastertoprinter</code></em>フィルタのための入力と	なる。最後のフィルタが処理を終えた後(<em class="parameter"><code>rastertoprinter</code></em>は	Gutenprintフィルタである)、ファイルは、出力デバイスに送信を行うバックエンドに	送られる。	</p><p>	CUPSが提供しているPPDは数少ないが、プリンタモデルは数多くある。異なった紙の	トレイや指定されたモデルがサポートしているよりもより大きなマージンを取ることが	出来ないかもしれない。要約は表21.1<a class="link" href="CUPS-printing.html#cups-ppds" title="Table 22.1. CUPSに同梱されているPPD">“CUPSに同梱されているPPD”</a>を参照。	</p><div class="table"><a name="cups-ppds"></a><p class="title"><b>Table 22.1. CUPSに同梱されているPPD</b></p><div class="table-contents"><table summary="CUPSに同梱されているPPD" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="left">PPDファイル</th><th align="justify">プリンタタイプ</th></tr></thead><tbody><tr><td align="left">deskjet.ppd</td><td align="justify">古いHP inkjetプリンタとその互換</td></tr><tr><td align="left">deskjet2.ppd</td><td align="justify">新しいHP inkjetプリンタとその互換</td></tr><tr><td align="left">dymo.ppd</td><td align="justify">labelプリンタ</td></tr><tr><td align="left">epson9.ppd</td><td align="justify">エプソン9-ピンインパクトプリンタとその互換</td></tr><tr><td align="left">epson24.ppd</td><td align="justify">エプソン 24-ピンインパクトプリンタとその互換</td></tr><tr><td align="left">okidata9.ppd</td><td align="justify">Okidata 9-ピンインパクトプリンタとその互換</td></tr><tr><td align="left">okidat24.ppd</td><td align="justify">Okidata 24-ピンインパクトプリンタとその互換</td></tr><tr><td align="left">stcolor.ppd</td><td align="justify">古いエプソン Stylusカラープリンタ</td></tr><tr><td align="left">stcolor2.ppd</td><td align="justify">新しいエプソン Stylusカラープリンタ</td></tr><tr><td align="left">stphoto.ppd</td><td align="justify">古いエプソン Stylus Photoプリンタ</td></tr><tr><td align="left">stphoto2.ppd</td><td align="justify">新しいエプソン Stylus Photoプリンタ</td></tr><tr><td align="left">laserjet.ppd</td><td align="justify">すべての PCL プリンタ</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="cupsomatic/foomatic-rip 対 ネイティブなCUPS印刷"><div class="titlepage"><div><div><h3 class="title"><a name="id2657164"></a><span class="emphasis"><em>cupsomatic/foomatic-rip</em></span> 対 <span class="emphasis"><em>ネイティブなCUPS</em></span>印刷</h3></div></div></div><p>	<a class="indexterm" name="id2657179"></a>	<a class="indexterm" name="id2657185"></a>	ネイティブなCUPSラスタライズ作業は2つのステップに分かれている:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2657202"></a>		最初のものは、<em class="parameter"><code>pstoraster</code></em>ステップである。これは、		ESP Ghostscript 7.05.xからの特別なCUPSデバイスを、そのツールとして使う。		<a class="indexterm" name="id2657218"></a>		</p></li><li class="listitem"><p>		二番目のものは<em class="parameter"><code>rasterdriver</code></em>ステップである。これは、		種々のデバイス固有のフィルタを使う。このステップに対して良い品質をもつ		フィルタを提供するいくつかのベンダがある。それらのいくつかはフリー		ソフトウェアであり、いくつかはシェアウェアであり、いくつかは商用製品である。		</p></li></ul></div><p>	しばしばこれは、その他の方法よりもより良い品質のものを生成する(そして、	いくつかのより優位な点がある)。これについては	<a class="link" href="CUPS-printing.html#cupsomatic-dia" title="Figure 22.10. cupsomatic/foomaticの処理対ネイティブなCUPSの図">cupsomatic/foomaticの処理対ネイティブなCUPSの図</a>	に図解がある。	</p><div class="figure"><a name="cupsomatic-dia"></a><p class="title"><b>Figure 22.10. cupsomatic/foomaticの処理対ネイティブなCUPSの図</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/10small.png" alt="cupsomatic/foomaticの処理対ネイティブなCUPSの図"></div></div></div><br class="figure-break"><p>	1つの他の方法は、<em class="parameter"><code>cupsomatic/foomatic-rip</code></em>によるものである。	<em class="parameter"><code>cupsomatic</code></em>は、決してCUPS開発者によって	<span class="emphasis"><em>作られたものではない</em></span>ということに注意。これは、印刷環境に	対する独立した貢献であり、Linuxprinting.orgの人々によって作られたものである。	<sup>[<a name="id2657339" href="#ftn.id2657339" class="footnote">6</a>]</sup>	<em class="parameter"><code>cupsomatic</code></em>はもはや開発、メンテナンス、サポートされいない。	これは現在 <em class="parameter"><code>foomatic-rip</code></em>によって置き換えられている。	<em class="parameter"><code>foomatic-rip</code></em>は古い<em class="parameter"><code>cupsomatic</code></em>の	アイデアを完全に書き換えたものであるが、とても改善され、他の(非CUPS)スプーラに	対して汎用化されている。 <em class="parameter"><code>foomatic-rip</code></em>へのアップグレードは、	特にもしも最新バージョンのCUPSにアップグレードするならば強く推奨される。	</p><p>	<a class="indexterm" name="id2657393"></a>	<a class="indexterm" name="id2657399"></a>	古い<em class="parameter"><code>cupsomatic</code></em>のように、(新しい)Linuxprinting.orgが使う	現代的なGhostscript印刷処理からの<em class="parameter"><code>foomatic-rip</code></em>は、すべてを	単一のステップで行う。従ってそれはGhostscript中に組み込まれる他のすべての	デバイスに依存する。他のスプーラでのGhostscriptのレンダリングと同じくらい	品質は良い(あるいは悪い)。優位点は、この方法は、より最新のCUPSによる方法によって	(まだ)サポートされていない、たくさんのプリンタモデルをサポートするということで	ある。	</p><p>	もちろん、あるシステムで並列に両方の手法を使うことが出来(もしも異なったキューを	設定するならば1つのプリンタに対しても)、どれが一番うまく動作するかを見いだせる。	</p><p><a class="indexterm" name="id2657451"></a><a class="indexterm" name="id2657458"></a><a class="indexterm" name="id2657464"></a><a class="indexterm" name="id2657471"></a><a class="indexterm" name="id2657478"></a><a class="indexterm" name="id2657485"></a>	<em class="parameter"><code>cupsomatic</code></em>は印刷ファイルを	<em class="parameter"><code>application/vnd.cups-postscript</code></em>ステージ後に捕まえ、	システム全体でインストールされたGhostscriptである、CUPS-externalを通してそれを	横取りする。その結果、印刷ファイルは<em class="parameter"><code>pstoraster</code></em>フィルタ	をバイパスする(さらにCUPSラスタドライバ<em class="parameter"><code>rastertosomething</code></em>も	バイパスする)。Gostscriptがラスタライズ処理を終えた後、	<em class="parameter"><code>cupsomatic</code></em>はレンダリングされたファイルディレクトリをCUPS	バックエンドに渡す。	<a class="link" href="CUPS-printing.html#cupsomatic-dia" title="Figure 22.10. cupsomatic/foomaticの処理対ネイティブなCUPSの図">cupsomatic/foomaticの処理対ネイティブなCUPS</a>	にはネイティブなCUPSレンダリングと<em class="parameter"><code>Foomatic/cupsomatic</code></em>手法の	違いについて図解している。	</p></div><div class="sect2" title="フィルタリングチェインの例"><div class="titlepage"><div><div><h3 class="title"><a name="id2657549"></a>フィルタリングチェインの例</h3></div></div></div><p>	以下は、CUPSの動作を図解するための、よくあるフィルタリングチェインの例である。	</p><p><a class="indexterm" name="id2657565"></a><a class="indexterm" name="id2657572"></a><a class="indexterm" name="id2657579"></a><a class="indexterm" name="id2657586"></a>	HP JetDirect接続のPostScriptプリンタにPDFファイルを印刷しようとしていることを	仮定するが、ページ3-5,7と11-13のみを印刷したく、更にそれを<span class="quote">“<span class="quote">2アップ</span>”</span>	と<span class="quote">“<span class="quote">両面印刷</span>”</span>にしたいとする:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>使用する印刷オプション(要求されたページの選択、2アップ、両面印刷)	は、コマンドライン上でCUPSに渡される。</p></li><li class="listitem"><p>(完全な)PDFファイルがCUPSに送られ、	<em class="parameter"><code>application/pdf</code></em>として自動タイプされる。</p></li><li class="listitem"><p>その結果ファイルはPostScript MIMEタイプである	<em class="parameter"><code>application/postscript</code></em>(ここでのプレビューは引き続き	オリジナルのPDFファイルのすべてのページを表示する)を生成する	<em class="parameter"><code>pdftops</code></em>prefilterに、最初に渡さねばならない。</p></li><li class="listitem"><p>ファイルは次にコマンドラインオプションを適用する	<em class="parameter"><code>pstops</code></em>フィルタに渡される:これはページ2-5,7と11-13を	選択し、<span class="quote">“<span class="quote">1枚のページ上に2つのページ</span>”</span>という合成されたレイアウトを	作成し、正しい<span class="quote">“<span class="quote">両面印刷</span>”</span>コマンド(プリンタのPPD中で定義されている)	を、新しいPostScriptファイルに挿入する。ファイルはこの時点でPostScript MIME	タイプ<em class="parameter"><code>application/vnd.cups-postscript</code></em>となる。</p></li><li class="listitem"><p>ファイルは、プリンタにジョブを転送する	<em class="parameter"><code>ソケット</code></em>バックエンドに送られる。</p></li></ul></div><p>	フィルタリングチェーンの結果は以下の	<a class="link" href="CUPS-printing.html#pdftosocket" title="Figure 22.11. PDFからソケットへのチェーン">PDFからソケットへのチェーンの模式図</a>のようになる。	</p><a class="indexterm" name="id2657715"></a><div class="figure"><a name="pdftosocket"></a><p class="title"><b>Figure 22.11. PDFからソケットへのチェーン</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/pdftosocket.png" alt="PDFからソケットへのチェーン"></div></div></div><br class="figure-break"><p><a class="indexterm" name="id2657766"></a><a class="indexterm" name="id2657773"></a><a class="indexterm" name="id2657780"></a>	CUPS<code class="filename">stphoto2.ppd</code>をインストールした、USB接続の	Epson Stylus Photo Printerに同じフィルタで印刷したいと仮定しよう。最初の	いくつかのフィルタリングステージはおおよそ同じである:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>		印刷オプション(要求されたページの選択、2アップ、両面印刷)は、		コマンドラインでCUPSに渡される。		</p></li><li class="listitem"><p>		(完全な)PDFファイルはCUPSに送られて、		<em class="parameter"><code>application/pdf</code></em>と自動タイプされる。		</p></li><li class="listitem"><p><a class="indexterm" name="id2657825"></a><a class="indexterm" name="id2657832"></a>		ファイルは、最初に、		PostScript MIMEタイプ<em class="parameter"><code>application/postscript</code></em>を		生成する<em class="parameter"><code>pdftops</code></em>prefilterに渡されなければならない		(ここでのプレビューは引き続きオリジナルのPDFのすべてのページを表示する)。		</p></li><li class="listitem"><p><a class="indexterm" name="id2657862"></a><a class="indexterm" name="id2657869"></a>		ファイルは次にコマンドラインオプションを適用する<span class="quote">“<span class="quote">pstops</span>”</span>		フィルタに送られる。ここでページ2-5,7と11-13を選択し、		<span class="quote">“<span class="quote">一枚の紙の上に2ページを</span>”</span>合成し、正しい<span class="quote">“<span class="quote">両面印刷</span>”</span>		コマンド(おっと、このプリンタとPPDは両面印刷をサポートしていないので、		このオプションは無視される)を新しいPostScriptファイルに挿入する。		ファイルはこの時点でPostScript MIMEタイプ		<em class="parameter"><code>application/vnd.cups-postscript</code></em>となる。		</p></li><li class="listitem"><p>		ファイルは次に<em class="parameter"><code>pstoraster</code></em>ステージに送られ、MIME		タイプが<em class="parameter"><code>application/cups-raster</code></em>となる。		</p></li><li class="listitem"><p><a class="indexterm" name="id2657931"></a>		最後に、<em class="parameter"><code>rastertoepson</code></em>フィルタは、その処理を行い		(プリンタのPPD中で示されるように)、プリンタ固有のラスタデータを生成し、		ユーザが選択した任意の印刷オプションを、印刷データストリーム中に		埋め込む。		</p></li><li class="listitem"><p>		ファイルは、ジョブをプリンタに転送する<em class="parameter"><code>usb</code></em>		バックエンドに送られる。		</p></li></ul></div><p>	フィルタリングチェーンの結果は	<a class="link" href="CUPS-printing.html#pdftoepsonusb" title="Figure 22.12. PDFからUSBチェーン">PDFからUSBチェーンへの模式図</a>のようになる。	</p><div class="figure"><a name="pdftoepsonusb"></a><p class="title"><b>Figure 22.12. PDFからUSBチェーン</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/pdftoepsonusb.png" alt="PDFからUSBチェーン"></div></div></div><br class="figure-break"></div><div class="sect2" title="CUPSドライバ/PPDの提供元"><div class="titlepage"><div><div><h3 class="title"><a name="id2658023"></a>CUPSドライバ/PPDの提供元</h3></div></div></div><p>	インターネット上でたくさんのCUPS-PPDファイルを(それに適したフィルタと一緒に)、	たくさんの言語環境で、1000以上の非PostScriptモデル用をサポートしているものを	見つけることが出来る。	</p><div class="itemizedlist"><a class="indexterm" name="id2658043"></a><a class="indexterm" name="id2658052"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p>		<a class="ulink" href="http://www.easysw.com/printpro/" target="_top">ESP PrintPro</a>		(商用、自由ではない)は、3000以上のPPDをパッケージしていて、		Linux, Mac OS X, IBM-AIX,HP-UX, Sun-Solaris, SGI-IRIX, Compaq Tru64,		Digital UNIXと他の商用UNIX上での<span class="quote">“<span class="quote">外部ドライバ</span>”</span>として使える		(これは、CUPS開発者それ自身で書かれていて、その売り上げは		開発者を食べさせるという形で、将来のCUPS開発費用を助ける)。		</p></li><li class="listitem"><p>		<a class="ulink" href="http://gimp-print.sourceforge.net/" target="_top">Gutenprint Project</a>		(GPL、フリーソフトウェア)は140ほどのPPDを提供し(おおよそ400のプリンタを		サポートしていて、多くは写真品質出力を提供する)、Gutenprint CUPS		ドライバと共に使われる。		</p></li><li class="listitem"><p>		<a class="ulink" href="http://www.turboprint.de/english.html/" target="_top">TurboPrint </a>		(シェアウェア、自由ではない)は、とても良い品質で、おおよそ、プリンタの数と		同じくらいのサポートがある。		</p></li><li class="listitem"><p>		<a class="ulink" href="http://www-124.ibm.com/developerworks/oss/linux/projects/omni/" target="_top">OMNI </a>		(LGPL、自由)は、IBMによって作られたパッケージで、現在400以上のプリンタ		サポートを含み、IBM OS/2のノウハウの遺産をLinux上に移植している		(CUPSサポートは現在β状態である)。		</p></li><li class="listitem"><p>		<a class="ulink" href="http://hpinkjet.sourceforge.net/" target="_top">HPIJS </a> (BSD系のライセンス、自由)		は、おおよそ150のHP製プリンタをサポートし、優れた印刷品質をも提供する		(現在Foomaticパス経由でのみ有効)。		</p></li><li class="listitem"><p>		<a class="ulink" href="http://www.linuxprinting.org/" target="_top">Foomatic/cupsomatic </a>		(LGPL、自由)は、Linuxprinting.orgからのもので、(Omni、GunenprintとHPIJS		を含む)世界中に知られているほとんどすべての各Ghostscriptフィルタ用の		PPDを提供する。		</p></li></ul></div></div><div class="sect2" title="インタフェーススクリプトを伴う印刷"><div class="titlepage"><div><div><h3 class="title"><a name="id2658176"></a>インタフェーススクリプトを伴う印刷</h3></div></div></div><p><a class="indexterm" name="id2658185"></a><a class="indexterm" name="id2658191"></a>	CUPSはまたSystemV AT&T印刷システムからとして知られている	<span class="quote">“<span class="quote">interface scripts</span>”</span>の使用もサポートしている。それらはしばしば	PCL印刷ジョブを生成するアプリケーションから、PCLプリンタにおいて使われる。	interface scriptsはプリンタモデルに特化している。これらはPostScriptプリンタの	ためのPPDと同様の役割を持っている。interface scriptsは、たとえば、もしも	ユーザが特定のペーパートレイを選択したか、紙の方向を変更したかA3用紙を	しようするような場合、印刷データストリーム中に要求されたESCシーケンスを	追加してもよい。interface scriptsはLinux領域ではほとんど知られていない。	HP-UXプラットフォームでは、もう少し使われている。動作する任意の	interface scriptsをCUPS上で一緒に使うことも可能である。以下のように、	<code class="literal">-i</code>を使ってインストールする:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>lpadmin -p pclprinter -v socket://11.12.13.14:9100 \          -i /path/to/interface-script</code></strong></pre><p>	interface scriptsは多くの人にとって<span class="quote">“<span class="quote">未知の動物</span>”</span>かもしれない。	しかし、これは、CUPSと共に使うことで、ある特定の印刷キューに対する、固有の、	専用として記述した、フィルタリングスクリプトやプログラムを組み込む最も簡単な	方法を提供する(現代的なinterface scriptsの使い方に関するいくつかの情報は、	<a class="ulink" href="http://playground.sun.com/printing/documentation/interface.html" target="_top">        http://playground.sun.com/printing/documentation/interface.html</a>にある)。	</p></div></div><div class="sect1" title="ネットワーク印刷(Windowsのみ)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2658282"></a>ネットワーク印刷(Windowsのみ)</h2></div></div></div><p>ネットワーク印刷は多くの分野をカバーしている。Windowsクライアントのために印刷するときSamba上で何が起こるかを正確に理解するために、まず初めに、Windows NTサーバと共に使うWindowsクライアントという、<span class="quote">“<span class="quote">Windowsのみ</span>”</span>の設定を見てみよう。</p><div class="sect2" title="WindowsクライアントからNT印刷サーバへ"><div class="titlepage"><div><div><h3 class="title"><a name="id2658305"></a>WindowsクライアントからNT印刷サーバへ</h3></div></div></div><p>WindowsクライアントからNTベースの印刷サーバへの印刷は、2つのオプションがある。それらは以下の2つである:<a class="indexterm" name="id2658320"></a><a class="indexterm" name="id2658326"></a></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ドライバをローカルに実行し、GDI出力(EMF)を、使用している	    プリンタに対するプリンタ固有の形式に描画する。	</p></li><li class="listitem"><p>プリンタ固有の出力に描画するためにドライバが実行されたときに、	    GDI出力(EMF)をサーバに送る。	</p></li></ul></div><p>両方の印刷パスは<a class="link" href="CUPS-printing.html#small11" title="Figure 22.13. クライアント上での印刷ドライバの実行">クライアント上での印刷ドライバの実行</a>と<a class="link" href="CUPS-printing.html#small12" title="Figure 22.14. Print Driver Execution on the Server.">サーバ上での印刷ドライバの実行</a>というフローチャートで図示されている。</p></div><div class="sect2" title="クライアント上でのドライバの実行"><div class="titlepage"><div><div><h3 class="title"><a name="id2658375"></a>クライアント上でのドライバの実行</h3></div></div></div><p>最初の場合、印刷サーバはraw形式でファイルをスプールせねばならない。これはジョブファイルにさわらず、何らの方法での変換もしないことを意味する。これは、現代的なUNIXベースの印刷サーバが同じように行えることでもあり、NT印刷サーバよりもよりよいパフォーマンスとより信頼性がある。これは、おそらくほとんどのSamba管理者が慣れ親しんでいるものである。この設定の1つの利点は、この<span class="quote">“<span class="quote">スプールのみ</span>”</span>の印刷サーバが、UNIX用のドライバがない場合にも使えるかもしれないと言うことである。これは、有効なWindowsクライアントドライバがあり、クライアントにインストールされていれば十分である。これは<a class="link" href="CUPS-printing.html#small11" title="Figure 22.13. クライアント上での印刷ドライバの実行">クライアント上での印刷ドライバの実行ダイアグラム</a>で図示されている。</p><div class="figure"><a name="small11"></a><p class="title"><b>Figure 22.13. クライアント上での印刷ドライバの実行</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/11small.png" alt="クライアント上での印刷ドライバの実行"></div></div></div><br class="figure-break"></div><div class="sect2" title="サーバ上でのドライバの実行"><div class="titlepage"><div><div><h3 class="title"><a name="id2658453"></a>サーバ上でのドライバの実行</h3></div></div></div><p><a class="indexterm" name="id2658461"></a><a class="indexterm" name="id2658468"></a><a class="indexterm" name="id2658475"></a><a class="indexterm" name="id2658482"></a><a class="indexterm" name="id2658488"></a>他のパスはサーバ上でプリンタドライバを実行する。クライアントはサーバにEMF形式で印刷ファイルを送る。サーバはPostScript, PCL, ESC/Pか他のドライバを、EMFファイルをプリンタ固有の言語に変換するために使う。同じ事はUNIX上ではできない。現在、プリンタが理解できるものに、UNIXサーバ上でWindowsクライアントのGDI出力を変換するプログラムか手法はない。これは<a class="link" href="CUPS-printing.html#small12" title="Figure 22.14. Print Driver Execution on the Server.">サーバ上での印刷ドライバの実行ダイアグラム</a>で図示されている。</p><div class="figure"><a name="small12"></a><p class="title"><b>Figure 22.14. Print Driver Execution on the Server.</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/12small.png" alt="Print Driver Execution on the Server."></div></div></div><br class="figure-break"><p>しかし、似たようなものはCUPSで可能なので、引き続き読むこと。</p></div></div><div class="sect1" title="ネットワーク印刷(WindowsクライアントとUNIX/Samba印刷サーバ)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2658564"></a>ネットワーク印刷(WindowsクライアントとUNIX/Samba印刷サーバ)</h2></div></div></div><p>UNIX印刷サーバがそのプラットフォーム上でWin32プログラムコードを<span class="emphasis"><em>実行できない</em></span>ので、絵は若干異なる。しかしながら、これは、それほど選択権を制限するものではない。それどころか、他では不可能な印刷機能を実装することができるかもしれない。</p><div class="sect2" title="WindowsクライアントからCUPS/Samba印刷サーバへ"><div class="titlepage"><div><div><h3 class="title"><a name="id2658585"></a>WindowsクライアントからCUPS/Samba印刷サーバへ</h3></div></div></div><p>Windowsネットワーク印刷クライアントに対する、CUPSの強力な機能の利点をどのように利用するかを示す簡単なレシピである:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>WindowsクライアントにPostScriptをCUPSサーバに送らせる。	</p></li><li class="listitem"><p>CUPSサーバにPostScriptをドライバ固有のラスタフォーマットに変換させる。</p></li></ul></div><p>これは、クライアントにPostScriptドライバ(プリンタが非PostScriptモデルであっても。CUPSサーバ上でのドライバがあることも要求する)を使うことを要求する。</p><p>最初に、Samba経由でのCUPSベースの印刷を有効にするため、以下のオプションを<code class="filename">smb.conf</code>ファイルの<em class="parameter"><code>[global]</code></em>セクションに設定すべきである:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2658655"></a><em class="parameter"><code>printing = cups</code></em></td></tr><tr><td><a class="indexterm" name="id2658666"></a><em class="parameter"><code>printcap = cups</code></em></td></tr></table><p>これらのパラメータが指定されると、<code class="filename">smb.conf</code>中の(Sambaそれ自身と同様)、すべての手動設定した印刷ディレクティブ(たとえば<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command</a>か<a class="link" href="smb.conf.5.html#LPPAUSECOMMAND" target="_top">lppause command</a>)は無視される。その代わりSambaは、SambaがCUPSライブラリ(libcups)をサポートするようにコンパイルされているとき、CUPS APIを通してCUPSと直接やりとりする。他の印刷コマンドが設定されていない場合、印刷は、-orawオプションを自動的に付けてパススルーする、<span class="emphasis"><em>System V</em></span>AT&Tコマンドセットを使う(もし、コンパイル時にCUPSサポートをするようしたSambaサーバで動作するよう、個別に定義した印刷コマンドを使いたい場合、単に<a class="link" href="smb.conf.5.html#CLASSICALPRINTING" target="_top">classicalprinting = sysv</a>を使う)。これは<a class="link" href="CUPS-printing.html#13small" title="Figure 22.15. CUPS/Sambaサーバ経由での印刷">CUPS/Sambaサーバ経由での印刷ダイアグラム</a>で図示されている。</p><div class="figure"><a name="13small"></a><p class="title"><b>Figure 22.15. CUPS/Sambaサーバ経由での印刷</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/13small.png" alt="CUPS/Sambaサーバ経由での印刷"></div></div></div><br class="figure-break"></div><div class="sect2" title="Sambaによるジョブファイルの受け取りとCUPSへの引き渡し"><div class="titlepage"><div><div><h3 class="title"><a name="id2658801"></a>Sambaによるジョブファイルの受け取りとCUPSへの引き渡し</h3></div></div></div><p>Sambaはそれ固有のスプールディレクトリ(<a class="link" href="smb.conf.5.html#PATH" target="_top">path = /var/spool/samba</a>に類似したもので設定される)を、<code class="filename">smb.conf</code>の<em class="parameter"><code>[printers]</code></em>か<em class="parameter"><code>[printername]</code></em>セクション中で<span class="emphasis"><em>使わなければならない</em></span>。Sambaは固有スプール空間にジョブを受け取り、CUPSのスプールディレクトリ(CUPSのスプールディレクトリは、既定値が<em class="parameter"><code>RequestRoot /var/spool/cups</code></em>である、<em class="parameter"><code>RequestRoot</code></em>ディレクティブ行で設定される)中に渡す。CUPSはそのスプールディレクトリのアクセス権限を検査し、毎回の再起動に備えて適切な値にそれをリセットする。SambaとCUPSで共通のスプール空間を使う例は滅多に見たことがなく、何週間もこの<span class="quote">“<span class="quote">問題</span>”</span>と苦闘してきた。</p><p>WindowsユーザはSambaでのみ認証する(構成されるどんな手段でも)。もしもSambaがCUPSと同じホストで動作しているならば、印刷においては<span class="quote">“<span class="quote">localhost</span>”</span>のみ許可しなければならない。もしも異なったマシンで動作しているならば、CUPSで印刷できるように、Sambaホストがアクセス権を得られるようにしておかねばならない。</p></div></div><div class="sect1" title="ネットワーク PostScript RIP"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2658898"></a>ネットワーク PostScript RIP</h2></div></div></div><p>この節では、クライアントがCUPS-PPDと一緒にPostScriptドライバを使うようにさせる、サーバの設定上でのCUPSフィルタの使い方について議論する。</p><p><a class="indexterm" name="id2658918"></a><a class="indexterm" name="id2658924"></a><a class="indexterm" name="id2658930"></a>PPDはすべての印刷デバイスオプションを制御できる。もしも、固有のPostScriptプリンタを持っているならば、すなわちこれらは通常開発元によって提供される。PPDファイルは、つねに、Microsoft WindowsまたはApple Mac OSシステム上でのPostScriptプリンタドライバのコンポーネントである。それらはユーザが選択できる印刷オプション、適切なPostScriptへのマッピング、対象プリンタ用のPCLあるいはPJLコマンドを含むASCIIファイルである。プリンタドライバGUIダイアログはこれらのオプションを<span class="quote">“<span class="quote">その場で</span>”</span>ユーザが選択できる、ボタンとドロップダウンリストに変換する。</p><p>CUPSは、何らの変換なしに、任意のWindows(NTが推奨される)PostScriptドライバからのPPDファイルロードでき、それらのオプションを扱える。印刷オプションのためのWebブラウザインタフェース(<a class="ulink" href="http://localhost:631/printers/" target="_top">http://localhost:631/printers/</a>を選択し、そこにある<span class="guibutton">Configure Printer</span>ボタンをクリック)か、コマンドラインインタフェース(<code class="literal">man lpoptions</code>か、システム上にあるならば、<code class="literal">lphelp</code>を参照)がある。これらはユーザへのPPDオプションを提供出来るLinux/UNIX上のGUIフロントエンドとは若干異なる。PPDオプションは通常、実際ののPostScriptプリンタ上のPostScript RIPによって評価される事を意味する。</p><div class="sect2" title="UNIX上の、非PSプリンタのためのPPD"><div class="titlepage"><div><div><h3 class="title"><a name="id2659014"></a>UNIX上の、非PSプリンタのためのPPD</h3></div></div></div><p><a class="indexterm" name="id2659023"></a>CUPSはそのPPDの使用にあたっては<span class="quote">“<span class="quote">実際の</span>”</span>PostScriptプリンタだけにに制限されない。CUPS開発者は非PostScriptプリンタに対してもCUPS-PPDを使って有効なデバイスとドライバオプションを記述するPPDコンセプトの範囲を拡張した。</p><p>CUPSは完全なPostScriptインタプリタ(RIP)を含んでいるため、これは合理的である。RIPはGhostScriptをベースにしている。これはクライアントからすべてのPostScript(と更に追加で、その他のファイル形式)を受け取り処理できる。すべてのCUPS-PPDは、キーワード<em class="parameter"><code>*cupsFilter</code></em>で始まる追加の行を含んでいると非PostScriptプリンタにギアを切り替える。この行はCUPS印刷システムに、受け取ったPostScriptを解釈するためのプリンタ固有のフィルタを使うように告げる。そのため、そのプリンタに対してPostScript RIPとして振る舞うことが出来るため、そのクライアントに対してPostScriptデバイスとしてそのすべてのプリンタを見せるようにし、受け取ったPostScriptコードを適切なラスタ印刷形式に処理する。</p></div><div class="sect2" title="Windows上の非PostScriptプリンタのためのPPD"><div class="titlepage"><div><div><h3 class="title"><a name="id2659083"></a>Windows上の非PostScriptプリンタのためのPPD</h3></div></div></div><p><a class="indexterm" name="id2659093"></a>Windowsクライアントでは<span class="quote">“<span class="quote">中核の</span>”</span>PostScript ドライバに加えて CUPS-PPD も利用可能である。（ただし現在は CUPS PostScriptDriver for Windows NT/200x/XP が推奨されている。これを使うと、制限付きながら Adobe のドライバが利用できる）。CUPS-PPD を使う場合、他のスプーラではできない機能のいくつかを CUPS が利用できるようになる。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	統一した方法で、すべてのクライアントプラットフォームから、ネットワーク対応の	印刷ファイルを扱うPostScript RIPとして振る舞う。	</p></li><li class="listitem"><p>	すべてのファイルがpstopフィルタを通し、その結果<code class="filename">page_log</code>に	記録されるため、CUPSの集中アカウント件請求サーバとして振る舞う。	<span class="emphasis"><em>注意:</em></span>これは、常時定義毎にフィルタなしが存在するため、	<span class="quote">“<span class="quote">raw</span>”</span>印刷ジョブでは該当しない。	</p></li><li class="listitem"><p>	たくさんの異なった対象プリンタがあっても、クライアントが、単一のPostScript	ドライバに集約することが出来るようになる。	</p></li></ul></div><p>Windowsクライアント上のCUPS PPDを使うと、すべての印刷ジョブ設定をUNIXクライアントが出来るように制御する事が出来るようになる。</p></div></div><div class="sect1" title="CUPSクライアントとしてのWindowsターミナルサーバ (WTS)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2659174"></a>CUPSクライアントとしてのWindowsターミナルサーバ (WTS)</h2></div></div></div><p>この設定は、WTS環境で大きな問題を体験している人にとって、特別な興味を引くかもしれない。WTSはしばしば、そのクライアントの数多くのプリンタモデルを動かすために､多数の非PostScriptプリンタドライバをインストールする必要がある。これはしばしば非常に不安定性を増大させる。</p><div class="sect2" title="“カーネルモード”でのプリンタドライバの実行は多くの問題を引き起こす"><div class="titlepage"><div><div><h3 class="title"><a name="id2659195"></a><span class="quote">“<span class="quote">カーネルモード</span>”</span>でのプリンタドライバの実行は多くの問題を引き起こす</h3></div></div></div><p><span class="quote">“<span class="quote">カーネルモード</span>”</span>で動作するWindows NTプリンタドライバは、ドライバが安定せず、よくテストされていない場合には、システムの安定性にとって高いリスクとなる。そして、できの悪いドライバはたくさんあるのである!特に、悪名高いものは、ジョブの終了時にサウンドカード経由でユーザに通知を行う追加のサウンドモジュールが動くものを持っているPCLドライバが例である。通常使っていて、<span class="quote">“<span class="quote">ブルースクリーン</span>”</span>をこれが出してしまうと言うことを言う必要があるだろうか?</p><p>PostScriptドライバは一般的によくテストされている。カーネルモードで動作したとしても、それらが何かの問題を引き起こすことは知られていない。これは2つの異なったPostScriptドライバが現在存在しているという事によるのかもしれない。1つはAdobeのものであり、もう1つはMicrosoftのものである。両方ともよくテストされ、Windows上で想像できるように安定している。CUPSドライバはマイクロソフトのもの由来である。</p></div><div class="sect2" title="Workarounds Impose Heavy Limitations"><div class="titlepage"><div><div><h3 class="title"><a name="id2659249"></a>Workarounds Impose Heavy Limitations</h3></div></div></div><p>回避方法として、サイト管理者は、WTS上にインストールされる許可されたドライバを、1つの汎用PCLと1つのPostScriptドライバだけに制限するという方針を選んだ。しかしこれは、クライアントが使う事が出来るたくさんの印刷オプションを制限することになる。異なったドライバによって制御される場合、そのデバイスはより良い動作が出来るはずが、しばしば、1つの標準ペーパトレイでの単純な印刷よりも複雑なことが出来なくなる!</p></div><div class="sect2" title="CUPS: A “Magical Stone”?"><div class="titlepage"><div><div><h3 class="title"><a name="id2659270"></a>CUPS: A <span class="quote">“<span class="quote">Magical Stone</span>”</span>?</h3></div></div></div><p><a class="indexterm" name="id2659281"></a><a class="indexterm" name="id2659288"></a>PostScriptドライバを使い、CUPS-PPDを有効にすることは、すべてのこれらの欠点を解決するとてもエレガントな方法に見える。これらは使用するWindows OSバージョンに依存する、最大3つの異なったドライバ、すなわちAdobe、MicrosoftとCUPS PostScriptドライバが現在有効である。WTS上で大きな安定性の問題を引き起こすことは、上記3つのどれも知られていない(たとえ、たくさんの異なったPPDを使ったとしても)。クライアントは(再度)ペーパトレイ、両面印刷やその他の設定を選択できる。しかし、確かな代価もある:そのクライアントに対して、CUPSサーバはPostScript RIPとして振る舞い、<span class="quote">“<span class="quote">raw スプール</span>”</span>デバイスとして振る舞うよりもよりCPUとメモリを必要とする。更に、この設定は、最初のフィードバックがとても有望ではあるが、広範囲にはテストされていない。</p></div><div class="sect2" title="カーネルモードでもPostScriptドライバは大きな問題はない"><div class="titlepage"><div><div><h3 class="title"><a name="id2659331"></a>カーネルモードでもPostScriptドライバは大きな問題はない</h3></div></div></div><p><a class="indexterm" name="id2659340"></a><a class="indexterm" name="id2659347"></a><a class="indexterm" name="id2659353"></a><a class="indexterm" name="id2659360"></a><a class="indexterm" name="id2659367"></a><a class="indexterm" name="id2659374"></a>より新しいW200xとに同梱されているXPプリンタドライバでは、Windows NTとは異なり、カーネルモードでは動作しない。ただし、両OS共に、引き続き、カーネルモードで動作するドライバを使う事は可能である(端的に言って、サブディレクトリ<span class="quote">“<span class="quote">W32X86</span>”</span>中の<span class="quote">“<span class="quote">2</span>”</span>にあるドライバが、<span class="quote">“<span class="quote">古い</span>”</span>ものかだと思って良いだろう)。以前に説明したように、AdobeのものはMicrosoft PostScriptドライバのように安定している。CUPSドライバはMicrosoftベースである。これは次のような理由による。Visual Studioのライセンスを持つ人が無償で使える、Windows NT用のMicrosoftのDDK(Device Development Kit)は、Microsoftがライセンスを持つドライバのソースコードが含まれる。Visual Studioのライセンスを持つ人は、自分が作るドライバの開発作業に、そのコードを使用し、変更する事が許可されている。CUPSではこのように開発されている。しかし、Microsoftのライセンスは、(DDKの部分を含む)ソースコード全体を公開することは許可していない。しかし、CUPSは、GPL配下で<span class="quote">“<span class="quote">差分</span>”</span>をリリースしている。そのため、もしも<span class="quote">“<span class="quote">MS DDK for Windows NT</span>”</span>のライセンスを持っていれば、差分コードを使い、ドライバを自分自身で調べる事が出来る。</p></div></div><div class="sect1" title="ドライバダウンロードを行うためのCUPSの設定"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2659436"></a>ドライバダウンロードを行うためのCUPSの設定</h2></div></div></div><p>前に説明したように、ダウンロードのためにSambaサーバ上でクライアントプリンタドライバを準備するためと、Windowsワークステーションの利便性のためのポイントアンドプリントのための、すべての以前に知られている方法も、CUPS上で動作する。これらの方法は<a class="link" href="classicalprinting.html" title="Chapter 21. 旧式の印刷サポート">旧式の印刷サポート</a>で説明されている。実際は、これは真のSambaビジネスで、Samba-Windowsクライアントの連携にのみ関連している。</p><div class="sect2" title="cupsaddsmb: 不明なユーティリティ"><div class="titlepage"><div><div><h3 class="title"><a name="id2659466"></a><span class="emphasis"><em>cupsaddsmb</em></span>: 不明なユーティリティ</h3></div></div></div><p><a class="indexterm" name="id2659477"></a><em class="parameter"><code>cupsaddsmb</code></em>ユーティリティ(現在すべてのCUPSバージョンに同梱)は、Sambaの<em class="parameter"><code>[print$]</code></em>共有中に、プリンタドライバを転送する別の解である。思い出してほしいのは、この共有は、クライアントが、ドライバが配布されると期待し、ダウンロードとインストールのためにセットアップする場所であるということである。これは、とても簡単に、任意の(か全部の)インストールされたCUPSプリンタの共有が出来るようになる。<code class="literal">cupsaddsmb</code>は、Adobe PostScriptドライバを、最近開発されたWindows NT/200x/XP用のCUPS PostScriptドライバと同様に使うことが出来る。<em class="parameter"><code>cupsaddsmb</code></em>は、ベンダプリンタドライバと一緒に<span class="emphasis"><em>動作することはできず</em></span>、そのマニュアルページ中に名前があるドライバと<span class="emphasis"><em>同じもののみ</em></span>動作する。</p><p>CUPSプリンタドライバはCUPSダウンロードサイトにある。そのパッケージ名は<code class="filename">cups-samba-[version].tar.gz</code>である。これには以下のような数多くの利点があるので、Adobeドライバよりも好まれる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>より正確なページ印刷情報をサポートする。</p></li><li class="listitem"><p>すべてのプリンタで、バナーページとページラベルをサポートする。</p></li><li class="listitem"><p>数多くのジョブのIPP属性の設定をサポートする	    (たとえば、ジョブの優先度、ページラベルとジョブの費用請求など)</p></li></ul></div><p>しかし、現在Windows NT,2000とXPのみがCUPSドライバによってサポートされている。もしも、Windows95、98とMEクライアントのサポートが必要ならば、Adobe Driverのそれぞれの部分を入手する事も必要である。</p></div><div class="sect2" title="cupsaddsmb用のsmb.confの準備"><div class="titlepage"><div><div><h3 class="title"><a name="id2659588"></a><code class="literal">cupsaddsmb</code>用の<code class="filename">smb.conf</code>の準備</h3></div></div></div><p><code class="literal">cupsaddsmb</code>を走らせる前に、<a class="link" href="CUPS-printing.html#cupsadd-ex" title="Example 22.3. cupsaddsmb使用のためのsmb.conf">cupsaddsmb使用のための<code class="filename">smb.conf</code></a>で示されるように、<code class="filename">smb.conf</code>を設定する必要がある。</p><div class="example"><a name="cupsadd-ex"></a><p class="title"><b>Example 22.3. cupsaddsmb使用のためのsmb.conf</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2659658"></a><em class="parameter"><code>load printers = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2659669"></a><em class="parameter"><code>printing = cups</code></em></td></tr><tr><td><a class="indexterm" name="id2659681"></a><em class="parameter"><code>printcap name = cups</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[printers]</code></em></td></tr><tr><td><a class="indexterm" name="id2659702"></a><em class="parameter"><code>comment = All Printers</code></em></td></tr><tr><td><a class="indexterm" name="id2659714"></a><em class="parameter"><code>path = /var/spool/samba</code></em></td></tr><tr><td><a class="indexterm" name="id2659725"></a><em class="parameter"><code>browseable = no</code></em></td></tr><tr><td># setting depends on your requirements</td></tr><tr><td><a class="indexterm" name="id2659741"></a><em class="parameter"><code>guest ok = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2659752"></a><em class="parameter"><code>writable = no</code></em></td></tr><tr><td><a class="indexterm" name="id2659764"></a><em class="parameter"><code>printable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2659776"></a><em class="parameter"><code>printer admin = root</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[print$]</code></em></td></tr><tr><td><a class="indexterm" name="id2659797"></a><em class="parameter"><code>comment = Printer Drivers</code></em></td></tr><tr><td><a class="indexterm" name="id2659809"></a><em class="parameter"><code>path = /etc/samba/drivers</code></em></td></tr><tr><td><a class="indexterm" name="id2659820"></a><em class="parameter"><code>browseable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2659832"></a><em class="parameter"><code>guest ok = no</code></em></td></tr><tr><td><a class="indexterm" name="id2659844"></a><em class="parameter"><code>read only = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2659855"></a><em class="parameter"><code>write list = root, @smbprintadm</code></em></td></tr></table></div></div><br class="example-break"></div><div class="sect2" title="Windows NT/200x/XP用のCUPS“PostScript Driver”"><div class="titlepage"><div><div><h3 class="title"><a name="id2659869"></a>Windows NT/200x/XP用のCUPS<span class="quote">“<span class="quote">PostScript Driver</span>”</span></h3></div></div></div><p><a class="indexterm" name="id2659880"></a>CUPSユーザは<a class="ulink" href="http://www.cups.org/software.html" target="_top">http://www.cups.org/software.html</a>から正確に同じパッケージを入手できる。これは、CUPSベースのソフトウェアファイルから分離されたパッケージで、CUPS 1.1.x Windows NT/200x/XP Printer Driver for Samba (tar.gz,192k)とタグづけられている。ダウンロードするファイル名は<code class="filename">cups-samba-1.1.x.tar.gz</code>である。tar.gzファイルを解凍後、以下のファイルが展開される:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>tar xvzf cups-samba-1.1.19.tar.gz</code></strong>cups-samba.installcups-samba.licensecups-samba.readmecups-samba.removecups-samba.ss</pre><p><a class="indexterm" name="id2659936"></a><a class="indexterm" name="id2659945"></a>これらはESPメタパッケージャソフトウェアEPMでパッケージ化されている。<code class="filename">*.install</code>と<code class="filename">*.remove</code>ファイルは簡単なシェルスクリプトで、<code class="filename">*.ss</code>のtarファイルを展開したものである(<code class="filename">*.ss</code>は、<span class="quote">“<span class="quote">tar</span>”</span>によって回答できる、tarアーカイブ以外の何者でもない)。次に、これは内容物を<code class="filename">/usr/share/cups/drivers/</code>に置く。この内容物は以下のファイルを含む:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>tar tv cups-samba.ss</code></strong>cupsdrvr.dllcupsui.dllcups.hlp  </pre><p><em class="parameter"><code>cups-samba.install</code></em>シェルスクリプトは簡単に扱える:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>./cups-samba.install</code></strong>[....]Installing software...Updating file permissions...Running post-install commands...Installation is complete.       </pre><p>スクリプトは<code class="filename">/usr/share/cups/drivers/</code>ディレクトリ中にドライバファイルを自動的に置く:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>cp /usr/share/drivers/cups.hlp /usr/share/cups/drivers/</code></strong></pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>バグのために、ある最近のCUPSリリースでは、<code class="filename">cups.hlp</code>ドライバファイルを<code class="filename">/usr/share/cups/drivers/</code>の代わりに<code class="filename">/usr/share/drivers/</code>中に置いてしまう。これを直すためには、手動で正しい場所にファイルをコピー/移動する(<code class="literal">./cups-samba.install</code>スクリプト実行後)。</p></div><p><a class="indexterm" name="id2660104"></a>この新しいCUPS PostScriptドライバは現在バイナリのみである。しかし、無料で使える。(まだ)完全なソースコードは提供されていない。その理由は、Microsoft DDKの手助けを得てMicrosoft Visual Studio 6でコンパイルしつつ、開発されているからである。ドライバ開発者はフリーソフトウェアとしてソースコード全体を配布する許可を得ていない。しかし、CUPS開発者はGPL配下でソースコードの<span class="quote">“<span class="quote">差分</span>”</span>をリリースしているので、Visual StudioとDDKのライセンスを持つ人は誰でも自分自身でコンパイルすることが出来る。</p></div><div class="sect2" title="異なったドライバファイルの認識"><div class="titlepage"><div><div><h3 class="title"><a name="id2660129"></a>異なったドライバファイルの認識</h3></div></div></div><p>CUPSドライバは古いWindows 95/98/Meをサポートせず、Windows NT/2000/XPクライアントのみサポートする。</p><p>Windows NT, 2000と XPは以下でサポートされる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>cups.hlp</p></li><li class="listitem"><p>cupsdrvr.dll</p></li><li class="listitem"><p>cupsui.dll</p></li></ul></div><p>古いWindows 95/98/MeのためのAdobeドライバはWindows NT/2000/XPクライアントと同じように提供されている。ファイルの組み合わせは異なったプラットフォームでは異なる。</p><p>Windows 95, 98と MEは以下でサポートされる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ADFONTS.MFM</p></li><li class="listitem"><p>ADOBEPS4.DRV</p></li><li class="listitem"><p>ADOBEPS4.HLP</p></li><li class="listitem"><p>DEFPRTR2.PPD</p></li><li class="listitem"><p>ICONLIB.DLL</p></li><li class="listitem"><p>PSMON.DLL</p></li></ul></div><p>Windows NT, 2000, と XPは以下でサポートされる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ADOBEPS5.DLL</p></li><li class="listitem"><p>ADOBEPSU.DLL</p></li><li class="listitem"><p>ADOBEPSU.HLP</p></li></ul></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2660238"></a>もしも、Windows NT/2000/XPサポート用の、AdobeドライバファイルとCUPSドライバファイルの両方がサーバ上に現在インストールされているならば、Adobeファイルは無視されCUPSファイルが使われる。もしも理由がなんであれ、Adobeのみのドライバを使いたいと思うのであれば、3つのCUPSドライバをどこかに移動すること。Windows 9x/Meクライアントはどんな場合にもAdobeのドライバを使う。</p></div></div><div class="sect2" title="ドライバファイルの入手"><div class="titlepage"><div><div><h3 class="title"><a name="id2660258"></a>ドライバファイルの入手</h3></div></div></div><p>Adobeドライバファイルの入手は、多くのユーザにとって予想外に難しいように見える。それらはAdobe Webサイトに1つのファイルとして見えているわけではなく、自己解凍か自動インストールを行うWindows-.exeファイルを見つけるのも難しい。おそらく内蔵されたネイティブなインストーラを使用しなければならず、クライアント上で一回はインストールプロセスを動かすことが必要である。これは、クライアント上ローカルにドライバ(と1つの汎用PostScriptプリンタ)をインストールする。それらがインストールされた後、汎用PostScriptプリンタを共有する。この作業後、クライアントの<em class="parameter"><code>[print$]</code></em>共有は、CUPSホストからsmbclientで入手可能なAdobeファイルを保持する。</p></div><div class="sect2" title="Windows NT/200x/XP用のESP Print Pro PostScriptドライバ"><div class="titlepage"><div><div><h3 class="title"><a name="id2660302"></a>Windows NT/200x/XP用のESP Print Pro PostScriptドライバ</h3></div></div></div><p><a class="indexterm" name="id2660312"></a>ESP Print ProソフトウェアのユーザはAdobe PostScriptドライバの代替として、ESCプリントドライバパッケージをインストールすることが出来る。これを行うために、<a class="ulink" href="http://www.easysw.com/software.html" target="_top">Easy Software</a>Webサイトで、ESC Print Proソフトウェアの通常のダウンロード領域からドライバファイルを検索できる。<span class="guilabel">Download Printer Drivers for ESP Print Pro 4.x</span>領域の間で<span class="quote">“<span class="quote">SAMBA</span>”</span>と名前が付いたリンクを探し、パッケージをダウンロードする。一度インストールすると、Printer Manager GUI中の中のメニューの、<span class="guilabel">Export Driver...</span>を選択して、プリンタを単にハイライトさせることによって任意のドライバを準備できる。もちろん、ドライバファイルを扱うために、あらかじめ準備されたSambaが必要である。すなわち、<em class="parameter"><code>[print$]</code></em>共有を設定することなどである。ESP Print ProパッケージにはWindows 95/98/Meクライアントファミリ用の(ライセンスされた)Adobeドライバ一式と同様にCUPSドライバファイルが含まれている。</p></div><div class="sect2" title="考慮すべき警告"><div class="titlepage"><div><div><h3 class="title"><a name="id2660381"></a>考慮すべき警告</h3></div></div></div><p><a class="indexterm" name="id2660389"></a><a class="indexterm" name="id2660396"></a><a class="indexterm" name="id2660403"></a><a class="indexterm" name="id2660410"></a>一度インストールスクリプト(と、<code class="filename">/usr/share/cups/drivers/</code>への<code class="filename">cups.hlp</code>ファイルの手動での移動)を実行すると、ドライバはSambaの<em class="parameter"><code>[print$]</code></em>共有(これはしばしば<code class="filename">/etc/samba/drivers/</code>にマップされ、<span class="emphasis"><em>WIN40</em></span>と<span class="emphasis"><em>W32X86</em></span>という枝を持つサブディレクトリを含む)中に、ドライバが配置できるようになる。これは、<code class="literal">cupsaddsmb</code>を動かすことによって行える(CUPSリリース1.1.16以降では<code class="literal">man cupsaddsmb</code>も参照)。</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a class="indexterm" name="id2660472"></a><a class="indexterm" name="id2660479"></a><code class="literal">smbpasswd</code>を動かしてrootをsmbpasswdファイル中に格納する必要があるかもしれない。もしも、全体の手順を最初に動かすときに、これは、特に重要であり、Windowsドメインコンピュータでの<span class="emphasis"><em>シングルサインオン</em></span>用にすべてが設定されている環境中では動かない。</p></div><p>いったんドライバファイルが<em class="parameter"><code>[print$]</code></em>共有に置かれ、初期化されると、それらはダウンロード可能になり、Windows NT/200x/XPクライアントによってインストールされる。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Windows 9x/MeクライアントはCUPS PostScriptドライバでは動かない。それらには前述の通り、<code class="filename">ADOBE*.*</code>ドライバを使うことが引き続き必要である。</p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>もしも、<code class="filename">/usr/share/cups/drivers/</code>ディレクトリ中に以前のインストールによる<code class="filename">ADOBE*.*</code>ドライバファイルが引き続きあるならば、それは無害である。</p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2660554"></a><a class="indexterm" name="id2660562"></a>使用しているWindowsクライアントが、Adobe PostScriptドライバ用の古い<code class="filename">ADOBE*.*</code>ファイルがインストールされていると、新しいWindows NT/200x/XP用のCUPS PostScriptドライバのダウンロードとインストールは最初に失敗する。最初にクライアントから古いドライバを消し去る必要がある。もしも、プリンタを再インストールしようとしたときのために、ドライバファイルはクライアントによって引き続き保存され、再利用されることによりプリンタを<span class="quote">“<span class="quote">削除</span>”</span>するだけでは十分ではない。クライアント上のAdobeドライバファイルを完全に取り除くためには、まず<span class="guilabel">プリンタフォルダ</span>を開き(おそらく<span class="guilabel">スタート -> 設定 -> コントロールパネル ->プリンタ</span>)、フォルダの背景を右クリックし、<span class="guilabel">ドライバ</span>タブを選択する。一覧表示上で削除したいドライバを選択し、<span class="guilabel">削除</span>ボタンをクリックする。これは1つも特定のドライバを使うプリンタが残っていないときに動作する。まず初めに<span class="guilabel">プリンタ</span>フォルダ中でこのドライバを使うすべてのプリンタを<span class="quote">“<span class="quote">削除</span>”</span>する必要がある。これを行うには管理者権限が必要である。</p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2660648"></a><a class="indexterm" name="id2660657"></a>一度クライアントにCUPS PostScriptドライバをダウンロードすると、<a class="link" href="classicalprinting.html" title="Chapter 21. 旧式の印刷サポート">旧式の印刷サポート</a>で説明したような手続きで、すべてのプリンタを簡単に切り替えることが出来る。<span class="guilabel">プリンタのプロパティ</span>ダイアログを動かすことか、<code class="literal">setdriver</code>サブコマンドを指定した<code class="literal">rpcclient</code>を使うことのどちらかで、存在するプリンタのドライバを切り替えられる。</p></div></div><div class="sect2" title="WindowsのCUPS PostScriptドライバ対Adobeドライバ"><div class="titlepage"><div><div><h3 class="title"><a name="id2660702"></a>WindowsのCUPS PostScriptドライバ対Adobeドライバ</h3></div></div></div><p>CUPSとAdobe PostScriptドライバの比較に興味があるだろうか?我々の目的のために、Are you interested in a comparison between the CUPS and the Adobe PostScript drivers? For our purposes, theseare the most important items that weigh in favor of CUPS:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Adobe EULAに縛られない。</p></li><li class="listitem"><p><span class="quote">“<span class="quote">ADOBE*.*ドライバファイルをダウンロードできる所はどこか?</span>”</span>        という質問に縛られない。</p></li><li class="listitem"><p>	<a class="indexterm" name="id2660743"></a>	Adobe ドライバ(sれに関連するプリンタのPPD要求において)はしばしば印刷ファイルの	メイン部分の先頭にPJLヘッダを置く。そのため、印刷ファイルは	<em class="parameter"><code>%!PS</code></em>の代わりに<em class="parameter"><code><1B>%-12345X</code></em>か	<em class="parameter"><code><escape>%-12345X</code></em>で始まる。これはCUPSデーモンが入力	ファイルを印刷可能なファイルと自動タイプすることをさせるようにし、	<em class="parameter"><code>pstops</code></em>フィルタ経由で初期化しない(もう少し技術的に言うと、	これは一般的なMIMEタイプ	<a class="indexterm" name="id2660786"></a>	<em class="parameter"><code>application/postscript</code></em>と見なされないが、より特別な	MIMEタイプである	<a class="indexterm" name="id2660800"></a>        <em class="parameter"><code>application/cups.vnd-postscript</code></em>とみなす)ので、	<em class="parameter"><code>/var/log/cups/page_log</code></em>中におけるページの計数は正確な	ページ数を受け取れない。その代わりに標準的な設定では、ダミーのページ数	<span class="quote">“<span class="quote">1</span>”</span>が記録される。	</p></li><li class="listitem"><p>Adobeドライバは、それによって生成するPostScriptを間違って	設定するいくつかのオプションがある<a class="indexterm" name="id2660835"></a>	(CUPSがそれを処理することが出来ないようにしてしまう、	<span class="guilabel">Optimize for Speed</span>を、	<span class="guilabel">Optimize for Portability</span>の代わりに、うっかりして	設定してしまう)。</p></li><li class="listitem"><p>WindowsクライアントによるCUPSサーバへのCUPS PostScriptドライバの	出力は、汎用MIMEタイプ<em class="parameter"><code>application/postscript</code></em>として<a class="indexterm" name="id2660873"></a>	自動タイプされ、CUPS <em class="parameter"><code>pstops</code></em>フィルタに渡され、会計と	quota目的のために<code class="filename">page_log</code>中に正しいページ数を記録する。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2660899"></a>	CUPS PostScriptドライバは、Windows NT/200x/XPクライアントによる、追加の標準(IPP)	印刷オプションを送信することをサポートする。そのような追加印刷オプションは、	CUPS標準<span class="emphasis"><em>バナーページ</em></span>(かカスタムなもので、ドライバは	ダウンロード時点でインストールされるべき)と名前を付けられ、CUPSページラベル	オプションを使い、ジョブのプライオリティを設定し、(将来、追加の便利な	IPPジョブ属性をサポートするオプションで)印刷予定時間を設定する。	</p></li><li class="listitem"><p>CUPS PostScriptドライバは、PostScriptファイルの先頭に、新しい	<em class="parameter"><code>*cupsJobTicket</code></em>コメントの挿入をサポートする	(これは、将来、すべての種類のCUPS上での便利な拡張のために使われるが、	これがコメントとして扱われ、単に無視されるため、任意の他の	アプリケーションのじゃまをしない)。</p></li><li class="listitem"><p>CUPS PostScriptドライバは、近々リリースされる、	Windows NT/200x/XP用の完全なCUPS IPPクライアントの心臓部である	(おそらく最初のCUPS 1.2のβリリースと一緒に)。</p></li></ul></div></div><div class="sect2" title="cupsaddsmbの実行(Quiet Mode)"><div class="titlepage"><div><div><h3 class="title"><a name="id2660960"></a>cupsaddsmbの実行(Quiet Mode)</h3></div></div></div><p><a class="indexterm" name="id2660969"></a><a class="indexterm" name="id2660976"></a><code class="literal">cupsaddsmb</code>コマンドは、必要とされるファイルを<em class="parameter"><code>[print$]</code></em>共有にコピーする。さらに追加で、このプリンタに関連づけられているPPDは、<code class="filename">/etc/cups/ppd/</code>から<em class="parameter"><code>[print$]</code></em>にコピーされる。これらファイルはポイントアンドプリント経由でWindowsクライアントのインストールの都合のために待機している。コマンドを正しく実行できる前に、Sambaに対して認証を行っておく必要がある。小さなネットワーク環境では、おそらくユーザレベルのセキュリティ(<a class="link" href="smb.conf.5.html#SECURITY" target="_top">security = user</a>)を使っているだろう。</p><p>以下は、正しく動く<code class="literal">cupsaddsmb</code>コマンドの例である:<a class="indexterm" name="id2661046"></a><a class="indexterm" name="id2661053"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>cupsaddsmb -U root infotec_IS2027</code></strong>Password for root required to access localhost via Samba: <strong class="userinput"><code>['secret']</code></strong></pre><p><a class="indexterm" name="id2661085"></a><span class="emphasis"><em>すべての</em></span>プリンタとドライバを共有するために、プリンタ名の代わりに<code class="option">-a</code>パラメータを使う。<code class="literal">cupsaddsmb</code>がプリンタドライバをSambaに<span class="quote">“<span class="quote">エクスポート</span>”</span>してから、CUPSドライバに関連づけられているキューのみ動作することは明白になるべきである。</p></div><div class="sect2" title="詳細な結果を表示するcupsaddsmbの実行"><div class="titlepage"><div><div><h3 class="title"><a name="id2661114"></a>詳細な結果を表示するcupsaddsmbの実行</h3></div></div></div><p><a class="indexterm" name="id2661123"></a>おそらく何が起きているかを見たいのだと思う。より詳細な出力は、<code class="option">-v</code>パラメータを使う。可読性向上のために下記の出力には手を入れてある。すべての行末の<span class="quote">“<span class="quote">\</span>”</span>は手動で入れてあり、そのほかにインデントもしている:<a class="indexterm" name="id2661145"></a><a class="indexterm" name="id2661154"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>cupsaddsmb -U root -v infotec_2105</code></strong>Password for root required to access localhost via GANDALF:Running command: smbclient //localhost/print\$ -N -U'root%secret' \    -c 'mkdir W32X86; \    put /var/spool/cups/tmp/3e98bf2d333b5 W32X86/infotec_2105.ppd; \	put /usr/share/cups/drivers/cupsdrvr.dll W32X86/cupsdrvr.dll; \    put /usr/share/cups/drivers/cupsui.dll W32X86/cupsui.dll; \    put /usr/share/cups/drivers/cups.hlp W32X86/cups.hlp'added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.7a]NT_STATUS_OBJECT_NAME_COLLISION making remote directory \W32X86putting file /var/spool/cups/tmp/3e98bf2d333b5 as \W32X86/infotec_2105.ppdputting file /usr/share/cups/drivers/cupsdrvr.dll as \W32X86/cupsdrvr.dllputting file /usr/share/cups/drivers/cupsui.dll as \W32X86/cupsui.dllputting file /usr/share/cups/drivers/cups.hlp as \W32X86/cups.hlp  Running command: rpcclient localhost -N -U'root%secret'    -c 'adddriver "Windows NT x86"   \   "infotec_2105:cupsdrvr.dll:infotec_2105.ppd:cupsui.dll:cups.hlp:NULL: \    RAW:NULL"'cmd = adddriver "Windows NT x86" \   "infotec_2105:cupsdrvr.dll:infotec_2105.ppd:cupsui.dll:cups.hlp:NULL: \	RAW:NULL"Printer Driver infotec_2105 successfully installed.  Running command: smbclient //localhost/print\$ -N -U'root%secret' \-c 'mkdir WIN40; \    put /var/spool/cups/tmp/3e98bf2d333b5 WIN40/infotec_2105.PPD; \	put /usr/share/cups/drivers/ADFONTS.MFM WIN40/ADFONTS.MFM;   \    put /usr/share/cups/drivers/ADOBEPS4.DRV WIN40/ADOBEPS4.DRV; \    put /usr/share/cups/drivers/ADOBEPS4.HLP WIN40/ADOBEPS4.HLP; \    put /usr/share/cups/drivers/DEFPRTR2.PPD WIN40/DEFPRTR2.PPD; \	put /usr/share/cups/drivers/ICONLIB.DLL WIN40/ICONLIB.DLL; \	put /usr/share/cups/drivers/PSMON.DLL WIN40/PSMON.DLL;'  added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0  Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.7a]  NT_STATUS_OBJECT_NAME_COLLISION making remote directory \WIN40  putting file /var/spool/cups/tmp/3e98bf2d333b5 as \WIN40/infotec_2105.PPD  putting file /usr/share/cups/drivers/ADFONTS.MFM as \WIN40/ADFONTS.MFM  putting file /usr/share/cups/drivers/ADOBEPS4.DRV as \WIN40/ADOBEPS4.DRV  putting file /usr/share/cups/drivers/ADOBEPS4.HLP as \WIN40/ADOBEPS4.HLP  putting file /usr/share/cups/drivers/DEFPRTR2.PPD as \WIN40/DEFPRTR2.PPD  putting file /usr/share/cups/drivers/ICONLIB.DLL as \WIN40/ICONLIB.DLL  putting file /usr/share/cups/drivers/PSMON.DLL as \WIN40/PSMON.DLL    Running command: rpcclient localhost -N -U'root%secret' \   -c 'adddriver "Windows 4.0"      \   "infotec_2105:ADOBEPS4.DRV:infotec_2105.PPD:NULL:ADOBEPS4.HLP: \   PSMON.DLL:RAW:ADOBEPS4.DRV,infotec_2105.PPD,ADOBEPS4.HLP,PSMON.DLL, \    ADFONTS.MFM,DEFPRTR2.PPD,ICONLIB.DLL"'	cmd = adddriver "Windows 4.0" "infotec_2105:ADOBEPS4.DRV:\	infotec_2105.PPD:NULL:ADOBEPS4.HLP:PSMON.DLL:RAW:ADOBEPS4.DRV,\	infotec_2105.PPD,ADOBEPS4.HLP,PSMON.DLL,ADFONTS.MFM,DEFPRTR2.PPD,\	ICONLIB.DLL"  Printer Driver infotec_2105 successfully installed.    Running command: rpcclient localhost -N -U'root%secret'  \   -c 'setdriver infotec_2105 infotec_2105'  cmd = setdriver infotec_2105 infotec_2105  Successfully set infotec_2105 to driver infotec_2105.</pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>出力結果上ではSambaアカウントのためのrootパスワードが表示されている。</p></div><p>もし、しっかり見た場合、ネットワーク上で暗号化されていないrootパスワードが転送されていることを発見するはずなので、注意するように。また、もしもさらによく見てみると、出力中にNT_STATUS_OBJECT_NAME_COLLISIONというようなエラーメッセージを見つけるだろう。これは、WIN40とW32X36というディレクトリが(以前のドライバインストールにより)すでに<em class="parameter"><code>[print$]</code></em>というドライバダウンロード共有中に存在している時に発生する。これらは問題のないエラーメッセージである。</p></div><div class="sect2" title="cupsaddsmbについて理解する"><div class="titlepage"><div><div><h3 class="title"><a name="id2661265"></a>cupsaddsmbについて理解する</h3></div></div></div><p><a class="indexterm" name="id2661274"></a>何が起きたのか?<code class="literal">cupsaddsmb</code>は何をしたのか?手順には5つのステージがある:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>	<a class="indexterm" name="id2661299"></a>	IPP経由でCUPSサーバを呼び出し、その名前のプリンタ用のドライバファイルとPPDファイルを要求する。</p></li><li class="listitem"><p>ローカルのTEMPDIR中(<code class="filename">cupsd.conf</code>で定義されている)に、	ファイルを一時的に格納する。</p></li><li class="listitem"><p>smbclient経由でSambaサーバの<em class="parameter"><code>[print$]</code></em>共有に	接続し、共有のWIN40(Windows 9x/Me用)とW32X86(Windows NT/200x/XP用)サブディレクトリ	中にファイルを書き込む。</p></li><li class="listitem"><p>	<a class="indexterm" name="id2661341"></a>	rpcclient経由でSambaサーバに接続し、正しいパラメータで<code class="literal">adddriver</code>	コマンドを実行する。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2661364"></a>	rpcclient経由でSambaサーバにもう一度接続し、<code class="literal">setdriver</code>コマンドを実行する。</p></li></ol></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>1番目のリモートホストとしてSambaホストを、2番目のリモートホストとしてCUPSホストを指定するためのパラメータを付けて<code class="literal">cupsaddsmb</code>ユーティリティを実行できる。特に、もしもより深く理解したい場合、何が起きたかをより明快にするためにテストしてみるのは良いことである(実際には、ほとんどの人はCUPSとSambaサーバを同じホストで動作させている):</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>cupsaddsmb -H sambaserver -h cupsserver -v printer</code></strong></pre><p></p></div></div><div class="sect2" title="もしもcupsaddsmbが正しく終了した場合、どのように認識するか"><div class="titlepage"><div><div><h3 class="title"><a name="id2661424"></a>もしもcupsaddsmbが正しく終了した場合、どのように認識するか</h3></div></div></div><p>もしもユーティリティがすべてのフィールドで正しく終わった場合、常時検査を<span class="emphasis"><em>しなければならない</em></span>。少なくとも出力中の、以下の3つのメッセージをチェックする必要がある:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>Printer Driver infotec_2105 successfully	installed.</em></span> # (for the W32X86 == Windows NT/200x/XP	architecture).</p></li><li class="listitem"><p><span class="emphasis"><em>Printer Driver infotec_2105 successfully	installed.</em></span> # (for the WIN40 == Windows 9x/Me	architecture).</p></li><li class="listitem"><p><span class="emphasis"><em>Successfully set [printerXPZ] to driver	[printerXYZ].</em></span></p></li></ol></div><p>これらのメッセージはおそらく一般的な出力中では簡単に認識できない。もしも(ダウンロードのための、<span class="emphasis"><em>すべての</em></span>有効なプリンタドライバを準備しようとする)<code class="option">-a</code>オプションを付けて<code class="literal">cupsaddsmb</code>を動かした場合、もしも個々のプリンタドライバに、正しくにインストールすることに関して問題がある場合、失敗するかもしれない。出力のリダイレクトは、結果を解析することを手助けする。</p><p>もしも下記のメッセージが出た場合:</p><pre class="screen">SetPrinter call failed!result was WERR_ACCESS_DENIED</pre><p>これは、このプリンタに対して<a class="link" href="smb.conf.5.html#USECLIENTDRIVER" target="_top">use client driver = yes</a>という設定がされているかもしれないということを意味する。この設定を<span class="quote">“<span class="quote">no</span>”</span>にすると、この問題が解決する。<code class="filename">smb.conf</code>マニュアルページ中の、<em class="parameter"><code>use client driver</code></em>についての説明を参照のこと。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>もしも、verboseモードで<code class="literal">cupsaddsmb</code>を動かしていないと、何らかの診断出力を得るのは不可能である。そのため、既定値であるquietモードを使わないことを強く推奨する。quietモードを使うと、発生するかもしれない何らかの問題を隠してしまうだろう。</p></div></div><div class="sect2" title="Samba PDCににおけるcupsaddsmb"><div class="titlepage"><div><div><h3 class="title"><a name="id2661564"></a>Samba PDCににおけるcupsaddsmb</h3></div></div></div><p><a class="indexterm" name="id2661573"></a><a class="indexterm" name="id2661579"></a>Samba PDC上で動かすために、標準の<code class="literal">cupsaddsmb</code>コマンドは動かないのか?認証のためにパスワードを繰り返し聞かれ、コマンドは全く起動しないのか?以下にある応用のどれかを試してみてほしい:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>cupsaddsmb -U MIDEARTH\\root -v printername</code></strong><code class="prompt">root# </code><strong class="userinput"><code>cupsaddsmb -H SAURON -U MIDEARTH\\root -v printername</code></strong><code class="prompt">root# </code><strong class="userinput"><code>cupsaddsmb -H SAURON -U MIDEARTH\\root -h cups-server -v printername</code></strong></pre><p>(2つのバックスラッシュに注意:最初のものは二番目のものに対する<span class="quote">“<span class="quote">escape</span>”</span>である)。</p></div><div class="sect2" title="cupsaddsmbフローチャート"><div class="titlepage"><div><div><h3 class="title"><a name="id2661650"></a>cupsaddsmbフローチャート</h3></div></div></div><p><a class="indexterm" name="id2661658"></a><a class="indexterm" name="id2661665"></a><a class="link" href="CUPS-printing.html#small14" title="Figure 22.16. cupsaddsmbのフローチャート">cupsaddsmbフローチャート</a>は、<code class="literal">cupaddsmb</code>の処理手順、コマンドフローとデータフローを示すチャートである。再度注意:cupsaddsmbはraw印刷キューと一緒に動かないし、そういうことを意図してもいない!</p><div class="figure"><a name="small14"></a><p class="title"><b>Figure 22.16. cupsaddsmbのフローチャート</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/14small.png" alt="cupsaddsmbのフローチャート"></div></div></div><br class="figure-break"></div><div class="sect2" title="クライアント上でのPostScriptドライバのインストール"><div class="titlepage"><div><div><h3 class="title"><a name="id2661734"></a>クライアント上でのPostScriptドライバのインストール</h3></div></div></div><p><a class="indexterm" name="id2661742"></a><a class="indexterm" name="id2661749"></a><code class="literal">cupsaddsmb</code>の完了後、ドライバは、クライアントから使えるようになる。以下は、ポイントアンドプリント経由でダウンロードしインストールするために行わなければならない手順である。Windowsクライアントから、CUPS/Sambaサーバをブラウズする:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	<a class="indexterm" name="id2661779"></a>	ネットワークコンピュータ中のSambaの<span class="guilabel">プリンタ</span>共有を開く</p></li><li class="listitem"><p>問い合わせ(question)中のプリンタを右クリックする</p></li><li class="listitem"><p>開いたコンテキストメニューから下記を選択する	<span class="guimenuitem">インストール...</span> あるいは 	<span class="guimenuitem">接続...</span> (使用しているWindowsのバージョンに依存する)</p></li></ul></div><p>数秒後、クライアントの<span class="emphasis"><em>ローカル</em></span><span class="guilabel">プリンタ</span>フォルダ中に新しいプリンタが現れる。Windows XP上では、<span class="emphasis"><em>Sambaサーバ上のプリンタ名</em></span>という名前が付けられている(現在多くの場合kde-bitshop上のinfotec_2105のようになる)。もしもMicrosoft Wordのようなアプリケーションから、テストと最初のジョブを送りたい場合、有効なプリンタ一覧のドロップダウンリスト中に、<code class="filename">\\SambaServer\PrinterName</code>というエントリで新しいプリンタが現れる。</p><p><a class="indexterm" name="id2661862"></a><a class="indexterm" name="id2661869"></a><a class="indexterm" name="id2661877"></a><code class="literal">cupsaddsmb</code>はCUPSバージョン1.1.15以上とSamba バージョン2.2.4以降でのみ確実に動作する。もしも動かない場合か、クライアントへの自動プリンタダウンロードが成功しないばあい、クライアント上でAdobe PostScriptドライバのtop ofのCUPSプリンタPPDを手動でインストールトーすすることができる。次に、UNCタイプの接続のために、クライアントのプリンタキューをSambaプリンタ共有に指定する:<code class="literal">cupsaddsmb</code> will only reliably work with CUPS version 1.1.15 or higher and with Sambaversion 2.2.4, or later. If it does not work, or if the automatic printer driver download to the clients doesnot succeed, you can still manually install the CUPS printer PPD on top of the Adobe PostScript driver onclients. Then point the client's printer queue to the Samba printer share for a UNC type of connection:</p><pre class="screen"><code class="prompt">C:\> </code><strong class="userinput"><code>net use lpt1: \\sambaserver\printershare /user:ntadmin</code></strong></pre><p>これは、CUPSでネットワークされたPostScript RIP機能を使用することが出来るようになる(ユーザ<span class="quote">“<span class="quote">ntadmin</span>”</span>はプリンタ共有にアクセスするための必要な権限を持つ有効なSambaユーザである必要がある)。これは、従来からのLanManによる方法(MS-RPCを使わない)でプリンタの接続を設定する。</p></div><div class="sect2" title="クライアント上での危険なPostScriptドライバ設定を防止する"><div class="titlepage"><div><div><h3 class="title"><a name="cups-avoidps1"></a>クライアント上での危険なPostScriptドライバ設定を防止する</h3></div></div></div><p>印刷が動作するが、まだ問題があるとする。ほとんどのジョブは正しく印刷するが、いくつかは全く印刷できない。いくつかのジョブは、とても良いとは見えないフォントの問題を抱えている。いくつかのジョブは速やかに処理されるが、いくつかはとても遅い。これらの問題の多くは、いくつかのガイドラインに従うことで、劇的に軽減できるか、完全になくなる。思い出してほしいが、もしも使用している印刷デバイスがPostScriptが有効でない場合、使用しているクライアントドライバの設定が生成する出力を使って、CUPSホスト上でのGhostscriptインストールを取り扱ているはずである。以下のようにうまく処理するようにする:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	Optimize for Speedという設定のPostScript出力オプションを抑制する。その代わりに	Optimize for Portabilityを使用する(Adobe PostScriptドライバ)。</p></li><li class="listitem"><p>	Page Independenceを使わない:設定なしにする。その代わりに、Page Independence: YES	とする(CUPS PostScriptドライバ)。	</p></li><li class="listitem"><p>	推奨はTrue Typeフォントダウンロードオプション:Native True Type over Automatic and Outline	である。なんとしてもBitmapを避けるべきである(Adobe PostScriptドライバ)。</p></li><li class="listitem"><p>	True Typeフォントを選択する:Download as Softfont into Printer over the default Replace by Device Font	(Adobeにおいては、各国のフォントは、出力を得るためにそれを戻す必要があるかもしれない。</p></li><li class="listitem"><p>	時には、PostScript言語レベルを選択することが出来る:問題が発生した場合は	3のかわりに2を試してみる(Adobeにおいては、最新のESP Ghostscriptパッケージは	レベル3のPostScriptをとてもうまく扱える)。	</p></li><li class="listitem"><p>	PostScriptエラーハンドラにYesと答える(Adobe)。</p></li></ul></div></div></div><div class="sect1" title="rpcclientを使ったPostScriptドライバファイルの手動インストール"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2662061"></a>rpcclientを使ったPostScriptドライバファイルの手動インストール</h2></div></div></div><p>もちろん、1つずつ、cupsaddsmbという便利なユーティリティ中に埋め込まれているすべてのコマンドを動かすことと、アップロードと、将来のクライアントダウンロードのためにドライバファイルを準備することは出来る。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Sambaを準備する(そこにあるべきプリンタの名前を使うCUPSプリントキュー。	ドライバを提供している。)</p></li><li class="listitem"><p><em class="parameter"><code>[print$]</code></em>にファイルをコピー。</p></li><li class="listitem"><p>	<a class="indexterm" name="id2662111"></a>	<code class="literal">rpcclient adddriverを動かす</code>	(サポートしたい各クライアントアーキテクチャ毎に)。</p></li><li class="listitem"><p>	<a class="indexterm" name="id2662134"></a>	Run <code class="literal">rpcclient setdriver.</code></p></li></ol></div><p><a class="indexterm" name="id2662152"></a><a class="indexterm" name="id2662162"></a><a class="indexterm" name="id2662170"></a><a class="indexterm" name="id2662180"></a><a class="indexterm" name="id2662189"></a>今これを行おうとしよう。最初に、最初の案を得るために、<em class="parameter"><code>rpcclient</code></em>のマニュアルを読む。印刷に関連するすべてのサブコマンドを見る:<code class="literal">enumprinters</code>,<code class="literal">enumdrivers</code>,<code class="literal">enumports</code>, <code class="literal">adddriver</code>と<code class="literal">setdriver</code>は最も興味があるものである。<em class="parameter"><code>rpcclient</code></em>はMS-RPCプロトコルの重要な一部を実装している。これをWindows NT(か200x/XP)に問い合わせ(とコマンド)を行うのにも使える。MS-RPCはWindowsクライアントによって使われ、とりわけ、ポイントアンドプリント機能に適合するために使われる。Sambaは今、同様にこれをまねることが出来る。</p><div class="sect2" title="rpcclientマニュアルページのチェック"><div class="titlepage"><div><div><h3 class="title"><a name="id2662258"></a>rpcclientマニュアルページのチェック</h3></div></div></div><p>最初に、<em class="parameter"><code>rpcclient</code></em>マニュアルページをチェックしよう。個々には2つの読むべきな文節がある:</p><p><a class="indexterm" name="id2662278"></a><a class="indexterm" name="id2662285"></a><a class="indexterm" name="id2662292"></a><code class="literal">adddriver <arch> <config></code>は、サーバ上でプリンタドライバ情報をインストールするために、<code class="literal">AddPrinterDriver()</code>RPCを実行する。ドライバファイルは<code class="literal">getdriverdir</code>によって返されるディレクトリ中にすでに存在すべきである。<em class="parameter"><code>arch</code></em>が取れる値は<code class="literal">getdriverdir</code>コマンドのものと同じである。<em class="parameter"><code>config</code></em>パラメータは以下のように定義される:</p><pre class="screen">Long Printer Name:\Driver File Name:\Data File Name:\Config File Name:\Help File Name:\Language Monitor Name:\Default Data Type:\Comma Separated list of Files</pre><p>任意の空白のフィールドは<span class="quote">“<span class="quote">NULL</span>”</span>という文字列を入力すべきである。</p><p>Sambaはプリントモニタというコンセプトをサポートする必要がないので、通信のために双方向リンクを使うことが出来るドライバがあるローカルプリンタのためにのみそれらは適用される。このフィールドは<span class="quote">“<span class="quote">NULL</span>”</span>にすべきである。リモートNT印刷サーバ上で、ドライバに対する印刷モニタはドライバを追加する前にすでにインストールされていなければならない。そうしないと、RPCは失敗する。</p><p><a class="indexterm" name="id2662383"></a><a class="indexterm" name="id2662390"></a><code class="literal">setdriver <printername> <drivername></code>は、インストールされたプリンタに関連するプリンタドライバをアップロードするために、<code class="literal">SetPrinter()</code>コマンドを実行する。プリンタドライバはプリンタサーバ上にあらかじめ正しくインストールされている必要がある。</p><p><a class="indexterm" name="id2662417"></a><a class="indexterm" name="id2662424"></a>インストールされたプリンタとドライバの一覧を得るための、<code class="literal">enumprinters</code>と<code class="literal">enumdrivers</code>コマンドも参照のこと。</p></div><div class="sect2" title="rpcclientマニュアルページの理解"><div class="titlepage"><div><div><h3 class="title"><a name="id2662449"></a>rpcclientマニュアルページの理解</h3></div></div></div><p><a class="indexterm" name="id2662458"></a><span class="emphasis"><em>正確な</em></span>フォーマットはマニュアルページによって明快にはならないので、空白を含むパラメータを扱う必要がある。以下は、それに対するもう少しわかりやすい説明である。ここではコマンドを改行し、改行は<span class="quote">“<span class="quote">\</span>”</span>で示している。通常、改行なしに1行でコマンドを記述するだろう:The <span class="emphasis"><em>exact</em></span> format isn't made too clear by the man page, since you have to deal with someparameters containing spaces. Here is a better description for it. We have line-broken the command andindicated the breaks with <span class="quote">“<span class="quote">\</span>”</span>. Usually you would type the command in one line without the linebreaks:</p><pre class="screen">adddriver "Architecture" \   "LongPrinterName:DriverFile:DataFile:ConfigFile:HelpFile:\   LanguageMonitorFile:DataType:ListOfFiles,Comma-separated"</pre><p>マニュアルページが示すものは、実際に存在する3つのコロンで分離されたフィールド中の、単純な<em class="parameter"><code><config></code></em>キーワードである。最後のフィールドは、複数の(あまり尋常でない場合では、異なった20のもの)ファイルである。これは、最初は混乱するように見えるかもしれない。<span class="quote">“<span class="quote">LongPrinterName</span>”</span>とマニュアルページが呼んでいるものは、実際では<span class="quote">“<span class="quote">ドライバ名</span>”</span>と呼ばれるべきである。これは自由に名前を付けられ、後で<code class="literal">rpcclient ... setdriver</code>コマンド中でこの名前を使える。実用的な理由で、多くはプリンタと同じ名前をドライバに付ける。What the man pages denote as a simple <em class="parameter"><code><config></code></em> keyword in reality consists ofeight colon-separated fields. The last field may take multiple (in some very insane cases, even 20 differentadditional) files. This might sound confusing at first.  What the man pages call the<span class="quote">“<span class="quote">LongPrinterName</span>”</span> in reality should be called the <span class="quote">“<span class="quote">Driver Name</span>”</span>. You can name itanything you want, as long as you use this name later in the <code class="literal">rpcclient ... setdriver</code>command. For practical reasons, many name the driver the same as the printer.</p><p>これは全く単純ではない。<span class="quote">“<span class="quote">どのファイルがドライバファイルをどうやったら分かるか</span>”</span>、各<span class="quote">“<span class="quote">データファイル</span>”</span>, <span class="quote">“<span class="quote">構成ファイル</span>”</span>, <span class="quote">“<span class="quote">ヘルプファイル</span>”</span>と<span class="quote">“<span class="quote">Language Monitorファイルの場合は?</span>”</span>という質問があるだろう。答えのために、共有プリンタを持つWindows NTがそれらのファイルをどのように提供しているかを見てみるのもよいかもしれない。覚えておいてほしいが、この全体の手続きはネットワーク上でWindowsコンピュータが発生させたトラフィックをモニタすることによってSambaチームにより開発されねばならなかったと言うことである。Windowsマシンに切り替えて、UNIXワークステーションからうまくアクセスしても良い。それが何を送っているかを見るために、<code class="literal">rpcclient</code>で問い合わせてもよく、より明快にするために、マニュアルページの理解を試みても良い。It isn't simple at all. I hear you asking: <span class="quote">“<span class="quote">How do I know which files are Driver File</span>”</span>,<span class="quote">“<span class="quote">Data File</span>”</span>, <span class="quote">“<span class="quote">Config File</span>”</span>, <span class="quote">“<span class="quote">Help File</span>”</span> and <span class="quote">“<span class="quote">Language MonitorFile in each case?</span>”</span> For an answer, you may want to have a look at how a Windows NT box with a sharedprinter presents the files to us. Remember that this whole procedure has to be developed by the Samba Team bylistening to the traffic caused by Windows computers on the wire. We may as well turn to a Windows box now andaccess it from a UNIX workstation. We will query it with <code class="literal">rpcclient</code> to see what it tells usand try to understand the man page more clearly.</p></div><div class="sect2" title="Producing an Example by Querying a Windows Box"><div class="titlepage"><div><div><h3 class="title"><a name="id2662650"></a>Producing an Example by Querying a Windows Box</h3></div></div></div><p><a class="indexterm" name="id2662659"></a><a class="indexterm" name="id2662668"></a>We could run <code class="literal">rpcclient</code> with a <code class="literal">getdriver</code> or a<code class="literal">getprinter</code> subcommand (in level 3 verbosity) against it. Just sit down at a UNIX or Linuxworkstation with the Samba utilities installed, then type the following command:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -U'user%secret' NT-SERVER -c 'getdriver printername 3'</code></strong></pre><p>結果から、どれがどれであるか明快になるべきである。以下はインストールの例である:<a class="indexterm" name="id2662721"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -U'Danka%xxxx' W200xSERVER \    -c'getdriver "DANKA InfoStream Virtual Printer" 3'</code></strong>    cmd = getdriver "DANKA InfoStream Virtual Printer" 3 [Windows NT x86] Printer Driver Info 3:         Version: [2]         Driver Name: [DANKA InfoStream]         Architecture: [Windows NT x86]         Driver Path: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\PSCRIPT.DLL]         Datafile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\INFOSTRM.PPD]         Configfile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\PSCRPTUI.DLL]         Helpfile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\PSCRIPT.HLP]          Dependentfiles: []         Dependentfiles: []         Dependentfiles: []         Dependentfiles: []         Dependentfiles: []         Dependentfiles: []         Dependentfiles: []          Monitorname: []         Defaultdatatype: []</pre><p>いくつかのプリンタドライバは<em class="parameter"><code>Dependentfiles</code></em>というラベルで、追加のファイルを一覧表示し、それらは最後のフィールドである<em class="parameter"><code>ListOfFiles,Comma-separated</code></em>中に押し込まれる。CUPS PostScriptドライバ用には、それらは不要で(Adobe PostScriptドライバも)、それゆえ、フィールドには<span class="quote">“<span class="quote">NULL</span>”</span>が入るだろう。Some printer drivers list additional files under the label <em class="parameter"><code>Dependentfiles</code></em>, and thesewould go into the last field <em class="parameter"><code>ListOfFiles,Comma-separated</code></em>. For the CUPS PostScriptdrivers, we do not need any (nor would we for the Adobe PostScript driver); therefore, the field will get a<span class="quote">“<span class="quote">NULL</span>”</span> entry.</p></div><div class="sect2" title="adddriverとsetdriverを完了させるための要求事項"><div class="titlepage"><div><div><h3 class="title"><a name="id2662807"></a>adddriverとsetdriverを完了させるための要求事項</h3></div></div></div><p><a class="indexterm" name="id2662816"></a><a class="indexterm" name="id2662826"></a><a class="indexterm" name="id2662832"></a>マニュアルページから(と上記の<code class="literal">cupsaddsmb</code>の引用された出力から)、手動でのアップロードとドライバファイルの初期化を成功させるために、一定の状態を用意する必要があることが明確になる。2つの<code class="literal">rpcclient</code>サブコマンド(<code class="literal">adddriver</code>と<code class="literal">setdriver</code>)は、成功させるために、以下の前提条件を準備する必要がある:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>かroot(これはNTの	<span class="quote">“<span class="quote">Printer Operators</span>”</span>グループ<span class="emphasis"><em>ではないが</em></span>、	<code class="filename">smb.conf</code>の<em class="parameter"><code>[global]</code></em>セクションで定義されている	<span class="emphasis"><em>printer admin</em></span>グループ)で接続する。	</p></li><li class="listitem"><p>要求されたドライバを<code class="filename">\\SAMBA\print$\w32x86</code>	と<code class="filename">\\SAMBA\print$\win40</code>に、適切にすべてコピーする。	これらは、その後最終的に<span class="quote">“<span class="quote">0</span>”</span>と<span class="quote">“<span class="quote">2</span>”</span>という	サブディレクトリで終わる。現時点では、それらをそこに	<span class="emphasis"><em>置いてはならない</em></span>。それらは自動的に	<code class="literal">adddriver</code>サブコマンドによって使われる(もしも共有中にドライバ	ファイルを置くために、<code class="literal">smbclient</code>コマンドを使うならば、	<span class="quote">“<span class="quote">$</span>”</span>をエスケープする必要があることに注意。たとえば、	<code class="literal">smbclient //sambaserver/print\$ -U root.</code>)。	Copy all required driver files to <code class="filename">\\SAMBA\print$\w32x86</code> and	<code class="filename">\\SAMBA\print$\win40</code> as appropriate. They will end up in the <span class="quote">“<span class="quote">0</span>”</span> respective	<span class="quote">“<span class="quote">2</span>”</span> subdirectories later. For now, <span class="emphasis"><em>do not</em></span> put them there; they'll be	automatically used by the <code class="literal">adddriver</code> subcommand. (If you use <code class="literal">smbclient</code> to	put the driver files into the share, note that you need to escape the <span class="quote">“<span class="quote">$</span>”</span>: <code class="literal">smbclient	//sambaserver/print\$ -U root.</code>)</p></li><li class="listitem"><p>接続しているユーザは<em class="parameter"><code>[print$]</code></em>共有に	書き込みとサブディレクトリの作成が出来ねばならない。</p></li><li class="listitem"><p>Windowsクライアント用に設定しようとしているプリンタは、	CUPSによってすでにインストールされている必要がある。</p></li><li class="listitem"><p>	<a class="indexterm" name="id2663045"></a>	<a class="indexterm" name="id2663054"></a>	CUPSプリンタはSambaによって認識されねばならない:さもないと、	<code class="literal">setdriver</code>サブコマンドは、NT_STATUS_UNSUCCESSFULというエラーで	失敗する。Sambaによってプリンタが認識されているかを調べるには、	 <code class="literal">rpcclient</code>で<code class="literal">enumprinters</code>サブコマンドを	 使うことが出来る。長く存在しているバグが、各smbdプロセスがSIGHUPを受け取るか、	 再起動するまで、プリンタ一覧の適切な更新を阻害している。ごく最近CUPSプリンタを	 作成して問題が発生した場合、Sambaを再起動することを覚えておいてほしい。	</p></li></ul></div></div><div class="sect2" title="15ステップでの手動ドライバインストール"><div class="titlepage"><div><div><h3 class="title"><a name="id2663103"></a>15ステップでの手動ドライバインストール</h3></div></div></div><p>すべての要求されたコマンドを実行して、手動で、プリンタドライバをインストールしてみる。最初、これは複雑なプロセスなように見えるという理由で、手順を1つずつ、やらなければならない、単一のアクションアイテム毎に説明する。We are going to install a printer driver now by manually executing allrequired commands. Because this may seem a rather complicated process atfirst, we go through the procedure step by step, explaining everysingle action item as it comes up.</p><div class="procedure" title="Procedure 22.2. 手動でのドライバインストール"><a name="id2663124"></a><p class="title"><b>Procedure 22.2. 手動でのドライバインストール</b></p><ol class="procedure" type="1"><li class="step" title="CUPS上でのプリンタのインストール"><p class="title"><b>CUPS上でのプリンタのインストール</b></p><pre class="screen">	<code class="prompt">root# </code><strong class="userinput"><code>lpadmin -p mysmbtstprn -v socket://10.160.51.131:9100 -E \				-P canonIR85.ppd</code></strong>	</pre><p>	これは、CUPSシステムに<em class="parameter"><code>mysmbtstprn</code></em>という名前のプリンタを	インストールする。プリンタはソケット(JetDirectかDirect TCP/IPとして知られる)	接続経由で接続される。このステップはrootで行う必要がある。	</p></li><li class="step" title="(オプション)Sambaによってプリンタが認識されているかを調べる。"><p class="title"><b>(オプション)Sambaによってプリンタが認識されているかを調べる。</b></p><p>	<a class="indexterm" name="id2663185"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'enumprinters' localhost \  | grep -C2 mysmbtstprn</code></strong>flags:[0x800000]name:[\\kde-bitshop\mysmbtstprn]description:[\\kde-bitshop\mysmbtstprn,,mysmbtstprn]comment:[mysmbtstprn]</pre><p>	</p><p>	これは、一覧中にプリンタを表示する。層でなければ、Sambaデーモン(smbd)をいったん	止めて再起動するか、HUPシグナルを送る:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>kill -HUP `pidof smbd`</code></strong></pre><p>	再度チェックする。成功するまでトラブルシュートを繰り返し行う。	<span class="quote">“<span class="quote">description</span>”</span>行中に、2つのカンマの間に<span class="quote">“<span class="quote">空白</span>”</span>の	フィールドがあることに注意。すでに1つ存在していれば、ドライバ名はここに現れる。	このステップと、この後のステップのほとんどのために、rootのSambaでのパスワード	(<code class="literal">smbpasswd</code>コマンドによって設定される)を知っておく必要がある。	代わりに、<em class="parameter"><code>[print$]</code></em>に対して<code class="filename">smb.conf</code>中で	<span class="quote">“<span class="quote">write list</span>”</span>として定義されているユーザからの1つで認証する事が出来る。	</p></li><li class="step" title="(オプション)プリンタに対するドライバをSambaが認識しているかを調べる。"><p class="title"><b>(オプション)プリンタに対するドライバをSambaが認識しているかを調べる。</b></p><p>	<a class="indexterm" name="id2663294"></a>	<a class="indexterm" name="id2663304"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'getprinter mysmbtstprn 2'\ localhost | grep driver </code></strong>drivername:[]<code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'getprinter mysmbtstprn 2' \ localhost | grep -C4 driv</code></strong>servername:[\\kde-bitshop]printername:[\\kde-bitshop\mysmbtstprn]sharename:[mysmbtstprn]portname:[Samba Printer Port]drivername:[]comment:[mysmbtstprn]location:[]sepfile:[]printprocessor:[winprint] <code class="prompt">root# </code><strong class="userinput"><code>rpcclient -U root%xxxx -c 'getdriver mysmbtstprn' localhost</code></strong> result was WERR_UNKNOWN_PRINTER_DRIVER</pre><p>上記で示されている3つのコマンドのどれもドライバを表示しない。このステップはこの条件をデモンストレーションする目的で行われた。このステージにおけるプリンタへの接続の試みは、<span class="quote">“<span class="quote">The server does not have the required printer driver installed.</span>”</span>という行を表示する。</p></li><li class="step" title="すべての要求されたドライバファイルをSambaの[print$]に置く。"><p class="title"><b>すべての要求されたドライバファイルをSambaの[print$]に置く。</b></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>smbclient //localhost/print\$ -U 'root%xxxx' \	-c 'cd W32X86; \	put /etc/cups/ppd/mysmbtstprn.ppd mysmbtstprn.PPD; \ 	put /usr/share/cups/drivers/cupsui.dll cupsui.dll; \	put /usr/share/cups/drivers/cupsdrvr.dll cupsdrvr.dll; \	put /usr/share/cups/drivers/cups.hlp cups.hlp'</code></strong></pre><p>(このコマンドは、単一の長い行で入力すべきである<span class="quote">“<span class="quote">\</span>”</span>によって示される改行と行末は可読性向上のために挿入されている)。このステップは、次のものを成功させるために<span class="emphasis"><em>必要とされる</em></span>。これは、ドライバファイルを物理的に<em class="parameter"><code>[print$]</code></em>共有中に存在させるようにする。しかし、それらをSambaはまだドライバファイルとして扱えないので、クライアントはまだそれらをインストールできない。クライアントがドライバについて問い合わせると、引き続き<span class="quote">“<span class="quote">not installed here</span>”</span>というメッセージが表示される。</p></li><li class="step" title="現在どこにドライバファイルがあるかを検査する。"><p class="title"><b>現在どこにドライバファイルがあるかを検査する。</b></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>ls -l /etc/samba/drivers/W32X86/</code></strong>total 669drwxr-sr-x    2 root     ntadmin       532 May 25 23:08 2drwxr-sr-x    2 root     ntadmin       670 May 16 03:15 3-rwxr--r--    1 root     ntadmin     14234 May 25 23:21 cups.hlp-rwxr--r--    1 root     ntadmin    278380 May 25 23:21 cupsdrvr.dll-rwxr--r--    1 root     ntadmin    215848 May 25 23:21 cupsui.dll-rwxr--r--    1 root     ntadmin    169458 May 25 23:21 mysmbtstprn.PPD</pre><p>ドライバファイルは現在<em class="parameter"><code>[print$]</code></em>を<span class="quote">“<span class="quote">root</span>”</span>とするW32X86アーキテクチャにある。</p></li><li class="step" title="Sambaにそれらがドライバファイルであると告げる(adddriver)。"><p class="title"><b>Sambaにそれらがドライバファイルであると告げる(<code class="literal">adddriver</code>)。</b></p><p><a class="indexterm" name="id2663507"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'adddriver "Windows NT x86" \	"mydrivername:cupsdrvr.dll:mysmbtstprn.PPD: \  cupsui.dll:cups.hlp:NULL:RAW:NULL"' \  localhost</code></strong>Printer Driver mydrivername successfully installed.</pre><p>これが失敗してもこのステップを繰り返すことはできない。これは単なるtypoの結果であったとしても失敗する。それは、たいていの場合、ドライバファイルの一部を<span class="quote">“<span class="quote">2</span>”</span>サブディレクトリ中に移動してしまっただろう。もしもこのステップが失敗したならば、このステップを再度実行する前に、4番目のステップに戻り、繰り返す必要がある。このステップ中で、ドライバの名前を選択する必要がある。プリンタの名前として使うものと同じ名前を使うことはよい方法である。しかし、大量にインストールする場合、明確に異なった名前の、数多くのプリンタに対するドライバを使っても良い。そのため、ドライバの名前は決定されない。</p></li><li class="step" title="現在ドライバファイルがどこにあるかを調べる。"><p class="title"><b>現在ドライバファイルがどこにあるかを調べる。</b></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>ls -l /etc/samba/drivers/W32X86/</code></strong>total 1drwxr-sr-x    2 root     ntadmin       532 May 25 23:22 2drwxr-sr-x    2 root     ntadmin       670 May 16 03:15 3<code class="prompt">root# </code><strong class="userinput"><code>ls -l /etc/samba/drivers/W32X86/2</code></strong>total 5039[....]-rwxr--r--    1 root     ntadmin     14234 May 25 23:21 cups.hlp-rwxr--r--    1 root     ntadmin    278380 May 13 13:53 cupsdrvr.dll-rwxr--r--    1 root     ntadmin    215848 May 13 13:53 cupsui.dll-rwxr--r--    1 root     ntadmin    169458 May 25 23:21 mysmbtstprn.PPD</pre><p>どのようにステップ6が適切なサブディレクトリ中にドライバファイルを移動したかに注目。ステップ5の後の状態と今の状態を比較する。</p></li><li class="step" title="(オプション)Sambaが現時点でドライバを認識しているかを確認する。"><p class="title"><b>(オプション)Sambaが現時点でドライバを認識しているかを確認する。</b></p><p><a class="indexterm" name="id2663640"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'enumdrivers 3' \	localhost | grep -B2 -A5 mydrivername</code></strong>Printer Driver Info 3:Version: [2]Driver Name: [mydrivername]Architecture: [Windows NT x86]Driver Path: [\\kde-bitshop\print$\W32X86\2\cupsdrvr.dll]Datafile: [\\kde-bitshop\print$\W32X86\2\mysmbtstprn.PPD]Configfile: [\\kde-bitshop\print$\W32X86\2\cupsui.dll]Helpfile: [\\kde-bitshop\print$\W32X86\2\cups.hlp]</pre><p>思い出してほしいが、このコマンドはステップ6で選択したドライバの名前を検索する。このコマンドは次のステップに行く前に成功しなければならない。</p></li><li class="step" title="どのプリンタがこのドライバファイルを使うかをSambaに告げる(setdriver)。"><p class="title"><b>どのプリンタがこのドライバファイルを使うかをSambaに告げる(<code class="literal">setdriver</code>)。</b></p><p><a class="indexterm" name="id2663701"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'setdriver mysmbtstprn mydrivername' \	localhost</code></strong>Successfully set mysmbtstprn to driver mydrivername</pre><p>任意のプリンタ名(プリンタキュー)を任意のドライバに結合できるので、これは同じドライバを使う数多くのキューを設定するのに便利な方法である。これを成功させるために、setdriverコマンドに対する以前のステップのすべてを繰り返す必要はない。やらなければならない唯一の準備は、<code class="literal">enumdrivers</code>がドライバを見つけられねばならないと言うことと、<code class="literal">enumprinters</code>がプリンタを見つけられねばならないと言うことである。</p></li><li class="step" title="(オプション)この結合をSambaが認識しているかを調べる。"><p class="title"><b>(オプション)この結合をSambaが認識しているかを調べる。</b></p><p><a class="indexterm" name="id2663770"></a><a class="indexterm" name="id2663779"></a><a class="indexterm" name="id2663788"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'getprinter mysmbtstprn 2' localhost \  | grep driver</code></strong>drivername:[mydrivername] <code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'getprinter mysmbtstprn 2' localhost \  | grep -C4 driv</code></strong>servername:[\\kde-bitshop]printername:[\\kde-bitshop\mysmbtstprn]sharename:[mysmbtstprn]portname:[Done]drivername:[mydrivername]comment:[mysmbtstprn]location:[]sepfile:[]printprocessor:[winprint] <code class="prompt">root# </code><strong class="userinput"><code>rpcclient -U root%xxxx -c 'getdriver mysmbtstprn' localhost</code></strong>[Windows NT x86]Printer Driver Info 3:     Version: [2]     Driver Name: [mydrivername]     Architecture: [Windows NT x86]     Driver Path: [\\kde-bitshop\print$\W32X86\2\cupsdrvr.dll]     Datafile: [\\kde-bitshop\print$\W32X86\2\mysmbtstprn.PPD]     Configfile: [\\kde-bitshop\print$\W32X86\2\cupsui.dll]     Helpfile: [\\kde-bitshop\print$\W32X86\2\cups.hlp]     Monitorname: []     Defaultdatatype: [RAW]     Monitorname: []     Defaultdatatype: [RAW] <code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'enumprinters' localhost \	| grep mysmbtstprn</code></strong>     name:[\\kde-bitshop\mysmbtstprn]     description:[\\kde-bitshop\mysmbtstprn,mydrivername,mysmbtstprn]     comment:[mysmbtstprn]</pre><p><a class="indexterm" name="id2663866"></a>ステップ2と3からの結果とこの結果を比較する。上記のコマンドの1つ1つはインストールされたドライバを表示する。たとえ<code class="literal">enumprinters</code>コマンドが<span class="quote">“<span class="quote">description</span>”</span>行上のドライバを一覧表示するとしても。</p></li><li class="step" title="(オプション)正しいデバイスモードにドライバを修正する"><p class="title"><b>(オプション)正しいデバイスモードにドライバを修正する</b></p><p><a class="indexterm" name="id2663906"></a>クライアント上にドライバをどのようにインストールするかについては確実に知っているはずである。特にWindowsに慣れていない場合、簡単なやり方がある:ネットワークコンピュータをブラウズし、Sambaサーバを選び、共有を捜す。すべての共有されたSambaプリンタが見えるはずである。質問(question)中の1つをダブルクリックする。ドライバが得られてインストールされて、ネットワーク接続が設定される。別の方法は、<span class="guilabel">プリンタとFAX</span>フォルダを開き、質問(question)中のプリンタを右クリックし、<span class="guilabel">接続</span>又は<span class="guilabel">インストール</span>を選択する。その結果、クライアントのローカルの<span class="guilabel">プリンタとFAX</span>フォルダ中に新しいプリンタが現れ、それには<span class="guilabel">Sambahostname上のprintersharename</span>のような何らかの名前が付いている。</p><p>このステップをSambaのprinter admin(<code class="filename">smb.conf</code>中で定義)として実行することは重要である。これをWindows XP上で行う別の手法がある。これは、<span class="quote">“<span class="quote">DOSプロンプト</span>”</span>内で、以下のようにコマンドラインを使う(要求された時に、rootのsmbpassordを入力する):</p><pre class="screen"><code class="prompt">C:\> </code><strong class="userinput"><code>runas /netonly /user:root "rundll32 printui.dll,PrintUIEntry \	/in /n \\sambaserver\mysmbtstprn"</code></strong></pre><p>任意のプリンタの設定を一回変更し、(<span class="emphasis"><em><span class="guilabel">縦方向</span>を<span class="guilabel">横方向</span></em></span>になど)<span class="guibutton">適用</span>をクリックし、設定を元に戻す。</p></li><li class="step" title="クライアント上でプリンタをインストールする(ポイントアンドプリント)。"><p class="title"><b>クライアント上でプリンタをインストールする(ポイントアンドプリント)。</b></p><p><a class="indexterm" name="id2664035"></a></p><pre class="screen"><code class="prompt">C:\> </code><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /in /n "\\sambaserver\mysmbtstprn"</code></strong></pre><p>もしもこれが動かない場合、<em class="parameter"><code>[print$]</code></em>共有のアクセス許可問題かもしれない。</p></li><li class="step" title="(オプション)テストページを印刷する。"><p class="title"><b>(オプション)テストページを印刷する。</b></p><a class="indexterm" name="id2664080"></a><pre class="screen"><code class="prompt">C:\> </code><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /p /n "\\sambaserver\mysmbtstprn"</code></strong></pre><p>次に5回[タブ]を入力し、[ENTER]を二回入力し、[TAB]を1回、そして再度[ENTER]を入力しプリンタの所に行く。</p></li><li class="step" title="(推奨)テストページを調査する。"><p class="title"><b>(推奨)テストページを調査する。</b></p><p>今は、プリンタのインストールについてすべてを知っていて、そこに書いてあることを読む必要はない。額縁にこれを入れて、"初めてRPCCLIENTでインストールしたプリンタ"というタイトルを付けて壁に貼ろう。でも、やはり捨てるよね。Hmmm. Just kidding! By now you know everything about printer installations and you do not need to read a word.Just put it in a frame and bolt it to the wall with the heading "MY FIRST RPCCLIENT-INSTALLED PRINTER" why not just throw it away!</p></li><li class="step" title="(義務)飛び上がって成功を喜ぼう。"><p class="title"><b>(義務)飛び上がって成功を喜ぼう。</b></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>echo "Cheeeeerioooooo! Success..." >> /var/log/samba/log.smbd</code></strong></pre></li></ol></div></div><div class="sect2" title="トラブルシューティング再考"><div class="titlepage"><div><div><h3 class="title"><a name="id2664171"></a>トラブルシューティング再考</h3></div></div></div><p><a class="indexterm" name="id2664179"></a>もしもSambaが、キューがそこにないと考えた場合、setdriverコマンドは失敗する。インストールが成功すると以下の頼もしいメッセージが表示される:</p><pre class="screen">Printer Driver ABC successfully installed.</pre><p>この後、<code class="literal">adddriver</code>部分の手続きが続く。しかし、以下のような期待はずれのメッセージが出るかもしれない:<code class="computeroutput">result was NT_STATUS_UNSUCCESSFUL</code></p><p><a class="indexterm" name="id2664216"></a><a class="indexterm" name="id2664223"></a>CUPS中のキューを見ることができるだけでは十分ではないので、<code class="literal">lpstat -p ir85wm</code>コマンドを使う。最も最近のSambaのバージョンでは、適切なキュー一覧の更新を妨害するというバグがある。Sambaを再起動するか、すべてのsmbdプロセスにHUPを送るまで、新しくインストールしたCUPSプリンタの認識に失敗する。なぜSambaが<code class="literal">setdriver</code>コマンドを正しく実行しないかという理由がこれかと言うことを検証するために、Sambaがプリンタを<span class="quote">“<span class="quote">認識している</span>”</span>かを調べる:<a class="indexterm" name="id2664262"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient transmeta -N -U'root%xxxx' -c 'enumprinters 0'|grep ir85wm</code></strong>        printername:[ir85wm]</pre><p>別のコマンドでのやり方もある:<a class="indexterm" name="id2664292"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient transmeta -N -U'root%secret' -c 'getprinter ir85wm' </code></strong>        cmd = getprinter ir85wm        flags:[0x800000]        name:[\\transmeta\ir85wm]        description:[\\transmeta\ir85wm,ir85wm,DPD]        comment:[CUPS PostScript-Treiber for Windows NT/200x/XP]</pre><p>所で、上記のコマンドに、さらにいくつかを使うことが出来、もちろん、リモートのWindows NT印刷サーバにもインストールできる!</p></div></div><div class="sect1" title="印刷関連の*.tdbファイル"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2664333"></a>印刷関連の<code class="filename">*.tdb</code>ファイル</h2></div></div></div><p><a class="indexterm" name="id2664347"></a><a class="indexterm" name="id2664354"></a><a class="indexterm" name="id2664363"></a><a class="indexterm" name="id2664372"></a><a class="indexterm" name="id2664381"></a><a class="indexterm" name="id2664390"></a><a class="indexterm" name="id2664399"></a><a class="indexterm" name="id2664408"></a><a class="indexterm" name="id2664417"></a><a class="indexterm" name="id2664426"></a><a class="indexterm" name="id2664435"></a><a class="indexterm" name="id2664444"></a><a class="indexterm" name="id2664453"></a>すべてのSambaをインストールした環境にある、tdbという拡張子を持った、一連のファイルは謎であろう。それらは、<code class="filename">connections.tdb</code>, <code class="filename">printing.tdb</code>,<code class="filename">share_info.tdb</code>, <code class="filename">ntdrivers.tdb</code>, <code class="filename">unexpected.tdb</code>,<code class="filename">brlock.tdb</code>, <code class="filename">locking.tdb</code>, <code class="filename">ntforms.tdb</code>,<code class="filename">messages.tdb</code> , <code class="filename">ntprinters.tdb</code>, <code class="filename">sessionid.tdb</code>,と<code class="filename">secrets.tdb</code>である。これらの目的はなんであるか?</p><div class="sect2" title="Trivial Database Files"><div class="titlepage"><div><div><h3 class="title"><a name="id2664540"></a>Trivial Database Files</h3></div></div></div><p><a class="indexterm" name="id2664548"></a>Windows NT(印刷)サーバは、Windowsレジストリ中にエントリを格納することによって、そのクライアントに対して、その作業を提供するのに必要なすべての情報を記録する。クライアントの問い合わせはレジストリを読み取ることによって回答が行われ、Administratorかユーザの構成設定はレジストリ中に書き込むことで保存される。SambaとUNIXは明らかにこのようなレジストリを持っていない。Sambaはその代わりに、一連の<code class="filename">*.tdb</code>ファイルにすべてのクライアントに関連する情報を保存する(TDBはtrivial data baseの省略形である)。これらはたいてい<code class="filename">/var/lib/samba/</code>か<code class="filename">/var/lock/samba/</code>にある。印刷関連のファイルは、<code class="filename">ntprinters.tdb</code>, <code class="filename">printing.tdb</code>,<code class="filename">ntforms.tdb</code>と<code class="filename">ntdrivers.tdb</code>である。</p></div><div class="sect2" title="バイナリ形式"><div class="titlepage"><div><div><h3 class="title"><a name="id2664613"></a>バイナリ形式</h3></div></div></div><p><code class="filename">*.tdb</code>は人間に可読なファイルではない。それらはバイナリ形式である。<span class="quote">“<span class="quote">なぜASCIIでないのか?</span>”</span>と質問するかもしれない。<span class="quote">“<span class="quote">結局の所、ASCII設定ファイルは、便利でUNIXでの伝統である。</span>”</span>Sambaチームによって、デザインがこうなった理由は、主に性能である。Sambaは高速で動作する必要がある。ある環境では数千にもなる、各クライアントの接続毎に分離された<code class="literal">smbd</code>プロセスが動く。これらのいくつかは、<span class="emphasis"><em>同じ時間に</em></span>同じ<code class="filename">*.tdb</code>ファイルをそれら<code class="literal">smbd</code>プロセスが書き込みアクセスをする必要があるかもしれない。Sambaの<code class="filename">*.tdb</code>ファイル形式は、これを提供できる。多くのsmbdプロセスは同じ時間に同じ<code class="filename">*.tdb</code>ファイルに書き込みができる。これは純粋なASCIIファイルでは不可能である。</p></div><div class="sect2" title="*.tdbファイルの喪失"><div class="titlepage"><div><div><h3 class="title"><a name="id2664687"></a><code class="filename">*.tdb</code>ファイルの喪失</h3></div></div></div><p>すべての<code class="filename">*.tdb</code>ファイルはすべての読み取りと書き込みアクセス間で整合性を保持することはとても重要である。しかし、これらのファイルが<span class="emphasis"><em>壊れる</em></span>ことがあるかもしれない(書き込み処理中に、<code class="literal">kill -9 `pidof smbd'</code>を実行すると、ダメージを与えることになる。そのほか、急な電源断など)。このようなトラブルの場合、古い印刷関係の<code class="filename">*.tdb</code>ファイルを削除するのが唯一の解である。その後、その時点で<code class="filename">*.tdb</code>ファイルをバックアップから戻さない限り、すべての印刷関連の設定を再作成する必要がある。</p></div><div class="sect2" title="tdbbackupの使用"><div class="titlepage"><div><div><h3 class="title"><a name="id2664740"></a><code class="literal">tdbbackup</code>の使用</h3></div></div></div><p><a class="indexterm" name="id2664753"></a><a class="indexterm" name="id2664764"></a>Sambaは、システム中にある<code class="filename">*.tdb</code>ファイルをバックアップする、rootユーザを手助けする小さなユーティリティを同梱している。もしも引数なしでそれを動かすと、以下のメッセージが表示される:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>tdbbackup</code></strong> Usage: tdbbackup [options] <fname...>  Version:3.0a   -h            this help message   -s suffix     set the backup suffix   -v            verify mode (restore if corrupt)</pre><p>以下は<code class="filename">printing.tdb</code>ファイルをどのようにバックアップするかの例である:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>ls</code></strong>.              browse.dat     locking.tdb     ntdrivers.tdb printing.tdb..             share_info.tdb connections.tdb messages.tdb  ntforms.tdbprinting.tdbkp unexpected.tdb brlock.tdb      gmon.out      namelist.debug  ntprinters.tdb sessionid.tdb <code class="prompt">root# </code><strong class="userinput"><code>tdbbackup -s .bak printing.tdb</code></strong> printing.tdb : 135 records <code class="prompt">root# </code><strong class="userinput"><code>ls -l printing.tdb*</code></strong> -rw-------    1 root     root        40960 May  2 03:44 printing.tdb -rw-------    1 root     root        40960 May  2 03:44 printing.tdb.bak</pre></div></div><div class="sect1" title="Linuxprinting.orgからのCUPSプリントドライバ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2664863"></a>Linuxprinting.orgからのCUPSプリントドライバ</h2></div></div></div><p><a class="indexterm" name="id2664873"></a>CUPSはHP LaserJetタイプのプリンタに対する良いサポートがある。以下のように汎用ドライバをインストールできる:<a class="indexterm" name="id2664885"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>lpadmin -p laserjet4plus -v parallel:/dev/lp0 -E -m laserjet.ppd</code></strong></pre><p><code class="option">-m</code>スイッチは、CUPSが通常<code class="filename">/usr/share/cups/model</code>中に格納する、まだインストールされていないPPDのための標準リポジトリから<code class="filename">laserjet.ppd</code>を検索する。代替として、<code class="option">-P /path/to/your.ppd</code>を使っても良い。</p><p>しかし、汎用<code class="filename">laserjet.ppd</code>は、各LaserJet五巻も出るの各特別なオプションをサポートしない。すべてのモデルの、一連の<span class="quote">“<span class="quote">最小の共通項</span>”</span>が構成要素である。もしもある理由で、商用のESP Print Pro ドライバに対してお金を払わなければならない場合、最初に見に行く所は、<a class="ulink" href="http://www.linuxprinting.org/printer_list.cgi" target="_top">Linuxprinting</a>Webサイト上にあるデータベースにすべきである。Linuxprinting.orgは、各プリンタに対して使える最適のドライバがどれか、ということについて、優れた推奨情報を提供している。そのデータベースは、<code class="literal">foomatic-rip</code>ユーティリティの主要な著者でもある、MandrakesoftのTill Kamppeterの精力的な仕事によって、現在保持されている。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2664985"></a><a class="indexterm" name="id2664992"></a><a class="indexterm" name="id2664999"></a>前者の<code class="literal">cupsomatic</code>コンセプトは現在新しい優れたものにより置き換えられ、より強力な <code class="literal">foomatic-rip</code>が提供されている。<code class="literal">cupsomatic</code>はもはやメンテナンスされていない。新しいデータベースへのURLは<a class="ulink" href="http://www.linuxprinting.org/driver_list.cgi" target="_top">Foomatic-3.0</a>である。もしも<code class="literal">foomatic-rip</code>にアップグレードする場合、Foomaticで制御されるプリンタ用の、新しい形式のPPDもアップグレードすることも忘れないこと。foomatic-ripは古い<code class="literal">cupsomatic</code>で生成したPPDでは動かない。新しい形式のPPDはAdobe PPDの仕様と100％互換である。これらはまたSambaとcupsaddnmbユーティリティによってWindowsクライアントのためにドライバを提供するために、代わりに使われる!</p></div><div class="sect2" title="foomatic-rip と Foomaticの説明"><div class="titlepage"><div><div><h3 class="title"><a name="id2665058"></a>foomatic-rip と Foomaticの説明</h3></div></div></div><p><a class="indexterm" name="id2665067"></a><a class="indexterm" name="id2665074"></a>最近、ほとんどのLinuxディストリビューションは、(すべてのUNIXとMac OS XとDarwinでも動く)印刷関連のソフトウェアを作成するために、<a class="ulink" href="http://www.linuxprinting.org/" target="_top">Linuxprinting.org</a>からのユーティリティに頼っている。このサイトからのユーティリティは、サポートしているすべてのモデル、すべてのスプーラ、すべてのOSとすべてのパッケージ形式(それらがないので)に対して、ドライバとPPDの簡単な更新が出来る、エンドユーザにとてもわかりやすいインタフェースを持っている。その歴史は、数年前にさかのぼる。</p><p>最近、Foomaticは、対応プリンタモデルが<a class="ulink" href="http://www.linuxprinting.org/printer_list.cgi?make=Anyone" target="_top">1,000を超えるという</a>驚くべきマイルストーンに到達した。Linuxprinting.orgは、プリンタドライバ、サポートするモデルと、<a class="ulink" href="http://www.linuxprinting.org/foomatic.html" target="_top">Foomatic</a>データベース中で有効な種々のドライバ/プリンタの組み合わせに対するオプションについての、すべての重要な要素を保持している。現在、そのデータベース中には、<a class="ulink" href="http://www.linuxprinting.org/driver_list.cgi" target="_top">245のドライバ</a>が存在する。多くのドライバは種々のモデルをサポートし、多くのモデルは、異なったドライバで動作するかもしれない。これはあなたが選択するものである!</p><div class="sect3" title="690の“完璧な”プリンタ"><div class="titlepage"><div><div><h4 class="title"><a name="id2665152"></a>690の<span class="quote">“<span class="quote">完璧な</span>”</span>プリンタ</h4></div></div></div><p><a class="indexterm" name="id2665163"></a>現在、690ものドライバが完全に動作することが分かっている:181は<span class="emphasis"><em>ほとんど</em></span>完全で、96は <span class="emphasis"><em>部分的に</em></span>完全で、46は文鎮(paperweight)である(???)。これらの大半は、非PostScriptモデルであり(PostScriptプリンタは、CUPSによって、固有の製造元が提供したWindows PPDを使うことによって、完璧にサポートされる)、多機能デバイスは、GNU/Linux配下で、スキャンとコピーとFAXが出来ないならば、決して完全に動くとは見なされないということを心にとめておいておくこと。これは本当に驚くべき結果である!3年前、数は500以下であり、その時点でのLinuxかUNIX印刷は、現在の品質には到達していなかった。At present, there are 690 devices dubbed as working perfectly: 181 are <span class="emphasis"><em>mostly</em></span> perfect, 96are <span class="emphasis"><em>partially</em></span> perfect, and 46 are paperweights. Keeping in mind that most of these arenon-PostScript models (PostScript printers are automatically supported by CUPS to perfection by using theirown manufacturer-provided Windows PPD), and that a multifunctional device never qualifies as working perfectlyif it does not also scan and copy and fax under GNU/Linux  then this is a truly astonishingachievement! Three years ago the number was not more than 500, and Linux or UNIX printing at the time wasn'tanywhere near the quality it is today.</p></div><div class="sect3" title="どのように印刷HOWTOが始まったか"><div class="titlepage"><div><div><h4 class="title"><a name="id2665223"></a>どのように印刷HOWTOが始まったか</h4></div></div></div><p>数年前、<a class="ulink" href="http://www2.picante.com/" target="_top">Grant Taylor</a>が作業を開始した。現在のLinuxprinting.orgの大元は、彼が書いた最初の<a class="ulink" href="http://www.linuxprinting.org/foomatic2.9/howto/" target="_top">Linux Printing HOWTO</a>である。多数のLinuxユーザと管理者に、この複雑で繊細な設定の最初のステップをガイドするために提供された、この文書の関連プロジェクトとして(科学者にとって、印刷とは<span class="quote">“<span class="quote">紙の基盤の上に、インクかトナーの微片による明白なパターンによる構造化した堆積物を付けたものである</span>”</span>)、その時点でのLinux印刷を補う、ハードウェアとドライバについての情報集積を行う小さなPostgresデータベースの構築を開始した。このデータベースは、現在における、Foomaticの、ツールとデータの集合体のコアコンポーネントになった。その途中で、データをXML表記に変更した。</p></div><div class="sect3" title="Foomaticの奇妙な名前"><div class="titlepage"><div><div><h4 class="title"><a name="id2665272"></a>Foomaticの奇妙な名前</h4></div></div></div><p><a class="indexterm" name="id2665281"></a><span class="quote">“<span class="quote">なぜこんな奇妙な名前なのか?</span>”</span>2000年の春頃に、これが軌道に乗ったときに、CUPSは現在よりもかなり知名度が亡く、ほとんどのシステムはLPD、LPRng、か、あるいはPDQを印刷に使用していた。CUPSはごくわずかの汎用ドライバ(100くらいの少数の異なったプリンタモデルにのみ対応)しか提供できていなかった。デバイス固有のオプションのサポートも出来ていなかった。CUPSは固有の組み込みラスタライズフィルタ(Ghostscript由来の<em class="parameter"><code>pstoraster</code></em>)も提供していた。他方、CUPSは、標準化され、きちんと定義されているPPDファイルを使って、すべての印刷オプションの<span class="emphasis"><em>制御</em></span>をきちんとサポート出来た。さらに、CUPSは簡単に拡張できるように設計されていた。</p><p>Taylorはすでに、より多くのプリンタと、それと共に動くGhostscript<span class="quote">“<span class="quote">ドライバ</span>”</span>について、良くできた動作状況一覧を、彼のデータベース中に用意していた。彼のアイデアは、データベース情報からPPDを作成するためと、CUPSで動作する標準Ghostscriptドライバを生成するために、それがうまく動くことを検証することであった。また、それは一石数鳥でもあった:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>これは、CUPSで有効な現在と将来のすべてのGhostscript	フィルタ開発を行う。</p></li><li class="listitem"><p>CUPSユーザにたくさんの追加プリンタモデルを有効にさせる	(しばしば、伝統的なGhostscriptによる印刷は、1つのみが有効であるという理由で)</p></li><li class="listitem"><p>これは、Ghostscriptフィルタを使う事を望んでいる(あるいは	必要としている)ユーザに、すべての詳細CUPSオプションを提供する(Web	インタフェース、GUIドライバの組み合わせで)</p></li></ul></div></div><div class="sect3" title="cupsomatic, pdqomatic, lpdomatic, directomatic"><div class="titlepage"><div><div><h4 class="title"><a name="id2665372"></a>cupsomatic, pdqomatic, lpdomatic, directomatic</h4></div></div></div><p><a class="indexterm" name="id2665380"></a><a class="indexterm" name="id2665387"></a><a class="indexterm" name="id2665394"></a>CUPSは<a class="ulink" href="http://www.linuxprinting.org/download.cgi?filename=cupsomatic&show=0" target="_top">cupsomatic</a>という名前が付いた、簡単に作成されたフィルタスクリプトを経由して動作する。cupsomaticはGhostscript経由でprintflieを動かし、必要とされる、どちらかというと複雑なコマンドラインを自動的に構築する。これは、それが動くようにするために、CUPSシステム中にコピーされる必要がある。cupsomatic制御がGhostscript病がプロセスを制御する方法を構築するために、CUPS-PPDが必要である。このPPDはデータベースの内容から直接生成される。CUPSとそれぞれのプリンタ/フィルタの組み合わせのために、CUPS-O-Maticという名前の、他のPerlスクリプトがPPDを生成する。これが動作した後、Taylorは2つの他のスプーラのために、類似のことを数日で実装した。config-generatorスクリプトのために選ばれた名前は、(PDQ用には)<a class="ulink" href="http://www.linuxprinting.org/download.cgi?filename=lpdomatic&show=0" target="_top">PDQ-O-Matic</a>と(推測したとおり、LPD用に)<a class="ulink" href="http://www.linuxprinting.org/download.cgi?filename=lpdomatic&show=0" target="_top">LPD-O-Matic</a>であった。ここでの構成はPPDを使用しなかったが、他のスプーラ固有のファイルは使った。</p><p>その年の夏の終わり頃に、<a class="ulink" href="http://www.linuxprinting.org/till/" target="_top">Till Kamppeter</a>は作業をデータベース中に格納し始めた。Kamppeterはその印刷システムをCUPSに変更するために、新たに<a class="ulink" href="http://www.mandrakesoft.com/" target="_top">Mandrakesoft</a>に雇われ、その後<a class="ulink" href="http://www.fltk.org/" target="_top">FLTK</a>ベースの<a class="ulink" href="http://cups.sourceforge.net/xpp/" target="_top">XPP</a>(CUPS lpコマンドに対するGUIフロントエンド)が出来た。彼は、大量の新しい情報と新しいプリンタを追加した。また、<a class="ulink" href="http://ppr.sourceforge.net/" target="_top">PPR</a> (ppromatic経由), <a class="ulink" href="http://sourceforge.net/projects/lpr/" target="_top">GNUlpr</a>,と<a class="ulink" href="http://www.lprng.org/" target="_top">LPRng</a> (存在するlpdomatic経由両方)とスプーラなしの印刷(<a class="ulink" href="http://www.linuxprinting.org/download.cgi?filename=directomatic&show=0" target="_top">directomatic</a>)のような他のスプーラに対するサポートも開発した。</p><p>そのため、あなたの質問に答えるために、<span class="quote">“<span class="quote">Foomatic</span>”</span>は、<span class="quote">“<span class="quote">*omatic</span>”</span>スクリプトに隠れたコードとデータをすべて上書きする汎用の名前である。Foomaticは、バージョン2.0.xまで、CUPS用のLinuxprinting.orgのPPDに結合する(ひどい)Perlデータ構造を要求していた。異なったプリンタ設定ファイルのように、すべてのスプーラに対して異なった<span class="quote">“<span class="quote">*omatic</span>”</span>スクリプトがある。</p></div><div class="sect3" title="すばらしい統一の達成"><div class="titlepage"><div><div><h4 class="title"><a name="id2665562"></a><span class="emphasis"><em>すばらしい統一の</em></span>達成</h4></div></div></div><p><a class="indexterm" name="id2665572"></a>これは、Foomatic バージョン 2.9(β)中と<span class="quote">“<span class="quote">安定版</span>”</span>3.0としてリリースされたものですべて変更された。これは現在、すべての*omaticスクリプトの集合として到達して、さらにこれは<a class="ulink" href="http://www.linuxprinting.org/foomatic2.9/download.cgi?filename=foomatic-rip&show=0" target="_top">foomatic-rip</a>と呼ばれている。foomatcic-rip はすべての異なったスプーラと同様によって使われ、それがPPD(オリジナルPostScriptプリンタのPPDとLinuxprinting.orgが作成したもの両方)を読むことが出来るという理由で、すべてのサポートされているスプーラは突然自由にPPDの機能を使えるようになる。ユーザはシステムにfoomatic-ripを組み込む必要があるだけである。ユーザ用に、改良されたメディア対湯とソースのサポートがある。それは、紙のサイズとトレイが簡単に設定できるものである。</p><p><a class="indexterm" name="id2665623"></a><a class="indexterm" name="id2665629"></a><a class="indexterm" name="id2665637"></a>また、新しい世代のLinuxprinting.org PPDは、もはやPerlデータ構造を含まない。もしも、あなたがディストリビューションメンテナで、以前のバージョンのFoomaticを使用しているのであれば、..................しかし、新しい<a class="ulink" href="http://www.linuxprinting.org/download/foomatic/foomatic-db-engine-3.0.0beta1.tar.gz" target="_top">foomatic-db-engine</a>経由で新しいバージョンのPPDセットを生成することを覚えておいてほしい!個々のユーザは、Foomaticチュートリアル中で概要が説明されている<a class="ulink" href="http://www.linuxprinting.org/kpfeifle/LinuxKongress2002/Tutorial/II.Foomatic-User/II.tutorial-handout-foomatic-user.html" target="_top">以下のステップ</a>か、この章によって、使用しているモデルのための、特定の、新しい単一PPDを生成することが必要である。この新しい開発版は全く驚くべきものである。Also, the new generation of Linuxprinting.org PPDs no longer contains Perl data structures. If you are adistro maintainer and have used the previous version of Foomatic, you may want to give the new one a spin, butremember to generate a new-version set of PPDs via the new <a class="ulink" href="http://www.linuxprinting.org/download/foomatic/foomatic-db-engine-3.0.0beta1.tar.gz" target="_top">foomatic-db-engine!</a>.Individual users just need to generate a single new PPD specific to their model by <a class="ulink" href="http://www.linuxprinting.org/kpfeifle/LinuxKongress2002/Tutorial/II.Foomatic-User/II.tutorial-handout-foomatic-user.html" target="_top">followingthe steps</a> outlined in the Foomatic tutorial or in this chapter. This new development is truly amazing.</p><p><a class="indexterm" name="id2665706"></a><a class="indexterm" name="id2665713"></a><a class="indexterm" name="id2665720"></a>foomatic-ripは、異なった文法、オプション、デバイスの選択、あるいは異なる各プリンタまたはスプーラのためのフィルタを使うGhostscriptを動かすために必要な、とても巧妙なラッパーである。同時に、これはプリントキューに関連づけられているPPDを読み、ユーザの選択に従って、印刷ジョブを変更する。これを一緒にすると、Adobeのspecに対し、新しいFoomatic PPDは100％準拠となる(ここ怪しい)。Foomaticのコンセプトにおける、いくつかの革新的な特徴は、ユーザを驚かせるだろう。これは、多くのプリンタに対する、個別の紙サイズのサポートや同じジョブ内での、異なったペーパトレイを使う印刷のサポートができる(両方の場合において、Windowsベースのベンダプリンタドライバがこれをサポートしていなかったとしても)。foomatic-rip is a very clever wrapper around the need to run Ghostscript with a different syntax, options,device selections, and/or filters for each different printer or spooler. At the same time, it can read the PPDassociated with a print queue and modify the print job according to the user selections. Together with thiscomes the 100% compliance of the new Foomatic PPDs with the Adobe spec. Some innovative features of theFoomatic concept may surprise users. It will support custom paper sizes for many printers and will supportprinting on media drawn from different paper trays within the same job (in both cases, even where there is nosupport for this from Windows-based vendor printer drivers).</p></div><div class="sect3" title="ドライバ開発の外側"><div class="titlepage"><div><div><h4 class="title"><a name="id2665761"></a>ドライバ開発の外側</h4></div></div></div><p><a class="indexterm" name="id2665769"></a>ほとんどのドライバ開発それ自身は、Linuxprinting.org中では発生しない。ドライバは独立したメンテナによって書かれる。Linuxprinting.orgはすべての情報を蓄え、そのデータベース中に格納するだけである。さらに、今知られている、任意の最新式(あるいは旧来の)印刷システム中にたくさんのドライバを統合する、Foomaticという糊も提供する。</p><p>異なったドライバ開発グループについて話すと、仕事のほとんどは、それらのプロジェクトにおいて、現在ほとんど終わっている:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2665801"></a>	<a class="ulink" href="http://www-124.ibm.com/developerworks/oss/linux/projects/omni/" target="_top">Omni</a>	IBMによるフリーソフトウェアプロジェクトで、良くできたOS/2時代のプリンタ	ドライバの知識を、Linux/UNIXに対する、最新の、モジュラーなユニバーサルドライバ	アーキテクチャに変換することを試みている(今だβ)。これは現在437モデルを	サポートしている。</p></li><li class="listitem"><p><a class="indexterm" name="id2665832"></a>	<a class="ulink" href="http://hpinkjet.sf.net/" target="_top">HPIJS</a> 	HPによるフリーソフトウェアプロジェクトで、自分自身のモデルの領域における	サポートを提供する(とても自然ではあるが、ほとんどの場合の印刷は、完璧なもので、	真の写真品質も提供している)。これは現在369モデルをサポートしている。</p></li><li class="listitem"><p><a class="indexterm" name="id2665861"></a>	<a class="ulink" href="http://gimp-print.sourceforge.net/" target="_top">Gutenprint</a> 	フリーソフトウェアの取り組みであり、(CUPSの主要開発者としても知られている)	Michael Sweetによって開始され、現在驚異的な写真レベルの品質に到達した	Robert Krawitzによって指揮されている(多くのエプソンユーザは、その品質は、	Microsoftプラットフォーム向けのEpsonによって提供されたベンダドライバよりも	良いと断言している)。現在522モデルをサポートしている。</p></li></ul></div></div><div class="sect3" title="フォーラム、ダウンロード、チュートリアル、HOWTO(Mac OS Xと商用UNIX用も)"><div class="titlepage"><div><div><h4 class="title"><a name="id2665890"></a>フォーラム、ダウンロード、チュートリアル、HOWTO(Mac OS Xと商用UNIX用も)</h4></div></div></div><p>Linuxprinting.orgは現在プリンタドライバのダウンロードを行うためのとりまとめ窓口である。プリンタ情報を探し、<a class="ulink" href="http://www.linuxprinting.org//kpfeifle/LinuxKongress2002/Tutorial/" target="_top">チュートリアル</a>か、プリンタの問題について、よく知られている<a class="ulink" href="http://www.linuxprinting.org/newsportal/" target="_top">フォーラム</a>で解決してみよう。このフォーラムは、GNU/Linuxユーザに限ったものではなく、<a class="ulink" href="http://www.linuxprinting.org/macosx/" target="_top">商用UNIXシステム</a>の管理者もここに来ていて、相対的に新しい<a class="ulink" href="http://www.linuxprinting.org/newsportal/thread.php3?name=linuxprinting.macosx.general" target="_top">Mac OS Xフォーラム</a>は、ここ数週間で最も利用度の高いフォーラムの一つである。</p><p><a class="indexterm" name="id2665944"></a><a class="indexterm" name="id2665950"></a><a class="indexterm" name="id2665957"></a>Linuxprinting.orgとGhostscriptを囲むFoomaticドライバラッパはすべての重要なディストリビューション上で印刷のための標準ツール(tool-chain)である。それらのほとんどは、基盤としてCUPSを使っている。ここ数年の間、ほとんどのプリンタに関するデータは、Kamppeterによって追加され、多くの追加コードが、SuSE、Red Hat、Conectiva、Debianやその他の技術者から寄贈された。ベンダ中立はFoomaticプロジェクトの重要なゴールである。MandrakeとConectivaは統合されて現在Mandrivaと呼ばれている。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>MandrakesoftのTill Kamppeterは彼の空き時間にLinuxprinting.orgとFoomaticをメンテナンスするという優れた仕事を行っている。そのため、それをしばしば使うのであれば、あなたが感謝しているという事を送ってほしい。</p></div></div><div class="sect3" title="Foomaticデータベースが生成したPPD"><div class="titlepage"><div><div><h4 class="title"><a name="id2666002"></a>Foomaticデータベースが生成したPPD</h4></div></div></div><p><a class="indexterm" name="id2666011"></a><a class="indexterm" name="id2666019"></a><a class="indexterm" name="id2666026"></a><a class="indexterm" name="id2666033"></a><a class="indexterm" name="id2666040"></a><a class="indexterm" name="id2666047"></a><a class="indexterm" name="id2666054"></a><a class="indexterm" name="id2666060"></a><a class="indexterm" name="id2666068"></a>Foomaticデータベースはそれ自身だけで驚くべき工夫の1つである。プリンタとドライバ情報を保存しているだけではなく、その内部XMLベースのデータベースから、その場でPPDファイルを生成できる。それらPPDがAdobe仕様のPPDにモデル化される間、Linuxprinting.org/Foomatic-PPDは普通ではPostScriptプリンタを制御できない。それらは、Eposn Stylus inkjet、HP Photosmart、あるいは持っているプリンタ上で鳴らすことや吹くことが出来る、すべてのベルと笛を記述するのに使われる。その主要仕掛けは小さな追加の1行であり、PPDの仕様によって予測されたものではなく、<em class="parameter"><code>*cupsFilter</code></em>というキーワードで始まる。これはCUPSデーモンに、どのようにPostScript印刷ファイルを処理するかを告げる(旧形式のFoomatic-PPDはcupsomaticフィルタスクリプトと名前が付けられ、新しい形式のPPDはfoomatic-ripと呼ばれる)。このフィルタスクリプトはホストシステム上でGhostscriptを呼び出し(推奨する別バージョンはESP Ghostscript)、レンダリング作業を行う。foomatic-ripは、PostScriptジョブを、対象デバイス用のラスタフォーマットに変換する、Ghostscriptから問い合わせを行う、フィルタか内部デバイス設定がどれかを知っている。この、非PostScriptプリンタのオプションを記述するPPDの使用法は、CUPS開発者の発明である。その結果は簡単である。GUIツール(すばらしいKDEの<a class="ulink" href="http://printing.kde.org/overview/kprinter.phtml" target="_top">kprinter</a>か、GNOMEの<a class="ulink" href="http://gtklp.sourceforge.net/" target="_top">gtklp</a> xppとCUPSのWebサイト)はPPDを読み取り、その情報を直感的な面ふー選択として、ユーザに対し、有効な設定を提供するための情報として使う。</p></div></div><div class="sect2" title="foomatic-ripとFoomatic PPDのダウンロードとインストール"><div class="titlepage"><div><div><h3 class="title"><a name="id2666149"></a>foomatic-ripとFoomatic PPDのダウンロードとインストール</h3></div></div></div><p>以下はfoomati-ripで制御される、CUPSでのLaserJet 4Plus互換プリンタインストール手順である(SuSE、UnitedLinuxとMandrakeにおける最新ディストリビューションではFoomatic-PPDの完全なパッケージと<code class="literal">foomatic-rip</code>ユーティリティを同梱している。Linuxprinting.orgに直接行くと最新のドライバ/PPDファイルを入手できる)。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>inuxprinting.orgのプリンタ一覧ページ<a class="ulink" href="http://www.linuxprinting.org/printer_list.cgi" target="_top">	をブラウザで開く。</a>	</p></li><li class="listitem"><p><a class="ulink" href="http://www.linuxprinting.org/printer_list.cgi?make=Anyone" target="_top">データベース</a>	中の完全なプリンタ一覧をチェックする。	</p></li><li class="listitem"><p>使用しているモデルを選択しそのリンクをクリックする。	</p></li><li class="listitem"><p>このモデルに対して動作可能なすべてのドライバの一覧ページが表示される	(すべてのプリンタに、必ず<span class="emphasis"><em>1つ</em></span>推奨ドライバがある。まず初めにそれを試す)。	</p></li><li class="listitem"><p>この例の場合(HP LaserJet 4 Plus)、	<a class="ulink" href="http://www.linuxprinting.org/show_printer.cgi?recnum=HP-LaserJet_4_Plus" target="_top">HP-LaserJet 4 Plus</a>	という既定値のドライバになる。	</p></li><li class="listitem"><p>推奨ドライバはljet4である。</p></li><li class="listitem"><p>いくつかのリンクがここで提供されている。Linuxprinting.orgに	不慣れならば、それらすべてを見てみるべきである。	</p></li><li class="listitem"><p><a class="ulink" href="http://www.linuxprinting.org/show_driver.cgi?driver=ljet4" target="_top">ljet4</a>	に対するデータベースページへのリンクがある。ドライバのページ上には、種々の有効な	スプーラでそのドライバをどのように使うかについての重要かつ詳細な情報がある。</p></li><li class="listitem"><p>他のリンクは、ドライバの著者のホームページを示しているだろう。</p></li><li class="listitem"><p><a class="ulink" href="http://www.linuxprinting.org/cups-doc.html" target="_top">CUPS</a>	に関するセットアップ手順のヒントを提供する重要なリンクがある:	<a class="ulink" href="http://www.linuxprinting.org/pdq-doc.html" target="_top">PDQ</a>;	<a class="ulink" href="http://www.linuxprinting.org/lpd-doc.html" target="_top">LPD, LPRng, と GNUlpr</a>);	同様に<a class="ulink" href="http://www.linuxprinting.org/ppr-doc.html" target="_top">PPR</a>	または<span class="quote">“<span class="quote">spoolerless</span>”</span> <a class="ulink" href="http://www.linuxprinting.org/direct-doc.html" target="_top">printing</a>.	</p></li><li class="listitem"><p>このリンク経由でブラウザ中でPPDを閲覧できる:	<a class="ulink" href="http://www.linuxprinting.org/ppd-o-matic.cgi?driver=ljet4&printer=HP-LaserJet_4_Plus&show=1" target="_top">http://www.linuxprinting.org/ppd-o-matic.cgi?driver=ljet4&printer=HP-LaserJet_4_Plus&show=1</a>	</p></li><li class="listitem"><p>最も重要なことは、	<a class="ulink" href="http://www.linuxprinting.org/ppd-o-matic.cgi?driver=ljet4&printer=HP-LaserJet_4_Plus&show=0" target="_top">PPD</a>	を生成しダウンロードできると言うことである。	</p></li><li class="listitem"><p>PPDは使用するモデルとドライバが使うときに必要なすべての情報を	含む。一度インストールすると、これはユーザに対して透過的に動作する。その後は	Webベースのメニューか、印刷ダイアログGUIか、コマンドラインから、解像度、	紙のサイズなどのみを指定する必要がある。</p></li><li class="listitem"><p>もしもドライバ	<a class="ulink" href="http://www.linuxprinting.org/show_driver.cgi?driver=ljet4" target="_top">ページ</a>	で作業を終わるならば、<span class="quote">“<span class="quote">PPD-O-Matic</span>”</span>オンラインPPDジェネレータ	プログラムを使う選択が出来る。</p></li><li class="listitem"><p>正確なモデルを選択し、<span class="guilabel">Download</span>か	<span class="guilabel">Display PPD file</span>のどちらかをチェックし、	<span class="guilabel">Generate PPD file</span>をクリックする。</p></li><li class="listitem"><p>もしもブラウザビューからPPDファイルをセーブした場合、	カットアンドペーストは使わないこと(行末やタブ情報を欠落する可能性があるため、	PPDファイルが壊れてしまう可能性が高くなる)。代わりに、	ブラウザメニュー中の<span class="guimenuitem">ファイル名を指定して保存</span>を	使う(Webページからの<span class="guilabel">Download</span>オプションを使うのが	最も良い)。</p></li><li class="listitem"><p>各ドライバページ上にある、他の興味深い部分は、	<span class="guimenuitem">Show execution details</span>である。もしも使用している	プリンタモデルを指定し、そのボタンをクリックすると、完全なGhostscript	コマンドラインが表示され、そのドライバとプリンタモデルの組み合わせに対して	有効なすべてのオプションをエミュレートする。これは	<span class="quote">“<span class="quote">それを行うことでGhostscriptを学ぶ</span>”</span>優れた方法である。	また、忌々しい印刷スクリプトのための、優れたコマンドラインを再構築することを	必要とするすべての経験者のための、優れた一覧表(cheat sheet)でもある。	しかし、それは正確な文法を思い出すことはできない。</p></li><li class="listitem"><p>時々、Linuxprinting.orgを見ている間に、ハードディスクの	<code class="filename">/path/to/my-printer.ppd</code>のような、適当な位置にPPDを	セーブする(CUPS Webインタフェースの助けを借りて使用しているプリンタを	インストールすることを好むならば、PPDを	<code class="filename">/usr/share/cups/model/</code>というパスにセーブし、	cupsdを再起動する)。</p></li><li class="listitem"><p>次に、以下のようなコマンドラインでプリンタをインストールする:	</p><pre class="screen">	<code class="prompt">root# </code><strong class="userinput"><code>lpadmin -p laserjet4plus -v parallel:/dev/lp0 -E \		-P path/to/my-printer.ppd</code></strong>	</pre></li><li class="listitem"><p>Linuxprinting.orgからの、新しい形式の<span class="quote">“<span class="quote">Foomatic-PPDs</span>”</span>	用には、foomatic-ripと呼ばれる特別なCUPSフィルタも必要である。	</p></li><li class="listitem"><p>foomatic-rip Perlスクリプトそれ自身もいくつか興味深い	<a class="ulink" href="http://www.linuxprinting.org/foomatic2.9/download.cgi?filename=foomatic-rip&show=1" target="_top">読み物</a>	を作る。なぜならば、Kamppeterによるインラインコメントによってよく文書化されて	いるからである(非Perlハッカーが、それを読むことで印刷について多少勉強できる)。	</p></li><li class="listitem"><p><code class="filename">/usr/lib/cups/filter/foomatic-rip</code>か	他の$pathのどちらかにfoomatic-ripを保存する(そして、それを誰でも実行できる	ようにするのを忘れないこと)。繰り返すが、コピーアンドペーストでセーブしない	こと。適切なリンクを使うか、ブラウザ中の	<span class="guimenuitem">ファイル名を指定して</span>保存を使うこと。</p></li><li class="listitem"><p>もしも固有の$PATHにfoomatic-ripを保存したならば、シンボリックリンクを作る:	</p><pre class="screen">	<code class="prompt">root# </code><strong class="userinput"><code>cd /usr/lib/cups/filter/ ; ln -s `which foomatic-rip'</code></strong>	</pre><p>	</p><p>	CUPSはcupsdを再起動後起動時に有効なこの新しいフィルタを検索する。</p></li></ul></div><p>一度Foomatic PPDで設定された印刷キューに印刷すると、CUPSは適切なコマンドを挿入し、結果のPostScriptファイル中にコメントを挿入する。foomatic-ripはそれを読み、それらに対して処理を行うことが出来、さらに、ジョブファイル中に埋め込まれている、特別にエンコードされたFoomaticコメントのいくつかを使う。それらは順に(ユーザにとっては透過的に)どのように結果のラスタデータを見えるようにすべきかと、どのプリンタコマンドを、データストリーム中に埋め込むかを、正確に、プリンタドライバに指示する、複雑なGhostscriptコマンドを組み立てるのに使われる。以下が必要である:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="quote">“<span class="quote">foomatic+なにか</span>”</span> PPD しかし、	CUPSで印刷するためには、これだけでは不十分である(これは単に	<span class="emphasis"><em>1つの</em></span>重要な要素である)。</p></li><li class="listitem"><p><code class="filename">/usr/lib/cups/filters/</code>中の	<em class="parameter"><code>foomatic-rip</code></em>フィルタスクリプト(Perl)。</p></li><li class="listitem"><p>foomatic-ripを動かすためのPerl</p></li><li class="listitem"><p>使用しているプリンタが受け取れる形に適合したラスタデータを	生成するためのGhostscript(これが主要な仕事を行うため、PPD/foomatic-ripの組で	制御される)</p></li><li class="listitem"><p>Ghostscriptは(ドライバ/モデルに依存するが)使用しているモデルに	対する選択されたドライバを表す特定のデバイスに対するサポートを	<span class="emphasis"><em>含んでいなければならない</em></span>(<code class="literal">gs -h</code>によって	確認できる)。</p></li></ul></div></div></div><div class="sect1" title="CUPSによるページの課金"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2666703"></a>CUPSによるページの課金</h2></div></div></div><p><a class="indexterm" name="id2666712"></a>しばしば、日、週、月単位に、一定のページ数かデータ量を超えて、Sambaユーザ(すなわちWindowsクライアント)が、印刷が出来ないようにする、印刷quotaに関連する質問がある。この機能は、使用している実際の印刷サブシステムに依存する。Sambaはクライアントから常にジョブファイルを受け取り(<span class="emphasis"><em>フィルタされるか否か</em></span>、この印刷サブシステムに渡す。</p><p>もちろん、使用している人固有のスクリプトで、これをハックすることは出来る。しかし、CUPSがある。CUPSは、ジョブのサイズやページ数やその両方をベースとできるquotaをサポートし、それを行いたいときにはいつでも橋渡しをすることが出来る。</p><div class="sect2" title="Quotasの設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2666751"></a>Quotasの設定</h3></div></div></div><p><a class="indexterm" name="id2666759"></a>CUPSで印刷quotaをrootがどのように設定するかのコマンド例であり、存在するプリンタが<span class="quote">“<span class="quote">quotaprinter</span>”</span>であることを仮定している:<a class="indexterm" name="id2666776"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>lpadmin -p quotaprinter -o job-quota-period=604800 \	-o job-k-limit=1024 -o job-page-limit=100</code></strong></pre><p>これは個々ののユーザに対して、604800秒(=一週間)で、100ページまたはデータが1024KBでの制限を行う(どちらか小さい方)。</p></div><div class="sect2" title="正しいあるいは不正な課金"><div class="titlepage"><div><div><h3 class="title"><a name="id2666810"></a>正しいあるいは不正な課金</h3></div></div></div><p>CUPSで正しく計測するために、印刷ファイルはCUPSpstopsフィルタに送られる必要がある;そうでない場合、ダミーのカウント<span class="quote">“<span class="quote">1</span>”</span>を使う。いくつかの印刷ファイルはそれに送られないが(例えば画像ファイル)、それらはほとんど1ページのジョブである。これはまた、それらのファイルを<span class="quote">“<span class="quote">raw</span>”</span>(すなわちそれらに何も変更をせず、フィルタリングもしない)すぷーすする、クライアントコンピュータとCUPS/Samba上で動いている、対象プリンタ用のプロプラエティなドライバは、1ページとして計測するということでもある!</p><p>課金を行える機会を得るために、それらのクライアントからPostScriptで送る必要がある(すなわち、そこでPostScriptドライバを動かす)。もしも、プリンタが非PostScriptモデルならば、対象のプリンタ用に印刷可能な形式にファイルを変換するためのジョブを、CUPSで行わせる必要がある。Linuxprinting.orgにはドライバの<a class="ulink" href="http://www.linuxprinting.org/printer_list.cgi" target="_top">リスト</a>がある。</p></div><div class="sect2" title="Windowsクライアント用のAdobeとCUPS PostScriptドライバ"><div class="titlepage"><div><div><h3 class="title"><a name="id2666867"></a>Windowsクライアント用のAdobeとCUPS PostScriptドライバ</h3></div></div></div><p><a class="indexterm" name="id2666877"></a><a class="indexterm" name="id2666884"></a><a class="indexterm" name="id2666891"></a><a class="indexterm" name="id2666897"></a><a class="indexterm" name="id2666904"></a>CUPS 1.1.16より前は、Windowsクライアント上でAdobe PostScriptドライバを使うことが出来るのみであった。このドライバの出力は、CUPS/Sambaサイド上の<code class="literal">pstops</code>フィルタに常時渡されるわけではなく、そのため、正しく計測出来なかった(その理由は、それがしばしば使用されるPPDに依存するからであり、CUPSに<code class="literal">pstops</code>をスキップさせる真のPostScriptの直前にPJL-ヘッダが書かれ、直接<code class="literal">pstoraster</code>ステージに行くからである)。</p><p>CUPS 1.1.16とそれ以降のリリースから、Windows NT/200x/XPクライアント用のCUPS PostScriptドライバを使うことが出来る(これは<code class="filename">cups-samba-1.1.16.tar.gz</code>というパッケージとして<code class="filename">http://www.cups.org/</code>のダウンロード領域中にタグされている)。これはWindows 9x/Meクライアントでは<span class="emphasis"><em>動かない</em></span>が以下は保証される:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p> <a class="indexterm" name="id2666979"></a>PJL-ヘッダを書かない。</p></li><li class="listitem"><p>固有の意味を持つドライバPPD中に名前があるすべての	PJL-オプションを、引き続き読み取りサポートする。</p></li><li class="listitem"><p>CUPS/Sambaサーバ上の<code class="literal">pstops</code>フィルタに	ファイルが渡される。</p></li><li class="listitem"><p>印刷ファイルのページカウントが正しくなる。</p></li></ul></div><p>この組み合わせによる設定についてのより詳細は、<code class="literal">cupsaddsmb</code>のマニュアルページで読むことが出来る(これはCUPSがインストールされている所でのみに存在し1.1.16以降で有効である)。</p></div><div class="sect2" title="page_logファイルの形式"><div class="titlepage"><div><div><h3 class="title"><a name="id2667028"></a>page_logファイルの形式</h3></div></div></div><p><a class="indexterm" name="id2667037"></a>ジョブの各ページに対する<code class="filename">page_log</code>中のCUPSログの項目は以下の通り:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>プリンタ名(Printer name)</p></li><li class="listitem"><p>ユーザ名(User name)</p></li><li class="listitem"><p>ジョブID(Job ID)</p></li><li class="listitem"><p>印刷時間(Time of printing)</p></li><li class="listitem"><p>ページ数(Page number)</p></li><li class="listitem"><p>印刷部数(Number of copies)</p></li><li class="listitem"><p>課金情報文字列(A billing information string) (オプション)</p></li><li class="listitem"><p>ジョブを送り出したホスト(The host that sent the job) (バージョン1.1.19以降)</p></li></ul></div><p>以下は項目を含む形式の図示を行うための、CUPSサーバの<code class="filename">page_log</code>ファイルから抜き出したものである:</p><pre class="screen">tec_IS2027 kurt 401 [22/Apr/2003:10:28:43 +0100] 1 3 #marketing 10.160.50.13tec_IS2027 kurt 401 [22/Apr/2003:10:28:43 +0100] 2 3 #marketing 10.160.50.13tec_IS2027 kurt 401 [22/Apr/2003:10:28:43 +0100] 3 3 #marketing 10.160.50.13tec_IS2027 kurt 401 [22/Apr/2003:10:28:43 +0100] 4 3 #marketing 10.160.50.13Dig9110 boss 402 [22/Apr/2003:10:33:22 +0100] 1 440 finance-dep 10.160.51.33</pre><p>これはジョブID<em class="parameter"><code>401</code></em>で、<em class="parameter"><code>tec_IS2027</code></em>上でユーザ<em class="parameter"><code>kurt</code></em>によって印刷され、64ページのジョブで三部印刷され、<em class="parameter"><code>#marketing</code></em>に請求が行き、IPアドレス<code class="constant">10.160.50.13.</code>から送られた。次のジョブはIDが<em class="parameter"><code>402</code></em>であり、ユーザ<em class="parameter"><code>boss</code></em>によって、<code class="constant">10.160.51.33</code>というIPアドレスから送られ、1ページ、440部印刷され、<em class="parameter"><code>finance-dep</code></em>に請求が行った。</p></div><div class="sect2" title="存在する欠点"><div class="titlepage"><div><div><h3 class="title"><a name="id2667182"></a>存在する欠点</h3></div></div></div><p>何か問題か欠点がこのquotaシステムにあるだろうか?</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The ones named above (プリンタハードウェアが壊れたなどの場合に	間違ってジョブが記録される)。</p></li><li class="listitem"><p>実際、CUPSは、物理的にプリンタデバイスから出て行った紙の代わりに	<span class="emphasis"><em>ソフトウェア</em></span>で処理されたジョブのページをカウントする	(すなわち、RIPを使って)。そのため、もしも1000ページ印刷中に五枚目でジャムが	発生し、ジョブがプリンタによって中断した場合、そのジョブに対しては1000ページ	印刷していると引き続き表示される。</p></li><li class="listitem"><p>すべてのquotaはすべてのユーザに対して同じであり(事務員よりも	管理者の方により大きなquotaを割り当てるような自由度がない)、グループの	サポートもない。</p></li><li class="listitem"><p>現在のバランス(current balance??)と、現在のquotaに関する	<span class="quote">“<span class="quote">使い切った</span>”</span>分を読む方法がない。</p></li><li class="listitem"><p>quotaが100で99まで使ったユーザは、まだ1000ページのジョブを	送信し印刷できる。</p></li><li class="listitem"><p>quotaの制限に引っかかっりジョブが拒否されたユーザは、	CUPSから<span class="quote">“<span class="quote">client-error-not-possible</span>”</span>という意味のあるメッセージを	受け取れない。</p></li></ul></div></div><div class="sect2" title="将来の構想"><div class="titlepage"><div><div><h3 class="title"><a name="id2667266"></a>将来の構想</h3></div></div></div><p>これは現在使えるものの中で最も優れたシステムであり、CUPS 1.2にむけて大量の改善が行われている:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ページカウントはバックエンドに移行する(それらはプリンタと	直接通信し、実際の印刷処理に計数が同期する)。そのため、5枚目でジャムが発生した	場合、カウントを中断する)</p></li><li class="listitem"><p>quotaはより自由度が向上する。</p></li><li class="listitem"><p>おそらく前もって、使用しているアカウントについてユーザが	問い合わせる機能をサポートする。</p></li><li class="listitem"><p>おそらく、このトピックの周辺にあるような他のツールのいくつかを	サポートするだろう。</p></li></ul></div></div><div class="sect2" title="他のアカウントツール"><div class="titlepage"><div><div><h3 class="title"><a name="id2667311"></a>他のアカウントツール</h3></div></div></div><p>使用できる他のアカウントツールは以下のものが含まれる:PrintAnalyzer, pyKota, printbill, LogReport。これらのツールについての詳細はググること。</p></div></div><div class="sect1" title="追加の材料"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2667329"></a>追加の材料</h2></div></div></div><p><span class="emphasis"><em>PPDを使わない</em></span>、それに関係する印刷キューは、<span class="quote">“<span class="quote">raw</span>”</span>プリンタで、スプーラが受け取ったすべてのファイルはそのまま直接送られる。例外は、パススルー機能を有効とすることが必要とされる<em class="parameter"><code>application/octet-stream</code></em>ファイルタイプである。<span class="quote">“<span class="quote">raw</span>”</span>キューはフィルタリングを全く行わない。それはCUPSバックエンドに直接送られる。このバックエンドはデバイスにデータを送る事に責任がある(<span class="quote">“<span class="quote">device URI</span>”</span>として、例えば<code class="filename">lpd://, socket://, smb://, ipp://, http://, parallel:/, serial:/, usb:/</code>など)。</p><p>cupsomatic/FoomaticはネイティブなCUPSドライバ<span class="emphasis"><em>ではなく</em></span>、CUPSには同梱されない。これらはLinuxprinting.orgで開発されたサードパーティアドオンである。同様に、すべてのモデルで、CUPS経由でも動くようにさせる、優れたハックであり(伝統的なスプーラで、Ghostscriptドライバ/フィルタによって動作する)、他のスプーラでの品質と(良くも悪くも)同じである。<em class="parameter"><code>cupsomatic</code></em>は、単なる媒体である。すなわち、通常ネイティブなCUPS<em class="parameter"><code>pstoraster</code></em>フィルタが起動される、CUPSフィルタリングチェーン中のそのステージで、Ghostscriptコマンドラインを実行する。<em class="parameter"><code>cupsomatic</code></em>は<em class="parameter"><code>pstoraster</code></em>をバイパスし、CUPSからの印刷ファイルを横取りし、Ghostscriptにリダイレクトする。CUPSは、関連するcupsomatic/foomatic-PPDが以下のように指定するのでこれを許可する:</p><pre class="programlisting">*cupsFilter:  "application/vnd.cups-postscript 0 cupsomatic"</pre><p>この行は、かつてMIMEタイプ<em class="parameter"><code>application/vnd.cups-postscript</code></em>にうまく変換した<em class="parameter"><code>cupsomatic</code></em>に対してファイルを扱わせることをCUPSに指示する。この変換は、その場で、<code class="filename">/etc/cups/mime.types</code>中の変更に一致する、<em class="parameter"><code>application/octet-stream</code></em>に自動タイプされたWindowsから来たジョブに対しては起こらない。</p><p>CUPSは、関連するフィルタリング機能を含め、広範囲に設定が出来、自由度が高い。いくつかの状況に置ける他の問題は、<code class="filename">/etc/cups/mime.types</code>に以下のようなエントリがある場合である:</p><pre class="programlisting">application/postscript           application/vnd.cups-raw  0  -application/vnd.cups-postscript  application/vnd.cups-raw  0  -</pre><p>これは、すべてのPostScriptファイルをフィルタされないようにする(というよりは、<span class="quote">“<span class="quote">-</span>”</span>で指定された仮想の<span class="emphasis"><em>nullfilter</em></span>に渡す)。これは、PostScriptプリンタのみに便利である。もしも、非PostScriptプリンタにPostScriptコードを印刷したい場合(ASCCテキスト印刷のサポートを提供している)、以下のエントリは便利である:</p><pre class="programlisting">*/*           application/vnd.cups-raw  0  -</pre><p>そして、さらなる処理をせずに<span class="emphasis"><em>すべての</em></span>ファイルを効率的にバックエンドに送るだろう。</p><p>以下のエントリを使用しても良い:</p><pre class="programlisting">application/vnd.cups-postscript application/vnd.cups-raw 0 \	my_PJL_stripping_filter</pre><p>PostScriptを解析する(シェルスクリプトであり得る)<em class="parameter"><code>my_PJL_stripping_filter</code></em>を書き、望まないPJLを取り除く必要があるかもしれない。これはCUPSフィルタデザインに従う必要がある(主に、printername,job-id,username, jobtitle, copies, print optionsと可能ならばファイル名パラメータを受け渡す)。これは<code class="filename">/usr/lib/cups/filters/</code>中に誰でも実行できるようにインストールされ、MIMEタイプ<em class="parameter"><code>application/vnd.cups-postscript</code></em>が来た場合には、CUPSによって呼び出される。</p><p>CUPSは<em class="parameter"><code>-o job-hold-until=indefinite</code></em>を扱える。これは、キュー中にジョブを保存しておく。プリンタ操作者によって手動で解放されるときにのみ印刷される。これは、誰も直接アクセスできないいくつかの大きなマシン上で、数百人のユーザのジョブを、少数のオペレータが管理する、多くの集中印刷センタからの要求である(これは、ダイレクトメール発送のためなどに要求される10000ページのジョブを動かす前に、オペレータが適切な紙を設置する必要がしばしばある場合など)。</p></div><div class="sect1" title="CUPSスプールフィルタの自動削除または保存"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2667591"></a>CUPSスプールフィルタの自動削除または保存</h2></div></div></div><p><a class="indexterm" name="id2667601"></a><a class="indexterm" name="id2667608"></a><a class="indexterm" name="id2667615"></a>Sambaは2つのスプールディレクトリ経由で印刷ファイルを渡す。1つはSambaによって管理される入力ディレクトリである(<code class="filename">smb.conf</code>中の<em class="parameter"><code>[printers]</code></em>セクション中の<a class="link" href="smb.conf.5.html#PATH" target="_top">path = /var/spool/samba</a>ディレクティブで設定される)。もう1つは、UNIX印刷システムのスプールディレクトリである。CUPS用には、通常それは<code class="filename">/var/spool/cups/</code>であり、<code class="filename">cupsd.conf</code>中のディレクティブ<code class="filename">RequestRoot /var/spool/cups</code>によって設定される。</p><div class="sect2" title="CUPS構成の設定の説明"><div class="titlepage"><div><div><h3 class="title"><a name="id2667674"></a>CUPS構成の設定の説明</h3></div></div></div><p>CUPS設定ファイル<code class="filename">cupsd.conf</code>中で設定される、いくつかの重要なパラメータは以下の通り:</p><div class="variablelist"><dl><dt><span class="term">PreserveJobHistory Yes</span></dt><dd><p>	これは、cupsdに、いくつかのジョブの詳細を保存させる(すなわち、c12345,c12346の	ように、旧形式であるBSD-LPD制御ファイルのような同等のジョブとして処理し、	CUPSスプールディレクトリ中のファイルに)。既定値は<span class="quote">“<span class="quote">Yes</span>”</span>に	設定される。	</p></dd><dt><span class="term">PreserveJobFiles Yes</span></dt><dd><p>	これは、ジョブファイルそれ自身をcupsdが保存するようにさせる(d12345,d12346	などで、CUPSスプールディレクトリ中にファイルされる)。CUPSの既定値は	<span class="quote">“<span class="quote">No</span>”</span>である。	</p></dd><dt><span class="term"><span class="quote">“<span class="quote">MaxJobs 500</span>”</span></span></dt><dd><p>	このディレクティブは、メモリ中に保持されるジョブの最大数を制御する。この	制限値にジョブが到達すると、新しいもののために、最も古いものが自動的にシステム	からパージされる。もしも既存のすべてのジョブが、引き続きペンディングか	アクティブならば、新しいジョブは拒否される。値を0に設定するとこの機能が無効に	なる。既定値の設定は0である。	</p></dd></dl></div><p>(<em class="parameter"><code>MaxJobsPerUser</code></em>と<em class="parameter"><code>MaxJobsPerPrinter</code></em>という追加の設定もある)。</p></div><div class="sect2" title="準備"><div class="titlepage"><div><div><h3 class="title"><a name="id2667774"></a>準備</h3></div></div></div><p>すべてをきちんと動くようにするために、以下の3つを行う必要がある:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">libcups</code>を指定してSambaのsmbdをコンパイルする	(Linuxでは<strong class="userinput"><code>ldd `which smbd'</code></strong>を動かすことで確認)。</p></li><li class="listitem"><p>Sambaの<code class="filename">smb.conf</code>で<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = cups</a>	を設定する。</p></li><li class="listitem"><p>Sambaの<code class="filename">smb.conf</code>で<a class="link" href="smb.conf.5.html#PRINTCAP" target="_top">printcap = cups</a>	も設定する。</p></li></ul></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>この場合、他の手動で設定する印刷関係のコマンド(<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command</a>, <a class="link" href="smb.conf.5.html#LPQCOMMAND" target="_top">lpq command</a>, <a class="link" href="smb.conf.5.html#LPRMCOMMAND" target="_top">lprm command</a>, <a class="link" href="smb.conf.5.html#LPPAUSECOMMAND" target="_top">lppause command</a>, と<a class="link" href="smb.conf.5.html#LPRESUMECOMMAND" target="_top">lpresume command</a>のようなもの)は無視され、通常印刷に関してはなんの影響も与えなくなる。</p></div></div><div class="sect2" title="手動の設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2667917"></a>手動の設定</h3></div></div></div><p>すべてを手動で行いたいならば、<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = cups</a>を<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = bsd</a>に置き換える。そうすると手動で設定したコマンドが動作し(テストはしていないが)、<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command = lp -d %P %s; rm %s</a>が期待通りの事を行うだろう。</p></div></div><div class="sect1" title="Windowsに接続された印刷へのCUPSからの印刷"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2667967"></a>Windowsに接続された印刷へのCUPSからの印刷</h2></div></div></div><p><a class="indexterm" name="id2667976"></a><a class="indexterm" name="id2667982"></a>時々、Samba<span class="emphasis"><em>から</em></span>Windowsに接続されたプリンタ<span class="emphasis"><em>に</em></span>印刷をするにはどうしたらいいか、という質問が来ることがある。通常Windowsホストからプリンタへのローカル接続はUSBまたはパラレルケーブルで行われるが、これはSambaにとっては重要ではない。ここから、Windowsホストに対してSMB接続でオープンする事のみが必要である。もちろん、プリンタはまず共有されねばならない。今まで学習してきたように、CUPSはプリンタや他のサービスと通信する<span class="emphasis"><em>バックエンド</em></span>を使える。Windowsで共有されたプリンタと通信するには、(驚くべき事だが)<code class="filename">smb</code>バックエンドを使う必要がある。まず<code class="filename">smb</code>ファイルをそこで捜す必要がある。それは<code class="filename">smbspool</code>へのシンボリックリンクであり、ファイルは存在して実行可能でなければならない:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>ls -l /usr/lib/cups/backend/</code></strong>total 253drwxr-xr-x    3 root   root     720 Apr 30 19:04 .drwxr-xr-x    6 root   root     125 Dec 19 17:13 ..-rwxr-xr-x    1 root   root   10692 Feb 16 21:29 canon-rwxr-xr-x    1 root   root   10692 Feb 16 21:29 epsonlrwxrwxrwx    1 root   root       3 Apr 17 22:50 http -> ipp-rwxr-xr-x    1 root   root   17316 Apr 17 22:50 ipp-rwxr-xr-x    1 root   root   15420 Apr 20 17:01 lpd-rwxr-xr-x    1 root   root    8656 Apr 20 17:01 parallel-rwxr-xr-x    1 root   root    2162 Mar 31 23:15 pdfdistillerlrwxrwxrwx    1 root   root      25 Apr 30 19:04 ptal -> /usr/sbin/ptal-cups-rwxr-xr-x    1 root   root    6284 Apr 20 17:01 scsilrwxrwxrwx    1 root   root      17 Apr  2 03:11 smb -> /usr/bin/smbspool-rwxr-xr-x    1 root   root    7912 Apr 20 17:01 socket-rwxr-xr-x    1 root   root    9012 Apr 20 17:01 usb<code class="prompt">root# </code><strong class="userinput"><code>ls -l `which smbspool`</code></strong>-rwxr-xr-x    1 root   root  563245 Dec 28 14:49 /usr/bin/smbspool</pre><p>もしもシンボリックリンクがなければそれを作成する:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>ln -s `which smbspool` /usr/lib/cups/backend/smb</code></strong></pre><p><a class="indexterm" name="id2668114"></a><a class="indexterm" name="id2668121"></a><code class="literal">smbspool</code>は、CUPS関係者のMike Sweetによって書かれた。これは、Sambaに同梱されている。これはまた、CUPS以外の印刷サブシステムで使われ、Windowsプリンタ共有のためにジョブをスプールする。CUPS上で<em class="replaceable"><code>winprinter</code></em>プリンタを設定するためには、そのためのドライバが必要である。本質的に、これは、プリンタが理解できる(Windowsホストは、送ったファイルを形式変換する能力はない)ファイル形式用に、CUPS/Sambaホスト上で、印刷データを変換することを意味する。これはまた、使用しているSamba/CUPSホストに直接繋がっている場合、プリンタに対して印刷出来るべきであると言うことを意味する。トラブルシューティングのために、一連の手続きのその部分が順番になっている場合、これが、何をすべきかを決定すべきかということである。次に、Windowsホストに対する接続/認証を修正することなどを行う。</p><p>バックエンドがCUPSの<em class="parameter"><code>smb</code></em>を使うプリンタをインストールするために、以下のコマンドを使う:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>lpadmin -p winprinter -v smb://WINDOWSNETBIOSNAME/printersharename \  -P /path/to/PPD</code></strong></pre><p><a class="indexterm" name="id2668195"></a><a class="indexterm" name="id2668203"></a><a class="indexterm" name="id2668209"></a>PPDは、そのターゲットモデルのために、印刷データを生成するために、直接CUPSを管理する必要がある。PostScriptプリンタのためには、Windows NT PostScriptドライバを使うPPDを使う。しかし、パスワードがないとプリンタにアクセスできない場合、一体何が出来るだろうか?あるいは、もしもプリンタのホストが他のワークグループのだった場合は?これには以下の方策がある:以下のように、<code class="filename">smb://</code>デバイスURIの一部として、要求されたパラメータを含めることが出来る:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">smb://WORKGROUP/WINDOWSNETBIOSNAME/printersharename</code></p></li><li class="listitem"><p><code class="filename">smb://username:password@WORKGROUP/WINDOWSNETBIOSNAME/printersharename</code></p></li><li class="listitem"><p><code class="filename">smb://username:password@WINDOWSNETBIOSNAME/printersharename</code></p></li></ul></div><p>ログファイルに書かれる前に、ユーザ名とパスワードが削除されたとしても、デバイスURLはSambaサーバ上のプロセス一覧で見えてしまうことに注意(すなわち、誰かが、Linux上で<code class="literal">ps -aux</code>コマンドを使うと)。これは、本質的に脆弱性のあるオプションである。しかし、これが唯一の解である。パスワードを保護したい場合、これを使わないこと。パスワードを要求しないプリンタの共有の方が優れている!印刷は、NetBIOS名前解決が起動し、動作している時にのみ動く。これはCUPSの機能であり、smbdを動かす必要はないことに注意。</p></div><div class="sect1" title="より詳細なCUPSフィルタリングチェーン"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2668299"></a>より詳細なCUPSフィルタリングチェーン</h2></div></div></div><p><a class="link" href="CUPS-printing.html#cups1" title="Figure 22.17. フィルタリングチェーン1">フィルタリングチェーン1</a>と<a class="link" href="CUPS-printing.html#cups2" title="Figure 22.18. cupsomaticを使うフィルタリングチェーン">cupsomaticを使うフィルタリングチェーン</a>中のダイアグラムは、どのようにCUPSが印刷ジョブを扱うかを示している。</p><div class="figure"><a name="cups1"></a><p class="title"><b>Figure 22.17. フィルタリングチェーン1</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/cups1.png" alt="フィルタリングチェーン1"></div></div></div><br class="figure-break"><div class="figure"><a name="cups2"></a><p class="title"><b>Figure 22.18. cupsomaticを使うフィルタリングチェーン</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/cups2.png" width="243" alt="cupsomaticを使うフィルタリングチェーン"></div></div></div><br class="figure-break"></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2668414"></a>よくあるエラー</h2></div></div></div><div class="sect2" title="Windows 9x/Meクライアントがドライバをインストール出来ない"><div class="titlepage"><div><div><h3 class="title"><a name="id2668420"></a>Windows 9x/Meクライアントがドライバをインストール出来ない</h3></div></div></div><p>Windows 9x/Me用クライアント用には、最大8文字までのプリンタ名を必要とする	(あるいは、<span class="quote">“<span class="quote">8文字に3文字の拡張子</span>”</span>)。そうでないと、	Sambaからそれらをダウンロードするときに、ドライバファイルが転送できない。</p></div><div class="sect2" title="“cupsaddsmb”が、無限にrootパスワードを問い合わせてくる"><div class="titlepage"><div><div><h3 class="title"><a name="root-ask-loop"></a><span class="quote">“<span class="quote">cupsaddsmb</span>”</span>が、無限にrootパスワードを問い合わせてくる</h3></div></div></div><p><a class="link" href="smb.conf.5.html#SECURITY" target="_top">security = user</a>を設定したか?	Sambaアカウントのrootとして<code class="literal">smbpasswd</code>を使ったか?	アカウントを作成するために、<code class="literal">smbpasswd -a root</code>を使い、	最初の質問にパスワードを入れる。あるいは、Enterを二回入力することで、	ループを終了する(パスワードを入力しないで)。</p><p>	もしも、エラーが<span class="quote">“<span class="quote">Tree connect failed: NT_STATUS_BAD_NETWORK_NAME</span>”</span>	ならば、<code class="filename">/etc/samba/drivers</code>ディレクトリを作成するのを忘れている。	</p></div><div class="sect2" title="“cupsaddsmb”か“rpcclient addriver”がエラーを出す"><div class="titlepage"><div><div><h3 class="title"><a name="id2668505"></a><span class="quote">“<span class="quote">cupsaddsmb</span>”</span>か<span class="quote">“<span class="quote">rpcclient addriver</span>”</span>がエラーを出す</h3></div></div></div><p>	もしも<code class="literal">cupsaddsmb</code>か<code class="literal">rpcclient addriver</code>が、	WERR_BAD_PASSWORDというエラーメッセージを出す場合は、	<a class="link" href="CUPS-printing.html#root-ask-loop" title="“cupsaddsmb”が、無限にrootパスワードを問い合わせてくる">the previous common error</a>を参照すること。	</p></div><div class="sect2" title="“cupsaddsmb”のエラー"><div class="titlepage"><div><div><h3 class="title"><a name="id2668545"></a><span class="quote">“<span class="quote">cupsaddsmb</span>”</span>のエラー</h3></div></div></div><p>	<span class="quote">“<span class="quote">cupsaddsmb</span>”</span>を使うと、PPDが存在する間、	<span class="quote">“<span class="quote">No PPD file for printer...</span>”</span>というメッセージが出る。	この問題の理由は?	</p><p>	CUPS上でプリンタ共有を有効にしていないだろうか?これは、	<span class="quote">“<span class="quote">cupsaddsmb</span>”</span>が動いているホストからのアクセスを拒否する、	CUPSサーバの<code class="filename">cupsd.conf</code>中に、	<code class="literal"><Location /printers>....</Location></code>	があるということである。cupsaddsmbをリモートで使っているか、	<code class="option">-h</code>パラメータを付けて:	<strong class="userinput"><code>cupsaddsmb -H sambaserver -h cupsserver -v printername</code></strong>	として使っている場合、これは<span class="emphasis"><em>問題となりえる</em></span>。	</p><p><code class="filename">cupsd.conf</code>中の<em class="parameter"><code>TempDir</code></em>	ディレクティブが正しい値に設定されているだろうか?またそれは書き込み可能だろうか?	</p></div><div class="sect2" title="クライアントがSambaプリンタに接続できない"><div class="titlepage"><div><div><h3 class="title"><a name="id2668626"></a>クライアントがSambaプリンタに接続できない</h3></div></div></div><p>Sambaの観点からどのユーザであるかを、<code class="literal">smbstatus</code>を	使って調べる。<em class="parameter"><code>[print$]</code></em>共有に対して書き込み許可が	あるだろうか?</p></div><div class="sect2" title="Windows 200x/Xpからの新しいアカウント再接続のトラブル"><div class="titlepage"><div><div><h3 class="title"><a name="id2668652"></a>Windows 200x/Xpからの新しいアカウント再接続のトラブル</h3></div></div></div><p>ひとたび間違ったユーザ(たとえば、<a class="link" href="smb.conf.5.html#MAPTOGUEST" target="_top">map to guest = bad user</a>を設定した場合、しばしば発生する<code class="constant">nobody</code>など)で接続すると、Windowsエクスプローラは異なったユーザで再度接続する試みを受け付けない。Sambaに対しては全くデータ転送が出来ないが、Sambaがアクセスを拒否したと考えられる不可解なメッセージが表示され続ける。有効な接続の状態を<code class="literal">smbstatus</code>で確認すること。そして、当該のプロセス(PID)をKillする。まだ再接続は出来なく、接続しようとすると、<code class="computeroutput">You can't connect with a second account from the same machine</code>というメッセージがすぐに出る。再説俗を試みても、、まだ1バイトもSambaには届かない(ログを見ること。<span class="quote">“<span class="quote">ethereal</span>”</span>を使う)。Windows上のすべてのエクスプローラを閉じる。 これは確立した接続としてメモリ中にキャッシュされたものを、Windowsに捨てさせる。次に正しいユーザで接続する。一番良い方法は、DOSターミナルウィンドウを使い、<span class="emphasis"><em>最初に</em></span><strong class="userinput"><code>net use z: \\GANDALF\print$ /user:root</code></strong>を行う。異なったアカウントで接続されたと言うことを、<code class="literal">smbstatus</code>で確認する。この後、<span class="guilabel">プリンタ</span>フォルダを開き(Sambaサーバ上の<span class="guilabel">ネットワークコンピュータ</span>で)、質問中のプリンタ上で右クリックし、<span class="guibutton">接続....</span>を選択する。</p></div><div class="sect2" title="間違ったユーザでSambaサーバに接続されるのを防ぐ"><div class="titlepage"><div><div><h3 class="title"><a name="id2668764"></a>間違ったユーザでSambaサーバに接続されるのを防ぐ</h3></div></div></div><p><a class="indexterm" name="id2668773"></a>nobodyとして接続されていることを<code class="literal">smbstatus</code> で確認するが、本当はrootかprinter adminにしたい。これは、おそらく、正しくないユーザ名(たぶん何らかのミス)を指定した時に、黙ってguest accountとする、<a class="link" href="smb.conf.5.html#MAPTOGUEST" target="_top">map to guest = bad user</a>のせいであろう。これを防ぐためには、<a class="link" href="smb.conf.5.html#MAPTOGUEST" target="_top">map to guest</a>を取り除く。</p></div><div class="sect2" title="AdobeドライバからCUPSドライバにアップグレードする"><div class="titlepage"><div><div><h3 class="title"><a name="id2668821"></a>AdobeドライバからCUPSドライバにアップグレードする</h3></div></div></div><p>この情報は、Microsoft Windows NT/200x/XPクライアント上で、AdobeドライバからCUPSドライバにアップグレードした時、それに関連した問題の体験を、メーリングリスト上に投稿されたものによっている。</p><p>最初に、すべての古い、Adobeが使っているプリンタを削除する。次に、すべとの古いAdobeドライバを削除する(Windows 200x/XP上では、<span class="guilabel">プリンタ</span>フォルダの背景部分で右クリックし、<span class="guimenuitem">Server Properties...</span>を選択し、<span class="guilabel">ドライバ</span>タブを選択し、ここで削除する)。</p></div><div class="sect2" title="PDCであるSambaサーバ上で“cupsaddsmb”が使えない"><div class="titlepage"><div><div><h3 class="title"><a name="id2668868"></a>PDCであるSambaサーバ上で<span class="quote">“<span class="quote">cupsaddsmb</span>”</span>が使えない</h3></div></div></div><p><span class="quote">“<span class="quote">そのままの</span>”</span>rootユーザ名を使っていないか?以下の方法を試してみよう:<strong class="userinput"><code>cupsaddsmb -U <em class="replaceable"><code>DOMAINNAME</code></em>\\root -v <em class="replaceable"><code>printername</code></em></code></strong>>(2つのバックスラッシュ:最初のものは二番目のものを<span class="quote">“<span class="quote">エスケープ</span>”</span>する事に注意)。</p></div><div class="sect2" title="削除されたWindows 200xプリンタドライバが引き続き表示されている"><div class="titlepage"><div><div><h3 class="title"><a name="id2668907"></a>削除されたWindows 200xプリンタドライバが引き続き表示されている</h3></div></div></div><p>クライアント上のプリンタの削除は、ドライバも一緒に削除はしない(それを確かめるために、<span class="guilabel">プリンタ</span>フォルダの白い背景部分で右クリックし、<span class="guimenuitem">サーバーのプロパティ</span>を選択し、<span class="guilabel">ドライバ</span>タブをクリックする)。これら同じ古いドライバは、同じ名前でプリンタをインストールする時に再度使われる。もしも、新しいドライバにアップデートしたい場合は、古いものを最初に削除する。削除は、同じドライバを使う他のプリンタが無い場合にのみ可能である。</p></div><div class="sect2" title="Windows 200x/XP ローカルセキュリティポリシー"><div class="titlepage"><div><div><h3 class="title"><a name="id2668952"></a>Windows 200x/XP ローカルセキュリティポリシー</h3></div></div></div><a class="indexterm" name="id2668960"></a><a class="indexterm" name="id2668967"></a><p>ローカルセキュリティポリシーは、未署名のドライバのインストールを許可しないようにもできる。<span class="quote">“<span class="quote">ローカルセキュリティポリシー</span>”</span>は全くプリンタドライバのインストールを許可しないようにしてもよい。</p></div><div class="sect2" title="Administratorはすべてのローカルユーザに対してプリンタをインストールできない"><div class="titlepage"><div><div><h3 class="title"><a name="id2668990"></a>Administratorはすべてのローカルユーザに対してプリンタをインストールできない</h3></div></div></div><p><a class="indexterm" name="id2669001"></a><a class="indexterm" name="id2669008"></a>Windows XPは<span class="quote">“<span class="quote">ユーザ単位に</span>”</span>SMBプリンタを扱うことが出来る。これは、すべてのユーザは自分自身でプリンタをインストールする必要があることを意味する。すべてのユーザに対してプリンタを有効にするためには、Windows XPにおける内蔵IPPクライアントの機能を使う事になるかもしれない。<em class="parameter"><code>http://cupsserver:631/printers/printername</code></em>という印刷パスでプリンタを追加する。これについては引き続き調査中である。おそらく、すべてのユーザに対して自動的にプリンタのインストールが出来るログオンスクリプトかもしれない。</p></div><div class="sect2" title="NTクライアント上での印刷の変更、機能の通知"><div class="titlepage"><div><div><h3 class="title"><a name="id2669042"></a>NTクライアント上での印刷の変更、機能の通知</h3></div></div></div><p>印刷の変更のために、NT++クライアント上でその機能に通知する。これらは最初に<code class="literal">サーバ</code>サービスを動かす必要がある(XP中では<code class="literal">File & Print Sharing for MS Networks</code>に名前が変わっている)。</p></div><div class="sect2" title="Windows XP SP1"><div class="titlepage"><div><div><h3 class="title"><a name="id2669071"></a>Windows XP SP1</h3></div></div></div><p>Windows XP SP1では、ポイントアンドプリントの制限ポリシーが導入された(この制限は、<span class="quote">“<span class="quote">Administrator</span>”</span>か<span class="quote">“<span class="quote">Power User</span>”</span>グループのユーザには適用されない)。グループポリシーオブジェクトエディタ中で、<span class="guimenu">ユーザの設定 -> 管理テンプレート -> コントロールパネル -> プリンタ</span>に行く。ポリシーは自動的に<code class="constant">有効</code>に設定され、<code class="constant">ユーザはそのフォレスト中のマシンに対してのみポイントアンドプリント</code>が使える。おそらく、<code class="constant">無効</code>か、ドライバのダウンロードをSambaから出来るように、<code class="constant">ユーザはそれらのサーバに対してのみポイントアンドプリントが使える</code>それを変更する必要がある。</p></div><div class="sect2" title="Windows 200x/XP上ですべてのユーザが印刷オプションを設定出来ない"><div class="titlepage"><div><div><h3 class="title"><a name="id2669124"></a>Windows 200x/XP上ですべてのユーザが印刷オプションを設定出来ない</h3></div></div></div><p>何をしているのだろうか?間違っているに違いない(しかし、これを発見するのは容易ではない)。すべてを設定する<span class="emphasis"><em>ように見える</em></span>ダイアログを表示するための、3つの異なった方法がある。それら3つのダイアログは、同じように<span class="emphasis"><em>見える</em></span>が、そのうちの1つのみが意図しているものである。これをすべてのユーザに対して行うために、AdministratorかPrint Administratorである必要がある。XP上でどのようにやるかは以下の通り:</p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>最初の間違った方法:		</p><div class="orderedlist"><ol class="orderedlist" type="I"><li class="listitem"><p><span class="guilabel">Printers</span>フォルダを開く。		</p></li><li class="listitem"><p>プリンタ(<span class="guilabel">cupshost上のremoteprinter</span>)		を右クリックし、コンテキストメニュー		<span class="guimenuitem">印刷のプリファレンス</span>を選択する。</p></li><li class="listitem"><p>細かくこのダイアログを見、なりが見えるかを覚えておく。</p></li></ol></div><p>	</p></li><li class="listitem"><p>二番目の間違った方法:	</p><div class="orderedlist"><ol class="orderedlist" type="I"><li class="listitem"><p><span class="guilabel">プリンタ</span>フォルダを開く</p></li><li class="listitem"><p>プリンタ(<span class="guilabel">cupshost上のremoteprinter</span>)		を右クリックし、コンテキストメニュー<span class="guimenuitem">プロパティ</span>		を選択する。</p></li><li class="listitem"><p><span class="guilabel">全般</span>タブをクリックする。</p></li><li class="listitem"><p><span class="guibutton">印刷のプリファレンス</span>ボタンを		クリックする。</p></li><li class="listitem"><p>新しいダイアログが開く。このダイアログを開いたままにし、		親のダイアログに戻る。</p></li></ol></div><p>	</p></li><li class="listitem"><p>三番目の正しい方法: 	</p><div class="orderedlist"><ol class="orderedlist" type="I"><li class="listitem"><p><span class="guilabel">プリンタ</span>フォルダを開く。</p></li><li class="listitem"><p>プリンタ(<span class="guilabel">cupshost上のremoteprinter</span>)		を右クリックし、コンテキストメニュー<span class="guimenuitem">プロパティ</span>                を選択する。</p></li><li class="listitem"><p><span class="guilabel">詳細</span>タブをクリックする		(もしもすべてが<span class="quote">“<span class="quote">灰色になっていて入力できないならば</span>”</span>、		十分な権限を持つユーザとしてログインしていない)。</p></li><li class="listitem"><p><span class="guibutton">プリンタの既定値</span>ボタンを		クリックする</p></li><li class="listitem"><p>2つの新しいタブのどちらかで、		<span class="guibutton">詳細</span>ボタンをクリックする。</p></li><li class="listitem"><p>新しいダイアログが開く。これを、		<span class="quote">“<span class="quote">B.5</span>”</span> または "A.3"で同様のものと比べてみる。</p></li></ol></div><p>	</p></li></ol></div><p>違いがわかるだろうか?私にはわからない。しかし、<span class="quote">“<span class="quote">C.1. から C.6.</span>”</span>の手順で到達した最後のもののみ、任意の設定を恒久的に保存し、新しいユーザの既定値となる。もしも、すべてのユーザに同じ既定値を設定したいならば、これらのステップを<span class="emphasis"><em>as Administrator</em></span>(<code class="filename">smb.conf</code>中で<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>であるもの)で、クライアントが、(クライアントが、以下の手順<span class="emphasis"><em>A</em></span>または<span class="emphasis"><em>B</em></span>)によって、各固有の、<span class="emphasis"><em>ユーザ単位の既定値</em></span>を設定出来る)ドライバをダウンロードする<span class="emphasis"><em>前に</em></span>行う必要がある。</p></div><div class="sect2" title="Windowsクライアント上でのドライバ設定における、多くに共通する失敗"><div class="titlepage"><div><div><h3 class="title"><a name="id2669430"></a>Windowsクライアント上でのドライバ設定における、多くに共通する失敗</h3></div></div></div><p><em class="parameter"><code>Optimize for Speed</code></em>を使わずに、代わりに、<em class="parameter"><code>Optimize for Portability</code></em>を使う(Adobe PSドライバの場合)。<em class="parameter"><code>Page Independence: No</code></em>を使わない。常時、<em class="parameter"><code>Page Independence: Yes</code></em>を使う(Windows NT/200x/XP用の、Microsoft PDドライバとCUPS PSドライバ)。もしもフォントに問題がある場合には、<em class="parameter"><code>Download as Softfont into printer</code></em>を使う(Adobe PSドライバの場合)。<span class="guilabel">TrueType Download Options</span>オプション用に、<code class="constant">Outline</code>を選択する。もしも、非PSプリンタでトラブルがあるか、選択できる場合はPostScript Level 2を使う。</p></div><div class="sect2" title="cupsaddsmbが、新しくインストールしたプリンタで動かない"><div class="titlepage"><div><div><h3 class="title"><a name="id2669491"></a><code class="literal">cupsaddsmb</code>が、新しくインストールしたプリンタで動かない</h3></div></div></div><p>以下と同様: <code class="literal">cupsaddsmb</code>の最後のコマンドが完全に終わっていない。もしも、<code class="literal">cmd = setdriver printername printername</code>の結果がNT_STATUS_UNSUCCESSFULの場合、おそらくプリンタがまだSambaによって認識されていない。ネットワークコンピュータ中に表示されているだろうか? <code class="literal">rpcclient hostname -c `enumprinters'</code>で表示されるだろうか?smbdを再起動(か、<code class="literal">smbstatus</code>で一覧表示されるすべてのプロセスに対して<code class="literal">kill -HUP</code>を行う)し、再度試してみる。</p></div><div class="sect2" title="/var/spool/samba/のアクセス許可が、再起動後毎回リセットされる"><div class="titlepage"><div><div><h3 class="title"><a name="id2669543"></a><code class="filename">/var/spool/samba/</code>のアクセス許可が、再起動後毎回リセットされる</h3></div></div></div><p>同じ位置へのCUPSスプールディレクトリの設定で、以前に何か問題が起きなかったか?(<code class="filename">cupsd.conf</code>中の<em class="parameter"><code>RequestRoot /var/spool/samba/</code></em>か、その逆:<em class="parameter"><code>[printers]</code></em>セクション中で、<code class="filename">/var/spool/cups/</code>を<a class="link" href="smb.conf.5.html#PATH" target="_top">path</a>>として設定しているか)?これらは<em class="parameter"><code>異なってなければならない</code></em>。<code class="filename">cupsd.conf</code>中の<em class="parameter"><code>RequestRoot /var/spool/cups/</code></em>と<code class="filename">smb.conf</code>の<em class="parameter"><code>[printers]</code></em>セクション中の<a class="link" href="smb.conf.5.html#PATH" target="_top">path =  /var/spool/samba</a>を設定する。それ以外は、cupsdは再起動後毎回そのスプールディレクトリのアクセス許可を整理するので、印刷は確実にうまくいかない。</p></div><div class="sect2" title="“lp”という名前の印刷キューが印刷ジョブを間違って扱ってしまう"><div class="titlepage"><div><div><h3 class="title"><a name="id2669647"></a><span class="quote">“<span class="quote">lp</span>”</span>という名前の印刷キューが印刷ジョブを間違って扱ってしまう</h3></div></div></div><p>この場合、<span class="quote">“<span class="quote">lp</span>”</span>という名前の印刷キューが、間欠的にジョブを取りこぼし、送られたものとは完全に違うものを出力する。</p><p><a class="indexterm" name="id2669668"></a><a class="indexterm" name="id2669674"></a><a class="indexterm" name="id2669681"></a>プリンタに対して<span class="quote">“<span class="quote">lp</span>”</span>という名前を付けるのは好ましくない。これは、伝統的なUNIXにおける既定値のプリンタである。CUPSは暗黙のクラスを自動的に作成する事を行うように設定されているかもしれない。これは、デバイスをプールするために同じ名前のすべてのプリンタをグループ化するためと、ラウンドロビン方式でジョブのロードバランスを取るということである。誰かが<span class="quote">“<span class="quote">lp</span>”</span>という名前のプリンタを持っている場合にもこれがあり得る。その人のジョブを受け取り、無意識にその人のデバイスに自分のジョブを送っているかもしれない。プリンタ名に対して厳密の制御をするためには、巨大なネットワーク環境において起こるかもしれない事に対する、より良い制御を行う、<em class="parameter"><code>BrowseShortNames No</code></em>を設定する。</p></div><div class="sect2" title="“cupsaddsmb”に対するAdobe PostScriptドライバファイルの位置"><div class="titlepage"><div><div><h3 class="title"><a name="id2669733"></a><span class="quote">“<span class="quote">cupsaddsmb</span>”</span>に対するAdobe PostScriptドライバファイルの位置</h3></div></div></div><p>共有されたPostScriptプリンタを持つWindowsマシンに繋ぐために、<code class="literal">smbclient</code>を、<code class="literal">smbclient //windowsbox/print\$ -U guest</code>のように使う。<code class="filename">W32X86/2</code>サブディレクトリに移動でき、<code class="literal">mget ADOBE*</code>し、あるいは<code class="filename">WIN40/0</code>で、同じ事をやる。他のオプションは、Adobe Webサイトから<code class="filename">*.exe</code>をダウンロードする。</p></div></div><div class="sect1" title="CUPS印刷プロセスの概要"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2669789"></a>CUPS印刷プロセスの概要</h2></div></div></div><p>CUPS印刷プロセスの完全な概要は、<a class="link" href="CUPS-printing.html#a_small" title="Figure 22.19. CUPS印刷のダイアグラム概要">CUPS印刷のダイアグラム概要</a>にある。</p><div class="figure"><a name="a_small"></a><p class="title"><b>Figure 22.19. CUPS印刷のダイアグラム概要</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/a_small.png" width="243" alt="CUPS印刷のダイアグラム概要"></div></div></div><br class="figure-break"></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.id2657339" href="#id2657339" class="para">6</a>] </sup>	<a class="ulink" href="http://www.cups.org/cups-help.html" target="_top">http://www.cups.org/cups-help.html</a></p>を参照。</div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="classicalprinting.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="VFS.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 21. 旧式の印刷サポート </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 23. スタッカブルVFSモジュール</td></tr></table></div></body></html>