<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 38. Sambaチェックリスト</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="troubleshooting.html" title="Part V. トラブルシューティング"><link rel="prev" href="troubleshooting.html" title="Part V. トラブルシューティング"><link rel="next" href="problems.html" title="Chapter 39. Sambaの問題の調査と解決方法"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 38. Sambaチェックリスト</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="troubleshooting.html">Prev</a> </td><th width="60%" align="center">Part V. トラブルシューティング</th><td width="20%" align="right"> <a accesskey="n" href="problems.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 38. Sambaチェックリスト"><div class="titlepage"><div><div><h2 class="title"><a name="diagnosis"></a>Chapter 38. Sambaチェックリスト</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Andrew</span> <span class="surname">Tridgell</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:tridge@samba.org">tridge@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Dan</span> <span class="surname">Shearer</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:dan@samba.org">dan@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">Wed Jan 15</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="diagnosis.html#id2707153">概要</a></span></dt><dt><span class="sect1"><a href="diagnosis.html#id2707204">前提条件</a></span></dt><dt><span class="sect1"><a href="diagnosis.html#id2707525">テスト</a></span></dt></dl></div><div class="sect1" title="概要"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2707153"></a>概要</h2></div></div></div><p><a class="indexterm" name="id2707161"></a>この章には、Sambaサーバの検証が行えるテストの一覧が含まれている。また、それらの手順のどこかで失敗した問題を起こす可能性の高いものが何かと言うことについても説明している。もしも、すべてのテストをパスしたら、おそらく正しく動いているだろう。</p><p>すべてのテストを示された順で行うべきである。後のテストが、前のテストで確認された機能のみを使うように、テストを注意深く選ぶようにしてある。しかし、最初のエラーで止まってはならない:テストの継続が、問題の解決を手助けするという事例があったからである。</p><p>もしも、<span class="quote">“<span class="quote">It does not work,</span>”</span>というタイトルでメールをSambaメーリングリストのどこかに送り、このテスト手順に従わないならば、メールが無視されても驚いてはいけない。</p></div><div class="sect1" title="前提条件"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2707204"></a>前提条件</h2></div></div></div><p>すべてのテストにおいて、SambaサーバはBIGSERVERで、PCクライアントがACLIENTで、両者ともTESTGROUPというワークグループに属していることを仮定する。</p><p>手続きは、他のクライアントのタイプと同様である。</p><p><code class="filename">smb.conf</code>中の有効な共有名も分かっているものとする。ここでの例における共有の名前は<em class="parameter"><code>tmp</code></em>である。これは、<a class="link" href="diagnosis.html#tmpshare" title="Example 38.1. [tmp]共有のためのsmb.conf">次の例</a>で示される行を追加することで、このような<em class="parameter"><code>tmp</code></em>共有を追加できる。</p><div class="example"><a name="tmpshare"></a><p class="title"><b>Example 38.1. [tmp]共有のためのsmb.conf</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[tmp]</code></em></td></tr><tr><td><a class="indexterm" name="id2707284"></a><em class="parameter"><code>comment = temporary files </code></em></td></tr><tr><td><a class="indexterm" name="id2707295"></a><em class="parameter"><code>path = /tmp</code></em></td></tr><tr><td><a class="indexterm" name="id2707307"></a><em class="parameter"><code>read only = yes</code></em></td></tr></table></div></div><br class="example-break"><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>これらのテストはバージョン3.0.0以降のSambaシステムを仮定する。以前のバージョンではいくつかのコマンドは存在しない。</p></div><p><a class="indexterm" name="id2707332"></a><a class="indexterm" name="id2707339"></a><a class="indexterm" name="id2707346"></a>受け取ったエラーメッセージに注意をはらってほしい。もしもエラーメッセージが、使用しているサーバが調子が悪いという事を報告しているのであれば、まず初めに使用しているIPを名前解決する方式が正しく設定されているかどうかをチェックすべきである。実際に存在しているネームサーバを、<code class="filename">/etc/resolv.conf</code>が正しく指し示しているようにすること。</p><p><a class="indexterm" name="id2707373"></a><a class="indexterm" name="id2707380"></a><a class="indexterm" name="id2707387"></a><a class="indexterm" name="id2707395"></a>また、もしも、名前解決用のDNSサーバアクセスが出来ないならば、<code class="filename">smb.conf</code>に<em class="parameter"><code>dns proxy = no</code></em>が設定されているかをチェックする。これをチェックする最も良い方法は、<code class="literal">testparm smb.conf</code>である。</p><p><a class="indexterm" name="id2707428"></a><a class="indexterm" name="id2707435"></a><a class="indexterm" name="id2707442"></a><a class="indexterm" name="id2707449"></a><a class="indexterm" name="id2707456"></a>別のターミナルコンソール(X中で複数のターミナルを使うには、ctrl-alt-F1からF6を使用)で、<code class="literal">tail -F log_file_name</code>を使うことで、テストの間ログファイルをモニタするのは便利である。適切なログファイルは(既定値によるインストールでは)、<code class="filename">/usr/local/samba/var</code>にある。また、マシンからの接続ログは、ここか、<code class="filename">/var/log/samba</code>か、あるいは<code class="filename">smb.conf</code>ファイル中でロギングを指定した場合には、それに依存する場所にある。</p><p>もしも、それらのテスト中に<code class="filename">smb.conf</code>ファイルを変更したならば、<span class="application">smbd</span>と<span class="application">nmbd</span>の再起動を忘れないこと。</p></div><div class="sect1" title="テスト"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2707525"></a>テスト</h2></div></div></div><div class="procedure" title="Procedure 38.1. 使用しているSambaサーバの診断"><a name="id2707531"></a><p class="title"><b>Procedure 38.1. 使用しているSambaサーバの診断</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p><a class="indexterm" name="id2707544"></a><code class="filename">smb.conf</code>ファイルを格納しているディレクトリ中で、<code class="literal">testparm smb.conf</code>を実行する。もしも何らかのエラーが発生した場合、その<code class="filename">smb.conf</code>の設定には間違いがある。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2707576"></a><a class="indexterm" name="id2707582"></a>使用している<code class="filename">smb.conf</code>ファイルは、<code class="filename">/etc/samba</code>か<code class="filename">/usr/local/samba/lib</code>にあってもよい。</p></div></li><li class="step" title="Step 2"><p><a class="indexterm" name="id2707618"></a>PCから<code class="literal">ping BIGSERVER</code>コマンドを動かし、UNIXマシンから<code class="literal">ping ACLIENT</code>を動かす。正常な応答がない場合、TCP/IP層の設定がうまくいっていない。</p><p>PC上でpingを動かす場合には、<span class="quote">“<span class="quote">DOS プロンプト</span>”</span>を起動する必要がある。</p><p><a class="indexterm" name="id2707652"></a><a class="indexterm" name="id2707659"></a><a class="indexterm" name="id2707665"></a>もしも、<span class="quote">“<span class="quote"><span class="errorname">host not found</span></span>”</span>か同様なメッセージが表示されたならば、DNSソフトウェアか<code class="filename">/etc/hosts</code>ファイルが正しく設定されていない。もしもDNSを使っている場合、<code class="filename">/etc/resolv.conf</code>に、正しい、最新のエントリがあるかどうかをチェックする。DNSエントリなしにSambaをサーバとクライアントとして動作させることは可能であるが、この後のテストでは、正しいエントリがあると仮定している。</p><p><a class="indexterm" name="id2707700"></a><a class="indexterm" name="id2707707"></a><a class="indexterm" name="id2707714"></a>pingが失敗するかもしれない他の理由としては、使用しているホスト上でファイアウォールソフトウェアが動作している場合である。ワークステーションからの問い合わせに対してルールをゆるめる必要がありえ、それはおそらく、他のサブネットからのアクセスを許可することであろう(Linux上では、これは、<code class="literal">ipchains</code>か<code class="literal">iptables</code>という、適切なファイアウォール管理コマンドによって行える)。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>最新のUNIXディストリビューションでは、既定値でipchains/iptablesをインストールしている。これは、しばしばよく見落とされる問題である。</p></div><p><a class="indexterm" name="id2707760"></a><a class="indexterm" name="id2707767"></a>もしも、テスト中にシステム中どのようなファイアウォールルールが存在しているかを調べたい場合、単純に<code class="literal">iptables -L -v</code>か、あるいは<em class="parameter"><code>ipchains</code></em>ベースのファイアウォールを使っている場合には、<code class="literal">ipchains -L -v</code>を入力する。</p><p>以下は、Sambaが有効になっていない外部向けのイーサネットインタフェース(eth1)とSambaが有効になっている内部向けの(プライベートネットワーク)インタフェース(eth0)を持つ、システムからの結果例である。</p><pre class="screen">frodo:~ # iptables -L -vChain INPUT (policy DROP 98496 packets, 12M bytes) pkts bytes target     prot opt in     out     source     destination 187K  109M ACCEPT     all  --  lo     any     anywhere   anywhere 892K  125M ACCEPT     all  --  eth0   any     anywhere   anywhere1399K 1380M ACCEPT     all  --  eth1   any     anywhere   anywhere  \					state RELATED,ESTABLISHEDChain FORWARD (policy DROP 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source     destination 978K 1177M ACCEPT     all  --  eth1   eth0    anywhere   anywhere \					state RELATED,ESTABLISHED 658K   40M ACCEPT     all  --  eth0   eth1    anywhere   anywhere    0     0 LOG        all  --  any    any     anywhere   anywhere \					LOG level warningChain OUTPUT (policy ACCEPT 2875K packets, 1508M bytes) pkts bytes target     prot opt in     out     source     destinationChain reject_func (0 references) pkts bytes target     prot opt in     out     source     destination</pre><p></p></li><li class="step" title="Step 3"><p>UNIXマシン上で<code class="literal">smbclient -L BIGSERVER</code>を動かす。これで有効な共有の一覧が得られる。</p><p><a class="indexterm" name="id2707854"></a><a class="indexterm" name="id2707861"></a><a class="indexterm" name="id2707867"></a><a class="indexterm" name="id2707874"></a><a class="indexterm" name="id2707881"></a><a class="indexterm" name="id2707888"></a>もしも<span class="quote">“<span class="quote">bad password</span>”</span>という文字列があるエラーメッセージが表示されたら、不正な<em class="parameter"><code>hosts allow</code></em>、<em class="parameter"><code>hosts deny</code></em>か<em class="parameter"><code>valid users</code></em>行が<code class="filename">smb.conf</code>にあるか、ゲストアカウントが無効になっている。<span class="application">testparm</span>でゲストアカウントが何かを調べ、一時的に<em class="parameter"><code>hosts allow</code></em>, <em class="parameter"><code>hosts deny</code></em>,<em class="parameter"><code>valid users</code></em>, か<em class="parameter"><code>invalid users</code></em>行を削除してみる。</p><p><a class="indexterm" name="id2707960"></a>もしも、<code class="literal">connection refused</code>というメッセージが帰ってきたら、<code class="literal">smbd</code>サーバが動いていないかもしれない。もしも<code class="filename">inetd.conf</code>経由で動作するようにしていたら、おそらくこのファイルの編集が間違っている。もしもdaemonとして動作するようにしていたら、動作しているかを調べ、<code class="literal">netstat -a</code>を使ってnetbios-ssnポートがLISTEN中かを確認する。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2708001"></a><a class="indexterm" name="id2708008"></a>ある種のUNIX/Linuxシステムでは、<code class="literal">inetd</code>の代わりに<code class="literal">xinetd</code>を使っている。ネットワークスーパーデーモンの、特定のシステム実装についての、制御ファイルの位置の説明文書を調べること。</p></div><p>もしも、<code class="literal">session request failed</code>というメッセージが表示されたならば、サーバは接続を拒否している。もしも<span class="quote">“<span class="quote">Your server software is being unfriendly</span>”</span>というメッセージが表示されたならば、それはおそらく<span class="application">smbd</span>に対するコマンドラインオプションを間違えているか、<span class="application">smbd</span>の初期起動時に同様の致命的な問題がある。<span class="application">testparm</span>で設定ファイル(<code class="filename">smb.conf</code>)の文法と、ログとロックファイルを保持する種々のディレクトリもチェックする。</p><p>セッション要求を拒否するか、断るかもしれない数多くの理由がある。それらは、<a class="link" href="diagnosis.html#modif1" title="Example 38.2. 特定のサブネットからのみ接続を受け付ける設定例">次の例</a>で示されている<code class="filename">smb.conf</code>ファイルのエントリによって発生する。</p><div class="example"><a name="modif1"></a><p class="title"><b>Example 38.2. 特定のサブネットからのみ接続を受け付ける設定例</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[globals]</code></em></td></tr><tr><td><a class="indexterm" name="id2708130"></a><em class="parameter"><code>hosts deny = ALL</code></em></td></tr><tr><td><a class="indexterm" name="id2708142"></a><em class="parameter"><code>hosts allow = xxx.xxx.xxx.xxx/yy</code></em></td></tr><tr><td><a class="indexterm" name="id2708154"></a><em class="parameter"><code>interfaces = eth0</code></em></td></tr><tr><td><a class="indexterm" name="id2708165"></a><em class="parameter"><code>bind interfaces only = Yes</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2708180"></a><a class="link" href="diagnosis.html#modif1" title="Example 38.2. 特定のサブネットからのみ接続を受け付ける設定例">特定のサブネットからのみ接続を受け付ける設定例</a>では、ループバックアダプタアドレス 127.0.0.1へ自動的に変換される任意のセッション要求は許可されない。この問題を解決するためには、<a class="link" href="diagnosis.html#modif2" title="Example 38.3. 特定のサブネットとローカルホストから接続を許可する例">以下の例</a>で示されているような行に変更する。</p><div class="example"><a name="modif2"></a><p class="title"><b>Example 38.3. 特定のサブネットとローカルホストから接続を許可する例</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[globals]</code></em></td></tr><tr><td><a class="indexterm" name="id2708234"></a><em class="parameter"><code>hosts deny = ALL</code></em></td></tr><tr><td><a class="indexterm" name="id2708245"></a><em class="parameter"><code>hosts allow = xxx.xxx.xxx.xxx/yy 127.</code></em></td></tr><tr><td><a class="indexterm" name="id2708257"></a><em class="parameter"><code>interfaces = eth0 lo</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2708272"></a><a class="indexterm" name="id2708279"></a>他の、よくある2つのエラーの例は、Samba(すでに<span class="application">inetd</span>経由で<span class="application">smbd</span>が動いている)か、DECのPathworksのような、ポート<code class="constant">139</code>上で何かがすでに動いているものである。デーモンで<span class="application">smbd</span>を動かす前に<code class="filename">inetd.conf</code>ファイルをチェックすること。そうすれば多くのトラブルを防げる!</p><p><a class="indexterm" name="id2708326"></a><a class="indexterm" name="id2708332"></a><a class="indexterm" name="id2708340"></a><a class="indexterm" name="id2708346"></a><a class="indexterm" name="id2708354"></a>さらに、このテストが失敗する、他のあり得そうな例としては、サブネットマスクかブロードキャストアドレスの設定が不正な場合である。ネットワークインタフェースのIPアドレス、ブロードキャスト、サブネットマスクが正しいかと、それらが<code class="filename">log.nmbd</code>ファイル中に正しくSambaが記録しているかを確認すること。</p></li><li class="step" title="Step 4"><p><a class="indexterm" name="id2708387"></a><code class="literal">nmblookup -B BIGSERVER __SAMBA__</code>コマンドを動かす。使用しているSambaサーバのIPアドレスが表示されるはずである。</p><p><a class="indexterm" name="id2708405"></a><a class="indexterm" name="id2708412"></a><a class="indexterm" name="id2708419"></a>そうでない場合、<span class="application">nmbd</span>が駄々しくインストールされていない。<code class="filename">inetd.conf</code>経由で動かしている場合はそこを、あるいはデーモンが動いていてUDPポート137をリッスンしているかどうかをチェックする。</p><p>ある1つのよくある問題は、多くのinetdの実装が、コマンドライン上に多数のパラメータを使えないというものである。もしもこの場合、正しいパラメータを含む1行のみのスクリプトを作成し、それをinetdから起動する。</p></li><li class="step" title="Step 5"><p><a class="indexterm" name="id2708467"></a><code class="literal">nmblookup -B ACLIENT `*'</code>を起動する。</p><p>PCのIPアドレスが表示されるはずである。もしもそうでなければ、PC上のクライアントソフトウェアの設定が間違っているか、開始していないか、PCの名前が間違っているかである。</p><p>もしもACLIENTがDNS経由で名前解決できない場合、上記のテストで、クライアントのIPアドレスを使用してみる。</p></li><li class="step" title="Step 6"><p><code class="literal">nmblookup -d 2 `*'</code>コマンドを動かす。</p><p>この時点では前述のテストと同じ事を試みるが、既定値のブロードキャストアドレスに、ブロードキャスト経由で行う。それをリッスンしているSambaは短時間にすべての応答を受け取れないかもしれないが、ネットワーク上にある、たくさんのNetBIOS/TCP/IPホストが、これに応答する。いくつかのホストからの、<code class="literal">got a positive name query response</code>メッセージを受け取るはずである。</p><p><a class="indexterm" name="id2708539"></a>もしも、上記のテストのような結果が得られないのであれば、nmblookupが、その自動メカニズムによる、使用しているブロードキャストアドレスを正しく入手できていない。この場合、使用するIPアドレス、ブロードキャストとサブネットマスクを、<code class="filename">smb.conf</code>中の<a class="link" href="smb.conf.5.html#INTERFACES" target="_top">interfaces</a>オプションに、手動で設定することをやってみるべきである。</p><p>もしも、使用しているPCとサーバが同じサブネットにない場合、そのPCのサブネットのブロードキャストアドレスを指定する<code class="option">-B</code>オプションを使う必要がある。</p><p>このテストは、サブネットマスクとブロードキャストアドレスが間違っている場合、おそらく失敗する(3つ前の注意(Note)を参照)。</p></li><li class="step" title="Step 7"><p><a class="indexterm" name="id2708606"></a><code class="literal">smbclient //BIGSERVER/TMP</code>コマンドを動かす。パスワード要求が来るはずである。UNIXマシンにログインするアカウントのパスワードを入力する。もしも他のアカウントで、テストを行いたいならば、コマンドラインの最後の所に、<code class="option">-U accountname</code>オプションを追加する。 たとえば、<code class="literal">smbclient //bigserver/tmp -Ujohndoe</code>である。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>以下のように、ユーザ名に引き続いてパスワードを指定することも出来る:<code class="literal">smbclient //bigserver/tmp -Ujohndoe%secret</code>.</p></div><p>パスワードを入力すると、<code class="prompt">smb></code>プロンプトが出るはずである。もしもそうでなければ、エラーメッセージが表示される。もしもそれが<span class="quote">“<span class="quote"><span class="errorname">invalid network name</span></span>”</span>であれば、サービス<em class="parameter"><code>tmp</code></em>が<code class="filename">smb.conf</code>中で正しく設定されていない。</p><p><span class="quote">“<span class="quote"><span class="errorname">bad password</span></span>”</span>という表示がされたならば、あり得そうな原因は以下の通り:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>	shadowパスワード(かその他のパスワードシステム)を使っているが、<span class="application">smbd</span>中で	それをサポートするようにコンパイルされていない。	</p></li><li class="listitem"><p>	使用している<a class="link" href="smb.conf.5.html#VALIDUSERS" target="_top">valid users</a>の設定が間違っている。	</p></li><li class="listitem"><p>	大文字小文字を混ぜたパスワードを使っているが、十分に大きなレベルを	<a class="link" href="smb.conf.5.html#PASSWORDLEVEL" target="_top">password level</a>オプションで有効にしていない。	</p></li><li class="listitem"><p>	<code class="filename">smb.conf</code>中の<a class="link" href="smb.conf.5.html#PATH" target="_top">path</a>行が間違っている。<span class="application">testparm</span>で	検査すること。	</p></li><li class="listitem"><p>	パスワード暗号化を有効にしているが、SambaユーザにUNIXユーザをマップしていない。	<code class="literal">smbpasswd -a username</code>を実行する。	</p></li></ol></div><p><a class="indexterm" name="id2708807"></a><a class="indexterm" name="id2708814"></a><a class="indexterm" name="id2708821"></a><a class="indexterm" name="id2708827"></a>接続後、コマンド<code class="literal">dir</code>, <code class="literal">get</code>,<code class="literal">put</code>などが使えるようになっているはずである。どう入力するかを調べるために、<code class="literal">help command</code>を入力する。<code class="literal">dir</code>コマンドを入力した時に、空きディスクスペースが正しいかを、特にチェックすべきである。</p></li><li class="step" title="Step 8"><p><a class="indexterm" name="id2708878"></a>PC上で、<code class="literal">net view \\BIGSERVER</code>コマンドを入力する。これは、DOSウィンドウ内で入力する必要がある。サーバ上で有効な共有一覧が表示されるべきである。</p><p><a class="indexterm" name="id2708897"></a><code class="literal">network name not found</code>か似たようなエラーが表示された場合、NetBIOS名前解決が動作していない。これは通常<code class="literal">nmbd</code>の問題である。これを解決するために、以下のどれかを行う(どれか1つを選ぶのみでよい):</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>	<span class="application">nmbd</span>のインストールを修正する。</p></li><li class="listitem"><p>	PC上のTCP/IP設定中にある「詳細設定」において<code class="literal">wins</code>タブ中に	BIGSERVERのIPアドレスを追加する。</p></li><li class="listitem"><p>        TCP/IP設定中にある「詳細設定」においてDNS経由での名前解決を有効にする。</p></li><li class="listitem"><p>        PC上のlmhostsファイルにBIGSERVERを追加する。</p></li></ol></div><p>もしも、<span class="quote">“<span class="quote"><span class="errorname">invalid network name</span></span>”</span>か<span class="quote">“<span class="quote"><span class="errorname">bad password error,</span></span>”</span>というメッセージが表示されたならば、<code class="literal">smbclient -L</code>テストでのと同じ修正を行う。特に、<code class="literal">hosts allow</code>行(マニュアルページを参照)が正しいかを確認すること。</p><p>また、ワークステーションがSambaサーバに接続を要求するとき、Windowsマシンにログオンしている名前を使うという事実を見落とさないこと。Sambaサーバ上で存在しているアカウントと正確に同じ名前とパスワードにする必要がある。</p><p>もしも<span class="quote">“<span class="quote"><span class="errorname">specified computer is not receiving requests</span></span>”</span>か、同等のエラーが表示されたならば、おそらくTCP経由でホストに接続できないことを意味する。TCPラッパーがホスト上で動いているかを調べ、そうであれば、クライアント(かサブネット等)のエントリを<code class="filename">hosts.allow</code>に追加する。</p></li><li class="step" title="Step 9"><p><code class="literal">net use x: \\BIGSERVER\TMP</code>を実行する。パスワード要求が来るはずである。次に、<code class="computeroutput">command completed successfully</code>メッセージが表示されるはずである。そうでない場合、PC上のソフトウェアが正しくインストールされていないか、<code class="filename">smb.conf</code>が間違っている。<code class="filename">smb.conf</code>中の<em class="parameter"><code>hosts allow</code></em>と他の設定行が正しいかを確認する。</p><p>サーバが、どのユーザ名で接続するかを見いだせないという事もあり得る。この問題かどうかを見るためには、<code class="filename">smb.conf</code>中の<em class="parameter"><code>[tmp]</code></em>セクションに<a class="link" href="smb.conf.5.html#USER" target="_top">user = username</a>行を追加する。ここで、<em class="parameter"><code>username</code></em>は、入力するパスワードに対応するものである。もしもこれで修正されるならば、ユーザ名マッピングオプションが必要となるかもしれない。</p><p>クライアントが暗号化パスワードのみを送り、<code class="filename">smb.conf</code>中で<a class="link" href="smb.conf.5.html#ENCRYPTPASSWORDS" target="_top">encrypt passwords = no</a>が設定されているという場合もあるかもしれない。これを修正するためには、設定を`yes'に変更する。</p></li><li class="step" title="Step 10"><p>ワークグループの名前が<em class="parameter"><code>testgroup</code></em>である、SambaサーバとWindows PCが属している所で<code class="literal">nmblookup -M <em class="parameter"><code>testgroup</code></em></code>を実行する。そのワークグループにおけるマスタブラウザのIPアドレスが表示されるはずである。</p><p>そうでない場合、選択プロセスが失敗している。ただ単に遅れているのかもしれないのでしばらく待ち、再度試してみる。それでも失敗した場合、<code class="filename">smb.conf</code>中にあるブラウジングオプションを調べてみる。起動時に選択(election)が行われるように、<a class="link" href="smb.conf.5.html#PREFERREDMASTER" target="_top">preferred master = yes</a>を書いておくこと。</p></li><li class="step" title="Step 11"><p>ファイルマネージャから、サーバをブラウジングしてみる。ローカルワークグループ(か<code class="filename">smb.conf</code>中で指定したもの)のブラウズリスト中にSambaサーバが現れるはずである。サーバの名前をダブルクリックし、共有の一覧が得られるべきである。もしも、<span class="quote">“<span class="quote">invalid password</span>”</span>というエラーが表示されたならば、おそらくWindows NTが動作していて、それがユーザレベルのセキュリティモードで動作していて暗号化パスワードを扱えない状態になっていてサーバのブラウジングを拒否している。この場合、<a class="link" href="smb.conf.5.html#SECURITY" target="_top">security = server</a>と<a class="link" href="smb.conf.5.html#PASSWORDSERVER" target="_top">password server = Windows_NT_Machine</a>のどちらかを<code class="filename">smb.conf</code>ファイル中に設定するか、<a class="link" href="smb.conf.5.html#ENCRYPTPASSWORDS" target="_top">encrypt passwords</a>を<span class="quote">“<span class="quote">yes</span>”</span>に設定するようにする。</p></li></ol></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="troubleshooting.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="troubleshooting.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="problems.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part V. トラブルシューティング </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 39. Sambaの問題の調査と解決方法</td></tr></table></div></body></html>