<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 23. スタッカブルVFSモジュール</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="CUPS-printing.html" title="Chapter 22. CUPS印刷環境のサポート"><link rel="next" href="winbind.html" title="Chapter 24. Winbind: ドメインアカウントの使用"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 23. スタッカブルVFSモジュール</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="CUPS-printing.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="winbind.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 23. スタッカブルVFSモジュール"><div class="titlepage"><div><div><h2 class="title"><a name="VFS"></a>Chapter 23. スタッカブルVFSモジュール</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Tim</span> <span class="surname">Potter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:tpot@samba.org">tpot@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Simo</span> <span class="surname">Sorce</span></h3><span class="contrib">original vfs_skel README</span> </div></div><div><div class="author"><h3 class="author"><span class="firstname">Alexander</span> <span class="surname">Bokovoy</span></h3><span class="contrib">original vfs_netatalk docs</span> </div></div><div><div class="author"><h3 class="author"><span class="firstname">Stefan</span> <span class="surname">Metzmacher</span></h3><span class="contrib">Update for multiple modules</span> </div></div><div><div class="author"><h3 class="author"><span class="firstname">Ed</span> <span class="surname">Riddle</span></h3><span class="contrib">original shadow_copy docs</span> </div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="VFS.html#id2669981">機能と利便性</a></span></dt><dt><span class="sect1"><a href="VFS.html#id2670024">議論</a></span></dt><dt><span class="sect1"><a href="VFS.html#id2670463">含まれるモジュール</a></span></dt><dd><dl><dt><span class="sect2"><a href="VFS.html#id2670469">audit</a></span></dt><dt><span class="sect2"><a href="VFS.html#id2670513">default_quota</a></span></dt><dt><span class="sect2"><a href="VFS.html#id2670762">extd_audit</a></span></dt><dt><span class="sect2"><a href="VFS.html#fakeperms">fake_perms</a></span></dt><dt><span class="sect2"><a href="VFS.html#id2671124">recycle</a></span></dt><dt><span class="sect2"><a href="VFS.html#id2671570">netatalk</a></span></dt><dt><span class="sect2"><a href="VFS.html#id2671625">shadow_copy</a></span></dt></dl></dd><dt><span class="sect1"><a href="VFS.html#id2672691">他で入手可能なVFSモジュール</a></span></dt><dd><dl><dt><span class="sect2"><a href="VFS.html#id2672726">DatabaseFS</a></span></dt><dt><span class="sect2"><a href="VFS.html#id2672808">vscan</a></span></dt><dt><span class="sect2"><a href="VFS.html#id2672854">vscan-clamav</a></span></dt></dl></dd></dl></div><div class="sect1" title="機能と利便性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2669981"></a>機能と利便性</h2></div></div></div><p><a class="indexterm" name="id2669988"></a><a class="indexterm" name="id2669998"></a><a class="indexterm" name="id2670004"></a>Samba-3から、スタッカブルVFS(バーチャルファイルシステム)モジュールがサポートされる。SambaはUNIXファイルシステムへのアクセスリクエストの一つ一つを、ロードされたVFSモジュールに渡す。この章は、Sambaのソースに附属のモジュールについて説明すると同時に、一部の外部モジュールについても言及する。</p></div><div class="sect1" title="議論"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2670024"></a>議論</h2></div></div></div><p><a class="indexterm" name="id2670032"></a><a class="indexterm" name="id2670039"></a>異なるシステムでは異なる方法で共用ライブラリーをコンパイルしリンクするので、これらのモジュールが、プラットフォームディストリビューションのバイナリSambaパッケージと共に供給されない場合、モジュールをコンパイルするのが困難になるかもしれない。これらのモジュールは、GNU/Linux及びIRIXに関してテスト済みである。</p><p><a class="indexterm" name="id2670059"></a><a class="indexterm" name="id2670066"></a><a class="indexterm" name="id2670073"></a>VFS モジュールを使用するには、以下の例に類似した共有を作成すること。重要なパラメータは、一つ以上のVFSモジュールを名前順に一覧表示できる<a class="link" href="smb.conf.5.html#VFSOBJECTS" target="_top">vfs objects</a>パラメータである。例えば、ファイルへのアクセスをすべてログに取り、削除されたファイルをゴミ箱に入れるには、<a class="link" href="VFS.html#vfsrecyc" title="Example 23.1. VFSモジュールを使うsmb.confの例">VFSモジュールを使うsmb.confの例</a>を参照のこと:</p><div class="example"><a name="vfsrecyc"></a><p class="title"><b>Example 23.1. VFSモジュールを使うsmb.confの例</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[audit]</code></em></td></tr><tr><td><a class="indexterm" name="id2670139"></a><em class="parameter"><code>comment = Audited /data directory</code></em></td></tr><tr><td><a class="indexterm" name="id2670151"></a><em class="parameter"><code>path = /data</code></em></td></tr><tr><td><a class="indexterm" name="id2670163"></a><em class="parameter"><code>vfs objects = audit recycle</code></em></td></tr><tr><td><a class="indexterm" name="id2670174"></a><em class="parameter"><code>writeable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2670186"></a><em class="parameter"><code>browseable = yes</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2670201"></a><a class="indexterm" name="id2670208"></a><a class="indexterm" name="id2670215"></a>モジュールは指定された順に使用される。例えば、ウィルススキャナモジュールとごみ箱モジュールを両方使用したいとする。この場合、ファイルに関して他のアクションが取られる前に、最初にウィルスを検知するよう、ウィルススキャナモジュールを最初のモジュールとし、このモジュールが最初に動くようにすべきである。The modules are used in the order in which they are specified.  Let's say that you want to both have a virusscanner module and a recycle bin module. It is wise to put the virus scanner module as the first one so thatit is the first to get run and may detect a virus immediately, before any action is performed on that file.<a class="link" href="smb.conf.5.html#VFSOBJECTS" target="_top">vfs objects = vscan-clamav recycle</a></p><p><a class="indexterm" name="id2670263"></a><a class="indexterm" name="id2670270"></a>SambaはSambaをインストールしたサーバのrootディレクトリ中の<code class="filename">/lib</code>からいくつかのモジュールをロードしようとする(通常は<code class="filename">/usr/lib/samba/vfs</code>か<code class="filename">/usr/local/samba/lib/vfs</code>)。</p><p><a class="indexterm" name="id2670303"></a><a class="indexterm" name="id2670310"></a><a class="indexterm" name="id2670317"></a><a class="indexterm" name="id2670324"></a>いくつかのモジュールは同じ共有に対して二度使用できる。これは<a class="link" href="VFS.html#multimodule" title="Example 23.2. 複数のVFSモジュールを使用するsmb.confの例">複数のVFSモジュールを使用するsmb.confの例</a>のような設定で可能となる。</p><div class="example"><a name="multimodule"></a><p class="title"><b>Example 23.2. 複数のVFSモジュールを使用するsmb.confの例</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[test]</code></em></td></tr><tr><td><a class="indexterm" name="id2670366"></a><em class="parameter"><code>comment = VFS TEST</code></em></td></tr><tr><td><a class="indexterm" name="id2670377"></a><em class="parameter"><code>path = /data</code></em></td></tr><tr><td><a class="indexterm" name="id2670389"></a><em class="parameter"><code>writeable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2670400"></a><em class="parameter"><code>browseable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2670412"></a><em class="parameter"><code>vfs objects = example:example1 example example:test</code></em></td></tr><tr><td><a class="indexterm" name="id2670424"></a><em class="parameter"><code>example1: parameter = 1</code></em></td></tr><tr><td><a class="indexterm" name="id2670436"></a><em class="parameter"><code>example:  parameter = 5</code></em></td></tr><tr><td><a class="indexterm" name="id2670448"></a><em class="parameter"><code>test:     parameter = 7</code></em></td></tr></table></div></div><p><br class="example-break"></p></div><div class="sect1" title="含まれるモジュール"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2670463"></a>含まれるモジュール</h2></div></div></div><div class="sect2" title="audit"><div class="titlepage"><div><div><h3 class="title"><a name="id2670469"></a>audit</h3></div></div></div><p><a class="indexterm" name="id2670477"></a>		syslog機能へのファイルアクセスを監査するシンプルなモジュールである。 以下の操作のログが取られる:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>share</p></li><li class="listitem"><p>connect/disconnect</p></li><li class="listitem"><p>directory opens/create/remove</p></li><li class="listitem"><p>file open/close/rename/unlink/chmod</p></li></ul></div><p>		</p></div><div class="sect2" title="default_quota"><div class="titlepage"><div><div><h3 class="title"><a name="id2670513"></a>default_quota</h3></div></div></div><p>	このモジュールは、Samba-3サーバ上で格納される既定値のquota値を、Windowsのエクスプローラの	GUI画面で設定できるようにする。この試みはLinuxファイルシステムでユーザとグループに対する	quotaを格納する場合のみだが、それは既定値を持たない。	</p><p>	Sambaは既定値としてNO_LIMITをquotaの既定値として返し、それは更新できない。このモジュールを	使うと、ユーザに対するquotaレコード中でWindowsクライアントに表示される既定値のquota値を	格納できる。既定値では、通常quota制限がrootには適用されないため、rootユーザが既定値として	利用される。	</p><p>	このモジュールには<code class="filename">smb.conf</code>ファイル中で2つのパラメータを設定する。おのおのの既定値の	プレフィックスは<span class="quote">“<span class="quote">default_quota</span>”</span>である。これは、以下のようにして、	<span class="emphasis"><em>vfs modules</em></span>パラメータ中でモジュールをロードしたときに上書きできる:</p><pre class="screen">vfs objects = default_quota:myprefix</pre><p>	</p><p>	default_quotasモジュールに対して指定することが出来るパラメータのエントリは以下の通り:	</p><div class="variablelist"><dl><dt><span class="term">myprefix:uid</span></dt><dd><p>			既定値のユーザquotaを格納するために使われるquotaレコードのためのuidを			指定する整数値。			</p><p>			既定値は0(ルートユーザ)。使用例は以下の通り:</p><pre class="screen">vfs objects = default_quotadefault_quota:	uid = 65534</pre><p>			上記の例では<code class="constant">myprefix</code>が省略され、そのため、既定値の			プレフィックスはモジュールの名前になる。<code class="constant">myprefix</code>			パラメータが指定されると、上記は以下のように書き換えられる:</p><pre class="screen">vfs objects = default_quota:myprefixmyprefix:	uid = 65534</pre><p>			</p></dd><dt><span class="term">myprefix:uid nolimit</span></dt><dd><p>			既定値のquota値がユーザのレコードとしても表示される場合か、			<code class="constant">NO_LIMIT</code>が、<em class="parameter"><code>prefix:uid</code></em>パラメータに			よって指定されたユーザとしてWindowsクライアントに表示される場合、この			パラメータは論理値となる。			</p><p>			既定値は<code class="constant">yes</code>である(NO_LIMITが表示される)。使用例は以下の通り:</p><pre class="screen">vfs objects = default_quota:myprefixmyprefix:	uid nolimit = no</pre><p>			</p></dd><dt><span class="term">myprefix:gid</span></dt><dd><p>			このパラメータは<em class="parameter"><code>prefix>:uid</code></em>と同じように整数値を引数と			して取るが、グループquotaであるところが違う。注意:グループquotaはWindows			エクスプローラではサポートされていない。			</p><p>			既定値は0である(rootグループ)。使用例は以下の通り:</p><pre class="screen">vfs objects = default_quotadefault_quota:	gid = 65534</pre><p>			</p></dd><dt><span class="term">myprefix:gid nolimit</span></dt><dd><p>			このパラメータは、<em class="parameter"><code>prefix>:uid nolimit</code></em>と同じように			真理値を取るが、グループquotaであることが違う。注意:グループquotaは			Windowsエクスプローラではサポートされていない。			</p><p>			既定値は<code class="constant">yes</code>(NO_LIMITが表示される)。使用例は以下の通り:</p><pre class="screen">vfs objects = default_quotadefault_quota:	uid nolimit = no</pre><p>			</p></dd></dl></div><p>	複数のパラメータを組み合わせた使用例は以下の通り:</p><pre class="screen">...vfs objects = default_quota:quotasettingsquotasettings:	uid nolimit = noquotasettings:	gid = 65534quotasettings:	gid nolimit = no...</pre><p>	</p></div><div class="sect2" title="extd_audit"><div class="titlepage"><div><div><h3 class="title"><a name="id2670762"></a>extd_audit</h3></div></div></div><p><a class="indexterm" name="id2670770"></a><a class="indexterm" name="id2670777"></a><a class="indexterm" name="id2670784"></a>		このモジュールは上記の<code class="literal">audit</code>モジュールとほぼ同じで		あるが、監査ログをsyslogと<code class="literal">smbd</code>のログファイルに送る		事が異なる。このモジュールの<a class="link" href="smb.conf.5.html#LOGLEVEL" target="_top">log level</a>は		<code class="filename">smb.conf</code>ファイル中で設定する。		</p><p>		有効な設定と記録される情報を<a class="link" href="VFS.html#xtdaudit" title="Table 23.1. 拡張監査ログの情報内容">下記のテーブル</a>中に示す。		</p><div class="table"><a name="xtdaudit"></a><p class="title"><b>Table 23.1. 拡張監査ログの情報内容</b></p><div class="table-contents"><table summary="拡張監査ログの情報内容" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">ログレベル</th><th align="center">ログ内容 - ファイルとディレクトリ操作</th></tr></thead><tbody><tr><td align="center">0</td><td align="left">ディレクトリの作成、削除、Unlink</td></tr><tr><td align="center">1</td><td align="left">ディレクトリのオープン/改名、ファイル名の変更、パーミッション/ACLの変更</td></tr><tr><td align="center">2</td><td align="left">ファイルのオープン&クローズ</td></tr><tr><td align="center">10</td><td align="left">最大のデバッグレベル</td></tr></tbody></table></div></div><br class="table-break"><div class="sect3" title="監査の設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2670923"></a>監査の設定</h4></div></div></div><p><a class="indexterm" name="id2670931"></a>		この監査ツールはたいていの人が容易に認知するよりもより自由度が高い。		有用なログ情報を記録するためのいくつかの方法がある。		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>すべてのトランザクションを記録するためにsyslogが使える。					これは、<code class="filename">smb.conf</code>ファイル中に					<em class="parameter"><code>syslog = 0</code></em>を設定することで無効に出来る。</p></li><li class="listitem"><p>xがログレベルである<em class="parameter"><code>log level = 0 vfs:x</code></em>					を<code class="filename">smb.conf</code>ファイル中に設定することによりすべてのロードされた					VFSモジュールに対して既定値のログファイル					(<code class="filename">log.smbd</code>)をログの出力として使える。これは、					ログレベルで指定された、VFSモジュールの動作のすべてのログが					有効になっているが、通常のログは無効にする。</p></li><li class="listitem"><p>ユーザ単位、クライアントマシン単位などで詳細なログを取れる。					これは、<em class="parameter"><code>log file</code></em>の特別な設定方法と					上記を一緒にすることを要求する。</p><p>ユーザ単位とマシン単位の詳細なログの例は、					<a class="link" href="smb.conf.5.html#LOGFILE" target="_top">log file = /var/log/samba/%U.%m.log</a>					のようにして行う。					</p></li></ul></div><p>		監査情報は、しばしば長い期間保存する必要はある。ログファイルがローテート		されないように、<code class="filename">smb.conf</code>ファイル中で<a class="link" href="smb.conf.5.html#MAXLOGSIZE" target="_top">max log size = 0</a>		を設定するのは必須である。</p></div></div><div class="sect2" title="fake_perms"><div class="titlepage"><div><div><h3 class="title"><a name="fakeperms"></a>fake_perms</h3></div></div></div><p><a class="indexterm" name="id2671073"></a><a class="indexterm" name="id2671079"></a><a class="indexterm" name="id2671086"></a><a class="indexterm" name="id2671093"></a>		このモジュールは、(UNIX配下のSambaサーバで)移動プロファイルのファイルと		ディレクトリを読み込み専用に設定することができるようにするために作成		された。 このモジュールは、プロファイル共有にインストールされている場合、		プロファイルのファイルとディレクトリが書き込み可能であると、クライアントに		通知する。これにより、クライアントがログアウトまたはシャットダウンした		時に、ファイルを上書きしなくなるが、クライアントのニーズは充足する。		</p></div><div class="sect2" title="recycle"><div class="titlepage"><div><div><h3 class="title"><a name="id2671124"></a>recycle</h3></div></div></div><p><a class="indexterm" name="id2671132"></a><a class="indexterm" name="id2671139"></a><a class="indexterm" name="id2671146"></a>		ゴミ箱と同様のモジュールである。 使用すると、unlinkシステムコールを		横取り、ファイルを削除する代わりにゴミ箱ディレクトリに移動する。		これはWindowsコンピュータにおける<span class="guiicon">ゴミ箱</span>の機能と		同じである。		</p><p><a class="indexterm" name="id2671170"></a><a class="indexterm" name="id2671177"></a><a class="indexterm" name="id2671184"></a><a class="indexterm" name="id2671190"></a>		<span class="guiicon">ごみ箱</span>は、<span class="application">Windows エクスプローラー</span>		のネットワークファイルシステム(共有)のビューにも、マッピングされたドライブの		いずれのビューにも表示されない。その代わりに、<code class="filename">.recycle</code>		というディレクトリが、初めてファイルを削除したときと		<em class="parameter"><code>recycle:repository</code></em>が設定されていないときに自動的に		作成される。もし、<em class="parameter"><code>recycle:repository</code></em>が設定されている		場合、作成されるディレクトリは<em class="parameter"><code>recycle:repository</code></em>に		依存する。ユーザはごみ箱からファイルを取り戻すことが出来る。もしも、		<em class="parameter"><code>recycle:keeptree</code></em>が指定されていた場合、		削除されたファイルは、ファイルが削除された元の場所と同一のパスから、		見つけることができる。		</p><p><code class="literal">recycle</code>がサポートするオプションは以下の通り:		</p><div class="variablelist"><dl><dt><span class="term">recycle:repository</span></dt><dd><p><a class="indexterm" name="id2671276"></a>				削除されたファイルの移動先であるディレクトリのパス。				</p></dd><dt><span class="term">recycle:directory_mode</span></dt><dd><p><a class="indexterm" name="id2671298"></a>				recycleディレクトリに設定したい8進のモードを指定する。				もしも存在しないか、最初にファイルが削除された時、				このモードでrecycleディレクトリが作成される。				もしも、<em class="parameter"><code>recycle:subdir_mode</code></em>が				設定されていない場合、それらのモードはサブディレクトリ				にも適用される。もしも、				<em class="parameter"><code>directory_mode</code></em>が設定されて				いない場合、既定値として0700が使われる。				</p></dd><dt><span class="term">recycle:subdir_mode</span></dt><dd><p><a class="indexterm" name="id2671340"></a>				recycleディレクトリのサブディレクトリに設定したい				8進のモードを指定する。このモードでサブディレクトリ				が作成される。もしも、				<em class="parameter"><code>recycle:subdir_mode</code></em>が				設定されていない場合、サブディレクトリのモードは				<em class="parameter"><code>directory_mode</code></em>のモードで				作成される。				</p></dd><dt><span class="term">recycle:keeptree</span></dt><dd><p><a class="indexterm" name="id2671379"></a>				ディレクトリ構造を維持するか、あるいは削除された				ファイルはゴミ箱に別に保存するかを指定する。				</p></dd><dt><span class="term">recycle:versions</span></dt><dd><p><a class="indexterm" name="id2671402"></a>				このオプションを設定すると、同名の二つのファイルが削除				されたとき、 二つとも別のファイルとしてゴミ箱に保存する。				より新しい方の削除ファイルは、				<span class="quote">“<span class="quote">Copy #x of <em class="replaceable"><code>filename</code></em></span>”</span>				という名称で保存される。				</p></dd><dt><span class="term">recycle:touch</span></dt><dd><p><a class="indexterm" name="id2671435"></a>				ファイルがごみ箱に移されたときに、ファイルのアクセス				日付を変更するかどうかを指定する。				</p></dd><dt><span class="term">recycle:touch_mtime</span></dt><dd><p><a class="indexterm" name="id2671458"></a>				ファイルがごみ箱に移されたときに、ファイルの最終変更                                時刻を変更するかどうかを指定する				</p></dd><dt><span class="term">recycle:maxsize</span></dt><dd><p><a class="indexterm" name="id2671482"></a>				このパラメータで指定したバイト数より大きいファイルは、				ごみ箱に入れない。				</p></dd><dt><span class="term">recycle:exclude</span></dt><dd><p><a class="indexterm" name="id2671504"></a>				ごみ箱に入れないで、普通に削除するべきファイルをリストする。				</p></dd><dt><span class="term">recycle:exclude_dir</span></dt><dd><p><a class="indexterm" name="id2671526"></a>				ディレクトリのリストを指定する。これらのディレクトリから				ファイルが削除されると、ごみ箱には入れずに、普通に削除する。				</p></dd><dt><span class="term">recycle:noversions</span></dt><dd><p><a class="indexterm" name="id2671550"></a>				recycle:versionsの反対である(*や?のワイルドカードもサポート)				する。<span class="emphasis"><em>recycle:versions</em></span>が有効な時に				便利である。				</p></dd></dl></div><p>		</p></div><div class="sect2" title="netatalk"><div class="titlepage"><div><div><h3 class="title"><a name="id2671570"></a>netatalk</h3></div></div></div><p><a class="indexterm" name="id2671578"></a>		netatalkモジュールは、Sambaとnetatalkのファイル共有サービスの共存を		やり易くする。		</p><p>従前のnetatalkモジュールと比較した長所は以下の通り:		</p><div class="itemizedlist"><a class="indexterm" name="id2671596"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p>.AppleDouble フォークの作成を気にかけず、ただ同期を取る。</p></li><li class="listitem"><p><code class="filename">smb.conf</code>中の共有の「隠し(hide)」または「拒否(veto)」			 リスト中に.AppleDoubleのアイテムを含まないとき、自動的に追加される。</p></li></ul></div><p>		</p></div><div class="sect2" title="shadow_copy"><div class="titlepage"><div><div><h3 class="title"><a name="id2671625"></a>shadow_copy</h3></div></div></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a class="indexterm" name="id2671634"></a>	<span class="emphasis"><em>これはバックアップでも、アーカイブでも、バージョンコントロールソリューションでもない!</em></span>	</p><p><a class="indexterm" name="id2671649"></a>	SambaかWindowsサーバでは、shadow_copyはエンドユーザツールとしてのみ設計されて	いる。バックアップやアーカイブソリューションの機能強化や置き換えにはならず、	そのように考えてはいけない。更に、バージョンコントロール機能が必要な場合には、	バージョンコントロールシステムを入れること。これは警告である。	</p></div><p>	shadow_copyモジュールはMicrosoftシャドーコピーサービスに似た機能を提供する。	適切に設定された場合、Sambaの共有上で、Microsoftシャドーコピークライアントが	"シャドーコピー"を見えるようにする。シャドーコピークライアントのインストール	が必要である。Microsoftシャドーコピークライアントは	<a class="ulink" href="http://www.microsoft.com/windowsserver2003/downloads/shadowcopyclient.mspx" target="_top">ここ</a>	から入手できる。Windows XPより前のクライアントには追加の要求があることに注意。	この機能はWindows XPより前のバージョンではテストされていない。Microsoftシャドーコピー	に関するより詳細な情報は、	<a class="ulink" href="http://www.microsoft.com/windowsserver2003/techinfo/overview/scr.mspx" target="_top">Microsoftのサイト</a>	を参照のこと。	</p><p><a class="indexterm" name="id2671712"></a><a class="indexterm" name="id2671719"></a><a class="indexterm" name="id2671726"></a><a class="indexterm" name="id2671734"></a><a class="indexterm" name="id2671740"></a><a class="indexterm" name="id2671747"></a>	shadow_copy VFSモジュールはLVM1、LVM2かEVMSのような、ある種の論理ボリューム	マネージャ(LVM)でセットアップしたものがベースのファイルシステムを要求する。	LVMの設定はこの文書の範囲外である。しかし、<span class="emphasis"><em>例としてのみ</em></span>	この機能をテストするために行う手順の概要を示す。使いたいとしているLVMの	実装が使用対象に対して準備されているかを確かめる必要がある。十分にテストは	されなければならない。	</p><p>	以下は、LVMとEVMSに対するよく使われる情報源である:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://www.sistina.com/products_lvm_download.htm" target="_top">Sistinaの	    LVM1と LVM2に関する情報</a></p></li><li class="listitem"><p><a class="ulink" href="http://evms.sourceforge.net/" target="_top">Enterprise Volume Management System (EVMS)</a></p></li><li class="listitem"><p><a class="ulink" href="http://tldp.org/HOWTO/LVM-HOWTO/" target="_top">The LVM HOWTO</a>	    (訳注:日本語訳は<a class="ulink" href="http://www.linux.or.jp/JF/JFdocs/LVM-HOWTO.html" target="_top">こちら</a>)</p></li><li class="listitem"><p>	    Daniel Robbinによる、よく書かれた、LVMソースコードとreiserfsを使ったLinux上の2つのパートに分かれたチュートリアル  <a class="ulink" href="http://www-106.ibm.com/developerworks/linux/library/l-lvm/" target="_top">Learning	      Linux LVM, Part 1</a> と <a class="ulink" href="http://www-106.ibm.com/developerworks/library/l-lvm2.html" target="_top">Learning	      Linux LWM, Part 2</a>を参照。</p></li></ul></div><div class="sect3" title="Shadow Copy のセットアップ"><div class="titlepage"><div><div><h4 class="title"><a name="id2671860"></a>Shadow Copy のセットアップ</h4></div></div></div><p><a class="indexterm" name="id2671869"></a><a class="indexterm" name="id2671876"></a>	これを書いている時点では、十分なテストは終わっていない。シャドーコピーVFS	モジュールを、製品環境では展開していないが、概念の照明としてはより多く、	特定のシナリオでテストした。シナリオはXFSファイルシステムとLVM1を使う	Debian Sarge上のSamba-3サーバで改良された。ここで提示されたすべてのコンポーネント	に関して、十分な評価をしないでソリューションとして使うことは推奨しない。	すなわち、以下は動作させたまでの基本的な概要である。	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p title="インストールされたOS"><b>インストールされたOS. </b>		テストを行うにあたっては、		<a class="ulink" href="http://www.debian.org/devel/debian-installer/" target="_top">Debian Sarge</a>		(すなわちテスト版)をXFSファイルシステム上で使用した。OSの設定は、		この文書の範囲外である。Sambaが動作するOSがあるものと仮定する。		</p></li><li class="listitem"><p title="Sambaのインストールと設定"><b>Sambaのインストールと設定. </b>		この件についてはこのHOWTOの<a class="link" href="introduction.html" title="Part I. 概要">インストールの章</a>		を参照のこと。ドメインコントローラかメンバファイルサーバであることは重要では		ないが、Samba 3.0.3かそれ以降のサーバが動作していることを仮定する。		</p></li><li class="listitem"><p title="LVMのインストールと設定"><b>LVMのインストールと設定. </b><a class="indexterm" name="id2671978"></a><a class="indexterm" name="id2671985"></a>		クライアントに対してシャドーコピーを有効にする前に、シャドーコピーを		作っておく必要がある。これはファイルシステムのスナップショットのような		事を行う事でできる。スナップショットはLVMのような、論理ボリューム		マネージャでの一般的な機能であり、まずこれを最初に設定する必要がある。		</p><div class="itemizedlist"><p>		以下は、Debianユーザにとっては最も手助けとなる例である。繰り返すが、		これは"testing"または"Sarge"を使ってテストしている。		</p><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2672019"></a><a class="indexterm" name="id2672026"></a><a class="indexterm" name="id2672032"></a><a class="indexterm" name="id2672039"></a><a class="indexterm" name="id2672046"></a>			まだ入れていないのであれば、lvm10とdevfsdパッケージをインストールする。			Debianシステム上では、devfsファイル名を要求するdevfsとlvm1が相互に			影響するので警告が出る。			<code class="literal">apt-get update && apt-get install lvm10 devfsd xfsprogs</code>			を実行してこの例のためのトリックを行う。			</p></li><li class="listitem"><p><a class="indexterm" name="id2672076"></a><a class="indexterm" name="id2672083"></a><a class="indexterm" name="id2672090"></a><a class="indexterm" name="id2672097"></a><a class="indexterm" name="id2672104"></a>			次にボリュームを作成する。そしてボリュームにパーティションを作成する			必要がある。好みのパーティション作成ツールを使うこと(たとえば、			Linuxのfdisk、cfdiskなど)。パーティションタイプは"Linux LVM"を			表す 0x8eに設定すべきである。この例では/dev/hdb1を使う。			</p><p><a class="indexterm" name="id2672124"></a><a class="indexterm" name="id2672132"></a><a class="indexterm" name="id2672139"></a>			LVMパーティション(タイプ0x8e)が出来ると、LVMボリュームを作成するための			一連のコマンドを実行出来る。いくつかのディスクとパーティションを			使うことが出来るが、この例では一つのみを使う。			<code class="literal">modprobe lvm-mod</code>のようにしてカーネルモジュールを			ロードしてもよく、また、(<code class="filename">/etc/modules</code>に追加			することによって)起動時にロードするように、rebootしても良い。			</p></li><li class="listitem"><p><a class="indexterm" name="id2672175"></a>			<code class="literal">pvcreate /dev/hdb1</code>で物理ボリュームを作成する。			</p></li><li class="listitem"><p><a class="indexterm" name="id2672193"></a><a class="indexterm" name="id2672199"></a>			<code class="literal">vgcreate shadowvol /dev/hdb1</code>でボリュームグループを作成し、/dev/hda1に追加する。			</p><p><a class="indexterm" name="id2672217"></a>			<code class="literal">vgdisplay</code>を使ってボリュームグループについての情報を見る事ができる。			</p></li><li class="listitem"><p><a class="indexterm" name="id2672236"></a>			この時点で<code class="literal">lvcreate -L400M -nsh_test shadowvol</code>のようにして、論理ボリュームを作成できる。			</p><p><a class="indexterm" name="id2672254"></a>			これは、shadowvolとして作成したボリュームグループ内に、400MBの、			"sh_test"という論理ボリュームを作成する。すべてがうまくいくと、			<code class="filename">/dev/shadowvol</code>中にそれらを見る事ができる。			</p></li><li class="listitem"><p><a class="indexterm" name="id2672278"></a>			この時点でsh_testという論理ボリュームを			<code class="literal">mkfs.xfs /dev/shadowvol/sh_test</code>			というコマンドでフォーマットできる準備が出来た。			</p><p><a class="indexterm" name="id2672300"></a><a class="indexterm" name="id2672307"></a><a class="indexterm" name="id2672313"></a><a class="indexterm" name="id2672320"></a><a class="indexterm" name="id2672327"></a>			選択した任意のファイルシステムで論理ボリュームをフォーマット			できるが、ファイルシステムのフリーズ、リサイズや拡張のような			LVMの便利な追加機能を使えるようにしておくこと。			</p><p><a class="indexterm" name="id2672346"></a><a class="indexterm" name="id2672353"></a><a class="indexterm" name="id2672360"></a>			これで、シャドーコピーVFSモジュールを使えるLVMボリュームが			準備できた。			</p></li><li class="listitem"><p><a class="indexterm" name="id2672375"></a><a class="indexterm" name="id2672382"></a><a class="indexterm" name="id2672389"></a>			以下のようにしてディレクトリを準備する必要がある。Now we need to prepare the directory with something like</p><pre class="screen"><code class="prompt">root# </code> mkdir -p /data/shadow_share</pre><p>			あるいは、シャドーコピーが有効になったSamba共有の希望する名前を			指定する。その上で使えるように、パーミッションの設定をきちんと			行う事。もしも、わからなければ、			<code class="literal">chmod 777 /data/shadow_share</code>を使い、うまく			動いてからパーミッションをきつくする。			</p></li><li class="listitem"><p><a class="indexterm" name="id2672433"></a>			<code class="literal">mount /dev/shadowvol/sh_test /data/shadow_share</code>			のようにしてLVMボリュームをマウントする。			</p><p><a class="indexterm" name="id2672452"></a>			システム起動時にこのパーティションをマウントできるよう、			<code class="filename">/etc/fstab</code>を編集しても良い。			</p></li></ul></div></li><li class="listitem"><p title="シャドーコピーVFSモジュールのインストールと設定"><b>シャドーコピーVFSモジュールのインストールと設定. </b>		最後に実際のシャドーコピーVFSモジュールを設定する。シャドーコピーVFS		モジュールはSamba 3.0.3以降で有効である。smb.confの設定はとても標準的		である。以下はシャドーコピーVFSモジュールを使う共有定義の例である:		</p><div class="example"><a name="vfsshadow"></a><p class="title"><b>Example 23.3. シャドーコピーVFSを使う共有</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[shadow_share]</code></em></td></tr><tr><td><a class="indexterm" name="id2672517"></a><em class="parameter"><code>comment = Shadow Copy Enabled Share</code></em></td></tr><tr><td><a class="indexterm" name="id2672529"></a><em class="parameter"><code>path = /data/shadow_share</code></em></td></tr><tr><td><a class="indexterm" name="id2672541"></a><em class="parameter"><code>vfs objects = shadow_copy</code></em></td></tr><tr><td><a class="indexterm" name="id2672552"></a><em class="parameter"><code>writeable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2672564"></a><em class="parameter"><code>browseable = yes</code></em></td></tr></table></div></div><br class="example-break"></li><li class="listitem"><p title="スナップショットの作成とシャドーコピーとしての有効化"><b>スナップショットの作成とシャドーコピーとしての有効化. </b><a class="indexterm" name="id2672588"></a><a class="indexterm" name="id2672595"></a><a class="indexterm" name="id2672602"></a>		シャドーコピーを閲覧できる前に、それを作成してマウントする必要がある。		これは、cronジョブとして動作するスクリプトで行うのが最も良い。この特定の		解決方法に、LVMスナップショットを閲覧するのにシャドーコピーVFSモジュールが		使える。これらのスナップショットはモジュールによっては作成されない。また、		モジュールによって有効化もされない。このモジュールは、有効になったスナップ		ショットを閲覧する事を、シャドーコピーが有効になったクライアントに対して		行う。		</p><p>		以下はスナップショットの作成とマウントを行う単純なスクリプトである:</p><pre class="screen">#!/bin/bash# This is a test, this is only a testSNAPNAME=`date +%Y.%m.%d-%H.%M.%S`xfs_freeze -f /data/shadow_share/lvcreate -L10M -s -n $SNAPNAME /dev/shadowvol/sh_testxfs_freeze -u /data/shadow_share/mkdir /data/shadow_share/@GMT-$SNAPNAMEmount /dev/shadowvol/$SNAPNAME \       /data/shadow_share/@GMT-$SNAPNAME -onouuid,ro</pre><p>		このスクリプトはリブート時にスナップショットの再マウントのような事は扱わないことに注意。	    </p></li><li class="listitem"><p title="クライアントからのテスト"><b>クライアントからのテスト. </b>		テストのために、		<a class="ulink" href="http://technet.microsoft.com/ja-jp/windowsserver/bb405951.aspx" target="_top">MicrosoftのWebサイト</a>		からシャドーコピークライアントを入手し、インストールする必要がある		(訳注:URLは日本語版に差し替え済み)。これはXPクライアントでのみテストして		いるので、他のXP以前のクライアントでは結果が異なる可能性がある。一度		XPクライアントにインストール後、指定したファイルかshadow_shareの		空白部分で右クリックすると、"プロパティ"が表示される。何か変更があると、		プロパティウィンドウの中に"以前のバージョン"が表示される。		</p></li></ol></div></div></div></div><div class="sect1" title="他で入手可能なVFSモジュール"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2672691"></a>他で入手可能なVFSモジュール</h2></div></div></div><p><a class="indexterm" name="id2672699"></a>この節では、投稿されてはいるが、SambaCVSツリー(訳注:現在はgit)には何らかの理由(例えば、管理者が独自のCVSツリーを持つ方が管理しやすいなどの理由)で、現行のものには含まれない、各種のVFSモジュールを紹介する。</p><p>ここで言及したからと言って、そのモジュールの安定性や機能性の良し悪しを示唆したとは解釈しないこと。</p><div class="sect2" title="DatabaseFS"><div class="titlepage"><div><div><h3 class="title"><a name="id2672726"></a>DatabaseFS</h3></div></div></div><p><a class="indexterm" name="id2672734"></a>URL: <a class="ulink" href="http://www.css.tayloru.edu/~elorimer/databasefs/index.php" target="_top">Taylors University DatabaeFS</a></p><p>By <a class="ulink" href="mailto:elorimer@css.tayloru.edu" target="_top">Eric Lorimer.</a></p><p>私は、かなり完成された読み込み専用のファイルシステムを実現する VFS モジュールを作成した。これは、異なるデータベースを使用するための、モジュール式あるいは一般的な方式のファイルシステムとしてデータベースからの情報を表示する(元々は、<span class="quote">“<span class="quote">アーティスト</span>”</span>や<span class="quote">“<span class="quote">歌詞</span>”</span>といったディレクトリでMP3ファイルを整理するために設計されたものである。これを私は、学生名簿データベースに応用した)。ディレクトリ構造はデータベース自身に保存されており、その表を確認するプログラムが走りますが、それ以外に、データベース構造に関して何らかの推定をすることはしない。</p><p>フィードバックを歓迎する。コメント、提案、パッチ、その他何でも送ってほしい。他に何の役にも立たなくても、最低、誰かが仮想ファイルシステムを作成したい場合に役に立つことを願っている。</p></div><div class="sect2" title="vscan"><div class="titlepage"><div><div><h3 class="title"><a name="id2672808"></a>vscan</h3></div></div></div><a class="indexterm" name="id2672813"></a><p>URL: <a class="ulink" href="http://www.openantivirus.org/projects.php#samba-vscan" target="_top">Open Anti-Virus vscan</a></p><p><a class="indexterm" name="id2672834"></a>Samba-vscan は、Sambaが使う共有化のファイルのための、オンアクセスアンチウィルス機能を提供する、コンセプト実証(POC)モジュールである。samba-vscan は、各種のウィルス・スキャナーをサポートし、Rainer Linkがメンテナンスを行っている。</p></div><div class="sect2" title="vscan-clamav"><div class="titlepage"><div><div><h3 class="title"><a name="id2672854"></a>vscan-clamav</h3></div></div></div><p>Sambaユーザは何の問題もなくSerNetからのRPMを使っている。OpenLDAP Linuxユーザもとても良い結果が得られるvscanスキャナを使っている。これは全体を通して書き込みのパフォーマンスに影響がある。</p><p>以下のような共有セクションはvscan-clamavを設定したい人のための良いガイドである:</p><pre class="screen">[share]vfs objects = vscan-clamavvscan-clamav: config-file = /etc/samba/vscan-clamav.conf</pre><p>以下の<code class="filename">vscan-clamav.conf</code>ファイルの例は、完全に動作可能なものの手助けになるかもしれない:</p><pre class="screen"><span style="color: red"><title>VFS: Vscan ClamAV制御ファイル</title></span>## /etc/samba/vscan-clamav.conf#[samba-vscan]; run-time configuration for vscan-samba using; clamd; all options are set to default values; do not scan files larger than X bytes. If set to 0 (default),; this feature is disable (i.e. all files are scanned)max file size = 10485760; log all file access (yes/no). If set to yes, every access will; be logged. If set to no (default), only access to infected files; will be loggedverbose file logging = no; if set to yes (default), a file will be scanned while openingscan on open = yes; if set to yes, a file will be scanned while closing (default is yes)scan on close = yes; if communication to clamd fails, should access to file denied?; (default: yes)deny access on error = no; if daemon failes with a minor error (corruption, etc.),; should access to file denied?; (default: yes)deny access on minor error = no; send a warning message via Windows Messenger service; when virus is found?; (default: yes)send warning message = yes; what to do with an infected file; quarantine: try to move to quantine directory; delete:     delete infected file; nothing:    do nothing (default)infected file action = quarantine; where to put infected files - you really want to change this!quarantine directory  = /opt/clamav/quarantine; prefix for files in quarantinequarantine prefix = vir-; as Windows tries to open a file multiple time in a (very) short time; of period, samba-vscan use a last recently used file mechanism to avoid; multiple scans of a file. This setting specified the maximum number of; elements of the last recently used file list. (default: 100)max lru files entries = 100; an entry is invalidad after lru file entry lifetime (in seconds).; (Default: 5)lru file entry lifetime = 5; exclude files from being scanned based on the MIME-type! Semi-colon; seperated list (default: empty list). Use this with care!exclude file types =; socket name of clamd (default: /var/run/clamd). Setting will be ignored if; libclamav is usedclamd socket name = /tmp/clamd; limits, if vscan-clamav was build for using the clamav library (libclamav); instead of clamd; maximum number of files in archive (default: 1000)libclamav max files in archive = 1000; maximum archived file size, in bytes (default: 10 MB)libclamav max archived file size = 5242880; maximum recursion level (default: 5)libclamav max recursion level = 5</pre><p>もちろん、これを動作させるためにclamデーモンを走らせることは必要である。これはClamAVを使うための動作例である。ClamAVの説明には追加の設定例が提供されている。それは、システム内の<code class="filename">/usr/share/doc/</code>ディレクトリ配下に配置されている。いくつかの例は他の使用可能なウィルススキャナをターゲットにもしている。</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="CUPS-printing.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="winbind.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 22. CUPS印刷環境のサポート </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 24. Winbind: ドメインアカウントの使用</td></tr></table></div></body></html>