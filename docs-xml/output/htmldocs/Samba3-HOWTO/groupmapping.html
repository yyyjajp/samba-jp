<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 12. グループのマッピング: Microsoft Windows と UNIX</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="passdb.html" title="Chapter 11. アカウント情報データベース"><link rel="next" href="NetCommand.html" title="Chapter 13. リモートとローカル管理:Netコマンド"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 12. グループのマッピング: Microsoft Windows と UNIX</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="passdb.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="NetCommand.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 12. グループのマッピング: Microsoft Windows と UNIX"><div class="titlepage"><div><div><h2 class="title"><a name="groupmapping"></a>Chapter 12. グループのマッピング: Microsoft Windows と UNIX</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jean François</span> <span class="surname">Micouleau</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Gerald</span> <span class="othername">(Jerry)</span> <span class="surname">Carter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jerry@samba.org">jerry@samba.org</a>></code></p></div></div></div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="groupmapping.html#id2607704">機能と利便性</a></span></dt><dt><span class="sect1"><a href="groupmapping.html#id2608160">議論</a></span></dt><dd><dl><dt><span class="sect2"><a href="groupmapping.html#id2608524">警告:ユーザ固有のグループ問題</a></span></dt><dt><span class="sect2"><a href="groupmapping.html#id2608592">ネストされたグループ: WindowsドメイングループをWindowsローカルグループに追加</a></span></dt><dt><span class="sect2"><a href="groupmapping.html#id2609268">管理に関する重要な情報</a></span></dt><dt><span class="sect2"><a href="groupmapping.html#id2609547">既定値のユーザ、グループと相対識別子</a></span></dt><dt><span class="sect2"><a href="groupmapping.html#id2610196">設定例</a></span></dt></dl></dd><dt><span class="sect1"><a href="groupmapping.html#id2610273">設定スクリプト</a></span></dt><dd><dl><dt><span class="sect2"><a href="groupmapping.html#id2610288"><code class="filename">smb.conf</code>にグループを追加するスクリプト例</a></span></dt><dt><span class="sect2"><a href="groupmapping.html#id2610467">グループマッピング設定のためのスクリプト</a></span></dt></dl></dd><dt><span class="sect1"><a href="groupmapping.html#id2610606">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="groupmapping.html#id2610625">グループの追加が失敗する</a></span></dt><dt><span class="sect2"><a href="groupmapping.html#id2610723">ワークステーションのPower UsersグループへのDomain Usersの追加</a></span></dt></dl></dd></dl></div><p><a class="indexterm" name="id2607559"></a><a class="indexterm" name="id2607568"></a><a class="indexterm" name="id2607574"></a><a class="indexterm" name="id2607581"></a><a class="indexterm" name="id2607588"></a><a class="indexterm" name="id2607595"></a>	Samba-3からWindowsのグループSIDとUNIXのグループを関連づける新しいグループ	マッピング機能が利用できる。<span class="application">net</span>ツールに含まれる。<code class="literal">groupmap</code>	サブコマンドを、 関連づけの管理に使用する。	</p><p><a class="indexterm" name="id2607623"></a><a class="indexterm" name="id2607630"></a>	NTのグループとUNIXのシステムグループをマッピングするこの新しい機能では、	管理者が、どのNTドメイングループをMicrosoft Windowsクライアントに公開するか	を決定することができる。既定値(<code class="constant">-1</code>)以外の値を持つ	UNIXのグループにマッピングするNT のグループのみが、ドメインユーザ及び	グループにアクセスするツールのグループ選択リストに含まれる。	</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>	<a class="indexterm" name="id2607663"></a><a class="indexterm" name="id2607670"></a>	Samba-3では<em class="parameter"><code>domain admin group</code></em>パラメータが削除されたので、	<code class="filename">smb.conf</code>中にもはや指定してはならない。Samba-2.2.x中では、このパラメータは	このパラメータは、一覧表示されたユーザに、 ワークステーション上でローカル管理	権限を与える<code class="constant">Domain Admins</code>Windowsグループのメンバーシップを	付与するのに使用されていた(既定値の設定では)。	</p></div><div class="sect1" title="機能と利便性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2607704"></a>機能と利便性</h2></div></div></div><p>	Sambaでは、管理者がMicrosoft Windows NT4/200x グループアカウントを作成し、それらを	任意にUNIX/Linuxのグループアカウントと関連づけることができる。	</p><p>	<a class="indexterm" name="id2607722"></a>	<a class="indexterm" name="id2607728"></a>	<a class="indexterm" name="id2607735"></a><a class="indexterm" name="id2607741"></a><a class="indexterm" name="id2607748"></a><a class="indexterm" name="id2607755"></a><a class="indexterm" name="id2607762"></a>	グループアカウントは、Microsoft Windows NT4またはMicrosoft Windows 200x/XP Professional	のMMCツールを使用して管理することができる。これらのツールを使って自動的にUNIX/Linux	のシステムアカウントを作成するには、適切なスクリプトを<code class="filename">smb.conf</code>で提供する必要が	ある。それらのスクリプトが無い場合、<code class="literal">winbindd</code>が動作している	限りは、これらのツールを使って作成されたSambaグループアカウントは<code class="filename">smb.conf</code>	ファイル中の<a class="link" href="smb.conf.5.html#IDMAPUID" target="_top">idmap uid</a>/<a class="link" href="smb.conf.5.html#IDMAPGID" target="_top">idmap gid</a>	パラメータで指定されているID範囲内でUNIX UID/GIDを割り当てられる。	</p><div class="figure"><a name="idmap-sid2gid"></a><p class="title"><b>Figure 12.1. IDMAP: グループSIDからGIDへの解決</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/idmap-sid2gid.png" width="270" alt="IDMAP: グループSIDからGIDへの解決"></div></div></div><br class="figure-break"><div class="figure"><a name="idmap-gid2sid"></a><p class="title"><b>Figure 12.2. IDMAP: GIDから対応するSIDへの解決</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/idmap-gid2sid.png" width="270" alt="IDMAP: GIDから対応するSIDへの解決"></div></div></div><br class="figure-break"><p>	<a class="indexterm" name="id2607917"></a><a class="indexterm" name="id2607924"></a><a class="indexterm" name="id2607931"></a><a class="indexterm" name="id2607940"></a>	どちらのケースでもwinbinddが動作していない場合は、ローカルで解決可能なグループ	のみが認識される。<a class="link" href="groupmapping.html#idmap-sid2gid" title="Figure 12.1. IDMAP: グループSIDからGIDへの解決">IDMAP: グループSIDからGIDへの解決</a>	と<a class="link" href="groupmapping.html#idmap-gid2sid" title="Figure 12.2. IDMAP: GIDから対応するSIDへの解決">IDMAP: GIDから対応するSIDへの解決</a>を	参照のこと。<a class="link" href="groupmapping.html#idmap-store-gid2sid" title="Figure 12.3. IDMAPのグループマッピングの保存">IDMAPのグループマッピングの保存</a>	で示すように、<code class="literal">net groupmap</code>が、NTのSIDに対応するUNIXグループの	作成に使用される。	</p><div class="figure"><a name="idmap-store-gid2sid"></a><p class="title"><b>Figure 12.3. IDMAPのグループマッピングの保存</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/idmap-store-gid2sid.png" width="270" alt="IDMAPのグループマッピングの保存"></div></div></div><br class="figure-break"><p>	<a class="indexterm" name="id2608033"></a>	<a class="indexterm" name="id2608040"></a><a class="indexterm" name="id2608046"></a><a class="indexterm" name="id2608054"></a>	<code class="filename">smb.conf</code>のグループインタフェーススクリプトが、直接UNIX/Linuxシステムツール	(shadowユーティリティ,<code class="literal">groupadd</code>,<code class="literal">groupdel</code>と	<code class="literal">groupmod</code>)を呼び出した場合、UNIX/Linuxグループ名は、これらの	ツールが課す制約を受けることを、管理者は知っていなければならない。もし、	ツールが、大文字や空白文字を認めない場合、Microsoft Windows NT4/200x風の	<code class="literal">Engineering Managers</code>というグループの作成は、同名のUNIX/Linux	グループの作成が試みられることになるが、それはもちろん失敗する。	</p><p>	<a class="indexterm" name="id2608108"></a>	<a class="indexterm" name="id2608114"></a>	このOSツールの制約に対しては幾つかの回避策がある。一つはOSの制約に合うUNIX/Linux	システムグループ名を作成し、Sambaインターフェースの呼び出しには、UNIX/Linuxの	グループID(GID)を返すようなスクリプトを使う方法である。これは、動的な回避策である。	</p><p><a class="indexterm" name="id2608134"></a>	もう一つの回避策は、手動でUNIX/Linuxグループを作成し、次に手動でSamba サーバに	Microsoft Windows NT4/200xグループを作成し、そして<code class="literal">net groupmap</code>	ツールを使ってこの2つを互いに関連付けることである。	</p></div><div class="sect1" title="議論"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2608160"></a>議論</h2></div></div></div><p><a class="indexterm" name="id2608167"></a><a class="indexterm" name="id2608174"></a>	コンピュータに<span class="application">Microsoft Windows NT4/200x</span>をインストール	するとき、インストールプログラムは既定値のユーザとグループを作成し、特に、	<code class="constant">Administrators</code>グループの場合は、必須のシステムタスクを実行	するのに必要な権限をグループに付与する。例えば、ローカルマシンの日付や時間を変更	したり、ローカルマシン上の実行中のプロセスを止める(又は閉じる)ような権限である。	</p><p>	<a class="indexterm" name="id2608208"></a>	<code class="constant">Administrator</code>ユーザは<code class="constant">Administrators</code>	グループのメンバで、そのため、<code class="constant">Administrators</code>グループの	権限を引き継ぐ。もし、<code class="constant">joe</code>というユーザが	<code class="constant">Administrators</code>グループのメンバとして作成された場合、	<code class="constant">joe</code>は<code class="constant">Administrator</code>というユーザと	全く同じ権限を持つ。	</p><p><a class="indexterm" name="id2608249"></a><a class="indexterm" name="id2608256"></a><a class="indexterm" name="id2608263"></a><a class="indexterm" name="id2608270"></a>	Microsoft Windows NT4/200x/XPマシンがドメインメンバになる場合、	PDCの<span class="quote">“<span class="quote">Domain Admins</span>”</span>グループは、ワークステーションのローカル	<code class="constant">Administrators</code>グループに追加される。	<code class="constant">Domain Admins</code>グループのいずれのメンバもワークステーション	にログオンすると、ローカルの<code class="constant">Administrators</code>グループの	権限を継承する。	</p><p><a class="indexterm" name="id2608302"></a><a class="indexterm" name="id2608309"></a>	以下のステップは、Samba PDCユーザを<code class="constant">Domain Admins</code>グループの	メンバにする方法を説明する。	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>		<code class="constant">domadm</code>と呼ばれるUNIXグループを作成(通常<code class="filename">/etc/group</code>の中に)。		</p></li><li class="listitem"><p><a class="indexterm" name="id2608348"></a>		このグループに<span class="quote">“<span class="quote">Administrators</span>”</span>にならなければならないユーザを		追加。たとえば、<code class="constant">joe, john</code>と<code class="constant">mary</code>		administratorsにしたいならば、<code class="filename">/etc/group</code>のエントリは		下記のようになる:		</p><pre class="programlisting">		domadm:x:502:joe,john,mary		</pre><p>		</p></li><li class="listitem"><p>		以下のコマンドを実行して、<span class="quote">“<span class="quote">Domain Admins</span>”</span>グループをdomadm		グループにマップする:		</p><p></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>net groupmap add ntgroup="Domain Admins" unixgroup=domadm rid=512 type=d</code></strong></pre><p>		</p><p>		<a class="indexterm" name="id2608418"></a>		<span class="quote">“<span class="quote">Domain Admins</span>”</span>の両側の引用符は、グループ名に空白があるために		必要である。また、イコール記号(=)の前後に空白を入れないこと。		</p></li></ol></div><p>	これで<code class="constant">joe, john</code>と<code class="constant">mary</code>はdomain administratorsになった。	</p><p>	<a class="indexterm" name="id2608447"></a>	任意のUNIXグループを任意のWindows NT4/200xグループにマッピングしたり、UNIX	グループをWindowsドメイングループにすることが可能である。例えば、あるUNIXグループ	(例: acct)をドメインメンバマシンのローカルファイルやプリンターのACLに含めたい場合、	以下のコマンドをSamba PDC上で実行して、そのグループをドメイングループにする:	</p><p></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>net groupmap add rid=1000 ntgroup="Accounting" unixgroup=acct type=d</code></strong></pre><p>	<code class="literal">ntgroup</code>の値は、コマンドのデリミタとして解釈されてしまうことを	防ぐために、空白が入っている場合には引用符で囲まなければならない。	</p><p><a class="indexterm" name="id2608499"></a><a class="indexterm" name="id2608506"></a>	RIDパラメーターは通常1000から始まる符号なしの32ビット整数である。しかし、このRIDは	ユーザーに割り当てられるRIDと重複してはならない。これを検証する方法は、使用して	いるpassdbバックエンドによって異なる。このツールの今後のバージョンでは自動検証が	可能になるかもしれまないが、現行では、使用者が自分でやらなければならない。	</p><div class="sect2" title="警告:ユーザ固有のグループ問題"><div class="titlepage"><div><div><h3 class="title"><a name="id2608524"></a>警告:ユーザ固有のグループ問題</h3></div></div></div><p><a class="indexterm" name="id2608532"></a><a class="indexterm" name="id2608539"></a><a class="indexterm" name="id2608546"></a>	Windowsは同じ名前のユーザとグループアカウントを許可しない。これは、プライベート	グループを使っているすべてのサイトに重大な影響がある。プライベートグループ	アカウントは、ユーザがおのおの固有のグループアカウントを持つという管理上の	設定である。Red Hat Linuxやいくつかの自由なLinuxディストリビューションでは、	既定値でプライベートグループを作成する。	</p><p><a class="indexterm" name="id2608567"></a><a class="indexterm" name="id2608574"></a>	UNIX/LinuxグループアカウントがWindowsグループアカウントにマップされた場合、	すべての競合は、任意のユーザアカウント名にWindowsドメイングループ名が	オーバラップしないことを保証することで防げる。	</p></div><div class="sect2" title="ネストされたグループ: WindowsドメイングループをWindowsローカルグループに追加"><div class="titlepage"><div><div><h3 class="title"><a name="id2608592"></a>ネストされたグループ: WindowsドメイングループをWindowsローカルグループに追加</h3></div></div></div><a class="indexterm" name="id2608600"></a><p><a class="indexterm" name="id2608611"></a>	<code class="constant">nested groups</code>として知られているこの機能は、Samba-3.0.3	で初めて追加された。	</p><p><a class="indexterm" name="id2608626"></a>	Windows NT 3.10リリース以降のすべてのMicrosoft Windows製品は、ネストされた	グループをサポートしている。セキュリティ管理をとても簡単にするので、多くの	Windowsネットワーク管理者はこの機能に依存している。	</p><p><a class="indexterm" name="id2608646"></a><a class="indexterm" name="id2608653"></a><a class="indexterm" name="id2608660"></a><a class="indexterm" name="id2608668"></a><a class="indexterm" name="id2608675"></a><a class="indexterm" name="id2608682"></a><a class="indexterm" name="id2608689"></a>	ネストされたグループアーキテクチャは、日々のユーザとグループメンバ管理をドメイン	セキュリティデータベース上で実行されるべきという理由でデザインされた。グループ	セキュリティの応用は、ローカルグループのみを使うドメインメンバサーバ上で実装	されるべきである。ドメインメンバサーバ上で、すべてのファイルシステムセキュリティ	制御は、ドメイングローバルグループとドメイングローバルユーザを含むローカル	グループの使用を制限する。	</p><p><a class="indexterm" name="id2608721"></a><a class="indexterm" name="id2608728"></a><a class="indexterm" name="id2608735"></a>	この取り決めの利便性は何か、という疑問があるかもしれない。Windowsネットワーク	アーキテクチャの深い闇を知っている人にとって、答えは明確である。20万ものファイル	があり、各ファイルは個別のドメインユーザとドメイングループに設定されているサーバ	について考えてみよう。ファイルサーバを持つ会社が別の会社を買い、その結果、サーバ	を別の場所に移動し、別のドメインのメンバにするとする。誰がすべてのファイルと	ディスクを所有すると思うか?	答えは「不明なアカウント」である。	</p><p><a class="indexterm" name="id2608769"></a><a class="indexterm" name="id2608776"></a><a class="indexterm" name="id2608783"></a><a class="indexterm" name="id2608790"></a>	ファイル所有権の混乱を解決することは、すべてのファイルとディレクトリアクセス	制御をコントロールするためにローカルグループを用いて簡単に避けられることが	できる面白くない管理業務である。この場合、ローカルグループのメンバのみが	失われる。記憶サブシステム中のファイルとディレクトリは引き続きローカル	グループによって所有される。同じことはそれらに対するすべてのACLについても	存在する。サーバがメンバとなった新しいドメイン中のドメイングローバルグループ	のための適当なエントリをもつローカルグループ内の	<code class="constant">不明なアカウント</code>メンバシップエントリを削除するのは	管理的により簡単である。	</p><p><a class="indexterm" name="id2608830"></a><a class="indexterm" name="id2608838"></a><a class="indexterm" name="id2608845"></a><a class="indexterm" name="id2608852"></a><a class="indexterm" name="id2608859"></a><a class="indexterm" name="id2608866"></a><a class="indexterm" name="id2608873"></a><a class="indexterm" name="id2608880"></a>	ネストされたグループを使用する、もう一つの突出した例は、ドメインメンバワーク	ステーションとサーバーで管理特権の実装を伴う。管理特権は各ドメインメンバマシンの	ビルトイン<code class="constant">Administrators</code>ローカルグループのすべてのメンバに	与えられる。すべてのdomain administratorsがメンバサーバまたはワークステーション	に対してとドメインの参加に対して完全な権限を持つようにするには、	<code class="constant">Domain Admins</code>グループをローカルのAdministratorsグループに	追加する。そのため、Domain Adminsグループのメンバとしてドメインにログオンする	誰もが、各ドメインメンバ上のローカル管理特権をも持つ。	</p><p><a class="indexterm" name="id2608915"></a><a class="indexterm" name="id2608923"></a><a class="indexterm" name="id2608930"></a><a class="indexterm" name="id2608936"></a>	UNIX/Linuxはネストされたグループという概念を持たないので、Sambaは長い間それを	サポートしてこなかった。問題は、<code class="filename">/etc/group</code>中の追加グループ	のメンバとしてUNIXグループを入力しなければならないことである。これは、今実装	されているUNIXファイルシステムセキュリティモデルのデザインの要求でないために	動作しない。Samba-2.2以降、winbindは、メンバであるSambaサーバのドメイン	コントローラからのユーザとグループ情報をオンデマンドで	<code class="filename">/etc/group</code>に提供出来る。	</p><p><a class="indexterm" name="id2608978"></a><a class="indexterm" name="id2608985"></a><a class="indexterm" name="id2608992"></a><a class="indexterm" name="id2608999"></a><a class="indexterm" name="id2609006"></a>	実際、Sambaは動的な<code class="literal">libnss_winbind</code>メカニズム経由で	<code class="filename">/etc/group</code>データを補完する。Samba-3.0.3から、この機能は	Windowsが行うのと同じ方式でローカルグループを提供するために使われる。これは、	アクセス時にその場でローカルグループに展開されることによって動作する。たとえば、	ドメインの<code class="constant">Domain Users</code>グループがローカルグループ	<code class="constant">demo</code>のメンバになるというようなことである。Sambaが	ローカル(alias)グループ<code class="constant">demo</code>のメンバであることを解決する	必要がある時はいつも、winbindはDomain Usersグループのdemoメンバーについて	ドメインコントローラに問い合わせる。定義によって、UNIX/Linuxグループ	<code class="constant">demo</code>のメンバであるように見せかけることが出来る、ユーザ	オブジェクトのみを含むことが出来る。	</p><p><a class="indexterm" name="id2609063"></a><a class="indexterm" name="id2609070"></a><a class="indexterm" name="id2609077"></a><a class="indexterm" name="id2609084"></a><a class="indexterm" name="id2609090"></a><a class="indexterm" name="id2609097"></a><a class="indexterm" name="id2609105"></a>	ネストされたグループを有効にするために、<code class="literal">winbindd</code>はNSS winbind	と一緒に使わなければならない。ローカルグループの作成と管理はWindowsのドメイン	ユーザマネージャかそれのSambaでの相当品、<code class="literal">net rpc group</code>	ユーティリティ経由が最適である。ローカルグループ<code class="constant">demo</code>	の作成は以下のように行う:	</p><pre class="screen">	<code class="prompt">root# </code> net rpc group add demo -L -Uroot%not24get	</pre><p><a class="indexterm" name="id2609153"></a><a class="indexterm" name="id2609160"></a>	ここで、-Lスイッチはローカルグループ作成を意味する。適切なユーザかルート権限で	正しいホストにアクセスするために、-Sと-Uスイッチの追加が必要かもしれない。	グループメンバの追加と削除は<code class="literal">net rpc group</code>コマンドの	<code class="constant">addmem</code>と<code class="constant">delmem</code>サブコマンド経由で	行える。たとえば、ローカルグループ<code class="constant">demo</code>に	<span class="quote">“<span class="quote">DOM\Domain Users</span>”</span>を追加するのは以下のように行う:	</p><pre class="screen">	net rpc group addmem demo "DOM\Domain Users"	</pre><p><a class="indexterm" name="id2609205"></a><a class="indexterm" name="id2609212"></a><a class="indexterm" name="id2609219"></a><a class="indexterm" name="id2609226"></a>	これら2つのステップを完了し、<code class="literal">getent group demo</code>を実行すると、	グループ<code class="constant">demo</code>のメンバとしてグローバルな	<code class="constant">Domain Users</code>グループのメンバとしてdemoを表示する。	これはまた、任意のローカルまたはドメインユーザでも動作する。ドメインDOMが	他のドメインを信頼している場合、信頼されたドメインに、	<code class="constant">demo</code>のメンバとしてグローバルユーザとグループを追加すること	も可能である。<code class="constant">demo</code>グループに追加されたグループのメンバで	ある他のドメインからのユーザはローカルドメインユーザが持つのと同じアクセス許可を	持つことになる。	</p></div><div class="sect2" title="管理に関する重要な情報"><div class="titlepage"><div><div><h3 class="title"><a name="id2609268"></a>管理に関する重要な情報</h3></div></div></div><p>	管理者権限は以下の二つの用途に対して必要である:	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Samba-3のドメインコントローラ、ドメインメンバサーバ及びクライアントのため。</p></li><li class="listitem"><p>Windowsのドメインメンバワークステーション管理のため。</p></li></ol></div><p><a class="indexterm" name="id2609305"></a><a class="indexterm" name="id2609312"></a><a class="indexterm" name="id2609319"></a>	Samba 3.0.10までのバージョンは、Windowsドメインメンバークライアントマシンから	システム管理作業のために必要である権利と特権を割り当てる機能は提供しない。その	ため、ユーザの追加、削除とユーザとグループ情報の変更と、ワークステーションの	ドメインメンバシップ管理のような管理作業はroot以外のどのようなアカウントでも	扱える。	</p><p><a class="indexterm" name="id2609340"></a><a class="indexterm" name="id2609347"></a><a class="indexterm" name="id2609354"></a>	Samba-3.0.11から、管理作業を非root(すなわち、Microsoft Windows Administratorと	同等以外のアカウント)に委譲できる新しい特権管理インタフェースが含まれるように	なった(<a class="link" href="rights.html" title="Chapter 15. User Rights and Privileges">ユーザの権限と権利</a>を参照)。	</p><p><a class="indexterm" name="id2609379"></a><a class="indexterm" name="id2609386"></a>	Windowsドメインメンバワークステーション上の管理作業は<code class="constant">Domain Admins</code>	グループのメンバの誰かによって行える。このグループは任意の適切なUNIXグループに	マップできる。	</p><div class="sect3" title="3.0.11より前のバージョンのみに適用"><div class="titlepage"><div><div><h4 class="title"><a name="id2609405"></a>3.0.11より前のバージョンのみに適用</h4></div></div></div><p><a class="indexterm" name="id2609414"></a>	ユーザの追加削除のようなUNIX/Linux上の管理作業は<code class="constant">root</code>と	同等の権限が必要である。Samba のドメインに対するWindowsクライアントの追加は、	Windows クライアントに対するユーザアカウントの追加が含まれる。	</p><p><a class="indexterm" name="id2609434"></a><a class="indexterm" name="id2609441"></a>	多くのUNIX管理者がSamba Teamに対して<code class="constant">root</code>の権限を持たなくても	Windowsクライアントの追加、ユーザの追加、変更、削除ができるようにしてほしいという	要望を寄せ続けている。このような要望はUNIXシステムの基本的なセキュリティの観念と	接触するものある。	</p><p><a class="indexterm" name="id2609466"></a><a class="indexterm" name="id2609473"></a><a class="indexterm" name="id2609480"></a><a class="indexterm" name="id2609487"></a><a class="indexterm" name="id2609495"></a><a class="indexterm" name="id2609502"></a>	<code class="constant">root</code>レベルの権限を与えずにUNIX/Linuxシステムに対してアクセス	する安全な方法はない。<code class="constant">root</code>権限は、ドメインに	<code class="constant">root</code>ユーザでログインするか、ある特定のユーザを、	<code class="filename">/etc/passwd</code>データベースの中にUID=0とすることで可能となる。	それらの ユーザは、NT4 のドメインユーザマネージャやドメインサーバマネージャ	などのツールを使用してユーザやグループに加えドメインメンバサーバやクライアント	アカウントの管理ができる。また、このレベルの権限が、共有レベルのACL管理には	必要である。	</p></div></div><div class="sect2" title="既定値のユーザ、グループと相対識別子"><div class="titlepage"><div><div><h3 class="title"><a name="id2609547"></a>既定値のユーザ、グループと相対識別子</h3></div></div></div><p>	<a class="indexterm" name="id2609555"></a>	<a class="indexterm" name="id2609564"></a><a class="indexterm" name="id2609571"></a><a class="indexterm" name="id2609578"></a><a class="indexterm" name="id2609585"></a><a class="indexterm" name="id2609592"></a><a class="indexterm" name="id2609599"></a><a class="indexterm" name="id2609606"></a>	インストール直後、Windows NT4/200x/XPは特定のユーザ、グループ及び別名のエントリ	が事前に設定される。それらはよく知られている相対識別子(RID)を持つ。これらは	運用の継続的な整合性のために維持しなければならない。Sambaは必須のドメイン	グループを持たなければならず、それらのグループは適切なRID値を必要とするSamba-3	が<code class="constant">tdbsam</code>を使用するよう設定されていると、必須のドメイン	グループは自動的に作成される。その既定値のNTグループを作成(準備)するのはLDAP	管理者の責任である。	</p><p><a class="indexterm" name="id2609633"></a><a class="indexterm" name="id2609640"></a><a class="indexterm" name="id2609648"></a><a class="indexterm" name="id2609654"></a>	必須のドメイングループには良く知られているRIDを割り当てなければならない。既定値の	ユーザ、グループ、別名とRIDは	<a class="link" href="groupmapping.html#WKURIDS" title="Table 12.1. よく知られているユーザのRID既定値">よく知られているユーザのRID既定値</a>を参照のこと。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2609680"></a><a class="indexterm" name="id2609687"></a><a class="indexterm" name="id2609694"></a><a class="indexterm" name="id2609700"></a><a class="indexterm" name="id2609707"></a>	必須のドメイングループ作成と、それに既定値のRIDを割り当てるのは管理者の責任である。	</p></div><p><a class="indexterm" name="id2609722"></a><a class="indexterm" name="id2609729"></a>	他にも必要なドメイングループを作成することは問題ありませんが、必須のドメイン	グループ(良く知られているもの)が作成済みで、既定値のRIDが割り当てられている	ことを確認すること。作成する他のグループには任意のRIDを割り当てることができる。	</p><p>	各ドメイングループをUNIXシステムグループにマッピングすること。それが、これらの	グループをNTドメイングループとして使用できる唯一の方法である。	</p><p>	</p><div class="table"><a name="WKURIDS"></a><p class="title"><b>Table 12.1. よく知られているユーザのRID既定値</b></p><div class="table-contents"><table summary="よく知られているユーザのRID既定値" border="1"><colgroup><col align="left"><col align="left"><col align="left"><col align="center"></colgroup><thead><tr><th align="left">よく知られているエントリ</th><th align="left">RID</th><th align="left">タイプ</th><th align="center">必須</th></tr></thead><tbody><tr><td align="left">Domain Administrator</td><td align="left">500</td><td align="left">User</td><td align="center">No</td></tr><tr><td align="left">Domain Guest</td><td align="left">501</td><td align="left">User</td><td align="center">No</td></tr><tr><td align="left">Domain KRBTGT</td><td align="left">502</td><td align="left">User</td><td align="center">No</td></tr><tr><td align="left">Domain Admins</td><td align="left">512</td><td align="left">Group</td><td align="center">Yes</td></tr><tr><td align="left">Domain Users</td><td align="left">513</td><td align="left">Group</td><td align="center">Yes</td></tr><tr><td align="left">Domain Guests</td><td align="left">514</td><td align="left">Group</td><td align="center">Yes</td></tr><tr><td align="left">Domain Computers</td><td align="left">515</td><td align="left">Group</td><td align="center">No</td></tr><tr><td align="left">Domain Controllers</td><td align="left">516</td><td align="left">Group</td><td align="center">No</td></tr><tr><td align="left">Domain Certificate Admins</td><td align="left">517</td><td align="left">Group</td><td align="center">No</td></tr><tr><td align="left">Domain Schema Admins</td><td align="left">518</td><td align="left">Group</td><td align="center">No</td></tr><tr><td align="left">Domain Enterprise Admins</td><td align="left">519</td><td align="left">Group</td><td align="center">No</td></tr><tr><td align="left">Domain Policy Admins</td><td align="left">520</td><td align="left">Group</td><td align="center">No</td></tr><tr><td align="left">Builtin Admins</td><td align="left">544</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin users</td><td align="left">545</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin Guests</td><td align="left">546</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin Power Users</td><td align="left">547</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin Account Operators</td><td align="left">548</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin System Operators</td><td align="left">549</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin Print Operators</td><td align="left">550</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin Backup Operators</td><td align="left">551</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin Replicator</td><td align="left">552</td><td align="left">Alias</td><td align="center">No</td></tr><tr><td align="left">Builtin RAS Servers</td><td align="left">553</td><td align="left">Alias</td><td align="center">No</td></tr></tbody></table></div></div><p><br class="table-break">	</p></div><div class="sect2" title="設定例"><div class="titlepage"><div><div><h3 class="title"><a name="id2610196"></a>設定例</h3></div></div></div><p><a class="indexterm" name="id2610204"></a>		<code class="literal">net groupmap list</code>を実行することでマッピングデータ		ベース中の種々のグループを表示出来る。以下が例である:		</p><p><a class="indexterm" name="id2610226"></a></p><pre class="screen"><code class="prompt">root# </code> <strong class="userinput"><code>net groupmap list</code></strong>Domain Admins (S-1-5-21-2547222302-1596225915-2414751004-512) -> domadminDomain Users (S-1-5-21-2547222302-1596225915-2414751004-513) -> domuserDomain Guests (S-1-5-21-2547222302-1596225915-2414751004-514) -> domguest</pre><p>		</p><p>		<code class="literal">net groupmap</code>の完全な詳細は、net(8)のマニュアルを参照のこと。		</p></div></div><div class="sect1" title="設定スクリプト"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2610273"></a>設定スクリプト</h2></div></div></div><p>	誰もがツールを必要とする。自分のツールを作ることが好きな人もいれば、既成のツール	(汎用に誰かが作成したもの)を好む人もいる。	</p><div class="sect2" title="smb.confにグループを追加するスクリプト例"><div class="titlepage"><div><div><h3 class="title"><a name="id2610288"></a><code class="filename">smb.conf</code>にグループを追加するスクリプト例</h3></div></div></div><p>		<a class="indexterm" name="id2610302"></a>		<a class="indexterm" name="id2610308"></a>		<a class="indexterm" name="id2610316"></a><a class="indexterm" name="id2610322"></a><a class="indexterm" name="id2610329"></a>		Sambaのグループインタフェースで使用するグループ名を作成するスクリプトは		<a class="link" href="groupmapping.html#smbgrpadd.sh" title="Example 12.1. smbgrpadd.sh">smbgrpadd.sh</a>で提供されている。		このスクリプトは一時的なエントリを<code class="filename">/etc/group</code>		ファイルに追加し、指定された名前に改名する。これは、いくつかの		バージョンの<code class="literal">groupadd</code>ツールに存在する、OS管理ツールの		制限を避ける方法の例である。</p><div class="example"><a name="smbgrpadd.sh"></a><p class="title"><b>Example 12.1. smbgrpadd.sh</b></p><div class="example-contents"><pre class="programlisting">#!/bin/bash# 通常のgroupaddツールを使ってのグループ追加。groupadd smbtmpgrp00thegid=`cat /etc/group | grep ^smbtmpgrp00 | cut -d ":" -f3`# 次にMicrosoft Windowsネットワーク用に使いたい名前に変更。cp /etc/group /etc/group.bakcat /etc/group.bak | sed "s/^smbtmpgrp00/$1/g" > /etc/grouprm /etc/group.bak# 通常のようにGIDを返す。echo $thegidexit 0</pre></div></div><p><br class="example-break"></p><p>		<a class="link" href="groupmapping.html#smbgrpadd" title="Example 12.2. グループ追加スクリプトのためのsmb.confエントリの設定">グループ追加スクリプトのための<code class="filename">smb.conf</code>エントリの設定</a>		中に示している上記のスクリプトのための<code class="filename">smb.conf</code>エントリは、どのように動くかを		デモする。</p><div class="example"><a name="smbgrpadd"></a><p class="title"><b>Example 12.2. グループ追加スクリプトのための<code class="filename">smb.conf</code>エントリの設定</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2610452"></a><em class="parameter"><code>add group script = /path_to_tool/smbgrpadd.sh "%g"</code></em></td></tr></table></div></div><p><br class="example-break">		</p></div><div class="sect2" title="グループマッピング設定のためのスクリプト"><div class="titlepage"><div><div><h3 class="title"><a name="id2610467"></a>グループマッピング設定のためのスクリプト</h3></div></div></div><p><a class="indexterm" name="id2610476"></a>	上記の例では、<code class="literal">ntadmin</code>と呼ばれるUNIX/Linuxグループを作成した。	このスクリプトで、<code class="literal">Orks</code>, <code class="literal">Elves</code>と	<code class="literal">Gnomes</code>という追加のグループも作成することにする。	後でマッピングデータベースを再作成する必要がある場合に備え、このシェルスクリプト	を保存することを推奨する。便宜上、<code class="filename">initGroups.sh</code>という	ファイル名で保存する。このスクリプトは	<a class="link" href="groupmapping.html#set-group-map" title="Example 12.3. Script to Set Group Mapping">intGroups.sh</a>で提供されている。<a class="indexterm" name="id2610529"></a></p><div class="example"><a name="set-group-map"></a><p class="title"><b>Example 12.3. Script to Set Group Mapping</b></p><div class="example-contents"><pre class="programlisting">#!/bin/bashnet groupmap add ntgroup="Domain Admins" unixgroup=ntadmin rid=512 type=dnet groupmap add ntgroup="Domain Users" unixgroup=users rid=513 type=dnet groupmap add ntgroup="Domain Guests" unixgroup=nobody rid=514 type=dgroupadd Orksgroupadd Elvesgroupadd Gnomesnet groupmap add ntgroup="Orks"   unixgroup=Orks   type=dnet groupmap add ntgroup="Elves"  unixgroup=Elves  type=dnet groupmap add ntgroup="Gnomes" unixgroup=Gnomes type=d</pre></div></div><p><br class="example-break">	</p><p>	もちろん、必要に合わせて管理者がこれを編集することを想定している。	<code class="literal">net groupmap</code>ツールの使用方法の詳細についてはマニュアル	ページを参照のこと。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	Sambaのバージョン3.0.23未満では、	<code class="literal">Domain Admins, Domain Users</code>と<code class="literal">Domain Guests</code>	Windowsグループに対する既定値のグループマッピングを自動的に生成する。しかし、	UNIX GIDへのマップは行わない。これは管理者の混乱と障害を引き起こす。Samba-3.0.23	以降はこの異常は修正された。そのため、Windowsグループは、手動かつ明示的にSamba	管理者によって有効なUNIX GIDへのマップの作成とマッピングを行わなければならない。	</p></div></div></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2610606"></a>よくあるエラー</h2></div></div></div><p>この時点で、油断していると管理者はいろいろな細かいことにびっくりされられることになる。現実問題として、自動の制御スクリプトの全ステップを本番環境に移す前には、注意深く手動でテストしなければならない。</p><div class="sect2" title="グループの追加が失敗する"><div class="titlepage"><div><div><h3 class="title"><a name="id2610625"></a>グループの追加が失敗する</h3></div></div></div><p><a class="indexterm" name="id2610633"></a>		これはSambaインタフェーススクリプトが<code class="filename">smb.conf</code>ファイル中の		<a class="link" href="smb.conf.5.html#ADDGROUPSCRIPT" target="_top">add group script</a>として直接		<code class="literal">groupadd</code>呼んだ時によくある問題である。		</p><p><a class="indexterm" name="id2610671"></a><a class="indexterm" name="id2610678"></a>		もっともよくある失敗の原因は、名前に大文字かつまたはスペースを含む		Microsoft Windows グループアカウントを追加しようとしたということである。		</p><p><a class="indexterm" name="id2610695"></a>		これには 3 つの回避策がある。一つ目は、UNIX/Linuxの<code class="literal">groupadd</code>		システムツールの制約に沿うグループ名のみを使用することである。二つ目は、		この章で先に言及したスクリプトを使用することである。三つ目は、		Microsoft Windowsグループ名に代わるUNIX/Linuxグループアカウントを手動で作成し、		上で説明した手順でそのグループをMicrosoft Windows グループにマッピングする		という方法である。		</p></div><div class="sect2" title="ワークステーションのPower UsersグループへのDomain Usersの追加"><div class="titlepage"><div><div><h3 class="title"><a name="id2610723"></a>ワークステーションのPower UsersグループへのDomain Usersの追加</h3></div></div></div><p><span class="quote">“<span class="quote">		domain usersをPower Usersグループに追加するにはどうすればいいですか?		</span>”</span></p><p><a class="indexterm" name="id2610739"></a>		Power Usersグループは各Windows 200x/XP Professionalワークステーションの		ローカルグループである。Domain Usersグループは自動でPower Usersグループに		追加することはできない。ローカルマシンに<span class="emphasis"><em>administrator</em></span>		としてローカルワークステーションにログオンすることで、各ワークステーション		でこの作業を行わなければならず、その後以下の手続きを行う:		</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>			Click <span class="guimenu">スタート -> コントロールパネル -> ユーザとパスワードをクリック。</span>			</p></li><li class="step" title="Step 2"><p>			<span class="guimenuitem">詳細</span>タブをクリック。			</p></li><li class="step" title="Step 3"><p>			<span class="guibutton">詳細</span>ボタンをクリック。			</p></li><li class="step" title="Step 4"><p>			<code class="constant">グループ</code>をクリック。			</p></li><li class="step" title="Step 5"><p>			<code class="constant">Power Users</code>をダブルクリック。この作業後、ローカル			マシンの<code class="constant">Power Users</code>グループにユーザとグループを			追加するパネルが起動する。			</p></li><li class="step" title="Step 6"><p>			<span class="guibutton">追加</span>ボタンをクリック。			</p></li><li class="step" title="Step 7"><p>			<code class="constant">Domain Users</code>グループに追加するドメインを選択。			</p></li><li class="step" title="Step 8"><p>			<code class="constant">Domain Users</code>グループをダブルクリック。			</p></li><li class="step" title="Step 9"><p>			<span class="guibutton">OK</span>ボタンをクリック。この作業中にログオン			ボックスが表示されたならば、 接続するために			<code class="constant">DOMAIN\UserName</code>を入力することを忘れないこと。			すなわち、ドメイン<code class="constant">MIDEARTH</code>とユーザ			<code class="constant">root</code>を<code class="constant">MIDEARTH\root</code>として入力する。			</p></li></ol></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="passdb.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="NetCommand.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 11. アカウント情報データベース </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 13. リモートとローカル管理:Netコマンド</td></tr></table></div></body></html>