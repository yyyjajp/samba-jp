<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 21. 旧式の印刷サポート</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="msdfs.html" title="Chapter 20. Microsoft 分散ファイルシステムツリーのホスティング"><link rel="next" href="CUPS-printing.html" title="Chapter 22. CUPS印刷環境のサポート"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 21. 旧式の印刷サポート</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="msdfs.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="CUPS-printing.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 21. 旧式の印刷サポート"><div class="titlepage"><div><div><h2 class="title"><a name="classicalprinting"></a>Chapter 21. 旧式の印刷サポート</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Kurt</span> <span class="surname">Pfeifle</span></h3><div class="affiliation"><span class="orgname">Danka Deutschland GmbH<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:kpfeifle@danka.de">kpfeifle@danka.de</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Gerald</span> <span class="othername">(Jerry)</span> <span class="surname">Carter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jerry@samba.org">jerry@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">May 31, 2003</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="classicalprinting.html#id2637716">機能と利便性</a></span></dt><dt><span class="sect1"><a href="classicalprinting.html#id2637991">技術的な序論</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2638173">クライアントからSambaへの印刷ジョブの処理</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2638247">印刷に関連する設定パラメータ</a></span></dt></dl></dd><dt><span class="sect1"><a href="classicalprinting.html#id2638362">簡単な印刷設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2638672"><code class="literal">testparm</code>による設定の検査</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2638882">手っ取り早い設定の検証</a></span></dt></dl></dd><dt><span class="sect1"><a href="classicalprinting.html#id2639311">拡張印刷設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2639786">設定の説明詳細</a></span></dt></dl></dd><dt><span class="sect1"><a href="classicalprinting.html#cups-msrpc">Samba-2.2からの印刷環境</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2642751">Sambaサーバ上でのポイントアンドプリントによるクライアントドライバ</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2642957">無効になった [printer$]セクション</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2643092">[print$]共有の作成</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2643333">[print$]セクションのパラメータ</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2643713">[print$]共有ディレクトリ</a></span></dt></dl></dd><dt><span class="sect1"><a href="classicalprinting.html#id2643877">[print$]へのドライバのインストール</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2643992">プリンタの追加ウィザードによるドライバのインストール</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#inst-rpc"><code class="literal">rpcclient</code>を使った印刷ドライバのインストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="classicalprinting.html#id2646144">クライアントドライバのインストール方法</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2646162">最初のクライアントドライバインストール</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#prt-modeset">新しいプリンタに対するデバイスモードの設定</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2646848">追加のクライアントドライバインストール</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2646977">常時最初のクライアントからの接続はrootか<span class="quote">“<span class="quote">printer admin</span>”</span>で行う</a></span></dt></dl></dd><dt><span class="sect1"><a href="classicalprinting.html#id2647170">その他のテクニック</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2647194">クライアントドライバのための既定値の印刷操作の設定</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2647609">大量のプリンタのサポート</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2647878">Windows NT APWによる新しいプリンタの追加</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2648170">エラーメッセージ: <span class="quote">“<span class="quote">異なった名前で接続できない</span>”</span></a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2648304">ドライバファイルを集めるときに気をつけること</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2648598">Sambaとプリンタポート</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2648733">共通クライアントドライバの間違った設定の防止</a></span></dt></dl></dd><dt><span class="sect1"><a href="classicalprinting.html#id2648777">Imprintsツールセット</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2648847">Imprintsとは何か?</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2648893">プリンタドライバパッケージの作成</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2648914">Imprintsサーバ</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2648934">クライアントのインストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="classicalprinting.html#id2649115">ユーザによるインストールなしにネットワークプリンタを追加する</a></span></dt><dt><span class="sect1"><a href="classicalprinting.html#id2649468"><code class="literal">addprinter</code>コマンド</a></span></dt><dt><span class="sect1"><a href="classicalprinting.html#id2649519">旧式の印刷システムの、Sambaへの移行</a></span></dt><dt><span class="sect1"><a href="classicalprinting.html#id2649700">Active DirectoryかLDAPへのプリンタ情報の公開</a></span></dt><dt><span class="sect1"><a href="classicalprinting.html#id2649731">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="classicalprinting.html#id2649737">rootパスワードを指定したが、アクセスできない</a></span></dt><dt><span class="sect2"><a href="classicalprinting.html#id2649789">印刷ジョブはスプールディレクトリに入ったが、その後なくなった</a></span></dt></dl></dd></dl></div><div class="sect1" title="機能と利便性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2637716"></a>機能と利便性</h2></div></div></div><p><a class="indexterm" name="id2637724"></a>印刷はユーザに取ってしばしばミッションクリティカルなサービスである。Sambaは、Windows ワークステーションからなるクライアントネットワークのために、信頼性があり、シームレスなこのサービスを提供出来る。</p><p><a class="indexterm" name="id2637744"></a><a class="indexterm" name="id2637751"></a><a class="indexterm" name="id2637758"></a><a class="indexterm" name="id2637765"></a><a class="indexterm" name="id2637772"></a><a class="indexterm" name="id2637779"></a><a class="indexterm" name="id2637786"></a><a class="indexterm" name="id2637793"></a><a class="indexterm" name="id2637800"></a><a class="indexterm" name="id2637807"></a><a class="indexterm" name="id2637814"></a><a class="indexterm" name="id2637822"></a><a class="indexterm" name="id2637829"></a><a class="indexterm" name="id2637836"></a>Samba印刷サービスは、ファイルサービス機能と並列に、あるいは専用のサーバ上で、スタンドアロンかドメインメンバサーバで動かす事が出来る。これは、必要に応じて強力に、あるいは比較的穏やかにセキュアにすることが出来る。設定は簡単になることも複雑になることもある。有効な認証スキームは、以前の章にあるようなファイルサービス用に説明されたのと基本的に同じである。全体的に、現在、Sambaの印刷サポートは、多くの場合、付加機能を付けた上で、Windows NTまたはWindows2000印刷サーバと完全に対等で、置き換えることが出来る。クライアントはクライアント上でなじみのある<code class="literal">ポイント アンド プリント</code>メカニズムを通して、ドライバをダウンロードし、プリンタをインストールできる。<code class="literal">ログオンスクリプト</code>で実行されるプリンタのインストールは何の問題もない。管理者はおなじみの<code class="literal">プリンタ追加ウィザード</code>を使ってクライアントで使うことによって、ドライバのアップロードと管理ができる。更に追加の便利な機能としては、ドライバとプリンタ管理はコマンド行かスクリプトを通して実行でき、これは、大量のプリンタがある場合により効率的である。もしも、集中した印刷ジョブの利用状況管理(訳注:原文はaccount)(すべての単一ページの追跡といろいろな統計レポートに生データを供給すること)が必要とされる場合、この機能は、Sambaサーバ下の印刷サブシステムとして、新しい共通UNIX印刷システム(CUPS)によって最もよくサポートされている。</p><p><a class="indexterm" name="id2637920"></a><a class="indexterm" name="id2637926"></a>この章では、より現代的なUNIXのBSDとSystem V形式の印刷システムによって実装された、Sambaの印刷機能の基礎を概観する。この章中の情報の大多数はCUPSにも適用出来る。もしもCUPSを使っているならば、次の章に飛んでも良いが、すべきことのうち少なくともいくつかはきっと取りこぼすだろう。さらなる情報は、<a class="link" href="CUPS-printing.html" title="Chapter 22. CUPS印刷環境のサポート">CUPS 印刷環境</a>を参照のこと。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2637957"></a><a class="indexterm" name="id2637964"></a><a class="indexterm" name="id2637971"></a>ほとんどの以下の例はWindows XP Professionalクライアントで評価されている。この文書でコマンドを発行した結果を記述しているところは、Windows 200x/XPクライアントでほとんど同じだが詳細では多少違っている事を心に留めておくこと。Windows NT4は更に多少異なる。</p></div></div><div class="sect1" title="技術的な序論"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2637991"></a>技術的な序論</h2></div></div></div><p><a class="indexterm" name="id2637999"></a><a class="indexterm" name="id2638006"></a><a class="indexterm" name="id2638013"></a>Sambaの印刷サポートは、常時それが動作しているUNIX OS上の、インストールされている印刷サブシステム上に依存している。Sambaは<code class="literal">仲介者</code>である。Windows(か他のSMB)クライアントから印刷ファイルを受け取り、それをさらなる処理のために実際の印刷システムに渡す。そのため、両方に接続する必要がある。すなわち、Windows印刷クライアントとUNIX印刷システムである。それゆえ、異なった機能と異なった形でアクセスされる、種々のUNIX印刷サブシステムと同様、おのおのが異なって振る舞う種々のクライアントOSの間での違いを認める必要がある。</p><p><a class="indexterm" name="id2638053"></a><a class="indexterm" name="id2638060"></a>この章では伝統的なUNIX印刷方式について取り扱う。次の章では、より最新のCUPSについて、より詳しく説明する。</p><div class="important" title="Important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p><a class="indexterm" name="id2638077"></a>CUPSユーザに注意:次の章まで飛ばないこと。ここのみで説明がある重要な情報を読み飛ばすことになる!</p></div><p><a class="indexterm" name="id2638092"></a><a class="indexterm" name="id2638099"></a><a class="indexterm" name="id2638106"></a><a class="indexterm" name="id2638112"></a>現在、Samba管理の側面において、最も問題があることの一つは印刷の設定であることは、Sambaメーリングリスト上で投稿されたことでも明らかである。多くの新しいSamba管理者は、Sambaがある種の印刷処理を実行しているというような印象を持っている。保証するが、Sambaは何らの印刷処理をも実行しない。何らの印刷フィルタリングも行わない。</p><p><a class="indexterm" name="id2638133"></a><a class="indexterm" name="id2638140"></a><a class="indexterm" name="id2638147"></a><a class="indexterm" name="id2638154"></a>Sambaは、ローカルスプール領域にスプールされる、クライアントからデータストリーム(印刷ジョブ)を受け取る。印刷ジョブ全部を受け取ると、SambaはローカルのUNIX/Linux印刷コマンドを起動し、それに対してスプールされたファイルを渡す。それはローカルの印刷サブシステムを起動し、正しく印刷ジョブを処理し、プリンタに対してデータを渡す。</p><div class="sect2" title="クライアントからSambaへの印刷ジョブの処理"><div class="titlepage"><div><div><h3 class="title"><a name="id2638173"></a>クライアントからSambaへの印刷ジョブの処理</h3></div></div></div><p>Sambaサーバ経由でWindowsクライアントからUNIXプリンタへの印刷がうまくいくためには、6つ(潜在的には7つ)のステージがある:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>プリンタ共有に対してWindowsがコネクションをオープンする。</p></li><li class="listitem"><p>Sambaはユーザを認証しなければならない。</p></li><li class="listitem"><p>Windowsがネットワーク経由でSambaのスプール領域に印刷ファイルの	コピーを送る。</p></li><li class="listitem"><p>Windowsはコネクションをクローズする。</p></li><li class="listitem"><p>Sambaは、UNIX印刷サブシステムの印刷領域経由でファイルを扱う	ために印刷コマンドを起動する。</p></li><li class="listitem"><p>UNIX印刷サブシステムが印刷ジョブを処理する。</p></li><li class="listitem"><p>印刷ファイルはSambaスプール領域から明示的に削除される必要がある。	これの要素は使用しているマシンのプリントスプーラの構成の設定に依存する。	</p></li></ol></div></div><div class="sect2" title="印刷に関連する設定パラメータ"><div class="titlepage"><div><div><h3 class="title"><a name="id2638247"></a>印刷に関連する設定パラメータ</h3></div></div></div><p><a class="indexterm" name="id2638255"></a><a class="indexterm" name="id2638262"></a><a class="indexterm" name="id2638269"></a>Sambaの印刷動作を制御するための設定パラメータは多数ある。それらの概要については<code class="filename">smb.conf</code>のマニュアルページを参照してほしい。他のパラメータと同様、グローバルレベル(一覧上で<span class="emphasis"><em>G</em></span>とタグが付いているもの)とサービスレベル(<span class="emphasis"><em>S</em></span>)パラメータがある。</p><div class="variablelist"><dl><dt><span class="term">グローバルパラメータ</span></dt><dd><p>これらは明示的に共有定義に<span class="emphasis"><em>記述しなくても良い</em></span>。		もしもエラーになったならば、(もしも動作させたならば)<code class="literal">testparm</code>		ユーティリティでそれを見つけることが出来、そのことを表示する。		</p></dd><dt><span class="term">サービスレベルパラメータ</span></dt><dd><p>これらは<code class="filename">smb.conf</code>中の<em class="parameter"><code>[global]</code></em>		セクションで指定しても良い。この場合、個人毎すべてかサービスレベルの		共有の既定値の動作を定義する(同じパラメータに対して異なった設定の定義を		を持たない形で提供されるので、グローバルの既定値を上書きする)。		</p></dd></dl></div></div></div><div class="sect1" title="簡単な印刷設定"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2638362"></a>簡単な印刷設定</h2></div></div></div><p><a class="indexterm" name="id2638370"></a><a class="indexterm" name="id2638377"></a><a class="indexterm" name="id2638384"></a><a class="indexterm" name="id2638392"></a><a class="link" href="classicalprinting.html#simpleprc" title="Example 21.1. BSD印刷環境での簡単な設定">BSD印刷環境での簡単な設定</a>は、簡単な印刷の設定を示している。もしも現在使っている環境と比較して、OSベンダによってあらかじめ設定されている追加のパラメータを見つけるかもしれない。以下は、パラメータについての議論と説明である。この例は多くのパラメータを使っていない。しかし、多くの環境において、すべてのクライアントに対して印刷を有効にする有効な<code class="filename">smb.conf</code>ファイルを提供するためには、これは十分である。</p><div class="example"><a name="simpleprc"></a><p class="title"><b>Example 21.1. BSD印刷環境での簡単な設定</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2638455"></a><em class="parameter"><code>printing = bsd</code></em></td></tr><tr><td><a class="indexterm" name="id2638467"></a><em class="parameter"><code>load printers = yes</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[printers]</code></em></td></tr><tr><td><a class="indexterm" name="id2638487"></a><em class="parameter"><code>path = /var/spool/samba</code></em></td></tr><tr><td><a class="indexterm" name="id2638499"></a><em class="parameter"><code>printable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2638511"></a><em class="parameter"><code>public = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2638522"></a><em class="parameter"><code>writable = no</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2638537"></a><a class="indexterm" name="id2638544"></a><a class="indexterm" name="id2638551"></a>これは単に例としての設定である。Sambaはすべての設定パラメータに対して既定値を割り当てている。既定値は保守的でかつ賢明な値となっている。パラメータが<code class="filename">smb.conf</code>ファイル中で指定されたならば、それは既定値を上書きする。rootで<code class="literal">testparm</code>ユーティリティを実行すると、<code class="filename">smb.conf</code>ファイルの設定のように両方の既定値とすべての設定を報告する機能がある。<code class="literal">Testparm</code>は間違った設定のすべてに対して警告を表示する。完全な出力は360行を軽く超えるので、その結果をページャプログラムに渡しても良いだろう。</p><p>  <a class="indexterm" name="id2638600"></a><a class="indexterm" name="id2638607"></a><a class="indexterm" name="id2638614"></a>設定ファイルの文法は理解するのが簡単である。その文法について細かいことを知らなくてもよい。この文書のどこかで説明されているが、Sambaはある種の綴りミスには寛容であり(たとえば、<a class="link" href="smb.conf.5.html#BROWSABLE" target="_top">browsable</a>の代わりに<a class="link" href="smb.conf.5.html#BROWSEABLE" target="_top">browseable</a>など)、綴りは大文字小文字を無視する。論理値に対して、<em class="parameter"><code>Yes/No</code></em>か<em class="parameter"><code>True/False</code></em>を使うことも出来る。名前のリストは、カンマ、空白かタブで分離できる。</p><div class="sect2" title="testparmによる設定の検査"><div class="titlepage"><div><div><h3 class="title"><a name="id2638672"></a><code class="literal">testparm</code>による設定の検査</h3></div></div></div><p><a class="indexterm" name="id2638685"></a><a class="indexterm" name="id2638692"></a><a class="indexterm" name="id2638699"></a><a class="indexterm" name="id2638706"></a><a class="indexterm" name="id2638712"></a><a class="indexterm" name="id2638719"></a><a class="indexterm" name="id2638726"></a><a class="indexterm" name="id2638733"></a><a class="indexterm" name="id2638740"></a><a class="indexterm" name="id2638746"></a><a class="indexterm" name="id2638754"></a>暗黙で使えるものを含む、Samba中で印刷に関連したすべての(あるいはほとんど全部)を見るためには、以下で概要を説明しているコマンドを使う。このコマンドは<code class="literal">testparm</code>の出力中に現れるすべての<code class="constant">lp</code>、<code class="constant">print</code>、<code class="constant">spool</code>、<code class="constant">driver</code>,<code class="constant">ports</code>と<code class="constant">[</code>を検出する。これは、動作している<code class="literal">smbd</code>の印刷設定の簡便な概要を提供する。このコマンドは個別に作成されたプリンタ共有かそれが使えるスプールパスを表示しない。<a class="link" href="classicalprinting.html#simpleprc" title="Example 21.1. BSD印刷環境での簡単な設定">上記の例</a>で示される設定で設定したSambaの出力は以下のようになる:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>testparm -s -v | egrep "(lp|print|spool|driver|ports|\[)"</code></strong> Load smb config files from /etc/samba/smb.conf Processing section "[homes]" Processing section "[printers]"  [global]        smb ports = 139 445        lpq cache time = 10        load printers = Yes        printcap name = /etc/printcap        disable spoolss = No        enumports command =        addprinter command =         deleteprinter command =         show add printer wizard = Yes        os2 driver map =        printer admin =        min print space = 0        max print jobs = 1000        printable = No        printing = bsd        print command = lpr -r -P'%p' %s        lpq command = lpq -P'%p'        lprm command = lprm -P'%p' %j        lppause command =        lpresume command =        printer name =        use client driver = No [homes] [printers]        path = /var/spool/samba        printable = Yes</pre><p></p><p>Sambaの既定値の動作によって暗黙で追加される設定を検査するのは簡単である。<span class="emphasis"><em>確認:Sambaの将来の関係で重要かもしれない。</em></span></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Samba-3中の<code class="literal">testparm</code>は2.2.xのものとは動作が異なる。<span class="quote">“<span class="quote">-v</span>”</span>スイッチなしで使うと、実際に書かれた設定のみを表示する。使用している完全な設定を見るためにはtestparmに<span class="quote">“<span class="quote">-v</span>”</span>オプションを追加する。</p></div></div><div class="sect2" title="手っ取り早い設定の検証"><div class="titlepage"><div><div><h3 class="title"><a name="id2638882"></a>手っ取り早い設定の検証</h3></div></div></div><p> <a class="indexterm" name="id2638891"></a><a class="indexterm" name="id2638898"></a><a class="indexterm" name="id2638904"></a><a class="indexterm" name="id2638911"></a>どのようなステージでもトラブルシュートをする必要があるので、常時、最初にこの点に戻り、<code class="literal">testparm</code>が期待しているパラメータを表示するかを検査する。個人的な経験から忠告すると、<a class="link" href="smb.conf.5.html#LOADPRINTERS" target="_top">load printers</a>パラメータをコメントアウトすることを試すこと。もしも2.2.xシステムの動作が、私の環境のようであれば、以下のような表示が出る:</p><pre class="screen"><code class="prompt">root# </code>grep "load printers" /etc/samba/smb.conf        #  load printers = Yes        # This setting is commented out!! <code class="prompt">root# </code>testparm -v /etc/samba/smb.conf | egrep "(load printers)"        load printers = Yes</pre><p><a class="indexterm" name="id2638972"></a><a class="indexterm" name="id2638979"></a>この設定をコメントアウトするとSambaが自分のプリンタを公開させなくすると仮定したが、実際には引き続き公開している。理由を理解するのには時間がかかった。少なくともこれによって、もはや馬鹿にされることはない。</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>grep -A1 "load printers" /etc/samba/smb.conf</code></strong>        load printers = No        # The above setting is what I want!        #  load printers = Yes        # This setting is commented out!<code class="prompt">root# </code><strong class="userinput"><code>testparm -s -v smb.conf.simpleprinting | egrep "(load printers)"</code></strong>        load printers = No</pre><p><a class="indexterm" name="id2639030"></a>パラメータを明示的に<a class="link" href="smb.conf.5.html#LOADPRINTERS" target="_top">load printers = No</a>に設定する時にのみ、Sambaは意向にかなう。そのため、以下を強く推奨する:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>コメントアウトしたパラメータには決して頼らない。</p></li><li class="listitem"><p>常時、そう動作させたいと意図するものについては、明示的に	パラメータを設定する。</p></li><li class="listitem"><p>意向を反映しないかもしれない隠れた設定を、見える化するために	<code class="literal">testparm</code>を使う。</p></li></ul></div><p>以下は最小の設定ファイルである:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>cat /etc/samba/smb.conf-minimal</code></strong>        [printers]</pre><p><a class="indexterm" name="id2639102"></a><a class="indexterm" name="id2639109"></a>この例は、任意のSamba構成ファイルをテストするために、<code class="literal">testparm</code>を使って表示すべきである。実際、現在動いているシステム(正確に何をやっているか知っている限り)を<span class="emphasis"><em>変更しない</em></span>ことを勧める。smbd再起動後にのみ変更の影響が反映されるという仮定に頼ってはいけない!これは本当ではない。Sambaは60秒ごととクライアントからの接続時に再読込を行う。適用する事を意図しない製品のクライアントのために､変更に直面しなければならないかもしれない。そのほか、いくつかの興味深いことに注意するとよい。<code class="literal">testparm</code>は、この最低限の構成を使う時にSambaの印刷設定がどうあるかを識別するために便利である。以下では、見つけようと思っているものがある:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>testparm -v smb.conf-minimal | egrep "(print|lpq|spool|driver|ports|[)"</code></strong> Processing section "[printers]" WARNING: [printers] service MUST be printable! No path in service printers - using /tmp        lpq cache time = 10        load printers = Yes        printcap name = /etc/printcap        disable spoolss = No        enumports command =        addprinter command =        deleteprinter command =        show add printer wizard = Yes        os2 driver map =        printer admin =        min print space = 0        max print jobs = 1000        printable = No        printing = bsd        print command = lpr -r -P%p %s        lpq command = lpq -P%p        printer name =        use client driver = No [printers]        printable = Yes</pre><p><code class="literal">testparm</code>は2つの警告を表示する:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><em class="parameter"><code>[printers]</code></em>セクションが印刷可能と指定していない。</p></li><li class="listitem"><p>どのスプールディレクトリを使うかをSambaに指定していない。</p></li></ul></div><p><a class="indexterm" name="id2639213"></a><a class="indexterm" name="id2639220"></a><a class="indexterm" name="id2639226"></a><a class="indexterm" name="id2639231"></a>しかし、これは致命的ではなく、Sambaは動作するように既定値を設定する。が、この例を頼らず、使わないでほしい。これは、自分が何を要求しているかを正確にわかっている設定と注意深い設計を手助けするために用意された。使用しているシステムからの結果は、異なったコンパイル時オプションによって構築されたSambaで、いくつかのパラメータによっていろいろと変わる。<span class="emphasis"><em>警告:</em></span>有効な行の<span class="emphasis"><em>行末に</em></span>コメントサインを置いてはいけない。この場合、パラメータは無視される(行頭にコメントサインを置いたのと同じになる)。最初にこれは使用しているSambaのバージョンのバグではないかと思った。しかし、マニュアルページには明確に<code class="literal">パラメータ値の内部の空白は、正確にその通りに保持される</code>と書いてある。これは、たとえば以下のような行があると</p><table border="0" summary="Simple list" class="simplelist"><tr><td># これはLPRngを印刷システムとして定義する。</td></tr><tr><td><a class="indexterm" name="id2639284"></a><em class="parameter"><code>printing =  lprng</code></em></td></tr></table><p></p><p>定義したい値として<code class="literal">=</code>記号の後の文字列すべてを尊重する。これは、不正な値なので無視され、この場所では既定値が使われる。</p></div></div><div class="sect1" title="拡張印刷設定"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2639311"></a>拡張印刷設定</h2></div></div></div><p><a class="indexterm" name="id2639319"></a><a class="indexterm" name="id2639326"></a><a class="indexterm" name="id2639334"></a><a class="indexterm" name="id2639340"></a><a class="link" href="classicalprinting.html#extbsdpr" title="Example 21.2. 拡張BSD印刷環境設定">拡張BSD印刷環境の設定</a>は、BSD形式の印刷設定中の印刷に関連した設定のためのより詳細な設定を表示する。下記は、いろいろなパラメータの議論と説明である。昔からのUNIX/Linuxマシン上で最も一般的に使われているので、BSD形式の印刷環境を使う事をした。主に新しいシステムでは、別の章で議論されているCUPSを使うだろう。例は、既定値で設定されていないという理由で、指定するのが不要なたくさんのパラメータを明示的にリストアップする。よりスリムな<code class="filename">smb.conf</code>を使うことも、<code class="literal">testparm</code>を使う事も、既定値に設定されているすべてのパラメータを<code class="filename">smb.conf</code>から削除して最適化するために、<code class="literal">SWAT</code>を使う事もできる。</p><div class="example"><a name="extbsdpr"></a><p class="title"><b>Example 21.2. 拡張BSD印刷環境設定</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2639427"></a><em class="parameter"><code>printing = bsd</code></em></td></tr><tr><td><a class="indexterm" name="id2639438"></a><em class="parameter"><code>load printers = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2639450"></a><em class="parameter"><code>show add printer wizard = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2639462"></a><em class="parameter"><code>printcap name = /etc/printcap</code></em></td></tr><tr><td><a class="indexterm" name="id2639474"></a><em class="parameter"><code>printer admin = @ntadmin, root</code></em></td></tr><tr><td><a class="indexterm" name="id2639486"></a><em class="parameter"><code>max print jobs = 100</code></em></td></tr><tr><td><a class="indexterm" name="id2639498"></a><em class="parameter"><code>lpq cache time = 20</code></em></td></tr><tr><td><a class="indexterm" name="id2639510"></a><em class="parameter"><code>use client driver = no</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[printers]</code></em></td></tr><tr><td><a class="indexterm" name="id2639531"></a><em class="parameter"><code>comment = All Printers</code></em></td></tr><tr><td><a class="indexterm" name="id2639542"></a><em class="parameter"><code>printable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2639554"></a><em class="parameter"><code>path = /var/spool/samba</code></em></td></tr><tr><td><a class="indexterm" name="id2639566"></a><em class="parameter"><code>browseable = no</code></em></td></tr><tr><td><a class="indexterm" name="id2639577"></a><em class="parameter"><code>guest ok = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2639589"></a><em class="parameter"><code>public = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2639601"></a><em class="parameter"><code>read only = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2639612"></a><em class="parameter"><code>writable = no       </code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[my_printer_name]</code></em></td></tr><tr><td><a class="indexterm" name="id2639633"></a><em class="parameter"><code>comment = Printer with Restricted Access</code></em></td></tr><tr><td><a class="indexterm" name="id2639645"></a><em class="parameter"><code>path = /var/spool/samba_my_printer</code></em></td></tr><tr><td><a class="indexterm" name="id2639657"></a><em class="parameter"><code>printer admin = kurt</code></em></td></tr><tr><td><a class="indexterm" name="id2639669"></a><em class="parameter"><code>browseable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2639680"></a><em class="parameter"><code>printable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2639692"></a><em class="parameter"><code>writable = no</code></em></td></tr><tr><td><a class="indexterm" name="id2639704"></a><em class="parameter"><code>hosts allow = 0.0.0.0</code></em></td></tr><tr><td><a class="indexterm" name="id2639715"></a><em class="parameter"><code>hosts deny = turbo_xp, 10.160.50.23, 10.160.51.60</code></em></td></tr><tr><td><a class="indexterm" name="id2639727"></a><em class="parameter"><code>guest ok = no</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2639741"></a><a class="indexterm" name="id2639747"></a><a class="indexterm" name="id2639752"></a>これは設定の例である。OSベンダによって提供されている設定ファイル中でのすべての設定はここにはない。明示的に設定されていないSamba設定パラメータは、既定値で賢明な値に設定されている。すべての設定を見るには、<code class="constant">root</code>になり、<code class="literal">testparm</code>ユーティリティを使う。<code class="literal">testparm</code>は設定の間違いを指摘する。</p><div class="sect2" title="設定の説明詳細"><div class="titlepage"><div><div><h3 class="title"><a name="id2639786"></a>設定の説明詳細</h3></div></div></div><p>以下は<a class="link" href="classicalprinting.html#extbsdpr" title="Example 21.2. 拡張BSD印刷環境設定">拡張BSD印刷環境の設定</a>についての議論である。</p><div class="sect3" title="[global]セクション"><div class="titlepage"><div><div><h4 class="title"><a name="id2639803"></a>[global]セクション</h4></div></div></div><p><a class="indexterm" name="id2639812"></a><a class="indexterm" name="id2639818"></a><a class="indexterm" name="id2639826"></a><a class="indexterm" name="id2639833"></a><em class="parameter"><code>[global]</code></em>セクションは4つの特別なセクションの1つであり(残りは<em class="parameter"><code>[homes]</code></em>, <em class="parameter"><code>[printers]</code></em>と <em class="parameter"><code>[print$]</code></em>)、これらはサーバ全体に適用されるすべてのパラメータを含んでいる。ここにはグローバルな意味を持つパラメータのみが配置される。すべての他のセクションと共有に対しての既定値の設定を定義する、サービスレベルのパラメータを含むこともできる。この方法は設定を簡単化し、同じ値を繰り返し設定することを防ぐ(設定できる個別のセクションか共有内で行えるが、グローバルに設定した共有の設定と他の値の指定を上書きする)。</p><div class="variablelist"><dl><dt><span class="term"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = bsd </a></span></dt><dd><p><a class="indexterm" name="id2639896"></a><a class="indexterm" name="id2639903"></a><a class="indexterm" name="id2639910"></a><a class="indexterm" name="id2639917"></a><a class="indexterm" name="id2639924"></a><a class="indexterm" name="id2639930"></a><a class="indexterm" name="id2639937"></a><a class="indexterm" name="id2639944"></a><a class="indexterm" name="id2639951"></a><a class="indexterm" name="id2639957"></a><a class="indexterm" name="id2639964"></a><a class="indexterm" name="id2639971"></a>		BSD(RFC 1179形式かLPR/LPD)として知られてもいる)BSDのために適用出来る		Sambaが使う既定値の印刷コマンドを指定する。一般的に、		<em class="parameter"><code>printing</code></em>パラメータは、仮定している印刷サブシステム		をSambaに告げる。SambaはCUPS, LPD, LPRNG, SYSV, HPUX, AIX, QNXと PLPを		サポートしている。各システムは異なった<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command</a>		(と他のキュー制御コマンド)を既定値としている。		</p><div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p><a class="indexterm" name="id2640014"></a><a class="indexterm" name="id2640020"></a>		<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing</a>パラメータは通常サービスレベルの		パラメータである。<em class="parameter"><code>[global]</code></em>セクション中のここに		含まれた後、異なった設定をしていないすべてのプリンタ共有に効果が及ぶ。		Samba-3はもはやSOFTQ印刷サービスをサポートしない。		</p></div></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#LOADPRINTERS" target="_top">load printers = yes </a></span></dt><dd><p><a class="indexterm" name="id2640069"></a><a class="indexterm" name="id2640075"></a><a class="indexterm" name="id2640082"></a><a class="indexterm" name="id2640089"></a>		Sambaにすべての有効なプリンタ共有を自動的に作成させる。有効なプリンタ		共有はprintcapファイルをスキャンすることで調べる。作成されたすべての		プリンタ共有はブラウジングでも表示される。もしもこのパラメータを使う		場合、各プリンタ毎に分割する必要はない。自動的に作成されたプリンタ		共有のおのおのは、<em class="parameter"><code>[printers]</code></em>セクション中に		ある設定オプションの設定の複製である		(<em class="parameter"><code>load printers = no</code></em>の設定は、		誰でも見えて使えるようにしたくないいくつかのものをする(leaving out)、		各UNIXプリンタを指定できるようにする)。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#SHOWADDPRINTERWIZARD" target="_top">show add printer wizard = yes </a></span></dt><dd><p><a class="indexterm" name="id2640143"></a><a class="indexterm" name="id2640150"></a><a class="indexterm" name="id2640156"></a><a class="indexterm" name="id2640164"></a><a class="indexterm" name="id2640170"></a>		設定は通常既定値によって有効になっている(たとえパラメータが<code class="filename">smb.conf</code>		中で指定されていなくても)。これは、Sambaホストの共有リストの中での		<span class="guiicon">プリンタ</span>フォルダ中に		<span class="guiicon">プリンタ追加ウィザード</span>が出る原因である(		<span class="guiicon">ネットワークコンピュータ</span>か		<code class="literal">net view</code>コマンドで見られる)。これを無効にするには、		明示的に<code class="constant">no</code>と設定する必要がある(コメントアウトは		十分ではない)。<em class="parameter"><code>プリンタ追加ウィザード</code></em>は		<em class="parameter"><code>[print$]</code></em>共有にプリンタドライバをアップロード		させ、それをプリンタに関連づけるか(もしもそれぞれのキューが動作の前に		存在するならば)、以前にアップロードされたドライバとプリンタドライバを		交換する)。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#MAXPRINTJOBS" target="_top">max print jobs = 100 </a></span></dt><dd><p><a class="indexterm" name="id2640260"></a>		ある時間にSambaサーバ上で有効な印刷ジョブを最大100までに設定する。この数よりも		大きなジョブをクライアントが投稿すると、"サーバ上に容量がありません"という		エラーメッセージがSambaサーバからクライアントに返す。ゼロという設定(既定値)		は全く<span class="emphasis"><em>制限がない</em></span>事を意味する。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PRINTCAPNAME" target="_top">printcap name = /etc/printcap </a></span></dt><dd><p><a class="indexterm" name="id2640302"></a><a class="indexterm" name="id2640308"></a><a class="indexterm" name="id2640315"></a>		Sambaに有効なプリンタ名ののリストがどこにあるかを告げる。CUPSを使って		いる場合、printcapファイルが書かれているかを確認する。これは		<code class="filename">cupsd.conf</code>ファイル中の<code class="constant">Printcap</code>		ディレクティブによって制御される。	</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin = @ntadmin </a></span></dt><dd><p><a class="indexterm" name="id2640359"></a><a class="indexterm" name="id2640366"></a><a class="indexterm" name="id2640372"></a><a class="indexterm" name="id2640379"></a>		ntadminグループメンバはドライバを追加するためとプリンタプロパティを設定することが		出来るようにすべきである(<code class="constant">ntadmin</code>は単なる例としての名前で		ある。有効なUNIXグループ名が必要である)。rootは暗黙的にいつでも		<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>である。グループ名の前に付く		<code class="literal">@</code>記号は<code class="filename">/etc/group</code>中の名前である。		printer adminは、MS-RPC		(<a class="link" href="classicalprinting.html#cups-msrpc" title="Samba-2.2からの印刷環境">Samba-2.2からの印刷環境開発</a>を参照)		によって提供されるリモート管理インタフェース経由でプリンタのすべてを操作出来る。		より大きなシステムでは、<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>パラメータは		通常共有単位に存在するパラメータである。こうすると、各プリンタ共有の管理者に		異なったグループを割り当てる事ができる。	</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#LPQCACHETIME" target="_top">lpq cache time = 20 </a></span></dt><dd><p><a class="indexterm" name="id2640468"></a><a class="indexterm" name="id2640474"></a>		lpqコマンドの結果のキャッシュ時間を制御する。これは、過度にlpqコマンドが		呼ばれる事を防ぎ、高負荷のプリントサーバの負荷を減少させる。	</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#USECLIENTDRIVER" target="_top">use client driver = no </a></span></dt><dd><p><a class="indexterm" name="id2640507"></a>		もしも<code class="constant">yes</code>に設定されると、Windows NT/200x/XPクライアント		のみに(Windows 95/98/MEには関係ない)影響する。このパラメータの既定値は		<code class="constant">No</code>で(あるいは<code class="constant">False</code>)である。		これは、Sambaサーバ上で有効なドライバがインストールされているプリント共有		では(<code class="constant">yes</code>か<code class="constant">true</code>を設定して)		<span class="emphasis"><em>決して有効にしてはならない</em></span>。より詳細な説明は、		<code class="filename">smb.conf</code>マニュアルページを参照のこと。	</p></dd></dl></div></div><div class="sect3" title="[printers]セクション"><div class="titlepage"><div><div><h4 class="title"><a name="ptrsect"></a>[printers]セクション</h4></div></div></div><p><a class="indexterm" name="id2640564"></a><a class="indexterm" name="id2640572"></a>printersセクションは2つめの特別なセクションである。もしもこの名前のセクションが<code class="filename">smb.conf</code>中に現れると、Samba起動時に、printcapファイル中で見つかるすべてのプリンタ名に対してプリンタ共有を作成するので、ユーザはSambaホスト上のprintcapファイル中で定義されている任意のプリンタに接続できる。このセクションを最低の設定ですべてのプリンタを共有するための、便利なショートカットとして見なすことができる。これはまた、すべてのプリンタに対する既定値として適用すべき設定のためのコンテナでもある(より詳細は、<code class="filename">smb.conf</code>マニュアルページを参照)。この内側にあるコンテナの設定は共有レベルパラメータでなければならない。</p><div class="variablelist"><dl><dt><span class="term"><a class="link" href="smb.conf.5.html#COMMENT" target="_top">comment = All printers </a></span></dt><dd><p>		<a class="link" href="smb.conf.5.html#COMMENT" target="_top">comment</a>は、クライアントが		<span class="guiicon">ネットワークコンピュータ</span>か<code class="literal">net view</code>		コマンド経由でサーバに問い合わせた時、有効な共有一覧を表示する時に、		共有のそばに表示される。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PRINTABLE" target="_top">printable = yes </a></span></dt><dd><p>		<em class="parameter"><code>[printers]</code></em>サービスはprintableとして		<span class="emphasis"><em>定義されねばならない</em></span>。もしもそれ以外を指定すると、		smbdは起動時にロードを停止する。このパラメータは、このサービスに対して		<a class="link" href="smb.conf.5.html#PATH" target="_top">path</a>パラメータで指定したディレクトリ中に、		オープン、書き込みとスプールファイルの投稿を、接続したクライアントに		許可する。これは、ファイル共有とプリンタ共有とを区別するために、		Sambaによって使われる。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PATH" target="_top">path = /var/spool/samba </a></span></dt><dd><p>		入力された印刷ファイルをSambaによってスプールするためのディレクトリを		指定しなければならない。<span class="emphasis"><em>UNIX印刷サブシステムの設定中で指定された		スプールディレクトリと同じに設定してはならない!</em></span>パスは通常		<span class="emphasis"><em>sticky</em></span>ビットを設定した、その他に書き込み可能な		ディレクトリを指定する。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#BROWSEABLE" target="_top">browseable = no </a></span></dt><dd><p>		<a class="link" href="smb.conf.5.html#PRINTABLE" target="_top">printable = yes</a>のときは常時		<code class="constant">no</code>に設定する。これは、共有それ自身が、		<code class="literal">net view</code>コマンドか、エクスプローラのブラウズリスト		中で有効な共有の一覧中で不可視にする(もちろん個々のプリンタを見る		ことは出来る)。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#GUESTOK" target="_top">guest ok = yes </a></span></dt><dd><p>		もしも、このプリンタが<code class="constant">yes</code>に設定されているならば、		印刷サービスに接続する時にパスワードを必要としない。アクセスは、		<a class="link" href="smb.conf.5.html#GUESTACCOUNT" target="_top">guest account</a>の権限で許可される。多くのシステム		では、ゲストアカウントは"nobody"という名前にマップされる。このユーザは		通常空白のパスワード尾持つUNIXのpasswdファイルにあるが、UNIXログインは		無効である。いくつかのシステムでは、ゲストアカウントユーザは印刷権限を		持たないかもしれない。<code class="literal">su - guest</code>を使い、以下の		システムの印刷コマンドを動かし、使用するシステムのguestユーザ中で		ロギングすることでこれをテストする:		</p><p>		<strong class="userinput"><code>lpr -P printername /etc/motd</code></strong>		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PUBLIC" target="_top">public = yes </a></span></dt><dd><p>		<a class="link" href="smb.conf.5.html#GUESTOK" target="_top">guest ok = yes</a>の同義語である。		<a class="link" href="smb.conf.5.html#GUESTOK" target="_top">guest ok = yes</a>を設定すると、		これは本当にここにある必要はない(これは		<span class="quote">“<span class="quote">同じ共有に対して2つの矛盾している設定が偶然あるときはどうなるか?</span>”</span>		という興味深い質問を導く。答えはSambaが最後に見つけたものが使われる。		<code class="literal">testparm</code>は同じ共有に対して同じパラメータに対する		異なった設定に対しては注意を喚起しない。異なったユーザ名で		<em class="parameter"><code>guest account</code></em>パラメータに対して複数の行を		設定することでこれをテストでき、次にtestparmを動作させて、どの行が		Sambaによって本当に使われるかを見る事ができる)。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#READONLY" target="_top">read only = yes </a></span></dt><dd><p>		通常(共有の他のタイプのために)サービスのディレクトリ中で、ユーザによる		ファイルの作成と変更を防止する。しかし、<span class="emphasis"><em>printable</em></span>		サービス中では、<span class="emphasis"><em>常時</em></span>ディレクトリへの書き込みが許可		されるが(もしもユーザの権限として接続が許可されているならば)、		それは印刷スプール操作経由でのみである。通常の書き込み操作は許可		されない。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#WRITABLE" target="_top">writable = no </a></span></dt><dd><p>		これは<a class="link" href="smb.conf.5.html#READONLY" target="_top">read only = yes</a>の同義語である。		</p></dd></dl></div></div><div class="sect3" title="任意の[my_printer_name]セクション"><div class="titlepage"><div><div><h4 class="title"><a name="id2640995"></a>任意の[my_printer_name]セクション</h4></div></div></div><p><a class="indexterm" name="id2641002"></a><a class="indexterm" name="id2641010"></a>もしも、<em class="parameter"><code>[my_printer_name]</code></em>セクションが、<a class="link" href="smb.conf.5.html#PRINTABLE" target="_top">printable = yes</a>を含んで<code class="filename">smb.conf</code>ファイル中にある場合、Sambaはこれをプリンタ共有と見なして設定する。Windows 9x/Meクライアントは、共有名が8文字以上の場合、接続かプリンタドライバのロードで問題が発生するかもしれない。存在するユーザかファイル共有の名前と競合する、プリンタ共有名を付けてはならない。クライアントからの接続時に、Sambaは常時その名前を最初に持つものを見つけようとする。もしもそれが見つかると、これに対して接続を行い、同じ名前を持つプリンタ共有には接続できない!</p><div class="variablelist"><dl><dt><span class="term"><a class="link" href="smb.conf.5.html#COMMENT" target="_top">comment = Printer with Restricted Access </a></span></dt><dd><p>		上記で書いたとおりのコメントである。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PATH" target="_top">path = /var/spool/samba_my_printer </a></span></dt><dd><p>		このプリンタに対するスプール領域のディレクトリを既定値の代わりに設定する。		これは異なって設定する必要はないが、オプションは有効である。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin = kurt </a></span></dt><dd><p>		printer admin定義は、この一般的な<em class="parameter"><code>[printers]</code></em>共有から		明示的に定義されたプリンタ共有と違う。もし要求がなければ、可能であればそれを		表示しない。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#BROWSEABLE" target="_top">browseable = yes </a></span></dt><dd><p>		これは、クライアントが、<span class="guiicon">ネットワークコンピュータ</span>で		ブラウズするのが便利なように、プリンタをブラウズ可能にする。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PRINTABLE" target="_top">printable = yes </a></span></dt><dd><p>		<a class="link" href="classicalprinting.html#ptrsect" title="[printers]セクション">20.4.1.2節</a>を参照。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#WRITABLE" target="_top">writable = no </a></span></dt><dd><p>		<a class="link" href="classicalprinting.html#ptrsect" title="[printers]セクション">20.4.1.2節</a>を参照。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#HOSTSALLOW" target="_top">hosts allow = 10.160.50.,10.160.51. </a></span></dt><dd><p>		<a class="link" href="smb.conf.5.html#HOSTSALLOW" target="_top">hosts allow</a>と<a class="link" href="smb.conf.5.html#HOSTSDENY" target="_top">hosts deny</a>		パラメータを使って特定の数値でのアクセス制御を試す。これは、決して安全な		賭けではない。これは使用しているプリンタをセキュアにする方法ではない。この		行は、最初に評価されるアクセス制御中での特定のサブネットからの、すべての		クライアントを許可する。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#HOSTSDENY" target="_top">hosts deny = turbo_xp,10.160.50.23,10.160.51.60 </a></span></dt><dd><p>		すべての一覧表示されたホストはここでは許可されない(たとえ許可された		サブネットにあったとしても)。見ての通り、NetBIOSホスト名をここに書くのと		同様にIPアドレス名前を付けることが出来る。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#GUESTOK" target="_top">guest ok = no </a></span></dt><dd><p>		このプリンタはゲストアカウントには公開していない。		</p></dd></dl></div></div><div class="sect3" title="印刷コマンド"><div class="titlepage"><div><div><h4 class="title"><a name="id2641324"></a>印刷コマンド</h4></div></div></div><p><a class="indexterm" name="id2641332"></a><a class="indexterm" name="id2641339"></a><a class="indexterm" name="id2641346"></a><a class="indexterm" name="id2641352"></a>各セクション(か<em class="parameter"><code>[printers]</code></em>セクション中で)はプリンタを定義し、<em class="parameter"><code>print command</code></em>は定義されるかもしれない。これは、そのプリンタに対するSambaの印刷スプールディレクトリ中に位置するファイルを処理するコマンドを設定する。(もしも覚えているならば、このスプールディレクトリは<a class="link" href="smb.conf.5.html#PATH" target="_top">path</a>パラメータで設定される)。通常、このコマンドはSambaが動いているホストの印刷サブシステムに、適切なシステムの印刷コマンドを使ってスプールファイルを渡す。しかし、もしもこの必要性に要求がなければ、たぶんそうだろう。デバッグかその他の理由で、ファイルの印刷より何かが完全に異なることを行う事を望んでも良い。例は、プリンティングをデバッグするために必要とする時、さらなる調査のために一時的な場所に印刷ファイルをコピーするだけのコマンドである。もしも、固有の印刷コマンドを作る場合(か印刷コマンドシェルスクリプトの開発)、Sambaスプールディレクトリからファイルを削除する必要があることに注意をはらうこと。そうしないと、すぐにディスクがいっぱいになってしまうだろう。</p></div><div class="sect3" title="既定値のUNIXシステム印刷コマンド"><div class="titlepage"><div><div><h4 class="title"><a name="id2641421"></a>既定値のUNIXシステム印刷コマンド</h4></div></div></div><p><a class="indexterm" name="id2641430"></a>設定ファイル中で明示的に設定されていない場合、Sambaがほとんどの場合、多くのパラメータについて、内蔵の値を使うということは、以前の説明で理解されているかと思う。<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command</a>でも同じである。既定値の印刷コマンドは<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing</a>パラメータの設定に依存して変わる。<a class="link" href="classicalprinting.html#printOptions" title="Table 21.1. 既定値の印刷設定">既定値の印刷設定</a>に一覧があるコマンド中で、<span class="emphasis"><em>X</em></span>が<span class="emphasis"><em>p,s,J</em></span>のようなものである、<span class="emphasis"><em>%X</em></span>形式を持ついくつかのパラメータに気がつくだろう。これらの文字は、それぞれプリンタの名前、スプールファイルとジョブIDを表す。これらは、キーとなる印刷オプションの概要を提供する<a class="link" href="classicalprinting.html#printOptions" title="Table 21.1. 既定値の印刷設定">既定値の印刷設定</a>中に詳細が説明されているが、CUPSの場合は特別で、<a class="link" href="CUPS-printing.html" title="Chapter 22. CUPS印刷環境のサポート">CUPS印刷サポート</a>で説明があるので、ここに記述はない。</p><div class="table"><a name="printOptions"></a><p class="title"><b>Table 21.1. 既定値の印刷設定</b></p><div class="table-contents"><table summary="既定値の印刷設定" border="1"><colgroup><col align="left"><col align="left"></colgroup><thead><tr><th align="left">設定</th><th align="left">既定値の印刷コマンド</th></tr></thead><tbody><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = bsd|aix|lprng|plp</a></td><td align="left">印刷コマンドは<code class="literal">lpr -r -P%p %s</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = sysv|hpux</a></td><td align="left">印刷コマンドは<code class="literal">lp -c -P%p %s; rm %s</code></td></tr><tr><td align="left"> <a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = qnx</a></td><td align="left">印刷コマンドは<code class="literal">lp -r -P%p -s %s</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = bsd|aix|lprng|plp</a></td><td align="left">lpq コマンドは<code class="literal">lpq -P%p</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = sysv|hpux</a></td><td align="left">lpq コマンドは<code class="literal">lpstat -o%p</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = qnx</a></td><td align="left">lpq コマンドは<code class="literal">lpq -P%p</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = bsd|aix|lprng|plp</a></td><td align="left">lprm コマンドは<code class="literal">lprm -P%p %j</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = sysv|hpux</a></td><td align="left">lprm コマンドは<code class="literal">cancel %p-%j</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = qnx</a></td><td align="left">lprm コマンドは<code class="literal">cancel %p-%j</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = bsd|aix|lprng|plp</a></td><td align="left">lppause コマンドは<code class="literal">lp -i %p-%j -H hold</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = sysv|hpux</a></td><td align="left">lppause コマンド(...は存在しない)</td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = qnx</a></td><td align="left">lppause コマンド(...は存在しない)</td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = bsd|aix|lprng|plp</a></td><td align="left">lpresume コマンドは<code class="literal">lp -i %p-%j -H resume</code></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = sysv|hpux</a></td><td align="left">lpresume コマンド(...は存在しない)</td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing = qnx</a></td><td align="left">lpresume コマンド(...は存在しない)</td></tr></tbody></table></div></div><br class="table-break"><p><a class="indexterm" name="id2641910"></a><a class="indexterm" name="id2641916"></a><a class="indexterm" name="id2641923"></a><a class="indexterm" name="id2641930"></a><em class="parameter"><code>printing = CUPS</code></em>用に、もしもSambaがlibcupsを使うようにコンパイルされたならば、ジョブの投稿にCUPS APIを使用する(通常使わない位置に自動生成されたprintcap ファイルに書き込むために、使用しているシステム中の<code class="filename">cupsd.conf</code>ファイルが設定されている場合、<a class="link" href="smb.conf.5.html#PRINTCAP" target="_top">printcap = cups</a>を設定するのはよい方法である)。ほかの場合は、Sambaは印刷処理のために、-orawオプションを付けて、System Vの印刷コマンドにマップする。これはすなわち、<code class="literal">lp -c -d%p -oraw; rm %s</code>を使うことである。<em class="parameter"><code>printing = cups</code></em>の場合と、もしもSambaがlibcupsを使うようにコンパイルされた場合、手動で設定したprint commandは何であっても無視される!</p></div><div class="sect3" title="カスタム印刷コマンド"><div class="titlepage"><div><div><h4 class="title"><a name="id2641988"></a>カスタム印刷コマンド</h4></div></div></div><p><a class="indexterm" name="id2641996"></a><a class="indexterm" name="id2642003"></a>サービスに対して印刷ジョブのスプーリングが終了後、<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command</a>はスプールファイルを処理するためにsystem()呼び出し経由でSambaによって使われる。通常指定されたコマンドはホストの印刷サブシステムにスプールファイルを投稿する。しかし、これが本当にそうであるというべき要求は全くない。印刷サブシステムはそれ固有のスプールファイルを削除しないかもしれないので、指定したコマンドは何であっても、それが処理された後にスプールファイルは消去されるようにすべきである。</p><p><a class="indexterm" name="id2642038"></a><a class="indexterm" name="id2642044"></a><a class="indexterm" name="id2642051"></a><a class="indexterm" name="id2642058"></a>伝統的な印刷システムに対して作成した固有の印刷コマンドを使うことについては何ら違いはない。しかし、固有のものを動かしたくないのであれば(訳注:to roll your own)、各印刷サブシステムに対してSambaが使う既定値の内蔵コマンドについて熟知すべきである(<a class="link" href="classicalprinting.html#printOptions" title="Table 21.1. 既定値の印刷設定">既定値の印刷設定</a>を参照)。最後のパラグラフに一覧表示されているすべてのコマンドには<span class="emphasis"><em>%X</em></span>という形式のパラメータがある。これらは<span class="emphasis"><em>マクロ</em></span>かショートカットで、真のオブジェクトの名前のためのプレースフォルダとして使われる。このようなプレースフォルダを使って、コマンドを動かしたとき、Sambaは自動的に適切な値に置き換える。印刷コマンドはすべてのSambaマクロ置換を扱える。印刷に関しては、以下の以下のものは特別に扱われる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><em class="parameter"><code>%s, %f</code></em>  スプールファイル名へのパス。</p></li><li class="listitem"><p><em class="parameter"><code>%p</code></em>  適切なプリンタ名。</p></li><li class="listitem"><p><em class="parameter"><code>%J</code></em>  クライアントから送られたジョブ名。</p></li><li class="listitem"><p><em class="parameter"><code>%c</code></em>  (もしも分かるならば)スプールされたジョブのページ数。</p></li><li class="listitem"><p><em class="parameter"><code>%z</code></em>  スプールされた印刷ジョブのサイズ(バイト単位)。</p></li></ul></div><p><a class="indexterm" name="id2642179"></a>印刷コマンドは少なくとも<em class="parameter"><code>%s</code></em>か<em class="parameter"><code>%f</code></em>のどちらか1つを使っている必要がある。<em class="parameter"><code>%p</code></em>の使用は任意である。もしもプリンタ名が指定されないと、<em class="parameter"><code>%p</code></em>は印刷コマンドから何のメッセージもなしに取り去られる。この場合、ジョブは既定値のプリンタに送られる。</p><p><a class="indexterm" name="id2642218"></a><a class="indexterm" name="id2642225"></a><em class="parameter"><code>[global]</code></em>セクション中で指定されると、指定されたprint commandは固有のprint commandを持たない任意の印刷サービスに対して使われる。もしも、印刷サービスのためのprint commandも、グローバルのprint commandも指定されない場合、スプールファイルは作成されるが処理されない!最も重要なことは、印刷ファイルは削除されず、そのため、ディスクスペースを消費してしまうと言うことである。</p><p><a class="indexterm" name="id2642258"></a><a class="indexterm" name="id2642265"></a>印刷は、<span class="emphasis"><em>nobody</em></span>アカウントを使うとき、ある種のUNIXでは失敗するかもしれない。もしもそのような事態に遭遇したら、代替のゲストアカウントを作成し、印刷権限を付与する。このゲストアカウントを、<em class="parameter"><code>[global]</code></em>セクション中に、<em class="parameter"><code>guest account</code></em>パラメータを使って設定する。</p><p><a class="indexterm" name="id2642296"></a><a class="indexterm" name="id2642303"></a><a class="indexterm" name="id2642310"></a>非常に複雑な印刷コマンドを構成することも出来る。印刷コマンドはUNIXシェルに渡されるようにする必要がある。シェルは通常のように指定されている環境変数を展開できる(UNIXの環境変数<em class="parameter"><code>$variable</code></em>を、Sambaの印刷コマンドの中で指定するための形式は<em class="parameter"><code>%$variable</code></em>である)。下記の動作する<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command</a>の例では、以下は印刷ジョブのログを<code class="filename">/tmp/print.log</code>に取り、ファイルを印刷し、次にそれを削除する。セミコロン(<span class="quote">“<span class="quote">;</span>”</span>)は通常通り、シェルスクリプト中でのコマンドの分離符号である:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2642374"></a><em class="parameter"><code>print command = echo Printing %s >> /tmp/print.log; lpr -P %p %s; rm %s</code></em></td></tr></table><p>動作させるシステム上で、通常どのようにファイルを印刷するかに例が依存することを考慮して、固有のコマンドを変更しなければならないかもしれない。既定値の<a class="link" href="smb.conf.5.html#PRINTCOMMAND" target="_top">print command</a>パラメータは、<a class="link" href="smb.conf.5.html#PRINTING" target="_top">printing</a>の設定状態に依存して代わる。他の例は下記の通り:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2642431"></a><em class="parameter"><code>print command = /usr/local/samba/bin/myprintscript %p %s</code></em></td></tr></table></div></div></div><div class="sect1" title="Samba-2.2からの印刷環境"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cups-msrpc"></a>Samba-2.2からの印刷環境</h2></div></div></div><p><a class="indexterm" name="id2642459"></a><a class="indexterm" name="id2642465"></a><a class="indexterm" name="id2642472"></a>Samba-2.2.xより前は、Windowsクライアントへの印刷サーバサポートは、<span class="emphasis"><em>LanMan</em></span>印刷機能に限定されていた。これは、Windows 9x/Me PCがプリンタを共有するときのものと同じプロトコルレベルである。2.2.0リリースの最初から、SambaはネイティブなWindows NTの印刷方式のサポートを開始した。これらは<span class="emphasis"><em>MS-RPC</em></span> (Remote Procedure Call)経由で実装されている。MS-RPCはすべての印刷のために、<span class="emphasis"><em>SPOOLSS</em></span>という名前付きパイプを使用する。</p><p>新しいSPOOLSSサポートによって提供される追加の機能は以下を含む:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2642515"></a>	オンデマンドでWindows 95/98/NT/2000クライアントにプリンタドライバのダウンロードを	サポートする(<span class="emphasis"><em>Point'n'Print</em></span>)。	</p></li><li class="listitem"><p><a class="indexterm" name="id2642535"></a>	Windows NTの<span class="emphasis"><em>Add Printer Wizard</em></span> (APW)か	<a class="ulink" href="http://imprints.sourceforge.net/" target="_top">Imprints</a>ツールセット経由で	プリンタドライバをアップロードする。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2642559"></a><a class="indexterm" name="id2642565"></a><a class="indexterm" name="id2642572"></a><a class="indexterm" name="id2642579"></a><a class="indexterm" name="id2642586"></a>	StartDocPrinter, EnumJobs()のような、ネイティブなMS-RPC印刷呼び出しをサポートする	(Win32印刷APIについてのより詳細な情報は	<a class="ulink" href="http://msdn.microsoft.com/" target="_top">MSDN documentation</a>を参照のこと)。	</p></li><li class="listitem"><p><a class="indexterm" name="id2642610"></a><a class="indexterm" name="id2642616"></a>	プリンタオブジェクト上のNTアクセス制御(ACL)のサポート。	</p></li><li class="listitem"><p><a class="indexterm" name="id2642631"></a>	スプールされたジョブ情報のための、内部データベースを使用することによる、プリンタ	キュー操作のサポートの改善(種々の<code class="filename">*.tdb</code>ファイルによって	実装された)。	</p></li></ul></div><p><a class="indexterm" name="id2642654"></a><a class="indexterm" name="id2642661"></a>Samba-3へのアップデートによって便利になることは、そのプリンタをActive Directory(かLDAP)に公開できることである。</p><p><a class="indexterm" name="id2642676"></a>Microsoft Windows NTサーバとSambaでの操作の間には基本的な違いが存在する。Windows NTは共有しないローカルプリンタのインストールを許可する。これは任意のWindows NTマシン(サーバかクライアント)はユーザがワークステーションとして使えるという不自然な結果となる。Sambaは、既定値か、プリンタ固有の共有経由での特定の定義のどちらかで、有効にしたすべてのプリンタを公開する。</p><p><a class="indexterm" name="id2642698"></a><a class="indexterm" name="id2642704"></a><a class="indexterm" name="id2642711"></a><a class="indexterm" name="id2642718"></a><a class="indexterm" name="id2642725"></a>Windows NT/200x/XP Professionalクライアントは標準SMBプリンタ共有を使ってはならない。それらはMS-RPCを使って他のWindows NTホスト上の任意のプリンタに直接印刷が出来る。これは、もちろん、クライアントがプリンタリソースを提供しているリモートホスト上で必要な権限を持っていることを仮定している。プリンタに対してWindows NTによって割り当てられている既定値のパーミッションは、よく知られた<span class="emphasis"><em>Everyone</em></span>グループに印刷のパーミッションを与える(Windows 9x/Meタイプの古いクライアントは、共有されたプリンタへの印刷のみ出来る)。</p><div class="sect2" title="Sambaサーバ上でのポイントアンドプリントによるクライアントドライバ"><div class="titlepage"><div><div><h3 class="title"><a name="id2642751"></a>Sambaサーバ上でのポイントアンドプリントによるクライアントドライバ</h3></div></div></div><p><a class="indexterm" name="id2642762"></a>このことが意味することについて多くの混乱がある。次のような疑問がしばしば質問される。<span class="quote">“<span class="quote">Windowsクライアントからの印刷をサポートするためにSambaホスト上にプリンタドライバをインストールすることは必要か否か?</span>”</span>答えは No で不必要である。</p><p><a class="indexterm" name="id2642786"></a><a class="indexterm" name="id2642794"></a>もちろん、Windows NT/2000クライアントではドライバを<span class="emphasis"><em>ローカルに</em></span>(次にSambaベースの印刷キューに繋ぎ)インストールするためにそれらのAPWも動かすこともできる。これはWindows 9x/Meクライアントによって使われるのと同じ手法である(しかし、Samba 2.2.0では、プリンタに対する有効なドライバをSambaサーバが処理することをWindows NT/2000クライアントが要求させる、というバグがある。これはSamba 2.2.1で修正されている)。</p><p><a class="indexterm" name="id2642820"></a><a class="indexterm" name="id2642827"></a>しかし、これはSambaサーバの<em class="parameter"><code>[print$]</code></em>共有中にプリンタドライバをインストールする新しい機能であり、これはとても便利である。次に、<span class="emphasis"><em>すべての</em></span>クライアント(95/98/MEを含む)はこのプリンタ共有に最初に接続した時にインストールされているドライバを入手する。この<em class="parameter"><code>[print$]</code></em>中へのドライバの<span class="emphasis"><em>アップロード</em></span>または<span class="emphasis"><em>供託</em></span>と、以下の存在するSambaプリンタ共有へ、このドライバを結びつけることは異なった手段で達成できる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	NT/200x/XP Professionalクライアント上で<span class="emphasis"><em>APW</em></span>を動かす(これは95/98/MEクライアントでは動かない)。	</p></li><li class="listitem"><p>	<span class="emphasis"><em>Imprints</em></span>ツールセットを使う。	</p></li><li class="listitem"><p>	<span class="emphasis"><em>smbclient</em></span>と<span class="emphasis"><em>rpcclient</em></span>コマンド行ツールを使う。	</p></li><li class="listitem"><p>	<span class="emphasis"><em>cupsaddsmb</em></span>を使う(CUPS印刷システムのみ動作し、LPR/LPD、LPRngなどでは動かない)。	</p></li></ul></div><p><a class="indexterm" name="id2642914"></a><a class="indexterm" name="id2642921"></a>Sambaはスプールされたファイルに対してどのような方法でも、これらのアップロードされたドライバを使わない。これらのドライバは、Sambaによってサポートされている<span class="quote">“<span class="quote">ポイントアンドプリント</span>”</span>メカニズム経由でダウンロード、インストールするクライアントによって完全に使われる。クライアントは、プリンタ(かUNIX印刷システム)が要求する形式に印刷ファイルを生成するためにこれらドライバを使う。Sambaが受け取る印刷ファイルは、必要に応じてすべてのさらなる処理のために責任のある、UNIX印刷システムに渡される。</p></div><div class="sect2" title="無効になった [printer$]セクション"><div class="titlepage"><div><div><h3 class="title"><a name="id2642957"></a>無効になった [printer$]セクション</h3></div></div></div><p><a class="indexterm" name="id2642966"></a><a class="indexterm" name="id2642972"></a>	2.2より前のSambaのバージョンでは<em class="parameter"><code>[printer$]</code></em>という名前の	共有を使う事が出来た。この名前はWindows 9x/Meクライアントがそれによって共有される	プリンタによって作成された、同じ、名前付きのサービスから取られている。	Windows 9x/Meプリンタサーバは、プリンタドライバのダウンロードをサポートするために、	ードオンリのアクセス(かつパスワードなし)のサービスを常時用意している。しかし、	Sambaの最初の実装では、<em class="parameter"><code>printer driver location</code></em>という名前の、	共有単位で使われるパラメータが使えた。これはそのプリンタに関連するドライバ	ファイルの位置を指定した。<em class="parameter"><code>printer driver</code></em>という名前の他の	ラメータは、クライアントに送られるプリンタドライバ名を定義する手段を提供した。	</p><p><a class="indexterm" name="id2643025"></a><a class="indexterm" name="id2643032"></a><a class="indexterm" name="id2643039"></a>	<em class="parameter"><code>printer driver file</code></em>を含むこれらのパラメータは、Samba-3	では取り除かれ、使う事は出来ない。共有名<em class="parameter"><code>[print$]</code></em>は	ダウンロード可能なプリンタドライバの位置のために使われる。これは、Windows NT	が動いているPCが、それによって共有されるプリンタによって作成された、	<em class="parameter"><code>[print$]</code></em>という共有名から取られている。Windows NTの	印刷サーバは、プリンタドライバのダウンロードとアップロードをサポートするために、	読み書きアクセス(そのACLのコンテキスト中で)を提供する、	<em class="parameter"><code>[print$]</code></em>というサービスを常時提供している。これは	Windows 9x/Meクライアントがこの時点で捨てられるという事を意味するわけではない。	それらにはSambaの<em class="parameter"><code>[print$]</code></em>共有がきちんとサポートする	ものを使える。	</p></div><div class="sect2" title="[print$]共有の作成"><div class="titlepage"><div><div><h3 class="title"><a name="id2643092"></a>[print$]共有の作成</h3></div></div></div><p><a class="indexterm" name="id2643100"></a>プリンタドライバファイルのアップロード/ダウンロードをサポートするために、まずはじめに<em class="parameter"><code>[print$]</code></em>という名前のファイル共有を作成しなければならない。この共有の公開される名前は、Microsoft Windowsクライアント中で埋め込まれている。これは、プリンタドライバファイルを検索しようとした時に、正確にこの前のサービスを探すように、Windowsクライアントがプログラムされているため、改名することは出来ない。</p><p>グローバルパラメータを追加するためにサーバのファイルを変更し、<em class="parameter"><code>[print$]</code></em>ファイル共有を作成すべきである(もちろん、たとえば<a class="link" href="smb.conf.5.html#PATH" target="_top">path</a>のようないくつかのパラメータの値は、サイトによって適切な値に置き換えるべきである)。<a class="link" href="classicalprinting.html#prtdollar" title="Example 21.3. [print$] の例">[print\$] の例</a>を参照。</p><div class="example"><a name="prtdollar"></a><p class="title"><b>Example 21.3. [print$] の例</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td># ドライバの追加と設定を可能にすべき、ntdomainグループのメンバ</td></tr><tr><td># プリンタのプロパティ。rootは常時'printer admin'と仮定される。</td></tr><tr><td><a class="indexterm" name="id2643205"></a><em class="parameter"><code>printer admin = @ntadmin</code></em></td></tr><tr><td># ...</td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[printers]</code></em></td></tr><tr><td># ...</td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[print$]</code></em></td></tr><tr><td><a class="indexterm" name="id2643242"></a><em class="parameter"><code>comment = プリンタドライバのダウンロード領域</code></em></td></tr><tr><td><a class="indexterm" name="id2643255"></a><em class="parameter"><code>path = /etc/samba/drivers</code></em></td></tr><tr><td><a class="indexterm" name="id2643267"></a><em class="parameter"><code>browseable = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2643278"></a><em class="parameter"><code>guest ok = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2643290"></a><em class="parameter"><code>read only = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2643302"></a><em class="parameter"><code>write list = @ntadmin, root</code></em></td></tr></table></div></div><br class="example-break"><p>もちろん、<a class="link" href="smb.conf.5.html#PATH" target="_top">path</a>パラメータによって名付けられたディレクトリが、UNIXファイルシステム上に存在するようにしておく必要もある。</p></div><div class="sect2" title="[print$]セクションのパラメータ"><div class="titlepage"><div><div><h3 class="title"><a name="id2643333"></a>[print$]セクションのパラメータ</h3></div></div></div><p><a class="indexterm" name="id2643342"></a><a class="indexterm" name="id2643349"></a><a class="indexterm" name="id2643356"></a><a class="indexterm" name="id2643363"></a><a class="indexterm" name="id2643370"></a><em class="parameter"><code>[print$]</code></em>は<code class="filename">smb.conf</code>中で特別なセクションである。これは、潜在的なプリンタドライバダウンロードに関連する設定を含み、ローカルプリンタドライバのインストールのためにWindowsクライアントによって使われる。以下のパラメータはこの共有セクションでしばしば必要とされるものである:</p><div class="variablelist"><dl><dt><span class="term"><a class="link" href="smb.conf.5.html#COMMENT" target="_top">comment = プリンタドライバダウンロード領域</a></span></dt><dd><p>		共有リスト中に一覧表示された時に、共有のそばにあるコメント(通常Windows		クライアントはそれを見る事ができないが、		<code class="literal">smbclient -L sambaserver</code>の出力中にも表示される)。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#PATH" target="_top">path = /etc/samba/printers </a></span></dt><dd><p>		UNIXの観点からのWindowsドライバファイルの保存場所の位置のパス。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#BROWSEABLE" target="_top">browseable = no </a></span></dt><dd><p>		<span class="guimenu">ネットワークコンピュータ</span>でクライアントに		<em class="parameter"><code>[print$]</code></em>共有を見せないようにさせる。		<code class="literal">cmd</code>シェルで以下を実行すると:</p><pre class="screen"><code class="prompt">C:\> </code> <code class="literal">net use g:\\sambaserver\print$</code></pre><p>		任意のクライアントから引き続き見る事ができる。これは、Windows		エクスプローラから<span class="guimenu">ネットワークドライブの割り当て</span>		からでも行う事が出来る。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#GUESTOK" target="_top">guest ok = yes </a></span></dt><dd><p>		すべてのゲストユーザにこの共有をリードオンリにする。クライアント上への		ダウンロードとプリンタのドライバのインストールを行うためのアクセスは		許可される。<em class="parameter"><code>guest ok = yes</code></em>が必要かどうかは、		どのようにサイトが設定されているかに依存する。もしもユーザがSamba		ホスト上のアカウントを持つことを許可されているならば、これは何の		問題もない。		</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p> 		もし、Sambaサーバによって認証されることを、すべてのWindows NTユーザが		保証されているならば(たとえば、もしも、NTドメインサーバ経由でSambaが		認証するとき、ユーザはすでにWindows NTセッションのためにログオンするために		ドメインコントローラによって認証されていた場合)、ゲストアクセスは		不要である。もちろん、ばかげたアカウントとセキュリティについて		心配せずに、ワークグループ環境で印刷を行いたいのであれば、ゲストアクセス		のための共有を設定する。同じように、<em class="parameter"><code>[global]</code></em>		セクション中で、		<a class="link" href="smb.conf.5.html#MAPTOGUEST" target="_top">map to guest = Bad User</a>		を追加することを考えるべきである。これを使う前に、このパラメータが		行う事を理解しておくこと。		</p></div></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#READONLY" target="_top">read only = yes </a></span></dt><dd><p>		誰でもがドライバファイルをアップロード(あるいはドライバの設定の変更)する		ことは望まないので、この共有を書き込み不可にする。		</p></dd><dt><span class="term"><a class="link" href="smb.conf.5.html#WRITELIST" target="_top">write list = @ntadmin, root </a></span></dt><dd><p>		<em class="parameter"><code>[print$]</code></em>は以前の設定によってリードオンリになって		いるので、<em class="parameter"><code>write list</code></em>も一緒に作成すべきである。UNIX		グループは先頭に<span class="quote">“<span class="quote">@</span>”</span>が付いたものである。共有上にファイルの		アップデートを必要とするこの一覧にあるユーザは、(一般的にパブリックな		リードオンリアクセスの例外として)書き込みが許可される。		通常この設定中で管理者レベルのユーザのみ指名したいであろう。もしもこれが		非rootアカウントである場合、アカウントはグローバルの		<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>パラメータ中で言及されるべきである。		ファイル共有上の設定についてのより詳細な情報は、<code class="filename">smb.conf</code>マニュアル		ページを参照のこと。		</p></dd></dl></div></div><div class="sect2" title="[print$]共有ディレクトリ"><div class="titlepage"><div><div><h3 class="title"><a name="id2643713"></a>[print$]共有ディレクトリ</h3></div></div></div><p>Windows NT印刷サーバが、複数のクライアントアーキテクチャによってドライバのダウンロードが出来るようにするために、<em class="parameter"><code>[print$]</code></em>サービス内にいくつかのサブディレクトリを作成しなければならない(すなわち、<a class="link" href="smb.conf.5.html#PATH" target="_top">path</a>パラメータによって指定されたUNIXのディレクトリ)。これらはサポートされる各クライアントアーキテクチャに一致する。Sambaは同様にこのモデルに追従する。<em class="parameter"><code>[print$]</code></em>共有それ自身の名前と同じように、サブディレクトリは下記に一覧表示された名前と正確に一致しなければならない(サポートする必要のないアーキテクチャのサブディレクトリはなくてもよい)。</p><p>すなわち、下記のように、<em class="parameter"><code>[print$]</code></em>共有配下に、サポートしたい各アーキテクチャのためのディレクトリを作成する。</p><pre class="programlisting">[print$]--+          |--W32X86           # serves drivers to Windows NT x86          |--WIN40            # serves drivers to Windows 95/98          |--W32ALPHA         # serves drivers to Windows NT Alpha_AXP          |--W32MIPS          # serves drivers to Windows NT R4000          |--W32PPC           # serves drivers to Windows NT PowerPC</pre><p></p><div class="important" title="必要とされるパーミッション" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">必要とされるパーミッション</h3><p>	Sambaホスト上に新しいドライバを追加するためには、2つの条件のうちの1つを真にしておかねばならない:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>		Sambaホストに接続する時に使われるアカウントはUIDが0でなければならない(すなわちrootアカウント)。		</p></li><li class="listitem"><p>		Sambaホストに接続する時に使われるアカウントは<span class="emphasis"><em>printer admin</em></span>リスト中に列挙されねばならない。		</p></li></ul></div><p>	もちろん、接続されたアカウントは<em class="parameter"><code>[print$]</code></em>下のサブ	ディレクトリファイルを追加するための書き込み許可が必要である。すべてのファイル	共有は既定値で<span class="quote">“<span class="quote">リードオンリ</span>”</span>に設定されていることを覚えておくこと。	</p></div><p>要求された<em class="parameter"><code>[print$]</code></em>サービスと関連したサブディレクトリを作成した後、Windows NT 4.0/200x/XPクライアントワークステーションの所に行く。<span class="guiicon">ネットワークコンピュータ</span>か<span class="guiicon">マイネットワーク</span>を開き、Sambaホストをブラウズする。所定のサーバを選択後、その<span class="guiicon">プリンタとFAX</span>フォルダに移動する。そうすると、Sambaホスト上で定義されたプリンタ共有にい位置するプリンタの一覧の初期値を見る事ができる。</p></div></div><div class="sect1" title="[print$]へのドライバのインストール"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2643877"></a>[print$]へのドライバのインストール</h2></div></div></div><p><code class="filename">smb.conf</code>中に<em class="parameter"><code>[print$]</code></em>共有を無事作成でき、<code class="filename">smb.conf</code>ファイルを強制的にSambaに再読込させただろうか?であれば問題はない。しかし、新しい機能を使うにはまだもう少し手間がかかる。この共有中にクライアントドライバファイルをインストールする必要がある。そのため、まだこの共有は空の状態である。不幸にも、そこにドライバファイルをコピーするだけでは十分ではない。正しくインストールする必要があり、そうすると、各ドライバに対する適切なレコードがSamba内部データベース中に存在するようになり、Microsoft Windowsクライアントから要求された正しいドライバを提供することが出来るようになる。さらに、控えめに言ってもそれは厳重さが必要である。下記では<em class="parameter"><code>[print$]</code></em>中にドライバをインストールする2つの代替方法について説明する:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	任意のUNIXワークステーションから、Sambaのコマンドラインユーティリティ	<code class="literal">rpcclient</code>を、種々のサブコマンド	(<code class="literal">adddriver</code>と<code class="literal">setdriver</code>など)を組み合わせて	使う。	</p></li><li class="listitem"><p>	任意のWindows NT/200x/XPクライアントワークステーションから、GUI	(<span class="guiicon">プリンタのプロパティ</span>と<span class="guiicon">プリンタの追加ウィザード</span>)	を走らせる。	</p></li></ul></div><p>後者のオプションが、おそらくより易しいであろう(たとえプロセスが最初多少奇妙に振る舞うとしても)。</p><div class="sect2" title="プリンタの追加ウィザードによるドライバのインストール"><div class="titlepage"><div><div><h3 class="title"><a name="id2643992"></a>プリンタの追加ウィザードによるドライバのインストール</h3></div></div></div><p>プリンタは、最初、実際のプリンタドライバがそれに割り当てられていない状態で、クライアントのエクスプローラからアクセスされる、Sambaホストの<span class="guiicon">プリンタ</span>フォルダに一覧表示される。既定値で、このドライバの名前は空の文字列に設定されている。これは変更しなければならない。NT/2000/XPクライアントから、ローカルの<span class="guiicon">プリンタ追加ウィザード</span>(APW)を動かすことで、この作業ができる。</p><p>有効なプリンタドライバのインストールは簡単である。ドライバを割り当てたいプリンタに対するプリンタのプロパティを表示させなければならない。Windowsのエクスプローラを起動し、<span class="guiicon">ネットワークコンピュータ</span>を開き、Sambaホストをブラウズし、Sambaの<span class="guiicon">プリンタ</span>フォルダを開き、プリンタアイコンを右クリックし、<span class="guimenu">プロパティ</span>を選択する。これでプリンタと既定値の<code class="constant">NULL</code>ドライバが割り当てられているキューのためのドライバプロパティが見えるようになる。そして、<span class="quote">“<span class="quote">デバイス設定が表示できません。指定されたプリンタのドライバがインストールされていません。スプーラのプロパティのみ表示されます。ドライバを今インストールしますか?</span>”</span>というエラーメッセージが表示される。</p><p>ここで、<span class="guibutton">Yes</span>をクリックしては<span class="emphasis"><em>いけない</em></span>!その代わり、エラーダイアログで<span class="guibutton">No</span>をクリックする。これで、プリンタプロパティウインドウが表示される。ここから、プリンタへのドライバの割り当ての手順は公開されている。以下を選べる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	インストール済みのポップアップリストからドライバを選択。通常は最初リストは空である。	</p></li><li class="listitem"><p>	新しいプリンタドライバをインストールするために<span class="guibutton">新しいドライバ</span>	をクリック(これはAPWを起動する)。	</p></li></ul></div><p>一度APWが起動すると、Windows中でなじみがある、ものと手続きは正確に同じである(Windows NT上のプリンタドライバインストール手続きに慣れていることを仮定している)。接続を確認し、<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>権限を持つユーザとしてセットアップ(ユーザが権限を持つか分からない場合は<code class="literal">smbstatus</code>でチェックしてみる)。クライアントOSに対して<span class="application">Windows NT x86</span>の代わりのプリンタドライバをインストールしたい場合、プリンタプロパティダイアログの<span class="guilabel">共有</span>タブを使う必要がある。</p><p>管理者(root)アカウント(<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>パラメータで指定されたもの)で接続していると仮定すると、さらに、このダイアログを使ってACLと既定値のデバイスの設定のようなプリンタのプロパティをも修正できる。既定値のデバイス設定のためには、<a class="link" href="classicalprinting.html#inst-rpc" title="rpcclientを使った印刷ドライバのインストール"><code class="literal">rpcclient</code>を使った印刷ドライバのインストール</a>に助言が書いてあることを考慮してほしい。</p></div><div class="sect2" title="rpcclientを使った印刷ドライバのインストール"><div class="titlepage"><div><div><h3 class="title"><a name="inst-rpc"></a><code class="literal">rpcclient</code>を使った印刷ドライバのインストール</h3></div></div></div><p><em class="parameter"><code>[print$]</code></em>にプリンタドライバをインストールし、有効な方法でそれを設定するための2番目の方法は、UNIXコマンドラインから行う方法である。これは、4つの異なったステップを必要とする。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>	要求されたドライバファイルについての情報を集め、ファイルを収集する。	</p></li><li class="listitem"><p>	<em class="parameter"><code>[print$]</code></em>共有の正しいサブディレクトリ中にドライバ	ファイルを置く(おそらく<code class="literal">smbclient</code>を使うだろう)。	</p></li><li class="listitem"><p>	<code class="literal">rpcclient</code>コマンドラインユーティリティを起動し、その	<code class="literal">adddriver</code>サブコマンドを使う。	</p></li><li class="listitem"><p>	<code class="literal">rpcclient</code>をもう一度起動し、<code class="literal">setdriver</code>	サブコマンドを使う。	</p></li></ol></div><p>以下の節で、これらのステップのおのおのについて詳細な説明を行う。</p><div class="sect3" title="ドライバファイルの識別"><div class="titlepage"><div><div><h4 class="title"><a name="id2644320"></a>ドライバファイルの識別</h4></div></div></div><p><a class="indexterm" name="id2644329"></a><a class="indexterm" name="id2644336"></a><a class="indexterm" name="id2644343"></a>ドライバファイルを見つけるためには2つのオプションがある。プリンタに付属のドライバCD-ROMの内容を検査することが出来る。CD-ROM上にある<code class="filename">*.inf</code>ファイルの位置を覚えておく。これは<code class="filename">*.inf</code>ファイルが無いかもしれないので、出来ない場合もある。残念なことに、最近ではベンダ固有のインストールプログラムを使う傾向がある。これらのインストールパッケージはしばしば何らかのWindows上での書庫形式を使っている。更に追加で、インストール処理中にファイル名が改名されるかもしれない。これは、必要とされるドライバファイルの識別がとても難しくなることを意味する。</p><p><a class="indexterm" name="id2644390"></a>次に、2番目のオプションがある。ドライバをWindowsクライアント上にローカルにインストールし、インストール後にそれが使うファイル名とパスを調査する(サポートしたい各クライアントプラットフォーム毎にこの手続きを繰り返さなければならない。ここでは、すべてのWindows NT/200x/XPクライアントのためにMicrosoftによって使われる名前である、<span class="application">W32X86</span>プラットフォームのみを表示する)。</p><p><a class="indexterm" name="id2644417"></a>ドライバファイルを認識する良い方法は、ドライバの<span class="guilabel">プロパティ</span>ダイアログでテストページを印刷してみることである(<span class="guilabel">全般</span>タブ)。次に、印刷されたドライバファイルのリストを見てみる。Windows(とSamba)が<span class="guilabel">ドライバファイル</span>、<span class="guilabel">データファイル</span>、<span class="guilabel">設定ファイル</span>と(オプションの)<span class="guilabel">依存するドライバファイル</span>(これはWindows NTでは若干変わる)の何を呼び出しているかを認識する必要がある。次のステップのためにすべてのファイル名を記録する必要がある。</p><p><a class="indexterm" name="id2644477"></a><a class="indexterm" name="id2644484"></a><a class="indexterm" name="id2644491"></a>ドライバファイル名と関連するパスを迅速にテストする別の方法は、<code class="literal">rpcclient</code>ユーティリティによって提供される。<code class="literal">enumdrivers</code>か<code class="literal">getdriver</code>サブコマンドを指定し、infoレベルを<code class="filename">3</code>にしてこれを動かす。以下の例では、<span class="emphasis"><em>TURBO_XP</em></span>がWindows PCの名前である(この場合、これはWindows XP Professionalラップトップ)。<code class="constant">KDE-BITSHOP</code>という名前のSambaサーバからTURBO_XPにローカルにドライバをインストールしたとする。次に対話的な<code class="literal">rpcclient</code>を動かす。そうすると、<code class="literal">rpcclient /></code>が表示され、このプロンプトの状態でサブコマンドが入力出来るようになる。これは練習として残しておこう。次に、1つのサブコマンド行を実行し、すぐに終了するような<code class="option">-c</code>オプションをつけて<code class="literal">rpcclient</code>を起動する。これは大量のプリンタとドライバのために自動作業を行うスクリプトを作成する時に使う手法である。異なる引用符を使い分けて単語間の異なった空白を解決するように注意:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -U'Danka%xxxx' -c \	'getdriver "Heidelberg Digimaster 9110 (PS)" 3' TURBO_XP</code></strong>cmd = getdriver "Heidelberg Digimaster 9110 (PS)" 3[Windows NT x86]Printer Driver Info 3:  Version: [2]  Driver Name: [Heidelberg Digimaster 9110 (PS)]  Architecture: [Windows NT x86]  Driver Path: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01_de.DLL]  Datafile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.ppd]  Configfile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01U_de.DLL]  Helpfile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01U_de.HLP]    Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.DLL]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.INI]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.dat]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.cat]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.def]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.hre]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.vnd]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.hlp]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01Aux.dll]  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01_de.NTF]    Monitorname: []  Defaultdatatype: []</pre><p><a class="indexterm" name="id2644619"></a><a class="indexterm" name="id2644626"></a><a class="indexterm" name="id2644633"></a><a class="indexterm" name="id2644640"></a>このドライバは大量の<span class="guilabel">依存ファイル</span>(しかしながらこれは悪い場合である)を持つことに気がついても良いだろう。また、不思議なことに、<span class="guilabel">ドライバファイル</span>はここで<span class="guilabel">ドライバファイル</span>にタグ付けされている。インストールされた、いわゆる<span class="application">WIN40</span>アーキテクチャに対してまだサポートをしていない。この名前は、MicrosoftによってWindows 9x/Meプラットフォームに使われる。もしもこれらをサポートしたいならば、<span class="application">W32X86</span>(すなわち、Windows NT/2000クライアント)Windows PC上に、それらのために追加でWindows 9x/Meドライバをインストールしなければならない。このPCは、Windows NT,2000あるいはXPで動いたとしても、Windows 9x/Meへの機能提供も出来る。</p><p><a class="indexterm" name="id2644706"></a><a class="indexterm" name="id2644713"></a><a class="indexterm" name="id2644721"></a><em class="parameter"><code>[print$]</code></em>共有が通常<span class="guiicon">ネットワークコンピュータ</span>経由でアクセス出来るので、そこにアクセスするためにWindowsエクスプローラからUNC記述を使う事が出来る。Windows 9x/Meドライバファイルは<code class="filename">WIN40</code>ディレクトリの<code class="filename">0</code>というサブディレクトリで終わる。これらに対するフルパスアクセスは<code class="filename">\\WINDOWSHOST\print$\WIN40\0\</code>である。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Windows 2000とWindowsXP上のより最新のドライバは、<span class="quote">“<span class="quote">2</span>”</span>の代わりに<span class="quote">“<span class="quote">3</span>”</span>というサブディレクトリ中にインストールされる。Windows NT中で使われるバージョン2のドライバはカーネルモードで動作する。Windows2000ではこれを変更した。それは引き続きカーネルモードのドライバを使えるが(もしAdminによって有効にされれば)、そのネイティブモードのプリンタドライバはユーザモードで動作する。これは、この目的のために設計されたドライバを要求する。これらのタイプのドライバは<span class="quote">“<span class="quote">3</span>”</span>サブディレクトリにインストールされる。</p></div></div><div class="sect3" title="Windowsクライアントの[print$]共有からのドライバファイルの取得"><div class="titlepage"><div><div><h4 class="title"><a name="id2644801"></a>Windowsクライアントの[print$]共有からのドライバファイルの取得</h4></div></div></div><p>ここで、以前のステップで認識したすべてのドライバファイルを収集する必要がある。さて、どこからそれを得ればよいだろうか?最後のファイルを識別する手段中で調査した、同じ<em class="parameter"><code>[print$]</code></em>共有とそのPCからそれを検索しないのだろうか?これを行うのに<code class="literal">smbclient</code>が使える。<code class="literal">getdriver</code>によって分かったパスと名前を使える。下記のコマンドライン業は、可読性向上のために、継続行文字を入れて編集できる:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>smbclient //TURBO_XP/print\$ -U'Danka%xxxx' \    -c 'cd W32X86/2;mget HD*_de.* hd*ppd Hd*_de.* Hddm*dll HDN*Aux.DLL'</code></strong>added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0Got a positive name query response from 10.160.50.8 ( 10.160.50.8 )Domain=[DEVELOPMENT] OS=[Windows 5.1] Server=[Windows 2000 LAN Manager]<code class="prompt">Get file Hddm91c1_de.ABD? </code><strong class="userinput"><code>n</code></strong><code class="prompt">Get file Hddm91c1_de.def? </code><strong class="userinput"><code>y</code></strong>getting file \W32X86\2\Hddm91c1_de.def of size 428 as Hddm91c1_de.def<code class="prompt">Get file Hddm91c1_de.DLL? </code><strong class="userinput"><code>y</code></strong>getting file \W32X86\2\Hddm91c1_de.DLL of size 876544 as Hddm91c1_de.DLL[...]</pre><p>このコマンドが完了すると、カレントローカルディレクトリにファイルが置かれる。この時点で、セミコロンで分離した、<code class="option">-c</code>パラメータのためにいくつかのコマンドが渡されることにおそらく気がつくだろう。これは、<code class="literal">smbclient</code>コマンドが再度終了する前にリモートのWindowsサーバ上で順番にすべてのコマンドを実行するようにさせる。</p><p><a class="indexterm" name="id2644923"></a><span class="application">WIN40</span>アーキテクチャが、Windows 9x/Me/XPクライアントをサポートしなければならないために、手続きを繰り返すことを忘れないこと。さらに、それらのアーキテクチャは<code class="filename">WIN40/0/</code>サブディレクトリにあることを忘れないこと。これがいったん終わると、Sambaサーバの<em class="parameter"><code>[print$]</code></em>共有にある、収集されたファイルを格納するために<code class="literal">smbclient. ..put</code>を動作させることができる。</p></div><div class="sect3" title="[print$]へのドライバファイルインストール"><div class="titlepage"><div><div><h4 class="title"><a name="id2644963"></a>[print$]へのドライバファイルインストール</h4></div></div></div><p>次は、<em class="parameter"><code>[print$]</code></em>共有にドライバファイルを配置する作業である。この共有へのUNIXパスは<code class="filename">smb.conf</code>ファイル中で以前に定義した事を忘れないこと。また、サポートしたい異なったWindowsクライアントタイプのためには、サブディレクトリを作成する。たとえばもしも、<em class="parameter"><code>[print$]</code></em>が<code class="filename">/etc/samba/drivers/</code>というUNIXパスにマップされているならば、ドライバファイルは以下のように配置すべきである:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	すべてのWindows NT, 2000,と XPクライアント用は <code class="filename">/etc/samba/drivers/W32X86/</code>	だが、<code class="filename">2</code>サブディレクトリ中ではない。	</p></li><li class="listitem"><p>	すべてのWindows 95, 98,とMeクライアント用は <code class="filename">/etc/samba/drivers/WIN40/</code>	だが、<code class="filename">0</code>サブディレクトリ中ではない。	</p></li></ul></div><p><a class="indexterm" name="id2645052"></a><a class="indexterm" name="id2645059"></a>再度、ネットワーク経由で、ドライバファイルを転送するためにsmbclientを使う。オリジナルの<span class="emphasis"><em>Windows</em></span>インストールに対して<code class="literal">getdriver</code>を走らせた事により情報を得た同じファイルとパスを指定する。しかし、ここでは、<span class="emphasis"><em>Samba/UNIX</em></span>印刷サーバの<em class="parameter"><code>[print$]</code></em>共有中にファイルを格納する。</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>smbclient //SAMBA-CUPS/print\$ -U'root%xxxx' -c \  'cd W32X86; put HDNIS01_de.DLL; \  put Hddm91c1_de.ppd; put HDNIS01U_de.DLL;        \  put HDNIS01U_de.HLP; put Hddm91c1_de.DLL;        \  put Hddm91c1_de.INI; put Hddm91c1KMMin.DLL;      \  put Hddm91c1_de.dat; put Hddm91c1_de.dat;        \  put Hddm91c1_de.def; put Hddm91c1_de.hre;        \  put Hddm91c1_de.vnd; put Hddm91c1_de.hlp;        \  put Hddm91c1_de_reg.HLP; put HDNIS01Aux.dll;     \  put HDNIS01_de.NTF'</code></strong>added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0Got a positive name query response from 10.160.51.162 ( 10.160.51.162 )Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.7a]putting file HDNIS01_de.DLL as \W32X86\HDNIS01_de.DLLputting file Hddm91c1_de.ppd as \W32X86\Hddm91c1_de.ppdputting file HDNIS01U_de.DLL as \W32X86\HDNIS01U_de.DLLputting file HDNIS01U_de.HLP as \W32X86\HDNIS01U_de.HLPputting file Hddm91c1_de.DLL as \W32X86\Hddm91c1_de.DLLputting file Hddm91c1_de.INI as \W32X86\Hddm91c1_de.INIputting file Hddm91c1KMMin.DLL as \W32X86\Hddm91c1KMMin.DLLputting file Hddm91c1_de.dat as \W32X86\Hddm91c1_de.datputting file Hddm91c1_de.dat as \W32X86\Hddm91c1_de.datputting file Hddm91c1_de.def as \W32X86\Hddm91c1_de.defputting file Hddm91c1_de.hre as \W32X86\Hddm91c1_de.hreputting file Hddm91c1_de.vnd as \W32X86\Hddm91c1_de.vndputting file Hddm91c1_de.hlp as \W32X86\Hddm91c1_de.hlpputting file Hddm91c1_de_reg.HLP as \W32X86\Hddm91c1_de_reg.HLPputting file HDNIS01Aux.dll as \W32X86\HDNIS01Aux.dllputting file HDNIS01_de.NTF as \W32X86\HDNIS01_de.NTF</pre><p><a class="indexterm" name="id2645135"></a><a class="indexterm" name="id2645142"></a><a class="indexterm" name="id2645149"></a>ヒュー;これはとても大量なタイプ量である!ほとんどのドライバはより小さい。多くはたった3つの汎用Postscriptドライバファイルと1つのPPDのみを持つ。Windowsマシンからの<code class="filename">W32X86</code>の<code class="filename">2</code>サブディレクトリからファイルを検索した時、Sambaサーバの同じサブディレクトリ中に(今は)それらを置かない。この再配置は、間もなく動く(そして、それらを必要とすべき場合、<code class="filename">WIN40/</code>サブディレクトリ中に、Windows 9x/Meアーキテクチャのためのファイルを置くことを忘れない)、<code class="literal">adddriver</code>によって自動的に行われる。</p></div><div class="sect3" title="smbclientによるドライバインストールの確認"><div class="titlepage"><div><div><h4 class="title"><a name="id2645196"></a><code class="literal">smbclient</code>によるドライバインストールの確認</h4></div></div></div><p><a class="indexterm" name="id2645210"></a><a class="indexterm" name="id2645216"></a>次は、所定の場所にファイルがあるかどうかを確認する。これは、<code class="literal">smbclient</code>で行える(が、もちろん、SSH経由でログインし、標準のUNIXシェルアクセスを通して行える)。</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>smbclient //SAMBA-CUPS/print\$ -U 'root%xxxx' \	-c 'cd W32X86; pwd; dir; cd 2; pwd; dir'</code></strong> added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0Got a positive name query response from 10.160.51.162 ( 10.160.51.162 )Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.8a]Current directory is \\SAMBA-CUPS\print$\W32X86\.                                  D        0  Sun May  4 03:56:35 2003..                                 D        0  Thu Apr 10 23:47:40 20032                                   D        0  Sun May  4 03:56:18 2003HDNIS01Aux.dll                      A    15356  Sun May  4 03:58:59 2003Hddm91c1KMMin.DLL                   A    46966  Sun May  4 03:58:59 2003HDNIS01_de.DLL                      A   434400  Sun May  4 03:58:59 2003HDNIS01_de.NTF                      A   790404  Sun May  4 03:56:35 2003Hddm91c1_de.DLL                     A   876544  Sun May  4 03:58:59 2003Hddm91c1_de.INI                     A      101  Sun May  4 03:58:59 2003Hddm91c1_de.dat                     A     5044  Sun May  4 03:58:59 2003Hddm91c1_de.def                     A      428  Sun May  4 03:58:59 2003Hddm91c1_de.hlp                     A    37699  Sun May  4 03:58:59 2003Hddm91c1_de.hre                     A   323584  Sun May  4 03:58:59 2003Hddm91c1_de.ppd                     A    26373  Sun May  4 03:58:59 2003Hddm91c1_de.vnd                     A    45056  Sun May  4 03:58:59 2003HDNIS01U_de.DLL                     A   165888  Sun May  4 03:58:59 2003HDNIS01U_de.HLP                     A    19770  Sun May  4 03:58:59 2003Hddm91c1_de_reg.HLP                 A   228417  Sun May  4 03:58:59 2003              40976 blocks of size 262144. 709 blocks availableCurrent directory is \\SAMBA-CUPS\print$\W32X86\2\.                                  D        0  Sun May  4 03:56:18 2003..                                 D        0  Sun May  4 03:56:35 2003ADOBEPS5.DLL                        A   434400  Sat May  3 23:18:45 2003laserjet4.ppd                       A     9639  Thu Apr 24 01:05:32 2003ADOBEPSU.DLL                        A   109568  Sat May  3 23:18:45 2003ADOBEPSU.HLP                        A    18082  Sat May  3 23:18:45 2003PDFcreator2.PPD                     A    15746  Sun Apr 20 22:24:07 2003              40976 blocks of size 262144. 709 blocks available</pre><p><a class="indexterm" name="id2645295"></a><a class="indexterm" name="id2645302"></a><a class="indexterm" name="id2645310"></a><code class="filename">2</code>サブディレクトリ(おそらく以前のインストールで)中に、すでにドライバファイルが存在することに注意。いったん新しいドライバのためのファイルがそこにあると、クライアント上からそれらを使うことが出来るようにするためからは違ういくつかのステップを処理することになる。この時点で行うべき唯一のことは、Windowsエクスプローラからprint$共有を開いて、ファイル共有から普通のファイルを検索するのと同じように、クライアントから、それらを検索することである。しかし、それはポイントアンドプリント単位でそれらをインストールしない。その理由は、Sambaはまだそれらのファイルが特別か、すなわち、<span class="emphasis"><em>プリンタドライバファイル</em></span>かどうかを知らないのと、それらのドライバファイルが属する印刷キューがどれかを知らないということによる。</p></div><div class="sect3" title="adddriverを付けたprinter driver filesの実行"><div class="titlepage"><div><div><h4 class="title"><a name="id2645351"></a><code class="literal">adddriver</code>を付けた<span class="emphasis"><em>printer driver files</em></span>の実行</h4></div></div></div><p><a class="indexterm" name="id2645368"></a><a class="indexterm" name="id2645375"></a><a class="indexterm" name="id2645382"></a>次に、<em class="parameter"><code>[print$]</code></em>共有中に今アップロードしたファイルの特別なカテゴリについてSambaに通知する必要がある。これは、<code class="literal">adddriver</code>で行える。これは、Samba内部のTDBデータベースファイルにドライバを登録するように表示してくる。以下のコマンドと出力は、可読性向上のために編集してある:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx -c 'adddriver "Windows NT x86" \  "dm9110:HDNIS01_de.DLL: \  Hddm91c1_de.ppd:HDNIS01U_de.DLL:HDNIS01U_de.HLP:   \  NULL:RAW:Hddm91c1_de.DLL,Hddm91c1_de.INI,          \  Hddm91c1_de.dat,Hddm91c1_de.def,Hddm91c1_de.hre,   \  Hddm91c1_de.vnd,Hddm91c1_de.hlp,Hddm91c1KMMin.DLL, \  HDNIS01Aux.dll,HDNIS01_de.NTF,                     \  Hddm91c1_de_reg.HLP' SAMBA-CUPS</code></strong>cmd = adddriver "Windows NT x86" \  "dm9110:HDNIS01_de.DLL:Hddm91c1_de.ppd:HDNIS01U_de.DLL:   \  HDNIS01U_de.HLP:NULL:RAW:Hddm91c1_de.DLL,Hddm91c1_de.INI, \  Hddm91c1_de.dat,Hddm91c1_de.def,Hddm91c1_de.hre,          \  Hddm91c1_de.vnd,Hddm91c1_de.hlp,Hddm91c1KMMin.DLL,        \  HDNIS01Aux.dll,HDNIS01_de.NTF,Hddm91c1_de_reg.HLP"Printer Driver dm9110 successfully installed.</pre><p><a class="indexterm" name="id2645438"></a><a class="indexterm" name="id2645445"></a><a class="indexterm" name="id2645452"></a>このステップの後、ドライバはプリントサーバ上のSambaによって認識される。このコマンドを入力するときには特別に注意を払う必要がある。フィールドの順番を交換しないこと。それは明白である。他の変更は、ドライバファイルのインストールが成功するかもしれないが、ドライバの実行が不可能になる。そのため、注意を払うこと!adddriverコマンドの文法に関するヒントはマニュアルページにあり、必要ならばより詳細な記述を見ておくこと。</p></div><div class="sect3" title="adddriver処理完了の確認"><div class="titlepage"><div><div><h4 class="title"><a name="id2645482"></a><code class="literal">adddriver</code>処理完了の確認</h4></div></div></div><p>ファイルをドライバファイルとしてSambaが認識したことを示す表示の1つは、<code class="computeroutput">successfully installed</code>というメッセージである。他のものは、<code class="literal">adddriver</code>コマンドによってファイルが<code class="filename">2</code>サブディレクトリ中に動かされた、という事実である。これは再度<code class="literal">smbclient</code>コマンドで確認できる:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>smbclient //SAMBA-CUPS/print\$ -Uroot%xx \	-c 'cd W32X86;dir;pwd;cd 2;dir;pwd'</code></strong> added interface ip=10.160.51.162 bcast=10.160.51.255 nmask=255.255.252.0 Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.7a]  Current directory is \\SAMBA-CUPS\print$\W32X86\  .                                  D        0  Sun May  4 04:32:48 2003  ..                                 D        0  Thu Apr 10 23:47:40 2003  2                                   D        0  Sun May  4 04:32:48 2003                40976 blocks of size 262144. 731 blocks available   Current directory is \\SAMBA-CUPS\print$\W32X86\2\  .                                  D        0  Sun May  4 04:32:48 2003  ..                                 D        0  Sun May  4 04:32:48 2003  DigiMaster.PPD                      A   148336  Thu Apr 24 01:07:00 2003  ADOBEPS5.DLL                        A   434400  Sat May  3 23:18:45 2003  laserjet4.ppd                       A     9639  Thu Apr 24 01:05:32 2003  ADOBEPSU.DLL                        A   109568  Sat May  3 23:18:45 2003  ADOBEPSU.HLP                        A    18082  Sat May  3 23:18:45 2003  PDFcreator2.PPD                     A    15746  Sun Apr 20 22:24:07 2003  HDNIS01Aux.dll                      A    15356  Sun May  4 04:32:18 2003  Hddm91c1KMMin.DLL                   A    46966  Sun May  4 04:32:18 2003  HDNIS01_de.DLL                      A   434400  Sun May  4 04:32:18 2003  HDNIS01_de.NTF                      A   790404  Sun May  4 04:32:18 2003  Hddm91c1_de.DLL                     A   876544  Sun May  4 04:32:18 2003  Hddm91c1_de.INI                     A      101  Sun May  4 04:32:18 2003  Hddm91c1_de.dat                     A     5044  Sun May  4 04:32:18 2003  Hddm91c1_de.def                     A      428  Sun May  4 04:32:18 2003  Hddm91c1_de.hlp                     A    37699  Sun May  4 04:32:18 2003  Hddm91c1_de.hre                     A   323584  Sun May  4 04:32:18 2003  Hddm91c1_de.ppd                     A    26373  Sun May  4 04:32:18 2003  Hddm91c1_de.vnd                     A    45056  Sun May  4 04:32:18 2003  HDNIS01U_de.DLL                     A   165888  Sun May  4 04:32:18 2003  HDNIS01U_de.HLP                     A    19770  Sun May  4 04:32:18 2003  Hddm91c1_de_reg.HLP                 A   228417  Sun May  4 04:32:18 2003                40976 blocks of size 262144. 731 blocks available</pre><p>他の検査方法は、印刷関連のTDBファイルのタイムスタンプが更新されたという事(と、もしも条件がそろえば、そのファイルサイズが増えたこと)である。</p></div><div class="sect3" title="Sambaがドライバを認識したかの確認"><div class="titlepage"><div><div><h4 class="title"><a name="id2645592"></a>Sambaがドライバを認識したかの確認</h4></div></div></div><p><a class="indexterm" name="id2645602"></a>この時点で、ドライバはSambaによって登録された。ほんの少しの時間でこのことを確認できる。しかし、このドライバはまだ特定のプリンタに対して関連づけられていない。少なくとも3つの方法で、ドライバファイルのステータスを確認できる:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2645625"></a><a class="indexterm" name="id2645632"></a><a class="indexterm" name="id2645639"></a><a class="indexterm" name="id2645646"></a><a class="indexterm" name="id2645653"></a>	任意のWindowsクライアントの、ネットワークコンピュータによるブラウズから、Samba	ホストを検索し、Sambaの<span class="guiicon">プリンタとFAX</span>フォルダを開く。任意の	プリンタアイコンを選択し、右クリックしてプリンタの	<span class="guimenuitem">プロパティ</span>を選択する。<span class="guilabel">詳細</span>タブを	クリックする。そのプリンタに対するドライバを示すフィールドがここにある。ドロップ	ダウンメニューでそのドライバを変更できる(知らずにこれをしないように気をつける	こと)。Sambaが理解しているすべてのドライバの一覧を、これを使うことで見ることが	できる。新しいものがその中にあるべきである(クライアントの各タイプはこの固有の	アーキテクチャリストの中にのみ見ることができる。もしも各プラットフォーム用に	インストールされた各ドライバが無いならば、Windows95/98/MEかWindows NT/2000/XP	を見たときとは、このリストは違っている)。	</p></li><li class="listitem"><p><a class="indexterm" name="id2645710"></a>	Windows 200x/XPクライアント(Windows NTではなく)の	<span class="guiicon">ネットワークコンピュータ</span>によるブラウズから、Sambaサーバを	探し、サーバの<span class="guiicon">プリンタ</span>フォルダを開き、空白の部分(プリンタが	ハイライトされていないようにして)を右クリックする。	<span class="guimenuitem">サーバのプロパティ</span>を選択する。	<span class="guilabel">ドライバ</span>タブ上で、新しいドライバが一覧表示されていることが	確認できる。この表示は、そのドライバに属するファイルの一覧を調べるのにも使える	(これはWindows NTでは動作せず、Windows 2000とWindows XPでのみ動作する。	Windows NTは<span class="guimenuitem">ドライバ</span>タブを提供しない)。この	ダイアログをより簡単に起動するための代替の方法は、DOSプロンプトで入力する方法	である(もちろん、<em class="replaceable"><code>SAMBA-CUPS</code></em>の代わりに使用している	Sambaサーバの名前を使わなければならない)。	</p><pre class="screen">	<strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /s /t2 /n\\<em class="replaceable"><code>SAMBA-CUPS</code></em></code></strong>	</pre><p>	</p></li><li class="listitem"><p>	UNIXプロンプトから、<em class="replaceable"><code>SAMBA-CUPS</code></em>になっている場所を	使用しているSambaホストの名前にして、xxxxは、rootに割り当てられている実際の	Sambaのパスワードにして以下のコマンド(かあるいはその変形)を動かす:	</p><pre class="screen">	<strong class="userinput"><code>rpcclient -U'root%xxxx' -c 'enumdrivers' <em class="replaceable"><code>SAMBA-CUPS</code></em></code></strong>	</pre><p>	</p><p>	これで、Sambaが知っているすべてのドライバが表示される。新しいものはこの中に	あるべきである。しかし、<em class="parameter"><code>[Windows NT x86]</code></em>ヘッデイング	配下のもののみが一覧表示され、その部分をインストールしていないため、	<em class="parameter"><code>[Windows 4.0]</code></em>配下はない。3番目のカラムは、他に	インストールされたドライバを、各サポートしたアーキテクチャ用に、一度に	2度表示する。新しいドライバは<span class="application">Windows NT 4.0 or 2000</span>	のみに表示される。<span class="application">Windows 95, 98, と Me</span>に存在	しているようにするためには、WIN40アーキテクチャとサブディレクトリに対する	完全な手続きを繰り返さなければならない。	</p></li></ul></div></div><div class="sect3" title="指定したドライバ名の自由度"><div class="titlepage"><div><div><h4 class="title"><a name="id2645855"></a>指定したドライバ名の自由度</h4></div></div></div><p><a class="indexterm" name="id2645864"></a>ドライバに好みの名前を付けることが出来る。前と同じファイルではあるが、異なったドライバ名を付けて<code class="literal">adddriver</code>ステップを繰り返したいのならば、以下のように行う:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -Uroot%xxxx         \  -c 'adddriver "Windows NT x86"                     \  "mydrivername:HDNIS01_de.DLL:              \  Hddm91c1_de.ppd:HDNIS01U_de.DLL:HDNIS01U_de.HLP:   \  NULL:RAW:Hddm91c1_de.DLL,Hddm91c1_de.INI,          \  Hddm91c1_de.dat,Hddm91c1_de.def,Hddm91c1_de.hre,   \  Hddm91c1_de.vnd,Hddm91c1_de.hlp,Hddm91c1KMMin.DLL, \  HDNIS01Aux.dll,HDNIS01_de.NTF,Hddm91c1_de_reg.HLP' SAMBA-CUPS  </code></strong>cmd = adddriver "Windows NT x86" \ "mydrivername:HDNIS01_de.DLL:Hddm91c1_de.ppd:HDNIS01U_de.DLL:\  HDNIS01U_de.HLP:NULL:RAW:Hddm91c1_de.DLL,Hddm91c1_de.INI,           \  Hddm91c1_de.dat,Hddm91c1_de.def,Hddm91c1_de.hre,                    \  Hddm91c1_de.vnd,Hddm91c1_de.hlp,Hddm91c1KMMin.DLL,                  \  HDNIS01Aux.dll,HDNIS01_de.NTF,Hddm91c1_de_reg.HLP"Printer Driver mydrivername successfully installed.</pre><p><a class="indexterm" name="id2645915"></a><a class="indexterm" name="id2645922"></a><a class="indexterm" name="id2645929"></a>任意のプリントキューにそのドライバをバインドすることが出来る(しかし、ターゲットのプリンタに関して意味をなすキューへのドライバを連携させる事については、責任を追わねばならない)。繰り返し<code class="literal">rpcclient</code> <code class="literal">adddriver</code>コマンドを実行することは出来ない。おのおのの実行は、それぞれのサブディレクトリ中にそれらを移動することで、<em class="parameter"><code>[print$]</code></em>共有中にファイルを配置してしまったので、各<code class="literal">rpcclient ... adddriver</code>コマンドの前に<code class="literal">smbclient ... put</code>を1回実行させなければならない。</p></div><div class="sect3" title="setdriverを付けたrpcclientの実行"><div class="titlepage"><div><div><h4 class="title"><a name="id2645984"></a><code class="literal">setdriver</code>を付けた<code class="literal">rpcclient</code>の実行</h4></div></div></div><p> <a class="indexterm" name="id2646003"></a><a class="indexterm" name="id2646010"></a>Sambaはどのプリンタがどのドライバに対応しているかを知る必要がある。ドライバからプリンタへのマッピングを作成し、この情報をSambaのTDBファイルに格納する。<code class="literal">rpcclient setdriver</code>はこれを正しく処理する:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -U'root%xxxx' -c 'setdriver dm9110 mydrivername' <em class="replaceable"><code>SAMBA-CUPS</code></em></code></strong> cmd = setdriver dm9110 mydrivernameSuccessfully set dm9110 to driver mydrivername.</pre><p>これはまずい、こういう事は期待していない。この時点では、指定する名前を繰り返す:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -U'root%xxxx' -c 'setdriver dm9110 dm9110' <em class="replaceable"><code>SAMBA-CUPS</code></em></code></strong> cmd = setdriver dm9110 dm9110Successfully set dm9110 to driver dm9110.</pre><p>コマンドの文法は下記の通り:</p><pre class="screen"><strong class="userinput"><code>rpcclient -U'root%<em class="replaceable"><code>sambapassword</code></em>' -c 'setdriver <em class="replaceable"><code>printername</code></em> \ <em class="replaceable"><code>drivername</code></em>' <em class="replaceable"><code>SAMBA-Hostname</code></em></code></strong>. </pre><p>これで、ほとんどの仕事が完了したが、まだ全部ではない。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><code class="literal">setdriver</code>コマンドは、Sambaがそのプリンタをすでに知っているときにのみ成功する。2.2.x中にあるバグは、新しくインストールされたプリンタの認識を妨害する。Sambaを再起動するか、少なくともこれに対応するために、動作中のすべてのsmbdに対してHUPシグナルを<strong class="userinput"><code>kill -HUP `pidof smbd`</code></strong>のように送信する必要がある。</p></div></div></div></div><div class="sect1" title="クライアントドライバのインストール方法"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2646144"></a>クライアントドライバのインストール方法</h2></div></div></div><p>Don Quixote曰く、<span class="quote">“<span class="quote">論より証拠</span>”</span>。印刷することでセットアップした内容の証明ができる。そのため、クライアントPC上にプリンタドライバをインストールしてみよう。が、これは思ったよりも簡単ではない。以下で説明する。</p><div class="sect2" title="最初のクライアントドライバインストール"><div class="titlepage"><div><div><h3 class="title"><a name="id2646162"></a>最初のクライアントドライバインストール</h3></div></div></div><p>特に重要なことは、最初のクライアントPCへのインストール(各アーキテクチャプラットフォームごとに)である。一度これが正常に終わると、その後他のクライアントへは、簡単にセットアップでき、さらなる注意事項は必要ない。以下でフォローすることは、推奨する最初の手順の説明である。ここから先はクライアントワークステーションで作業する。そのクライアントからの接続が書き込みできない<span class="emphasis"><em>bad user</em></span> nobodyにマップされていないことを確認する。DOSプロンプトで以下を入力する:</p><p><strong class="userinput"><code>net use \\<em class="replaceable"><code>SAMBA-SERVER</code></em>\print$ /user:root</code></strong></p><p>必要であれば、<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>で定義している他の有効なユーザにrootを置き換える。異なったユーザですでに接続しているならば、エラーメッセージが表示される。Windowsは共有の接続からログオフする概念が内容に見えるので、その接続のridを取得するのに簡単な方法はない(ローカルワークステーションからのログオフと混同しないように。それは別の事柄である)。Windows NT/200x上では、<span class="emphasis"><em>workstation</em></span>サービスを再起動することで、すべての smb/cifs接続から強制的にログオフすることができる。Windows ファイルエクスプローラとWindows用のMSIEのすべてを閉じることを試みることができる。苦肉の策として、再起動しても良い。自動的な再接続の設定が無いことを理解すること。別のワークステーションに行ってそこからつなぐ方が簡単かもしれない。printer adminユーザとして接続出来た後(Samba上の<code class="literal">smbstatus</code>コマンドでこれを確認できる)、Windowsワークステーションから以下を実行する:</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>	<span class="guiicon">ネットワークコンピュータ</span>を開く。	</p></li><li class="step" title="Step 2"><p>	Sambaサーバをブラウズする。	</p></li><li class="step" title="Step 3"><p>	その<span class="guiicon">プリンタとFAX</span>フォルダを開く。	</p></li><li class="step" title="Step 4"><p>	プリンタを選択して右クリックする。	</p></li><li class="step" title="Step 5"><p>	<span class="guimenuitem">接続</span>を選択(Windows NT4/200xでは	おそらくそれは<span class="guimenuitem">インストール</span>であろう)。	</p></li></ol></div><p>新しいプリンタ(Sambaサーバ上で<em class="replaceable"><code>printername</code></em>という名前の)が<span class="emphasis"><em>ローカル</em></span>のプリンタフォルダ中に現れるはずである(<span class="guimenu">スタート</span> -> <span class="guimenuitem">設定</span> -> <span class="guimenuitem">コントロールパネル</span> -> <span class="guiicon">プリンタとFAX</span>で確認)。</p><p><a class="indexterm" name="id2646359"></a>おそらくは、印刷テストページを出力しようとしているだろう。全部終わった後、プリンタのプロパティを開き、<span class="guimenu">全般</span>タブ上に、これを行うためのボタンがある。しかし、やってみると"<code class="literal">印刷テストページを印刷できませんでした</code>"というエラーメッセージが表示される。これは、そのドライバに対して有効なデバイスモードセットがないか、<span class="quote">“<span class="quote">プリンタドライバデータ</span>”</span>セットが引き続き不完全状態という理由による。</p><p>有効な<em class="parameter"><code>デバイスモード</code></em>を、ドライバのために設定する必要がある。それがどういう意味かはこれから説明する。</p></div><div class="sect2" title="新しいプリンタに対するデバイスモードの設定"><div class="titlepage"><div><div><h3 class="title"><a name="prt-modeset"></a>新しいプリンタに対するデバイスモードの設定</h3></div></div></div><p>Windows NT/200x/XPクライアントからプリンタが完璧に使えるようにするには、以下の作業が必要である:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2646433"></a>	有効な<span class="emphasis"><em>デバイスモード</em></span>は、プリンタ用のドライバによって生成	される(紙のサイズ、方向と両面印刷の設定などを定義)。	</p></li><li class="listitem"><p><a class="indexterm" name="id2646451"></a>	ドライバによって生成される<span class="emphasis"><em>プリンタドライバデータ</em></span>の完全なセット。	</p></li></ul></div><p><a class="indexterm" name="id2646468"></a><a class="indexterm" name="id2646475"></a><a class="indexterm" name="id2646482"></a><a class="indexterm" name="id2646489"></a><a class="indexterm" name="id2646496"></a>これらのどれかが不完全だと、クライアントはせいぜい最適な出力以下しか作成できない。最悪の場合、プリンタから読めないゴミが出力されたり、何も出なかったりするか、印刷時にエラーメッセージが出る。Sambaは名前つきの値と、すべての印刷に関連する情報をその内部TDBデータベースファイル(<code class="filename">ntprinters.tdb</code>, <code class="filename">ntdrivers.tdb</code>,<code class="filename">printing.tdb</code>,と <code class="filename">ntforms.tdb</code>)に格納する。</p><p>デバイスモードとプリンタドライバデータのセットはすべてのプリントキュープロパティのための基本的な設定の集合体であり、賢明な方法で初期化される。デバイスモードとプリンタドライバデータは、印刷サーバ(Sambaホスト)上で健全な値に初期化されるべきであり、そして、クライアントは直接それらを使い始めることが出来る。どのように初期の健全な値を設定したらよいだろうか?これは、以下の節で説明されるように、あるNT(か200x/XPクライアント)からドライバをリモートでアクセスすることで行える。</p><p>有効なデバイスモードは<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>かrootによってのみ初期化できる(理由は明白であろう)ことに気がつくこと。デバイスモードはプリンタドライバプログラムそれ自身を実行することのみで正しく設定できる。SambaはこのWin32プラットフォームドライバプログラムを実行できないので、この設定は初期状態ではNULLになる(クライアントが使うためには有効な設定ではない)。幸いなことに、ほとんどのドライバは、APWの助けかrpcclientで<em class="parameter"><code>[print$]</code></em>にアップロードされた時、必要であれば、自動的にプリンタドライバデータを生成する。</p><p>最初の有効なデバイスモードの生成と設定は、しかし、Sambaサーバ上にそれをクライアントから設定するには若干のトリックを必要とする。最も簡単な方法は、サーバのプリンタ上のページの方向を単純に変更することである。これは求められる効果を起こすために、クライアント上でプリンタドライバプログラムを実行することで十分であり、Sambaサーバに新しいデバイスモードを戻す。これを行うためには、Windowsクライアントから、ネイティブなWindows NT/200x/XPプリンタプロパティを、下記のようにして使うことが出来る:</p><div class="procedure" title="Procedure 21.1. プリンタドライバ設定の初期化手続き"><a name="id2646636"></a><p class="title"><b>Procedure 21.1. プリンタドライバ設定の初期化手続き</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>	<span class="guiicon">ネットワークコンピュータ</span>をブラウズする。	</p></li><li class="step" title="Step 2"><p>	Sambaサーバを見つける。	</p></li><li class="step" title="Step 3"><p>	Sambaサーバの<span class="guiicon">プリンタとFAX</span>フォルダを開く。	</p></li><li class="step" title="Step 4"><p>	問い合わせ中の共有プリンタを選択する。	</p></li><li class="step" title="Step 5"><p>	プリンタ上で右クリックする(最後の節の説明に従っているならすでにここにいるはずである)。	</p></li><li class="step" title="Step 6"><p>	コンテキストメニューの下部にある<span class="guimenu">プロパティ</span>を選択する(もっと上に	引き続き<span class="guimenuitem">接続</span>エントリを表示しているなら、直近の節で説明	したように、ドライバのインストールを完了するためにそれをクリックする必要がある)。	</p></li><li class="step" title="Step 7"><p>	<span class="guilabel">詳細</span>タブに移動し、<span class="guibutton">印刷の定義</span>をクリックする。	</p></li><li class="step" title="Step 8"><p>	ページの設定を<span class="guimenuitem">縦</span>から<span class="guimenuitem">横</span>に変更する(そして戻す)。	</p></li><li class="step" title="Step 9"><p>	変更が実際に効果を引き起こすように、ページ方向の変更の確定を確実に行う。	</p></li><li class="step" title="Step 10"><p>	そこに居る間、他のクライアントにおけるドライバインストール時に適用される、	印刷の既定値を設定してもよい。	</p></li></ol></div><p>この手続きは、クライアントプラットフォーム上でプリンタドライバプログラムを動かし、正しいデバイスモードをSambaにフィードバックし、そして、それをTDBファイルに格納する。一度ドライバがクライアント上にインストールされると、もしもSambaのprinter adminユーザであれば、<span class="emphasis"><em>local</em></span>の<span class="guiicon">プリンタ</span>フォルダにアクセスすることによって、類似したステップを行うことも出来る。ここから、印刷作業は期待した通りに動作する。</p><p><a class="indexterm" name="id2646811"></a>Sambaには、プリンタのための既定値のデバイスモードを生成するための、サービスレベルの<em class="parameter"><code>default devmode</code></em>という名前のパラメータがある。ある種のドライバ機能は既定値のプロパティの値でうまく機能する。その他はクライアントのスプーラサービスをクラッシュするかもしれない。そのたえm、このパラメータの使用には注意が必要である。プリンタに対する有効なデバイスモードをクライアントに作成させることと、使用しているサーバにそれを格納することは、常時よりよい方法である。</p></div><div class="sect2" title="追加のクライアントドライバインストール"><div class="titlepage"><div><div><h3 class="title"><a name="id2646848"></a>追加のクライアントドライバインストール</h3></div></div></div><p><a class="indexterm" name="id2646857"></a>各追加ドライバは、今説明してきたことと同じ方法でインストールできる。<code class="literal">ネットワークコンピュータ</code>をブラウズし、Sambaサーバ上の<span class="guiicon">プリンタ</span>アイコンを開き、<span class="guiicon">プリンタ</span>を右クリックし、<span class="guimenuitem">接続</span>を選択する。一度これが完了すると(数秒以上はかからないが、ネットワークに依存するので、分単位でかかるときもある)、クライアントワークステーションの、ローカルの<span class="guiicon">プリンタとFAX</span>フォルダ中に新しいプリンタが現れる。</p><p>Windows 200x/XP Professionalワークステーション上で以下のコマンドを使うことによって、ローカルの<span class="guiicon">プリンタとFAX</span>フォルダを開くことが出来る。</p><pre class="screen"><strong class="userinput"><code>rundll32 shell32.dll,SHHelpShortcuts_RunDLL PrintersFolder</code></strong></pre><p>一方Windows NT 4.0ワークステーションでは以下のように行う:<a class="indexterm" name="id2646933"></a></p><pre class="screen"><strong class="userinput"><code>rundll32 shell32.dll,Control_RunDLL MAIN.CPL @2</code></strong></pre><p></p><p><span class="guilabel">DOS プロンプト</span>ウィンドウ内か、<span class="guimenu">スタート</span>メニュー中の<span class="guimenuitem">コマンドを指定して実行</span>のどちらかで入力できる。</p></div><div class="sect2" title="常時最初のクライアントからの接続はrootか“printer admin”で行う"><div class="titlepage"><div><div><h3 class="title"><a name="id2646977"></a>常時最初のクライアントからの接続はrootか<span class="quote">“<span class="quote">printer admin</span>”</span>で行う</h3></div></div></div><p>Sambaサーバ上にドライバをインストール後(その<em class="parameter"><code>[print$]</code></em>共有中に)、常時最初のクライアントインストールを正しく完了させねばならない。クライアントから<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>として、まさしくその最初の接続を確立することを習慣づけるようにすること。これは、以下のように行う:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	最初の有効な<span class="emphasis"><em>デバイスモード</em></span>が実際に初期化される(詳細な説明は	<a class="link" href="classicalprinting.html#prt-modeset" title="新しいプリンタに対するデバイスモードの設定">新しいプリンタ上のデバイスモードの設定</a>を参照)。	</p></li><li class="listitem"><p>		今後のすべてのクライアントインストールのための、使用しているプリンタの既定値の	プリンタ設定は期待するようになる。	</p></li></ul></div><p>上の方向を横に変更し、<span class="guiicon">適用</span>をクリックし、再度戻すことでこれを行う。次に、他の設定を変更する(たとえば、常時 <span class="guiicon">A4</span>を使っているときに、紙のサイズを<span class="guiicon">レター</span>に既定値を変更したくないであろう?既定値として<span class="guiicon">両面印刷</span>にプリンタを設定したいかもしれないなど)。</p><p><a class="indexterm" name="id2647082"></a>Sambaプリンタにrootとして接続するためには、以下のコマンドをWindows 200x/XPのDOSプロンプトから実行する:</p><pre class="screen"><code class="prompt">C:\> </code><strong class="userinput"><code>runas /netonly /user:root "rundll32 printui.dll,PrintUIEntry /p /t3 /n 	\\<em class="replaceable"><code>SAMBA-SERVER</code></em>\<em class="replaceable"><code>printername</code></em>"</code></strong></pre><p></p><p><code class="constant">root</code>のSambaパスワードを入力し、しばらく待ち、<span class="guibutton">印刷の既定値</span>をクリックし、すべてのクライアントで使われる既定値とすべきジョブオプションを設定する。代替として、<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>の設定中のメンバの中の名前をrootの代わりとして使うことが出来る。</p><p>これで、他のすべてのユーザは同じ方法でドライバのダウンロードとインストールが(<code class="literal">ポイントアンドプリント</code>を使って)出来るようになり、既定値も同じように設定される。もしも、このステップに失敗したら、ユーザからたくさんの問い合わせが来ることになるが、たくさんおしゃべりが出来て楽しいことになるだろう。</p></div></div><div class="sect1" title="その他のテクニック"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2647170"></a>その他のテクニック</h2></div></div></div><p>ドライバはインストールされた。クライアントによるポイントアンドプリントインストールは準備ができた。最初のクライアントマシンでダウンロードして使ってみてもよいが、ちょっと待ってほしい。その前に、有用だと思われる、ちょっとした助言とこつをここで伝授する。たとえば、前の節で助言したような、プリンタに既定値を設定しなかったとする。利用者は多くの問題に不満を言うだろう(たとえば、<span class="quote">“<span class="quote">各ジョブにレターからA4への紙のサイズの変更を必要とし、それが格納できない</span>”</span>など)。</p><div class="sect2" title="クライアントドライバのための既定値の印刷操作の設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2647194"></a>クライアントドライバのための既定値の印刷操作の設定</h3></div></div></div><p>最後の文は、若干のユーザと管理者には複雑な気持ちになるかもしれない。何時間もかけて苦労したのに、設定をセーブできると思ったらそれが出来なかった。それはやった人の問題ではない。混乱する点は、プリンタ名上で右クリックをした時にポップアップされる複数のタブを持つダイアログ中で<span class="guimenuitem">プロパティ</span>を選択したとき、同一であるように見える2つのダイアログが現れ、それぞれは3つの異なった方法でプリンタのオプション設定を手助けすると言ってくるということである。これの完璧な答えは、Sambaの既定値のドライバ設定FAQにある:</p><p title="“Windows 200x/XP上ですべてのユーザで既定値のプリンタオプションを 設定しセーブできない。なぜ?”"><b><span class="quote">“<span class="quote">Windows 200x/XP上ですべてのユーザで既定値のプリンタオプションを設定しセーブできない。なぜ?</span>”</span>. </b>どのようにそれを行っている?操作を間違っているのではないか(確かにそれを見つけるのは簡単ではないが)。すべてを設定するダイアログを起動するのに3つのやり方がある。すべての3つのダイアログは同じように見えるが、そのうちの1つが意図したものである。すべてのユーザのためにAdministratorかPrint Administratorでこれを行う必要がある。XP Professionalでどのようにこれを再現したかは以下の通り:</p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>最初の<span class="quote">“<span class="quote">間違った</span>”</span>方法:	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Open the <span class="guiicon">Printers</span> folder.</p></li><li class="listitem"><p>プリンタ(<span class="emphasis"><em>cupshost上のリモートプリンタ</em></span>)を右クリックし、		コンテキストメニューの<span class="guimenu">印刷のプリファレンス...</span>を選択する。</p></li><li class="listitem"><p>しっかりとこのダイアログを見て、どのように見えるかを覚えておくこと。</p></li></ol></div></li><li class="listitem"><p>2番目の<span class="quote">“<span class="quote">間違った</span>”</span>方法:		</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="guimenu">プリンタ</span>フォルダを開く。</p></li><li class="listitem"><p>プリンタ(<span class="emphasis"><em>cupshost上のリモートプリンタ</em></span>)			を右クリックし、コンテキストメニューの			<span class="guimenuitem">プロパティ</span></p>を選択する。</li><li class="listitem"><p><span class="guilabel">全般</span>タブをクリックする。			</p></li><li class="listitem"><p><span class="guibutton">印刷のプリファレンス...</span>			ボタンをクリックする。</p></li><li class="listitem"><p>新しいダイアログが開く。このダイアログを開いたままにして			親のダイアログに戻る。</p></li></ol></div><p>	</p></li><li class="listitem"><p>	3番目の正しい方法(これを最初に行うべきであり、そのあと上記で説明した2番目の方法の	ステップ1と2を行う):	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="guilabel">詳細</span>タブをクリックする			(もしもすべてが<span class="quote">“<span class="quote">灰色で選択できない</span>”</span>ならば、十分な			権限を持つユーザでログインしていない)。</p></li><li class="listitem"><p><span class="guibutton">印刷の既定値</span>ボタンを			クリックする。</p></li><li class="listitem"><p>2つの新しいタブ上のどれかで、			<span class="guilabel">詳細</span>ボタンをクリックする。</p></li><li class="listitem"><p>新しいダイアログが開く。これを他と比較する。これらは			<span class="quote">“<span class="quote">B.5</span>”</span>からのものとA.3からのものと比較したときに同じか?</p></li></ol></div></li></ol></div><p title="“Windows 200x/XP上ですべてのユーザで既定値のプリンタオプションを 設定しセーブできない。なぜ?”">2つの設定ダイアログで何らかの違いがあっただろうか?そうではないはずであろう。しかし、最後のもののみ、ステップC.1からC.6までの処理は、新しいユーザのために既定値となる、任意の設定を恒常的に保存する。もしも全クライアントに同じ既定値を設定したいならば、クライアントがドライバをダウンロードする前に(上記のAまたはBの手順に従うことで、クライアントはユーザ毎の既定値を後で設定出来る)、管理者(<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>)としてそれらのステップを行う必要がある。Windows 200x/XPはユーザ毎の既定値設定が出来、その管理者はそれら固有の設定を行う前にそれを提供する。同一に見えるダイアログの親は、そのウィンドウ名が微妙に違っている。1つは<code class="computeroutput">サーバBar上のプリンタFoo用の既定値の印刷値</code>(これが必要なもの)と呼ばれ、もう1つは、<span class="quote">“<span class="quote"><code class="computeroutput">サーバBar上のプリンタFooの用の印刷設定</code></span>”</span>と呼ばれる。最後のものは、プリンタを右クリックし、<span class="guimenuitem">印刷設定...</span>を選択した時に現れるものである。これは、Windows NTの時代に使うことを教わったものであり、Windows 200x/XPはで同じように試すのはとても自然である。同じように見えるものに到達する異なったパスがあるとは夢にも思わないだろうが、機能は異なり、すべてのユーザに既定値を設定するダイアログである。</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>(Windows 200x/XP上で)このコマンドを動かしてみる(正しい権限を持つユーザで):<a class="indexterm" name="id2647534"></a></p><p><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /p /t3 /n\\<em class="replaceable"><code>SAMBA-SERVER</code></em>\<em class="replaceable"><code>printersharename</code></em></code></strong></p><p><span class="guilabel">印刷の既定値</span>ボタン(必要としているもの)があるタブを見るには以下のコマンドを実行する:</p><p><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /p /t0 /n\\<em class="replaceable"><code>SAMBA-SERVER</code></em>\<em class="replaceable"><code>printersharename</code></em></code></strong></p><p><span class="guilabel">印刷のプリファレンス</span>ボタンを持つタブを見るには(システム全体の既定値を設定しない)、DOSプロンプト内でコマンドを実行するか、<span class="guimenu">スタート</span> -> <span class="guimenuitem">実行</span>を選択する。</p></div></div><div class="sect2" title="大量のプリンタのサポート"><div class="titlepage"><div><div><h3 class="title"><a name="id2647609"></a>大量のプリンタのサポート</h3></div></div></div><p>昨今のSamba 開発フェーズにおいて浮かび上がった問題は、さまざまな種類のプリンタに関してドライバのダウンロードサポートが必要なことである。Windows NT の APW(Add Printer Wizard)を使うやり方は(控えめに言っても)筋が良いとはいえない。一人でクリック祭りをやりながらプリンタのインストールをやりつつ反復性緊張症候群(RSS)の苦痛をを味わいたくなければ、非会話的なスクリプトについて検討する必要があるだろう。</p><p>複数のプリンタが同じドライバを使う場合、<code class="literal">rpcclient setdriver</code>コマンドはインストールされたキューに結合されたドライバを設定するために使える。もしもドライバが<em class="parameter"><code>[print$]</code></em>で一度更新され、印刷用TDBファイルに登録されると、複数の印刷キューによって使うことができる。この場合、すべてのキューに対して(<code class="literal">adddriver</code>を繰り返し実行する必要なしに)<code class="literal">rpcclient</code>の<code class="literal">setprinter</code>サブコマンドを繰り返す必要がある。以下はどのようにこれを達成するかの例である:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient <em class="replaceable"><code>SAMBA-CUPS</code></em> -U root%<em class="replaceable"><code>secret</code></em> -c 'enumdrivers'</code></strong> cmd = enumdrivers  [Windows NT x86] Printer Driver Info 1:   Driver Name: [infotec  IS 2075 PCL 6]  Printer Driver Info 1:   Driver Name: [DANKA InfoStream]  Printer Driver Info 1:   Driver Name: [Heidelberg Digimaster 9110 (PS)]  Printer Driver Info 1:   Driver Name: [dm9110] Printer Driver Info 1:   Driver Name: [mydrivername] [....]</pre><p></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient <em class="replaceable"><code>SAMBA-CUPS</code></em> -U root%<em class="replaceable"><code>secret</code></em> -c 'enumprinters'</code></strong> cmd = enumprinters   flags:[0x800000]   name:[\\SAMBA-CUPS\dm9110]   description:[\\SAMBA-CUPS\dm9110,,110ppm HiVolume DANKA Stuttgart]   comment:[110 ppm HiVolume DANKA Stuttgart] [....]</pre><p></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient <em class="replaceable"><code>SAMBA-CUPS</code></em> -U root%<em class="replaceable"><code>secret</code></em> -c \  'setdriver <em class="replaceable"><code>dm9110</code></em> "<em class="replaceable"><code>Heidelberg Digimaster 9110 (PS)</code></em>"'</code></strong> cmd = setdriver dm9110 Heidelberg Digimaster 9110 (PPD) Successfully set dm9110 to driver Heidelberg Digimaster 9110 (PS).</pre><p></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient <em class="replaceable"><code>SAMBA-CUPS</code></em> -U root%<em class="replaceable"><code>secret</code></em> -c 'enumprinters'</code></strong> cmd = enumprinters   flags:[0x800000]   name:[\\SAMBA-CUPS\dm9110]   description:[\\SAMBA-CUPS\dm9110,Heidelberg Digimaster 9110 (PS),\     110ppm HiVolume DANKA Stuttgart]   comment:[110ppm HiVolume DANKA Stuttgart] [....]</pre><p></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient <em class="replaceable"><code>SAMBA-CUPS</code></em> -U root%<em class="replaceable"><code>secret</code></em> -c 'setdriver <em class="replaceable"><code>dm9110</code></em> <em class="replaceable"><code>mydrivername</code></em>'</code></strong> cmd = setdriver dm9110 mydrivername Successfully set dm9110 to mydrivername.</pre><p></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient <em class="replaceable"><code>SAMBA-CUPS</code></em> -U root%<em class="replaceable"><code>secret</code></em> -c 'enumprinters'</code></strong> cmd = enumprinters   flags:[0x800000]   name:[\\SAMBA-CUPS\dm9110]   description:[\\SAMBA-CUPS\dm9110,mydrivername,\     110ppm HiVolume DANKA Stuttgart]   comment:[110ppm HiVolume DANKA Stuttgart] [....]</pre><p>(説明フィールドの2つのカンマの間に)ドライバが一覧表示される、空の文字列がある<span class="quote">“<span class="quote">dm9110</span>”</span>プリンタが表示される最初の<code class="literal">enumprinters</code>呼び出しを認識するのは簡単ではないかもしれない。<code class="literal">setdriver</code>コマンドの成功後、すべてはうまくいく。</p></div><div class="sect2" title="Windows NT APWによる新しいプリンタの追加"><div class="titlepage"><div><div><h3 class="title"><a name="id2647878"></a>Windows NT APWによる新しいプリンタの追加</h3></div></div></div><p>既定値では、Sambaは<code class="filename">smb.conf</code>中で定義されているすべてのプリンタ共有を、<span class="guiicon">プリンタ</span>フォルダに表示する。また、このフォルダ中にWindows NTのプリンタ追加ウィザードアイコンも配置される。APWは下記の条件の時にのみ表示される:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	接続したユーザは管理者権限つきで<code class="literal">OpenPrinterEx(\\server)</code>を	正常に実行できる(すなわち、root又は<a class="link" href="smb.conf.5.html#PRINTERADMIN" target="_top">printer admin</a>)。	</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p> Windows 200x/XP DOSプロント内で下記を試してみる:	</p><p><strong class="userinput"><code>	runas /netonly /user:root rundll32 printui.dll,PrintUIEntry /p /t0 /n \\<em class="replaceable"><code>SAMBA-SERVER</code></em>\<em class="replaceable"><code>printersharename</code></em>	</code></strong></p><p>	<span class="guibutton">印刷のプリファレンス</span>をクリックする。	</p></div></li><li class="listitem"><p>... は下記の設定を含む	<a class="link" href="smb.conf.5.html#SHOWADDPRINTERWIZARD" target="_top">show add printer wizard = yes</a> (既定値)	default)。</p></li></ul></div><p>APWではいろいろなことが出来る:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	新しいドライバをSambaの<em class="parameter"><code>[print$]</code></em>共有にアップロードする。	</p></li><li class="listitem"><p>	存在している印刷キューに(ただしまだドライバがない)アップロードされたドライバを関連づける。	</p></li><li class="listitem"><p>	存在する印刷キューに対して、以前にアップロードされたものと、現在使っているドライバを、交換する。	</p></li><li class="listitem"><p>	Sambaホストに、完全な形で新しいプリンタを追加する(動作する	<a class="link" href="smb.conf.5.html#ADDPRINTERCOMMAND" target="_top">add printer command</a>と組み合わせる場合のみ。	<span class="guiicon">プリンタ</span>フォルダからエントリを削除するための	<a class="link" href="smb.conf.5.html#DELETEPRINTERCOMMAND" target="_top">delete printer command</a>も提供してもよい)。	</p></li></ul></div><p>最後のもの(プリンタの追加)はその前のものよりもより多くの努力を必要とする。Sambaサーバに正しくプリンタを追加するのにAPWを使うためには、<a class="link" href="smb.conf.5.html#ADDPRINTERCOMMAND" target="_top">add printer command</a>に値が定義されている必要がある。プログラムホックは、正しくUNIX印刷システム(すなわち<code class="filename">/etc/printcap</code>、<code class="filename">/etc/cups/printers.conf</code>か他の適切なファイル)と、必要であれば<code class="filename">smb.conf</code>にプリンタを追加しなければならない。</p><p>クライアントからAPWを使うとき、名前が付いたプリンタ共有が存在しない場合、smbdは<a class="link" href="smb.conf.5.html#ADDPRINTERCOMMAND" target="_top">add printer command</a>を実行し、新しいプリンタ共有を配置するために、再度検索する。もしも共有がやはり定義されていないのであれば、クライアントに<span class="errorname">"アクセスが拒否されました"</span>が返る。ユーザが接続している状態においての<a class="link" href="smb.conf.5.html#ADDPRINTERCOMMAND" target="_top">add printer command</a>の実行は、rootアカウントの必要はない。<a class="link" href="smb.conf.5.html#MAPTOGUEST" target="_top">map to guest = bad user</a>は間違った権限で書き込みが出来なくなる接続をしてしまうだろう。<code class="literal">smbstatus</code>コマンドを使ってこのことを検査すべきである。</p></div><div class="sect2" title="エラーメッセージ: “異なった名前で接続できない”"><div class="titlepage"><div><div><h3 class="title"><a name="id2648170"></a>エラーメッセージ: <span class="quote">“<span class="quote">異なった名前で接続できない</span>”</span></h3></div></div></div><p>間違った認証情報で接続してしまった場合、すべてのエクスプローラ画面を閉じ、リブートする以外に、この状況を解決する方法はない。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2648193"></a>	<code class="literal">net use \\SAMBA-SERVER\sharename /user:root</code>を使うと以下の	エラーメッセージが表示される:	<span class="quote">“<span class="quote">サーバか共有リソースへの、複数の接続か、同じユーザによっていくつかの	ユーザ名を使う事は許可されない。特にサーバ、共有リソースへのすべての接続を	切断し再度試してみる。</span>”</span>	</p></li><li class="listitem"><p>	<span class="quote">“<span class="quote">ネットワークドライブへの割り当て</span>”</span>->	<code class="filename">\\SAMBASERVER\\print$</code>-><code class="constant">z:</code>へのすべての	試みは、以下のようなメッセージがしつこく表示される:	<span class="quote">“<span class="quote">このネットワークフォルダは現在異なった認証情報(ユーザ名とパスワード)の元で	接続されている。異なったユーザ名とパスワードで再度接続するために、この	ネットワーク共有への接続まず初めに切断する。</span>”</span>	</p></li></ul></div><p>そのためすべての接続をクローズする。そして再実行する。そうすると同じメッセージが出る。<code class="literal">smbstatus</code>を使ってSamba側でチェックを行う。するといくつか接続されているのが分かる。それらをkillする。そうしてもクライアントは同じメッセージを出す。デバッグレベルを上げて、再接続してsmbd.logをチェックする。ログ中に1行ではない、いくつかのエラーメッセージがある事が分かる。何らかの接続があったかどうかを考えて見始める。接続するときの状況を見るため、wiresharkかtcpdumpを走らせてみる。結果はこうなる:たくさんのデータがネットワーク上に出ている。Windowsは引き続きエラーメッセージを表示している。エクスプローラのウィンドウをクローズして、再度起動する。再度接続すると今回はうまくいった!Windowsは接続情報をどこかにキャッシュしているように見え、それは最新状態にしていない(不幸な場合、エラーメッセージを除去するためにリブートの必要があるかもしれない)。</p><p>クライアントからサーバへのすべての接続を強制的に終了する最も簡単な方法は以下を実行する:</p><pre class="screen"><code class="prompt">C:\> </code> net use * /delete</pre><p>これは、マップされたドライバすべても切断し、要求に応じて新しい接続が出来るようにする。</p></div><div class="sect2" title="ドライバファイルを集めるときに気をつけること"><div class="titlepage"><div><div><h3 class="title"><a name="id2648304"></a>ドライバファイルを集めるときに気をつけること</h3></div></div></div><p>特定のドライバに帰属するファイルについて注意するときにはきわめて注意深くする必要がある。ドライババージョン<span class="quote">“<span class="quote">0</span>”</span>(Windows 9x/Me用で<code class="filename">[print$]/WIN/0/</code>に入るもの)とドライババージョン<code class="filename">2</code>(Windows NTのカーネルモードドライバで、<code class="filename">[print$]/W32X86/2/</code>に入るもので、Windows 200x/XPでも使われる)と、ドライババージョン<span class="quote">“<span class="quote">3</span>”</span>(非カーネルモードドライバで、<code class="filename">[print$]/W32X86/3/</code>に入るもので、Windows NTでは使われない)のためのファイルを混同してはならない。これら異なったドライバのバージョンは同じ名前のファイルを含んでいるが実際には全く異なることがとても多い。Sambaから<code class="literal">enumdrivers</code>コマンドで、大小文字が混じったか、小文字のみで表示されている間、もしもそれらをWindowsエクスプローラ(<code class="filename">%WINDOWS%\system32\spool\drivers\W32X86\</code>内にある)で見る時、大文字で名前を見ることになるので、とてもこれらを混同しやすくなる。もしも、<code class="literal">rpcclient</code>とサブコマンドを使い、手動でそれらをインストールした場合、何のエラーメッセージもなしに成功する。その後、クライアント上にインストールしようとしたとき、<code class="computeroutput">このサーバはプリンタに対する適切なドライバを持っていない</code>というエラーメッセージを受け取ることになる。</p><p>以下は例である。しっかりと数多くのファイルに対して、その名前と綴りを確認し、バージョン2と3の構成において、その違いを見いだすことが求められる。注意:バージョン0には40の<em class="parameter"><code>依存するファイル</code></em>があるので、紙面節約のためにそれらは削除してある:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>rpcclient -U 'Administrator%<em class="replaceable"><code>secret</code></em>' -c 'enumdrivers 3' 10.160.50.8 </code></strong> Printer Driver Info 3:         Version: [3]         Driver Name: [Canon iR8500 PS3]         Architecture: [Windows NT x86]         Driver Path: [\\10.160.50.8\print$\W32X86\3\cns3g.dll]         Datafile: [\\10.160.50.8\print$\W32X86\3\iR8500sg.xpd]         Configfile: [\\10.160.50.8\print$\W32X86\3\cns3gui.dll]         Helpfile: [\\10.160.50.8\print$\W32X86\3\cns3g.hlp]          Dependentfiles: [\\10.160.50.8\print$\W32X86\3\aucplmNT.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\ucs32p.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\tnl32.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\aussdrv.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cnspdc.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\aussapi.dat]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cns3407.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\CnS3G.cnt]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\NBAPI.DLL]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\NBIPC.DLL]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcview.exe]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcdspl.exe]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcedit.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcqm.exe]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcspl.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cfine32.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcr407.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\Cpcqm407.hlp]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcqm407.cnt]         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cns3ggr.dll]          Monitorname: []         Defaultdatatype: [] Printer Driver Info 3:         Version: [2]         Driver Name: [Canon iR5000-6000 PS3]         Architecture: [Windows NT x86]         Driver Path: [\\10.160.50.8\print$\W32X86\2\cns3g.dll]         Datafile: [\\10.160.50.8\print$\W32X86\2\IR5000sg.xpd]         Configfile: [\\10.160.50.8\print$\W32X86\2\cns3gui.dll]         Helpfile: [\\10.160.50.8\print$\W32X86\2\cns3g.hlp]          Dependentfiles: [\\10.160.50.8\print$\W32X86\2\AUCPLMNT.DLL]         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\aussdrv.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\cnspdc.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\aussapi.dat]         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\cns3407.dll]         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\CnS3G.cnt]         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\NBAPI.DLL]         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\NBIPC.DLL]         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\cns3gum.dll]          Monitorname: [CPCA Language Monitor2]         Defaultdatatype: []</pre><p>もしも<span class="quote">“<span class="quote">バージョン 2</span>”</span>ファイルと<span class="quote">“<span class="quote">バージョン 3</span>”</span>ファイルを異なったテキストファイルに書き込み、その結果を比較すると以下のようになる:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>sdiff 2-files 3-files</code></strong> cns3g.dll                     cns3g.dll iR8500sg.xpd                  iR8500sg.xpd cns3gui.dll                   cns3gui.dll cns3g.hlp                     cns3g.hlp AUCPLMNT.DLL                | aucplmNT.dll                             > ucs32p.dll                             > tnl32.dll aussdrv.dll                   aussdrv.dll cnspdc.dll                    cnspdc.dll aussapi.dat                   aussapi.dat cns3407.dll                   cns3407.dll CnS3G.cnt                     CnS3G.cnt NBAPI.DLL                     NBAPI.DLL NBIPC.DLL                     NBIPC.DLL cns3gum.dll                 | cpcview.exe                             > cpcdspl.exe                              > cpcqm.exe                             > cpcspl.dll                             > cfine32.dll                             > cpcr407.dll                             > Cpcqm407.hlp                             > cpcqm407.cnt                             > cns3ggr.dll</pre><p>だまされてはいけない!各バージョン用の、同一の名前のドライバファイルは、サイズを比較して分かるように、その内容が異なっているかもしれない:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>for i in cns3g.hlp cns3gui.dll cns3g.dll; do                  \           smbclient //10.160.50.8/print\$ -U 'Administrator%xxxx' \           -c "cd W32X86/3; dir $i; cd .. ; cd 2; dir $i";      \		   done</code></strong>  CNS3G.HLP               A   122981  Thu May 30 02:31:00 2002  CNS3G.HLP               A    99948  Thu May 30 02:31:00 2002  CNS3GUI.DLL             A  1805824  Thu May 30 02:31:00 2002  CNS3GUI.DLL             A  1785344  Thu May 30 02:31:00 2002  CNS3G.DLL               A  1145088  Thu May 30 02:31:00 2002  CNS3G.DLL               A    15872  Thu May 30 02:31:00 2002</pre><p>多くの例では、上記の例よりももっと違っている。結論:各ドライババージョン用の正しいドライバファイルを注意深く選択しなければならない。名前だけに頼っても、異なったドライババージョンに属するファイルを交換してもいけない。</p></div><div class="sect2" title="Sambaとプリンタポート"><div class="titlepage"><div><div><h3 class="title"><a name="id2648598"></a>Sambaとプリンタポート</h3></div></div></div><p><a class="indexterm" name="id2648607"></a><a class="indexterm" name="id2648614"></a><a class="indexterm" name="id2648620"></a><a class="indexterm" name="id2648627"></a>Windows NT/2000印刷サーバは各プリンタに対してポートを結びつける。これらは通常、<code class="filename">LPT1:</code>、<code class="filename">COM1:</code>、<code class="filename">FILE:</code>のような形式である。Sambaもプリンタに結びついたポートという概念をサポートせねばならない。既定値では、システム上<span class="quote">“<span class="quote">Sambaプリンタポート</span>”</span>という名前の1つのプリンタポートのみが存在する。Sambaは印刷するために、<span class="quote">“<span class="quote">ポート</span>”</span>のようなものは実際に必要はしていない。むしろ、これはWindowsクライアントの要求である。この情報を要求する時、有効なポートについて告知されることを強く要求する。それ以外だとエラーメッセージを表示する。そのため、SambaはWindowsクライアントに支障がないよう、ポート情報を偽装する。</p><p><a class="indexterm" name="id2648688"></a>Sambaは内部的に同等の<code class="constant">プリンタプーリング</code>という概念をサポートしていない。プリンタプーリングは論理プリンタを複数のポートに、ロードバランシングかフェイルオーバのように割り当てるものである。</p><p>もしも何らかの理由か、他の理由で(Sambaでそういうことが出来るか、ユーザと管理者は知るべきではないが)複数のポートを定義する要望がある場合、システム上のポートの一覧を生成する外部プログラムを定義するために使える<a class="link" href="smb.conf.5.html#ENUMPORTSCOMMAND" target="_top">enumports command</a>を設定する。</p></div><div class="sect2" title="共通クライアントドライバの間違った設定の防止"><div class="titlepage"><div><div><h3 class="title"><a name="id2648733"></a>共通クライアントドライバの間違った設定の防止</h3></div></div></div><p>印刷はうまくいっているが、まだ問題がある。ほとんどのジョブの印刷はうまくいくが、いくつかは全く印刷できない。いくつかのジョブはうまくいっていないように見えるフォントの問題を抱えている。いくつかのジョブは速やかに印刷するが、いくつかはとても遅い。それら全部について触れることは出来ないが、<a class="link" href="CUPS-printing.html" title="Chapter 22. CUPS印刷環境のサポート">CUPSによる印刷</a>の章の<span class="quote">“<span class="quote">間違ったPostscriptドライバ設定の防止</span>”</span>、<a class="link" href="CUPS-printing.html#cups-avoidps1" title="クライアント上での危険なPostScriptドライバ設定を防止する">クライアント上の危険なPostscriptドライバ設定の防止</a>の短い節を読むことを推奨する。</p></div></div><div class="sect1" title="Imprintsツールセット"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2648777"></a>Imprintsツールセット</h2></div></div></div><p><a class="indexterm" name="id2648786"></a>ImprintsツールセットはWindows NT APWの同等品をUNIXで提供する。完全な情報は、Imprintsのソースディストリビューションを含むドキュメントがある、<a class="ulink" href="http://imprints.sourceforge.net/" target="_top">Imprints</a>のWebサイトを参照してほしい。この節は、Imprintsの機能について簡単な紹介を提供するのみ行う。</p><p>不幸にも、Imprintsツールセットはもはやメンテナンスされていない。2000年12月からプロジェクトは新しいメンテナを必要としている。持つべきスキルのうち最も重要なものはPerlのコーディングとSambaで使うMS-RPCベースの印刷についての興味である。もしもボランティアを希望するならば、Sambaテクニカルメーリングリストで希望を調整してほしい。ツールセットはいまだに便利であるが、使うために準備されているパッケージは古いプリンタモジュールに対してのもののみである。Imprintsが持つべきであるならば、より更新されたプリンタドライバのパッケージが必要である。Imprintsにツールセットに関する情報は<a class="ulink" href="http://imprints.sourceforge.net/" target="_top">Imprints</a>ホームページから得ることが出来る。</p><div class="sect2" title="Imprintsとは何か?"><div class="titlepage"><div><div><h3 class="title"><a name="id2648847"></a>Imprintsとは何か?</h3></div></div></div><p>Imprintsは以下をサポートするためのツールの集合体である:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	Windows NTと 95/98プリンタドライバパッケージに関連する集中した情報のリポジトリを提供する。	</p></li><li class="listitem"><p>	Imprintsプリンタドライバパッケージを作成するためのツールを提供する。	</p></li><li class="listitem"><p>	中央のインターネット(又はイントラネット)Imprintsサーバリポジトリからプリンタドライバを	得、リモートのSambaとWindows NT印刷サーバ上にそれをインストールする事を提供する。	</p></li></ul></div></div><div class="sect2" title="プリンタドライバパッケージの作成"><div class="titlepage"><div><div><h3 class="title"><a name="id2648893"></a>プリンタドライバパッケージの作成</h3></div></div></div><p>プリンタドライバパッケージの作成手順はこのドキュメントの範囲外である(より詳細は、Sambaのディストリビューションに含まれているImprints.txtを参照)。簡単に言うと、Imprintsドライバパッケージは、ドライバファイル、関連するINFファイルとクライアントがインストールするのに必要な制御ファイルを含む、gzipされたtar形式ファイルである。</p></div><div class="sect2" title="Imprintsサーバ"><div class="titlepage"><div><div><h3 class="title"><a name="id2648914"></a>Imprintsサーバ</h3></div></div></div><p>Imprintsサーバは、実際には、標準HTTPメカニズム経由で問い合わせを受けることが出来るデータベースサーバである。データベース中の各プリンタエントリは、実際にダウンロードするパッケージを示すURLに関連づけられている。各パッケージは、実際にダウンロードしたものが、Imprintsデータベース中で参照されるものかどうかを検査できるよう、GnuPGを使ってデジタル署名されている。このセキュリティ検査を無効にしないことを強く推奨する。</p></div><div class="sect2" title="クライアントのインストール"><div class="titlepage"><div><div><h3 class="title"><a name="id2648934"></a>クライアントのインストール</h3></div></div></div><p>Imprintsクライアントに関連するさらなる情報は、Imprintsソースパッケージ中にある、<code class="filename">Imprints-Client-HOWTO.ps</code>という文書ファイルに書いてある。Imprintsクライアントインストールは以下の2つの形式がある:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>コマンドラインPerlスクリプト一式。</p></li><li class="listitem"><p>コマンドラインPerlスクリプトへのGTK+ベースのグラフィカルインタフェース</p></li></ul></div><p>(両方の形式による)クライアントのインストールは、リモートSambaとWindows NTプリントサーバ上へのダウンロードとドライバのインストールという意味と同じような、既存のプリンタモデル名の一致リストのための、Imprintsデータベースサーバに問い合わせる手段を提供する。</p><p>基本的なインストール手順は4つのステップがあり、Perlコードはsmbclientとrpcclientを包みこんでいる。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	与えられたドライバがサポートする各アーキテクチャに対して:	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>rpcclient: リモートサーバ上の適切なアップロードディレクトリを取得する。</p></li><li class="listitem"><p>smbclient: ドライバファイルをアップロードする。</p></li><li class="listitem"><p>rpcclient: AddPrinterDriver() MS-RPCを発行する。</p></li></ol></div><p>	</p></li><li class="listitem"><p>rpcclient: 実際にプリンタの作成を行うためにAddPrinterEx() MS-RPCを発行する。</p></li></ul></div><p>Imprintsツールセットを実装するときに発生した問題の1つは、数多くサポートされているクライアントアーキテクチャ間での名前空間の問題であった。例えば、Windows NTには<span class="quote">“<span class="quote">Apple LaserWriter II NTX v51.8</span>”</span>という名前のドライバを含んでいるが、Windows 95はこのドライバの対応するバージョン<span class="quote">“<span class="quote">Apple LaserWriter II NTX</span>”</span>を呼び出す。</p><p>問題は、プリンタに対してどんなクライアントドライバをアップロードするかということをどのようにして知るかと言うことである。抜け目がない読者は、Windows NTのプリンタプロパティのダイアログのみが、そのプリンタドライバ名に空白を含んでいることを覚えているだろう。下記のWindows NT 4.0システムレジストリを簡単に見てみると、</p><p><code class="filename"> HKLM\System\CurrentControlSet\Control\Print\Environment</code></p><p>これは、Windows NTが常時 NTドライバ名を使うことを明白にしている。これは、Windows NTが少なくともWindows NTバージョンのプリンタドライバが存在することを常時要求しているので問題はない。Sambaは内部的にはそれを要求しない。そのため、<span class="quote">“<span class="quote">すでにインストールされていないのに、なぜNTドライバ名を使うことが出来るのか?</span>”</span>という疑問が生じるだろう。</p><p>この限界を回避する方法は、すべてのImprintsドライバパッケージがIntel Windows NTと95/98プリンタドライバを含み、そのNTドライバが最初にインストールされることを要求することである。</p></div></div><div class="sect1" title="ユーザによるインストールなしにネットワークプリンタを追加する"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2649115"></a>ユーザによるインストールなしにネットワークプリンタを追加する</h2></div></div></div><p>以下のMS Knowledgeベースの記事は、Windows 2000クライアントを扱う必要がある場合に何らかの手助けになるかもしれない。<span class="emphasis"><em>ユーザーによる操作なしで Windows にプリンタを追加する方法</em></span>(<a class="ulink" href="http://support.microsoft.com/kb/189105/ja" target="_top">Microsoft KB 189105(日本語)</a>)。これは又Windows XP Professionalクライアントにも適用できる。この節で示すアイデアの概要は、ネットワークとローカルプリンタとそのドライバをインストールするために適用できるコマンドライン手法を説明するこの記事によって触発されたものである。これは、ログオンスクリプトと統合すると最も便利である。コマンドプロンプト(<code class="literal">DOSプロンプト</code>)で以下のようにタイプすることにより、どのようなオプションが有効かを見ることができる:</p><p><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /?</code></strong></p><p>すべての有効なコマンドラインスイッチを表示するウィンドウがポップアップする。 大規模な例題リストも提供される。これは、Windows 200x/XPのみである。Windows NT上では動作しない。Windows NTはそれぞれねリソースキット内である種の他のツールをおそらく持っている。各行が実際に何をするかについての簡単な説明がある、クライアントログオンスクリプトが含んでも良いかもしれないものについての助言は以下の通り(これはSamba経由で200x/XP Windowsクライアントがプリンタにアクセスする場合に動作し、さらに、Windowsベースのプリンタでも同様である)。</p><pre class="screen"><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /dn /n "\\cupsserver\infotec2105-IPDS" /q</code></strong><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /in /n "\\cupsserver\infotec2105-PS"</code></strong><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /y /n "\\cupsserver\infotec2105-PS"</code></strong></pre><p>コマンドラインパラメータで使われるパラメータの一覧である:</p><div class="variablelist"><dl><dt><span class="term">/dn</span></dt><dd><p>ネットワークプリンタを削除する。</p></dd><dt><span class="term">/q</span></dt><dd><p>表示を抑制する。</p></dd><dt><span class="term">/n</span></dt><dd><p>プリンタに名前を付ける。</p></dd><dt><span class="term">/in</span></dt><dd><p>ネットワークプリンタ接続を追加する。</p></dd><dt><span class="term">/y</span></dt><dd><p>プリンタを既定値のプリンタにする。</p></dd></dl></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	1行目では<span class="emphasis"><em>infotec2105-IPDS</em></span>という以前に存在していた可能性の	あるネットワークプリンタを削除する(CUPSに変換された、サーバから削除されたLPRngの	ネイティブなWindowsドライバで使われていた)。終わりにある<code class="literal">/q</code>	は、ポップアップする確認あるいはエラーダイアログボックスを抑制する。これらは	ユーザログオンについては提供されない。	</p></li><li class="listitem"><p>		2行目では、新しいプリンタ<span class="emphasis"><em>infotec2105-PS</em></span>(実際には同じ物理	デバイスであるが、新しいCUPS印刷システムによって動作し、CUPS/Adobe PSドライバ	と関連づけられる)を追加する。プリンタとそのドライバはユーザのログインに先立って	追加されねばならない(すなわち、この章の前の方で説明した手順か、	<code class="literal">cupsaddsmb</code>を動かすことによって)。ドライバはユーザがログイン	しようとしているときに、クライアントPCに自動的にダウンロードされる。	</p></li><li class="listitem"><p>	3行目では、この新しいネットワークプリンタを既定値のプリンタに設定する(この方法を	使っていくつかのプリンタが存在するかもしれなく、また、そのうちのいくつかは同じ	ようにローカルであってもよいので、既定値のプリンタを決める事が必要となる)。	既定値のプリンタの選択は、もちろん、異なったユーザでは異なっても良い。	</p></li></ul></div><p>2番目の行は、もしもプリンタ<span class="emphasis"><em>infotec2105-PS</em></span>がすでに<code class="constant">cupsserver</code>上のプリントキューで動作していて、もしもプリンタドライバがSambaのドライバリポジトリである<em class="parameter"><code>[print$]</code></em>中に、すでにきちんとアップロード(<code class="literal">APW</code>, <code class="literal">smbclient/rpcclient</code>か<code class="literal">cupsaddsmb</code>経由で)されている場合にのみ動作する。バージョン3.0より前のある種のSambaのバージョンでは、プリンタインストール後とドライバアップロード後にsmbdの再起動を要求する。そうでないと、スクリプト(かその他のルライアンとドライバダウンロード)は失敗する。</p><p>ログオンスクリプトからの、インストールされたネットワークプリンタの存在をテストする簡単な方法は無いので、わざわざ調べる必要はない。ユーザログイン時に毎回インストールの削除/再インストールが出来るようにしておくこと。それはとても短時間である(1から2秒くらい)。</p><p>ほかにこの件に関する有用な情報は以下の通り:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	全部のユーザログイン時に自動的に、任意のプリンタ既定値の設定変更を適切に設定する。	</p></li><li class="listitem"><p>	異なったワークステーションからドメインにユーザが<span class="quote">“<span class="quote">ローミング</span>”</span>でログイン出来るようにする。	</p></li></ul></div><p>各ユーザ毎にネットワークプリンタがインストールされるので、これにより、インストールの最新性を保持する作業をより単純化する。ログイン時に数秒余計にかけることはほとんど目立たないだろう。プリンタは、クライアントからユーザが介入する必要性なしにサーバ上で集中して追加、変更と削除ができる(ログインスクリプトは最新性を保持する必要はある)。</p></div><div class="sect1" title="addprinterコマンド"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2649468"></a><code class="literal">addprinter</code>コマンド</h2></div></div></div><p><code class="literal">addprinter</code>コマンドはSambaによって実行されるシェルスクリプトかプログラムとして設定できる。これはSambaプリントサーバに対してクライアントからAPWを走らせることによって起動される。APWはユーザにいくつかのフィールドを埋めることを要求する(それはたとえばプリンタ名、使用するドライバ、コメント、ポートモニタなど)。これらのパラメータはAPWによってSamba上に渡される。もしも、addprinterコマンドが新しいプリンタを作成できるように(旧式のシステム上で、適切なprintcapエントリを書くか、より新しいシステム上で<code class="literal">lpadmin</code>コマンドを実行することによって)と、それに関連する共有を作成するように設計されていた場合、APWはSamba上とUNIX印刷システム上に、結果として新しいプリンタを作る!</p></div><div class="sect1" title="旧式の印刷システムの、Sambaへの移行"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2649519"></a>旧式の印刷システムの、Sambaへの移行</h2></div></div></div><p>基本的なNT形式のプリンタドライバ管理は2.2.xリリースから3.0ではほとんど変更はなかった(小さな改善はたくさん適用されたが)。特に、設定中で廃止されるパラメータを使うのをやめる、前述の助言に従うならば、移行はとても簡単である。既存の2.0.x設定か、Samba 2.2でWindows 9x/Me形式の印刷形式を継続したいのであれば、それはもっと努力が必要となる。適切なリリースノートとSamba-2.2.xのHOWTO文書を読んでほしい。以下のいくつかの方法に沿うことが出来る。移行のための可能なシナリオは以下の通り:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	新しい Windows NTプリンタとドライバサポートについて学習し、使う必要がある。以前	使っていたパラメータ<em class="parameter"><code>printer driver file</code></em>,	<em class="parameter"><code>printer driver</code></em>と<em class="parameter"><code>printer driver location</code></em>	はもはやサポートされない。	</p></li><li class="listitem"><p>	もしもWindows NTプリンタドライバサポートを利用したいのであれば、新しい設定の	ために、Windows 9x/Meドライバを新しいものへ移行する必要がある。	</p></li><li class="listitem"><p>	存在する<code class="filename">printers.def</code>ファイル(削除されたパラメータ	<em class="parameter"><code>printer driver file</code></em>中で指定されているもの)はもはやSamba-3	では動作しないので、smbdは<em class="parameter"><code>[print$]</code></em>中とTDBファイル中の	追加の設定だけで、プリンタのためのWindows 9x/Meドライバファイルを捜そうとする。	もしもそれが失敗すると、(2.2.xが使うように)<code class="filename">printers.def</code>	(とすべての関連するパラメータ)を使うようには<span class="emphasis"><em>ならない</em></span>。	make_printerdefツールは削除され、これに関する下位互換性はない。	</p></li><li class="listitem"><p>使用しているSambaホスト上のプリンタ用の	<em class="parameter"><code>[print$]</code></em>共有中にWindows 9x/Meドライバをインストールする	必要がある。ドライバファイルは<em class="parameter"><code>[print$]</code></em>の	<span class="quote">“<span class="quote">WIN40/0</span>”</span>サブディレクトリ中に格納され、その他の設定と情報は印刷	関連のTDBファイル中に格納される。</p></li><li class="listitem"><p>	もしも、存在する<code class="filename">printers.def</code>ファイルを新しい設定中に移行	したいならば、現在唯一の解は、NTドライバと9x/Meドライバをインストールするために、	Windows NT APWを使うことである。これはsmbclientとrpcclientを使うスクリプトで	行える。その例は、	<a class="ulink" href="http://imprints.sourceforge.net/" target="_top">Imprints</a>	のWebサイト上にあるImprintsクライアントインストールを参照。また、	<a class="link" href="CUPS-printing.html" title="Chapter 22. CUPS印刷環境のサポート">CUPS 印刷環境</a>中のrpcclientの使用法についての	議論も参照のこと。	</p></li></ul></div></div><div class="sect1" title="Active DirectoryかLDAPへのプリンタ情報の公開"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2649700"></a>Active DirectoryかLDAPへのプリンタ情報の公開</h2></div></div></div><p>この件に関しては、<a class="link" href="NetCommand.html" title="Chapter 13. リモートとローカル管理:Netコマンド">リモートとローカル管理Netコマンド</a>でも触れられている。もしもこの機能に関しての文書の更新をボランティアとして手助けしてくれるのであれば、<a class="ulink" href="mail://jht@samba.org" target="_top">John H. Terpstra</a>に連絡をしてほしい。</p></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2649731"></a>よくあるエラー</h2></div></div></div><div class="sect2" title="rootパスワードを指定したが、アクセスできない"><div class="titlepage"><div><div><h3 class="title"><a name="id2649737"></a>rootパスワードを指定したが、アクセスできない</h3></div></div></div><p>UNIXシステムで有効な(とほとんどの場合、<code class="filename">/etc/shadow</code>というファイルに1方向ハッシュ形式として格納される)rootパスワードと、Samba認証時に使うパスワードと混同しないこと。SambaはUNIXパスワードを知らない。Sambaリソースへのrootアクセスは最初に作成されなければならないSamba用のrootアカウントを必要とする。これは以下のように、<code class="literal">smbpasswd</code>を使って行える:</p><pre class="screen"><code class="prompt">root# </code> smbpasswd -a rootNew SMB password: secretRetype new SMB password: secret</pre><p></p></div><div class="sect2" title="印刷ジョブはスプールディレクトリに入ったが、その後なくなった"><div class="titlepage"><div><div><h3 class="title"><a name="id2649789"></a>印刷ジョブはスプールディレクトリに入ったが、その後なくなった</h3></div></div></div><p>存在するUNIX印刷システムスプールディレクトリをSambaスプールディレクトリに使ってはならない。それは、簡単で場所を節約できるように見えるが、これは問題を引き起こす。2つは分離せねばならない。UNIX/Linuxシステムプリントスプールディレクトリ(すなわち<code class="filename">/var/spool/cups</code>)は通常<code class="literal">cups</code>や<code class="literal">lp</code>のような非特権ユーザによって所有される。さらに追加で、スプールディレクトリのパーミッションは、通常所有者とグループに対して制約されている。別の言い方をすると、Sambaスプールディレクトリは全員に対して書き込み可能で、一時スプールファイルの所有者のみがファイルを変更したり削除できるようにする、't'ビットを設定すべきである。</p><p>UNIX/Linuxホスト上で使う印刷スプールシステムのタイプに依存するので、スプール管理アプリが見つける、管理されているジョブキューの一部でないファイルは削除される。これは、ジョブが(Sambaによって)このディレクトリ中にスプールされて消えてしまう現象の説明になるだろう。</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="msdfs.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="CUPS-printing.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 20. Microsoft 分散ファイルシステムツリーのホスティング </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 22. CUPS印刷環境のサポート</td></tr></table></div></body></html>