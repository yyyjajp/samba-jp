<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 25. 詳細なネットワーク管理</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="winbind.html" title="Chapter 24. Winbind: ドメインアカウントの使用"><link rel="next" href="PolicyMgmt.html" title="Chapter 26. システムとアカウントポリシー"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 25. 詳細なネットワーク管理</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="winbind.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="PolicyMgmt.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 25. 詳細なネットワーク管理"><div class="titlepage"><div><div><h2 class="title"><a name="AdvancedNetworkManagement"></a>Chapter 25. 詳細なネットワーク管理</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">June 15 2005</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="AdvancedNetworkManagement.html#id2678186">機能と利便性</a></span></dt><dt><span class="sect1"><a href="AdvancedNetworkManagement.html#id2678229">リモートサーバ管理</a></span></dt><dt><span class="sect1"><a href="AdvancedNetworkManagement.html#id2678378">リモートデスクトップ管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="AdvancedNetworkManagement.html#id2678412">NoMachine.Comによるリモート管理</a></span></dt><dt><span class="sect2"><a href="AdvancedNetworkManagement.html#id2678871">ThinLincを使うリモート管理</a></span></dt></dl></dd><dt><span class="sect1"><a href="AdvancedNetworkManagement.html#id2679080">ネットワークログオンスクリプトの魔法</a></span></dt><dd><dl><dt><span class="sect2"><a href="AdvancedNetworkManagement.html#id2679319">ユーザの干渉なしにプリンタを追加する</a></span></dt><dt><span class="sect2"><a href="AdvancedNetworkManagement.html#id2679366">ログオン接続の制限</a></span></dt></dl></dd></dl></div><p><a class="indexterm" name="id2678168"></a>この章では、ネットワークリソースアクセス制御を改善するためと、ユーザ環境を自動化するためと、使用時の作業をより簡単にすることをしたいと思っているネットワーク管理者のためのとても重要な周辺機器についての問題を記述する。</p><div class="sect1" title="機能と利便性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2678186"></a>機能と利便性</h2></div></div></div><p>しばしば、作業中のネットワーク環境とより理解しているものの違いは、すべてをより協調させる<span class="emphasis"><em>小分け</em></span>の観点で最もよく測れる。すべてのネットワークソリューションの重要な部分は、リモートからMicrosoft Windowsワークステーションを管理すること、リモートでSambaサーバにアクセスすること、より信頼出来るネットワーク操作の場面において手助けとなる他の保守作業と同様の、カスタマイズしたログオンスクリプトを提供することである。</p><p>この章では、それらの各領域についての情報を提供する。それらはここにあり、他の章にはなく、そのため、参照が容易である。</p></div><div class="sect1" title="リモートサーバ管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2678229"></a>リモートサーバ管理</h2></div></div></div><p><span class="quote">“<span class="quote">どのようにしてユーザマネージャとサーバマネージャを手に入れたらよいのか?</span>”</span></p><p><a class="indexterm" name="id2678243"></a><a class="indexterm" name="id2678250"></a><a class="indexterm" name="id2678257"></a><span class="application">NT4 サーバ</span>を購入する必要がないので、どのようにしてユーザマネージャとサーバマネージャを手に入れたらよいのか?</p><p><a class="indexterm" name="id2678276"></a><a class="indexterm" name="id2678282"></a>Microsoftは、<span class="application">Windows 9x/Me</span>システム上でインストールするための、<code class="filename">Nexus.exe</code>と呼ばれるバージョンのツールを配布している。ツールセットには、以下が含まれている:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>サーバマネージャ</p></li><li class="listitem"><p>ドメイン用のユーザマネージャ</p></li><li class="listitem"><p>イベントビューワ</p></li></ul></div><p>Microsoftの<a class="ulink" href="ftp://ftp.microsoft.com/Softlib/MSLFILES/NEXUS.EXE" target="_top">Nexus</a>から書庫ファイルをダウンロードする。</p><p><a class="indexterm" name="id2678339"></a><a class="indexterm" name="id2678346"></a><a class="indexterm" name="id2678354"></a>ドメインとサーバマネージャ用の、<span class="application">Windows NT 4.0</span>バージョン用のユーザマネージャは、Microsoftの<a class="ulink" href="ftp://ftp.microsoft.com/Softlib/MSLFILES/SRVTOOLS.EXE" target="_top">via ftp</a>にある。</p></div><div class="sect1" title="リモートデスクトップ管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2678378"></a>リモートデスクトップ管理</h2></div></div></div><p><a class="indexterm" name="id2678387"></a><a class="indexterm" name="id2678394"></a>自由に使えるものから、費用がかかるものまでの間で、数多くのリモートデスクトップ管理ソリューションが存在する。黙ってみていてはいけない。最も費用がかかるソリューションはえてして最も効果的なものである。どの場合も、使用しているネットワーク環境で、どれが最も良いツールかを、自分で結論づける必要がある。</p><div class="sect2" title="NoMachine.Comによるリモート管理"><div class="titlepage"><div><div><h3 class="title"><a name="id2678412"></a>NoMachine.Comによるリモート管理</h3></div></div></div><p>	<a class="indexterm" name="id2678421"></a>	以下の情報はSambaメーリングリストに、2003年4月3日 23:33:50(UTC+00:00)に投稿	されたものである。以下は若干修正(プライバシーの理由で投稿者の詳細を省略)して	ある。完全な答えは、削除したいくつかのコメントを考慮して再構成してある。	</p><p><span class="quote">“<span class="quote"><a class="indexterm" name="id2678443"></a>		PDCとしてネットワーク上で動いている、優れたなLinux/Sambaサーバがある。		これに、ユーザが外部からシステムにログイン出来るようにして、家や他の		国からデスクトップ状態を使えるようにする、リモートデスクトップ機能を		追加したい。		</span>”</span></p><p><span class="quote">“<span class="quote"><a class="indexterm" name="id2678465"></a><a class="indexterm" name="id2678473"></a><a class="indexterm" name="id2678479"></a><a class="indexterm" name="id2678486"></a>		これを達成する方法はあるだろうか?Windowsターミナルサーバが必要だろうか?		それを設定する必要があり、それはドメインのメンバか、BDCあるいはPDCになる		のだろうか?コンピュータがドメイン中にいる場合でも、Microsoft Windows XPを		リモートログインにするようなhackはあるだろうか?		</span>”</span></p><p>		提供された回答:		<a class="ulink" href="http://www.nomachine.com/" target="_top">NoMachine</a>から		提供されている新しい<span class="quote">“<span class="quote">NX</span>”</span>ソフトウェアを申し込む。		</p><p><a class="indexterm" name="id2678524"></a><a class="indexterm" name="id2678531"></a><a class="indexterm" name="id2678538"></a>	これは、VNC/RFBとrdesktop/RDBをその中に取り込んでいる、簡単に使える、	リモートXプロトコルを実装しているが、今まで使ったことがあるかもしれない	他のものよりもパフォーマンスがよい。	</p><p><a class="indexterm" name="id2678557"></a>	リモートXは別に新しいものではないが、これが成し遂げたものは、遅いmodem/ISDN	接続上でも十分に使えるくらいのスピードを出す、新しい圧縮方法とキャッシング	技術である。	</p><p><a class="indexterm" name="id2678575"></a><a class="indexterm" name="id2678582"></a><a class="indexterm" name="id2678589"></a><a class="indexterm" name="id2678596"></a>	イタリアで(公開の)Red Hatマシンに対して、負荷の高いインターネット接続で、	KDE konquerorのサムネイルプレビューを有効にして、<span class="quote">“<span class="quote">マウスを載せると</span>”</span>	その時点でポップアップするようにしてテストしてみた。その内側(リモートX)の	セッションで、Windows XPマシンへののrdesktopセッションを起動した。パフォーマンスを	測ってみたところ、最初に631750ポイントというスコアが出た。	</p><p><a class="indexterm" name="id2678624"></a><a class="indexterm" name="id2678631"></a><a class="indexterm" name="id2678638"></a><a class="indexterm" name="id2678644"></a>	NXは、TightVNC, rdesktopやromete Xという、その時点までに使っていた他の	<span class="quote">“<span class="quote">純粋な</span>”</span>接続方法のどれよりも、ローカルLANよりも良いパフォーマンスを	出す。2つのノードを直接クロス接続するよりも速い。	</p><p><a class="indexterm" name="id2678664"></a><a class="indexterm" name="id2678671"></a><a class="indexterm" name="id2678678"></a>	リモートXアプリケーションから手元のマシンに対して、音を再生することも出来、	(イタリアにあるKDEセッションで動いている)NXウィンドウからMozillaメールソフトに	<span class="quote">“<span class="quote">コピーアンドペーストを</span>”</span>する事も出来た。このソフトはとてもよく	動いている!	</p><p>	リモートコンピューティングに一時的な興味のみあるどなたにも、	<a class="ulink" href="http://www.nomachine.com/testdrive.php" target="_top">NX</a>を使って	見る事をお勧めする。	</p><p>	無料で使えるクライアントソフトウェアをダウンロードし(Red Hat、SuSE、Debianと	Windows用がある)、起動し5分間使える(この時testdrive.nomachine.com上に実際の	UNIXアカウントを割り当てるために、アカウントデータを送る必要がある)。	</p><p>	計画されている要点では、クラスタのノードとしてNXアプリケーションサーバを	動かせるようになり、単にNXセッションをローカルに起動し、透過的に	アプリケーションを動かせる(アプリケーションが他のNXノードで動いていたとしても、	同じウィンドウで表示されるために、最初のログインで使われていたのと同じように	動く。また、フルスクリーンでも動作でき、そのすぐにリモートログインしていることを	全く忘れてしまうだろう)。	</p><p><a class="indexterm" name="id2678744"></a>	最後に最も良いことを:すべての主要な圧縮とキャッシュ技術はGPLのもとでリリース	され、何かに組み込もうと思う人誰にもそのソースコードが公開されている!これらの	技術はちゃんと動くが、コマンドラインのみから起動する(そして、完全に動作する	リモートXセッションを起動し動かすために使うにはとても不便である)。	</p><p>	質問に対する回答は以下の通り:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>		ターミナルサーバをインストールする必要はない。XPはRDPのサポートを内蔵している。		</p></li><li class="listitem"><p>		NXはCitrixよりも安価であり対抗できうる性能があり、おそらくより速い。		</p></li><li class="listitem"><p>		XPをハックする必要はない。それはちゃんと動く。		</p></li><li class="listitem"><p>		透過的にリモートからXPマシンにログイン出来(そして、ドメインに対する認証が		必要だとしても、接続時に何かを変更する必要はない)。		</p></li><li class="listitem"><p>		NXの主要な技術はすべてオープンソースでGPLでリリースされている。		(とても不便だが)無料で、コマンドラインで使う事が出来るが、お金を出せば、		便利な(商用の)NX GUIフロントエンドを買うことが出来る。		</p></li><li class="listitem"><p><a class="indexterm" name="id2678824"></a><a class="indexterm" name="id2678831"></a><a class="indexterm" name="id2678837"></a><a class="indexterm" name="id2678844"></a><a class="indexterm" name="id2678851"></a>		そのようなフロントエンドに対する、OSS/Free Softwareでの実装に、NoMachineは		自分自身に対する競合を意味しているのにもかかわらず、力を貸し、手助けを		している(このような主旨を、LTSP、KDEとGNOME開発メーリングリストにも表明		している)。		</p></li></ul></div></div><div class="sect2" title="ThinLincを使うリモート管理"><div class="titlepage"><div><div><h3 class="title"><a name="id2678871"></a>ThinLincを使うリモート管理</h3></div></div></div><p>	リモートアクセスに対する他の解は、Cendioによる<span class="emphasis"><em>ThinLinc</em></span>である。	</p><p><a class="indexterm" name="id2678890"></a><a class="indexterm" name="id2678896"></a><a class="indexterm" name="id2678903"></a><a class="indexterm" name="id2678910"></a><a class="indexterm" name="id2678917"></a><a class="indexterm" name="id2678924"></a><a class="indexterm" name="id2678930"></a><a class="indexterm" name="id2678937"></a>	ThxnLincは、LinuxとSolarisベースで使える、SSH、TightVNC、NFSとPulseAudioのような	標準プロトコルをベースとしたターミナルサーバである。	</p><p><a class="indexterm" name="id2678953"></a><a class="indexterm" name="id2678960"></a>	ThinLincは、LAN環境において組織におけるシンクライアント運用にも、狭帯域においても	使えるリモートから仕事をする人がセキュアなリモートアクセスを行うのにも使える。	ThinLincは、単一の同時アクセスするユーザに対して自由に使える。	</p><p><a class="indexterm" name="id2678980"></a><a class="indexterm" name="id2678987"></a><a class="indexterm" name="id2678995"></a>	プロダクトはWindowsターミナルサーバかCitrix環境のフロントエンドとしても、	Windows XPマシンのフロントエンドとしても使え、sshプロトコル経由で接続時の安全性を	確保している。クライアントはLinux(数多くのシンクライアント端末と同様すべてのLinux	ディストリビューションをサポート)とWindows用がある。JavaベースのWebクライアントも	提供されている。	</p><p>	ThinLincはCendioのデモシステムに接続することで評価が出来る。下記を参照。	<a class="ulink" href="http://www.cendio.com" target="_top">Cendio's</a> web サイト	<a class="ulink" href="http://www.cendio.com/testdrive" target="_top">testdrive</a> センタ。	</p><p>	Cendiaは以下を含む、いくつかのオープンソースプロジェクトにおける主要な貢献者である。	<a class="ulink" href="http://www.tightvnc.com" target="_top">TightVNC</a>,	<a class="ulink" href="http://pulseaudio.org" target="_top">PulseAudio</a> , unfsd,	<a class="ulink" href="http://www.python.org" target="_top">Python</a> と	<a class="ulink" href="http://www.rdesktop.org" target="_top">rdesktop</a>.	</p></div></div><div class="sect1" title="ネットワークログオンスクリプトの魔法"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2679080"></a>ネットワークログオンスクリプトの魔法</h2></div></div></div><p>固有のネットワーク設定環境を作成するための、いくつかの機会がある。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ログオンスクリプトなし。</p></li><li class="listitem"><p>すべてのユーザに適用される、単純な汎用ログオンスクリプト。</p></li><li class="listitem"><p>ユーザ単位あるいはグループ単位の属性に適用する条件付きログオンスクリプトの使用。</p></li><li class="listitem"><p>固有のログオンスクリプトを作るための、NETLOGON共有に対する	アクセス上の、Sambaのpreexecとpostexec機能を使用し、それを実行。</p></li><li class="listitem"><p>kixStartのようなツールのユーザ。</p></li></ul></div><p>Sambaソースコードの中には2つのログオンスクリプト生成/実行ツールが含まれている。<code class="filename">examples</code>ディレクトリの<code class="filename">genlogon</code>と<code class="filename">ntlogon</code>サブディレクトリを参照。</p><p>以下のリストはgenlogonディレクトリからのものである。</p><p><a class="indexterm" name="id2679160"></a>これは、<code class="filename">genlogon.pl</code>ファイルである:</p><pre class="programlisting">	#!/usr/bin/perl	#	# genlogon.pl	#	# Perl script to generate user logon scripts on the fly, when users	# connect from a Windows client. This script should be called from 	# smb.conf with the %U, %G and %L parameters. I.e:	#	#       root preexec = genlogon.pl %U %G %L	#	# The script generated will perform	# the following:	#	# 1. Log the user connection to /var/log/samba/netlogon.log	# 2. Set the PC's time to the Linux server time (which is maintained	#    daily to the National Institute of Standards Atomic clock on the	#    internet.	# 3. Connect the user's home drive to H: (H for Home).	# 4. Connect common drives that everyone uses.	# 5. Connect group-specific drives for certain user groups.	# 6. Connect user-specific drives for certain users.	# 7. Connect network printers.	# Log client connection	#($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time);	($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time);	open LOG, ">>/var/log/samba/netlogon.log";	print LOG "$mon/$mday/$year $hour:$min:$sec";	print LOG " - User $ARGV[0] logged into $ARGV[1]\n";	close LOG;	# Start generating logon script	open LOGON, ">/shared/netlogon/$ARGV[0].bat";	print LOGON "\@ECHO OFF\r\n";	# Connect shares just use by Software Development group	if ($ARGV[1] eq "SOFTDEV" || $ARGV[0] eq "softdev")	{		print LOGON "NET USE M: \\\\$ARGV[2]\\SOURCE\r\n";	}	# Connect shares just use by Technical Support staff	if ($ARGV[1] eq "SUPPORT" || $ARGV[0] eq "support")	{		print LOGON "NET USE S: \\\\$ARGV[2]\\SUPPORT\r\n";	}	# Connect shares just used by Administration staff	If ($ARGV[1] eq "ADMIN" || $ARGV[0] eq "admin")	{		print LOGON "NET USE L: \\\\$ARGV[2]\\ADMIN\r\n";		print LOGON "NET USE K: \\\\$ARGV[2]\\MKTING\r\n";	}	# Now connect Printers. We handle just two or three users a little	# differently, because they are the exceptions that have desktop	# printers on LPT1: - all other user's go to the LaserJet on the	# server.	if ($ARGV[0] eq 'jim'	    || $ARGV[0] eq 'yvonne')	{		print LOGON "NET USE LPT2: \\\\$ARGV[2]\\LJET3\r\n";		print LOGON "NET USE LPT3: \\\\$ARGV[2]\\FAXQ\r\n";	}	else	{		print LOGON "NET USE LPT1: \\\\$ARGV[2]\\LJET3\r\n";		print LOGON "NET USE LPT3: \\\\$ARGV[2]\\FAXQ\r\n";	}	# All done! Close the output file.	close LOGON;</pre><p></p><p>これらは、より精巧か、有用なログイン処理システムがそれらのサイトを確認する事を期待している:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://www.craigelachie.org/rhacer/ntlogon" target="_top">http://www.craigelachie.org/rhacer/ntlogon</a></p></li><li class="listitem"><p><a class="ulink" href="http://www.kixtart.org" target="_top">http://www.kixtart.org</a></p></li></ul></div><div class="sect2" title="ユーザの干渉なしにプリンタを追加する"><div class="titlepage"><div><div><h3 class="title"><a name="id2679319"></a>ユーザの干渉なしにプリンタを追加する</h3></div></div></div><p><a class="indexterm" name="id2679327"></a>プリンタは以下を使用することで、ログオンスクリプト処理中に自動的に追加することが出来る:</p><pre class="screen"><code class="prompt">C:\> </code><strong class="userinput"><code>rundll32 printui.dll,PrintUIEntry /?</code></strong></pre><p><a class="ulink" href="http://support.microsoft.com/kb/189105/ja" target="_top">ユーザーによる操作なしで Windowsにプリンタを追加する方法</a>を参照のこと。</p></div><div class="sect2" title="ログオン接続の制限"><div class="titlepage"><div><div><h3 class="title"><a name="id2679366"></a>ログオン接続の制限</h3></div></div></div><p>	  時々、Samba共有リソースへの同時接続の数を制限することが必要な場合がある。	  たとえば、ユーザ毎に1つのネットワークログインのみを、サイトが許可したいような	  場合である。	</p><p>	  Sambaの<em class="parameter"><code>preexec script</code></em>パラメータはユーザ単位に1つの接続	  のみを許可するのに使える。この方法は完全に安全性があるわけではなく、副作用が	  あるかもしれない。以下の寄贈された方法はより良い解を誰かに思いつかさせて、	  提供を促すかもしれない。	</p><p>	  これは、Windowsクライアントが、実際にそうである間、共有をもう使っていないと	  見える場合に、自動再接続機能を使って、アイドル状態の接続を切ってしまうことが	  出来るという理由で完全な解ではない。そうだったとしても、これは、	  <em class="parameter"><code>preexec script</code></em>パラメータの使用の原理的なデモである。	</p><p>	  以下の共有設定は<a class="link" href="AdvancedNetworkManagement.html#Tpees" title="Example 25.1. Script to Enforce Single Resource Logon">“Script to Enforce Single Resource Logon”</a>中で示されるスクリプトの使用をデモする。</p><pre class="programlisting">[myshare]	...	preexec script = /sbin/PermitSingleLogon.sh	preexec close = Yes	...</pre><p>	</p><div class="example"><a name="Tpees"></a><p class="title"><b>Example 25.1. Script to Enforce Single Resource Logon</b></p><div class="example-contents"><pre class="screen">#!/bin/bashIFS="-"RESULT=$(smbstatus -S -u $1 2> /dev/null | awk 'NF \        > 6 {print $1}' | sort | uniq -d)if [ "X${RESULT}" == X  ]; then  exit 0else  exit 1fi</pre></div></div><br class="example-break"></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="winbind.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="PolicyMgmt.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 24. Winbind: ドメインアカウントの使用 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 26. システムとアカウントポリシー</td></tr></table></div></body></html>