<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 5. バックアップドメインコントローラ</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="type.html" title="Part II. サーバ設定の基本"><link rel="prev" href="samba-pdc.html" title="Chapter 4. ドメイン制御"><link rel="next" href="domain-member.html" title="Chapter 6. ドメインメンバシップ"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 5. バックアップドメインコントローラ</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="samba-pdc.html">Prev</a> </td><th width="60%" align="center">Part II. サーバ設定の基本</th><td width="20%" align="right"> <a accesskey="n" href="domain-member.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 5. バックアップドメインコントローラ"><div class="titlepage"><div><div><h2 class="title"><a name="samba-bdc"></a>Chapter 5. バックアップドメインコントローラ</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Volker</span> <span class="surname">Lendecke</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:Volker.Lendecke@SerNet.DE">Volker.Lendecke@SerNet.DE</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Guenther</span> <span class="surname">Deschner</span></h3><span class="contrib">LDAP updates</span> <div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:gd@samba.org">gd@samba.org</a>></code></p></div></div></div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="samba-bdc.html#id2574173">機能と利便性</a></span></dt><dt><span class="sect1"><a href="samba-bdc.html#id2574651">基本的な背景情報について</a></span></dt><dd><dl><dt><span class="sect2"><a href="samba-bdc.html#id2574731">Microsoft Windows NT4スタイルのドメイン制御</a></span></dt><dt><span class="sect2"><a href="samba-bdc.html#id2575519">LDAP設定の注意</a></span></dt><dt><span class="sect2"><a href="samba-bdc.html#id2575928">Active Directoryドメイン制御</a></span></dt><dt><span class="sect2"><a href="samba-bdc.html#id2575992">ネットワーク上のドメインコントローラになれる要件</a></span></dt><dt><span class="sect2"><a href="samba-bdc.html#id2576098">どのようにワークステーションがそのドメインコントローラを探すか?</a></span></dt></dl></dd><dt><span class="sect1"><a href="samba-bdc.html#id2576296">バックアップドメインコントローラの設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="samba-bdc.html#id2576869">設定例</a></span></dt></dl></dd><dt><span class="sect1"><a href="samba-bdc.html#id2577344">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="samba-bdc.html#id2577394">マシンアカウントが満了し続ける</a></span></dt><dt><span class="sect2"><a href="samba-bdc.html#id2577472">SambaはNT4 PDCのバックアップドメインコントローラになれるか?</a></span></dt><dt><span class="sect2"><a href="samba-bdc.html#id2577538">smbpasswdファイルの複製はどうやるか?</a></span></dt><dt><span class="sect2"><a href="samba-bdc.html#id2577661">これをすべてのLDAPに使えるか?</a></span></dt></dl></dd></dl></div><p>このセクションを読み始める前に、<a class="link" href="samba-pdc.html" title="Chapter 4. ドメイン制御">ドメイン制御</a>中で説明されているSambaドメインコントローラの設定に問題がないようにしておくこと。</p><div class="sect1" title="機能と利便性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2574173"></a>機能と利便性</h2></div></div></div><p>この章は、説明するのが最も困難な章の一つである。何を書いても、誰かがまだ実現できていない項目、あるいはまったく異なるアプローチを使った方が遥かに効果的に実現できる項目について、実現されたはずだと期待してSambaチームに問い合わせてくることを防止することはできないと思われる。もしこの章で説明されているはずなのに、いくら読んでも言及されない事項というのがある場合は、要件あるいは質問内容を明確に書いて<a class="ulink" href="mailto:jht@samba.org" target="_top">John H. Terpstra</a>まで電子メールで問い合わせてほしい。</p><p><a class="indexterm" name="id2574203"></a><a class="indexterm" name="id2574212"></a><a class="indexterm" name="id2574219"></a><a class="indexterm" name="id2574226"></a><a class="indexterm" name="id2574235"></a>Samba-3 は別のSambaプライマリドメインコントローラ(PDC)に対するバックアップドメインコントローラ(BDC)として機能することができる。Samba-3 PDCは、LDAPアカウントバックエンドとともに運用することができる。LDAPバックエンドは、共用のマスタLDAPサーバかスレーブサーバのどちらでも使える。スレーブLDAPサーバを使用する利点は、マスタがダウンしている時でもクライアントがネットワークにログオンできるということである。これによりSambaが高いレベルの拡張性を持つことになり、大規模な組織のための効果的なソリューションとなり得る。PDCにLDAPスレーブサーバを使用する場合、マスタの継続的な可用性を確保する必要がある。悪い時にスレーブ側から見てマスタがダウンしていると、安定性の問題や運用上の問題となる。</p><p><a class="indexterm" name="id2574282"></a><a class="indexterm" name="id2574290"></a><a class="indexterm" name="id2574299"></a><a class="indexterm" name="id2574309"></a>Samba-3 BDCをLDAPでないバックエンドとともに運用することも可能だが、バックエンドが何らかの形で「双方向の」伝達を許容し、BDC側からマスタへの変更が可能であるようにしなければならない。現段階でこれをできるのはLDAPのみである。PDCが、そのプライマリとしてLDAPマスタサーバを使うことが好ましい間、BDCはスレーブLDAPサーバを使うことが出来る。</p><p><a class="indexterm" name="id2574329"></a><a class="indexterm" name="id2574339"></a><a class="indexterm" name="id2574348"></a><a class="indexterm" name="id2574360"></a><a class="indexterm" name="id2574367"></a><a class="indexterm" name="id2574373"></a><a class="indexterm" name="id2574380"></a>LDAPでないバックエンドSAMデータベースを使用するのは問題に陥りやすくなる。なぜなら、ドメインメンバサーバもワークステーションも、マシン信頼アカウントのパスワードを定期的に変更するからである。新しいバスワードはローカルでしか保存されない。このことは、(LDAPベースのソリューションにあるような)集中的に格納されたアカウントデータベースが無く、Samba-3 がBDCとして動作しているとき、BDC 側のドメインメンバ信頼アカウントのパスワードの記録が、PDC(マスタ)のSAMのコピーに届かないことを意味する。もし、PDCのSAMがBDC側に複製されると、最新の(変更後の)信頼アカウントのパスワードを含むSAMが上書きされることになり、ドメイン信頼が無効になってしまう。</p><p><a class="indexterm" name="id2574421"></a><a class="indexterm" name="id2574430"></a><a class="indexterm" name="id2574439"></a><a class="indexterm" name="id2574448"></a>BDCの設定方法に関して挙げられたコメントや質問の数が多いので、可能な選択肢の一つ一つについて、おのおのの解について利点欠点を見てみよう。<a class="link" href="samba-bdc.html#pdc-bdc-table" title="Table 5.1. 分散ドメインバックエンドアカウントの選択肢">以下のドメインバックエンドアカウント分散オプション一覧</a>は、PDC/BDC構成で設定可能な設定例の一覧である。</p><div class="table"><a name="pdc-bdc-table"></a><p class="title"><b>Table 5.1. 分散ドメインバックエンドアカウントの選択肢</b></p><div class="table-contents"><table summary="分散ドメインバックエンドアカウントの選択肢" border="1"><colgroup><col align="center"><col align="center"><col align="left"></colgroup><thead><tr><th align="center">PDCバックエンド</th><th align="center">BDCバックエンド</th><th align="left">補足事項</th></tr></thead><tbody><tr><td align="center"><p>マスタLDAPサーバ</p></td><td align="center"><p>スレーブLDAPサーバ</p></td><td align="left"><p>高い整合性を提供する完全なソリューション。SAMは共通マスタLDAPサーバで	    複製される。</p></td></tr><tr><td align="center"><p>単一の集中LDAPサーバ</p></td><td align="center"><p>単一の集中LDAPサーバ</p></td><td align="left"><p>	フェイルオーバ機能がないが実用可能なソリューション。これは実用的なソリューションで	あるが、完全ではない。	</p></td></tr><tr><td align="center"><p>tdbsam</p></td><td align="center"><p>tdbsam + <code class="literal">net rpc vampire</code></p></td><td align="left"><p>	Samba-3.0では動かない。Sambaはサーバサイドプロトコル要求を実装していない。	</p></td></tr><tr><td align="center"><p>tdbsam</p></td><td align="center"><p>tdbsam + <code class="literal">rsync</code></p></td><td align="left"><p>	この設定を使ってはいけない。TDBファイルが使用中の状態でデータがディスクに	完全に書き戻されていないかもしれないので、動作しない。	さらに、ドメインの信頼関係を壊すだろう。	</p></td></tr><tr><td align="center"><p>smbpasswd file</p></td><td align="center"><p>smbpasswd file</p></td><td align="left"><p>	この設定を使ってはいけない。	同期が遅延するためにエレガントな解ではなく、ドメイン信頼関係	の問題で悩むだろう。	</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect1" title="基本的な背景情報について"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2574651"></a>基本的な背景情報について</h2></div></div></div><p><a class="indexterm" name="id2574659"></a><a class="indexterm" name="id2574666"></a><a class="indexterm" name="id2574673"></a><a class="indexterm" name="id2574680"></a>ドメインコントローラは、ネットワーク上のワークステーションからのログオン要求に答えることが出来るマシンである。Microsoft LanManagerとIBM LanServerはこの機能を提供していた初期のプロダクトの2つである。その技術は、LanMan NetLogonサービスとして知られるようになった。</p><p><a class="indexterm" name="id2574700"></a><a class="indexterm" name="id2574712"></a>Microsoft Windows NT3.10 の最初のリリースで、新しいドメイン制御形式がサポートされ、同時に機能を拡張した新しい形のネットワークログオンサービスがサポートされることになった。このサービスは、NT NetLogon サービスとして知られている。このサービスの性質は、 Microsoft Windows NT の進化に伴って変更され、今日では洗練された各種技術の上に広範で複雑な各種サービスを実現している。 </p><div class="sect2" title="Microsoft Windows NT4スタイルのドメイン制御"><div class="titlepage"><div><div><h3 class="title"><a name="id2574731"></a>Microsoft Windows NT4スタイルのドメイン制御</h3></div></div></div><p><a class="indexterm" name="id2574741"></a><a class="indexterm" name="id2574748"></a><a class="indexterm" name="id2574755"></a><a class="indexterm" name="id2574762"></a><a class="indexterm" name="id2574769"></a><a class="indexterm" name="id2574775"></a><a class="indexterm" name="id2574784"></a>NT4/200x/XP Professionalワークステーションにユーザがログオンするときはいつでも、ワークステーションはユーザが入力したユーザ名/パスワードペアが正しいかを検証するためにドメインコントローラ(認証サーバ)に接続する。もしも入力された情報がドメイン制御データベース(SAM、すなわちセキュリティアカウントマネージャデータベース)に格納されているアカウント情報と一致しない場合、認証要求を出したワークステーションに一連のエラーコードを返す。</p><p><a class="indexterm" name="id2574808"></a><a class="indexterm" name="id2574815"></a><a class="indexterm" name="id2574822"></a><a class="indexterm" name="id2574829"></a><a class="indexterm" name="id2574837"></a>ユーザ名/パスワードペアが検証されたとき、ドメインコントローラ(認証サーバ)はそのドメインに対するユーザとマシンアカウントデータベース中の、そのユーザに関係するアカウント情報の完全な項目一覧を返す。この情報はそのユーザに対する完全なネットワークアクセスプロファイルを含むが、ユーザのデスクトッププロファイルに特有の情報は含まないか、あるいはそれに関して、ユーザが属してもよいグループのためのすべてのデスクトッププロファイルも含まれない。また、それには、パスワード満了時間、パスワードの一意性制御情報、ネットワークアクセス時間制限情報、アカウント検証情報、ユーザがアクセスできるネットワークからのマシン名や空にその他の情報が含まれている。すべての情報はMicrosoft Windows NT(3.10, 3.50, 3.51, 4.0)バージョン中のSAM中に格納される。</p><p><a class="indexterm" name="id2574878"></a><a class="indexterm" name="id2574887"></a><a class="indexterm" name="id2574894"></a><a class="indexterm" name="id2574901"></a><a class="indexterm" name="id2574908"></a>ドメインコントローラ上のアカウント情報(ユーザとマシン)は2つのファイルに格納される。そのうちの1つにはセキュリティ情報を含み、もう1つはSAMである。それらは<code class="filename">%SystemRoot%\System32\config</code>ディレクトリ中に同名のファイルに格納される。これは通常<code class="filename">C:\WinNT\System32\config</code>に変換される。ネットワーク上にBDCがあるとき、この2つのファイルがSAMデータベースの複製に関与するファイルである。</p><p>BDCをインストールすることが好ましい状況が2つある:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	<a class="indexterm" name="id2574953"></a>	<a class="indexterm" name="id2574960"></a>	PDCがあるローカルネットワーク上で、たくさんのワークステーション	がある場合、あるいはPDCが常時高負荷な場合。この場合、BDCはネットワーク上	のログオン要求を拾って、ネットワークサービスの堅牢性を向上する一助となる。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2574981"></a>	各リモートサイトで、広域ネットワークの転送量を減らすためとリモート	ネットワーク操作の安定性を向上したい場合。ネットワークのデザイン、戦略的な	BDCの配置、及びネットワークのできるだけ多くの部分をクライアント側のやり取りに	使用するような実装を組み合わせることにより、WANのバンド幅のニーズを最小化する	(従ってコストも最小化する)ことができる。	</p></li></ul></div><p><a class="indexterm" name="id2575005"></a><a class="indexterm" name="id2575011"></a><a class="indexterm" name="id2575018"></a><a class="indexterm" name="id2575025"></a><a class="indexterm" name="id2575032"></a>真のWindows NT4環境中でのPDCとBDCのやりとりについてここで触れておく。PDCはSAMのマスタコピーを持っている。管理者がPDCの持つローカルネットワーク上に物理的に存在するユーザアカウントデータベースに変更を加えると、この変更内容は、SAMのマスタコピーのPDC上の記録に直接行われる。このような情報更新が別のオフィスで行われると、この変更内容はローカルBDC上の差分ファイルに格納される。BDCはその後SAM同期を行うプロセスを開始するために、PDCに対してトリガを送る。PDCは当該ドメインの全BDCに接続し、全BDCが更新情報を入手し、それぞれのSAMのコピーに最新の情報を反映させるようにトリガを出す。 </p><p><a class="indexterm" name="id2575070"></a><a class="indexterm" name="id2575079"></a><a class="indexterm" name="id2575088"></a><a class="indexterm" name="id2575094"></a>Samba-3は真のSAM複製に参加できないので、Microsoft Windows NT4で使われているのと同じプロトコルを使用することが出来ない。Samba-3 BDCはSAM更新差分ファイルを作成できない。BDCが持っている差分ファイルからSAMの同期をとるために、PDC(NT4またはSamba)間とやりとりもしない。</p><p><a class="indexterm" name="id2575115"></a><a class="indexterm" name="id2575121"></a>Samba-3 はMicrosoft Windows NT4 BDCとしては動作できず、Samba-3はMicrosoft Windows NT4 BDCに対するPDCとして正しく動作できない。Samba-3とMicrosoft Windows NT4はそれぞれのタイプのPDCへのBDCとして機能することは出来る。</p><p><a class="indexterm" name="id2575140"></a><a class="indexterm" name="id2575147"></a><a class="indexterm" name="id2575153"></a>BDCはネットワークログオン要求とユーザ認証が出来るので、<span class="emphasis"><em>読み出し専用</em></span>のSAMを保持していると言える。BDCはこのサービスを提供し続けることができる。特に、PDCへのWANのリンクがダウンしている場合などに有効である。BDCは、ドメインのセキュリティとネットワークの整合性の維持に大変重要な役割を果たす。</p><p><a class="indexterm" name="id2575181"></a><a class="indexterm" name="id2575188"></a><a class="indexterm" name="id2575194"></a><a class="indexterm" name="id2575201"></a>NT4のPDCを稼働停止しなければならない場合や故障した場合、NT4 のBDCの一つをPDCに昇格することができる。このようなことを NT4 PDCがオンライン中に行うと、NT4 PDCは自動的に NT4 BDCに降格する。これはドメインコントローラの管理の中で特に重要な一面である。昇格および降格を実行するのに使用されるツールはドメインサーバーマネジャーである。ここで注意しなければならないことは、Samba-3 の BDCは同様の方法で格上げすることはできないということである。これは、そのような Samba の再設定を行うには<code class="filename">smb.conf</code>ファイルの変更が必要になるからである。作業は、<code class="filename">smb.conf</code>ファイルの手動での変更と、Sambaネットワークサービスに関連するものの再起動をおこなうだけでよい。</p><div class="sect3" title="PDCの設定例"><div class="titlepage"><div><div><h4 class="title"><a name="id2575248"></a>PDCの設定例</h4></div></div></div><p><a class="indexterm" name="id2575256"></a><a class="indexterm" name="id2575263"></a>バージョン2.2の最初からSambaは公式に、Windows NT4、2003とXP Professionalを含む現行Windowsクライアントすべてでドメインログオン機能を公式にサポートしている。PDCを有効にしたSambaでは<code class="filename">smb.conf</code>中の<em class="parameter"><code>[global]</code></em>セクション内にいくつかのパラメータを設定しなければならない。最低限必要な設定の例は<a class="link" href="samba-bdc.html#minimalPDC" title="Example 5.1. BDCと共に使う、PDC上にLDAPサーバがあるPDCのための最低限のsmb.conf">BDCと共に使う、PDC上にLDAPサーバがあるPDCのための最低限のsmb.conf  の節</a>を参照のこと。</p><div class="example"><a name="minimalPDC"></a><p class="title"><b>Example 5.1. BDCと共に使う、PDC上にLDAPサーバがあるPDCのための最低限のsmb.conf </b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2575328"></a><em class="parameter"><code>workgroup = MIDEARTH</code></em></td></tr><tr><td><a class="indexterm" name="id2575339"></a><em class="parameter"><code>passdb backend = ldapsam://localhost:389</code></em></td></tr><tr><td><a class="indexterm" name="id2575351"></a><em class="parameter"><code>domain master = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2575363"></a><em class="parameter"><code>domain logons = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2575375"></a><em class="parameter"><code>ldap suffix = dc=quenya,dc=org</code></em></td></tr><tr><td><a class="indexterm" name="id2575386"></a><em class="parameter"><code>ldap user suffix = ou=Users</code></em></td></tr><tr><td><a class="indexterm" name="id2575398"></a><em class="parameter"><code>ldap group suffix = ou=Groups</code></em></td></tr><tr><td><a class="indexterm" name="id2575410"></a><em class="parameter"><code>ldap machine suffix = ou=Computers</code></em></td></tr><tr><td><a class="indexterm" name="id2575422"></a><em class="parameter"><code>ldap idmap suffix = ou=Idmap</code></em></td></tr><tr><td><a class="indexterm" name="id2575434"></a><em class="parameter"><code>ldap admin dn = cn=sambadmin,dc=quenya,dc=org</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2575450"></a><a class="indexterm" name="id2575457"></a><em class="parameter"><code>[homes]</code></em>と<em class="parameter"><code>[netlogon]</code></em>共有などの項目や、プロファイルパス、ユーザのホームドライブやその他を設定するための設定も一緒に行う必要がある。それらはこの章では触れない。詳細な情報については、<a class="link" href="samba-pdc.html" title="Chapter 4. ドメイン制御">ドメイン制御</a>を参照のこと。PDC設定のための特定の推奨パターンは<a class="link" href="samba-pdc.html" title="Chapter 4. ドメイン制御">ドメイン制御の章</a>を参照のこと。また別に、地域の、あるいはオンライン書店から入手できる<span class="quote">“<span class="quote">Samba-3 by Example</span>”</span>という書籍(<a class="ulink" href="http://www.samba.org/samba/docs/Samba3-ByExample" target="_top">book</a>)中にOpenLDAPとSambaのネットワーク動作設定例が完全に記述されている。</p></div></div><div class="sect2" title="LDAP設定の注意"><div class="titlepage"><div><div><h3 class="title"><a name="id2575519"></a>LDAP設定の注意</h3></div></div></div><p><a class="indexterm" name="id2575527"></a><a class="indexterm" name="id2575536"></a><a class="indexterm" name="id2575546"></a>マスタとスレーブLDAPサーバを設定する時、マスタLDPサーバをPDCに、スレーブLDAPサーバをBDCで使うことが推奨される。スレーブLDAPサーバを使うことは不可欠ではないが、サービスの冗長性を提供するために多くの管理者はそのことを好んでいる。もちろん、1つ以上のBDCがどののスレーブLDAPサーバを使ってもかまわない。また、ネットワーク全体で1つのLDAPサーバを使うことも可能である。</p><p><a class="indexterm" name="id2575566"></a><a class="indexterm" name="id2575575"></a><a class="indexterm" name="id2575584"></a><a class="indexterm" name="id2575590"></a><a class="indexterm" name="id2575597"></a>スレーブLDAPサーバサーバを持つマスタLDAPサーバを設定する時、このことを<code class="filename">/etc/openldap/slapd.conf</code>ファイル中に設定することを忘れないように。サーバ証明書のDNは、サーバの名づけるためにCN属性を使わなければならず、CNはサーバの完全に的確性のあるドメイン名を含んでいなければならないことに注意。証明書の subjectAltNameエクステンション中に追加の別名やワイルドカードを持っていても構わない。サーバ証明書についてのより詳細な情報はRFC2830を参照のこと。</p><p><a class="indexterm" name="id2575634"></a><a class="indexterm" name="id2575641"></a><a class="indexterm" name="id2575647"></a><a class="indexterm" name="id2575654"></a><a class="indexterm" name="id2575664"></a><a class="indexterm" name="id2575671"></a><a class="indexterm" name="id2575678"></a>この文書の範囲内にはうまく一致しないが、LDAPをインストールすることは、LDAPを有効にしているSamba操作の基本である。トランスポートレイヤのセキュリティ(TLS)を有効にしてOpenLDAPを使う場合、<code class="filename">/etc/ssl/certs/slapd.pem</code>中のマシン名は<code class="filename">/etc/openldap/sldap.conf</code>と同じものである必要がある。Red Hat Linuxスタートアップスクリプトはホスト名として、<span class="quote">“<span class="quote">localhost.localdomain</span>”</span>とした<code class="filename">slapd.pem</code>ファイルを生成する。これだと、正しいホスト名で証明書が再作成されない限り、スレーブLDAPサーバ(すなわちSamba BDC)からLDAPサーバにアクセスできない。</p><p><a class="indexterm" name="id2575729"></a><a class="indexterm" name="id2575736"></a><a class="indexterm" name="id2575742"></a><a class="indexterm" name="id2575750"></a><a class="indexterm" name="id2575756"></a><a class="indexterm" name="id2575763"></a>LDAPスレーブサーバを使うようにSamba PDCをインストールしてはいけない。ドメインへクライアントマシンを参加する時、LDAPデータベース中へのマシンアカウントの変更がマスタLDAPサーバ上で行わなければならないという理由で、この設定ではうまくいかない。PDCが出した問い合わせがスレーブサーバに複製されるまで時間がかかりすぎる。そのため、クライアントマシン上で、アカウントの証明書がセットアップできないというエラーメッセージが出る。LDAPサーバ上でマシンアカウントが作成されるが、パスワード欄は空となる。残念なことに、いくつかのサイトはこのような設定を防げず、そのため、それらのサイトでは、複製に追いつくために、Sambaの処理を十分に遅くするための、<a class="link" href="smb.conf.5.html#LDAPREPLICATIONSLEEP" target="_top">ldap replication sleep</a>パラメータを検討すべきである。これは、その場しのぎの解決方法であり、管理者が何らかのスクリプト(たとえば、<a class="link" href="smb.conf.5.html#ADDMACHINESCRIPT" target="_top">add machine script</a>のようなもの)を使って手動で複製しなければならない。</p><p>PDC/BDCとLDAPを使う、設定可能なパターンは以下の通り:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	PDC+BDC -> 1つの集中LDAPサーバ。	</p></li><li class="listitem"><p>	PDC -> LDAP マスタサーバ、 BDC -> LDAPスレーブサーバ。	</p></li><li class="listitem"><p>	PDC -> LDAPマスタ、第二のスレーブLDAPサーバあり。	</p><p>	BDC -> LDAPマスタ、第二のスレーブLDAPサーバあり。	</p></li><li class="listitem"><p>	PDC -> マスタ、第二のスレーブLDAPサーバあり。	</p><p>	BDC -> スレーブ、第二のスレーブサーバあり。	</p></li></ul></div><p>(セカンダリ)LDAPサーバサーバを持つためには、<a class="link" href="samba-bdc.html#mulitldapcfg" title="Example 5.2. smb.confに記述する複数LDAPサーバ"><code class="filename">smb.conf</code>に記述する複数LDAPサーバの例</a>のように指定する。</p><div class="example"><a name="mulitldapcfg"></a><p class="title"><b>Example 5.2. <code class="filename">smb.conf</code>に記述する複数LDAPサーバ</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2575914"></a><em class="parameter"><code>passdb backend = ldapsam:"ldap://master.quenya.org ldap://slave.quenya.org"</code></em></td></tr></table></div></div><br class="example-break"></div><div class="sect2" title="Active Directoryドメイン制御"><div class="titlepage"><div><div><h3 class="title"><a name="id2575928"></a>Active Directoryドメイン制御</h3></div></div></div><p><a class="indexterm" name="id2575937"></a><a class="indexterm" name="id2575944"></a><a class="indexterm" name="id2575951"></a><a class="indexterm" name="id2575958"></a><a class="indexterm" name="id2575965"></a><a class="indexterm" name="id2575971"></a>Microsoft Windows 2000とActive Directoryのリリース以降、この情報は複製可能で、管理コントロールの部分的あるいは全体を複製できるディレクトリ中に格納される。Samba-3はActive Directory内でドメインコントローラにはなれず、また、Active Directoryサーバにもなれない。このことは、Samba-3はActive DirectoryドメインコントローラのBDCとなりえないことを意味する。</p></div><div class="sect2" title="ネットワーク上のドメインコントローラになれる要件"><div class="titlepage"><div><div><h3 class="title"><a name="id2575992"></a>ネットワーク上のドメインコントローラになれる要件</h3></div></div></div><p><a class="indexterm" name="id2576000"></a><a class="indexterm" name="id2576007"></a><a class="indexterm" name="id2576013"></a><a class="indexterm" name="id2576020"></a>ドメインMIDEARTH用のドメインコントローラであるすべてのマシンは、WINSサーバかローカルネットワークに対するブロードキャストを使ってNetBIOSグループ名MIDEARTH<1C>を登録しなければならない。またPDCはWINSサーバで一意のNetBIOS名MIDEARTH<1B>を登録する。名前タイプ<1B>はドメインマスタブラウザ(DMB)のために通常予約ていて、認証には通常何ら関係ないが、Microsoftドメインの導入時はDMBがPDCと同じマシンであることが用件となる。</p><p><a class="indexterm" name="id2576052"></a><a class="indexterm" name="id2576059"></a><a class="indexterm" name="id2576066"></a>WINSサーバを使っていないとき、名前登録はブロードキャストするだけで十分なはずである。<a class="link" href="NetworkBrowsing.html" title="Chapter 10. ネットワークブラウジング">ネットワークブラウジング</a>と<a class="link" href="NetworkBrowsing.html#netdiscuss" title="議論">Discussion</a>に、TCP/IPネットワークプロトコル関連と、どのようにSMB/CIFS名を取り扱うかについてのより詳細な情報があるので参照すること。</p></div><div class="sect2" title="どのようにワークステーションがそのドメインコントローラを探すか?"><div class="titlepage"><div><div><h3 class="title"><a name="id2576098"></a>どのようにワークステーションがそのドメインコントローラを探すか?</h3></div></div></div><p><a class="indexterm" name="id2576107"></a><a class="indexterm" name="id2576115"></a>ドメインコントローラを見つけるメカニズムは2つある:1つはNetBIOS over TCP/IPが有効なときに使われ、もう1つはTCP/IPネットワーク設定で無効になっているときに使われるものである。</p><p><a class="indexterm" name="id2576133"></a><a class="indexterm" name="id2576140"></a>NetBIOS over TCP/IPが無効になっているとき、すべての名前解決は、Active Directory通信技術のような、DNS、UDP上のブロードキャストを使う。このタイプの環境では、すべてのマシンが適切なDNSエントリを持つことが必要である。より詳細な情報は<a class="link" href="NetworkBrowsing.html#adsdnstech" title="DNSとActive Directory">DNSとActive Directory</a>を参照のこと。</p><div class="sect3" title="NetBIOS Over TCP/IPが有効"><div class="titlepage"><div><div><h4 class="title"><a name="id2576168"></a>NetBIOS Over TCP/IPが有効</h4></div></div></div><p><a class="indexterm" name="id2576177"></a><a class="indexterm" name="id2576183"></a><a class="indexterm" name="id2576190"></a><a class="indexterm" name="id2576197"></a>ドメインMIDEARTH内のMicrosoft Windows NT4/200x/XP Professionalワークステーションがローカルユーザを認証させたい場合、MIDEARTHのドメインコントローラを見つける必要がある。これは、グループ名MIDEARTH<1C>に対するNetBIOS名前解決を行うことによって行われる。ワークステーションは、問い合わせに返事を返すマシンの1つ1つがドメインコントローラであり、ログイン要求に答えることが出来ることを仮定している。セキュリティホールを造らないために、ワークステーションと選択されたドメインコントローラはおのおのを認証する。その後、ワークステーションはユーザの認証情報(ユーザ名/パスワードペア)を認証のためにローカルのドメインコントローラに送る。</p></div><div class="sect3" title="NetBIOS Over TCP/IPが無効"><div class="titlepage"><div><div><h4 class="title"><a name="id2576234"></a>NetBIOS Over TCP/IPが無効</h4></div></div></div><p><a class="indexterm" name="id2576243"></a><a class="indexterm" name="id2576250"></a><a class="indexterm" name="id2576257"></a><a class="indexterm" name="id2576263"></a>realm <code class="constant">quenya.org</code>中のMicrosoft Windows NT4/200x/XP Professional workstationがユーザログオン認証をしたい場合、DNSサーバに対して<code class="constant">_ldap._tcp.pdc._msdcs.quenya.org</code>レコードを再度問い合わせすることでドメインコントローラ見つける。この項目に対する関連したより詳細な情報は、<a class="link" href="NetworkBrowsing.html#adsdnstech" title="DNSとActive Directory">DNSとActive Directory</a>を参照のこと。</p></div></div></div><div class="sect1" title="バックアップドメインコントローラの設定"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2576296"></a>バックアップドメインコントローラの設定</h2></div></div></div><p><a class="indexterm" name="id2576304"></a>BDCの作成には最初に<span class="application">smbd</span>を動かす前にSamba サーバを準備するためのいくつかのステップが要求される。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	<a class="indexterm" name="id2576325"></a>	<a class="indexterm" name="id2576332"></a>	<a class="indexterm" name="id2576338"></a>	<a class="indexterm" name="id2576345"></a>	<a class="indexterm" name="id2576352"></a>	<a class="indexterm" name="id2576359"></a>	ドメインSIDはPDCとBDCで同じにしなければならない。バージョン2.2.5	以前のSambaでは、ドメインSIDは<code class="filename">private/MACHINE.SID</code>	ファイルに格納されていた。Sambaバージョン2.2.5以降すべてのバージョンでは、	ドメインSIDは<code class="filename">private/secrets.tdb</code>ファイルに	格納されている。このファイルは各サーバで固有であり、PDCからBDCに	コピーできない。BDCは新しいSIDを起動時に生成する。新しく生成したBDCのSID	はPDCのドメインSIDを上書きする。これは、BDCにドメインSIDを入手することを	認める手続きである。これについては以下で説明する。	</p><p>	<a class="indexterm" name="id2576403"></a>	<a class="indexterm" name="id2576410"></a>	<a class="indexterm" name="id2576417"></a>	<a class="indexterm" name="id2576423"></a>	<a class="indexterm" name="id2576430"></a>	PDCまたは既存のBDCからドメインSIDを検索するためと、検索した値を	<code class="filename">secrets.tdb</code>に格納するためには、以下を実行する:	</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>net rpc getsid</code></strong></pre></li><li class="listitem"><p>	<a class="indexterm" name="id2576473"></a>	<a class="indexterm" name="id2576479"></a>	<a class="indexterm" name="id2576486"></a>	<a class="link" href="smb.conf.5.html#LDAPADMINDN" target="_top">ldap admin dn</a>の指定は必須である。	また、<code class="literal">smbpasswd -w <em class="replaceable"><code>mysecret</code></em></code>	を使って、<code class="filename">secrets.tdb</code>中にLDAP管理用パスワードを	設定しなければならない。	</p></li><li class="listitem"><p>	The <a class="link" href="smb.conf.5.html#LDAPSUFFIX" target="_top">ldap suffix</a>パラメータと<a class="link" href="smb.conf.5.html#LDAPIDMAPSUFFIX" target="_top">ldap idmap suffix</a>	パラメータは<code class="filename">smb.conf</code>ファイル中で指定しなければならない。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2576563"></a>	<a class="indexterm" name="id2576572"></a>	<a class="indexterm" name="id2576579"></a>	<a class="indexterm" name="id2576586"></a>	UNIXユーザデータベースはPDCからBDCへ同期しなければならない。	これは、<code class="filename">/etc/passwd</code>と	<code class="filename">/etc/group</code>の両方がPDCからBDCに複製されなければ	ならないことを意味している。これは変更が発生した時点で、手動で	行うことが出来る。別のやり方として、PDCをNISマスタサーバとして設定し、	BDCをNISスレーブサーバとして設定する。BDCをNISクライアントとして設定	するのでは、PDCが止まっているときにそのユーザデータベースにアクセス	出来ないので不十分である。NISはパスワード同期の唯一の手法というわけ	ではない。LDAPを使う解も同様に動作する。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2576633"></a>	<a class="indexterm" name="id2576640"></a>	<a class="indexterm" name="id2576647"></a>	<a class="indexterm" name="id2576653"></a>	<a class="indexterm" name="id2576660"></a>	<a class="indexterm" name="id2576667"></a>	<a class="indexterm" name="id2576674"></a>	<a class="indexterm" name="id2576680"></a>	SambaパスワードデータベースはPDCからBDCに向けて複製されねばならない。	<code class="literal">rsync</code>と<code class="literal">ssh</code>で<code class="filename">smbpasswd</code>	ファイルの同期を取るのが可能であるが、この方法は破綻していて	欠陥があるので推奨できない。よりよい解決方法は、各BDCに対してスレーブ	LDAPサーバを、PDCにマスタLDAPサーバを設定することである。	rsyncを使う方法は、一定間隔毎にデータが複製されるという理由で、本質的に	欠陥がある。すべての瞬間に、現在のマシンとユーザアカウントの正しい情報で	BDCが操作できるという保証がない。このため、この方法では、首尾一貫しない	セキュリティデータのために不連続なネットワークサービスへのアクセスによって	ユーザに不都合が生じる危険性がある。Windows ワークステーションが通常の	間隔でマシン信頼アカウントパスワードを更新(変更)することを心にとめて	おかねばならず、管理者は通常それが起きていることを知らない。	</p><p>	<a class="indexterm" name="id2576746"></a>	<a class="indexterm" name="id2576752"></a>	<a class="indexterm" name="id2576759"></a>	<a class="indexterm" name="id2576766"></a>	POSIX(UNIXユーザとグループ)アカウントとSambaSAMAccountデータ両方のために	LDAPを使うと、すべてのアカウント変更情報が共有ディレクトリに書かれること	を自動的に保証する。これは、LDAPがその要求に適合するため、アカウント情報の	同期のための、何らかの特別な動作が必要ないことを意味する。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2576788"></a>	<a class="indexterm" name="id2576794"></a>	<a class="indexterm" name="id2576801"></a>	<a class="indexterm" name="id2576808"></a>	<a class="indexterm" name="id2576814"></a>	<a class="indexterm" name="id2576821"></a>	netlogon共有はPDCからBDCに向けて複製されねばならない。これは、ログインスクリプト	が変更されるたびごとに手動で行うことができ、また、<code class="literal">rsync</code>のような	ツールを使うことで、この共有中のディレクトリ構造を複製する、<code class="literal">cron</code>	ジョブを使うことで自動的に行える。netlogon共有内のファイルの複製に	<code class="literal">rsync</code>を使うことは、ネットワークセキュリティに対して特段	問題になることはない。管理者が netlogon 共有に対するすべての変更を明示的に	行ないたいと考えている場合は、手作業で管理するために用いることも可能である。	</p></li></ul></div><div class="sect2" title="設定例"><div class="titlepage"><div><div><h3 class="title"><a name="id2576869"></a>設定例</h3></div></div></div><p>最後に、ワークステーションがBDCを見つけなければならない。これは、Sambaを<a class="link" href="samba-bdc.html#minim-bdc" title="Example 5.3. BDCになるための最低限の設定">BDCになるための最低限の設定</a>中にあるSamba <code class="filename">smb.conf</code>ファイルの<em class="parameter"><code>[global]</code></em>セクションのように設定することで行える。</p><div class="example"><a name="minim-bdc"></a><p class="title"><b>Example 5.3. BDCになるための最低限の設定</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2576919"></a><em class="parameter"><code>workgroup = MIDEARTH</code></em></td></tr><tr><td><a class="indexterm" name="id2576931"></a><em class="parameter"><code>passdb backend = ldapsam:ldap://slave-ldap.quenya.org</code></em></td></tr><tr><td><a class="indexterm" name="id2576943"></a><em class="parameter"><code>domain master = no</code></em></td></tr><tr><td><a class="indexterm" name="id2576955"></a><em class="parameter"><code>domain logons = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2576967"></a><em class="parameter"><code>ldap suffix = dc=abmas,dc=biz</code></em></td></tr><tr><td><a class="indexterm" name="id2576978"></a><em class="parameter"><code>ldap user suffix = ou=Users</code></em></td></tr><tr><td><a class="indexterm" name="id2576990"></a><em class="parameter"><code>ldap group suffix = ou=Groups</code></em></td></tr><tr><td><a class="indexterm" name="id2577002"></a><em class="parameter"><code>ldap machine suffix = ou=Computers</code></em></td></tr><tr><td><a class="indexterm" name="id2577014"></a><em class="parameter"><code>ldap idmap suffix = ou=Idmap</code></em></td></tr><tr><td><a class="indexterm" name="id2577026"></a><em class="parameter"><code>ldap admin dn = cn=sambadmin,dc=quenya,dc=org</code></em></td></tr><tr><td><a class="indexterm" name="id2577039"></a><em class="parameter"><code>idmap backend = ldap:ldap://master-ldap.quenya.org</code></em></td></tr><tr><td><a class="indexterm" name="id2577051"></a><em class="parameter"><code>idmap uid = 10000-20000</code></em></td></tr><tr><td><a class="indexterm" name="id2577063"></a><em class="parameter"><code>idmap gid = 10000-20000</code></em></td></tr></table></div></div><br class="example-break"><p>完全な、OpenLDAPとSambaを使うネットワーク設定の例の説明は、近所又はオンライン書店で買える、<span class="quote">“<span class="quote">Samba-3 by Example</span>”</span>という<a class="ulink" href="http://www.samba.org/samba/docs/Samba3-ByExample" target="_top">本</a>を参照のこと。</p><p><a class="indexterm" name="id2577096"></a><a class="indexterm" name="id2577103"></a><a class="indexterm" name="id2577110"></a><a class="indexterm" name="id2577117"></a>この設定はWINSサーバに、MIDEARTH<1C>という名前のみをBDCによって登録させる。これは、MIDEARTH<1C>というNetBIOSグループ名が、複数のマシンが登録に使用することを意図した NetBIOS グループ名であることを考えれば問題ではない。パラメータ<a class="link" href="smb.conf.5.html#DOMAINMASTER" target="_top">domain master = no</a>は、PDCのために予約されている固有のNetBIOS名であるMIDEARTH<1B>をBDCが登録時に使用させないことを確保する。</p><p><a class="indexterm" name="id2577147"></a><a class="indexterm" name="id2577154"></a><a class="indexterm" name="id2577160"></a><a class="indexterm" name="id2577167"></a><a class="indexterm" name="id2577174"></a><a class="indexterm" name="id2577182"></a><a class="indexterm" name="id2577188"></a><a class="indexterm" name="id2577195"></a><a class="indexterm" name="id2577202"></a><em class="parameter"><code>idmap backend</code></em>パラメータが、<code class="literal">winbindd</code>ユーティリティをリダイレクトして、共有されるリポジトリ内にある、UNIXアカウントに関するすべての、Windows SIDからUIDとGIDへの解決のためにLDAPサーバデータベースを使用させる。BDCは<code class="literal">nss_ldap</code>ユーティリティとNSS経由の、ローカルでのUIDとGIDの解決にも依存する。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2577237"></a><a class="indexterm" name="id2577247"></a><a class="indexterm" name="id2577254"></a><a class="indexterm" name="id2577261"></a>Samba-3は新しいIDマッピング機能を導入した。その機能の特徴の1つは、NTドメインのユーザとグループSIDに関してユーザとグループIDを取り扱うやり方に、より高い柔軟性を備えているということである。新しい機能の1つは、UNIX/LinuxのUIDとGIDの値が、PDC、すべてのBDCとすべてのドメインメンバサーバ上で一貫していることを明確に確保する。これを制御するパラメータは、<em class="parameter"><code>idmap backend</code></em>である。その動作に関連する詳細な情報は、<code class="filename">smb.conf</code>マニュアルページを参照してほしい。</p></div><p><a class="indexterm" name="id2577296"></a><a class="indexterm" name="id2577302"></a><a class="indexterm" name="id2577309"></a>BDC上のみで<a class="link" href="smb.conf.5.html#IDMAPBACKEND" target="_top">idmap backend = ldap:ldap://master.quenya.org</a>オプションを使用することは、PDC上でldapsamが使われている時に意味をなす。LDAPベースのバックエンドのもう1つの目的は、(固有のpassdbバックエンドを持たない)ドメインメンバがWindowsネットワークユーザとグループを共通のUID/GIDに割り当てるためにwinbinddを使えるようにすることである。別の言い方をすると、一般的にこのオプションは、BDCとドメインメンバサーバ上で使うことを意図している。</p></div></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2577344"></a>よくあるエラー</h2></div></div></div><p><a class="indexterm" name="id2577351"></a>ドメイン制御はSambaの新しい領域であるが、現在では参照可能なたくさんの事例がある。更新情報は、それが有効になった時点で、Sambaの新規リリース情報か、Samba Web<a class="ulink" href="http://samba.org" target="_top">site</a>で公開される。Sambaリリースパッケージの<code class="filename">WHATSNEW.txt</code>を特に参照すること。<span class="quote">“<span class="quote">Samba-3 by Example</span>”</span>という本には、よくテストされ、検証された例が記述されている。これをSamba Webサイト上の<a class="ulink" href="http://www.samba.org/samba/docs/Samba3-ByExample.pdf" target="_top">本</a>からコピーを入手することもできる。</p><div class="sect2" title="マシンアカウントが満了し続ける"><div class="titlepage"><div><div><h3 class="title"><a name="id2577394"></a>マシンアカウントが満了し続ける</h3></div></div></div><p><a class="indexterm" name="id2577402"></a><a class="indexterm" name="id2577409"></a><a class="indexterm" name="id2577416"></a><a class="indexterm" name="id2577422"></a>この問題は、passdb(SAM)ファイルが中央のサーバからコピーしていて、しかもローカルのBDCがPDCとして動作する時に発生する。これはローカルマシン信頼アカウントのパスワードをローカルSAMへ更新を実行することで解決する。そのような更新は中央のサーバにコピーは戻されない。新しいマシンアカウントのパスワードは、PDCからのSAMが再度コピーされたときに上書きされてしまう。その結果、起動時のドメインメンバであるマシンの起動時に、そのパスワードがデータベース中と一致しないことになり、起動時のセキュリティチェックに失敗するため、このマシンはログオン要求が許可されず、アカウント満了エラーが出ることになる。</p><p>解決策は、ldapsamバックエンドのようなより堅牢なpassdbバックエンドを使うことである。すなわち、各BDCにスレーブLDAPサーバを立て、PDCにマスタLDAPサーバを立てることである。</p></div><div class="sect2" title="SambaはNT4 PDCのバックアップドメインコントローラになれるか?"><div class="titlepage"><div><div><h3 class="title"><a name="id2577472"></a>SambaはNT4 PDCのバックアップドメインコントローラになれるか?</h3></div></div></div><p><a class="indexterm" name="id2577483"></a><a class="indexterm" name="id2577492"></a>できない。オリジナルのNT4 SAM複製プロトコルはまだ完全に実装されていない。</p><p><a class="indexterm" name="id2577505"></a><a class="indexterm" name="id2577512"></a><a class="indexterm" name="id2577518"></a>SambaでBDCを使う利点はあるかと言われればもちろんある。しかし、それはSamba PDCに対してのみである。BDCを使う理由は可用性という点である。もしもPDCがSambaだった場合、2番目のSambaマシンは、PDCがダウンしている時にログオン要求をサービスするように設定できる。</p></div><div class="sect2" title="smbpasswdファイルの複製はどうやるか?"><div class="titlepage"><div><div><h3 class="title"><a name="id2577538"></a>smbpasswdファイルの複製はどうやるか?</h3></div></div></div><p><a class="indexterm" name="id2577547"></a><a class="indexterm" name="id2577556"></a><a class="indexterm" name="id2577563"></a>smbpasswdファイルの複製は注意が必要である。SAMが変更されたときは必ず行わなければならない。各ユーザのパスワードの変更はsmbpasswdファイル中で行われるので、必ずBDCに複製されねばならない。そのため、smbpasswdファイルの複製は非常に頻繁に必要となる。</p><p><a class="indexterm" name="id2577583"></a><a class="indexterm" name="id2577590"></a><a class="indexterm" name="id2577597"></a>smbpasswdファイルには平文パスワードと同等のものが含まれているので、ネットワーク上で暗号化しないで送ってはならない。PDCからBDCへ、smbpasswdを複製する最もよい方法は、rsyncを使うことである。rsyncは伝送路としてsshを使える。<code class="literal">ssh</code>は、ユーザがパスワードを入力<span class="emphasis"><em>しなくても</em></span><code class="literal">rsync</code>での転送ができるように設定できる。</p><p><a class="indexterm" name="id2577633"></a><a class="indexterm" name="id2577640"></a>少し前に説明したが、この方法を使うことは欠陥があるため危険である。マシン信頼アカウントの同期が外れると、結果としてドメインが破壊される。この方法は<span class="emphasis"><em>推奨されない</em></span>。その代わりにLDAPを使うこと。</p></div><div class="sect2" title="これをすべてのLDAPに使えるか?"><div class="titlepage"><div><div><h3 class="title"><a name="id2577661"></a>これをすべてのLDAPに使えるか?</h3></div></div></div><p><a class="indexterm" name="id2577669"></a><a class="indexterm" name="id2577676"></a>一言で言うと可能である。Sambaのpdb_ldapコードはレプリカLDAPサーバに対するバインドをサポートし、データベースに対する変更の必要時には、referralの追跡と再バインドを行う(通常BDCはリードオンリで、そのためこれは滅多に起こらない)。</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="samba-pdc.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="type.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="domain-member.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 4. ドメイン制御 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 6. ドメインメンバシップ</td></tr></table></div></body></html>