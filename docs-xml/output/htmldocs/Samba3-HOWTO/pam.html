<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 28. PAM ベースの分散型認証</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="ProfileMgmt.html" title="Chapter 27. デスクトッププロファイルの管理"><link rel="next" href="integrate-ms-networks.html" title="Chapter 29. Microsoft Windows ネットワークへのSambaの統合"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 28. PAM ベースの分散型認証</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ProfileMgmt.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="integrate-ms-networks.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 28. PAM ベースの分散型認証"><div class="titlepage"><div><div><h2 class="title"><a name="pam"></a>Chapter 28. PAM ベースの分散型認証</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Stephen</span> <span class="surname">Langasek</span></h3><div class="affiliation"><div class="address"><p><code class="email"><<a class="email" href="mailto:vorlon@netexpress.net">vorlon@netexpress.net</a>></code></p></div></div></div></div><div><p class="pubdate">May 31, 2003</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="pam.html#id2687121">その機能と利点</a></span></dt><dt><span class="sect1"><a href="pam.html#id2687825">技術的な議論</a></span></dt><dd><dl><dt><span class="sect2"><a href="pam.html#id2687885">PAM 設定のための文法</a></span></dt><dt><span class="sect2"><a href="pam.html#id2689138">システム設定の例</a></span></dt><dt><span class="sect2"><a href="pam.html#id2689506"><code class="filename">smb.conf</code> の PAM 設定</a></span></dt><dt><span class="sect2"><a href="pam.html#id2689602"><code class="filename">winbindd.so</code>を使った遠隔 CIFS 認証</a></span></dt><dt><span class="sect2"><a href="pam.html#id2689736"><code class="filename">pam_smbpass.so</code> を使ったパスワードの同期</a></span></dt></dl></dd><dt><span class="sect1"><a href="pam.html#id2690202">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="pam.html#id2690217">pam_winbind の問題</a></span></dt><dt><span class="sect2"><a href="pam.html#id2690332">Winbind がユーザとグループを解決してくれない</a></span></dt></dl></dd></dl></div><p><a class="indexterm" name="id2687033"></a><a class="indexterm" name="id2687040"></a><a class="indexterm" name="id2687047"></a><a class="indexterm" name="id2687053"></a>この章は、何らかの PAM が利用できる UNIX/Linux システムに対して Winbindベースの認証を導入する際の助けになるだろう。Winbind を使うと、いずれかのWindows NT ドメイン、Windows 200x の Active Directory ベースのドメイン、そして Samba ベースのドメイン環境において、ユーザレベルのアプリケーションアクセス認証を利用できるようになる。また、あなたの Samba 環境の設定に対する適切な PAM ベースのローカルホストアクセス制御にも役立つ。</p><p><a class="indexterm" name="id2687074"></a><a class="indexterm" name="id2687081"></a>PAM 経由の Winbind の設定方法を知ることに加え、さらに一般的な PAM 管理の可能性と、特に <code class="filename">pam_smbpass.so</code> のようなツールを導入して便利に使う方法も学ぶことができるだろう。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Winbind を使うのは、PAM 構成を単独で行うよりも敷居が高い。Winbind に関するより詳細な情報については<a class="link" href="winbind.html" title="Chapter 24. Winbind: ドメインアカウントの使用">Winbind: ドメインアカウントを使う</a>を参照されたい。</p></div><div class="sect1" title="その機能と利点"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2687121"></a>その機能と利点</h2></div></div></div><p><a class="indexterm" name="id2687129"></a><a class="indexterm" name="id2687136"></a><a class="indexterm" name="id2687143"></a><a class="indexterm" name="id2687150"></a><a class="indexterm" name="id2687159"></a><a class="indexterm" name="id2687166"></a><a class="indexterm" name="id2687173"></a><a class="indexterm" name="id2687179"></a>現在、多くの UNIX システム（例：Oracle(Sun)Solaris）や xxxxBSDファミリーおよびLinux では、着脱可能な認証モジュール(PAM)機能を使って全ての認証、承認処理、リソースの制御サービスを提供している。PAM の導入以前は、システムパスワードデータベース(<code class="filename">/etc/passwd</code>)以外のものを使おうとするなら、セキュリティサービスを提供するすべてのプログラムそれぞれに対して代替手段を準備する必要がある。つまり、<code class="literal">login</code>, <code class="literal">passwd</code>, <code class="literal">chown</code> といったものの代替手段を別途用意しなければならないということである。</p><p><a class="indexterm" name="id2687233"></a><a class="indexterm" name="id2687240"></a><a class="indexterm" name="id2687246"></a><a class="indexterm" name="id2687253"></a>PAM を使うと、これらのセキュリティプログラムを、これらが依存する認証／承認インフラから切り離すことができる。PAM を構成するには、<code class="filename">/etc/pam.conf</code> という１つのファイルを適切に変更する(Solaris)か、または<code class="filename">/etc/pam.d</code>配下にある個別の制御ファイルを編集する。</p><p><a class="indexterm" name="id2687285"></a><a class="indexterm" name="id2687293"></a>PAM が有効になっている UNIX/Linux システムでは、動的なロードができる適切なライブラリモジュールが利用できるようになっていれば、システムでさまざまな認証バックエンドを使うように構成するのは簡単である。それらのバックエンドはシステムでローカルに閉じていてもよいし、リモートサーバ上で集約されていてもよい。</p><p>PAM サポートモジュールで使えるもの：</p><div class="variablelist"><dl><dt><span class="term"><code class="filename">/etc/passwd</code></span></dt><dd><p><a class="indexterm" name="id2687330"></a><a class="indexterm" name="id2687337"></a><a class="indexterm" name="id2687344"></a><a class="indexterm" name="id2687351"></a><a class="indexterm" name="id2687358"></a><a class="indexterm" name="id2687364"></a>これらの PAM モジュールは標準の UNIX ユーザデータベースを利用する。最も有名なものは、<code class="filename">pam_unix.so</code>, <code class="filename">pam_unix2.so</code>, <code class="filename">pam_pwdb.so</code>,<code class="filename">pam_userdb.so</code>と呼ばれるものである。</p></dd><dt><span class="term">Kerberos</span></dt><dd><p><a class="indexterm" name="id2687409"></a><a class="indexterm" name="id2687416"></a><a class="indexterm" name="id2687423"></a><a class="indexterm" name="id2687430"></a><a class="indexterm" name="id2687437"></a><code class="filename">pam_krb5.so</code> モジュールを使うと、ケルベロス準拠のあらゆるサーバを使える。このツールは MIT Kerberos, Heimdal Kerberos, そしておそらく（もし有効であれば）Microsoft Active Directory にアクセスするのにも使える。</p></dd><dt><span class="term">LDAP</span></dt><dd><p><a class="indexterm" name="id2687468"></a><a class="indexterm" name="id2687475"></a><a class="indexterm" name="id2687482"></a><a class="indexterm" name="id2687488"></a><a class="indexterm" name="id2687495"></a><a class="indexterm" name="id2687502"></a><code class="filename">pam_ldap.so</code> モジュールを使うと、LDAP v2 もしくは v3準拠のあらゆるバックエンドサーバを使える。よく使われる LDAP バックエンドサーバには OpenLDAP v2.0 and v2.1, Sun ONE iDentity server, Novell eDirectory server, Microsoft Active Directory がある。</p></dd><dt><span class="term">NetWare Bindery</span></dt><dd><p><a class="indexterm" name="id2687535"></a><a class="indexterm" name="id2687542"></a><a class="indexterm" name="id2687549"></a><a class="indexterm" name="id2687556"></a><code class="filename">pam_ncp_auth.so</code> モジュールを使うと、バインダリ(Bindery)が有効な NetWare コアプロトコルベースのサーバによる認証を利用できるようになる。</p></dd><dt><span class="term">SMB Password</span></dt><dd><p><a class="indexterm" name="id2687585"></a><a class="indexterm" name="id2687592"></a><a class="indexterm" name="id2687599"></a><code class="filename">pam_smbpass.so</code> と呼ばれるモジュールを使うと、Samba の<code class="filename">smb.conf</code> ファイルで設定された passdb バックエンドのユーザ認証を利用できるようになる。</p></dd><dt><span class="term">SMB Server</span></dt><dd><p><a class="indexterm" name="id2687633"></a><a class="indexterm" name="id2687640"></a><code class="filename">pam_smb_auth.so</code> モジュールは、オリジナルの MS Windowsネットワーク認証のためのツールである。Winbind モジュールがリリースされている現在、このモジュールはすでに多少古臭くなってしまっている。</p></dd><dt><span class="term">Winbind</span></dt><dd><p><a class="indexterm" name="id2687671"></a><a class="indexterm" name="id2687678"></a><a class="indexterm" name="id2687685"></a><a class="indexterm" name="id2687692"></a><code class="filename">pam_winbind.so</code> モジュールは、Samba は MS Windows のドメインコントローラーからの認証情報を取得できるようにするものである。これにより、PAM が有効なアプリケーションに対して認証されたユーザへのアクセス権を与えるのが簡単になる。</p></dd><dt><span class="term">RADIUS</span></dt><dd><p><a class="indexterm" name="id2687725"></a>PAM RADIUS (Remote Access Dial-In User Service) と呼ばれる認証モジュールがある。ほとんどのケースでは、管理者がこのツールのソースコードを持ってきて自分自身でインストールを行う必要がある。RADIUS プロトコルは多くのルータやターミナルサーバで使われているプロトコルである。</p></dd></dl></div><p><a class="indexterm" name="id2687751"></a><a class="indexterm" name="id2687758"></a>上記のうち、<code class="filename">pam_smbpasswd.so</code> と <code class="filename">pam_winbind.so</code>モジュールは、Samba 自身が提供するものである。</p><p><a class="indexterm" name="id2687784"></a><a class="indexterm" name="id2687791"></a><a class="indexterm" name="id2687798"></a><a class="indexterm" name="id2687805"></a>いったんこれらのモジュールを設定してしまえば、広範囲にまたがるネットワーク帯域や PAM を利用した効率的な認証サービスを提供するような分散 Samba ドメインコントローラの利用においても、高い柔軟性を得ることができる。つまり、単一のユーザアカウントデータベースを使って、中央集中的な管理や保守の行き届いた分散認証を実現できるのである。</p></div><div class="sect1" title="技術的な議論"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2687825"></a>技術的な議論</h2></div></div></div><p><a class="indexterm" name="id2687832"></a><a class="indexterm" name="id2687839"></a><a class="indexterm" name="id2687846"></a><a class="indexterm" name="id2687853"></a>システム管理者が自分のシステム上のアプリケーションにアクセス権を付与する際、PAM はかなり柔軟に設定できるように設計されている。PAM によって制御されるシステムセキュリティのためのローカル設定には、単一ファイル <code class="filename">/etc/pam.conf</code> と <code class="filename">/etc/pam.d/</code>ディレクトリーの２つがある。</p><div class="sect2" title="PAM 設定のための文法"><div class="titlepage"><div><div><h3 class="title"><a name="id2687885"></a>PAM 設定のための文法</h3></div></div></div><p><a class="indexterm" name="id2687894"></a><a class="indexterm" name="id2687901"></a>この章では、これらのファイルで記述するエントリに関する正しい文法、および一般的なオプションについて解説する。設定ファイルにおける PAM 特有のトークンでは、大文字小文字の区別を行わない。ただし、モジュールのパスについては大文字小文字を区別する。なぜなら、これらはファイルの名前を示すものであり、大文字小文字を区別するような一般的なファイルシステムの性質に影響を受けるからである。与えられたモジュールに渡すための引数が大文字小文字を区別するかどうかは、それぞれのモジュールで規定されている。</p><p>後述の設定行に加え、システム管理者の便宜のために２つの特殊文字がある：<span class="quote">“<span class="quote">#</span>”</span> から行末まではコメントとみなされる。またモジュールを指定する行については <span class="quote">“<span class="quote">\</span>”</span> で改行をエスケープすることで、次の行にまたがることができる。</p><p><a class="indexterm" name="id2687956"></a><a class="indexterm" name="id2687964"></a>PAM の認証モジュール（ダイナミックリンクされたライブラリファイル）が既定値の位置にある場合は、そのパスを明示する必要はない。Linux の場合、既定値の位置は <code class="filename">/lib/security</code> となる。モジュールが既定値位置以外にある場合は</p><pre class="programlisting">auth  required  /other_path/pam_strange_module.so</pre><p>のようにパスを明示しなければならない。</p><div class="sect3" title="/etc/pam.d にあるエントリーの構造"><div class="titlepage"><div><div><h4 class="title"><a name="id2687997"></a><code class="filename">/etc/pam.d</code> にあるエントリーの構造</h4></div></div></div><p>このセクションの残りの部分は、Linux-PAM プロジェクトのドキュメントからの引用である。PAM に関する詳細は<a class="ulink" href="http://ftp.kernel.org/pub/linux/libs/pam/" target="_top">the Official Linux-PAM home page</a>を参照のこと。</p><p><a class="indexterm" name="id2688026"></a><code class="filename">/etc/pam.conf</code> ファイル中の一般的な設定行は、以下の書式で記述する：</p><pre class="programlisting">サービス名  モジュールタイプ  制御フラグ  モジュールパス  引数</pre><p></p><p>これら各トークンの意味について解説する。Linux-PAM を構成するための2番目のやり方（最近はむしろこちらの方が多いようだが）は、<code class="filename">/etc/pam.d/</code> ディレクトリーの中身を介するという方法である。それぞれのトークンの意味するところを解説した後、この方法について述べることにする。</p><div class="variablelist"><dl><dt><span class="term">サービス名</span></dt><dd><p><a class="indexterm" name="id2688083"></a><a class="indexterm" name="id2688090"></a><a class="indexterm" name="id2688097"></a>このエントリに関連付けられるサービスの名前。<code class="literal">ftpd</code>, <code class="literal">rlogind</code>, <code class="literal">su</code> のように、サービス名はアプリケーションにつけられた伝統的な名前であることが多い。</p><p>既定値の認証メカニズムを定義するために予約されている、特別な名前もある。これは <em class="parameter"><code>OTHER</code></em> と呼ばれるが、大文字小文字は固定されていない。名前付きサービスに特化したモジュールがある場合、<em class="parameter"><code>OTHER</code></em>エントリーは無視される事に注意。		</p></dd><dt><span class="term">モジュールタイプ</span></dt><dd><p>（現時点では）以下の通り4つのタイプのモジュールがある。		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2688173"></a><a class="indexterm" name="id2688180"></a><em class="parameter"><code>auth:</code></em> このモジュールタイプは、ユーザを認証するにあたって２つの側面がある。まず、アプリケーションに対してパスワード問い合わせの指示を行うか、または別の手段を使って、操作しているユーザが誰なのかを特定する。次に、このモジュールはその資格認定から承認という性質を通して(<code class="filename">/etc/groups</code> ファイルとは独立した形で)グループの会員資格やその他の特権に関する許可を与えることができる。			</p></li><li class="listitem"><p><a class="indexterm" name="id2688217"></a><a class="indexterm" name="id2688224"></a><em class="parameter"><code>account:</code></em> このモジュールは、認証をベースとしないアカウント管理を行う。よくある利用法としては、利用時間帯、現時点で利用可能なシステムリソース（最大ユーザ数）、またはユーザがログインした場所などをベースとした、サービスへのアクセスの制限や許可が挙げられる。たとえば <span class="quote">“<span class="quote">root</span>”</span> ログインの許可は、コンソールからのみに制限されているかもしれない。			</p></li><li class="listitem"><p><a class="indexterm" name="id2688259"></a><em class="parameter"><code>session:</code></em> このモジュールは、主に対象のユーザがサービスを割り当てられる前後に行われるべきことに関連付けられる。たとえばそのユーザに関する何らかのデータ交換をする際のオープン/クローズ情報のログを取ったり、ディレクトリをマウントすることなどが挙げられる。</p></li><li class="listitem"><p><a class="indexterm" name="id2688286"></a><em class="parameter"><code>password:</code></em> この最後のモジュールタイプは、そのユーザに関連する認証トークンを更新するために必要なものである。典型的には、<span class="quote">“<span class="quote">チャレンジ/レスポンス</span>”</span> 認証を行う<em class="parameter"><code>(auth)</code></em> モジュールタイプがある。</p></li></ul></div></dd><dt><span class="term">制御フラグ</span></dt><dd><p>制御フラグは、関連するモジュールの成功／失敗に対して PAMライブラリがどう対応するのかを指示するのに使われる。PAM モジュール群はスタック化(同じタイプのモジュール群を次々に重ねること)できるので、制御フラグがそれぞれのモジュールの相対的な重要度を決定する。アプリケーションは <code class="filename">/etc/pam.conf</code> ファイルにあるモジュールについて、個々の成功や失敗に影響されない。その代わり、Linux-PAM ライブラリからの成功や失敗の応答のサマリを受け取る。これらのモジュールは、<code class="filename">/etc/pam.conf</code> に記述されている順に実行される。つまり前の方にあるエントリは後ろの方のものより先に実行される。Linux-PAM v0.60 の場合、制御フラグは２つの文法のうちのいずれかで定義できる。</p><p><a class="indexterm" name="id2688373"></a><a class="indexterm" name="id2688380"></a><a class="indexterm" name="id2688387"></a><a class="indexterm" name="id2688393"></a>制御フラグについてのシンプルな(かつ従来の)文法では、特定のモジュールの成功や失敗について、それらを通知するための重大度を単一のキーワードで指定する。キーワードには <em class="parameter"><code>required</code></em>, <em class="parameter"><code>requisite</code></em>, <em class="parameter"><code>sufficient</code></em>, <em class="parameter"><code>optional</code></em> の4種類ある。	</p><p>		Linux-PAM ライブラリでは以下の方式でこれらのキーワードを		解釈する。		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><em class="parameter"><code>required:</code></em>このモジュールタイプ機能が成功するためにはこのモジュールが成功することが必須である。ただしこのモジュールが失敗した場合でも、(同じモジュールタイプを持つ)残りのすべてのモジュールの実行が完了するまでは、失敗したことはユーザには通知されない。			</p></li><li class="listitem"><p><em class="parameter"><code>requisite:</code></em> required と似ているが、このモジュールが失敗を返したとき制御が直接アプリケーションに戻されるところが異なる。その戻り値は、失敗したモジュールのうち最初に required もしくは requisite 指定されていたものに関連付けられる。安全でない媒体を通してユーザがパスワードを入力するような可能性がある場合、このフラグはその状況を排除するために使える。そのような可能性が残っていると、システム上の有効なアカウントの情報を攻撃者に知らせてしまうようなことにつながりかねない。このような可能性があると、共用ホスト環境で慎重に扱うべきパスワードを公開してしまうようなゆゆしき環境において、一方的に不利になるだろう。			</p></li><li class="listitem"><p><em class="parameter"><code>sufficient:</code></em> このモジュールが成功すると、Linux-PAM ライブラリがこのモジュールタイプについてその目的を達成したものとするのに<em class="parameter"><code>sufficient</code></em>(十分である)とみなされる。これまでに要求されたモジュールのうち失敗したものがない場合、このタイプに関して<span class="quote">“<span class="quote">スタックされた</span>”</span>モジュールは、これ以上起動されない(この場合、この後に続くモジュールは起動されない)。ただし、このモジュールが失敗しても、このモジュールタイプレベルで成功したアプリケーションについては致命的エラーとはみなされない。			</p></li><li class="listitem"><p><em class="parameter"><code>optional:</code></em> この制御フラグは、その名前が示しているように、そのモジュールの成功/失敗が、そのユーザアプリケーションがサービスを提供できるかどうかを決めるものではないことを示す。一般に、そのモジュールスタック全体が成功か失敗かを決定する際、Linux-PAM はこのようなモジュールを考慮しない。しかしながら、それ以前もしくはそれ以降のどのモジュールも明確に成功か失敗かを示さない場合、このモジュールがアプリケーションへの応答の性質を決めることがある。後者のひとつの例として、他のモジュールが PAM_IGNORE のようなものを返した場合が挙げられる。			</p></li></ul></div><p>ユーザを認証する方法について、その文法が複雑に(新しく)なればなるほど、管理者はより詳しく記述し、より細かく制御できるようになるものである。この制御フラグの書式は、以下のように<em class="parameter"><code>値=アクション</code></em> トークンの並びが大括弧で区切られたものである:		</p><pre class="programlisting">[値1=アクション1 値2=アクション2 ...]</pre><p>ここで、<em class="parameter"><code>値1</code></em> は以下の戻り値のいずれかである:</p><pre class="screen"><em class="parameter"><code>success; open_err; symbol_err; service_err; system_err; buf_err;</code></em><em class="parameter"><code>perm_denied; auth_err; cred_insufficient; authinfo_unavail;</code></em><em class="parameter"><code>user_unknown; maxtries; new_authtok_reqd; acct_expired; session_err;</code></em><em class="parameter"><code>cred_unavail; cred_expired; cred_err; no_module_data; conv_err;</code></em><em class="parameter"><code>authtok_err; authtok_recover_err; authtok_lock_busy;</code></em><em class="parameter"><code>authtok_disable_aging; try_again; ignore; abort; authtok_expired;</code></em><em class="parameter"><code>module_unknown; bad_item;</code></em> と <em class="parameter"><code>default</code></em>.</pre><p></p><p>最後の<em class="parameter"><code>default</code></em>は、明示的に定義されない戻り値に対する動作を規定するのに使える。		</p><p><em class="parameter"><code>アクション1</code></em> には正の整数かまたは以下のトークンのいずれかを指定する:<em class="parameter"><code>ignore</code></em>; <em class="parameter"><code>ok</code></em>; <em class="parameter"><code>done</code></em>;<em class="parameter"><code>bad</code></em>; <em class="parameter"><code>die</code></em>; <em class="parameter"><code>reset</code></em>.正の整数 J がアクションとして指定された場合、現在のモジュールタイプについて続く J 個のモジュールをスキップする。この方法により、管理者は異なった実行パスを持つ多くのスタックされたモジュールを、適度に洗練された方法で組み合わせることができる。個々のモジュールの反応によって、どのパスにあるものが適用されるかが決定される。		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><em class="parameter"><code>ignore:</code></em> モジュールスタックに対して使われると、そのモジュールの戻り値は、アプリケーションが受け取るリターンコードには影響しない。			</p></li><li class="listitem"><p><em class="parameter"><code>bad:</code></em> このアクションが指定されると、戻り値はモジュールの失敗を表しているとみなされる。このモジュールがスタックの中で最初に失敗すると、その戻り値はスタック全体の値として使われる。			</p></li><li class="listitem"><p><em class="parameter"><code>die:</code></em> bad と同じだが、さらにモジュールスタックが終了して即時に PAM がアプリケーションに結果を返す。			</p></li><li class="listitem"><p><em class="parameter"><code>ok:</code></em> この戻り値をモジュールスタック全体の戻り値として直接返すべきだと管理者が考えていることを PAM に教える。つまり、このスタックの直前の状態が戻り値 PAM_SUCCESS を返すことになっていた場合は、モジュールの戻り値がこの値を上書きする。もしスタックの直前の状態が特定のモジュールの失敗を表す何らかの値を保持している場合は、この <em class="parameter"><code>ok</code></em>値はその値を上書きしない。			</p></li><li class="listitem"><p><em class="parameter"><code>done:</code></em> <em class="parameter"><code>ok</code></em> と同じだが、モジュールスタックを終了させて PAM の制御を即時にアプリケーションに戻すという副作用があるところが異なる。                        </p></li><li class="listitem"><p><em class="parameter"><code>reset:</code></em> モジュールスタックの状態を保持するメモリをクリアし、次のスタックモジュールから実行を再開する。			</p></li></ul></div><p><em class="parameter"><code>required</code></em>; <em class="parameter"><code>requisite</code></em>;<em class="parameter"><code>sufficient</code></em>; <em class="parameter"><code>optional</code></em>はそれぞれ [...] という構文をもつという意味では同等の、以下の表現を備えている：		</p><p>		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><em class="parameter"><code>required</code></em> は<em class="parameter"><code>[success=ok new_authtok_reqd=ok ignore=ignore default=bad]</code></em>と同等。			</p></li><li class="listitem"><p><em class="parameter"><code>requisite</code></em> は<em class="parameter"><code>[success=ok new_authtok_reqd=ok ignore=ignore default=die]</code></em>と同等。			</p></li><li class="listitem"><p><em class="parameter"><code>sufficient</code></em> は<em class="parameter"><code>[success=done  new_authtok_reqd=done  default=ignore]</code></em>と同等。			</p></li><li class="listitem"><p><em class="parameter"><code>optional</code></em> は<em class="parameter"><code>[success=ok new_authtok_reqd=ok default=ignore]</code></em>と同等である。			</p></li></ul></div><p>		</p><p>この新しい書式が持つパワーの感触をつかむために、これで何ができるのかを体験してみるとよいだろう。Linux-PAM-0.63 ではクライアント・プラグイン・エージェントの概念が導入された。これにより、PAM ではクライアント・サーバ・アプリケーションに対して、トランスポート・プロトコルの継承を利用したマシン間の認証を可能にしている。<em class="parameter"><code>[ ... value=action ... ]</code></em> という制御用構文により、アプリケーションがそれに準拠するクライアントに対してバイナリ・プロンプトのサポートを構成できるようになっている。ただしレガシーアプリケーションの場合は柔軟に代替認証モードにフェイルオーバーできる。		</p></dd><dt><span class="term">module-path</span></dt><dd><p>動的ローダブルオブジェクトファイルのパス名 - 差し替え可能なモジュールそのもの。モジュールパスの最初の文字が<span class="quote">“<span class="quote">/</span>”</span> の場合、それは絶対パスであるとみなされる。そうでない場合、与えられたモジュールパスは既定値のモジュールパスである <code class="filename">/lib/security</code> の後ろに付加される(ただし前述の注意事項を参照のこと)。		</p><p>引数は、起動時にモジュールに渡されるトークンのリストであり、典型的なLinux のシェルコマンドへの引数と同様である。一般的に、有効な引数はオプションであり、与えられたモジュール固有のものであることが多い。無効な引数はモジュールによって無視される。しかしながら、無効な引数に出会った場合、そのモジュールは syslog(3) に対してエラーメッセージを出力しなければならない。共通的なオプションについては次の節を参照して欲しい。		</p><p>引数の中に空白を含める場合は引数全体を大括弧 [] で括るようにする。次に例を示す:		</p><pre class="programlisting">squid auth required pam_mysql.so user=passwd_query passwd=mada \db=eminence [query=select user_name from internet_service where \user_name=<span class="quote">“<span class="quote">%u</span>”</span> and password=PASSWORD(<span class="quote">“<span class="quote">%p</span>”</span>) and service=<span class="quote">“<span class="quote">web_proxy</span>”</span>]</pre><p>この書式を使う場合は文字列の中に <span class="quote">“<span class="quote">[</span>”</span> 文字を含んでもよい。また文字列の中に <span class="quote">“<span class="quote">]</span>”</span> 文字を含める場合は、引数の解析が正しく行えるように <span class="quote">“<span class="quote">\[</span>”</span> を使うべきである。すなわち以下のようになる。		</p><pre class="programlisting">[..[..\]..]    -->   ..[..]..</pre><p>設定ファイルの中でひとつでも書式が正しくない行があれば、(エラーが起こって)認証処理は失敗すると思った方がよい。対応するエラーはsyslog(3) への呼び出しを通してシステムのログファイルに書き込まれる。		</p></dd></dl></div></div></div><div class="sect2" title="システム設定の例"><div class="titlepage"><div><div><h3 class="title"><a name="id2689138"></a>システム設定の例</h3></div></div></div><p>以下は設定ファイル <code class="filename">/etc/pam.d/login</code>の例である。この例ではすべてのオプションがコメント状態をはずされて(=有効になって)おり、おそらくこのままでは使い物にならないだろう。というのは、ログインプロセスが成功するまでに多くの条件が積み重なっているからである。<code class="filename">pam_pwdb.so</code> の呼び出しを除き、原則的にはすべての条件をコメントアウトして無効にすることができる。</p><div class="sect3" title="PAM: オリジナルのログイン設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2689175"></a>PAM: オリジナルのログイン設定</h4></div></div></div><p>	</p><pre class="programlisting">#%PAM-1.0# The PAM configuration file for the <span class="quote">“<span class="quote">login</span>”</span> service#auth         required    pam_securetty.soauth         required    pam_nologin.so# auth       required    pam_dialup.so# auth       optional    pam_mail.soauth         required    pam_pwdb.so shadow md5# account    requisite   pam_time.soaccount      required    pam_pwdb.sosession      required    pam_pwdb.so# session    optional    pam_lastlog.so# password   required    pam_cracklib.so retry=3password     required    pam_pwdb.so shadow md5</pre><p></p></div><div class="sect3" title="PAM: pam_smbpass を使ったログイン"><div class="titlepage"><div><div><h4 class="title"><a name="id2689204"></a>PAM: <code class="filename">pam_smbpass</code> を使ったログイン</h4></div></div></div><p>PAM では交換式モジュールが利用できる。サンプルシステムでは以下のものが利用可能:</p><p><code class="prompt">$</code><strong class="userinput"><code>/bin/ls /lib/security</code></strong></p><pre class="programlisting">pam_access.so    pam_ftp.so          pam_limits.so     pam_ncp_auth.so  pam_rhosts_auth.so  pam_stress.so     pam_cracklib.so  pam_group.so        pam_listfile.so   pam_nologin.so   pam_rootok.so       pam_tally.so      pam_deny.so      pam_issue.so        pam_mail.so       pam_permit.so    pam_securetty.so    pam_time.so       pam_dialup.so    pam_lastlog.so      pam_mkhomedir.so  pam_pwdb.so      pam_shells.so       pam_unix.so       pam_env.so       pam_ldap.so         pam_motd.so       pam_radius.so    pam_smbpass.so      pam_unix_acct.so  pam_wheel.so     pam_unix_auth.so    pam_unix_passwd.sopam_userdb.so    pam_warn.so         pam_unix_session.so</pre><p>以下のログインプログラムの例では、システムパスワードデータベース(<code class="filename">/etc/passwd</code>,<code class="filename">/etc/shadow</code>, <code class="filename">/etc/group</code>) を使う <code class="filename">pam_pwdb.so</code> を<code class="filename">pam_smbpass.so</code> で置き換えている。後者では Microsoft MD4 暗号化パスワードハッシュを含む Samba のデータベースを使う。このデータベースは使用している UNIX/Linux システムの実装により<code class="filename">/usr/local/samba/private/smbpasswd</code>, <code class="filename">/etc/samba/smbpasswd</code>,<code class="filename">/etc/samba.d/smbpasswd</code>のいずれかに格納される。<code class="filename">pam_smbpass.so</code> モジュールは Samba 2.2.1 以降で提供される。このモジュールをコンパイルしたい場合は、Samba の <code class="literal">configure</code> スクリプト実行時に <code class="option">--with-pam_smbpass</code> オプションを指定する。<code class="filename">pam_smbpass</code> モジュールに関する詳細については Samba ソースの配布物の<code class="filename">source/pam_smbpass</code> ディレクトリにあるドキュメントを参照して欲しい。</p><p>	</p><pre class="programlisting">#%PAM-1.0# The PAM configuration file for the <span class="quote">“<span class="quote">login</span>”</span> service#auth        required    pam_smbpass.so nodelayaccount     required    pam_smbpass.so nodelaysession     required    pam_smbpass.so nodelaypassword    required    pam_smbpass.so nodelay</pre><p>以下に、ある Linux システムにおける PAM の設定ファイルを示す。既定値の設定では <code class="filename">pam_pwdb.so</code> を使う。</p><p>	</p><pre class="programlisting">#%PAM-1.0# The PAM configuration file for the <span class="quote">“<span class="quote">samba</span>”</span> service#auth       required     pam_pwdb.so nullok nodelay shadow auditaccount    required     pam_pwdb.so audit nodelaysession    required     pam_pwdb.so nodelaypassword   required     pam_pwdb.so shadow md5</pre><p>以下の例では、基本的な Samba 認証であっても<code class="literal">smbpasswd</code> データベースを使うようになっている。このような設定を行った場合、<code class="literal">passwd</code> プログラムに対しても影響を及ぼす。つまり、<code class="literal">smbpasswd</code> のパスワードを <code class="literal">passwd</code> コマンドで変更できるようになる:</p><p>		</p><pre class="programlisting">#%PAM-1.0# The PAM configuration file for the <span class="quote">“<span class="quote">samba</span>”</span> service#auth       required     pam_smbpass.so nodelayaccount    required     pam_pwdb.so audit nodelaysession    required     pam_pwdb.so nodelaypassword   required     pam_smbpass.so nodelay smbconf=/etc/samba.d/smb.conf</pre><p></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>PAM では階層的な(スタックされた)認証の仕組みを提供している。たとえば、ある PAM モジュールが受け取った情報を、PAM スタックの次のモジュールに渡すことができる。PAM に関する特定の機能の詳細については、お使いのシステムに特化したドキュメントを参照して欲しい。さらにいくつかの Lunux の実装では、すべての認証を中心となる単一のファイルで設定できる <code class="filename">pam_stack.so</code> と呼ばれるモジュールが提供されている。<code class="filename">pam_stack.so</code> 方式は管理者の手間を軽減してくれるので、熱心なファンもいる。もっとも、環境によってもいろんな問題があるわけであり、前述のどの方式を取るにしてもそれぞれのトレードオフがある。より有益な情報を探すために、PAM のドキュメントをあたってみるのもよいだろう。</p></div></div></div><div class="sect2" title="smb.conf の PAM 設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2689506"></a><code class="filename">smb.conf</code> の PAM 設定</h3></div></div></div><p><a class="link" href="smb.conf.5.html#OBEYPAMRESTRICTIONS" target="_top">obey pam restrictions</a> と呼ばれる <code class="filename">smb.conf</code> のオプションがある。このオプションに関する SWAT のヘルプを以下に示す：</p><div class="blockquote"><blockquote class="blockquote"><p>Samba が PAM サポート (<code class="option">--with-pam</code>) 付きでコンパイルされている場合、Samba が PAM の account および session 管理ディレクティブに従うかどうかをこのパラメータで 制御できる。PAM を使うが認証は平文のみで、かつどの account/session 管理も無視するというのが既定値の動作である。<a class="link" href="smb.conf.5.html#ENCRYPTPASSWORDS" target="_top">encrypt passwords = yes</a>の場合、Samba は常に認証については PAM を無視する。その理由は、SMB パスワード暗号を使う場合に必要なチャレンジ／レスポンス方式の認証メカニズムを PAM モジュールが サポートしていないからである。</p><p>既定値:<a class="link" href="smb.conf.5.html#OBEYPAMRESTRICTIONS" target="_top">obey pam restrictions = no</a></p></blockquote></div></div><div class="sect2" title="winbindd.soを使った遠隔 CIFS 認証"><div class="titlepage"><div><div><h3 class="title"><a name="id2689602"></a><code class="filename">winbindd.so</code>を使った遠隔 CIFS 認証</h3></div></div></div><p>どんな OS であっても、その OS 自身がアクセス可能なユーザ証明情報が(どこからか)提供されていることを前提としている。UNIX ではユーザ識別子(UID)だけでなくグループ識別子(GID)も必要となる。これらはいずれも単純な整数値であり、<code class="filename">/etc/passwd</code> といったパスワードバックエンドより取得する。</p><p>Windows NT サーバでは、ユーザとグループは相対ID(RID)に割り当てられている。これらはユーザやグループが作られる際、ドメイン毎に一意となる。Windows NT のユーザやグループを UNIX のユーザやグループに変換するためには、RID と UNIX のユーザ/グループの ID をマッピングする必要がある。これが winbind が行う仕事のひとつである。</p><p>winbind のユーザとグループはサーバから解決要求が出され、ユーザとグループの ID が指定された範囲内で割り当てられる。クライアントがユーザとグループを列挙するコマンドを実行すると、すぐに既存の全ユーザとグループがマッピングされ、割り当て処理が先着順に行われる。割り当てられた UNIX ID は Samba の lock ディレクトリ配下のデータベースファイルに保持されて記憶される。</p><p>これにより、目先が利く管理者なら、<code class="filename">pam_smbpass.so</code> や<code class="literal">winbindd</code> と、<em class="parameter"><code>ldap</code></em> のような分散型の <a class="link" href="smb.conf.5.html#PASSDBBACKEND" target="_top">passdb backend</a> との組み合わせにより、(Linux のような)PAM を意識したプログラムやアプリケーションからも使うことのできる、中央集権型で管理された分散型のユーザ/パスワードデータベースが使えるようになるということが理解できるだろう。このお膳立てにより、広範囲のネットワーク認証のトラフィックが削減できるという限りにおいては、マイクロソフトのActive Directory Service(ADS)に比較して、特に強力な優位性を持てる。</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>UNIX の ID データベースに対応する RID はユーザとグループのマッピングが格納されているファイルにのみ存在し、<code class="literal">winbindd</code> によって格納される。このファイルが削除されていたり壊れていたりする場合、<code class="literal">winbindd</code> はどのユーザやグループが Windows NTのユーザやグループの RID と対応するのかを決定できなくなる。</p></div></div><div class="sect2" title="pam_smbpass.so を使ったパスワードの同期"><div class="titlepage"><div><div><h3 class="title"><a name="id2689736"></a><code class="filename">pam_smbpass.so</code> を使ったパスワードの同期</h3></div></div></div><p><code class="filename">pam_smbpass</code> は PAM モジュールのひとつであり、システム上で <code class="filename">smbpasswd</code> (Sambaのパスワード)データベースと UNIX のパスワードファイルとの同期を取るために使われる。PAM は Solaris, HPUX, Linux などの UNIX オペレーティングシステム上でサポートされている API であり、認証メカニズムに対する標準的なインターフェースを提供する。</p><p>このモジュールはローカルにある <code class="filename">smbpasswd</code> ユーザデータベースを使って認証する。リモートの SMB サーバで認証したり、システム上の SUID root されたバイナリの存在を調べたいという向きには、<code class="filename">pam_winbind</code> の方を使うことをお勧めする。</p><p>このモジュールで認識されるオプションについては、<a class="link" href="pam.html#smbpassoptions" title="Table 28.1. pam_smbpassで認識されるオプション">次のテーブル</a>を参照して欲しい。</p><div class="table"><a name="smbpassoptions"></a><p class="title"><b>Table 28.1. <em class="parameter"><code>pam_smbpass</code></em>で認識されるオプション	</b></p><div class="table-contents"><table summary="pam_smbpassで認識されるオプション	" border="1"><colgroup><col align="left"><col align="justify"></colgroup><tbody><tr><td align="left">debug</td><td align="justify">より多くのデバッグ情報を出力する</td></tr><tr><td align="left">audit</td><td align="justify">debugと似ているが、認識できないユーザ名も表示する</td></tr><tr><td align="left">use_first_pass</td><td align="justify">ユーザにパスワード入力を求めない。パスワードは PAM_ 項目から持ってくる</td></tr><tr><td align="left">try_first_pass</td><td align="justify">直前の PAM モジュールからパスワードの取得を試みる。取得できなければユーザからの入力を求める。</td></tr><tr><td align="left">use_authtok</td><td align="justify">try_first_pass に似ているが、(パスワードモジュールだけをスタックさせるための)新しい PAM_AUTHTOK が事前にセットされていなければ『失敗する』</td></tr><tr><td align="left">not_set_pass</td><td align="justify">このモジュールで使われたパスワードを他のモジュールに流用させない</td></tr><tr><td align="left">nodelay</td><td align="justify">認証の失敗までに最大1秒の遅延を挟まない</td></tr><tr><td align="left">nullok</td><td align="justify">パスワードなしを認める</td></tr><tr><td align="left">nonull</td><td align="justify">パスワードなしを認めない。これは Samba の設定に優先する。</td></tr><tr><td align="left">migrate</td><td align="justify"><span class="quote">“<span class="quote">auth</span>”</span> コンテキストでのみ意味を持つ。成功した認証で使われたパスワードを使って smbpasswd ファイルを更新する。</td></tr><tr><td align="left">smbconf=<em class="replaceable"><code>ファイル名</code></em></td><td align="justify"><code class="filename">smb.conf</code> ファイルへの別のパスを指定する</td></tr></tbody></table></div></div><p><br class="table-break"></p><p>Linux の <code class="filename">/etc/pam.d/</code> 形式のファイル構造で<code class="filename">pam_smbpass.so</code> を使うときの例を以下に示す。このツールを別のプラットフォームに実装したいと思っている方は、適当に読み替えてみてほしい。</p><div class="sect3" title="パスワードの同期設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2689999"></a>パスワードの同期設定</h4></div></div></div><p>以下の PAM 設定例では、<code class="filename">/etc/passwd (/etc/shadow)</code> が変更されたときに、pam_smbpass を利用して<code class="filename">private/smbpasswd</code>が連動して変更されるようにしている。これはパスワードの有効期限が切れたときに(<code class="literal">ssh</code>のような)アプリケーションがパスワードを変更するような場合に便利である。</p><p>	</p><pre class="programlisting">#%PAM-1.0# password-sync#auth       requisite    pam_nologin.soauth       required     pam_unix.soaccount    required     pam_unix.sopassword   requisite    pam_cracklib.so retry=3password   requisite    pam_unix.so shadow md5 use_authtok try_first_passpassword   required     pam_smbpass.so nullok use_authtok try_first_passsession    required     pam_unix.so</pre></div><div class="sect3" title="パスワード移行のための設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2690048"></a>パスワード移行のための設定</h4></div></div></div><p>以下は <code class="filename">pam_smbpass</code> を使って平文からSamba 用の暗号化パスワードに移行するための PAM 設定である。他のメソッドと違い、この方法なら一度も Samba の共有に接続したことがなくても使える:パスワードを移行すれば、ユーザが<code class="literal">ftp</code> で接続したり、<code class="literal">ssh</code>でログインしてメールを取り出したりする場合などにも使える。</p><p>	</p><pre class="programlisting">#%PAM-1.0# password-migration#auth       requisite   pam_nologin.so# pam_smbpass is called IF pam_unix succeeds.auth       requisite   pam_unix.soauth       optional    pam_smbpass.so migrateaccount    required    pam_unix.sopassword   requisite   pam_cracklib.so retry=3password   requisite   pam_unix.so shadow md5 use_authtok try_first_passpassword   optional    pam_smbpass.so nullok use_authtok try_first_passsession    required    pam_unix.so</pre></div><div class="sect3" title="従来のパスワード設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2690105"></a>従来のパスワード設定</h4></div></div></div><p>以下の例は、従来の <code class="filename">smbpasswd</code> 利用時のためのPAM 設定である。<code class="filename">private/smbpasswd</code> 全体が投入され、SMB パスワードが存在しなかったり UNIX のパスワードと合致しない場合はエラーと見なされる。</p><p></p><pre class="programlisting">#%PAM-1.0# password-mature#auth       requisite    pam_nologin.soauth       required     pam_unix.soaccount    required     pam_unix.sopassword   requisite    pam_cracklib.so retry=3password   requisite    pam_unix.so shadow md5 use_authtok try_first_passpassword   required     pam_smbpass.so use_authtok use_first_passsession    required     pam_unix.so</pre></div><div class="sect3" title="Kerberosパスワード統合設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2690149"></a>Kerberosパスワード統合設定</h4></div></div></div><p>以下の PAM 設定例は、<em class="parameter"><code>pam_krb5</code></em> といっしょに使われる <em class="parameter"><code>pam_smbpass</code></em> を示している。これは Samba PDC 上で、かつそれがkerberos realmのメンバである場合に有用である。</p><p>		</p><pre class="programlisting">#%PAM-1.0# kdc-pdc#auth       requisite   pam_nologin.soauth       requisite   pam_krb5.soauth       optional    pam_smbpass.so migrateaccount    required    pam_krb5.sopassword   requisite   pam_cracklib.so retry=3password   optional    pam_smbpass.so nullok use_authtok try_first_passpassword   required    pam_krb5.so use_authtok try_first_passsession    required    pam_krb5.so</pre></div></div></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2690202"></a>よくあるエラー</h2></div></div></div><p>PAM は割と扱いづらく、設定エラーを引き起こしやすい。以下にSamba のメーリングリストで見かけたいくつかのケースを紹介する。</p><div class="sect2" title="pam_winbind の問題"><div class="titlepage"><div><div><h3 class="title"><a name="id2690217"></a>pam_winbind の問題</h3></div></div></div><p>あるユーザから<span class="emphasis"><em>PAM の設定で以下の問題が起こった</em></span>との報告があった:	</p><p></p><pre class="programlisting">auth required /lib/security/pam_securetty.soauth sufficient /lib/security/pam_winbind.soauth sufficient /lib/security/pam_unix.so use_first_pass nullokauth required /lib/security/pam_stack.so service=system-authauth required /lib/security/pam_nologin.soaccount required /lib/security/pam_stack.so service=system-authaccount required /lib/security/pam_winbind.sopassword required /lib/security/pam_stack.so service=system-auth</pre><p></p><p>	<span class="emphasis"><em>[ctrl][alt][F1]で新しくコンソールを開くと、私の ID <span class="quote">“<span class="quote">pitie</span>”</span> ではログインできない。ユーザ <span class="quote">“<span class="quote">scienceu\pitie</span>”</span> でやってみたが、それでもだめだった。</em></span>	</p><p>この問題は<em class="parameter"><code>pam_stack.so service=system-auth</code></em>がある時に発生する。このファイルに入っている多くの設定には、すでに実行中ものが二重に入っていることがよくある。<em class="parameter"><code>auth</code></em> と <em class="parameter"><code>account</code></em>から <em class="parameter"><code>pam_stack</code></em> の行をコメントアウトしたらどうなるかやってみてくれ。それで動くなら、<code class="filename">/etc/pam.d/system-auth</code> ファイルを見て、その中で本当に必要な行だけを <code class="filename">/etc/pam.d/login</code>ファイルにコピーすればいい。別のやり方として、もしすべてのサービスで winbind を動かしてもいいなら、<code class="filename">/etc/pam.d/system-auth</code> に winbind 固有の設定を追加してもいい。	</p></div><div class="sect2" title="Winbind がユーザとグループを解決してくれない"><div class="titlepage"><div><div><h3 class="title"><a name="id2690332"></a>Winbind がユーザとグループを解決してくれない</h3></div></div></div><p>	<span class="quote">“<span class="quote">僕の <code class="filename">smb.conf</code> は正しく設定されている。<a class="link" href="smb.conf.5.html#IDMAPUID" target="_top">idmap uid = 12000</a> と<a class="link" href="smb.conf.5.html#IDMAPGID" target="_top">idmap gid = 3000-3500</a>を指定しているし <code class="literal">winbind</code> も動いている。以下のコマンドはちゃんと動いている。	</span>”</span>	</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>wbinfo -u</code></strong>MIDEARTH\maryoMIDEARTH\jackbMIDEARTH\ameds...MIDEARTH\root<code class="prompt">root# </code><strong class="userinput"><code>wbinfo -g</code></strong>MIDEARTH\Domain UsersMIDEARTH\Domain AdminsMIDEARTH\Domain Guests...MIDEARTH\Accounts<code class="prompt">root# </code><strong class="userinput"><code>getent passwd</code></strong>root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/bin/bash...maryo:x:15000:15003:Mary Orville:/home/MIDEARTH/maryo:/bin/false</pre><p>	<span class="quote">“<span class="quote">しかし、このコマンドが失敗する:	</span>”</span></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>chown maryo a_file</code></strong>chown: 'maryo': invalid user</pre><p>	<span class="quote">“<span class="quote">一体どうなってんの？何か間違ってる？</span>”</span>	</p><p>名前キャッシュデーモンである <code class="literal">nscd</code> が動いてるんじゃないかな？そいつを終わらせて、起動しないようにしてくれ。それでうまくいくと思うよ。	</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ProfileMgmt.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="integrate-ms-networks.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 27. デスクトッププロファイルの管理 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 29. Microsoft Windows ネットワークへのSambaの統合</td></tr></table></div></body></html>