<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 4. ドメイン制御</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="type.html" title="Part II. サーバ設定の基本"><link rel="prev" href="ServerType.html" title="Chapter 3. サーバタイプとセキュリティモード"><link rel="next" href="samba-bdc.html" title="Chapter 5. バックアップドメインコントローラ"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 4. ドメイン制御</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ServerType.html">Prev</a> </td><th width="60%" align="center">Part II. サーバ設定の基本</th><td width="20%" align="right"> <a accesskey="n" href="samba-bdc.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 4. ドメイン制御"><div class="titlepage"><div><div><h2 class="title"><a name="samba-pdc"></a>Chapter 4. ドメイン制御</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Gerald</span> <span class="othername">(Jerry)</span> <span class="surname">Carter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jerry@samba.org">jerry@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">David</span> <span class="surname">Bannon</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:dbannon@samba.org">dbannon@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Guenther</span> <span class="surname">Deschner</span></h3><span class="contrib">LDAP updates</span> <div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:gd@samba.org">gd@samba.org</a>></code></p></div></div></div></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="samba-pdc.html#id2568665">機能と利便性</a></span></dt><dt><span class="sect1"><a href="samba-pdc.html#id2569387">シングルサインオンとドメインセキュリティ</a></span></dt><dt><span class="sect1"><a href="samba-pdc.html#id2570049">ドメイン制御の基礎</a></span></dt><dd><dl><dt><span class="sect2"><a href="samba-pdc.html#id2570073">ドメインコントローラの種類</a></span></dt><dt><span class="sect2"><a href="samba-pdc.html#id2557060">ドメイン制御の準備</a></span></dt></dl></dd><dt><span class="sect1"><a href="samba-pdc.html#id2571564">ドメイン制御: 設定例</a></span></dt><dt><span class="sect1"><a href="samba-pdc.html#id2572360">SambaによるADSドメイン制御</a></span></dt><dt><span class="sect1"><a href="samba-pdc.html#id2572436">ドメインとネットワークログインの設定</a></span></dt><dd><dl><dt><span class="sect2"><a href="samba-pdc.html#id2572459">ドメインネットワークログオンサービス</a></span></dt><dt><span class="sect2"><a href="samba-pdc.html#id2573167">セキュリティモードとマスタブラウザ</a></span></dt></dl></dd><dt><span class="sect1"><a href="samba-pdc.html#id2573464">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="samba-pdc.html#id2573470"><span class="quote">“<span class="quote">$</span>”</span>マシン名中に$を含められない</a></span></dt><dt><span class="sect2"><a href="samba-pdc.html#id2573578">存在するマシンアカウントがあるためにドメイン参加に失敗する</a></span></dt><dt><span class="sect2"><a href="samba-pdc.html#id2573662">システムにログオンできない(C000019B)</a></span></dt><dt><span class="sect2"><a href="samba-pdc.html#id2573758">マシン信頼アカウントがアクセスできない</a></span></dt><dt><span class="sect2"><a href="samba-pdc.html#id2573906">アカウントが無効</a></span></dt><dt><span class="sect2"><a href="samba-pdc.html#id2573938">ドメインコントローラが無効</a></span></dt><dt><span class="sect2"><a href="samba-pdc.html#id2573965">ドメイン参加後ドメインメンバワークステーションにログオンできない</a></span></dt></dl></dd></dl></div><p>Microsoft Windows のネットワークの世界に考えられないような誤解をしている人がたくさんいる。それは私たちが支援を提供できる機会が増えるということですからそれはそれでいいのだが、この分野で本当にヘルプを必要とする人は、まず、既に一般向けに出されている情報に親しむことを推奨する。</p><p><a class="indexterm" name="id2568499"></a>ある程度の基本を理解・修得されてからこの章を読み進めることを推奨する。Microsoft Windowsネットワークでは、誤った設定の影響がはっきりと現れる。Microsoft Windows ネットワークのユーザーから、ネットワーク設定の誤りに起因すると思われる細かなトラブルにしつこく悩まされるという苦情が出ることがよくある。ところが、多くの人々にとって Microsoft Windowsネットワークの世界というのはドメインコントローラーを知るところから始まり、それはネットワーク操作の障害を魔法のように、すべて解決してくれそうに思えるてくるものである。</p><p><a class="link" href="samba-pdc.html#domain-example" title="Figure 4.1. ドメインの例">ドメインの例の図解</a>は典型的な、Microsoft Windows ネットワーク ドメインセキュリティネットワーク環境を図示している。ワークステーションA、BとCは多くの物理的なMicrosoft Windowsネットワーククライアントを代表していると考えられたい。</p><div class="figure"><a name="domain-example"></a><p class="title"><b>Figure 4.1. ドメインの例</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/domain.png" width="216" alt="ドメインの例"></div></div></div><br class="figure-break"><p>Sambaメーリングリストから、よくあるネットワークに関する問題の多くを容易に特定できる。もしも以下の話題についてよく分からないのであれば、それについて取り扱っている、このHOWTO文書の節を読むことを強く勧める。以下は、最も一般的なMicrosoft Windowsネットワークの問題である:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>基本的なTCP/IPの設定</p></li><li class="listitem"><p>NetBIOS名の解決方法</p></li><li class="listitem"><p>認証の設定</p></li><li class="listitem"><p>ユーザとグループの設定</p></li><li class="listitem"><p>UNIX/Linux上での基本的なファイルとディレクトリのアクセス制御</p></li><li class="listitem"><p>ネットワーク環境中でMicrosoft Windowsクライアントがどのようにやりとりをするかの理解</p></li></ul></div><p>がっくりする必要はない。Microsoft Windowsのネットワーク機能は、一見、大変シンプルで誰でもできそうに見える。実際には、適切な研修と準備をしないで Microsoft Windows ネットワークを設定するのは、あまりよい考えとは言えない。とはいえ、なかなか払拭できない思い込みをちょっと脇にどけることにしよう。<span class="emphasis"><em>ミスを犯すのもいいことです!</em></span>時と場合によっては失敗も教訓となる。しかし、生産性のロスを招き、組織に不可避の財政負担を強いるようなミスを犯してもよいわけではない。</p><p>それでは、ミスを犯してもよい場所とはどこであろうか? それは実害のない場所である。ミスを犯すなら、テストネットワーク上で、ユーザーから遠く離れた場所で、他の人に苦痛を与えない状況でやってほしい。</p><div class="sect1" title="機能と利便性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2568665"></a>機能と利便性</h2></div></div></div><p><a class="indexterm" name="id2568673"></a><span class="emphasis"><em>Microsoftドメインセキュリティの最も重要な利便性は何か?</em></span></p><p><a class="indexterm" name="id2568689"></a><a class="indexterm" name="id2568697"></a><a class="indexterm" name="id2568703"></a><a class="indexterm" name="id2568710"></a>要するに、<span class="emphasis"><em>シングルサインオン</em></span>、あるいは短く言えばSSOである。これは多くの人にとって、Microsoft Windows NT 以後のネットワーキングにおける聖杯である。SSOは、ユーザーのユーザーアカウントが存在するドメインのメンバであるワークステーション(あるいは、アクセスするドメインとの間に適切な信頼関係があるドメインに属するワークステーション)のいずれからも、ネットワークにログオンできるという優れた設計を可能にする。ユーザは、自分のホームの(個人の)ワークステーションの前に座っているかのように、ネットワークにログオンでき、リソース(共有、ファイル、プリンタ)にアクセスできる。これはドメインセキュリティプロトコルの一つの特長である。</p><p><a class="indexterm" name="id2568747"></a><a class="indexterm" name="id2568754"></a><a class="indexterm" name="id2568760"></a><a class="indexterm" name="id2568768"></a><a class="indexterm" name="id2568777"></a>Samba PDCを実装するサイトは、ドメインセキュリティの利便性を享受できる。ドメインは、固有のネットワーク・セキュリティ識別子(SID)を提供する。ドメインユーザとグループセキュリティの識別子は、ネットワーク SID に、アカウント毎に一意の相対識別子(RID)を付け足したものである。ユーザとグループのSID(ネットワークSID+RID)は、ネットワークリソースに付けられるアクセス制御リスト(ACL)を作成するのに使用され、組織内のアクセス制御を可能にする。UNIXシステムは、ローカルセキュリティ識別子のみ認識する。</p><p><a class="indexterm" name="id2568810"></a>SIDはセキュリティコンテキストを表す。例をあげると、おのおののWindowsマシンは固有のSIDを持つローカルマシンのセキュリティコンテキストでのローカルアカウントを持つ。すべてのドメイン(NT4、ADS、Samba)はドメインSIDによって定義されるセキュリティドメインセキュリティコンテキストで存在するアカウントを含む。</p><p><a class="indexterm" name="id2568830"></a><a class="indexterm" name="id2568836"></a>ドメインメンバサーバはドメインSIDとは異なるSIDを持つ。ドメインメンバサーバはすべてのドメインユーザをローカルユーザとして見なすように設定できる。SIDは持続的である。標準的なドメインのユーザSIDは以下のようなものである:</p><pre class="screen">S-1-5-21-726309263-4128913605-1168186429</pre><p>すべてのアカウント(ユーザ、グループ、マシン、信頼関係など)はRIDが割り当てられる。これは、アカウントが作成された時に自動的に行われる。UNIX OSはユーザとグループ識別子に別々の名前空間を使う(UIDとGID)が、Windowsは同じ名前空間からRIDを割り当てる。WindowsユーザとWindowsグループは同じRIDを持てない。ちょうどUNIXユーザ<code class="literal">root</code>がUID=0であるように、Windows Administratorは、よく知られたRID=500を持つ。RIDはWindowsドメインRIDに連結され、そのため、上記のSIDを持つドメインのAdministratorアカウントは下記のユーザSIDを持つ。</p><pre class="screen">S-1-5-21-726309263-4128913605-1168186429-500</pre><p>Windowsネットワーク領域中での残りのすべてのアカウントは全体で一意なセキュリティ識別子を持つ。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2568894"></a><a class="indexterm" name="id2568902"></a><a class="indexterm" name="id2568908"></a>Microsoft Windows ドメインセキュリティ環境でのネットワーククライアントは提供される高度な機能にアクセス出来るためには、ドメインメンバでなければならない。ドメインメンバシップはワークグループ名をドメイン名に設定するだけではない。ワークステーションに対する(マシンアカウントと呼ばれる)ドメイン信頼アカウントの作成が必要である。より詳細については<a class="link" href="domain-member.html" title="Chapter 6. ドメインメンバシップ">ドメインメンバシップ</a>を参照のこと。</p></div><p>以下の機能はSamba-3リリースで新規に追加された:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	<a class="indexterm" name="id2568945"></a>	Samba-3はユーザ、グループとマシンアカウントが格納される時に使われる	バックエンドの選択を行う事をサポートしている。複数のパスワードバックエンド	を、付加的なデータセット、あるいはフェールオーバデータセットのどちらでも、	組み合わせて使うことが出来る(訳注:今は使えない)。	</p><p>	<a class="indexterm" name="id2568968"></a>	<a class="indexterm" name="id2568974"></a>	<a class="indexterm" name="id2568980"></a>	<a class="indexterm" name="id2568986"></a>	<a class="indexterm" name="id2568993"></a>	LDAP passdbバックエンドは、拡張性と高いレベルでの信頼性を	提供するという理由で、とても価値のある、アカウントバックエンドが	分散かつ複製が出来るメリットを享受できる。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2569012"></a>	<a class="indexterm" name="id2569022"></a>	<a class="indexterm" name="id2569030"></a>	Windows NT4のドメイン信頼関係である。Samba-3はワークステーションと	サーバ(マシン)信頼アカウントをサポートする。これは、ネットワークの	スケーラビリティと相互運用性をさらに支援する、NT4スタイルのドメイン	間信頼アカウントをサポートする。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2569052"></a>	<a class="indexterm" name="id2569058"></a>	<a class="indexterm" name="id2569064"></a>	<a class="indexterm" name="id2569070"></a>	<a class="indexterm" name="id2569079"></a>	<a class="indexterm" name="id2569087"></a>		NetBIOS over TCP/IPなしの操作は、むしろraw SMB over TCP/IPを使うことである。注意:	これはMicrosoft active directoryドメインメンバサーバとして操作する時にのみ	実行可能である。Sambaドメインコントローラとして動作する時、NetBIOSの使用は、	ネットワークブラウジングのサポートを提供するために必要である。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2569111"></a>	<a class="indexterm" name="id2569117"></a>	<a class="indexterm" name="id2569123"></a>	Samba-3はNetBIOSネームサービス(WINS)、NetBIOS ever TCP/IP(TCPポート139)、	SMB over TCP(TCP port 445)セッションサービスとMicrosoft互換のONC DCE 	RPCサービス(TCPポート135)を提供する。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2569142"></a>	ドメインにユーザーマネージャ経由でユーザとグループを管理する機能。	これは、Windows 9x/Meでは<code class="filename">Nexus.exe</code>を使い、	Windows NT4/200x/XPプラットフォームではSRVTOOLS.EXEを使って任意の	Microsoft Windows クライアントで行える(訳注:Windows Vista/7では	使えない)。	</p></li><li class="listitem"><p>	Unicodeの完全な実装。これは、ロケール間での国際化サポートを容易にする。	また、Unicode を完全にサポートしなければならないという理由でSamba-2.2.x	がサポートできなかったプロトコルの活用の道を開く。	</p></li></ul></div><p>以下の機能はSamba-3では提供されていない:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	<a class="indexterm" name="id2569188"></a>	<a class="indexterm" name="id2569194"></a>	NT4ドメインコントローラ間でのSAMの複製(すなわちSamba PDCとWindows NT BDCまたはその逆)。	これは、Sambaが、PDCがMicrosoftベースのWindows NT PDCである時にBDCと	して動作出来ないことを意味する。Samba-3はWindows PDCとBDCでのアカウント	データの複製に参加できない。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2569215"></a>	<a class="indexterm" name="id2569221"></a>	Windows 2000 Active Directoryドメインコントローラとして動作する	(すなわち、KerberosとActive Directory)。実際の所、Samba-3は	現時点では若干の、実験的なActive Directory ドメイン制御の機能を	有している。Active Directoryドメイン制御は次世代のSambaリリース	である、Samba-4で現在開発中の機能である。現時点ではSamba-3ライフ	サイクル中でActive Directoryドメイン制御を有効にする計画はない。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2569243"></a>	<a class="indexterm" name="id2569249"></a>	<a class="indexterm" name="id2569255"></a>	Windows 200x/XPのMicrosoft管理コンソール(MMC)はSamba-3サーバの管理に	は使えない。この目的にはMicrosoft Windows NT4ドメインサーバマネージャと	Microsoft Windows NT4ドメインユーザマネージャのみが使える。両者は	この後説明するSVRTOOLS.EXEパッケージ中の一部である。	</p></li></ul></div><p><a class="indexterm" name="id2569279"></a><a class="indexterm" name="id2569287"></a>この章の中で説明されている理由により、Windows 9x/Me/XP Homeクライアントはドメインの真のメンバになれない。Windows9x/Meスタイルのネットワーク(ドメイン)ログオンプロトコルはNT4/Windows 200xスタイルのドメインログオンとは完全に異なり、しばらくの間公式にサポートされてきた。これらのクライアントはおおよそSamba-1.9.15シリーズからサポートされた旧LanManネットワークログイン機能を使う。</p><p><a class="indexterm" name="id2569307"></a>Samba-3ではWindows NT グループとUNIXグループ間でのグループマッピングを実装している(これは、限られたスペースでは説明できないくらい非常に複雑である)。これについての詳細については<a class="link" href="groupmapping.html" title="Chapter 12. グループのマッピング: Microsoft Windows と UNIX">グループマッピング:Microsoft WindowsとUNIX</a>を参照のこと。</p><p><a class="indexterm" name="id2569334"></a><a class="indexterm" name="id2569341"></a><a class="indexterm" name="id2569350"></a>Samba-3はMicrosoft Windows NT4 PDCまたはWindows200x Active Directoryと同様に、適切なバックエンドデータベースにユーザとマシン信頼アカウント情報を格納することを必要とする。これについては、<a class="link" href="domain-member.html#machine-trust-accounts" title="MicrosoftWindowsワークステーション/サーバのマシン信頼アカウント">Microsoft Windows ワークステーション/サーバ マシン信頼アカウント</a>を参照のこと。Samba-3では複数のバックエンドが用意されている。完全なアカウントデータベースバックエンドについての解説は<a class="link" href="passdb.html" title="Chapter 11. アカウント情報データベース">アカウント情報データベース</a>を参照のこと。</p></div><div class="sect1" title="シングルサインオンとドメインセキュリティ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2569387"></a>シングルサインオンとドメインセキュリティ</h2></div></div></div><p><a class="indexterm" name="id2569395"></a><a class="indexterm" name="id2569404"></a><a class="indexterm" name="id2569410"></a><a class="indexterm" name="id2569416"></a><a class="indexterm" name="id2569423"></a><a class="indexterm" name="id2569429"></a><a class="indexterm" name="id2569435"></a>ネットワーク管理者が、Windows NT4とactive directoryネットワークの利点について説明を求められるとき、しばしば言及するのが、シングルサインオン(SSO)を実装しているということである。多くの会社がSSOを実装している。シングルサインオンソリューション実装のモードは、一般的に、ネットワーク業務における重要な要因であり、Windowsネットワークに関してとても重要である。会社には多くの種類の情報システムがあり、それぞれはユーザ認証と認可(訳注:authentication and validation)を要求し、そのため、一般的ではないが、ユーザは10以上のログインIDとパスワードを記憶する必要があるかもしれない。この問題は、おのおののシステムのパスワードが一定期間で更新が必定で、パスワードの複雑さとパスワード履歴が適用されるときには特に顕著となる。</p><p><a class="indexterm" name="id2569475"></a>非常に数多くの情報システムに対するアクセス権限(ユーザ名/パスワードペア)を扱うユーザの問題に対する回答がSSOであるという認識を包括的に持っている。多くの巧妙な案が、ユーザフレンドリーなSSOのソリューションを提供可能にするために考案された。問題は、この導入がうまく終わっていない場合、サイトは複雑さによるたくさんの費用と管理上のオーバヘッドが起きるかもしれないということである。簡単に言って、多くのSSOソリューションは管理上の悪夢である。</p><p><a class="indexterm" name="id2569506"></a><a class="indexterm" name="id2569513"></a><a class="indexterm" name="id2569519"></a>SSOを使うことですべてのユーザアカウント情報を集中管理できる。環境の複雑さと、SSOを導入したシステムの稼働期間に依存して、新しいアイデンティティ管理とユーザ認証システムを受け入れることは可能ではないかもしれない。多くのSSOソリューションは、ユーザのための認証を処理する新しい上位の構造から成り立つレガシーシステムを改良する。これは、SSOの追加は全体的な情報システムの複雑さを増大することを意味する。理想的には、SSOの導入は複雑さの低減と管理オーバヘッドの削減をすべきである。</p><p><a class="indexterm" name="id2569552"></a><a class="indexterm" name="id2569559"></a><a class="indexterm" name="id2569568"></a><a class="indexterm" name="id2569577"></a><a class="indexterm" name="id2569583"></a>たくさんのネットワーク管理の最初のゴールは、しばしば集中管理したアイデンティティ管理システムを作り、使うことである。これは、そのような集中化したシステムは、すべての情報システムによって使うことが出来る単一の認証基盤を使うことをしばしば仮定している。Microsoft Windows NT4セキュリティドメインアーキテクチャとMicrosoftActive Directoryサービスは、そのようなシステムに対しての理想的な基盤としてしばしば提供される。ユーザの認証とアクセス制御のためにMicrosoft(NT4ドメインかadsサービス)を使うことが出来る単一の認証基盤を使う、そのような集中化したシステムがしばしば仮定される。単一の集中化した認証サービスのすばらしい幻想は一般的に、現実を理解するときに一般的に壊れている。レガシーシステムを使うときの問題は、その導入がリエンジニアリングの観点から、過度に侵略的になるか、アプリケーションソフトが、設計されて実装されたユーザ認証の特定の要素に依存して組み込まれているという理由により、認証とアクセス制御を具体化する能力がしばしばないということである。</p><p><a class="indexterm" name="id2569623"></a><a class="indexterm" name="id2569629"></a><a class="indexterm" name="id2569635"></a><a class="indexterm" name="id2569642"></a><a class="indexterm" name="id2569649"></a><a class="indexterm" name="id2569656"></a><a class="indexterm" name="id2569662"></a><a class="indexterm" name="id2569668"></a>これまでの10年間、産業が、レガシー名情報テクノロジーシステムの制限の鍵となる点を回避するために作られた、いろいろな方法が開発されてきた。しばしば使われるその1つの方法はメタディレクトリを使うことである。メタディレクトリには、それぞれのシステムに固有な形式で、すべての異なる情報システムのためにユーザ認証情報を保存する。単一のユーザ認証情報を使うすべてのシステムのために、新しい基盤がユーザアクセスを可能にさせることが提供されるシステムの迷宮の中で、ユーザ権限と権利(rights and privileges)を管理するための厳格に実施されるワークフロープロトコルに、管理手続きの巧妙なセットが結合される。</p><p><a class="indexterm" name="id2569707"></a><a class="indexterm" name="id2569716"></a><a class="indexterm" name="id2569726"></a><a class="indexterm" name="id2569735"></a>Organization for the Advancement of Structured Information Standards (OASIS)は、認証情報の通信のための構造化情報であるSecurity Assertion Markup Language (SAML)を開発している。SAMLを配置するための全体的な技術と手法の包括的名称(訳注:umbrella name)はFederated Identity Management (FIM)と呼ばれる。FIMはそれぞれのユーザを認証するための異なった情報システムの複雑な迷宮中で、かつおのおのが提供するサービスの安全なアクセスを請け負うために、おのおののシステムに依存する。</p><p><a class="indexterm" name="id2569757"></a><a class="indexterm" name="id2569766"></a><a class="indexterm" name="id2569772"></a><a class="indexterm" name="id2569778"></a><a class="indexterm" name="id2569785"></a><a class="indexterm" name="id2569790"></a>SAML文書はWebサービスのために必要なコンピュータ間通信のためのSimple Object Access Protocol (SOAP)メッセージ中に包むことが出来る。あるいは、ライブサービスを共有する集合化したWebサービス間で渡されるかもしれない。リバティ・アライアンスは、SAML1.1をアプリケーションフレームワークとして適用した、連携型アイデンティティ標準(訳注:federated-identity standards)を普及させるために作られたコンソーシアム(訳注:industry group)である。MicrosoftとIBMはWS-Securityと呼ばれる別の方式を提案していた。ある人は、競合している技術と手法がSAML 2.0標準が世に出るときにまとまるのではないかと信じていた。現在ではごく少数のWebアクセス管理製品のみがSAMLをサポートしているが、技術の実装は、アプリケーション統合のためのカスタマイズとユーザインタフェースの開発のために、主に必要とされる。要するに、それがなぜFIMが大木つて成長している産業であるかの理由である。</p><p><a class="indexterm" name="id2569829"></a><a class="indexterm" name="id2569835"></a><a class="indexterm" name="id2569841"></a><a class="indexterm" name="id2569848"></a><a class="indexterm" name="id2569854"></a>この本の向こうの範囲の大きな絵を無視し、集中したシステムへのすべてのユーザとグループのマイグレーション管理は、正しい方向への第一歩である。Microsoft Active Directoryサービス(ADS)やその他のプロプライエティなものか、general security service application programming interface(GSSAPI)サービスによって定義されているプロトコルを使う数々の認証メカニズム(kerberosのような)の柔軟な組み合わせができる情報アクセス(LDAPのような)のための、標準プロトコルを提供するオープンソースシステムのような、ディレクトリ中にアイデンティティ管理システムデータを位置づけるのは、相互運用性のための基本である。</p><p><a class="indexterm" name="id2569894"></a><a class="indexterm" name="id2569900"></a><a class="indexterm" name="id2569907"></a>ますます多くの会社がLDAPシステムを使うことを許可するための異なったレガシープラットフォームのために認証エージェントを提供する。OpenLDAPの使用で、LDAP標準のオープンソース実装が支配的である。実際、LDAPとMicrosoftADSを使うためにSambaで提供することは、Sambaが、高度な拡張性とSambaは、組織のネットワーク技術に届くように前進することを意味する。</p><p><a class="indexterm" name="id2569926"></a><a class="indexterm" name="id2569933"></a><a class="indexterm" name="id2569939"></a><a class="indexterm" name="id2569945"></a><a class="indexterm" name="id2569951"></a><a class="indexterm" name="id2569958"></a>Microsoft ADSは、集中化した認証基盤を提供するために拡張できる、制限付きの完全に商用なサービスを提供する。SambaとLDAPは、集中化した認証基盤の拡張のための同様な機会を提供するが、実際、Sambaチームは、LDAPあるいは他のものを使って、認証サービスの拡張の導入中で、、持続可能な選択とFIMマーケットプレイス中での競合をより多く作成する、<code class="literal">ntlm_auth</code>ユーティリティのような完全なツールをSQUID(OSSのプロキシサーバ)のようなアプリケーションのために先を見越している。</p><p><a class="indexterm" name="id2569986"></a><a class="indexterm" name="id2569992"></a><a class="indexterm" name="id2569998"></a>もしも、プライマリドメインコントロールが大きなサイトに適合した拡張性があれば、LDAPを使うことが出来るに違いない。それを使うためのすばやいOpenLDAPとSambaの設定は、ディレクトリの時代が始まったことの十分な証明である。Samba-3はLDAPの使用を要求しないが、分散可能なユーザとグループのイデンティティ情報のメカニズムのための要求は、それを不可避の選択としている。</p><p><a class="indexterm" name="id2570018"></a><a class="indexterm" name="id2570024"></a><a class="indexterm" name="id2570031"></a>この時点で、SambaベースのBDCの使用は、LDAPアクセスありの使用を必要とする。最も一般的な、Sambaサイトによって使われるLDAP実装はOpenLDAPである。標準準拠の任意のLDAPサーバを使うことも可能である。それらは、IBM、CA、Novell(e-Directory)とその他で知られている。</p></div><div class="sect1" title="ドメイン制御の基礎"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2570049"></a>ドメイン制御の基礎</h2></div></div></div><p><a class="indexterm" name="id2570057"></a>長年の間に、ドメイン管理に関する一般の理解はほとんど神話の世界になってきた。ドメイン制御についての基本を概観する前に、ドメインコントローラの3つのタイプについて説明する。</p><div class="sect2" title="ドメインコントローラの種類"><div class="titlepage"><div><div><h3 class="title"><a name="id2570073"></a>ドメインコントローラの種類</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>NT4スタイルプライマリドメインコントローラ</p></li><li class="listitem"><p>NT4スタイルバックアップドメインコントローラ</p></li><li class="listitem"><p>ADSドメインコントローラ</p></li></ul></div><p><a class="indexterm" name="id2570103"></a><a class="indexterm" name="id2570109"></a><a class="indexterm" name="id2570115"></a><a class="indexterm" name="id2570124"></a><span class="emphasis"><em>プライマリドメインコントローラ</em></span>あるいはPDCはMicrosoftWindows NTで重要な役割を演じる。Windows 200xドメインアーキテクチャ中ではこの役割はドメインコントローラが担う。Microsoft Windowsネットワークにおけるドメインコントローラーの役割は、ドメインコントローラーがネットワークの中で最も強力で最も能力のあるマシンでなければならないことを示す、ということになっている。ところが、おかしなことを言うと思われるかも知れないが、ネットワークの全体的な性能を高めるためには、インフラストラクチャー全体がバランスのとれたものでなければならない。ドメインコントローラよりもスタンドアロン(ドメインメンバ)サーバに投資する方が賢明である。</p><p><a class="indexterm" name="id2570162"></a><a class="indexterm" name="id2570168"></a><a class="indexterm" name="id2570174"></a><a class="indexterm" name="id2570180"></a><a class="indexterm" name="id2570187"></a>Microsoft Windows NT4スタイルドメインの場合、新しいドメイン制御データベースを初期化するのはPDCである。これにより、Security Account Manager (SAM)と呼ばれるWindowsレジストリの一部分が形成される。これは、NT4スタイルのドメインユーザの認証とBDCのドメイン認証データベースとの同期で鍵となる役割を果たす。</p><p><a class="indexterm" name="id2570209"></a><a class="indexterm" name="id2570220"></a><a class="indexterm" name="id2570226"></a><a class="indexterm" name="id2570234"></a>Microsoft Windows 200xサーバベースのActive Directoryドメインでは、一つのドメインコントローラが、複数のドメイン・コントローラーの階層関係を初期化し、一つ一つのコントローラーが管理権限を代行する領域を与えられる。マスタドメインコントローラは下位のいずれかのドメインコントローラの決定を上書きする能力を持っているが、下位のコントローラはその下位のコントローラのみ制御する。Samba-3では、この機能はLDAPベースのユーザとマシンアカウントバックエンドを使うことで実現できる。</p><p><a class="indexterm" name="id2570267"></a><a class="indexterm" name="id2570274"></a>Samba-3では、新たにNT4スタイルのSAMデータベース(レジストリファイルの1つ)と同じタイプのデータを保持するバックエンドデータベースを使う機能が入った。<sup>[<a name="id2570288" href="#ftn.id2570288" class="footnote">1</a>]</sup></p><p><a class="indexterm" name="id2570301"></a><a class="indexterm" name="id2570308"></a><a class="indexterm" name="id2570314"></a><a class="indexterm" name="id2570320"></a><a class="indexterm" name="id2570326"></a><a class="indexterm" name="id2570333"></a><span class="emphasis"><em>バックアップドメインコントローラ</em></span>またはBDCはネットワーク認証リクエストの処理に重要な役割を演じる。BDCはPDCに優先してログオン要求に答えるようになっている。BDCとPDCの両方があるネットワークセグメント上では、ネットワークログオン要求はおおむねBDCが処理する。PDCはBDCが高負荷(ロードアベレージが大きい)ときにログオン要求に応える。ユーザがWindowsドメインメンバクライアントにログオンした時、ワークステーションは最も近いネットワークログオンサーバを探すために、ネットワークに問い合わせを行う。WINSサーバが使われている時は、WINSサーバへの問い合わせで行われる。もしもネットログオンサーバがWINS問い合わせでは見つからないか、WINSサーバがない場合、ワークステーションはUDPブロードキャストプロトコル上でmailslotブロードキャスト経由でNetBIOS名前検索を実行する。これは、Windowsクライアントが使うことが出来るネットログオンサーバがたくさんの変数によって影響され、それゆえ、PDCまたはBDCが特定のログオン認証要求を処理する単純な決定要素はない。</p><p><a class="indexterm" name="id2570396"></a><a class="indexterm" name="id2570403"></a>Windows NT4 BDCはPDCに昇格することが出来る。BDCがPDCに昇格する時にPDCがオンラインならば、以前のPDCは自動的にBDCに降格する。Samba-3ではこれは自動的には行われない。PDCとBDCは手動で設定し、その他適切な変更を行う必要がある。</p><p><a class="indexterm" name="id2570423"></a>Microsoft Windows NT4では、インストール時に、サーバのマシンタイプが何になるかを決める。BDCからPDCへの昇格やその逆も可能である。Windows NT4ドメインコントローラからドメインメンバサーバかスタンドアロンサーバへの変換のためにMicrosoftが提供している唯一の手法は、再インストールである。インストール時に提供されている選択肢は以下の通り:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>プライマリドメインコントローラ</em></span> ドメインSAMを生成するサーバ。</p></li><li class="listitem"><p><span class="emphasis"><em>バックアップドメインコントローラ</em></span> ドメインSAMのコピーを受け取るサーバ。</p></li><li class="listitem"><p><span class="emphasis"><em>ドメインメンバサーバ</em></span>  ドメインSAMのコピーを持たない。すべてのアクセス制御についてドメインコントローラから認証を受け取るサーバ。</p></li><li class="listitem"><p><span class="emphasis"><em>スタンドアロンサーバ</em></span> SAM同期を行わず、固有の認証データベースを持ち、ドメインセキュリティでは何の役割も担わないサーバ。</p></li></ul></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2570503"></a>Algin Technology LLC はWindows NT4スタンドアロンサーバをPDCまたはBDCに昇格することとその逆ができるが可能な商用ツールを提供している。さらなる情報は<a class="ulink" href="http://utools.com/UPromote.asp" target="_top">Algin</a>のWebサイトを参照のこと。</p></div><p><a class="indexterm" name="id2570526"></a><a class="indexterm" name="id2570536"></a>Samba-3サーバは<code class="filename">smb.conf</code>ファイルに簡単な変更をすることで、ドメインコントローラへ、あるいはドメインコントローラから容易に変換できる。Samba-3はWindows200xサーバのActive Directoryドメインでのネイティブなメンバとして完全に振る舞える。</p><p><a class="indexterm" name="id2570557"></a>完全な図を提供するために、Microsoft Windows 2000 ドメイン制御の設定はサーバがインストールされた後に行われる。ドメインメンバサーバへの変換、あるいはドメイン制御からの変換を行うための手順と、Active Directoryサービスのサポートのインストール、あるいはActive Directoryから抜けるための方法については、Microsoftの資料を参照してほしい。</p><p><a class="indexterm" name="id2556952"></a><a class="indexterm" name="id2556961"></a>Samba-3での新機能として、SAM複製コンポーネントを除く、Microsoft WindowsNT4スタイルのドメインコントローラ機能の実装が上げられる。しかし、Samba-3はMicrosoft Windows 200xドメイン制御プロトコルについてもサポートすることも注目してほしい。</p><p><a class="indexterm" name="id2556983"></a>現時点で、Samba-3はネイティブADSモード中での<span class="emphasis"><em>ドメインコントローラ</em></span>として機能することが出来るように見えるが、これは限定的で実験的なものでしかない。この機能はSambaチームがそれに対する公式のサポートを提供するまで使うべきでない。その時期になれば、すべての設定上・管理上の要件を正当に反映するためにドキュメント類は改訂されるだろう。SambaはWindows 2000/XP環境中ではNT4スタイルのドメインコントローラとして振る舞うことが出来る。しかし、以下のように一定の短所(訳注:未実装の機能)がある:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>マシンポリシーファイルがない</p></li><li class="listitem"><p>グループポリシーオブジェクトがない。</p></li><li class="listitem"><p>同期して実行されるActive Directoryログオンスクリプトがない。</p></li><li class="listitem"><p>ユーザとマシンを管理するためのActive directory管理ツールが使えない。</p></li><li class="listitem"><p>レジストリの変更でメインのレジストリに恒久的な変更が残るが、Active Directoryを使うときには、結果が残らない。</p></li><li class="listitem"><p>Active Directoryなしでは、特定のアプリケーションを特定のユーザとグループにエクスポートできない。</p></li></ul></div></div><div class="sect2" title="ドメイン制御の準備"><div class="titlepage"><div><div><h3 class="title"><a name="id2557060"></a>ドメイン制御の準備</h3></div></div></div><p><a class="indexterm" name="id2557067"></a><a class="indexterm" name="id2557074"></a><a class="indexterm" name="id2557080"></a><a class="indexterm" name="id2557087"></a>Microsoft Windows のマシンが、お互いに他のサーバやドメインコントローラとやりとりするのには2つの方法がある:そのうちの1つは、一般的に<span class="emphasis"><em>ワークグループ</em></span>メンバとして呼ばれている<span class="emphasis"><em>スタンドアロン</em></span>システムであり、もう1つは、一般的に<span class="emphasis"><em>ドメイン</em></span>メンバと呼ばれている、セキュリティシステム中で全面的に参加するものである。</p><p><a class="indexterm" name="id2557117"></a><a class="indexterm" name="id2557124"></a><a class="indexterm" name="id2557133"></a>ワークグループのメンバであるために、特別な設定は必要ないということに注意してほしい。ただ、ネットワーク設定に、ワークグループのエントリーについて共通に使う単一の名前を持つようにマシンを設定するだけである。この時WORKGROUPという名前を使うのが一般的である。この設定モードでは、マシン信頼アカウントはなく、メンバシップの概念は、すべてのマシンがネットワーク環境の中で、論理的に一緒のグループにまとめられているという以上のものではない。繰り返すが、明確言うと、<span class="emphasis"><em>ワークグループモードは、セキュリティの確保されたマシンアカウントを含まない</em></span>。</p><p><a class="indexterm" name="id2557172"></a><a class="indexterm" name="id2557179"></a><a class="indexterm" name="id2557189"></a>ドメインメンバのマシンは、ドメインアカウントデータベース中にマシン信頼アカウントを持つ。ドメインメンバシップを有効にするには、おのおののマシン上で以下の特別な手続きが必要である。この手続きは、ローカルマシンのAdministratorアカウントによってのみ行うことが出来、これにより、ドメインマシンアカウント(もしも存在しなければ)を作成し、そのアカウントを初期化する。クライアントが最初にドメインにログオンすると、それがマシンアカウントのパスワード変更処理のトリガとなり自動的に起動される。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2571125"></a>Sambaがドメインコントローラとして設定されるとき、セキュアなネットワーク操作はMicrosoft Windows NT4/200x/XP Professionalクライアントがすべてドメインメンバとして設定されることを要求する。もしもマシンがドメインのメンバでなければ、それはワークグループ(スタンドアロン)マシンとして操作される。ドメインメンバシップに関係する情報は <a class="link" href="domain-member.html" title="Chapter 6. ドメインメンバシップ">ドメインメンバシップ</a>を参照してほしい。</p></div><p>以下はMicrosoft Windows NT4/200x/XPクライアントのための、Microsoft WindowsNT4スタイルとしてSamba-3を設定するために必要な手順である:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>基本的なTCP/IPとMicrosoft Windows ネットワークの設定。</p></li><li class="listitem"><p>正しいサーバの役割の指定(<a class="link" href="smb.conf.5.html#SECURITY" target="_top">security = user</a>)。</p></li><li class="listitem"><p>一貫性のある名前解決の設定。<sup>[<a name="id2571183" href="#ftn.id2571183" class="footnote">2</a>]</sup></p></li><li class="listitem"><p>Windows NT4/200x/XP Professionalクライアントのためのドメインログオン。</p></li><li class="listitem"><p>移動プロファイルの設定か、明示的にローカルプロファイルを強制使用する設定。</p></li><li class="listitem"><p>network/systemポリシーの設定。</p></li><li class="listitem"><p>ドメインユーザアカウントの追加と管理。</p></li><li class="listitem"><p>Microsoft Windows NT4/2000 ProfessionalとWindows XP Professionalクライアントマシンがドメインメンバになるような設定。</p></li></ul></div><p>以下の準備はMicrosoft 9x/Meクライアントに機能を提供するために必要な手順である:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>基本的なTCP/IPとMicrosoft Windowsネットワークの設定。</p></li><li class="listitem"><p>正しいサーバの役割の指定(<a class="link" href="smb.conf.5.html#SECURITY" target="_top">security = user</a>)。</p></li><li class="listitem"><p>ネットワークログイン設定(Windows 9x/Me/XP Homeは技術的にドメインメンバに	なれないため、ドメインログオンにおけるセキュリティ面には実際には参加しない)。</p></li><li class="listitem"><p>移動プロファイルの設定</p></li><li class="listitem"><p>システムポリシーの取り扱いの設定。</p></li><li class="listitem"><p><span class="quote">“<span class="quote">Microsoft Windowsネットワーク用のクライアント</span>”</span>ネットワークドライバのインストール	とドメインにログオンするための設定。</p></li><li class="listitem"><p>もしもすべてのクライアント共有アクセスがドメインユーザ/グループ識別子に従って制御されることが望ましいならば、Windows 9x/Meクライアントをユーザレベルのセキュリティに設定 。</p></li><li class="listitem"><p>ドメインユーザアカウントの追加と管理。</p></li></ul></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2571317"></a><a class="indexterm" name="id2571324"></a>移動プロファイルとシステム/ネットワークポリシーは、高度なネットワーク管理の話題で、このドキュメントの<a class="link" href="ProfileMgmt.html" title="Chapter 27. デスクトッププロファイルの管理">デスクトッププロファイル管理</a>と<a class="link" href="PolicyMgmt.html" title="Chapter 26. システムとアカウントポリシー">システムとアカウントポリシー</a>で触れられている。しかしながら、それらはWindows NT ネットワークのコンセプトに関連するので、必ずしもSamba PDCに固有の説明ではない。</p></div><p>ドメインコントローラはSMB/CIFSサーバであって以下を行う:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	<a class="indexterm" name="id2571366"></a>	<a class="indexterm" name="id2571375"></a>	<a class="indexterm" name="id2571382"></a>	<a class="indexterm" name="id2571388"></a>	<a class="indexterm" name="id2571395"></a>	自分自身をドメインコントローラとして登録し、公告する(NetBIOSブロードキャストに	加え、UDPブロードキャスト上でのMailslotブロードキャスト、WINSサーバへのUDPユニキャスト、	DNSとActive Directory経由での名前登録によって)。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2571417"></a>	<a class="indexterm" name="id2571424"></a>	NETLOGON サービスの提供(これは実際、複数のプロトコル上で動くサービスの集合体である。	それらにはLanManログオンサービス、Netlogonサービス、ローカルセキュリティアカウント	サービスとそれらのバリエーションを含む。)。	</p></li><li class="listitem"><p>	NETLOGONという共有が提供される。	</p></li></ul></div><p><a class="indexterm" name="id2571452"></a><a class="indexterm" name="id2571464"></a><a class="indexterm" name="id2571476"></a><a class="indexterm" name="id2571482"></a><a class="indexterm" name="id2571489"></a>それらを提供するためにSambaを設定することはむしろ容易である。おのおののSambaドメインコントローラは Sambaが<a class="link" href="smb.conf.5.html#DOMAINLOGONS" target="_top">domain logons</a>機能(<code class="filename">smb.conf</code>ファイル中のパラメータから取って)と呼ぶNETLOGONサービスを提供しなければならない。さらに、Samba-3ドメイン中の1つのサーバはドメインマスタブラウザとしてそれ自身を公告しなければならない。<sup>[<a name="id2571530" href="#ftn.id2571530" class="footnote">3</a>]</sup>これにより、与えられたドメインまたはワークグループにDMB識別されるようなドメイン固有のNetBIOS名をPDCが取得することになる。ブロードキャストで分離されたサブネットの、同じドメインまたはワークグループ上の複数のローカルマスタブラウザ(LMB)は、WAN全体のブラウズリストの完全なコピーのために問い合わせを行う。ブラウザクライアントは次にそれらのLMBに接続し、ブロードキャストで分離されたサブネットのためのリストだけではなく、ドメイン全体のブラウズリストを受け取る。</p></div></div><div class="sect1" title="ドメイン制御: 設定例"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2571564"></a>ドメイン制御: 設定例</h2></div></div></div><p>Samba PDCを作成するための作業の第一歩は<code class="filename">smb.conf</code>中で必要なパラメータの理解である。PDCとして機能するための<code class="filename">smb.conf</code>の例は以下の<a class="link" href="samba-pdc.html#pdc-example" title="Example 4.1. PDC用のsmb.confの例">PDC用のsmb.confの例</a>である。</p><div class="example"><a name="pdc-example"></a><p class="title"><b>Example 4.1. PDC用のsmb.confの例</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2571621"></a></td></tr><tr><td><a class="indexterm" name="id2571628"></a></td></tr><tr><td><a class="indexterm" name="id2571635"></a><em class="parameter"><code>passdb backend = tdbsam</code></em></td></tr><tr><td><a class="indexterm" name="id2571647"></a><em class="parameter"><code>os level = 33</code></em></td></tr><tr><td><a class="indexterm" name="id2571659"></a><em class="parameter"><code>preferred master = auto</code></em></td></tr><tr><td><a class="indexterm" name="id2571670"></a><em class="parameter"><code>domain master = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2571682"></a><em class="parameter"><code>local master = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2571694"></a><em class="parameter"><code>security = user</code></em></td></tr><tr><td><a class="indexterm" name="id2571706"></a><em class="parameter"><code>domain logons = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2571717"></a><em class="parameter"><code>logon path = \\%N\profiles\%U</code></em></td></tr><tr><td><a class="indexterm" name="id2571729"></a><em class="parameter"><code>logon drive = H:</code></em></td></tr><tr><td><a class="indexterm" name="id2571741"></a><em class="parameter"><code>logon home = \\homeserver\%U\winprofile</code></em></td></tr><tr><td><a class="indexterm" name="id2571753"></a><em class="parameter"><code>logon script = logon.cmd</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[netlogon]</code></em></td></tr><tr><td><a class="indexterm" name="id2571774"></a><em class="parameter"><code>path = /var/lib/samba/netlogon</code></em></td></tr><tr><td><a class="indexterm" name="id2571785"></a><em class="parameter"><code>read only = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2571797"></a></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[profiles]</code></em></td></tr><tr><td><a class="indexterm" name="id2571813"></a><em class="parameter"><code>path = /var/lib/samba/profiles</code></em></td></tr><tr><td><a class="indexterm" name="id2571825"></a><em class="parameter"><code>read only = no</code></em></td></tr><tr><td><a class="indexterm" name="id2571836"></a><em class="parameter"><code>create mask = 0600</code></em></td></tr><tr><td><a class="indexterm" name="id2571848"></a><em class="parameter"><code>directory mask = 0700</code></em></td></tr></table></div></div><br class="example-break"><p><a class="link" href="samba-pdc.html#pdc-example" title="Example 4.1. PDC用のsmb.confの例">上記の例</a>中で示される基本的なオプションの説明は以下の通り:</p><div class="variablelist"><dl><dt><span class="term">passdb backend </span></dt><dd><p>		<a class="indexterm" name="id2571882"></a>		<a class="indexterm" name="id2571892"></a>		<a class="indexterm" name="id2571898"></a>		<a class="indexterm" name="id2571905"></a>		<a class="indexterm" name="id2571912"></a>		<a class="indexterm" name="id2571919"></a>		ここにすべてのユーザとグループアカウント情報が含まれている。PDCで使える値は:		<span class="emphasis"><em>smbpasswd, tdbsamとldapsam</em></span>である。<span class="quote">“<span class="quote">guest</span>”</span>		エントリは既定値のアカウントを提供し、それは既定値で含まれている;明示的に		追加する必要はない。		</p><p>		<a class="indexterm" name="id2571946"></a>		<a class="indexterm" name="id2571953"></a>		<a class="indexterm" name="id2571960"></a>		<a class="indexterm" name="id2571967"></a>		BDCを使う場合、passdb backendを配信するために論理的な唯一の選択肢は		LDAPを使うことである。tdbsamとsmbpasswdファイルは効果的に配信できないため、それを		使うべきではない。		</p></dd><dt><span class="term">ドメイン管理パラメータ</span></dt><dd><p>		<a class="indexterm" name="id2571992"></a>		<a class="indexterm" name="id2571999"></a>		<a class="indexterm" name="id2572006"></a>		<a class="indexterm" name="id2572013"></a>		パラメータ<span class="emphasis"><em>os level, preferred master, domain master, security, 		encrypt passwords</em></span>と<span class="emphasis"><em>domain logons</em></span>はドメイン		管理とネットワークログオンのサポートを確実にするために中心的な役割を演じる。		</p><p>		<a class="indexterm" name="id2572037"></a>		<a class="indexterm" name="id2572043"></a>		<span class="emphasis"><em>os level</em></span>は32以上にし、<span class="emphasis"><em>user</em></span>		モードセキュリティ、Microsoft互換の暗号化パスワードサポート、		ネットワークログオンサービス(ドメインログオン)を提供するように		設定しなければ	ならない。暗号化パスワードは有効にしなければならない。		この設定についての詳細は、		<a class="link" href="passdb.html" title="Chapter 11. アカウント情報データベース">アカウント情報データベース</a>を参照のこと。		</p></dd><dt><span class="term">環境パラメータ</span></dt><dd><p>		<a class="indexterm" name="id2572086"></a>		<a class="indexterm" name="id2572093"></a>		<a class="indexterm" name="id2572099"></a>		<a class="indexterm" name="id2572106"></a>		パラメータ<span class="emphasis"><em>logon path, logon home, logon drive</em></span>と<span class="emphasis"><em>logon script</em></span>		は環境サポートの設定で、クライアントログオン操作機能を支援し、ネットワーク管理の		間接費用を軽減するための、自動コントロール機能の提供するものである。		それらのパラメータに関しては、マニュアルページの情報を参照してほしい。		</p></dd><dt><span class="term">NETLOGON共有</span></dt><dd><p>		<a class="indexterm" name="id2572142"></a>		<a class="indexterm" name="id2572149"></a>		<a class="indexterm" name="id2572156"></a>		<a class="indexterm" name="id2572163"></a>		<a class="indexterm" name="id2572170"></a>		<a class="indexterm" name="id2572177"></a>		NETLOGON共有はドメインログオンとドメインメンバシップサポートで中心的な役割を演じる。		この共有はすべてのMicrosoftドメインコントローラ上で提供される。これは、ログオン処理のために		必要となるかもしれない他の共通ツールを見つけるのと同じように、ログオンスクリプト		の提供と、グループポリシーファイル(NTConfig.POL)の格納のために使われる。これは、		ドメインコントローラ上で不可欠な共有である。		</p></dd><dt><span class="term">PROFILE共有</span></dt><dd><p>		<a class="indexterm" name="id2572205"></a>		<a class="indexterm" name="id2572212"></a>		<a class="indexterm" name="id2572219"></a>		<a class="indexterm" name="id2572226"></a>		<a class="indexterm" name="id2572233"></a>		この共有はユーザのデスクトッププロファイルを格納するために使われる。各ユーザ		はディレクトリのrootにこの共有を持たねばならない。このディレクトリはユーザが		書き込み可能で、グローバルに読み込み可能でなければならない。Samba-3は		<span class="quote">“<span class="quote">fake_permissions</span>”</span>と呼ばれる、この共有上にインストール可能な		VFSモジュールを用意している。これはSambaの管理者が、全員に対してこのディレクトリを		読み込みのみにすることを許可する。もちろん、これはプロファイルが適した形で作成された		後に行ってこそ有用である。		</p></dd></dl></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>上記のパラメータが、サーバの動作モードを決めるパラメータの一式であると思って良い。<code class="filename">smb.conf</code>パラメータのうち必須のものを以下に列挙する:</p><p></p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2572290"></a><em class="parameter"><code>netbios name = BELERIAND</code></em></td></tr><tr><td><a class="indexterm" name="id2572302"></a><em class="parameter"><code>workgroup = MIDEARTH</code></em></td></tr><tr><td><a class="indexterm" name="id2572314"></a><em class="parameter"><code>domain logons = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2572326"></a><em class="parameter"><code>domain master = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2572338"></a><em class="parameter"><code>security = User</code></em></td></tr></table><p></p><p>この節中にある、長いリスト中で示されている追加のパラメータは、より完全な説明のためのものである。</p></div></div><div class="sect1" title="SambaによるADSドメイン制御"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2572360"></a>SambaによるADSドメイン制御</h2></div></div></div><p><a class="indexterm" name="id2572368"></a>Samba-3はActive Directoryサーバとしては機能しない。真のActive DirectoryのPDCとして機能することもできない。いくつかのActive Directoryドメインコントローラの機能用のプロトコルが実験的なものとして部分的に実装されてはいる。しかし、Samba-3がそれらのプロトコルをサポートするとは思わないでほしい。現在または将来にわたって、そのような任意の機能に依存しないでほしい。Sambaチームは将来これらの機能を取り除いたり機能を変更するかもしれない。このことをここに言及するのは、これらの秘密の機能をすでに発見し、この機能が完成されるのはいつかという質問を寄せられた方々のためである。その答えは、「出来るかもしれないし出来ないかもしれない!」である。</p><p><a class="indexterm" name="id2572409"></a><a class="indexterm" name="id2572416"></a>たしかに、Samba-3はMicrosoft Windows NT4スタイルのドメインコントローラが持つ大部分の機能を提供するように設計されている。Samba-3にはWindows NT4の全ての機能があるわけではないが、一方Windows NT4 ドメインコントローラにはない多くのの特徴を持っている。要するに、Samba-3はNT4でもWindows Server 200xでもない。もちろんActive Directoryサーバでもない。この言い方で全ての人に簡単にシンプルに理解していただけると期待している。</p></div><div class="sect1" title="ドメインとネットワークログインの設定"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2572436"></a>ドメインとネットワークログインの設定</h2></div></div></div><p><a class="indexterm" name="id2572444"></a>ネットワークとドメインのログオンについて、ここで言及するのは、ドメインコントローラが提供する本質的な機能の欠かせない部分だからである。</p><div class="sect2" title="ドメインネットワークログオンサービス"><div class="titlepage"><div><div><h3 class="title"><a name="id2572459"></a>ドメインネットワークログオンサービス</h3></div></div></div><p><a class="indexterm" name="id2572468"></a>すべてのドメインコントローラはネットログオンサービスを動かさなければならない(Samba中での<span class="emphasis"><em>ドメインログオン</em></span>)。1つのドメインコントローラが<a class="link" href="smb.conf.5.html#DOMAINMASTER" target="_top">domain master = Yes</a>(PDC)と設定しなければならない;すべてのBDCではパラメータを<a class="link" href="smb.conf.5.html#DOMAINMASTER" target="_top">domain master = No</a>と設定しなければならない。</p><div class="sect3" title="設定例"><div class="titlepage"><div><div><h4 class="title"><a name="id2572514"></a>設定例</h4></div></div></div><div class="example"><a name="PDC-config"></a><p class="title"><b>Example 4.2. PDCにするためのsmb.conf</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2572543"></a><em class="parameter"><code>domain logons = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2572555"></a><em class="parameter"><code>domain master = (PDCならYes, BDCならNo)</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[netlogon]</code></em></td></tr><tr><td><a class="indexterm" name="id2572577"></a><em class="parameter"><code>comment = Network Logon Service</code></em></td></tr><tr><td><a class="indexterm" name="id2572589"></a><em class="parameter"><code>path = /var/lib/samba/netlogon</code></em></td></tr><tr><td><a class="indexterm" name="id2572601"></a><em class="parameter"><code>guest ok = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2572612"></a><em class="parameter"><code>browseable = No</code></em></td></tr></table></div></div><br class="example-break"></div><div class="sect3" title="Windows XP Home Editionにおける特別な例"><div class="titlepage"><div><div><h4 class="title"><a name="id2572626"></a>Windows XP Home Editionにおける特別な例</h4></div></div></div><p><a class="indexterm" name="id2572635"></a>次のことを完全に理解してほしい:Microsoft Windows XP Home Editionを Microsoft Windows NT4またはActive Directoryドメインセキュリティに統合したいと思ってもそれが出来ない。これを解決する唯一のオプションは、Microsoft Windows XP Home EditionからMicrosoft Windows XP Professional へのアップグレードを購入することである。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Microsoft Windows XP Home Editionはどのようなタイプのドメインセキュリティ機能に参加する能力は持っていない。Microsoft Windows 9x/Meと異なり、Microsoft Windows XP Home Edition はネットワークにログオンする機能を完全に欠いている。</p></div><p>このことは前にも説明したが、この事について、Sambaチームの誰かに質問を問い合わせたり、メーリングリストに質問を投げないでほしい。なぜなら「出来ないから」である。それが出来るとなると、それはMicrosoftとの間のライセンスに違反することになるので、それをしないことを推奨する。</p></div><div class="sect3" title="Windows 9x/Meにおける特別な例"><div class="titlepage"><div><div><h4 class="title"><a name="id2572682"></a>Windows 9x/Meにおける特別な例</h4></div></div></div><p><a class="indexterm" name="id2572691"></a><a class="indexterm" name="id2572698"></a><a class="indexterm" name="id2572705"></a><a class="indexterm" name="id2572712"></a><a class="indexterm" name="id2572719"></a>ドメインとワークグループはネットワークブラウジングという言葉において全く同等である。2つの違いは、ネットワークへの安全なログインのための、分散認証データベースはドメインに関連づけられることである。また、ドメインログオンサーバに対して認証が成功したユーザに対して異なるアクセス権を付与できる。Samba-3はこの機能をMicrosoft Windows NT/200xと同じ方法で行う。</p><p><a class="indexterm" name="id2572739"></a>ドメインへのログオンするSMBクライアントは、ドメイン内のすべての他のサーバが同じ認証情報を受け取ることを期待している。ドメインとワークグループのネットワークブラウズ機能は同一であり、この文書内の、ブラウジングに関する節の中で説明される。ブラウジングはログインサポートとは直交する(互いに他方への影響を考慮する必要のない)概念であることに留意してほしい。</p><p><a class="indexterm" name="id2572760"></a><a class="indexterm" name="id2572767"></a><a class="indexterm" name="id2572774"></a>シングルログオン(訳注:シングルサインオンか?)ネットワークモデルに関連する課題はこの節で扱う。Sambaはドメインログオン、ネットワークログオンスクリプト、ユーザプロファイルを、この節で扱う、Microsoft Windows for WorkgropsとMicrosoft Windows 9x/Meクライアントに対してサポートする。</p><p><a class="indexterm" name="id2572794"></a>ドメイン中のSMBクライアントがログオンしようとした時、ログオンサーバを探す要求をブロードキャストする。最初にリプライするものが処理を行い、Samba管理者がインストールした何らかの機構を使ってパスワードを認証する。サーバ間でユーザデータベースが共有されていないドメイン(つまり、サーバが、本質的にはワークグループサーバーでありながら、しかも自分はドメインに参加していると他に周知するようなドメイン)を作成することも可能である(お勧めはしないが)。これは認証機構がドメインとはかなり異なるものでありながら、ドメインと密接に関係しているということを示している。</p><p>これらの機能を使うことで、Sambaサーバ経由でクライアントのログオンの確認させることができる。すなわち、ネットワークにログオンした時にクライアント側でバッチファイルを実行させ、クライアントの個人設定、デスクトップおよびスタートメニューをダウンロードさせる。</p><p><span class="emphasis"><em>Microsoft Windows XP Home edition はドメインに参加できず、ドメインログオンの使用が許可されない。</em></span></p><p>設定手続きの話に入る前に、Windows 9x/Meクライアントがログオンをどのように実行するかを見ておくことにしよう:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>	<a class="indexterm" name="id2572872"></a>	<a class="indexterm" name="id2572879"></a>	クライアントは(それがいるサブネットのIPブロードキャストアドレスに	対して)NetLogon要求をブロードキャストする。これは、NetBIOSレイヤ	でのNetBIOS名 DOMAIN<1C> に送られる。クライアントは、最初に受け取った回答を選ぶ。	その回答には<code class="filename">\\SERVER</code>という形式で、ログオンサーバのNetBIOS	名を含む。<code class="literal">1C</code>という	名前はドメインコントローラ(netlogonサービスを提供するSMB/CIFSサーバ)	によって登録された名前のタイプである。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2572916"></a>	<a class="indexterm" name="id2572922"></a>	<a class="indexterm" name="id2572929"></a>	クライアントがそのサーバに接続し、ログオンし(SMBsessetupXを実行)	し、次にIPC$共有に接続する(SMBtconXを使って)。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2572948"></a>	クライアントは、ユーザのログオンスクリプト名を検索する	NetWkstaUserLogon要求を送る。	</p></li><li class="listitem"><p>	クライアントは次にNetLogon共有に接続し、そのスクリプトを検索する。	もしも見つかり、読み出しできるならば、クライアントはそれを取り出し	実行する。その後、クライアントはNetLogon共有の接続を切る。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2572981"></a>	<a class="indexterm" name="id2572988"></a>	クライアントは、サーバにNetUserGetInfo要求を送り、プロファイル検索の	ために使うユーザのホーム共有を検索する。NetUserGetInfo要求の	応答はユーザのホーム共有以外のものは含まれていないので、Windows 9x用のプロファイルは	ユーザのホームディレクトリ内になければならない。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2573012"></a>	クライアントはユーザのプロファイルを検索するために	ホーム共有に接続する。その時、共有名とパスでユーザのホーム共有を指定する	こともできる。例をあげると、<code class="filename">\\server\fred\.winprofile</code>	である。もしもプロファイルが見つかれば、それを適用する。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2573042"></a>	クライアントは次にユーザのホーム共有を切断し、NetLogon共有に再接続し、	ポリシーファイル<code class="filename">CONFIG.POL</code>を探す。もしも見つかれば、	それを読み、適用する。	</p></li></ol></div><p>PDCとWindows 9x/Me ログオンサーバ設定の主要な違いは以下の通り:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	<a class="indexterm" name="id2573075"></a>	<a class="indexterm" name="id2573084"></a>	Windows 9x/Me ログオンサーバでは、パスワード暗号化は不要である。しかし、	Microsoft Windows 98 以降、既定値では平文パスワードサポートが無効化され	ていることに注意。<a class="link" href="PolicyMgmt.html" title="Chapter 26. システムとアカウントポリシー">システムとアカウントポリシー</a>	で記述されているレジストリの変更で再度有効に出来る。	</p></li><li class="listitem"><p>	<a class="indexterm" name="id2573114"></a>	Windows 9x/Me クライアントはマシン信頼アカウントを必要とせず、かつ使わない。	</p></li></ul></div><p><a class="indexterm" name="id2573129"></a>Samba PDCは Windows 9x/Meログオンサーバとしてどうさする。すなわち、Windows 9x/Meが期待するネットワークログオンサービスを提供するということである。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2573148"></a>平文パスワードの使用は避けることを強く推奨する。それを使うと、ネットワークトラフィックを解析するネットワークようなツールを使うことで、容易にパスワードを検出できてしまうからである。</p></div></div></div><div class="sect2" title="セキュリティモードとマスタブラウザ"><div class="titlepage"><div><div><h3 class="title"><a name="id2573167"></a>セキュリティモードとマスタブラウザ</h3></div></div></div><p><a class="indexterm" name="id2573175"></a><a class="indexterm" name="id2573182"></a><a class="indexterm" name="id2573189"></a>わかりにくい点が残らないように、最後に幾つかコメントを記述する。userモード以外でのセキュリティモードの時に、Sambaをドメインコントローラとして設定してもよいかについては、さまざまな議論があった。技術的な理由でうまくいかないセキュリティモードは、share モードのセキュリティのみである。domainモードとserver モードのセキュリティは、実際にはSMBのuserレベルのセキュリティの変形のようなものである。</p><p><a class="indexterm" name="id2573210"></a><a class="indexterm" name="id2573216"></a><a class="indexterm" name="id2573223"></a><a class="indexterm" name="id2573230"></a><a class="indexterm" name="id2573236"></a><a class="indexterm" name="id2573244"></a><a class="indexterm" name="id2573251"></a>この問題は、Samba がドメインコントローラとして機能しているときに、そのワークグループのドメインマスタブラウザでなければならないかという議論と密接に関連している。純粋なMicrosoft Windows NTドメイン中では、PDCはDMBになるために選択に勝ち、次に、DOMAIN<1B>というNetBIOS名を登録する。これはWindowsクライアントがDOMAIN<1C>名を探すためにネットワークログオンサーバ見つけるときに使う名前である。DMBはドメインマスタブラウザである。<a class="link" href="NetworkBrowsing.html" title="Chapter 10. ネットワークブラウジング">ネットワークブラウジングの章</a>、<a class="link" href="NetworkBrowsing.html#DMB" title="ワークグループのブラウジングの設定">WORKGROUPブラウジングの設定</a>を参照のこと。この問題も議論に密接に結びついている。Microsoft PDC はDMBになるためにelectionに勝つことを期待するが、もしも勝てない場合、electionはDMBになるためのelectionに負けたという内容をWindowsイベントロガー(訳注:イベントビューワ?)に、警告メッセージを短い間隔で連続して出力する。この理由のため、SambaサーバがPDCであるネットワーク中では、SambaドメインコントローラをDMBとして設定するのが賢いやり方である。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2573310"></a><a class="indexterm" name="id2573316"></a><a class="indexterm" name="id2573323"></a><a class="indexterm" name="id2573330"></a><a class="indexterm" name="id2573337"></a>DOMAIN<1C>名を登録するSMB/CIFSサーバは、ネットワークログオンサービスを提供するのでそのように処理する。DOMAIN<1B>名を登録するサーバはDMBであるすなわち、DOMAIN<1D>名を登録されたすべてのマシンを含んでのブラウズリスト同期の責任を持つと言うことである。後者は、存在しているローカルネットワークセグメントで、すべてのNetBIOS名の登録監視に責任があるLMBである。ネットワークログオンサービス(NETLOGON)はドメイン制御に関連していているが、ネットワークブラウジングとブラウズリスト管理には関係していない。1Cと1B/1Dの名前サービスはお互いに無関係である。</p></div><p><a class="link" href="smb.conf.5.html#SECURITY" target="_top">security = user</a>以外のモードでSambaドメインコントローラを使うための設定の問題に戻ろう。ユーザからの接続要求を検証するためにSambaホストが他のSMBサーバかドメインコントローラを使うように設定した場合、ネットワーク上の他のマシン(<a class="link" href="smb.conf.5.html#PASSWORDSERVER" target="_top">password server</a>)は、Sambaホストよりもより詳しくユーザについて知っているという状況になる。99％のケースで、この別のホストはドメインコントローラである。ドメインモードセキュリティで動作している場合、<a class="link" href="smb.conf.5.html#WORKGROUP" target="_top">workgroup</a>パラメータは(すでにドメインコントローラが持っている)Windows NTドメインの名前に設定しれなければならない。もしもそのドメインがドメインコントローラをまだ持っていない場合、ドメイン自体がないのと同じである。</p><p>すでに定義上PDCを持つドメイン用にSambaサーバをドメインコントローラとして設定することは問題を発生させる。それゆえ、そのドメインに対してDMBになるようにと<a class="link" href="smb.conf.5.html#SECURITY" target="_top">security = user</a>を設定するようにSambaドメインコントローラをいつでも設定すべきである。この方法のみが公式にサポートされる操作モードである。</p></div></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2573464"></a>よくあるエラー</h2></div></div></div><div class="sect2" title="“$”マシン名中に$を含められない"><div class="titlepage"><div><div><h3 class="title"><a name="id2573470"></a><span class="quote">“<span class="quote">$</span>”</span>マシン名中に$を含められない</h3></div></div></div><p><a class="indexterm" name="id2573479"></a><a class="indexterm" name="id2573486"></a><a class="indexterm" name="id2573492"></a>通常<code class="filename">/etc/passwd</code>に格納されるマシンアカウントは、マシン名に<span class="quote">“<span class="quote">$</span>”</span>を追加した形である。いくつかのBSDシステムはユーザ名に<span class="quote">“<span class="quote">$</span>”</span>を使うものが作成できない。最近のFreeBSDのバージョンはこの制限が取り払われたが、それより古いものはまだ使われている。</p><p><a class="indexterm" name="id2573520"></a>問題はエントリを作る時に使われるプログラム中のみである。一度作成されると問題なく動作する。まず<span class="quote">“<span class="quote">$</span>”</span>なしでユーザ名を作る。次に、エントリを編集するために <code class="literal">vipw</code>を使い<span class="quote">“<span class="quote">$</span>”</span>を追加する。あるいは、最初からエントリをvipwで作っても良い。その際には固有のユーザログインIDを使うようにすること。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>マシンアカウントはワークステーションが持つ名前と同じ名前でなければならない。</p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>UNIXのツール<code class="literal">vipw</code>は直接<code class="filename">/etc/passwd</code>を修正する共通的なツールである。vipwを使うと(もしも使われているならば)shadowファイルがパスワードファイルと同じになることを保証する。これはセキュリティの観点から重要である。</p></div></div><div class="sect2" title="存在するマシンアカウントがあるためにドメイン参加に失敗する"><div class="titlepage"><div><div><h3 class="title"><a name="id2573578"></a>存在するマシンアカウントがあるためにドメイン参加に失敗する</h3></div></div></div><p><a class="indexterm" name="id2573588"></a><span class="quote">“<span class="quote">I get told,マシン信頼アカウント作成時に `You already have a connection to the Domain....'(既にドメインへの接続があります。) か`Cannot join domain, the credentials supplied conflict with an existing set...'(ドメインに参加できません。信用情報が既存のものと一致しません)が出ることについては以前に話した。</span>”</span></p><p>これは、そのマシン自身からマシン信頼アカウントの作成を使用としたとき、Samba PDC上の共有(かIPC$)にすでに接続している(つまりマップされたドライブ)がある時に起きる。以下のコマンドはすべてのネットワークドライブ接続を切断する:</p><pre class="screen"><code class="prompt">C:\> </code><strong class="userinput"><code>net use * /d</code></strong></pre><p>これはすべてのネットワーク接続を切る。</p><p>さらに、もしもマシンがすでに参加済みのドメインと同じ名前の<span class="quote">“<span class="quote">workgroupのメンバ</span>”</span>ならば(これはやってはいけない)、このメッセージが出る。ワークグループを何か別の名前に変えて再起動し、もう一度やってみる。</p></div><div class="sect2" title="システムにログオンできない(C000019B)"><div class="titlepage"><div><div><h3 class="title"><a name="id2573662"></a>システムにログオンできない(C000019B)</h3></div></div></div><p><span class="quote">“<span class="quote">ドメイン参加に成功したが、Sambaのバージョンを新しくした後、ログオン時に<span class="errorname">`The system cannot log you on (C000019B). Please try again or consult your systemadministrator(システムはあなたのログオンを許可できません(C000019B)。後ほど再試行するか、システム管理者に相談してログオンしてください)</span>というメッセージが出た。'</span>”</span></p><p><a class="indexterm" name="id2573693"></a>これはsecrets.tdbに格納されているドメインSIDが変わったことによって引き起こされるものである。ドメインSIDが変わるよくある理由は、ドメイン名かサーバ名(NetBIOS名)が変わったことである。問題を解決する唯一の方法はオリジナルのドメインSIDに戻すか、クライアントをいったんドメインから削除して再参加することである。ドメインSIDは、netまたはrpcclientユーティリティによってリセットすることも出来る。</p><p>ドメインSIDをリセットしたり、変更するには、以下のようにnetコマンドを使用する:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>net getlocalsid 'OLDNAME'</code></strong><code class="prompt">root# </code><strong class="userinput"><code>net setlocalsid 'SID'</code></strong></pre><p></p><p>ワークステーションのマシン信頼アカウントはドメイン(またはネットワーク)SIDでのみ動作する。このSIDが変更されると、ドメインメンバ(ワークステーション)はドメインにログオンできない。オリジナルのドメインSIDはsecrets.tdbファイルから復元できる。別の解は、おのおののワークステーションが再度ドメインに参加することである。</p></div><div class="sect2" title="マシン信頼アカウントがアクセスできない"><div class="titlepage"><div><div><h3 class="title"><a name="id2573758"></a>マシン信頼アカウントがアクセスできない</h3></div></div></div><p><span class="quote">“<span class="quote">ドメインに参加しようとした時 <span class="errorname">"The machine account for this computer either does not exist or is not accessible(このコンピューターのマシン・アカウントは存在しないか、アクセスできません) </span>."というメッセージが出た。何が悪い?</span>”</span></p><p>この問題は、PDCが適切なマシン信頼アカウントを持っていないことに起因する。アカウント作成時に<a class="link" href="smb.conf.5.html#ADDMACHINESCRIPT" target="_top">add machine script</a>という方法を使った場合、このメッセージは、アカウント作成に失敗したことを示している。ドメイン管理ユーザのシステムが動作しているかを確認して正常動作するようにすること。</p><p>かわりに、手動でアカウントエントリを作成していた場合、正しく作られていないということである。Samba PDC上で<code class="filename">smbpasswd</code>ファイル中のマシン信頼アカウントのエントリが正しく出来たかどうかを確認する。もしも、smbpasswd ユーティリティを使わないでアカウントをエディタで追加した場合、アカウント名をマシンのNetBIOS名に<span class="quote">“<span class="quote">$</span>”</span>を追加して(すなわち、computer_name$)おくこと。これはSambaSAMAccountバックエンドと同じようにPOSIX UNIXシステムアカウントバックエンドの両方の中に存在する必要がある。Samba-3の既定値のバックエンド(すなわち、パラメータ<em class="parameter"><code>passdb backend</code></em>)は<code class="filename">smb.conf</code>ファイル中で指定されておらず、また、もしも指定されているものが<code class="literal">smbpasswd</code>だった場合、それらはそれぞれ<code class="filename">/etc/passwd</code>と<code class="filename">/etc/samba/smbpasswd</code>(あるいはもしもSambaチームの既定値の設定を使ってコンパイルした場合は<code class="filename">/usr/local/samba/lib/private/smbpasswd</code>)である。<code class="filename">/etc/passwd</code>の使用はNSS <code class="filename">/etc/nsswitch.conf</code>ファイル中の別の設定で上書きすることが出来る。</p><p>SambaサーバとNTクライアントの間のサブネットマスクの不一致により、この問題が起こるという報告も一部から上がっている。クライアントとサーバ両方で整合性を取るようにすること。</p></div><div class="sect2" title="アカウントが無効"><div class="titlepage"><div><div><h3 class="title"><a name="id2573906"></a>アカウントが無効</h3></div></div></div><p><span class="quote">“<span class="quote">NT4/W200xワークステーションからSambaドメインにログオンしようとしたとき、アカウントが無効になっているメッセージが出た。</span>”</span></p><p><strong class="userinput"><code>smbpasswd -e <em class="replaceable"><code>username</code></em>でユーザアカウントを有効化する</code></strong>。これは通常アカウント作成時に行われる。</p></div><div class="sect2" title="ドメインコントローラが無効"><div class="titlepage"><div><div><h3 class="title"><a name="id2573938"></a>ドメインコントローラが無効</h3></div></div></div><p><span class="quote">“<span class="quote">Sambaが開始してから数分間、クライアントがエラー`Domain Controller Unavailable'(ドメイン・コントローラーが使えません。)を表示する。</span>”</span></p><p>ドメインコントローラはネットワーク上にその役割をアナウンスする。これは通常しばらくかかる。最低15分は待ち、再度試してみること。</p></div><div class="sect2" title="ドメイン参加後ドメインメンバワークステーションにログオンできない"><div class="titlepage"><div><div><h3 class="title"><a name="id2573965"></a>ドメイン参加後ドメインメンバワークステーションにログオンできない</h3></div></div></div><p><a class="indexterm" name="id2573974"></a><a class="indexterm" name="id2573981"></a>ドメイン参加成功後、2つのメッセージのうちの1つが出てユーザログオンに失敗する:1つはドメインコントローラが見つからないというもので、もう1つはアカウントがドメインにないか、パスワードが違うというものである。これは、<span class="emphasis"><em>schannel</em></span>(セキュアchannel)の設定か、<span class="emphasis"><em>smb 署名</em></span>の設定について、WindowsクライアントとSamba-3サーバにおいて設定の不一致によるものと考えられる。以下を実行して、Sambaの<span class="emphasis"><em>client schannel</em></span>、<span class="emphasis"><em>server schannel</em></span>、<span class="emphasis"><em>client signing</em></span>、<span class="emphasis"><em>server signing</em></span>の設定とそれらの値について確認すること:</p><pre class="screen"><code class="literal">testparm -v | grep channel</code></pre><p></p><p>また、MMC  ローカルセキュリティの設定を使うこと。このツールはコントロールパネルにある。ポリシーの設定は、ローカルポリシー/セキュリティオプション領域にあり、<span class="emphasis"><em>Secure Channel:..., and Digitally sign...(セキュリティチャネル、 デジタル的に署名)</em></span>という言葉を含んだ項目で設定する。</p><p>これらが Samba-3 サーバー設定と一致した設定になっていることが大切である。</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.id2570288" href="#id2570288" class="para">1</a>] </sup><a class="link" href="passdb.html" title="Chapter 11. アカウント情報データベース">アカウント情報データベース</a>を参照のこと。</p></div><div class="footnote"><p><sup>[<a name="ftn.id2571183" href="#id2571183" class="para">2</a>] </sup><a class="link" href="NetworkBrowsing.html" title="Chapter 10. ネットワークブラウジング">ネットワークブラウジングNetwork Browsing</a>と 		<a class="link" href="integrate-ms-networks.html" title="Chapter 29. Microsoft Windows ネットワークへのSambaの統合">Microsoft Windows ネットワークとSambaの統合</a>を参照。</p></div><div class="footnote"><p><sup>[<a name="ftn.id2571530" href="#id2571530" class="para">3</a>] </sup><a class="link" href="NetworkBrowsing.html" title="Chapter 10. ネットワークブラウジング">ネットワークのブラウジング</a>を参照。</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ServerType.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="type.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="samba-bdc.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 3. サーバタイプとセキュリティモード </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 5. バックアップドメインコントローラ</td></tr></table></div></body></html>