<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 16. ファイル、ディレクトリと共有のアクセス制御</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="rights.html" title="Chapter 15. User Rights and Privileges"><link rel="next" href="locking.html" title="Chapter 17. ファイルとレコードのロッキング"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 16. ファイル、ディレクトリと共有のアクセス制御</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="rights.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="locking.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 16. ファイル、ディレクトリと共有のアクセス制御"><div class="titlepage"><div><div><h2 class="title"><a name="AccessControls"></a>Chapter 16. ファイル、ディレクトリと共有のアクセス制御</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jeremy</span> <span class="surname">Allison</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jra@samba.org">jra@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><span class="contrib">drawing</span> <div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">May 10, 2003</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="AccessControls.html#id2624010">機能と利便性</a></span></dt><dt><span class="sect1"><a href="AccessControls.html#id2624248">ファイルシステムのアクセス制御</a></span></dt><dd><dl><dt><span class="sect2"><a href="AccessControls.html#id2624268">Microsoft Windows NTFSとUNIXファイルシステムとの比較</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2624712">ディレクトリの管理</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2624844">ファイルとディレクトリのアクセス制御</a></span></dt></dl></dd><dt><span class="sect1"><a href="AccessControls.html#id2625638">共有のアクセス制御の定義</a></span></dt><dd><dl><dt><span class="sect2"><a href="AccessControls.html#id2625672">ユーザとグループベースの制御</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2626084">ファイルとディレクトリに対するパーミッションベースの制御</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2626465">その他の制御</a></span></dt></dl></dd><dt><span class="sect1"><a href="AccessControls.html#id2626855">共有のアクセス制御</a></span></dt><dd><dl><dt><span class="sect2"><a href="AccessControls.html#id2627021">共有のパーミッションの管理</a></span></dt></dl></dd><dt><span class="sect1"><a href="AccessControls.html#id2627425">Microsoft Windowsのアクセス制御リストとUNIXとの相互運用性</a></span></dt><dd><dl><dt><span class="sect2"><a href="AccessControls.html#id2627433">NTセキュリティダイアログを使用したUNIXパーミッションの管理</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2627501">Samba共有上でのファイルセキュリティの表示</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2627595">ファイルの所有者の表示</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2627769">ファイルとディレクトリのパーミッションの表示</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2628040">ファイルまたはディレクトリのパーミッションの変更</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2628239">標準的なSambaの<span class="quote">“<span class="quote">create mask</span>”</span>パラメータとの相互作用</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2628630">標準Sambaファイル属性のマッピングの相互関係</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2628716">Windows NT/200X ACLとPOSIX ACLの制限</a></span></dt></dl></dd><dt><span class="sect1"><a href="AccessControls.html#id2629193">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="AccessControls.html#id2629209">Publicな共有にユーザが書き込めない</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2629562"><span class="emphasis"><em>force user</em></span>セットで<span class="emphasis"><em>root</em></span>としてファイル操作が完了する</a></span></dt><dt><span class="sect2"><a href="AccessControls.html#id2629607">SambaでMicrosoft Wordを使うとファイルの所有者が変更される</a></span></dt></dl></dd></dl></div><p><a class="indexterm" name="id2623812"></a><a class="indexterm" name="id2623819"></a><a class="indexterm" name="id2623825"></a><a class="indexterm" name="id2623833"></a>慣れたMicrosoft Windowsユーザは、期待しているようにはSamba経由で共有されている、ファイル、ディレクトリと共有リソース操作が動かないことに、しばしば当惑する。Microsoft Windowsネットワーク管理者は、ネットワークのアクセス制御と、未認証のアクセスからリソースを保護する時に、ユーザが必要とするアクセスを提供する方法についてしばしば当惑している。</p><p><a class="indexterm" name="id2623853"></a><a class="indexterm" name="id2623861"></a>多くのUNIX管理者は、Microsoft Windows環境には慣れておらず、ファイルとディレクトリのアクセスパーミッションを設定しようとするMicrosoft Windowsユーザが望むことを図式化することに困難が生じている。</p><p><a class="indexterm" name="id2623881"></a><a class="indexterm" name="id2623888"></a><a class="indexterm" name="id2623895"></a><a class="indexterm" name="id2623902"></a>問題は、2つの環境の間で、ファイルとディレクトリのパーミッションと制御がどのように動くかの違いにある。この違いは、その大きな違いに橋を架けようとしても、Sambaが完全にはそれを隠せないということにある。</p><p><a class="indexterm" name="id2623921"></a><a class="indexterm" name="id2623928"></a><a class="indexterm" name="id2623937"></a><a class="indexterm" name="id2623944"></a>POSIX ACL技術は、現在有意義な使用の例があまりないにもかかわらず、長い期間UNIX用に(拡張属性と共に)提供されてきている。これは、商用Linux製品で、ACLの適用が遅い理由について、ある程度の説明になる。Microsoft Windows管理者にとっては、Microsoft Windows NTにおいて10年以上も前から基本的な機能としてACLが提供されていることを鑑みると、このことは驚くべきことである。</p><p><a class="indexterm" name="id2623965"></a>この章の目的は、Microsoft Windowsデスクトップユーザに対して、最も良い環境を提供するための、最適の方法を見つけるためにネットワーク管理者を手助けする、Samba-3で可能な、各制御の要点を提供することである。</p><p><a class="indexterm" name="id2623985"></a><a class="indexterm" name="id2623992"></a>これは、異なったOS環境での相互運用性とデータの交換を提供するためにSambaが作成したことを説明するのに良い機会である。SambaはMicrosoft WindowsのようなプラットフォームにUNIX/Linuxを変化させるつもりはない。その代わり、2つの環境間で、十分なレベルでデータの交換を提供することを目的としている。現在利用可能なものは、当初の計画と希望から大きく拡大していているが、それでもギャップは縮み続けている。</p><div class="sect1" title="機能と利便性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2624010"></a>機能と利便性</h2></div></div></div><p>	Sambaはファイルシステムアクセス管理に多くの自由度を提供する。現在のSambaでは	キーとなるアクセス制御機能が提供されている:	</p><div class="itemizedlist" title="Sambaアクセス制御機能"><p class="title"><b>Sambaアクセス制御機能</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>		<a class="indexterm" name="id2624035"></a>		<span class="emphasis"><em>UNIXのファイルとディレクトリのパーミッション</em></span>		</p><p><a class="indexterm" name="id2624054"></a><a class="indexterm" name="id2624062"></a><a class="indexterm" name="id2624069"></a>			SambaはUNIXファイルシステム制御を実装し、それを使う。Samba			サーバにアクセスするユーザは特定のMicrosoft Windowsユーザとして			そうする。この情報はログオンか接続のセットアップ手順の一部として			Sambaサーバに渡される。Sambaはこのユーザ識別情報を、ファイル			システムリソース(ファイルとディレクトリ)へのアクセス許可を与える			かどうかを検証するために使う。この章では、UNIXパーミッションと			制御が少々奇妙か未知な人について、概要を提供する。			</p></li><li class="listitem"><p>		<span class="emphasis"><em>Sambaの共有定義</em></span>		</p><p><a class="indexterm" name="id2624111"></a>			共有の設定と制御を<code class="filename">smb.conf</code>ファイル中で設定するとき、ネットワーク			管理者は本来のファイルシステムのパーミッションと動作を上書き設定			することが出来る。これはMicrosoft Windows NTユーザがより期待する			ような動作を引き起こすために有用かつ便利であるが、それに到達する			<span class="emphasis"><em>最も良い</em></span>方法は滅多にない。基本的なオプションと			テクニックはここで説明されている。			</p></li><li class="listitem"><p>		<span class="emphasis"><em>Sambaの共有のACL</em></span>		<a class="indexterm" name="id2624152"></a>		</p><p><a class="indexterm" name="id2624164"></a>			共有それ自身に対するACLの設定がMicrosoft Windows NTで可能なように、			Sambaでもそれは可能である。この機能を使う人は少ないが、アクセス			制御(制限)に影響を与えるために簡便な方法の一つとして残っている			ことと、他の方法と比較して最小の影響でしばしばそれを行うことが			できる。			</p></li><li class="listitem"><p>				<a class="indexterm" name="id2624187"></a>				<a class="indexterm" name="id2624196"></a>		<span class="emphasis"><em>UNIX POSIX ACLを経由したMicrosoft Windows ACL</em></span>		</p><p><a class="indexterm" name="id2624213"></a>			UNIX/Linux上でPOSIX ACLを使う場合は、ベースとなるOSがそれをサポート			している場合にのみ可能である。もしもそうでない場合、このオプションは			有効ではない。現在のUNIX技術基盤ではPOSIX ACLを標準サポートしている。			このサポートを提供するLinux kernelへのパッチも存在する。残念なことに、			Linuxプラットフォームの一部のみがネイティブなACLと拡張属性を有効にして			現時点で提供を行っている。この節では、それをサポートしているプラット			フォームのユーザに対する関連情報が記述されている。			</p></li></ul></div></div><div class="sect1" title="ファイルシステムのアクセス制御"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2624248"></a>ファイルシステムのアクセス制御</h2></div></div></div><p>おそらく、最も重要な認識される点は、UNIX OS環境で提供されているものと、Microsoft Windows NT4/200x/XPにおけるフィルシステムの技術の実装が完全に異なるという単純な事実である。最初に最も有意義な違いが何かを考え、次にその違いを乗り越えるためにSambaが何をしているかを見てみることにする。</p><div class="sect2" title="Microsoft Windows NTFSとUNIXファイルシステムとの比較"><div class="titlepage"><div><div><h3 class="title"><a name="id2624268"></a>Microsoft Windows NTFSとUNIXファイルシステムとの比較</h3></div></div></div><p>	<a class="indexterm" name="id2624278"></a>	<a class="indexterm" name="id2624284"></a>	<a class="indexterm" name="id2624292"></a>	<a class="indexterm" name="id2624301"></a>	SambaはUNIXファイルシステムの上で動作する。これは、UNIXファイルシステムの	取り決めとパーミッションの適用を受けることを意味する。また、もしも	Microsoft Windowsネットワーク環境がファイルシステムの動作を要求するならば、	それはUNIXファイルシステムの動作とは異なり、何らかの方法でSambaは透過的かつ	一貫した方法でエミュレートを行う。	</p><p>	Sambaがこれをかなりの部分、それらの最上位で、既定値の動作を上書きする高度な	オプションの設定を提供するという良いニュースがある。いくつかの上書きについて	説明はあるが、大部分は既定値の動作の範囲内にとどまっている。制御可能性の詳細な	点について知りたい場合は、<code class="filename">smb.conf</code>マニュアルページを調べること。	</p><p>以下では、UNIXファイルシステムの機能とMicrosoft Windows NT/200xを比較する:	<a class="indexterm" name="id2624346"></a>		</p><div class="variablelist"><dl><dt><span class="term">名前空間</span></dt><dd><p>		Microsoft Windows NT4/200x/XPのファイル名は254文字まで有効だが、UNIX		ファイル名は1023文字まで大丈夫かもしれない。Microsoft Windows中で、		ファイルの拡張子は特定のファイルタイプを意味する。UNIXではすべての名前が		任意であると考えられるので、これは厳格には見かけない。		</p><p>		Microsoft Windowsがフォルダと読んでいるものは、UNIXではディレクトリである。		</p></dd><dt><span class="term">大文字小文字の区別</span></dt><dd><p>		<a class="indexterm" name="id2624400"></a>		<a class="indexterm" name="id2624408"></a>		Microsoft Windowsファイル名は8.3形式(8文字のファイル名と3文字の拡張子)の		場合、一般的に大文字である。8.3形式より長いファイル名は、大小文字を保持		するが、それは無視される。		</p><p>		UNIXのファイルとディレクトリ名は大文字小文字を区別し、その状態は保存		される。SambaはMicrosoft Windowsファイル名の動作を実装しているが、それは		ユーザアプリケーションとしてである。UNIXファイルシステムは大文字小文字を		無視したファイル名の検索を実行する機能は提供していない。Microsoft Windows		はこれを既定値で行う。これは、UNIX OS環境で標準としては備わっていない		機能を提供するために、処理のオーバヘッドがかかってしまうと言うことである。		</p><p>		以下の例を考えてみる。以下はUNIX名としては一意だが、Microsoft Windows		ファイル名としては同一である:		</p><pre class="screen">				MYFILE.TXT				MyFile.txt				myfile.txt		</pre><p>		明らかに、Microsoft Windowsファイルの名前空間ではこれらの3つのファイルは		同時に存在できないが、UNIXではできる。		</p><p>		もしも上記3つがすべて存在していたときにSambaは何をすべきか?		辞書的に最初のものがMicrosoft Windowsユーザから見えるようにすることで		ある。残りは見えず、アクセスも出来ない。それ以外の解は自殺的		行為である。Windowsクライアントは大文字小文字を区別しないファイル検索を		要求するため、大文字小文字を区別しないファイルの一覧に一致する、		複数のファイルがあるUNIXディレクトリの場合、Sambaは一貫した選択方法を		提供しなければならないということになる。		</p></dd><dt><span class="term">ディレクトリの区切り文字</span></dt><dd><p>		<a class="indexterm" name="id2624513"></a>		Microsoft Windows とDOSはディレクトリの区切り文字としてバックスラッシュ		<code class="constant">\</code>を使い、UNIXでは通常のスラッシュ<code class="constant">/</code>		をディレクトリの区切り文字として使う。これはSambaによって透過的に扱われる。		</p></dd><dt><span class="term">ドライブの識別</span></dt><dd><p>		<a class="indexterm" name="id2624547"></a>		Microsoft Windows製品は、ディレクトリのパーティションを表現するために、		<code class="literal">C:</code>のようなドライブレターの概念を持つ。UNIXはファイルの		パーティションに対して分離された識別子を持つという概念がない。そのような		各ファイルシステムはディレクトリツリー全体の一部としてマウントされる。		UNIXディレクトリツリーは、<code class="constant">C:\</code>のような、DOSの		ドライブのrootを指定するような形で、<code class="constant">/</code>から始まる。		</p></dd><dt><span class="term">ファイル名に関する規則</span></dt><dd><p>		<a class="indexterm" name="id2624594"></a>		Microsoft Windowsは一般的に先頭がドット(<code class="constant">.</code>)で始まる		ファイル名は使わないがUNIXの場合、はユーザのホームディレクトリ中では		当たり前のように使われている。ドット(<code class="constant">.</code>)で始まる		ファイルは通常多くのUNIXアプリケーションの起動ファイルか、スタートアップ		設定データを含むファイルである。		</p></dd><dt><span class="term">リンクとショートカット</span></dt><dd><p>		<a class="indexterm" name="id2624633"></a>		<a class="indexterm" name="id2624642"></a>		<a class="indexterm" name="id2624652"></a>		Microsoft Windowsは、実際の位置にあるファイルに対してそのファイルを実行する		ためにリダイレクトを行う、特別なタイプのファイルとして振る舞う		<span class="emphasis"><em>リンクとショートカット</em></span>を使う。UNIXでは、ファイルと		ディレクトリのリンクを使うが、それはMicrosoft Windowsユーザが使っているもの		とは全く異なる。		</p><p>		シンボリックリンクは、UNIX中ではデータ(ファイル又はディレクトリ)の実際の		位置を含むファイルである。(読み出しあるいは書き込みのような)操作は参照		されたファイルに対して直接行われる。シンボリックリンクは		<span class="quote">“<span class="quote">ソフトリンク</span>”</span>としても参照される。ハードリンクはMicrosoft		Windowsではなじみのないものである。これは、1つの物理的なファイルを、複数の		ファイル名で同時に参照できるようにするものである。		</p></dd></dl></div><p>	Microsoft Windows管理者が、UNIX/Linuxを理解するようになるプロセス中で、一時的に	若干当惑することを引き起こすかもしれな微妙な違いがある。それらは、UNIX/Linuxの	トレーニングと教育の目的としての専用のテキストを見ると良い。	</p></div><div class="sect2" title="ディレクトリの管理"><div class="titlepage"><div><div><h3 class="title"><a name="id2624712"></a>ディレクトリの管理</h3></div></div></div><p><a class="indexterm" name="id2624720"></a><a class="indexterm" name="id2624727"></a><a class="indexterm" name="id2624734"></a>	ディレクトリ操作には3つの基本的な操作がある。それは<code class="literal">作成</code>,	<code class="literal">削除</code>,<code class="literal">改名</code>である。	<a class="link" href="AccessControls.html#TOSH-Accesstbl" title="Table 16.1. UNIXとWindowsによるディレクトリの管理">UNIXとWindowsによるディレクトリの管理</a>	では、WindowsとUNIX中でのコマンドにおける、上記の操作の実装について比較している。	</p><div class="table"><a name="TOSH-Accesstbl"></a><p class="title"><b>Table 16.1. UNIXとWindowsによるディレクトリの管理</b></p><div class="table-contents"><table summary="UNIXとWindowsによるディレクトリの管理" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">動作</th><th align="center">Microsoft Windowsのコマンド</th><th align="center">UNIXのコマンド</th></tr></thead><tbody><tr><td align="center">create</td><td align="center">md folder</td><td align="center">mkdir folder</td></tr><tr><td align="center">delete</td><td align="center">rd folder</td><td align="center">rmdir folder</td></tr><tr><td align="center">rename</td><td align="center">rename oldname newname</td><td align="center">mv oldname newname</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="ファイルとディレクトリのアクセス制御"><div class="titlepage"><div><div><h3 class="title"><a name="id2624844"></a>ファイルとディレクトリのアクセス制御</h3></div></div></div><p>	<a class="indexterm" name="id2624852"></a><a class="indexterm" name="id2624862"></a><a class="indexterm" name="id2624869"></a>	ネットワーク管理者は、ファイルとディレクトリのパーミッションのメンテナンスに	関連する、基本的なUNIX学習マニュアルとリファレンス資料を読むことを強く推奨する。	POSIX ACLや拡張属性(EA)のようなより複雑な機能に訴求しない基本的なUNIXの	パーミッションについて多くの説明がある。	</p><p>	UNIX/Linuxのファイルとディレクトリアクセスパーミッションは3つの主要なデータの設定と	1つの制御の設定がある。UNIXでのファイル一覧は下記のようになる:</p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>ls -la</code></strong>total 632drwxr-xr-x   13 maryo   gnomes      816 2003-05-12 22:56 .drwxrwxr-x   37 maryo   gnomes     3800 2003-05-12 22:29 ..dr-xr-xr-x    2 maryo   gnomes       48 2003-05-12 22:29 muchado02drwxrwxrwx    2 maryo   gnomes       48 2003-05-12 22:29 muchado03drw-rw-rw-    2 maryo   gnomes       48 2003-05-12 22:29 muchado04d-w--w--w-    2 maryo   gnomes       48 2003-05-12 22:29 muchado05dr--r--r--    2 maryo   gnomes       48 2003-05-12 22:29 muchado06drwsrwsrwx    2 maryo   gnomes       48 2003-05-12 22:29 muchado08----------    1 maryo   gnomes     1242 2003-05-12 22:31 mydata00.lst--w--w--w-    1 maryo   gnomes     7754 2003-05-12 22:33 mydata02.lst-r--r--r--    1 maryo   gnomes    21017 2003-05-12 22:32 mydata04.lst-rw-rw-rw-    1 maryo   gnomes    41105 2003-05-12 22:32 mydata06.lst<code class="prompt">$ </code></pre><p>	</p><p>	1行の中の各項目は(左から右に)パーミッション、ファイルのハードリンク数、所有者、	グループ、サイズ(バイト)、アクセス日付、最終更新日付とファイル名である。	</p><p>	パーミッション欄の概要は<a class="link" href="AccessControls.html#access1" title="Figure 16.1. UNIXパーミッション欄の概要">UNIXパーミッション欄の概要</a>	にある。	</p><div class="figure"><a name="access1"></a><p class="title"><b>Figure 16.1. UNIXパーミッション欄の概要</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/access1.png" width="216" alt="UNIXパーミッション欄の概要"></div></div></div><br class="figure-break"><p>		どのビットフラグもOFFにできる。OFFになったフラグは"できない"と同値で、		<span class="quote">“<span class="quote">-</span>”</span>文字で表現される(<a class="link" href="AccessControls.html#access2" title="Example 16.1. サンプルファイル">“サンプルファイル”</a>を参照)。<a class="indexterm" name="id2625016"></a><a class="indexterm" name="id2625023"></a><a class="indexterm" name="id2625030"></a><a class="indexterm" name="id2625036"></a><a class="indexterm" name="id2625043"></a><a class="indexterm" name="id2625050"></a>	</p><div class="example"><a name="access2"></a><p class="title"><b>Example 16.1. サンプルファイル</b></p><div class="example-contents"><pre class="programlisting">-rwxr-x---   意味:  ^^^                所有者(ユーザ)はこのファイルを読み、書き、実行できる。    ^^^             グループに属したユーザは読み、実行できる。       ^^^          それ以外のユーザはこのファイルに対して何も出来ない。</pre></div></div><br class="example-break"><p><a class="indexterm" name="id2625087"></a><a class="indexterm" name="id2625094"></a><a class="indexterm" name="id2625101"></a><a class="indexterm" name="id2625108"></a>	[タイプ]フィールドにはさらに別の意味もあり、それは、c = キャラクタデバイス、	b = ブロックデバイス、p = パイプデバイス、s = UNIXドメインソケットである。	</p><p><a class="indexterm" name="id2625126"></a><a class="indexterm" name="id2625133"></a><a class="indexterm" name="id2625140"></a><a class="indexterm" name="id2625146"></a><a class="indexterm" name="id2625153"></a>	文字<code class="constant">rwxXst</code>はユーザ、グループとその他に対して、読み出し(r)、	書き込み(w)、実行(あるいはディレクトリへのアクセス許可) (x)、ファイルが	ディレクトリかすでにあるユーザに対して実行許可を与えられた場合に実行可能(X)、	実行時にset user ID (SUID)か set group ID (SGID) (s)かスティッキー(t)である。	</p><p><a class="indexterm" name="id2625180"></a><a class="indexterm" name="id2625187"></a><a class="indexterm" name="id2625194"></a><a class="indexterm" name="id2625201"></a>	スティッキービットがディレクトリ上に設定された場合、そのディレクトリ内にある	ファイルは、rootか所有者のみunlink(削除)か改名できる。スティッキービットがない	場合、書き込み可能なディレクトリでは、誰でもファイルの削除や改名が出来る。	スティッキービットは、誰でも書き込み可能な、<code class="filename">/tmp</code>のような	ディレクトリでは一般的に使われる。	</p><p><a class="indexterm" name="id2625228"></a><a class="indexterm" name="id2625235"></a><a class="indexterm" name="id2625242"></a><a class="indexterm" name="id2625249"></a><a class="indexterm" name="id2625258"></a>	setuidやsetgidビットがディレクトリに設定された場合、その中に作成された	ファイルは、setuidビットsetgidビットのいずれが設定されたかに応じて、ディレクトリの	所有ユーザたはグループによって所有される。これは、あるグループに所属している	すべてのユーザがファイルの読み書きをできるようにすることが望ましく、これらの	ユーザが所属しているものと異なるプライマリグループを持つユーザが、該当の	ファイルを排他的に所有してしまうことが望ましくないようなディレクトリの	パーミッションを設定する際に有効なことがあろう。	</p><p>	ディレクトリが<code class="constant">d-wx--x---</code>に設定された時、所有者はその中の	ファイルを読んだり作成(書き込み)出来るが、読み出し(r)フラグが設定されていない	ので、だれも、ファイルの一覧を表示(見る)事が出来ない。グループに属するユーザは	そのディレクトリ中のファイルを読めるが新しいファイルは作成できない。もしも、	ディレクトリ中のファイルがグループに対して読み書き可能なように設定された場合、	グループメンバはそれらに書き込み(または削除)ができる。	</p><div class="sect3" title="ディレクトリとファイルの削除操作からの保護"><div class="titlepage"><div><div><h4 class="title"><a name="id2625322"></a>ディレクトリとファイルの削除操作からの保護</h4></div></div></div><p><a class="indexterm" name="id2625330"></a><a class="indexterm" name="id2625337"></a><a class="indexterm" name="id2625344"></a><a class="indexterm" name="id2625351"></a>	どのように、ユーザの削除操作から、ファイルやディレクトリを保護したらよいか、	という事についてSambaメーリングリストに質問が来ることがある。例えば、Windows NT/2K/XP	は、ディレクトリ配下に、ファイルを書くことは出来るが削除できないというアクセス制御を	設定する機能がある。これは、ファイルに書き込みは出来るが、削除は出来ないというACLを	Windows上で設定することで可能になる。このような考え方はUNIX OSファイル空間ではない。	UNIXファイルシステムでは、ファイルを作成出来るユーザはファイルに書き込みが出来る。	ファイルがあるディレクトリへの書き込み権があり、ファイルへの書き込み権があるユーザは	それを削除できてしまう。	</p><p><a class="indexterm" name="id2625392"></a><a class="indexterm" name="id2625399"></a><a class="indexterm" name="id2625406"></a>	確認ではあるが、UNIX環境では、ファイルの削除はそのファイルがいるディレクトリの	パーミッションによって制御される。別の言い方をすると、対象となるファイルの	所有者ではなくても、書き込み権があるユーザは、ディレクトリ中のファイルを	削除できる。	</p><p><a class="indexterm" name="id2625427"></a><a class="indexterm" name="id2625434"></a><a class="indexterm" name="id2625441"></a><a class="indexterm" name="id2625448"></a>	必要に応じて、SambaはホストOSのファイルシステムの構造を受け取る。Sambaは	Windows ACLを有効にすることについてと"最も最適な"POSIX ACLへの変換実行に	ついては、ファイルシステムの能力に制限される。いくつかのUNIXファイルシステム	では、拡張属性と呼ばれている機能をサポートしている。Windowsでの	<span class="emphasis"><em>継承</em></span>という概念のみ、適切な拡張属性を使ってSambaは	実装している。	</p><p><a class="indexterm" name="id2625473"></a><a class="indexterm" name="id2625480"></a><a class="indexterm" name="id2625487"></a><a class="indexterm" name="id2625494"></a>	拡張属性の特定の動作は、UNIXと例えばLinuxのようなUNIX風のシステム全体には	一貫していない。例えば、ディレクトリやファイルを削除操作から防ぐためのフラグを	セットすることは、拡張属性の特定の実装では可能である。これを達成する拡張属性は	<code class="constant">immutible</code>ビットと呼ばれている。残念なことに、immutible	フラグの実装は公開された文書とは一致していない。たとえば、SuSE Linux 9.2上の	<code class="literal">chattr</code>のマニュアルには:</p><pre class="screen">A file with the i attribute cannot be modified: it cannot be deletedor renamed, no link can be created to this file and no data can bewritten to the file. Only the superuser or a process possessing theCAP_LINUX_IMMUTABLE capability can set or clear this attribute.(訳: i 属性を持つファイルは変更できない:削除も改名もこのファイルへのリンク作成も出来ないし、このファイルへの書き込みも出来ない。スーパーユーザかCAP_LINUX_IMMUTABLE機能を所有するプロセスがこの属性を設定および削除できる)。</pre><p>	immutible flag が、Sambaが動いているファイルシステム上でサポートされているか、	簡単なテストは以下のように出来る。	</p><div class="procedure" title="Procedure 16.1. ファイルの Immutibilityサポートのテスト"><a name="id2625555"></a><p class="title"><b>Procedure 16.1. ファイルの Immutibilityサポートのテスト</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>	<code class="filename">filename</code>という名前のファイルを作成。	</p></li><li class="step" title="Step 2"><p>	<code class="constant">root</code>ユーザとしてログインし、以下のようにimmutibileフラグをテストファイルに設定:</p><pre class="screen"><code class="prompt">root# </code> chattr +i `filename'</pre><p>	</p></li><li class="step" title="Step 3"><p>	ファイルを所有しているユーザ(非root)でログインし、以下のようにしてファイル削除を試みてみる:</p><pre class="screen">mystic:/home/hannibal > rm filename</pre><p>	immutibleが正しく効いているならばファイル削除は出来なくなっている。	</p></li></ol></div><p>	immutible bitをサポートしているファイルシステムがあるOS上では、ディレクトリを	作成できるが削除できないようにするのは可能である。immutableディレクトリが書き込み	可能かどうかを、そのホストシステム上のマニュアルページでチェックすること。	もしも出来なければ、ディレクトリ全体とその内容は、書き込み(ファイル作成も)と	削除から効果的に保護される。	</p></div></div></div><div class="sect1" title="共有のアクセス制御の定義"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2625638"></a>共有のアクセス制御の定義</h2></div></div></div><p>	<a class="indexterm" name="id2625646"></a>	<code class="filename">smb.conf</code>セクション中の以下のパラメータは、共有の制御かアクセス制御の設定を	定義する。以下のオプションのどれかを使う前に、<code class="filename">smb.conf</code>のマニュアルページを	参照のこと。	</p><div class="sect2" title="ユーザとグループベースの制御"><div class="titlepage"><div><div><h3 class="title"><a name="id2625672"></a>ユーザとグループベースの制御</h3></div></div></div><p>	ユーザとグループベースの制御はとても便利なことがわかっている。ある特定の状態に	おいては、単一のユーザが行うような形で、すべてのファイルシステムへの操作を強制する	ことはとても望ましいことがある。<a class="link" href="smb.conf.5.html#FORCEUSER" target="_top">force user</a>と	<a class="link" href="smb.conf.5.html#FORCEGROUP" target="_top">force group</a>の動作を使うとこれを行う事ができる。	他の状態においては、特定の認証された人のみが共有またはその内容にアクセス出来る	ようにさせるような、偏執的なレベルの制御を使うことが必要かもしれない。これには、	<a class="link" href="smb.conf.5.html#VALIDUSERS" target="_top">valid users</a>か<a class="link" href="smb.conf.5.html#INVALIDUSERS" target="_top">invalid users</a>	パラメータが便利である。	</p><p>	いつものように、管理するためと、アクセスを制御する方法の不明確な点を最小化する、	一番簡単な方法を使うことを特に推奨する。覚えていてほしいが、状態をそのまま残すと、	他の誰かが手助けを提供する必要があり、もしもだれかが、あまりにも大きな混乱状態	を見つけるか、何をしていたかが理解できない場合、Sambaが削除され、別の解が適用	されてしまうと言う危険性が出てくる。	</p><p>	<a class="link" href="AccessControls.html#ugbc" title="Table 16.2. ユーザとグループベースの制御">ユーザとグループベースの制御</a>は上記の制御について列挙している。	</p><div class="table"><a name="ugbc"></a><p class="title"><b>Table 16.2. ユーザとグループベースの制御</b></p><div class="table-contents"><table summary="ユーザとグループベースの制御" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="center">制御パラメータ</th><th align="center">説明、動作、備考</th></tr></thead><tbody><tr><td align="left"><a class="link" href="smb.conf.5.html#ADMINUSERS" target="_top">admin users</a></td><td align="justify"><p>			共有に対して管理者権限を許可するユーザの一覧。そのユーザは			スーパーユーザ(root)と同様すべてのファイル操作ができる。			この一覧中のユーザは共有上でファイルのパーミッションに関わらず			何でも出来る。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#FORCEGROUP" target="_top">force group</a></td><td align="justify"><p>			このサービスに接続するすべてのユーザに既定値のプライマリグループ			として割り当てるUNIXのグループ名を指定する。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#FORCEUSER" target="_top">force user</a></td><td align="justify"><p>			このサービスに接続するすべてのユーザに既定値のユーザとして			割り当てるUNIXのユーザ名を指定する。			これは、ファイルの共有に便利である。間違って使うとセキュリティ			上の問題が発生する。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#GUESTOK" target="_top">guest ok</a></td><td align="justify"><p>			もしもパラメータがサービスに対して接続されたならば、サービスに			接続する時にパスワードが不要になる。権限は guestアカウントになる。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#INVALIDUSERS" target="_top">invalid users</a></td><td align="justify"><p>			このサービスにログイン出来ないユーザのリスト。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#ONLYUSER" target="_top">only user</a></td><td align="justify"><p>			接続を許可しないユーザ名の一覧。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#READLIST" target="_top">read list</a></td><td align="justify"><p>			サービスに対してリードオンリアクセスを許可するユーザの一覧。			この一覧中のユーザはリードオンリオプションがどのように設定			されていても、書き込み権はない。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#USERNAME" target="_top">username</a></td><td align="justify"><p>			詳細は<code class="filename">smb.conf</code>マニュアルページを参照。これは複雑で潜在的に			間違って使われるパラメータである。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#VALIDUSERS" target="_top">valid users</a></td><td align="justify"><p>			サービスにログイン出来るユーザの一覧。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#WRITELIST" target="_top">write list</a></td><td align="justify"><p>			サービスに読み書き可能なアクセスが出来るユーザの一覧。			</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="ファイルとディレクトリに対するパーミッションベースの制御"><div class="titlepage"><div><div><h3 class="title"><a name="id2626084"></a>ファイルとディレクトリに対するパーミッションベースの制御</h3></div></div></div><p>	ディレクトリパーミッションベースの制御は、間違って使った場合、間違った設定の	原因を診断するのにかなりの困難が生じる。控えめに、そして厳重に使うこと。	徐々に、1つずつ、おのおのを導入すると、好ましくない副作用が見つかるかもしれない。	問題発生時には、いつでもそれらをコメントアウトし、徐々に様子を見ながらそれらを	元に戻していく。	</p><p>	ファイルとディレクトリパーミッションベースのアクセス制御を使うためのパラメータに	関連する情報は、	<a class="link" href="AccessControls.html#fdpbc" title="Table 16.3. ファイルとディレクトリパーミッションベースの制御">ファイルとディレクトリパーミッションベースの制御</a>	を参照のこと。	</p><div class="table"><a name="fdpbc"></a><p class="title"><b>Table 16.3. ファイルとディレクトリパーミッションベースの制御</b></p><div class="table-contents"><table summary="ファイルとディレクトリパーミッションベースの制御" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="center">制御パラメータ</th><th align="center">説明、動作、備考</th></tr></thead><tbody><tr><td align="left"><a class="link" href="smb.conf.5.html#CREATEMASK" target="_top">create mask</a></td><td align="justify"><p>			<code class="filename">smb.conf</code>マニュアルページを参照のこと			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#DIRECTORYMASK" target="_top">directory mask</a></td><td align="justify"><p>			UNIXディレクトリを作成する時に、DOSのモードをUNIXのモードに			変換する時に使う8進のモード値。directory security maskも参照。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#DOSFILEMODE" target="_top">dos filemode</a></td><td align="justify"><p>			このパラメータを有効にすると、ファイルに書き込み権があるユーザに			そのパーミッションの変更を許可する。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#FORCECREATEMODE" target="_top">force create mode</a></td><td align="justify"><p>			このパラメータは、Sambaによって作成されたファイル上に常時設定			されるUNIXモードのビット単位のパーミッションを指定する。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#FORCEDIRECTORYMODE" target="_top">force directory mode</a></td><td align="justify"><p>			このパラメータは、Sambaによって作成されたディレクトリ上に常時設定			されるUNIXモードのビット単位のパーミッションを指定する。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#FORCEDIRECTORYSECURITYMODE" target="_top">force directory security mode</a></td><td align="justify"><p>			Windows NTクライアントがディレクトリ上のUNIXパーミッションを操作			する時に変更されるUNIXパーミッションビットを制御する。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#FORCESECURITYMODE" target="_top">force security mode</a></td><td align="justify"><p>			Windows NTクライアントがUNIXパーミッションを操作する時に変更			されるUNIXパーミッションビットを制御する。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#HIDEUNREADABLE" target="_top">hide unreadable</a></td><td align="justify"><p>			読めないファイルを、クライアントから見えなくする。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#HIDEUNWRITEABLEFILES" target="_top">hide unwriteable files</a></td><td align="justify"><p>			書き込めないファイルをクライアントから見えなくする。書き込めない			ディレクトリは通常通り見える。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#NTACLSUPPORT" target="_top">nt acl support</a></td><td align="justify"><p>			このパラメータはsmbdがUNIXパーミッションをWindows NT ACLにマップ			するかどうかを制御する。			</p></td></tr><tr><td align="left"><a class="link" href="smb.conf.5.html#SECURITYMASK" target="_top">security mask</a></td><td align="justify"><p>			Windows NTクライアントがファイル上のUNIXパーミッションを操作する			時に変更されるUNIXパーミッションビットを制御する。			</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="その他の制御"><div class="titlepage"><div><div><h3 class="title"><a name="id2626465"></a>その他の制御</h3></div></div></div><p>	<a class="link" href="AccessControls.html#mcoc" title="Table 16.4. 他の制御">他の制御</a>中に記載があるパラメータはファイルアクセスへの	不注意によるバリアを作成する方向で、管理者によってしばしば使われる。それらは、	<code class="filename">smb.conf</code>のファイル設定の完全な影響がわからない結果である。The parameters documented in <a class="link" href="AccessControls.html#mcoc" title="Table 16.4. 他の制御">Other Controls</a> are often used by administrators	in ways that create inadvertent barriers to file access. Such are the consequences of not understanding the 	full implications of <code class="filename">smb.conf</code> file settings.	</p><div class="table"><a name="mcoc"></a><p class="title"><b>Table 16.4. 他の制御</b></p><div class="table-contents"><table summary="他の制御" border="1"><colgroup><col align="justify"><col align="justify"></colgroup><thead><tr><th align="center">制御パラメータ</th><th align="center">説明、動作、備考</th></tr></thead><tbody><tr><td align="justify">			<a class="link" href="smb.conf.5.html#CASESENSITIVE" target="_top">case sensitive</a>,			<a class="link" href="smb.conf.5.html#DEFAULTCASE" target="_top">default case</a>,			<a class="link" href="smb.conf.5.html#SHORTPRESERVECASE" target="_top">short preserve case</a>			</td><td align="justify"><p>			これは、すべてのファイル名検索を大文字小文字を意識した形で行う			事を意味する。Microsoft Windowsくらい亜入おから受け取った正確な			名前で、ファイルはSambaによって作成される。			</p></td></tr><tr><td align="justify"><a class="link" href="smb.conf.5.html#CSCPOLICY" target="_top">csc policy</a></td><td align="justify"><p>			クライアントサイトのキャッシングポリシーは、Microsoft Windowsの			クライアントサイドのファイルキャッシング機能に類似している。			</p></td></tr><tr><td align="justify"><a class="link" href="smb.conf.5.html#DONTDESCEND" target="_top">dont descend</a></td><td align="justify"><p>			常時空白としてサーバが見せる、カンマで分離されたディレクトリ一覧を指定する。			</p></td></tr><tr><td align="justify"><a class="link" href="smb.conf.5.html#DOSFILETIMERESOLUTION" target="_top">dos filetime resolution</a></td><td align="justify"><p>			このオプションは、Samba共有に対して、主にVisual C++との互換オプションとして使われる。			</p></td></tr><tr><td align="justify"><a class="link" href="smb.conf.5.html#DOSFILETIMES" target="_top">dos filetimes</a></td><td align="justify"><p>			ファイルに書き込みが出来るときにDOSとWindowsは、ユーザにファイルの			時刻変更を許可する。POSIXでの流儀ではこれは出来ない。このオプションは			DOSとWindowsの流儀を許可する。			</p></td></tr><tr><td align="justify"><a class="link" href="smb.conf.5.html#FAKEOPLOCKS" target="_top">fake oplocks</a></td><td align="justify"><p>			Oplocksは、SMBクライアントがサーバから、ファイル操作をローカルに			キャッシュする許可を得る方法である。もしもサーバがoplockを許可			すると、クライアントは、ファイルへのアクセスが唯一であると仮定			することから自由になり、ファイルのデータをより頻繁にキャッシュする。			</p></td></tr><tr><td align="justify">			<a class="link" href="smb.conf.5.html#HIDEDOTFILES" target="_top">hide dot files</a>,			<a class="link" href="smb.conf.5.html#HIDEFILES" target="_top">hide files</a>,			<a class="link" href="smb.conf.5.html#VETOFILES" target="_top">veto files</a>			</td><td align="justify"><p>			注意:Microsoft Windowsエクスプローラはhiddenが設定されたファイルの			状態を無視するので、結局それは見えてしまう。			</p></td></tr><tr><td align="justify"><a class="link" href="smb.conf.5.html#READONLY" target="_top">read only</a></td><td align="justify"><p>			このパラメータがyesの場合、サービスのユーザはサービスのディレクトリ			中のファイルを作成又は変更できない。			</p></td></tr><tr><td align="justify"><a class="link" href="smb.conf.5.html#VETOFILES" target="_top">veto files</a></td><td align="justify"><p>			見えないか、アクセスできないファイルとディレクトリの一覧。			</p></td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="sect1" title="共有のアクセス制御"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2626855"></a>共有のアクセス制御</h2></div></div></div><p><a class="indexterm" name="id2626863"></a><a class="indexterm" name="id2626870"></a><a class="indexterm" name="id2626878"></a><a class="indexterm" name="id2626885"></a>	<a class="indexterm" name="id2626892"></a>	この節では、Sambaの共有単位でのアクセス制御における制限の設定方法について取り	扱う。既定値では、Sambaは共有自身には何らの制限も設定しない。共有自身への	制限は、Microsoft Windows NT4/200x/XP共有上で設定出来る。これは、共有に	接続する人を効果的に制限できる方法である。特定の制限がない場合、既定値の	設定はグローバルユーザに対して<code class="constant">Everyone - フルコントロール</code>	(フルコントロール、変更と読み出し)である。	</p><p><a class="indexterm" name="id2626922"></a><a class="indexterm" name="id2626929"></a><a class="indexterm" name="id2626935"></a>	現時点ではSambaは共有上のアクセス制御の設定を行うためのツールを提供していない	ので、それらの設定を作成する唯一の方法は、NT4のサーバマネージャか	Windows 200xの、コンピュータの管理のための、Microsoftマネジメントコンソール	(MMC)を使うことである。Sambaのコマンドラインツールでこの機能を提供することは	現時点では予定されていない。	</p><p><a class="indexterm" name="id2626956"></a><a class="indexterm" name="id2626963"></a><a class="indexterm" name="id2626970"></a><a class="indexterm" name="id2626977"></a>	Sambaは<code class="filename">share_info.tdb</code>というファイル中に共有単位のアクセス	制御の設定を格納する。サーバ上にこのファイルがある場所は、Sambaがコンパイル	された状態に依存する。Sambaのtdbファイルがある既定値の位置は、	<code class="filename">/usr/local/samba/var</code>配下である。もしも<code class="filename">tdbdump</code>	ユーティリティがコンパイルされシステム中にインストールされているならば、	tdbファイルがあるディレクトリ中で<code class="literal">tdbdump share_info.tdb</code>を	実行する事によってこのファイルの内容を検査することが出来る。	</p><div class="sect2" title="共有のパーミッションの管理"><div class="titlepage"><div><div><h3 class="title"><a name="id2627021"></a>共有のパーミッションの管理</h3></div></div></div><p>		共有のパーミッションの管理を行うための最適のツールはプラットフォーム		依存である。環境に応じて最適のツールを選択されたい。		</p><div class="sect3" title="Windows NT4 Workstation/Server"><div class="titlepage"><div><div><h4 class="title"><a name="id2627036"></a>Windows NT4 Workstation/Server</h4></div></div></div><p><a class="indexterm" name="id2627044"></a><a class="indexterm" name="id2627052"></a><a class="indexterm" name="id2627059"></a><a class="indexterm" name="id2627066"></a>			Windows NT4 ワークステーションかサーバからSambaサーバ上の			共有のパーミッションを管理するのに必要なツールは、			NT サーバマネージャである。サーバマネージャはWindows NT4			サーバ製品とともに出荷されているが、Windows NT4ワークステーション			には付いていない。Microsoft Windows NT4 ワークステーション			用のNT サーバマネージャは、MicrosoftのWebサイト			<a class="ulink" href="http://support.microsoft.com/default.aspx?scid=kb;en-us;173673" target="_top">support</a>			から入手できる(訳注:日本語版は<a class="ulink" href="http://support.microsoft.com/default.aspx?scid=kb;ja-jp;173673" target="_top">こちらから</a>)。			</p><div class="procedure" title="Procedure 16.2. 手順"><a name="id2627100"></a><p class="title"><b>Procedure 16.2. 手順</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>			<span class="application">NT4 サーバマネージャ</span>を起動し、管理			したいSambaサーバをクリックする。メニューから			<span class="guimenu">コンピュータ</span>を選択し、			<span class="guimenuitem">共有ディレクトリ</span>をクリックする。			</p></li><li class="step" title="Step 2"><p>			管理したい共有をクリックし、次に<span class="guilabel">プロパティ</span>			タブをクリックし、<span class="guilabel">パーミッション</span>タブを			クリックする。これで、アクセス制御を追加/変更できるようになる。			</p></li></ol></div></div><div class="sect3" title="Windows 200x/XP"><div class="titlepage"><div><div><h4 class="title"><a name="id2627159"></a>Windows 200x/XP</h4></div></div></div><p><a class="indexterm" name="id2627167"></a><a class="indexterm" name="id2627174"></a><a class="indexterm" name="id2627181"></a><a class="indexterm" name="id2627188"></a>			<span class="application">Microsoft Windows NT4/200x/XP</span>上では、			共有のACLはMicrosoftエクスプローラのようなツールで設定する。			たとえば、Windows 200xでは、共有フォルダを右クリックし、次に、			<span class="guimenuitem">共有</span>を選択し、次に			<span class="guilabel">パーミッション</span>をクリックする。			Windows NT4/200xでの既定値のパーミッションはグループ			"Everyone"が共有に対してフルコントロールを持つようになっている。			</p><p><a class="indexterm" name="id2627223"></a><a class="indexterm" name="id2627230"></a><a class="indexterm" name="id2627237"></a>			Microsoft Windows 200xとそれ以降のバージョンでは、MMCに対して			<span class="application">コンピュータの管理</span>スナップインと			呼ばれるツールが提供されている。このツールは、			<span class="guimenu">コントロールパネル->管理ツール->コンピュータの管理</span>			経由でアクセス出来る。			</p><div class="procedure" title="Procedure 16.3. 手順"><a name="id2627265"></a><p class="title"><b>Procedure 16.3. 手順</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>			MMCのコンピュータマネジメントスナップインを起動後、メニュー項目			<span class="guimenuitem">操作(A)</span>をクリックし、			<span class="guilabel">別のコンピュータに接続(C)</span>を選択する。もしも、			ドメインにログオンしていない場合、ドメインログオンユーザ名と			パスワードを聞いてくるので入力する。それでドメインの認証を行う。			もしも管理者権限でログインしているならば、このステップは省略される。			</p></li><li class="step" title="Step 2"><p>			もしも、Sambaサーバが<span class="guilabel">コンピュータを選択</span>			ボックス中に表示されていないならば、<span class="guilabel">Name:</span>			フィールド中に対象のSambaサーバの名前を入力する。次に			<span class="guilabel">システムツール</span>のそばにある			<span class="guibutton">[+]</span>をクリックし、左パネル中の			<span class="guilabel">共有フォルダ</span>のそばにある			<span class="guibutton">[+]</span>をクリックする。			</p></li><li class="step" title="Step 3"><p><a class="indexterm" name="id2627361"></a>			右パネル中でアクセス制御のパーミッションを設定したい共有上で			右クリックする。次に、<span class="guilabel">共有のパーミッション</span>			を右クリックする。これで、小浮遊フォルダにアクセス制御			エンティティを追加できる。各エントリに割り当てたいアクセスの			タイプ(フルコントロール、変更、読み込み)を覚えておくこと。			</p></li></ol></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>			注意深く作業する必要がある。このユーザを削除しないで			<code class="constant">Everyone</code>ユーザからすべてのパーミッションを			取り去ると、この共有に対しては誰もアクセス出来なくなる。これは			ACLの優先順位として知られていることの結果である。Everyoneに			対して<span class="emphasis"><em>アクセス権なし</em></span>ということは、			<code class="constant">Everyone</code>のグループに属している			<code class="constant">MaryK</code>というユーザは、明示的な、フルアクセス			の権利を与えられたとしても、アクセスできない。			</p></div></div></div></div><div class="sect1" title="Microsoft Windowsのアクセス制御リストとUNIXとの相互運用性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2627425"></a>Microsoft Windowsのアクセス制御リストとUNIXとの相互運用性</h2></div></div></div><div class="sect2" title="NTセキュリティダイアログを使用したUNIXパーミッションの管理"><div class="titlepage"><div><div><h3 class="title"><a name="id2627433"></a>NTセキュリティダイアログを使用したUNIXパーミッションの管理</h3></div></div></div><p>		<a class="indexterm" name="id2627443"></a>		Windows NTクライアントは、基盤となるUNIXパーミッションを表示したり変更		するための、ネイティブなセキュリティ設定ダイアログボックスを使うことが		できる。		</p><p>		この機能は、Sambaが動作しているUNIXホストのセキュリティを危うくしない		ように留意し、かつ、Samba管理者が設定出来るすべてのファイル		パーミッションルールに依然として従う。		</p><p>		SambaはPOSIX ACLの範囲内で動くので、種々の、Windowsで提供されている		よりきめ細かいアクセス制御は実際の所無視される。		</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>		Samba経由での、UNIX/LinuxシステムファイルへのすべてのアクセスはOSの		ファイルアクセス制御によって制御される。ファイルアクセスの問題を理解		しようとする時、Sambaによってファイルアクセスを行う時に提供されるWindows		ユーザの識別子を見つけることはきわめて重要である。これは、Sambaのログ		ファイルから見つけるのが最も良い。		</p></div></div><div class="sect2" title="Samba共有上でのファイルセキュリティの表示"><div class="titlepage"><div><div><h3 class="title"><a name="id2627501"></a>Samba共有上でのファイルセキュリティの表示</h3></div></div></div><p>		NT4/200x/XPクライアントからSambaでマウントしたドライブレターかUNCパス		中のファイルかディレクトリのどれかを右クリックする。メニューがポップ		アップするのでメニューの最下部にある<span class="guilabel">プロパティ</span>		エントリをクリックする。この動作でファイルの<span class="guilabel">プロパティ</span>		ダイアログボックスが上がってくる。<span class="guilabel">セキュリティ</span>タブを		クリックすると3つのボタンが表示される:<span class="guibutton">アクセス許可</span>、		<span class="guibutton">監査</span>と<span class="guibutton">所有者</span>である。		<span class="guibutton">監査</span>ボタンは、ユーザがNTの管理者でない場合、		<span class="errorname">"要求された権限をクライアントが持っていません(A requested privilege is not held by the client)"</span>		というエラーメッセージを表示するか、ユーザがNT管理者としてログオンしている		場合、ファイルに対する監査要求を追加するために、管理者に許可を行う		ダイアログを表示する。このダイアログは現時点ではSamba共有には機能しない		ので、唯一使えるボタンである <span class="guibutton">追加</span>ボタンは、		表示されているユーザの一覧を現時点では許可出来ない。		</p></div><div class="sect2" title="ファイルの所有者の表示"><div class="titlepage"><div><div><h3 class="title"><a name="id2627595"></a>ファイルの所有者の表示</h3></div></div></div><p>		<span class="guibutton">所有者</span>ボタンをクリックすると、ダイアログボックスが		表示され、そのファイルの所有者を表示する。所有者は以下のように表示される:		</p><pre class="screen">		<code class="constant">SERVER\user (長い名前)</code>		</pre><p>		ここで<em class="replaceable"><code>SERVER</code></em>はSambaサーバのNetBIOS名である。		<em class="replaceable"><code>user</code></em>はこのファイルを所有しているUNIXユーザ		のユーザ名であり、<em class="replaceable"><code>(長い名前)</code></em>はユーザを識別		するための説明文字列である(通常はUNIXパスワードデータベースのGECOS		フィールドが使われる)。<span class="guibutton">閉じる</span>ボタンをクリック		して、このダイアログを閉じる。		</p><p>		もしも<a class="link" href="smb.conf.5.html#NTACLSUPPORT" target="_top">nt acl support</a>パラメータが		<code class="constant">false</code>に設定されているならば、ファイルの所有者は		NTユーザの<span class="emphasis"><em>Everyone</em></span>として表示される。		</p><p><a class="indexterm" name="id2627674"></a>		<span class="guibutton">所有権の取得</span>ボタンでは異動したい先の人がこの		ファイルの所有権を取得することは出来ない(それをクリックすると、現在		NTクライアントにログオンしているユーザが見つからないということを通知する		ダイアログボックスが表示される)。この理由は、ファイルの所有者の変更は、		UNIX上では特権操作であり、<span class="emphasis"><em>root</em></span>ユーザにのみ許可されて		いるからである。このボタンをクリックすると、NTに対してNTクライアントに		ログオンしている現在のユーザにファイルの所有者を変更するようにNTに指示		するが、これは現時点ではSambaでは動作しない。		</p><p><a class="indexterm" name="id2627718"></a><a class="indexterm" name="id2627725"></a><a class="indexterm" name="id2627732"></a>		NTにある<code class="literal">chown</code>コマンドはSambaでも動作し、rootとして		Sambaサーバに接続している管理者権限を持つユーザに、ローカルのNTFSファイル		システムとリモートマウントしたNTFSかSambaドライブの両方のファイルの所有者		の変更を許可する。これは、Sambaチームの一員であるJeremy Allisonによって		書かれたNTセキュリティライブラリである<span class="application">Seclib</span>の		一部として提供されていて、これはSambaのFTPサイトからダウンロードできる。		</p></div><div class="sect2" title="ファイルとディレクトリのパーミッションの表示"><div class="titlepage"><div><div><h3 class="title"><a name="id2627769"></a>ファイルとディレクトリのパーミッションの表示</h3></div></div></div><p>		3番目のボタンは<span class="guibutton">アクセス許可</span>である。これをクリックすると、		パーミッションとファイルかディレクトリのUNIXでの所有者の両方を表示する		ダイアログボックスが起動する。所有者は以下のように表示される:		</p><p><code class="literal"><em class="replaceable"><code>SERVER</code></em>\				<em class="replaceable"><code>user</code></em> 				<em class="replaceable"><code>(長い名前)</code></em></code></p><p><em class="replaceable"><code>SERVER</code></em>はSambaサーバのNetBIOS名であり、		<em class="replaceable"><code>user</code></em>はファイルを所有しているUNIXユーザの		ユーザ名であり、<em class="replaceable"><code>(長い名前)</code></em>は、ユーザを識別		する説明文字列である(通常はUNIXパスワードデータベースのGECOSフィールドが		使われる)。</p><p>		もしも<a class="link" href="smb.conf.5.html#NTACLSUPPORT" target="_top">nt acl support</a>パラメータが		<code class="constant">false</code>に設定されている場合、ファイルの所有者は		<code class="constant">Everyone</code>というNTユーザとして表示され、パーミッション		はNTの<span class="emphasis"><em>フルコントロール</em></span>として表示される。		</p><p>		パーミッション欄はファイルとディレクトリでは異なって表示される。詳細は次項で説明する。		</p><div class="sect3" title="ファイルのパーミッション"><div class="titlepage"><div><div><h4 class="title"><a name="id2627861"></a>ファイルのパーミッション</h4></div></div></div><p>		標準のUNIXユーザ/グループ/その他の三つ組みと、それに対応する		<code class="constant">読み、書き、実行</code>パーミッションの三つ組みは、Sambaによって		<span class="quote">“<span class="quote">r</span>”</span>, <span class="quote">“<span class="quote">w</span>”</span>, と <span class="quote">“<span class="quote">x</span>”</span>ビットが対応するNT		パーミッションにマップされる、NT ACLのパーミッションの3つの要素にマップされる。		UNIXの「その他」パーミッションは、UNIXの世界で許可されるパーミッションのリストを		伴ってグローバルNTグループの<code class="constant">Everyone</code>にマップされる。		UNIXの所有者とグループパーミッションは、それぞれUNIXのユーザとグループに		許可されるパーミッションのリストを伴って、NTの<span class="guiicon">ユーザ</span>アイコンと		NTの<span class="guiicon">ローカルグループ</span>アイコンとして表示される。		</p><p>		多くのUNIXパーミッションのセットが、たとえば<code class="constant">読み込み</code>、		<code class="constant">変更</code>, あるいは <code class="constant">フルコントロール</code>		のような共通のNTの名前にマップしないという理由で、通常パーミッションは		NTの表示リスト中で<code class="constant">特殊なアクセス許可</code>という単語が		前に付く。		</p><p>		しかし、もしもファイルに、特定のUNIXユーザ、グループ、その他に対して何も		許可しないパーミッションが付いているとどうなるだろうか?		<span class="emphasis"><em>アクセス権なし</em></span>を見えるように、かつ変更できるように		するため、Sambaは<code class="constant">所有権の取得</code>というNTのACL属性を		上書きし(UNIXでは何の意味もない)、NTの<code class="literal">O</code>ビットを設定		して、アクセス権なしというコンポーネントを報告する。これはもちろん、		それを0のようにするために選ばれ、結局アクセス権なしの意味になる。		この動作の背景にある結論についての詳細は、以下に記述がある。		</p></div><div class="sect3" title="ディレクトリのパーミッション"><div class="titlepage"><div><div><h4 class="title"><a name="id2627983"></a>ディレクトリのパーミッション</h4></div></div></div><p>		NT NTFSファイルシステム上のディレクトリは、2つの異なったパーミッションの		組を持っている。最初の組は、通常の<code class="constant">RW</code> NT形式中での		最初の括弧の組中に表示される、ディレクトリそれ自身上のACLセットである。		このパーミッションの最初の組は通常のファイルのパーミッションに対して、		上記で説明があったようなのと正確に同じ方式で、Sambaによって作成され、		同じ方法で表示される。		</p><p>		2番目のディレクトリパーミッションの組はUNIXパーミッションの世界では実際の		意味を持たず、このディレクトリが継承する範囲内で作成された任意のファイルの		<code class="constant">継承された</code>パーミッションを表す。		</p><p>		SambaはNT用にそれら継承されたパーミッションをまとめ、NT ACLとして返すので、		Sambaによって新しく作成されたこの共有のUNIXパーミッションモードを		受け取れる。		</p></div></div><div class="sect2" title="ファイルまたはディレクトリのパーミッションの変更"><div class="titlepage"><div><div><h3 class="title"><a name="id2628040"></a>ファイルまたはディレクトリのパーミッションの変更</h3></div></div></div><p>	ファイルとディレクトリのパーミッションの変更はダイアログボックス中に表示された	パーミッションの変更と同じくらい簡単で、<span class="guibutton">OK</span>をクリック	すればよい。しかし、ユーザが認識する必要がある制限があり、また、Samba標準の	パーミッションマスクと注意を払わなければならない事も必要なDOS属性のマッピング	も相互に影響する。	</p><p>	もしも、<a class="link" href="smb.conf.5.html#NTACLSUPPORT" target="_top">nt acl support</a>パラメータが<code class="constant">false</code>	ならば、<span class="errorname">"アクセスが拒否されました"</span>というメッセージが	出力されて、セキュリティパーミッションを設定することは失敗する。	</p><p>	最初に注意することは、<span class="guibutton">追加</span>ボタンはSamba中のユーザの一覧を	返さない事である(<span class="errorname">"リモートプロ子ジャーコールは失敗し、実行出来ませんでした"</span>	というエラーメッセージが表示される)。これは、ダイアログボックス中に一覧表示されて	いる、現在のユーザ/グループ/その他 のパーミッションのみを操作できると言うことで	ある。これらはUNIXが実際に持っているパーミッションのみなので、これは実際にちゃん	と動く。	</p><p>	もしもパーミッションの三つ組み(ユーザ、グループかその他のどれか)がNTダイアログ	ボックス中でパーミッションのリストから削除されたならば、<span class="guibutton">OK</span>	ボタンが押されたとき、UNIXサイド上では<span class="emphasis"><em>パーミッションなし</em></span>	状態になる。もしもサイドパーミッションを表示させると、NTの<code class="literal">O</code>	フラグとして、上記で説明したように<span class="emphasis"><em>パーミッションなし</em></span>が表示	される。これはパーミッションの三つ組から取り去ったものをファイルかディレクトリに	もういちど戻すためにパーミッションを追加できるようにする。	</p><p>	UNIXはNT ACLの<span class="quote">“<span class="quote">r</span>”</span>, <span class="quote">“<span class="quote">w</span>”</span>, と <span class="quote">“<span class="quote">x</span>”</span>ビットのみを	サポートするため、もしも、<code class="constant">削除</code>のような他のセキュリティ属性が	選択された場合、Sambaサーバ上に適用するときには無視される。	</p><p>	ディレクトリにパーミッションを設定する場合、2番目のパーミッションの組(括弧の組の	二番目)は既定値でディレクトリ中のすべてのファイルに適用される。もしも、これが	やりたいことではない場合、NTダイアログボックス中の	<span class="guilabel">Replace permissions on existing files</span>チェックボックスの	チェックを、<span class="guibutton">OK</span>ボタンを押す前に外さなければならない。	</p><p>	もしもすべてのパーミッションを、ユーザ/グループ/その他から取り去りたい場合、	コンポーネントをハイライトさせ、<span class="guibutton">削除</span>ボタンをクリック	するか、特別な<code class="constant">所有権の取得</code>パーミッション(<code class="literal">O</code>として表示される)のみををハイライトさせてもよい。	</p></div><div class="sect2" title="標準的なSambaの“create mask”パラメータとの相互作用"><div class="titlepage"><div><div><h3 class="title"><a name="id2628239"></a>標準的なSambaの<span class="quote">“<span class="quote">create mask</span>”</span>パラメータとの相互作用</h3></div></div></div><p>標準的なSambaの<em class="parameter"><code>create mask</code></em>パラメータとの相互作用を制御する4つのパラメータがある:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="smb.conf.5.html#SECURITYMASK" target="_top">security mask</a></p></li><li class="listitem"><p><a class="link" href="smb.conf.5.html#FORCESECURITYMODE" target="_top">force security mode</a></p></li><li class="listitem"><p><a class="link" href="smb.conf.5.html#DIRECTORYSECURITYMASK" target="_top">directory security mask</a></p></li><li class="listitem"><p><a class="link" href="smb.conf.5.html#FORCEDIRECTORYSECURITYMODE" target="_top">force directory security mode</a></p></li></ul></div><p>	</p><p>	ユーザがパーミッションを適用するために<span class="guibutton">OK</span>をクリックした	時、Sambaは与えられたパーミッションを、ユーザ/グループ/その他のr/w/x三つ組	にマップし、次に<a class="link" href="smb.conf.5.html#SECURITYMASK" target="_top">security mask</a>パラメータ中で設定された	ビットに対し、ファイルに対して変更されたパーミッションを検査する。このパラメータ	中で<span class="emphasis"><em>1</em></span>に設定されていない変更されたすべてのビットは、ファイル	パーミッション中でそのまま残る。</p><p>	本質的に、<a class="link" href="smb.conf.5.html#SECURITYMASK" target="_top">security mask</a>中のゼロビットは、ユーザが	変更を許可しないビットの組として、1のビットは変更を認めるビットとして扱っても	よい。	</p><p>	もしも明示的に設定されていない場合、このパラメータは既定値として	<a class="link" href="smb.conf.5.html#CREATEMASK" target="_top">create mask</a>パラメータと同じ値になる。ユーザにファイル	上のすべてのユーザ/グループ/その他 のパーミッションの設定変更を許可したいならば、	この値を0777にする。	</p><p>	次にSambaは、<a class="link" href="smb.conf.5.html#FORCESECURITYMODE" target="_top">force security mode</a>パラメート中で設定された	ビットに対して、ファイルのパーミッションの変更点をチェックする。このパラメータ	中で<span class="emphasis"><em>1</em></span>に設定されたものに対応する、変更された任意のビットは、	強制的にセットされる。</p><p>	基本的に、<em class="parameter"><code>force security mode</code></em>パラメータ中でビットを設定	することは、ファイル上のセキュリティを変更する時、ユーザが常時<span class="emphasis"><em>on</em></span>	に設定するとして、ビットのまとまりを扱っても良い。</p><p>	もしも、明示的に設定されない場合、このパラメータの既定値は、	<a class="link" href="smb.conf.5.html#FORCECREATEMODE" target="_top">force create mode</a>パラメータでの値と同じになる。	何の制限もなしにすべてのユーザ/グループ/その他のパーミッションの変更を許可したい	ならば、このパラメータを000に設定する。	<a class="link" href="smb.conf.5.html#SECURITYMASK" target="_top">security mask</a>と<em class="parameter"><code>force security mode</code></em>	パラメータはその順で、変更要求のために適用される。</p><p>	ディレクトリには、<em class="parameter"><code>security mask</code></em>の代わりに	<em class="parameter"><code> directory security mask</code></em>を、	<em class="parameter"><code>force security mode</code></em>の代わりに	<em class="parameter"><code>force directory security mode</code></em>パラメータを使う点を除いて、	上記で説明したファイルへの操作と同じ動作をSambaは実行する。</p><p>	<a class="link" href="smb.conf.5.html#DIRECTORYSECURITYMASK" target="_top">directory security mask</a>パラメータの既定値は、	<em class="parameter"><code>directory mask</code></em>パラメータと同じ値に設定され、	<em class="parameter"><code>force directory security mode</code></em>パラメータの既定値は、	<a class="link" href="smb.conf.5.html#FORCEDIRECTORYMODE" target="_top">force directory mode</a>パラメータと同じ値に設定される。	この方法で、その制限内で引き続きパーミッションビットをユーザに変更許可する	間、Samba共有上で管理者が設定出来るパーミッションの制限を実施する。</p><p>	もしも、ファイルとディレクトリ上でパーミッションビットを変更する	フルコントロール権をユーザに許可するように、かつ、強制的に特定のビットを	<span class="emphasis"><em>on</em></span>に設定しない、共有を設定したいならば、	<code class="filename">smb.conf</code>ファイル中の共有固有のセクションに、以下のパラメータを記述する:	</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2628582"></a><em class="parameter"><code>security mask = 0777</code></em></td></tr><tr><td><a class="indexterm" name="id2628593"></a><em class="parameter"><code>force security mode = 0</code></em></td></tr><tr><td><a class="indexterm" name="id2628605"></a><em class="parameter"><code>directory security mask = 0777</code></em></td></tr><tr><td><a class="indexterm" name="id2628617"></a><em class="parameter"><code>force directory security mode = 0</code></em></td></tr></table></div><div class="sect2" title="標準Sambaファイル属性のマッピングの相互関係"><div class="titlepage"><div><div><h3 class="title"><a name="id2628630"></a>標準Sambaファイル属性のマッピングの相互関係</h3></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	Sambaは(<span class="quote">“<span class="quote">read-only</span>”</span>のような)DOS属性の一部をファイルのUNIX	パーミッションにマップする。これは、セキュリティダイアログ経由での	パーミッションビットの設定とファイル属性マッピングによって設定されるビットとの	の間に競合が生じることがでてくる。	</p></div><p>	もしも、ファイルが所有者に対して読み込み権がない場合、これは標準ファイル属性	タブダイアログ中で<span class="quote">“<span class="quote">読み取り専用</span>”</span>として表示される。都合の悪いことに、	このダイアログは、他のタブ中にあるセキュリティ情報を含むものと同じである。	</p><p>	これができる事が意味するものは、もしも所有者がセキュリティダイアログを使って	自分自身に読み込みを許可するためにパーミッションを修正するならば、	標準セキュリティダイアログに戻るために<span class="guibutton">OK</span>をクリックし、	次にNTはファイルのパーミッションを読み取りのみに戻す(ダイアログ中では引き続き	表示される属性)。これは、パーミッション設定後、属性ダイアログに戻るために	<span class="guibutton">OK</span>をクリックした後、変更を書き戻さないようにするため、	<span class="guibutton">OK</span>の代わりに<span class="guibutton">キャンセル</span>をクリック	する事を意味する。	</p></div><div class="sect2" title="Windows NT/200X ACLとPOSIX ACLの制限"><div class="titlepage"><div><div><h3 class="title"><a name="id2628716"></a>Windows NT/200X ACLとPOSIX ACLの制限</h3></div></div></div><p>	Windowsの管理者は簡単なACL制御になれていて、通常UNIXのユーザ/グループ/その他(ugo)	のパーミッションは不十分で十分にきめ細かくないと考えている。	</p><p>	競合しているSMBの実装は、Windows ACLをどのように取り扱うかについて異なる。Sambaは	Windows ACLを、UNIXのファイルシステム管理の構造で取り扱い、そのため、POSIX ACLの	制限が適用される。そのため、Windows NT/200X ACLの機能が POSIX ACLには欠如している	ので、POSIX ACLのセマンティックスと制限は、Windows管理者に課される。	</p><p>	POSIX ACLはUNIX管理者におもしろい難問を提供し、そのため、Windows ACL管理に適用	するために妥協を強いる。POSIX ACLは公式の標準としては適用されていない。という	よりは、最終の標準は、draft standard 1003.1e revision 17である。これが、Samba	が実装しているPOSIX文書である。	</p><p>	UNIXベンダは別々の流儀でPOSIX ACLを実装している。ACLをサポートしている数多くの	Linuxファイルシステムがある。Sambaは数多くのPOSIX ACLの実装間のすべての違いを	透過的にする仕組みを提供する必要がある。SambaにおけるACLサポートのプレッシャー	は、UNIXの世界でのACLサポートの標準化への圧力を顕著に増大する。	</p><p>	SambaはUNIXファイルシステムで実装されているPOSIX ACLが予想していない、	<span class="emphasis"><em>継承</em></span>を実装しているWindows ACLという難問を取り扱う	複雑な事項を扱う必要がある。Sambaは通常のugoとACL機能を上書きすることが出来る	<span class="emphasis"><em>masks</em></span>のサポートを提供する。これは、WindowsのACLが	実装しなければならない方法を更に複雑にする。	</p><div class="sect3" title="UNIX POSIX ACLの概要"><div class="titlepage"><div><div><h4 class="title"><a name="id2628793"></a>UNIX POSIX ACLの概要</h4></div></div></div><p>	POSIX ACLを調べる際に、ファイルとディレクトリ両方に対して操作する方法を	考えておかなければならない。ファイルのACLは以下の意味を持つ:</p><pre class="screen"># file: testfile      <-- ファイル名# owner: jeremy       <-- ファイルの所有者# group: users        <-- POSIXグループの所有者user::rwx             <-- ファイルの所有者に対する許可 (user)user:tpot:r-x         <-- 追加のユーザに対する許可 `tpot'group::r--            <-- ファイルグループの所有者に対する許可 (group)group:engrs:r--       <-- 追加のグループに対する許可 `engineers'mask:rwx              <-- グループに対して'論理積'を取る時のマスク値other::---            <-- その他に対する許可 (other)</pre><p>	ディレクトリのACLは以下の意味を持つ:</p><pre class="screen"># file: testdir       <-- ディレクトリ名# owner: jeremy       <-- ディレクトリの所有者# group: jeremy       <-- POSIXグループの所有者user::rwx             <-- 所有者に対するディレクトリの許可 (user)group::rwx            <-- 周遊するグループに対するディレクトリの許可 (group)mask::rwx             <-- グループに対して'論理積'を取る時のマスク値other:r-x             <-- その他に対する許可 (other)default:user::rwx     <-- 継承された所有者に対する許可default:user:tpot:rwx <-- 継承されたあるユーザに対する許可 `tpot'default:group::r-x    <-- 継承されたグループに対する許可default:mask:rwx      <-- 継承された既定値のマスクdefault:other:---     <-- 継承されたその他に対するパーミッション (other)</pre><p>	</p></div><div class="sect3" title="Windowsのファイル ACLsからUNIX POSIX ACLへのマッピング"><div class="titlepage"><div><div><h4 class="title"><a name="id2628854"></a>Windowsのファイル ACLsからUNIX POSIX ACLへのマッピング</h4></div></div></div><p>	Microsoft Windows NT4/200XのACLはPOSIX ACLに当然マップされねばならない。	ファイルパーミッションのマッピングは、	<a class="link" href="AccessControls.html#fdsacls" title="Table 16.5. WindowsのファイルACLをUNIX POSIXファイルACLにマップする方法">WindowsのファイルACLをUNIX POSIXファイルACLにマップする方法</a>	で示されている。文字#は、Windows管理者がファイルに<code class="constant">フルコントロール</code>	フラグをセットする時のみこのフラグがセットされる事を意味する。	</p><div class="table"><a name="fdsacls"></a><p class="title"><b>Table 16.5. WindowsのファイルACLをUNIX POSIXファイルACLにマップする方法</b></p><div class="table-contents"><table summary="WindowsのファイルACLをUNIX POSIXファイルACLにマップする方法" border="1"><colgroup><col align="left"><col align="center"></colgroup><thead><tr><th align="left">WindowsのACE</th><th align="center">ファイル属性フラグ</th></tr></thead><tbody><tr><td align="left"><p>フルコントロール</p></td><td align="center"><p>#</p></td></tr><tr><td align="left"><p>フォルダのスキャン/ファイルの実行</p></td><td align="center"><p>x</p></td></tr><tr><td align="left"><p>フォルダの一覧/データの読み取り</p></td><td align="center"><p>r</p></td></tr><tr><td align="left"><p>属性の読み取り</p></td><td align="center"><p>r</p></td></tr><tr><td align="left"><p>拡張属性の読み取り</p></td><td align="center"><p>r</p></td></tr><tr><td align="left"><p>ファイルの作成/データの書き込み</p></td><td align="center"><p>w</p></td></tr><tr><td align="left"><p>フォルダの作成/データの追加</p></td><td align="center"><p>w</p></td></tr><tr><td align="left"><p>属性の書き込み</p></td><td align="center"><p>w</p></td></tr><tr><td align="left"><p>拡張属性の書き込み</p></td><td align="center"><p>w</p></td></tr><tr><td align="left"><p>サブフォルダとファイルの削除</p></td><td align="center"><p>w</p></td></tr><tr><td align="left"><p>削除</p></td><td align="center"><p>#</p></td></tr><tr><td align="left"><p>アクセス許可の読み取り</p></td><td align="center"><p>all</p></td></tr><tr><td align="left"><p>アクセス許可の変更</p></td><td align="center"><p>#</p></td></tr><tr><td align="left"><p>所有権の取得</p></td><td align="center"><p>#</p></td></tr></tbody></table></div></div><br class="table-break"><p>	マッピングテーブルを見てわかるように、1対1でマッピングされるものは1つもなく、	そのため、Sambaは、Windowsに、管理者によって意図されるおおよその方向に操作	させる、論理的なマッピングをしなければならない。	</p><p>	一般的に、UNIX POSIXのユーザ/グループ/その他のパーミッションのマッピングは	Windows ACLにマップされる。これは、POSIX ACLの作成に優先する。POSIX ACLは	ファイルかディレクトリを所有しているユーザとグループ以外のユーザとグループの	ためのアクセス制御を行うために必要である。	</p><p>	UNIX管理者はUNIX環境下で任意のディレクトリパーミッションを設定出来る。	Windows管理者はファイルの所有者に対して読み取り許可を削除するために、Windows	エクスプローラで行う事が出来ないというように、より制限されている。	</p></div><div class="sect3" title="WindowsのディレクトリACLs の UNIX POSIX ACLへのマッピング"><div class="titlepage"><div><div><h4 class="title"><a name="id2629155"></a>WindowsのディレクトリACLs の UNIX POSIX ACLへのマッピング</h4></div></div></div><p>	UNIX POSIXのディレクトリパーミッションとUNIX POSIXのACLを、Windowsのディレクトリ	ACLにマップされる、Windows ACEにマッピングする時に、おもしろいことが起きる	(アクセスコントロールエントリ(ACE)はACLの個々の要素である)。	</p><p>	ファイルパーミッションの時に説明したのと全く同じように、ディレクトリ	パーミッション機能するが、いくつか注意しなければならない例外と、	ディレクトリパーミッションを準備する時に、抜け目のない管理者が注意を払う2、3の	特色がある。	</p></div></div></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2629193"></a>よくあるエラー</h2></div></div></div><p>ファイル、ディレクトリと共有アクセスの問題はメーリングリスト上での共通の話題である。以下は最近メーリングリストで話題になった例である。</p><div class="sect2" title="Publicな共有にユーザが書き込めない"><div class="titlepage"><div><div><h3 class="title"><a name="id2629209"></a>Publicな共有にユーザが書き込めない</h3></div></div></div><p>	以下の不満はSambaメーリングリスト上でしばしば聞かれる:	<span class="quote">“<span class="quote">	ファイルとディレクトリのパーミッションに関していくつかの問題に直面している。	ドメインにadmin user(root)としてログイン出来、ファイルを作成/変更するための	パーミッションを、誰でも持つ必要があるPublicな共有があるが、rootしかファイルを	変更できず、それ以外の人は出来ない。結局常時サーバの所に行って、	<strong class="userinput"><code>chgrp -R users *</code></strong>と<strong class="userinput"><code>chown -R nobody *</code></strong>	を実行し、他のユーザに対してファイルに対して変更が出来るようにしなければならない。	</span>”</span>	</p><p>	この問題を解決できる1つの方法がある:	</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>			共有されているディレクトリの最上位に移動する。			</p></li><li class="step" title="Step 2"><p>			好みのpublicなユーザとグループに所有者を設定する</p><pre class="screen"><code class="prompt">$ </code>find `directory_name' -type d -exec chown user:group {}\;<code class="prompt">$ </code>find `directory_name' -type d -exec chmod 2775 {}\;<code class="prompt">$ </code>find `directory_name' -type f -exec chmod 0775 {}\;<code class="prompt">$ </code>find `directory_name' -type f -exec chown user:group {}\;</pre><p>			</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>			上記はすべてのディレクトリに<code class="constant">SGID ビット</code>を			設定する。これが何をするかはUNIX/Linuxのマニュアルページを読む			こと。これにより、ディレクトリ中に作成されるすべてのファイルと			ディレクトリツリーは現在のユーザと、ディレクトリ作成時に所有する			グループによって所有される。			</p></div></li><li class="step" title="Step 3"><p>			ディレクトリが<em class="replaceable"><code>/foodbar</code></em>だとする:</p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>chown jack:engr /foodbar</code></strong></pre><p>			</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>これは以下と同じである:</p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>chown jack /foodbar</code></strong><code class="prompt">$ </code><strong class="userinput"><code>chgrp engr /foodbar</code></strong></pre></div></li><li class="step" title="Step 4"><p>以下のようにタイプする: </p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>chmod 2775 /foodbar</code></strong><code class="prompt">$ </code><strong class="userinput"><code>ls -al /foodbar/..</code></strong></pre><p>			</p><p>以下が表示される:</p><pre class="screen">drwxrwsr-x  2 jack  engr    48 2003-02-04 09:55 foodbar</pre><p>			</p></li><li class="step" title="Step 5"><p>以下のようにタイプする:</p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>su - jill</code></strong><code class="prompt">$ </code><strong class="userinput"><code>cd /foodbar</code></strong><code class="prompt">$ </code><strong class="userinput"><code>touch Afile</code></strong><code class="prompt">$ </code><strong class="userinput"><code>ls -al</code></strong></pre><p>		</p><p>		<code class="filename">Afile</code>がJillによって作成されて、所有権を持っている		ことを確認し、以下のようにJackが許可されていることを確認する:		and permissions of Jack, as follows:</p><pre class="screen">-rw-r--r--  1 jill  engr     0 2007-01-18 19:41 Afile</pre><p>		</p></li><li class="step" title="Step 6"><p>		もしも、ディレクトリに書き込みパーミッションを持たねばならないユーザが		グループ<span class="emphasis"><em>engr</em></span>のメンバでないならば、<code class="filename">smb.conf</code>中の		共有のエントリを以下のようにする:		</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2629546"></a><em class="parameter"><code>force group = engr</code></em></td></tr></table><p>		</p></li></ol></div></div><div class="sect2" title="force userセットでrootとしてファイル操作が完了する"><div class="titlepage"><div><div><h3 class="title"><a name="id2629562"></a><span class="emphasis"><em>force user</em></span>セットで<span class="emphasis"><em>root</em></span>としてファイル操作が完了する</h3></div></div></div><p>		<a class="link" href="smb.conf.5.html#ADMINUSERS" target="_top">admin users</a>中にユーザがある時、		<a class="link" href="smb.conf.5.html#FORCEUSER" target="_top">force user</a>が設定されていたとしても、		Sambaは常時このユーザに対してファイル操作を<span class="emphasis"><em>root</em></span>として行う。		</p></div><div class="sect2" title="SambaでMicrosoft Wordを使うとファイルの所有者が変更される"><div class="titlepage"><div><div><h3 class="title"><a name="id2629607"></a>SambaでMicrosoft Wordを使うとファイルの所有者が変更される</h3></div></div></div><p>		<span class="emphasis"><em>質問:</em></span><span class="quote">“<span class="quote">Aが所有者のword文書をBがセーブする。		更新したファイルは所有者がBになる。なぜSambaはこのようにするのか?		どうやったら修復できる?</span>”</span>		</p><p>		<span class="emphasis"><em>答え:</em></span>Wordは、Wordの文書を修正/変更した時に以下の		作業を行う:Microsoft Wordは一時的な名前で新しい文書を作成する。Wordは		次に古い文書をクローズしてそれを削除し、新しい文書をオリジナルの文書		の名前に改名する。Sambaが、新しい文書がオリジナルの文書の所有者によって		所有すべきであるということを知るための機構はない。SambaはMicrosoft Word		によってファイルが改名されたことを知るすべはない。Sambaが告げることが		出来る限りのことは、作成されるファイルは新しいファイルであり、		アプリケーション(Word)が更新しているものではない、ということである。		</p><p>		パーミッション問題を解決するための回避方法がある。これは、<code class="filename">smb.conf</code>		ファイル中からファイルシステムの動作を管理できる方法についての理解と、		同様に、UNIXファイルシステムの動作について理解することを深める。		Word文書を変更するディレクトリに<code class="literal">chmod g+s `directory_name'</code>		を設定する。これは、生成されるすべてのファイルはディレクトリを所有している		グループになるようにする。 <code class="filename">smb.conf</code>中の共有定義セクションを以下のように		設定する。		</p><p>		</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2629710"></a><em class="parameter"><code>force create mode = 0660</code></em></td></tr><tr><td><a class="indexterm" name="id2629722"></a><em class="parameter"><code>force directory mode = 0770</code></em></td></tr></table><p>		</p><p>		これらの2つの設定は、共有中で作成される、すべてのディレクトリとファイルが		ディレクトリそれ自身上に設定された所有者とグループによって読み書きができる		ようにする。		</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rights.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="locking.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 15. User Rights and Privileges </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 17. ファイルとレコードのロッキング</td></tr></table></div></body></html>