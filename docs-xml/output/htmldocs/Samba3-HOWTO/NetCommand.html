<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 13. リモートとローカル管理:Netコマンド</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="groupmapping.html" title="Chapter 12. グループのマッピング: Microsoft Windows と UNIX"><link rel="next" href="idmapper.html" title="Chapter 14. 識別情報のマッピング(IDMAP)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 13. リモートとローカル管理:Netコマンド</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="groupmapping.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="idmapper.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 13. リモートとローカル管理:Netコマンド"><div class="titlepage"><div><div><h2 class="title"><a name="NetCommand"></a>Chapter 13. リモートとローカル管理:Netコマンド</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Volker</span> <span class="surname">Lendecke</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:Volker.Lendecke@SerNet.DE">Volker.Lendecke@SerNet.DE</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Guenther</span> <span class="surname">Deschner</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:gd@samba.org">gd@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">May 9, 2005</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="NetCommand.html#id2611145">概要</a></span></dt><dt><span class="sect1"><a href="NetCommand.html#id2611485">管理者の作業と手段</a></span></dt><dt><span class="sect1"><a href="NetCommand.html#id2611578">UNIXとWindowsのグループ管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="NetCommand.html#id2611752">グループアカウントの追加、改名、あるいは削除</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#grpmemshipchg">グループメンバシップの操作</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#nestedgrpmgmgt">ネストされたグループのサポート</a></span></dt></dl></dd><dt><span class="sect1"><a href="NetCommand.html#id2613321">UNIXとWindowsのユーザ管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="NetCommand.html#sbeuseraddn">ユーザアカウントの追加</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#id2613540">ユーザアカウントの削除</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#id2613590">ユーザアカウントの管理</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#id2613674">ユーザのマッピング</a></span></dt></dl></dd><dt><span class="sect1"><a href="NetCommand.html#id2613764">管理ユーザの権限と権利</a></span></dt><dt><span class="sect1"><a href="NetCommand.html#id2614133">信頼関係の管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="NetCommand.html#id2614152">マシン信頼アカウント</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#id2614566">ドメイン間の信頼関係</a></span></dt></dl></dd><dt><span class="sect1"><a href="NetCommand.html#id2614835">セキュリティ識別子(SID)の管理</a></span></dt><dt><span class="sect1"><a href="NetCommand.html#id2615092">共有管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="NetCommand.html#id2615144">共有の作成、編集と削除</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#id2615342">共有のACLの作成と変更</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#id2615380">共有、ディレクトリとファイルのマイグレーション(移行)</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#id2616146">プリンタの移行</a></span></dt></dl></dd><dt><span class="sect1"><a href="NetCommand.html#id2616440">オープンしているファイルの制御</a></span></dt><dt><span class="sect1"><a href="NetCommand.html#id2616467">セッションとコネクションの管理</a></span></dt><dt><span class="sect1"><a href="NetCommand.html#id2616536">プリンタとADS</a></span></dt><dt><span class="sect1"><a href="NetCommand.html#id2616668">Sambaキャッシュの操作</a></span></dt><dt><span class="sect1"><a href="NetCommand.html#id2616686">IDMAP UID/SIDマッピングの管理</a></span></dt><dd><dl><dt><span class="sect2"><a href="NetCommand.html#id2616747">IDMAPデータベースダンプファイルの作成</a></span></dt><dt><span class="sect2"><a href="NetCommand.html#id2616790">IDMAPデータベースダンプファイルのリストア</a></span></dt></dl></dd><dt><span class="sect1"><a href="NetCommand.html#netmisc1">その他の雑多な操作</a></span></dt></dl></div><p><a class="indexterm" name="id2610994"></a><a class="indexterm" name="id2611001"></a><a class="indexterm" name="id2611008"></a><a class="indexterm" name="id2611015"></a><code class="literal">net</code>コマンドはSamba-3における新しい機能の1つで、共通作業のために、多くの必要なリモート管理操作用の便利なツールを提供する試みである。<code class="literal">net</code>は自由度が高いデザインで、スクリプト制御アプリケーションのためと同様にコマンド行操作でも使うように出来ている。</p><p><a class="indexterm" name="id2611045"></a><a class="indexterm" name="id2611052"></a><a class="indexterm" name="id2611059"></a><a class="indexterm" name="id2611066"></a>当初は同じ名前のMicrosoft Windows コマンドの模倣を狙って作られたが、<code class="literal">net</code>は、Sambaネットワーク管理者の道具箱の基本的な部分になる、非常に強力なツールに変貌した。Samba Teamは、<code class="literal">smbgroupedit</code>と<code class="literal">rpcclient</code>のようなツールも提供していて、それらは本当に役に立つ能力が<code class="literal">net</code>コマンドに集約された。<code class="literal">smbgroupedit</code>コマンドは、いくつかの機能のみが<code class="literal">rpcclient</code>に集約された間、<code class="literal">net</code>コマンドに完全に移植された。それらのユーティリティや機能に対する古いリファレンスを見つけた場合、それ以外を探す前に、<code class="literal">net</code>コマンドを見るべきである。</p><p>Samba-3管理者は、そうすることが、自ら招いた痛み、苦しみと自暴自棄を科すことをほとんど確実に引き起こすので、この章を取り繕うことができない。</p><div class="sect1" title="概要"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2611145"></a>概要</h2></div></div></div><p><a class="indexterm" name="id2611153"></a><a class="indexterm" name="id2611160"></a><a class="indexterm" name="id2611167"></a><a class="indexterm" name="id2611174"></a><a class="indexterm" name="id2611180"></a><a class="indexterm" name="id2611187"></a>	Samba-3サーバのインストールに伴う作業は、スタンドアロンかドメインメンバの	どちらも、さらにドメインコントローラ(PDCまたはBDC)は管理者権限の作成を必要と	するところから始まる。もちろん、ユーザとグループアカウントの作成は、スタンド	アロンサーバとPDC両者において必須である。BDCまたはドメインメンバサーバ(DMS)	においては、ドメインユーザとグループアカウントは中央のドメイン認証バック	エンドから得られる。	</p><p><a class="indexterm" name="id2611207"></a><a class="indexterm" name="id2611214"></a><a class="indexterm" name="id2611221"></a><a class="indexterm" name="id2611228"></a><a class="indexterm" name="id2611236"></a><a class="indexterm" name="id2611242"></a><a class="indexterm" name="id2611249"></a><a class="indexterm" name="id2611256"></a>	インストールされているサーバのタイプに関係なく、ローカルUNIXグループはWindowsの	ネットワークにおけるドメイングローバルグループアカウントにマップされねばならない。	なぜだろうか?それは、Sambaは常時、伝統的なUNIXのUIDとGID制御によってホスト	サーバのリソースのアクセスを制限するからである。これは、ドメイングローバル	グループのメンバであるドメインユーザは、Sambaがホスティングしているサーバの	ローカルなUIDとGIDをベースとしたアクセス権が与えられるようにするために、	ローカルグループはドメイングローバルグループにマップされなければならない。	このようなマッピングは<code class="literal">net</code>コマンドを使うことで実装される。	</p><p><a class="indexterm" name="id2611299"></a><a class="indexterm" name="id2611306"></a><a class="indexterm" name="id2611312"></a><a class="indexterm" name="id2611319"></a><a class="indexterm" name="id2611326"></a><a class="indexterm" name="id2611333"></a><a class="indexterm" name="id2611340"></a>	メンバ(PDC、BDCあるいはDMS)として動作しているSamba-3サーバがホスティングしている	UNIXシステムは、ドメイン認証データベース(かあるいはディレクトリ)中にマシン信頼	アカウントを持たねばならない。そのようなセキュリティ(あるいは信頼)アカウントの	作成も、<code class="literal">net</code>コマンドを使うことよって扱える。	</p><p><a class="indexterm" name="id2611367"></a><a class="indexterm" name="id2611374"></a><a class="indexterm" name="id2611380"></a><a class="indexterm" name="id2611388"></a><a class="indexterm" name="id2611394"></a><a class="indexterm" name="id2611401"></a><a class="indexterm" name="id2611408"></a><a class="indexterm" name="id2611415"></a><a class="indexterm" name="id2611423"></a>	<code class="literal">net</code>コマンドを使うことで、ドメイン間信頼関係をも確立でき、	また、ユーザ管理、グループ管理、共有とプリンタ管理、ファイルとプリンタの	マイグレーション、SIDの管理などのような、有り余るほどの典型的な管理作業も	できる。	</p><p><a class="indexterm" name="id2611449"></a><a class="indexterm" name="id2611455"></a>	全体の構成は今明確にすべきである:<code class="literal">net</code>はSamba-3の動作において	重要な役割を演じる。その役割は継続して開発されている。この章に含まれているもの	は、その重要性の証拠であり、それは、完全にオンラインUNIXマニュアル中でその	使用をカバーすることが賢明であるとは、もはや考えられない点において、複雑に成長	してきた。	</p></div><div class="sect1" title="管理者の作業と手段"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2611485"></a>管理者の作業と手段</h2></div></div></div><p><a class="indexterm" name="id2611493"></a><a class="indexterm" name="id2611500"></a><a class="indexterm" name="id2611506"></a><a class="indexterm" name="id2611516"></a>	<code class="literal">net</code>の基本的な動作はここに文書化されている。この文書は完璧	ではなく、不完全である。WindowsサーバからSambaサーバへの移行について最も着目	しているので、分散コンピューティング環境のリモートプロシジャーコール(DCE RPC)	モードの操作について強調している。Active Directoryドメインのメンバであるサーバに	対して使用されるとき、ADSモード操作を使うことは望ましい(そして、それはしばしば	必要である)。<code class="literal">net</code>は両方ともサポートするが、すべての操作に	対してではない。モードが指定されない多くの操作では、<code class="literal">net</code>は	自動的に<code class="constant">ads</code>, <code class="constant">rpc</code>と	<code class="constant">rap</code>モードにフォールバックする。このユーティリティの	能力についてのより包括的な概要はマニュアルページを参照のこと。	</p></div><div class="sect1" title="UNIXとWindowsのグループ管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2611578"></a>UNIXとWindowsのグループ管理</h2></div></div></div><p><a class="indexterm" name="id2611587"></a><a class="indexterm" name="id2611594"></a><a class="indexterm" name="id2611602"></a><a class="indexterm" name="id2611611"></a><a class="indexterm" name="id2611620"></a>	初めに、この章の主要な注目点は、Sambaによってサポートされている	<code class="literal">net rpc</code>ファミリの動作の使用方法である。それらの大半は、	Active Directoryに接続したときに使われる<code class="literal">net ads</code>モードでも	サポートされる。<code class="literal">net rap</code>動作モードもそれらの操作のいくつかで	サポートされる。RAPプロトコルはIBM OS/2といくつかの初期のSMBサーバによって	使われる。	</p><p><a class="indexterm" name="id2611656"></a><a class="indexterm" name="id2611663"></a><a class="indexterm" name="id2611670"></a>	Sambaの<code class="literal">net</code>ツールはコマンドラインで完結するための、すべての	共通な管理作業が出来る十分な能力を実装している。このセクションでは、必須の	ユーザとグループ管理機能のそれぞれについて説明している。	</p><p><a class="indexterm" name="id2611690"></a><a class="indexterm" name="id2611697"></a><a class="indexterm" name="id2611707"></a><a class="indexterm" name="id2611716"></a>	Samba-3は2種類のグループを認識する。それは、<span class="emphasis"><em>ドメイングループ</em></span>	と<span class="emphasis"><em>ローカルグループ</em></span>である。ドメイングループは(メンバとして)	ドメインユーザアカウントのみを含むことは出来る。ローカルグループはローカル	グループ、ドメインユーザとメンバとしてのドメイングループをを含むことが出来る。	</p><p>	ローカルグループの目的は、そのグループアカウントに対して、通常のUNIX/Linux	グループのようにファイルのアクセス権を	設定することであり、また、Windows	ファイルサーバを再配置しても継続的である。	</p><div class="sect2" title="グループアカウントの追加、改名、あるいは削除"><div class="titlepage"><div><div><h3 class="title"><a name="id2611752"></a>グループアカウントの追加、改名、あるいは削除</h3></div></div></div><p>	SambaはWindowsクライアントにファイルと印刷サービスを提供する。Windows環境に	対して有効にしたファイルシステムリソースは、必要に応じてWindowsネットワーク	環境と互換の方式で提供しなければならない。UNIXグループはUNIX OSとそのファイル	システム内で、操作の必要で提供するために要求に応じて作成および削除される。	</p><p>	Windows環境に対して有効にするために、Sambaは、Windows(あるいはドメイン)グループ	と呼ばれる論理的なエントリに、UNIXグループをマップされることが出来る機能を持つ。	Sambaはローカルとグローバルと言う2つのタイプのWindowsグループをサポートする。	グローバルグループはメンバとグローバルユーザを含むことが出来る。このメンバシップは	通常のUNIX流儀に影響されるが、UNIXユーザをUNIXグループに追加する。Windowsユーザ	アカウントはユーザのSambaSAMAccount(論理エントリ)とUNIXユーザアカウントとの	マッピングから成り立つ。そのため、UNIXユーザはWindowsユーザにマップされ(すなわち、	Windowsユーザアカウントとパスワードが与えられる)、そのユーザに属するUNIX	グループはWindowsグループアカウントにマップされる。この結果は、Windowsアカウント	環境においてそのユーザが、UNIXグループメンバシップであるという理由で、Windows	グループアカウントのメンバでもあるということである。	</p><p>	Windowsグループ管理を扱う以下の項では、Windowsグループアカウントとそのメンバの	間の関係について、それぞれのWindowsグループアカウントの関係をデモする。これは、	論理マッピングが作成されるとすぐに、どのように自動的にUNIXグループメンバをWindows	グループメンバシップに渡すかを表示する。	</p><div class="sect3" title="新しいグループの追加又は作成"><div class="titlepage"><div><div><h4 class="title"><a name="id2611820"></a>新しいグループの追加又は作成</h4></div></div></div><p>	Windowsグループアカウントを追加する前に、現在有効なグループは以下のようにして表示できる:<a class="indexterm" name="id2611833"></a><a class="indexterm" name="id2611844"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc group list -Uroot%not24getPassword:Domain AdminsDomain UsersDomain GuestsPrint OperatorsBackup OperatorsReplicatorDomain ComputersEngineers</pre><p>	</p><p>	<span class="quote">“<span class="quote">SupportEngrs</span>”</span>というWindowsグループアカウントは、以下のコマンドを	実行することで追加できる:<a class="indexterm" name="id2611881"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc group add "SupportEngrs" -Uroot%not24get</pre><p>	以下のコマンドを実行することで、新しいグループアカウント追加の結果が有効になっていることが検証できる:</p><pre class="screen"><code class="prompt">root# </code> net rpc group list -Uroot%not24getPassword:Domain AdminsDomain UsersDomain GuestsPrint OperatorsBackup OperatorsReplicatorDomain ComputersEngineersSupportEngrs</pre><p>	</p><p><a class="indexterm" name="id2611926"></a><a class="indexterm" name="id2611933"></a><a class="indexterm" name="id2611940"></a>	以下はPOSIX(UNIX/Linuxシステムアカウント)グループが、	<a class="link" href="smb.conf.5.html#ADDGROUPSCRIPT" target="_top">add group script = /opt/IDEALX/sbin/smbldap-groupadd -p "%g"</a>	インタフェーススクリプトを呼び出すことによって作成されたことを表示する:</p><pre class="screen"><code class="prompt">root# </code> getent group...Domain Admins:x:512:rootDomain Users:x:513:jht,lct,ajt,metDomain Guests:x:514:Print Operators:x:550:Backup Operators:x:551:Replicator:x:552:Domain Computers:x:553:Engineers:x:1002:jhtSupportEngrs:x:1003:</pre><p>	以下は、グループアカウントを追加する<code class="literal">net</code>の使用で、Windows	グループアカウントのために作られたPOSIXグループの即時的なマッピング中での結果を示す:<a class="indexterm" name="id2611992"></a></p><pre class="screen"><code class="prompt">root# </code> net groupmap listDomain Admins (S-1-5-21-72630-4128915-11681869-512) -> Domain AdminsDomain Users (S-1-5-21-72630-4128915-11681869-513) -> Domain UsersDomain Guests (S-1-5-21-72630-4128915-11681869-514) -> Domain GuestsPrint Operators (S-1-5-21-72630-4128915-11681869-550) -> Print OperatorsBackup Operators (S-1-5-21-72630-4128915-11681869-551) -> Backup OperatorsReplicator (S-1-5-21-72630-4128915-11681869-552) -> ReplicatorDomain Computers (S-1-5-21-72630-4128915-11681869-553) -> Domain ComputersEngineers (S-1-5-21-72630-4128915-11681869-3005) -> EngineersSupportEngrs (S-1-5-21-72630-4128915-11681869-3007) -> SupportEngrs</pre><p>	</p></div><div class="sect3" title="WindowsグループからUNIXグループへのマッピング"><div class="titlepage"><div><div><h4 class="title"><a name="id2612033"></a>WindowsグループからUNIXグループへのマッピング</h4></div></div></div><p><a class="indexterm" name="id2612043"></a><a class="indexterm" name="id2612050"></a><a class="indexterm" name="id2612057"></a><a class="indexterm" name="id2612064"></a>	Windowsグループは、SambaサーバをホスティングしているOSに適した方法での首尾一貫	した方法で主張できるファイルシステムのアクセス制御が出来るように、UNIXシステム	(POSIX)グループにマップされる必要がある。	</p><p><a class="indexterm" name="id2612084"></a><a class="indexterm" name="id2612090"></a><a class="indexterm" name="id2612097"></a><a class="indexterm" name="id2612103"></a>	SambaサーバをホスティングしているUNIX/Linuxサーバのファイルシステムで、すべての	ファイルシステム(ファイルとディレクトリ)アクセス制御はUID/GID識別の組を使って	実装される。SambaはUNIXファイルシステムの仕組みに優先したり、置き換えることは	しない。これは、ファイルシステムにアクセスするすべてのWindowsネットワーク操作は、	Windowsユーザから特定のUNIX/Linuxグループアカウントにマップするメカニズムを	提供する。ユーザアカウントはローカルに知られているUIDにもマップする必要がある。	<code class="literal">net</code>コマンドはここでは任意のRPC機能は呼び出さないが、passdbに	直接アクセスすることに注意。	</p><p><a class="indexterm" name="id2612145"></a><a class="indexterm" name="id2612152"></a><a class="indexterm" name="id2612159"></a><a class="indexterm" name="id2612166"></a><a class="indexterm" name="id2612172"></a><a class="indexterm" name="id2612180"></a><a class="indexterm" name="id2612187"></a>	Sambaは<code class="constant">Domain Admins, Domain Users</code>と	<code class="constant">Domain Guests</code>グローバルグループの既定値のマッピングに	依存する。追加のグループはサンプルで与えられた中でのように追加できる。存在する	UNIXグループアカウントをWindowsグループにマップすることが必要なときがある。	この操作は実際Windowsグループアカウントをマップ生成の結果として作成する。	</p><p><a class="indexterm" name="id2612219"></a><a class="indexterm" name="id2612230"></a><a class="indexterm" name="id2612242"></a>	<code class="constant">add</code>、<code class="constant">modify</code>と<code class="constant">delete</code>	を含む操作が許可される。それぞれの操作の例はここで示される。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	Samba-3.0.23で始まるWindowsドメイングループは明示的に作成する必要がある。既定値	では、すべてのUNIXグループはWindowsローカルグループとしてWindowsネットワーク	に対して公開される。	</p></div><p>	存在するUNIXグループは以下の例のようにして存在するWindowsグループにマップされる:</p><pre class="screen"><code class="prompt">root# </code> net groupmap modify ntgroup="Domain Users" unixgroup=users</pre><p>	存在するUNIXグループは以下の例のようにして新しいWindowsグループにマップされる:</p><pre class="screen"><code class="prompt">root# </code> net groupmap add ntgroup="EliteEngrs" unixgroup=Engineers type=d</pre><p>	サポートされているマッピングタイプは'd'(ドメイングローバル)と'l'(ドメインローカル)	である。Windowsグループは削除でき、新しいWindowsグループは以下のコマンドでUNIX	グループにマップ出来る:</p><pre class="screen"><code class="prompt">root# </code> net groupmap delete ntgroup=Engineers<code class="prompt">root# </code> net groupmap add ntgroup=EngineDrivers unixgroup=Engineers type=d</pre><p>	削除と追加操作はWindowsグループかドメイングループとして知られている論理エントリ	のみに影響する。操作は、UNIXシステムグループの削除も作成もしないので、UNIX	システムグループには影響しない。UNIXグループからWindowsグループへのマッピングは、	ドメインメンバクライアント上(ワークステーションとサーバ)のファイルとフォルダが、	ドメインユーザとグループに対してドメイン全体のアクセス制御を得ることが出来る	ようにするために、WindowsグループとしてWindowsグループを有効にさせる。	</p><p>	<code class="constant">domain(グローバル)</code>と<code class="constant">local</code>という	二種類のWindowsグループか作成できる。前者の例では、作成されたWindowsグループは	<code class="constant">domain</code>かグローバルタイプである。以下のコマンドでは、	<code class="constant">local</code>タイプのWindowsグループを作成する。</p><pre class="screen"><code class="prompt">root# </code> net groupmap add ntgroup=Pixies unixgroup=pixies type=l</pre><p>	サポートされているマッピングタイプは'd' (ドメイングローバル)と 'l' (ドメイン	ローカル)で、Samba中でのドメインローカルグループは個別のSambaサーバに対する	ローカルなものとして扱われる。ローカルグループは、複数ネストされたグループの	サポートを有効にするためにSambaで使うことができる。	</p></div><div class="sect3" title="グループアカウントの削除"><div class="titlepage"><div><div><h4 class="title"><a name="id2612414"></a>グループアカウントの削除</h4></div></div></div><p><a class="indexterm" name="id2612422"></a>	グループアカウントは以下のコマンドで削除できる:</p><pre class="screen"><code class="prompt">root# </code> net rpc group delete SupportEngineers -Uroot%not24get</pre><p>	</p><p>	削除の検証は有効である。同じコマンドは以下で示されるように実行できる。	</p></div><div class="sect3" title="グループアカウントの改名"><div class="titlepage"><div><div><h4 class="title"><a name="id2612458"></a>グループアカウントの改名</h4></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	このコマンドはマニュアルページには記述がない。ソースコード上では実装されているが、	現時点では動作しない。ソースコード上から得られた文書例は、どのようにそれが	動くかを示す。これがいつ修正されるかを、今後のリリースにおけるリリースノート	で確認すること(訳注:3.4.0でもマニュアルに記載はない)。	</p></div><p>	時々グループアカウントの改名が必要なときがある。良い管理者は、この単純な要求が	無視されるならば、何人かのマネージャの要求がどのくらい痛ましくなるかを知っている。	以下のコマンドは、どのようにWindowsグループ<span class="quote">“<span class="quote">SupportEngrs</span>”</span>が	<span class="quote">“<span class="quote">CustomerSupport</span>”</span>に改名できるかを示す:<a class="indexterm" name="id2612499"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc group rename SupportEngrs \    CustomerSupport -Uroot%not24get</pre><p>	</p></div></div><div class="sect2" title="グループメンバシップの操作"><div class="titlepage"><div><div><h3 class="title"><a name="grpmemshipchg"></a>グループメンバシップの操作</h3></div></div></div><p>	3つの操作をグループメンバシップに関して行うことが出来る。それは、(1)Windows	ユーザをWindowsグループに追加する、(2)WindowsグループからWindowsユーザを削除する、	(3)Windowsグループに属するWindowsユーザを表示する である。	</p><p>	混乱を防ぐため、何らかの変更を行う前に、グループメンバシップを確認することは	意味がある。<code class="literal">getent group</code>はUNIX/Linuxのグループメンバシップを	表示する。UNIX/Linuxグループメンバは<code class="literal">net groupmap</code>コマンド	(<a class="link" href="groupmapping.html" title="Chapter 12. グループのマッピング: Microsoft Windows と UNIX">“グループのマッピング: Microsoft Windows と UNIX”</a>を参照)で、マップされたWindowsグループのメンバ	としても見ることができる。以下のUNIX/Linuxメンバシップは、<code class="constant">ajt</code>	というユーザが<code class="constant">Engineers</code>というUNIX/Linuxのグループのメンバ	であることを示している。</p><pre class="screen"><code class="prompt">root# </code> getent group...Domain Admins:x:512:rootDomain Users:x:513:jht,lct,ajt,met,vlendeckeDomain Guests:x:514:Print Operators:x:550:Backup Operators:x:551:Replicator:x:552:Domain Computers:x:553:Engineers:x:1000:jht,ajt</pre><p>	WindowsグループにマップされたUNIX/Linuxのグループは以下のようになる:</p><pre class="screen"><code class="prompt">root# </code> net groupmap listDomain Admins (S-1-5-21-72630-412605-116429-512) -> Domain AdminsDomain Users (S-1-5-21-72630-412605-116429-513) -> Domain UsersDomain Guests (S-1-5-21-72630-412605-116429-514) -> Domain GuestsPrint Operators (S-1-5-21-72630-412605-116429-550) -> Print OperatorsBackup Operators (S-1-5-21-72630-412605-116429-551) -> Backup OperatorsReplicator (S-1-5-21-72630-412605-116429-552) -> ReplicatorDomain Computers (S-1-5-21-72630-412605-116429-553) -> Domain ComputersEngineers (S-1-5-21-72630-412605-116429-3001) -> Engineers</pre><p>	</p><p>	与えられた<code class="constant">ajt</code>というユーザは、すでにUNIX/Linuxグループの	メンバで、グループマッピング経由、Windowsグループのメンバで、このアカウントを	再度追加する試みは失敗する。これのデモは以下の通り:<a class="indexterm" name="id2612644"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc group addmem "MIDEARTH\Engineers" ajt -Uroot%not24getCould not add ajt to MIDEARTH\Engineers: NT_STATUS_MEMBER_IN_GROUP</pre><p>	これは、UNIX/LinuxグループとWindowsグループの間のグループマッピングは有効でかつ	透過的であることを示している。	</p><p>	ユーザ<code class="constant">ajt</code>を、<code class="literal">net rpc group</code>ユーティリティ	を使って追加することを許可するために、このアカウントは最初に削除されねばならない。	削除とその確認は以下のようになる:<a class="indexterm" name="id2612691"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc group delmem "MIDEARTH\Engineers" ajt -Uroot%not24get<code class="prompt">root# </code> getent group EngineersEngineers:x:1000:jht<code class="prompt">root# </code> net rpc group members Engineers -Uroot%not24getMIDEARTH\jht</pre><p>	この例2つの中で、UNIX/Linuxシステムレベルで、グループはもはや<code class="constant">ajt</code>	をメンバとしてはいない。上記は又Windowsグループメンバシップの場合も示している。	</p><p>	<code class="literal">net rpc group</code>ユーティリティを使ってアカウントは再度追加される:</p><pre class="screen"><code class="prompt">root# </code> net rpc group addmem "MIDEARTH\Engineers" ajt -Uroot%not24get<code class="prompt">root# </code> getent group EngineersEngineers:x:1000:jht,ajt<code class="prompt">root# </code> net rpc group members Engineers -Uroot%not24getMIDEARTH\jhtMIDEARTH\ajt</pre><p>	</p><p>	この例では、Windowsの<code class="constant">Domain Users</code>アカウントのメンバは	<code class="literal">net rpc group</code>ユーティリティを使って検証される。この	UNIX/Linuxグループの内容は4つ前のパラグラフで示されていることに注意。	Windows(ドメイン)グループメンバシップは以下のようになる:<a class="indexterm" name="id2612794"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc group members "Domain Users" -Uroot%not24getMIDEARTH\jhtMIDEARTH\lctMIDEARTH\ajtMIDEARTH\metMIDEARTH\vlendecke</pre><p>	この特別な例は、Windowsグループ名が、大文字小文字を区別しない流儀で	(Microsoft Windowsと同じ)Sambaによって扱われることを示す:</p><pre class="screen"><code class="prompt">root# </code> net rpc group members "DomAiN USerS" -Uroot%not24getMIDEARTH\jhtMIDEARTH\lctMIDEARTH\ajtMIDEARTH\metMIDEARTH\vlendecke</pre><p>	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	単純に<code class="constant">Domain Users</code>の代わりに	<code class="constant">MIDEARTH\Domain Users</code>という形でグループ名を指定しても	失敗する。net rpc group の既定値の動作はローカルマシンへコマンドの動作を	行うからである。Windowsグループはマシンに対してローカルなように扱われる。	もしも他のマシンに対して問い合わせが必要ならば、その名前は、	<code class="literal">net</code>コマンドの<code class="constant">-S servername</code>	パラメータを使って指定する。	</p></div></div><div class="sect2" title="ネストされたグループのサポート"><div class="titlepage"><div><div><h3 class="title"><a name="nestedgrpmgmgt"></a>ネストされたグループのサポート</h3></div></div></div><p>	ドメインユーザとドメイングループのメンバである(含む)ローカルグループを作成する	ことはWindows(と現在はSambaも)で可能である。<code class="constant">demo</code>という	ローカルグループは以下のようにして作成できる:</p><pre class="screen"><code class="prompt">root# </code> net rpc group add demo -L -S MORDON -Uroot%not24get</pre><p>	ここで、-L スイッチはローカルグループ作成を意味する。特定のサーバに対しての	動作を行う場合は、 -S 引数を使う。-U引数はマシン上で適切な権限と権利を持つ	ユーザを指定するのに使う。	</p><p>	グループメンバの追加と削除は<code class="literal">net rpc group</code>コマンドの	<code class="constant">addmem</code>と<code class="constant">delmem</code>サブコマンドを使う	ことで行える。たとえば、ローカルグループ<code class="constant">demo</code>に対して	<span class="quote">“<span class="quote">DOM\Domain Users</span>”</span>を追加するには以下のように行う:</p><pre class="screen"><code class="prompt">root# </code> net rpc group addmem demo "DOM\Domain Users" -Uroot%not24get</pre><p>	</p><p>	以下のようにして、ネストされたグループのメンバを表示することが出来る:</p><pre class="screen"><code class="prompt">root# </code> net rpc group members demo -Uroot%not24getDOM\Domain UsersDOM\EngineersDOM\jamesfDOM\jht</pre><p>	</p><p>	ネストされたグループメンバは以下のようにして削除出来る:</p><pre class="screen"><code class="prompt">root# </code> net rpc group delmem demo "DOM\jht" -Uroot%not24get</pre><p>	</p><div class="sect3" title="Sambaサーバからのワークステーション上のネストされたグループの管理"><div class="titlepage"><div><div><h4 class="title"><a name="id2613002"></a>Sambaサーバからのワークステーション上のネストされたグループの管理</h4></div></div></div><p>	Windowsネットワーク管理者はしばしばSambaメーリングリストに、個々のワーク	ステーション上ですべての人に管理者権限を許可することが可能かと言うことを	質問してくる。これは、もちろんとても悪い習慣ではあるが、一般的にユーザの不満を	防ぐために行われる。個々では、どのようにSamba PDCまたはBDCからリモートでそれが	出来るかを示す:<a class="indexterm" name="id2613023"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc group addmem "Administrators" "Domain Users" \    -S WINPC032 -Uadministrator%secret</pre><p>	</p><p>	これはスクリプト化出来、そのためにWindowsワークステーションからドメインに	ログオンするユーザとして実行できる。どのようにそれが行われるかの簡単な例を	以下に示す。	</p><div class="procedure" title="Procedure 13.1. ワークステーションの Power Usersグループへの自動的なユーザの追加"><a name="id2613060"></a><p class="title"><b>Procedure 13.1. ワークステーションの Power Usersグループへの自動的なユーザの追加</b></p><div class="example"><a name="autopoweruserscript"></a><p class="title"><b>Example 13.1. ワークステーションのPower UsersグループにDomain Users を自動で追加するスクリプト</b></p><div class="example-contents"><pre class="screen">#!/bin/bash/usr/bin/net rpc group addmem "Power Users" "DOMAIN_NAME\$1" \                   -UAdministrator%secret -S $2exit 0</pre></div></div><br class="example-break"><div class="example"><a name="magicnetlogon"></a><p class="title"><b>Example 13.2. Magic Netlogon共有</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[netlogon]</code></em></td></tr><tr><td><a class="indexterm" name="id2613222"></a><em class="parameter"><code>comment = Netlogon Share</code></em></td></tr><tr><td><a class="indexterm" name="id2613234"></a><em class="parameter"><code>path = /var/lib/samba/netlogon</code></em></td></tr><tr><td><a class="indexterm" name="id2613245"></a><em class="parameter"><code>root preexec = /etc/samba/scripts/autopoweruser.sh %U %m</code></em></td></tr><tr><td><a class="indexterm" name="id2613257"></a><em class="parameter"><code>read only = Yes</code></em></td></tr><tr><td><a class="indexterm" name="id2613269"></a><em class="parameter"><code>guest ok = Yes</code></em></td></tr></table></div></div><br class="example-break"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>		<a class="link" href="NetCommand.html#autopoweruserscript" title="Example 13.1. ワークステーションのPower UsersグループにDomain Users を自動で追加するスクリプト">“ワークステーションのPower UsersグループにDomain Users を自動で追加するスクリプト”</a>で示されているスクリプトを		作成し、<code class="filename">autopoweruser.sh</code>という名前で		ディレクトリ<code class="filename">/etc/samba/scripts</code>中に配置する。<a class="indexterm" name="id2613093"></a><a class="indexterm" name="id2613104"></a><a class="indexterm" name="id2613111"></a>		</p></li><li class="step" title="Step 2"><p>		ログオンプロセスの一部として実行できるようにスクリプトにパーを設定する:</p><pre class="screen"><code class="prompt">root# </code> chown root:root /etc/samba/autopoweruser.sh<code class="prompt">root# </code> chmod 755 /etc/samba/autopoweruser.sh</pre><p>		</p></li><li class="step" title="Step 3"><p>		<a class="link" href="NetCommand.html#magicnetlogon" title="Example 13.2. Magic Netlogon共有">Netlogonのsmb.confファイルでの例</a>		で示されるような<code class="literal">NETLOGON</code>セクションが含むパラメータ		のように<code class="filename">smb.conf</code>ファイルを変更する。		</p></li><li class="step" title="Step 4"><p>		すべてのWindowsワークステーション管理者アカウントが、		<a class="link" href="NetCommand.html#magicnetlogon" title="Example 13.2. Magic Netlogon共有">Netlogonのsmb.confファイルでの例</a>		にあるようなスクリプト中で使われるのと同じパスワードを持つようにする。		</p></li></ol></div><p>	このスクリプトはユーザがネットワークにログオンする時には毎回実行される。	そのため、すべてのユーザはローカルWindowsワークステーションの管理権限を	持つ。これはもちろんグループを使って割り当てることが出来、その場合、	この手続きの使用のためには微少な修正ですむ。この方法の使用のための修正	点の肝心なところは、すべてのユーザがワークステーション上で適切な権限を	持つことを保証することである。	</p></div></div></div><div class="sect1" title="UNIXとWindowsのユーザ管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2613321"></a>UNIXとWindowsのユーザ管理</h2></div></div></div><p><a class="indexterm" name="id2613330"></a><a class="indexterm" name="id2613337"></a><a class="indexterm" name="id2613345"></a><a class="indexterm" name="id2613351"></a><a class="indexterm" name="id2613359"></a><a class="indexterm" name="id2613366"></a><a class="indexterm" name="id2613373"></a><a class="indexterm" name="id2613380"></a>	すべてのWindowsネットワークユーザアカウントはUNIX/Linuxユーザアカウントに変換	されねばならない。実際には、UNIX/LinuxのSambaサーバは、アカウント情報の内のUID	のみを必要とする。UIDは、システム(POSIX)アカウントか、Windowsユーザアカウントに	よって使われるために割り当てられる目的で予約されるUID番号の事前割当範囲(レンジ)	から取得される。この場合、UID事前割当範囲(訳注:pool)の場合、特定のユーザに	対するUIDは<code class="literal">winbindd</code>によって割り当てられる。	</p><p>	ここは、異なった名前を持つUNIXアカウントにWindowsユーザアカウントをマッピング	する重要な方法であ<a class="link" href="smb.conf.5.html#USERNAMEMAP" target="_top">username map</a>インタフェース機能を	議論するのにふさわしい場所ではない。この機能についての詳細は<code class="filename">smb.conf</code>ファイルの	マニュアルページを参照のこと。	</p><div class="sect2" title="ユーザアカウントの追加"><div class="titlepage"><div><div><h3 class="title"><a name="sbeuseraddn"></a>ユーザアカウントの追加</h3></div></div></div><p>	<code class="literal">net</code>経由(詳細はマニュアルページ)でのユーザの追加は以下の通り:</p><pre class="screen">net [<method>] user ADD <name> [-c container] [-F user flags] \    [misc. options] [targets]</pre><p>	ユーザアカウントのパスワードは以下の方法で設定できる:</p><pre class="screen">net rpc password <username> [<password>] -Uadmin_username%admin_pass</pre><p>	</p><p>	以下ではサーバ<code class="constant">FRODO</code>にアカウントを追加する例を示す:<a class="indexterm" name="id2613480"></a><a class="indexterm" name="id2613491"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc user add jacko -S FRODO -Uroot%not24getAdded user jacko</pre><p>	アカウントのパスワードは以下の方法で追加できる(すべて同じ操作を示す):</p><pre class="screen"><code class="prompt">root# </code> net rpc password jacko f4sth0rse -S FRODO -Uroot%not24get<code class="prompt">root# </code> net rpc user password jacko f4sth0rse \    -S FRODO -Uroot%not24get</pre><p>	</p></div><div class="sect2" title="ユーザアカウントの削除"><div class="titlepage"><div><div><h3 class="title"><a name="id2613540"></a>ユーザアカウントの削除</h3></div></div></div><p>	ユーザアカウントの削除方法は以下の通り:</p><pre class="screen">net [<method>] user DELETE <name> [misc. options] [targets]</pre><p>	以下ではユーザアカウント<code class="constant">jacko</code>を削除する:<a class="indexterm" name="id2613564"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc user delete jacko -Uroot%not24getDeleted user account</pre><p>	</p></div><div class="sect2" title="ユーザアカウントの管理"><div class="titlepage"><div><div><h3 class="title"><a name="id2613590"></a>ユーザアカウントの管理</h3></div></div></div><p>	2の基本的なユーザアカウント操作が定常的に使われる:パスワード変更とどのグループに	ユーザが所属しているかの問い合わせである。パスワード変更操作は	<a class="link" href="NetCommand.html#sbeuseraddn" title="ユーザアカウントの追加">“ユーザアカウントの追加”</a>の通り。	</p><p>	Windowsグループのメンバシップの問い合わせ能力は基本的である。以下では、リモート	サーバが、どのグループにユーザが属しているかを調べることが出来るかを示す:<a class="indexterm" name="id2613623"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc user info jacko -S SAURON -Uroot%not24getnet rpc user info jacko -S SAURON -Uroot%not24getDomain UsersDomain AdminsEngineersTorridGroupBOP ShopEmergency Services</pre><p>	</p><p>	古いユーザ名から新しいユーザ名へのユーザアカウントの改名も可能である。ただし、この操作はSambaサーバに対しては動作しないことに注意。しかし、ユーザ名の改名はWindowsサーバでは可能である。<a class="indexterm" name="id2613660"></a>	</p></div><div class="sect2" title="ユーザのマッピング"><div class="titlepage"><div><div><h3 class="title"><a name="id2613674"></a>ユーザのマッピング</h3></div></div></div><p><a class="indexterm" name="id2613682"></a><a class="indexterm" name="id2613689"></a><a class="indexterm" name="id2613696"></a>	ある条件下で、ユーザのWindowsにおけるログオン名はSambaサーバ上で持つユーザの	ログインIDと異なることは避けられない。Sambaサーバ上で、Windowsユーザ名を	異なったUNIX/Linuxユーザ名にマップできる特別なファイルを作ることが出来る。	<code class="filename">smb.conf</code>ファイルも、<code class="constant">[global]</code>セクションで以下の	パラメータを含むように変更しなければならない。</p><pre class="screen">username map = /etc/samba/smbusers</pre><p>	<code class="filename">/etc/samba/smbusers</code>ファイルの内容は以下の通り:</p><pre class="screen">parsonsw: "William Parsons"marygee: geeringm</pre><p>	この例では、Windowsユーザアカウント<span class="quote">“<span class="quote">William Parsons</span>”</span>はUNIXユーザ	<code class="constant">parsonsw</code>にマップされ、Windowsユーザアカウント	<span class="quote">“<span class="quote">geeringm</span>”</span>はUNIXユーザ<code class="constant">marygee</code>にマップされる。	</p></div></div><div class="sect1" title="管理ユーザの権限と権利"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2613764"></a>管理ユーザの権限と権利</h2></div></div></div><p><a class="indexterm" name="id2613772"></a><a class="indexterm" name="id2613779"></a><a class="indexterm" name="id2613786"></a><a class="indexterm" name="id2613793"></a><a class="indexterm" name="id2613800"></a>	3.0.11より前のすべてのSambaは、Sambaサーバ上で、ユーザ、グループ、共有、プリンタ	とその他の管理を行うのに、<code class="constant">root</code>アカウントしか使えなかった。	これは、何人かのユーザには問題を引き起こし、しばしばUNIX/Linuxシステム上で、最も	セキュリティに敏感なアカウントの権限を渡す必要があるという弱点の元であった。	</p><p><a class="indexterm" name="id2613824"></a><a class="indexterm" name="id2613831"></a><a class="indexterm" name="id2613838"></a><a class="indexterm" name="id2613845"></a><a class="indexterm" name="id2613852"></a>	Sambaバージョン3.0.11から、ユーザまたはユーザが属するグループに対して必要に応じて	管理者権限を委譲する機能が加わった。管理者特権の重要性は<a class="link" href="rights.html" title="Chapter 15. User Rights and Privileges">“User Rights and Privileges”</a>に	説明がある。ユーザ権限と権利管理に関する<code class="literal">net</code>コマンドの使用例は	この章の適切な箇所にある。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	ユーザ権限と権利が正しく設定した場合、UNIX UID=0である<code class="constant">root</code>ユーザ	(およびその同義語)のためのWindowsネットワークアカウントの必要がなくなる。初期のユーザ	権限と権利は、<code class="constant">Domain Admins</code>グループのメンバの任意のアカウントに	割り当てることが出来る。権利はグループアカウントと同じように割り当てられる。	</p></div><p>	既定値では、何らの権利と権限も割り当てられない。これは以下のコマンドを実行する	ことで以下のように表示される:</p><pre class="screen"><code class="prompt">root# </code> net rpc rights list accounts -U root%not24getBUILTIN\Print OperatorsNo privileges assignedBUILTIN\Account OperatorsNo privileges assignedBUILTIN\Backup OperatorsNo privileges assignedBUILTIN\Server OperatorsNo privileges assignedBUILTIN\AdministratorsNo privileges assignedEveryoneNo privileges assigned</pre><p>	</p><p>	<code class="literal">net</code>コマンドは、以下の方法で現在サポートされている権利と	権限を得るのに使える:<a class="indexterm" name="id2613935"></a><a class="indexterm" name="id2613942"></a><a class="indexterm" name="id2613949"></a><a class="indexterm" name="id2613956"></a><a class="indexterm" name="id2613963"></a><a class="indexterm" name="id2613970"></a><a class="indexterm" name="id2613977"></a><a class="indexterm" name="id2613984"></a><a class="indexterm" name="id2613991"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc rights list -U root%not24get     SeMachineAccountPrivilege  Add machines to domain      SePrintOperatorPrivilege  Manage printers           SeAddUsersPrivilege  Add users and groups to the domain     SeRemoteShutdownPrivilege  Force shutdown from a remote system       SeDiskOperatorPrivilege  Manage disk shares             SeBackupPrivilege  Back up files and directories            SeRestorePrivilege  Restore files and directories      SeTakeOwnershipPrivilege  Take ownership of files or other objects</pre><p>	Machine account権限は、Windows NT4以降のネットワーククライアントをドメインに	参加させるために必要である。disk operator権限は、ユーザが所有していない	オブジェクトの、共有のACLとファイルとディレクトリのACLを管理するために必要である。	</p><p>	この例では、すべての権利は<code class="constant">Domain Admins</code>グループに割り当てられる。これは、このグループのメンバが通常全権を有することになっている。この割り当ては以下のようになっている:<a class="indexterm" name="id2614045"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc rights grant "MIDEARTH\Domain Admins" \    SeMachineAccountPrivilege SePrintOperatorPrivilege \    SeAddUsersPrivilege SeRemoteShutdownPrivilege \    SeDiskOperatorPrivilege  -U root%not24getSuccessfully granted rights.</pre><p>	次に、ドメインユーザ<code class="constant">jht</code>は、日々の管理の必要性のために権限を	割り当てられる:</p><pre class="screen"><code class="prompt">root# </code> net rpc rights grant "MIDEARTH\jht" \    SeMachineAccountPrivilege SePrintOperatorPrivilege \    SeAddUsersPrivilege SeDiskOperatorPrivilege \    -U root%not24getSuccessfully granted rights.</pre><p>	</p><p>	以下のステップでは今行った変更の確認を行う:<a class="indexterm" name="id2614098"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc rights list accounts -U root%not24getMIDEARTH\jhtSeMachineAccountPrivilegeSePrintOperatorPrivilegeSeAddUsersPrivilegeSeDiskOperatorPrivilegeBUILTIN\Print OperatorsNo privileges assignedBUILTIN\Account OperatorsNo privileges assignedBUILTIN\Backup OperatorsNo privileges assignedBUILTIN\Server OperatorsNo privileges assignedBUILTIN\AdministratorsNo privileges assignedEveryoneNo privileges assignedMIDEARTH\Domain AdminsSeMachineAccountPrivilegeSePrintOperatorPrivilegeSeAddUsersPrivilegeSeRemoteShutdownPrivilegeSeDiskOperatorPrivilege</pre><p>	</p></div><div class="sect1" title="信頼関係の管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2614133"></a>信頼関係の管理</h2></div></div></div><p>	基本的な信頼関係には2つのタイプがある:最初のものは、ドメインコントローラと	ドメインメンバマシン(ネットワーククライアント)間のものであり、2番目のものは、	ドメイン間(ドメイン間信頼関係と呼ばれる)である。ドメインセキュリティに参加する	すべてのSambaサーバは、Windows NT/200x/XPワークステーションがそうであるように、	ドメインメンバシップ信頼アカウントを必要とする。	</p><div class="sect2" title="マシン信頼アカウント"><div class="titlepage"><div><div><h3 class="title"><a name="id2614152"></a>マシン信頼アカウント</h3></div></div></div><p>	それ自身の固有の設定を取得するために、netコマンドは<code class="filename">smb.conf</code>ファイルを見に行く。	そのため、以下のコマンドは、<code class="filename">smb.conf</code>から、どのドメインに参加するかを知っている。	</p><p>	Sambaサーバのドメイン信頼アカウントは以下の例のようにして確認できる:<a class="indexterm" name="id2614184"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc testjoinJoin to 'MIDEARTH' is OK</pre><p>	ここで、ドメインメンバシップアカウントがないか、アカウントの認証が無効の場合、	以下の結果が表示される:</p><pre class="screen">net rpc testjoin -S DOLPHINJoin to domain 'WORLDOCEAN' is not valid</pre><p>	</p><p>	The equivalent command for joining a Samba server to a Windows ADS domain is shown here:<a class="indexterm" name="id2614224"></a></p><pre class="screen"><code class="prompt">root# </code> net ads testjoinUsing short domain name -- TAKEAWAYJoined 'LEMONADE' to realm 'TAKEAWAY.BIZ'</pre><p>	ADSの信頼関係が確立されていない状態か、何らかの理由で無効になっている場合、	以下のエラーメッセージが表示される:</p><pre class="screen"><code class="prompt">root# </code> net ads testjoin -UAdministrator%secretJoin to domain is not valid</pre><p>	</p><p>	以下は、コマンドが実行された時にSambaサーバがターゲットのドメイン中でマシン	信頼アカウントを作成する手順を示す:<a class="indexterm" name="id2614276"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc join -S FRODO -Uroot%not24getJoined domain MIDEARTH.</pre><p>	SambaドメインにSambaサーバを参加させると、マシンアカウントが作成される。	その例は以下の通り:</p><pre class="screen"><code class="prompt">root# </code> pdbedit -Lw merlin\$merlin$:1009:9B4489D6B90461FD6A3EC3AB96147E16:\176D8C554E99914BDF3407DEA2231D80:[S          ]:LCT-42891919:</pre><p>	大カッコの中のSは、これがサーバ(PDC/BDC)アカウントであることを意味する。	ドメインの参加は、純粋にワークステーションとして参加するために処理が行われ、	その場合はSはW(ワークステーションアカウントを意味する)に置き換えられる。	これを行うには以下のコマンドを使う:<a class="indexterm" name="id2614328"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc join member -S FRODO -Uroot%not24getJoined domain MIDEARTH.</pre><p>	コマンドラインパラメータ<code class="constant">member</code>はこれをjoin固有にすること	に注意。既定値では、タイプは<code class="filename">smb.conf</code>ファイルの設定から推測される。特に、PDC又は	BDCとしてjoinするためには、コマンドラインパラメータを	<code class="constant">[PDC | BDC]</code>とする。例をあげると、<a class="indexterm" name="id2614370"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc join bdc -S FRODO -Uroot%not24getJoined domain MIDEARTH.</pre><p>	となる。これは、<code class="filename">smb.conf</code>ファイル中の設定からドメインへのjoinのタイプを	Sambaに理解させるのに最も良い方法である。	</p><p>	Windows ADSにSambaサーバをjoinさせるコマンドは以下の通り:<a class="indexterm" name="id2614409"></a></p><pre class="screen"><code class="prompt">root# </code> net ads join -UAdministrator%not24getUsing short domain name -- GDANSKJoined 'FRANDIMITZ' to realm 'GDANSK.ABMAS.BIZ'</pre><p>	</p><p>	NT4ドメインからマシンを削除するための特定のオプションはない。ドメインから削除	されるドメインメンバがWindowsマシンの場合、ドメインメンバシップアカウントは自動的	には削除されない。無効になっているドメインアカウントは、何らかのツールで削除する	ことが出来る。もしも必要ならば、マシンアカウントは以下の<code class="literal">net</code>	コマンドで削除できる:<a class="indexterm" name="id2614454"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc user delete HERRING\$ -Uroot%not24getDeleted user account.</pre><p>	削除は、マシンアカウントが末尾に$が付いたユーザアカウントのようになっている	ために可能となる。アカウント管理操作はユーザとマシンアカウントの間で同じ方法で	扱える。	</p><p>	Windows ADS メンバであるSamba-3サーバはドメインから、以下のコマンドで離脱できる:<a class="indexterm" name="id2614493"></a></p><pre class="screen"><code class="prompt">root# </code> net ads leave</pre><p>	</p><p>	ADSドメインについての詳細な情報は、以下を使ってSamba DMSマシンから得られる:<a class="indexterm" name="id2614523"></a></p><pre class="screen"><code class="prompt">root# </code> net ads status</pre><p>	この件に関する情報は非常にたくさんある。詳細は<span class="quote">“<span class="quote">Samba-3 by Example</span>”</span>	という書籍の第七章を参照してほしい。この本は書籍か、あるいはオンライン上では	<a class="ulink" href="http://www.samba.org/samba/docs/Samba3-ByExample.pdf" target="_top">Samba-3 by Example</a>	(訳注:英語版)で入手できる。	</p></div><div class="sect2" title="ドメイン間の信頼関係"><div class="titlepage"><div><div><h3 class="title"><a name="id2614566"></a>ドメイン間の信頼関係</h3></div></div></div><p>	ドメイン間の信頼関係は、あるドメインのユーザが、他のドメインでアクセス許可と	権利を得ることが出来ることについての主要なメカニズムを構成する。	</p><p>	ドメイン間の信頼歓迎がどうなっているかを調べるには、以下のコマンドを実行する:<a class="indexterm" name="id2614589"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc trustdom list -Uroot%not24getTrusted domains list:noneTrusting domains list:none</pre><p>	この時点ではドメイン間の信頼関係はない;以下のステップでこれを作成する。	</p><p>	ローカルドメインで信頼アカウントを作成することが必要である。2番目のドメイン中の	ドメインコントローラはこのアカウントを使って信頼された接続を作成できる。これは、	外部のドメインがローカルドメイン中でアクセスするために信頼されていると言うことを	意味する。このコマンドはローカル信頼アカウントを作成する:<a class="indexterm" name="id2614631"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc trustdom add DAMNATION f00db4r -Uroot%not24get</pre><p>	アカウントは<code class="literal">pdbedit</code>を使って表示できる:</p><pre class="screen"><code class="prompt">root# </code> pdbedit -Lw DAMNATION\$DAMNATION$:1016:9AC1F121DF897688AAD3B435B51404EE: \7F845808B91BB9F7FEF44B247D9DC9A6:[I         ]:LCT-428934B1:</pre><p>	信頼アカウントはいつでも大括弧の中にIという値を持っている。	</p><p>	もしも信頼されているドメインへ接続できないと、以下のコマンドは失敗する:<a class="indexterm" name="id2614685"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc trustdom list -Uroot%not24getTrusted domains list:noneTrusting domains list:DAMNATION           S-1-5-21-1385457007-882775198-1210191635</pre><p>	The above command executed successfully; a failure is indicated when the following response is obtained:</p><pre class="screen">net rpc trustdom list -Uroot%not24getTrusted domains list:DAMNATION           S-1-5-21-1385457007-882775198-1210191635Trusting domains list:DAMNATION           domain controller is not responding</pre><p>	</p><p>	信頼アカウントが外部ドメインで作成された場合、Sambaは信頼関係を外部アカウントに	対して(接続して)確立する。プロセスの中で、リモートドメイン上でリソースに対する	1方向の信頼を確立する。このコマンドは信頼関係に参加する目的を達成する:<a class="indexterm" name="id2614735"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc trustdom establish DAMNATIONPassword: xxxxxxx	== f00db4rCould not connect to server TRANSGRESSIONTrust to domain DAMNATION established</pre><p>	今確立した双方向の信頼関係の表示は以下のように行える:</p><pre class="screen"><code class="prompt">root# </code> net rpc trustdom list -Uroot%not24getTrusted domains list:DAMNATION           S-1-5-21-1385457007-882775198-1210191635Trusting domains list:DAMNATION           S-1-5-21-1385457007-882775198-1210191635</pre><p>	</p><p>	時々、外部ドメインにアクセするためのローカルユーザのための能力を取り去る必要が	ある。信頼している接続は以下のように取り去ることが出来る:<a class="indexterm" name="id2614788"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc trustdom revoke DAMNATION -Uroot%not24get</pre><p>	また別の時には、ローカルドメイン内のリソースにアクセス出来る外部ドメインから、	ユーザを削除する機能が必要な時がある。以下はこれを行えるようにする:</p><pre class="screen"><code class="prompt">root# </code> net rpc trustdom del DAMNATION -Uroot%not24get</pre><p>	</p></div></div><div class="sect1" title="セキュリティ識別子(SID)の管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2614835"></a>セキュリティ識別子(SID)の管理</h2></div></div></div><p><a class="indexterm" name="id2614843"></a><a class="indexterm" name="id2614850"></a><a class="indexterm" name="id2614857"></a><a class="indexterm" name="id2614864"></a><a class="indexterm" name="id2614871"></a>	すべてのWindowsネットワーキング操作で使われる基本的なセキュリティ識別子は	Windowsセキュリティ識別子(SID)である。すべてのWindowsネットワークマシン(サーバと	ワークステーション)、ユーザとグループはそれぞれのSIDで確認される。すべてのデス	クトッププロファイルも、ユーザが存在しているドメインのSIDに固有のユーザと	グループSIDでエンコードされる。	</p><p><a class="indexterm" name="id2614891"></a><a class="indexterm" name="id2614898"></a><a class="indexterm" name="id2614905"></a><a class="indexterm" name="id2614912"></a>	保護のためにマシンやドメインのSIDをファイルに保存することは、本当に重要である。	なぜか?なぜならば、ホスト名中かドメイン(ワークグループ)中の名前の変更点が、	SID内の変更になるかもしれないからである。SIDが手元にある場合、それを回復さ	せることは簡単な問題である。別の方法を取ると、ユーザデスクトッププロファイルを	回復しなければならず、すべてのメンバメンバマシンを再結合しなければならないとい	う手間暇で苦しむことになる。	</p><p>	最初に、ファイル中にローカルSIDを格納することを忘れないこと。<code class="filename">smb.conf</code>が保存	されているディレクトリ中に配置しておくのは良い方法である。これを行うのは	以下のように行う:<a class="indexterm" name="id2614954"></a></p><pre class="screen"><code class="prompt">root# </code> net getlocalsid > /etc/samba/my-sid</pre><p>	これで、ローカルのマシンSIDが安全に保存できた。PDC/BDC上ではドメインSID	でもある。	</p><p>	以下のコマンドは、前者が<code class="filename">my-sid</code>と呼ばれているファイル中に	入れなければならなかったことを明らかにする:</p><pre class="screen"><code class="prompt">root# </code> net getlocalsidSID for domain MERLIN is: S-1-5-21-726309263-4128913605-1168186429</pre><p>	</p><p>	もしも、<code class="filename">my-sid</code>ファイル中に格納されたSIDをリストアする	必要性がある場合、単純にSID(<code class="constant">S-1-5-21</code>で始まる文字列)を	以下のコマンドラインのように行う:<a class="indexterm" name="id2615021"></a></p><pre class="screen"><code class="prompt">root# </code> net setlocalsid S-1-5-21-1385457007-882775198-1210191635</pre><p>	マシンSIDのリストアは単純な操作であるが、バックアップコピーがないととて	も大変である。	</p><p>	以下の操作はマシンがPDCまたはBDCに設定されている時のみ有用である。DMSとワーク	ステーションクライアントは名前空間の競合の可能性を防ぐために固有のSIDを持つ	べきである。以下は、BDCのSIDをPDCに同期する例である(これは既定値の NT4	ドメインの動作である):<a class="indexterm" name="id2615060"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc getsid -S FRODO -Uroot%not24getStoring SID S-1-5-21-726309263-4128913605-1168186429 \    for Domain MIDEARTH in secrets.tdb</pre><p>	通常、ターゲットのサーバ(-S FRODO)や管理者アカウントのパスワード(-Uroot%not24get)	を指定する必要はない。	</p></div><div class="sect1" title="共有管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2615092"></a>共有管理</h2></div></div></div><p>	共有管理は、すべてのファイルサービス操作にとって主要なものである。通常の共有	操作は以下を含む:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>共有の作成/変更/削除</p></li><li class="listitem"><p>共有へのACLの設定/変更</p></li><li class="listitem"><p>サーバ間での共有の移動</p></li><li class="listitem"><p>共有内容のパーミッションの変更</p></li></ul></div><p>	上記のおのおのは、それらが必要としている範囲において、	<code class="literal">net</code>コマンドを使ってここで分けられる。このコマンドの	範囲外の操作はこの文書のどこかで触れられている。	</p><div class="sect2" title="共有の作成、編集と削除"><div class="titlepage"><div><div><h3 class="title"><a name="id2615144"></a>共有の作成、編集と削除</h3></div></div></div><p>	共有は<code class="literal">net rpc share</code>の能力を使って追加できる。ターゲットマシン	はローカルまたは-Sオプションを指定することでリモートでもよい。このツールを使った	共有の追加と削除は、適切なインタフェーススクリプトが有効であることに依存する	ことに注意しなければならない。Sambaの<code class="literal">smbd</code>が使うインタフェース	スクリプトは、<a class="link" href="smb.conf.5.html#ADDSHARECOMMAND" target="_top">add share command</a>、	<a class="link" href="smb.conf.5.html#DELETESHARECOMMAND" target="_top">delete share command</a>と	smbconfoption name="change share command"/>と呼ばれる。スクリプトの例一式は、	Sambaのソース内のディレクトリ<code class="filename">~samba/examples/scripts</code>	で提供されている。	</p><p>	以下のステップは、<code class="literal">net</code>ユーティリティの共有管理能力を使う例を	表示する。最初のステップで、<code class="constant">Bulge</code>という共有が追加される。	ファイルシステム内の共有ポイントは<code class="filename">/data</code>というディレクトリ	である。この共有を追加するためのコマンドの実行例は以下の通り:<a class="indexterm" name="id2615242"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc share add Bulge=/data -S MERLIN -Uroot%not24get</pre><p>	検証は重要なプロセスで、何もオプションを付けないで<code class="literal">net rpc share</code>	を実行することで、以下のように有効な共有のリストを得ることが出来る:</p><pre class="screen"><code class="prompt">root# </code> net rpc share -S MERLIN -Uroot%not24getprofdataarchiveBulge   <--- This one was addedprint$netlogonprofilesIPC$kyoceraADMIN$</pre><p>	</p><p>	コマンドラインツールを使って共有を削除することもしばしば好ましい。以下の手順では、	以前に作成した共有を削除する:<a class="indexterm" name="id2615300"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc share delete Bulge -S MERLIN -Uroot%not24get</pre><p>	共有が削除された結果の簡単な検証は以下の通り:</p><pre class="screen"><code class="prompt">root# </code> net rpc share -S MERLIN -Uroot%not24getprofdataarchiveprint$netlogonprofilesIPC$ADMIN$kyocera</pre><p>	</p></div><div class="sect2" title="共有のACLの作成と変更"><div class="titlepage"><div><div><h3 class="title"><a name="id2615342"></a>共有のACLの作成と変更</h3></div></div></div><p>	現時点で、<code class="literal">net</code>ツールはSamba共有上のACLを管理するのには使えない。	Microsoft Windowsの用語で、これは、共有のアクセス許可(訳注:Share Permissions)	と呼ばれる。	</p><p>	SRVTOOLの NT4ドメインサーバマネージャかコンピュータの管理のMMCスナップインの	どちらかを使うことでSamba共有上のACLを設定することが可能である。それらは	ここでは触れないので、<a class="link" href="AccessControls.html" title="Chapter 16. ファイル、ディレクトリと共有のアクセス制御">“ファイル、ディレクトリと共有のアクセス制御”</a>を参照のこと。	</p></div><div class="sect2" title="共有、ディレクトリとファイルのマイグレーション(移行)"><div class="titlepage"><div><div><h3 class="title"><a name="id2615380"></a>共有、ディレクトリとファイルのマイグレーション(移行)</h3></div></div></div><p><a class="indexterm" name="id2615388"></a>	共有とファイルはユーザ、マシンとグループアカウントと同じように移行できる。移行	プロセスを通じて、セキュリティの設定と同様にアクセス制御(ACL)の設定を保持する	ことは可能である。<code class="literal">net rpc vampire</code>昨日は、Windows NT4(か	それ以降)からSambaサーバにアカウントを移行する時に使われる。このプロセスは	パスワードとアカウントセキュリティの設定を保持し、共有とファイルの移行のための	前身である。	</p><p>	<code class="literal">net rpc share</code>コマンドは共有、ディレクトリ、ファイルとその他の	該当するデータをWindowsサーバからSambaサーバに移行するのに使うことが出来る。	</p><p>	コマンドラインスイッチは、Windowsファイルサーバのほとんど直接のクローンを作成できる。	たとえば、ファイルサーバを移行するとき、WindowsサーバのファイルのACLとDOSファイル	属性は以降プロセスの中に含まれ、移行が完了したときにSambaサーバ上で、ほとんど同じ	ように現れる。	</p><p>	以降プロセスはSambaサーバが完全に動作可能な時にのみ完了できる。ユーザとグループ	アカウントは、データの共有、ファイルとプリンタを移行する前に移行されねばならない。	ファイルとプリンタ設定の移行は、SMBとMS DCE RPCサービスの両方を使用する。移行の	プロセスでの良い方法は、あるサーバから他へのデータの転送に影響する"中間者"	(訳注:man-in-middle)による移行としてSambaサーバを使うために現在存在するように	実装されている。たとえば、もしもSambaサーバがMESSERという名前で、移行元の	Windows NTサーバがPEPPYという名前で、移行先のSambaサーバがGONZALESであれば、	マシンMESSERはすべてのデータ(ファイルと共有)をPEPPYからGONZALESに移行を行う	のに使うことが出来る。もしも移行先が指定されていない場合、ローカルサーバが	既定値として、ネットワーク上での一般的な原則のように仮定される。	</p><p>	サーバ移行を成功裏に行うには、移行作業がとても依存するプロセスのように移行元の	サーバ(かドメイン)の構造をしっかり理解しておくことが要求される。	</p><p>	移行プロセスでは2つの制限が知られている:	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>		<code class="literal">net</code>コマンドは移行元と移行先両方でユーザ資格証明が		存在することを必要とする。		</p></li><li class="listitem"><p>		プリンタの設定は完全に移行できないか不正になるかもしれない。これは、		Windows 2003 サーバをSambaに移行する際に特に発生するかもしれない。		</p></li></ol></div><div class="sect3" title="共有の移行"><div class="titlepage"><div><div><h4 class="title"><a name="id2615526"></a>共有の移行</h4></div></div></div><p>	<code class="literal">net rpc share migrate</code>コマンド操作は簡単な共有セクションの移行	ができる。セクションはファイル又はプリンタ共有が定義されているパラメータを含む。	この移行方法はパラメータとして、ファイルシステムディレクトリパス、オプション記述	と、ファイルへの書き込み許可を行う単純なセキュリティ設定を持つ共有セクションを	作成する。以下の移行で必要な最初のステップの1つは、共有セクションの設定が利用に	適しているかを確認することである。	</p><p>	共有は移行プロセスの一部として動的に作成される。<code class="literal">smbd</code>は、	<code class="filename">smb.conf</code>パラメータの<em class="parameter"><code>add share command</code></em>によって	指定されるスクリプトを実行するためにOSを呼び出すことでこのことを行う。	</p><p>	<code class="filename">$SAMBA_SOURCES/examples/scripts</code>ディレクトリ中に	<em class="parameter"><code>add share command</code></em>のための適切な例がある。移行を	行うときに使うアカウントは、必要に応じて、適切なファイルシステムへのアクセス	権とそれらに対するACL設定および共有の作成権限を持たねばならないことに注意。	そのような権限は、<em class="parameter"><code>SeAddUsersPrivilege</code></em>と	<em class="parameter"><code>SeDiskOperatorPrivilege</code></em>という権限である。	権限と権利についてのより詳細な情報は、<a class="link" href="rights.html" title="Chapter 15. User Rights and Privileges">“User Rights and Privileges”</a>を参照のこと。	</p><p>	共有の移行のためのコマンドの文法は以下の通り:</p><pre class="screen">net rpc share MIGRATE SHARES <share-name> -S <source>        [--destination=localhost] [--exclude=share1,share2] [-v]</pre><p>	When the parameter <share-name> is omitted, all shares will be migrated. The potentially	large list of available shares on the system that is being migrated can be limited using the	<em class="parameter"><code>--exclude</code></em> switch. For example:<a class="indexterm" name="id2615660"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc share migrate shares myshare\         -S win2k -U administrator%secret"</pre><p>	これは、パスワードが<code class="constant">secret</code>であるアカウント	<code class="constant">administrator</code>に結びついたパーミッションを使ったSambaサーバに	<code class="constant">win2k</code>というサーバから共有<code class="constant">myshare</code>を	移行する。使用するアカウントは移行元と移行先のSambaサーバで同じでなければ	ならない。共有の移行に先だって<code class="literal">net rpc vampire</code>を使用する	には、両方のシステムでアカウントが同じにしておく必要がある。共有の移行開始の	前に行う価値があることは、移行するアカウント(Sambaサーバ上)が必要とする権利と	権限について確認しておくことである。これは以下のように行う:<a class="indexterm" name="id2615722"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc right list accounts -Uroot%not24get</pre><p>	ここまでの手順で実行されることは、共有の移行だけである。ディレクトリと	ディレクトリ中に含まれるものは、この時点で、今までの手順では移行されない。	</p></div><div class="sect3" title="ファイルとディレクトリの移行"><div class="titlepage"><div><div><h4 class="title"><a name="id2615755"></a>ファイルとディレクトリの移行</h4></div></div></div><p>	この時点でカバーされてきたすべてのことは、ファイルとディレクトリデータの移行の	準備である。多くの人にとって、準備作業は退屈であり、ファイルとデータを使える	時になってやっと感激が得られる。次の手順は、<code class="literal">net</code>コマンドを	使ってデータファイルを転送(移行)するのに使えるテクニックを示す:	</p><p>	1つのサーバから他にファイルを転送することは、Windows NTと200xサーバが、いつでも	必要とされるツールを含んでいないために、Microsoft Windows管理者にとって挑戦的な	作業である。Windows NTからの<code class="literal">xcopy</code>コマンドはファイルと	ディレクトリのACLを保存する能力がなく、Windows 200xのみができる。Microsoftは	<code class="literal">scopy</code>と呼ばれる、ACL(セキュリティの設定)をコピーできる	ユーティリティを提供していないが、それは、Windows NT か 200xのサーバリソース	キットの一部として提供している。	</p><p>	商用またはフリーウェアでWindowsサーバから、完全なセキュリティ設定の維持をしながら	ファイルとディレクトリのコピーを行うのに使えるツールがある。よく知られている	フリーなツールで一番よいものは、<code class="literal">robocopy</code>というものである。	</p><p>	<code class="literal">net</code>ユーティリティは、DOSファイル属性と同じように、完全にACLを	保持しながらファイルとディレクトリのコピーを行うのに使える。注意すべきは、	ACLを含むことは、移行先のシステムが、移行元のシステムと同じセキュリティ	コンテキストの範囲内で	操作できるときにのみ意味をなすと言うことである。これは、	vawpireコマンドを使われたドメインからの結果のDMSとドメインコントローラの両方に	適用される。ファイルとディレクトリの移行の前にすべての共有はすでに存在しなければ	ならない。	</p><p>	移行コマンドの文法は以下の通りである:</p><pre class="screen">net rpc share MIGRATE FILES <share-name> -S <source>    [--destination=localhost] [--exclude=share1,share2]    [--acls] [--attrs] [--timestamps] [-v]</pre><p>	もしも、<share-name>パラメータが省略された場合、すべての共有が移行される。	移行元システム上での、潜在的にある大量の共有の一覧は、	<em class="parameter"><code>--exclude</code></em>コマンドスイッチで制限できる。	</p><p>	すべてのファイルのACLを保存することが必要な場合、<em class="parameter"><code>--acls</code></em>	スイッチは上記のコマンドラインに追加すべきである。オリジナルのファイルの	タイムスタンプは<em class="parameter"><code>--timestamps</code></em>スイッチを指定することで	保存でき、DOSファイル属性(すなわち hidden,archiveなど)は	<em class="parameter"><code>--attrs</code></em>スイッチを指定することで保存できる。	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>	ACLの保存の能力は、移行先のサーバ上のホストOSの一般的なファイルシステムの機能と	同じように適切なACLのサポートに依存する。Windowsファイルサーバから他への	移行は、すべてのファイル属性を完全に保存する。WindowsのACLをPOSIX ACLをサポート	しているシステム上へのマッピングが困難なため、Windows ACLをSambaサーバへ	完全に移行することはできない。	</p></div><p>	Sambaサーバ上でのACLの結果はオリジナルのACLには、おおかた一致しない。Windowsは	グループのみで所有されるファイルをサポートしている。グループのみが所有する	ファイルはUNIX/Linuxでは不可能である。移行におけるエラーは、<code class="filename">smb.conf</code>ファイル	中に<a class="link" href="smb.conf.5.html#FORCEUNKNOWNACLUSER" target="_top">force unknown acl user = yes</a>	パラメータを使うことで防ぐことが出来る。この機能は自動的に、グループのみが所有	するファイルを、Windows上でユーザが所有するファイルに修正する。	</p><p>	<code class="constant">nt4box</code>というマシンから、Sambaサーバへのファイルの移行の	手続きの例は以下の通り:<a class="indexterm" name="id2615984"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc share migrate files -S nt4box --acls \    --attrs -U administrator%secret</pre><p>	</p><p>	このコマンドは、<code class="constant">nt4box</code>というWindowsサーバから、移行作業を	始めるSambaサーバに、すべての共有の、すべてのファイルとディレクトリを移行する。	グループのみが所有するファイルは <code class="constant">administrator</code>という	ユーザアカウントが所有するようになる。	</p></div><div class="sect3" title="共有のアクセス許可の移行"><div class="titlepage"><div><div><h4 class="title"><a name="id2616026"></a>共有のアクセス許可の移行</h4></div></div></div><p>	Administratorであっても、その中に任意のファイルやディレクトリをコピー	できない、共有のアクセス許可(セキュリティ記述子)を設定することは可能である。	そのため、共有のアクセス許可は、独立した機能で用意されている:<a class="indexterm" name="id2616044"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc share migrate security -S nt4box -U administrator%secret</pre><p>	</p><p>	このコマンドは、ローカルのSambaシステムへ、nt4box上の各共有のにおける、共有の	アクセス許可のみをコピーする。	</p></div><div class="sect3" title="共有とファイルの同時移行"><div class="titlepage"><div><div><h4 class="title"><a name="id2616078"></a>共有とファイルの同時移行</h4></div></div></div><p>	以下で示される動作モードは今まで示したものを組み合わせたものである。これは	最初に共有の定義を移行し、次にすべての共有されているファイルとディレクトリを、	最後に共有のアクセス許可を移行する:</p><pre class="screen">net rpc share MIGRATE ALL <share-name> -S <source>    [--exclude=share1, share2] [--acls] [--attrs] [--timestamps] [-v]</pre><p>	</p><p>	組み合わせ移行の例は以下の通り:<a class="indexterm" name="id2616111"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc share migrate all -S w2k3server -U administrator%secret</pre><p>	これは、<em class="parameter"><code>w2k3server</code></em>サーバの完全な複製を生成する。	</p></div></div><div class="sect2" title="プリンタの移行"><div class="titlepage"><div><div><h3 class="title"><a name="id2616146"></a>プリンタの移行</h3></div></div></div><p>	新しいネットワーク環境への移行と同様、新しいサーバをインストールすることは、	しばしば家を建てることと類似している。基礎を作るところから家の構造部分の	完成までのステージは進歩がとても早いが、建築作業が完成に近づくにつれ、	仕上げ作業はより長くかかるように見える。	</p><p>	印刷の必要性は、ネットワーク環境にとても大きく依存し、とても簡単かもしれないが、	複雑かもしれない。もし必要性がとても単純ならば、印刷サポートを実装する最も良い	解決法は、古い設定から移行する代わりに、白紙の状態からすべてを再インストール	することである。別の言い方をすると、たくさんの国際オフィスとたくさんある	ローカルな支店が、印刷機能の拠点間で複雑怪奇になっているように統合された複雑な	ネットワークのプリンタ設定を移行することは、とてつもなく有望である。手動で	複雑な印刷ネットワークを再インストールするのは、とても時間がかかり、	フラストレーションが溜まる。しばしば、今使っているドライバファイルを見つける	のが困難で、より新しいバージョンのドライバのインストールが必要となる。新しい	ドライバはしばしばプリンタの使用方法の変更を必要とする印刷機能を実装している。	更に追加で、非常に複雑な印刷設定は、それがどんなに広範囲に文書化されたとしても、	同じ環境を再作成することはほとんど不可能になる。、	</p><p>	既存の印刷構成の移行は以下のように行う:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>印刷キューを確立する。</p></li><li class="listitem"><p>プリンタドライバをインストールする(プリントサーバとWindowsクライアント上両方)。</p></li><li class="listitem"><p>印刷フォームを設定する。</p></li><li class="listitem"><p>セキュリティの設定を行う。</p></li><li class="listitem"><p>プリンタの設定を行う。</p></li></ul></div><p>	Sambaの<code class="literal">net</code>ユーティリティは1つのWindowsプリントサーバから	他への移行ができる。このツールをSambaサーバ<code class="literal">smbd</code>に対して	プリンタを移行するのに使った時、必要なサービスを作成するためにネットワーク	リクエストを受け取るアプリケーションは、配下のプリンタを作成するためにOS	を呼び出さなければならない。OS呼び出しは、<code class="filename">smb.conf</code>ファイル中のパラメータ	<a class="link" href="smb.conf.5.html#" target="_top"></a>で指定することが出来るインタフェース	パラメータを経由して行われる。このスクリプトは移行プロセスで必須である。	適切なスクリプトの例は、	<code class="filename">$SAMBA_SOURCES/examples/scripts</code>から得られる。	このスクリプトはOS環境に適するようにカスタマイズせねばならず、また、プリント	キューを作成するためにこのツールを使うことも出来る。	</p><p>	上記で説明した各コンポーネントは、個別に完了することが出来、また、自動操作の	一部として完了することができる。多くのネットワーク管理者は、特に事がうまく	行かない時、移行の問題を最も手慣れた手法で対処することを好む。各操作の	文法を簡単に以下で説明する。	</p><p>	Windows サーバ(NT4または200x)からのプリンタ移行は以下である。この手順は、	プリンタ共有を、ベースとなるプリントキューとともに作成する:<a class="indexterm" name="id2616312"></a></p><pre class="screen">net rpc printer MIGRATE PRINTERS [printer] [misc. options] [targets]</pre><p>	プリンタドライバをWindowsプリントサーバからSambaサーバに移行するのには、この	コマンドライン操作を使用する:<a class="indexterm" name="id2616334"></a></p><pre class="screen">net rpc printer MIGRATE DRIVERS [printer] [misc. options] [targets]</pre><p>	以下の操作でプリンタフォームを移行できる:<a class="indexterm" name="id2616355"></a></p><pre class="screen">net rpc printer MIGRATE FORMS [printer] [misc. options] [targets]</pre><p>	プリンタのセキュリティ設定(ACL)は以下のコマンドを使うことでWindowsサーバからSambaサーバに移行できる:<a class="indexterm" name="id2616378"></a></p><pre class="screen">net rpc printer MIGRATE SECURITY [printer] [misc. options] [targets]</pre><p>	プリンタ構成の設定は、紙のサイズや既定値の紙の方向のような要素を含む。	これらは以下のコマンドを使うことでWindowsサーバからSambaサーバに移行できる:<a class="indexterm" name="id2616403"></a></p><pre class="screen">net rpc printer MIGRATE SETTINGS [printer] [misc. options] [targets]</pre><p>	</p><p>	上記で説明した情報を含むプリンタの移行は、以下の文法を使う単一のコマンドで完了しても良い:</p><pre class="screen">net rpc printer MIGRATE ALL [printer] [misc. options] [targets]</pre><p>	</p></div></div><div class="sect1" title="オープンしているファイルの制御"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2616440"></a>オープンしているファイルの制御</h2></div></div></div><p>	マニュアルページには、RAPかRPC機能呼び出しのどちらかを使うオープンしている	ファイルをクローズするためのツールを提供する、<code class="literal">net file</code>	コマンドの機能について説明がある。特定なし用法の情報についてのマニュアル	ページを参照してほしい。	</p></div><div class="sect1" title="セッションとコネクションの管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2616467"></a>セッションとコネクションの管理</h2></div></div></div><p>	<code class="literal">net session</code>コマンドのセッション管理インタフェースは、以下の	ようにSambaサーバへの接続の一覧を示すための古いRAPメソッドを使う:<a class="indexterm" name="id2616484"></a></p><pre class="screen"><code class="prompt">root# </code> net rap session -S MERLIN -Uroot%not24getComputer             User name            Client Type        Opens Idle time------------------------------------------------------------------------------\\merlin             root                 Unknown Client         0 00:00:00\\marvel             jht                  Unknown Client         0 00:00:00\\maggot             jht                  Unknown Client         0 00:00:00\\marvel             jht                  Unknown Client         0 00:00:00</pre><p>	</p><p>	セッションは以下のコマンドを実行することでクローズできる:</p><pre class="screen"><code class="prompt">root# </code> net rap session close marvel -Uroot%not24get</pre><p>	</p></div><div class="sect1" title="プリンタとADS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2616536"></a>プリンタとADS</h2></div></div></div><p>	Samba-3がMicrosoft Windows ADS環境で使われる場合、Samba経由で共有されるプリンタは	ADSドメインに対して公開されるまではブラウズできない。公開されたプリンタに関する	情報は以下の文法で、<code class="literal">net ads print info</code>コマンドを実行する	ことで、ADSから入手できる:<a class="indexterm" name="id2616560"></a></p><pre class="screen">net ads printer info <printer_name> <server_name> -Uadministrator%secret</pre><p>	もしも星印(*)がプリンタ名引数の場所で使われた場合、すべてのプリンタの一覧が返る。	</p><p>	ADSに対してプリンタを公開する(有効にする)には、以下のコマンドを実行する:<a class="indexterm" name="id2616590"></a></p><pre class="screen">net ads printer publish <printer_name> -Uadministrator%secret</pre><p>	これはローカルSambaサーバのプリンタをADSに公開する。	</p><p>	ADSからSambaプリンタを削除するには、以下のコマンドを実行する:<a class="indexterm" name="id2616618"></a></p><pre class="screen">net ads printer remove <printer_name> -Uadministrator%secret</pre><p>	</p><p>	ADSドメイン全体に渡ってプリンタの場所を調べる一般的な検索(問い合わせ)も、以下を使うことで出来る:<a class="indexterm" name="id2616646"></a></p><pre class="screen">net ads printer search <printer_name> -Uadministrator%secret</pre><p>	</p></div><div class="sect1" title="Sambaキャッシュの操作"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2616668"></a>Sambaキャッシュの操作</h2></div></div></div><p>	キャッシュ管理についての情報は、<code class="literal">net</code>マニュアルページを参照のこと。	</p></div><div class="sect1" title="IDMAP UID/SIDマッピングの管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2616686"></a>IDMAP UID/SIDマッピングの管理</h2></div></div></div><p>	<code class="literal">winbindd</code>によって、IDMAP UIDからSIDとSIDからUIDへのマッピング	は、テキストファイルにバックアップできる。テキストファイルは、手動で編集	できるが、自分自身が正確に何をやっているのかを知っている時にのみ、それを行う	ことを強く推奨する。	</p><p>	IDMAP テキストダンプファイルはリストア(再ロード)できる。この動作が必要とされる	2つの状況は次の通り: a) 存在するIDMAPファイルが壊れたか、b)編集されたマッピング	情報をインストールする必要がある場合。	</p><p>	WinbindはIDMAPファイルをダンプするためには停止しなければならない。ダンプファイルを	リストアする前に、<code class="literal">winbindd</code>を停止し、古い	<code class="filename">winbindd_idmap.tdb</code>ファイルを削除する。	</p><div class="sect2" title="IDMAPデータベースダンプファイルの作成"><div class="titlepage"><div><div><h3 class="title"><a name="id2616747"></a>IDMAPデータベースダンプファイルの作成</h3></div></div></div><p>	IDMAPデータベースは以下の方法でテキストファイルにダンプできる:</p><pre class="screen">net idmap dump <full_path_and_tdb_filename> > dumpfile.txt</pre><p>	ここで、特定のSambaのビルドのランタイムtdbファイルが、ダンプファイルを	作成するための以下のコマンドで、<code class="filename">/var/lib/samba</code>	ディレクトリに格納される:</p><pre class="screen">net idmap dump /var/lib/samba/winbindd_idmap.tdb > idmap_dump.txt</pre><p>	</p></div><div class="sect2" title="IDMAPデータベースダンプファイルのリストア"><div class="titlepage"><div><div><h3 class="title"><a name="id2616790"></a>IDMAPデータベースダンプファイルのリストア</h3></div></div></div><p>	IDMAPダンプファイルは以下のコマンドを実行することでリストアできる:</p><pre class="screen">net idmap restore idmap_dump.txt</pre><p>	ここで、データをtdbファイルにリストアするために使える以下のコマンドで、	<code class="filename">/var/lib/samba</code>ディレクトリ中にSambaのランタイムtdb	ファイルが格納される:</p><pre class="screen">net idmap restore /var/lib/samba/winbindd_idmap.tdb < idmap_dump.txt</pre><p>	</p></div></div><div class="sect1" title="その他の雑多な操作"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="netmisc1"></a>その他の雑多な操作</h2></div></div></div><p>	以下のコマンドは、Sambaドメインに関して基本的な統計を取るのに便利である。	このコマンドは現在のWindows XP Professionalクライアントでは動作しない。<a class="indexterm" name="id2616849"></a></p><pre class="screen"><code class="prompt">root# </code> net rpc infoDomain Name: RAPIDFLYDomain SID: S-1-5-21-399034208-633907489-3292421255Sequence number: 1116312355Num users: 720Num domain groups: 27Num local groups: 6</pre><p>	</p><p>	そのほかの便利なツールは、<code class="literal">net time</code>サブコマンド群である。この	サブコマンド群は以下のように、対象のサーバ上の現在の時刻を問い合わせるのに使える:<a class="indexterm" name="id2616888"></a></p><pre class="screen"><code class="prompt">root# </code> net time -S SAURONTue May 17 00:50:43 2005</pre><p>	UNIXの<code class="literal">/bin/time</code>から得られる時刻情報を渡すことが目的の場合は、	渡すために準備されたフォーマットで対象のサーバから時刻を得るのはよい方法である。	これは、以下を実行することで行える:<a class="indexterm" name="id2616919"></a></p><pre class="screen"><code class="prompt">root# </code> net time system -S FRODO051700532005.16</pre><p>	対象のサーバ上で時刻を設定するためには以下のようにする:<a class="indexterm" name="id2616946"></a></p><pre class="screen"><code class="prompt">root# </code> net time set -S MAGGOT -U Administrator%not24getTue May 17 00:55:30 MDT 2005</pre><p>	以下のコマンドを実行することで、サーバのタイムゾーンを得ることが出来る:<a class="indexterm" name="id2616973"></a></p><pre class="screen"><code class="prompt">root# </code> net time zone -S SAURON-0600</pre><p>	</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="groupmapping.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="idmapper.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 12. グループのマッピング: Microsoft Windows と UNIX </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 14. 識別情報のマッピング(IDMAP)</td></tr></table></div></body></html>