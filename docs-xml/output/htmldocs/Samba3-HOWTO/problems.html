<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 39. Sambaの問題の調査と解決方法</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="troubleshooting.html" title="Part V. トラブルシューティング"><link rel="prev" href="diagnosis.html" title="Chapter 38. Sambaチェックリスト"><link rel="next" href="bugreport.html" title="Chapter 40. バグの報告"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 39. Sambaの問題の調査と解決方法</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="diagnosis.html">Prev</a> </td><th width="60%" align="center">Part V. トラブルシューティング</th><td width="20%" align="right"> <a accesskey="n" href="bugreport.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 39. Sambaの問題の調査と解決方法"><div class="titlepage"><div><div><h2 class="title"><a name="problems"></a>Chapter 39. Sambaの問題の調査と解決方法</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Gerald</span> <span class="othername">(Jerry)</span> <span class="surname">Carter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jerry@samba.org">jerry@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">David</span> <span class="surname">Bannon</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:dbannon@samba.org">dbannon@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Dan</span> <span class="surname">Shearer</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:dan@samba.org">dan@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">8 Apr 2003</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="problems.html#id2709439">診断ツール</a></span></dt><dd><dl><dt><span class="sect2"><a href="problems.html#id2709498">Sambaそれ自身によるデバッグ</a></span></dt><dt><span class="sect2"><a href="problems.html#id2709776">Tcpdump</a></span></dt><dt><span class="sect2"><a href="problems.html#id2709827">Ethereal</a></span></dt><dt><span class="sect2"><a href="problems.html#id2709975">Windowsのネットワークモニタ</a></span></dt></dl></dd><dt><span class="sect1"><a href="problems.html#id2710347">参考となる外部情報(URL)</a></span></dt><dt><span class="sect1"><a href="problems.html#id2710388">メーリングリストにからの助言</a></span></dt><dt><span class="sect1"><a href="problems.html#id2710603">メーリングリストからの脱退方法</a></span></dt></dl></div><p><a class="indexterm" name="id2709408"></a><a class="indexterm" name="id2709414"></a><a class="indexterm" name="id2709421"></a>メーリングリスト、RFCやドキュメントのような形で、数多くの情報源が存在している。Sambaの配布物に由来するドキュメントには、ブラウジングのような一般的なSMBのトピックについての良い説明が含まれている。</p><div class="sect1" title="診断ツール"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2709439"></a>診断ツール</h2></div></div></div><p><a class="indexterm" name="id2709447"></a><a class="indexterm" name="id2709454"></a><a class="indexterm" name="id2709460"></a><a class="indexterm" name="id2709467"></a><a class="indexterm" name="id2709475"></a>SMBネットワーキングにおいて、特定の問題について、何が原因かと言うことが、簡単に分からないことがよくある。Sambaそれ自身はむしろ役立つ情報を提供するが、いくつかの例では、<span class="emphasis"><em>sniffer</em></span>を使った方がよいかもしれない。snifferはLANをモニタし、そこに送信されているデータを解析し、画面上に表示するプログラムである。</p><div class="sect2" title="Sambaそれ自身によるデバッグ"><div class="titlepage"><div><div><h3 class="title"><a name="id2709498"></a>Sambaそれ自身によるデバッグ</h3></div></div></div><p><a class="indexterm" name="id2709507"></a><a class="indexterm" name="id2709514"></a><a class="indexterm" name="id2709521"></a><a class="indexterm" name="id2709528"></a><a class="indexterm" name="id2709535"></a><a class="indexterm" name="id2709542"></a><a class="indexterm" name="id2709549"></a>問題をデバッグするための最も良い診断ツールの1つは、Sambaそれ自身である。動作するときの、<a class="link" href="smb.conf.5.html#DEBUGLEVEL" target="_top">debug level</a>を、<span class="application">smbd</span>と<span class="application">nmbd</span>両方に指定する、<code class="option">-d オプション</code>が使える。<code class="literal">smbd, nmbd</code>と<code class="filename">smb.conf</code>のマニュアルページに、デバッギングオプションに関連するより詳細な情報があるので参照すること。debug level(log level)は1(既定値)から10までを指定できる(100はパスワードデバッグ用)。</p><p><a class="indexterm" name="id2709608"></a><a class="indexterm" name="id2709615"></a><a class="indexterm" name="id2709622"></a><a class="indexterm" name="id2709629"></a><a class="indexterm" name="id2709636"></a><a class="indexterm" name="id2709642"></a><a class="indexterm" name="id2709650"></a>別の、デバッギングに便利な方法は、<code class="literal">gcc -g </code>フラグ付きでSambaをコンパイルすることである。これは、バイナリ中にデバッグ情報を埋め込み、動作中の<code class="literal">smbd/nmbd</code>プロセスに<code class="literal">gdb</code>がアタッチできるようにする。NTワークステーション向けに、ある<code class="literal">smbd</code>プロセスに<code class="literal">gdb</code>をアタッチするためには、最初にワークステーションとの接続を確立する。<em class="parameter"><code>LsaEnumTrustedDomains</code></em>を生成するのに、ctrl-alt-deleteを押し、ドメインログオン画面を表示すれば(少なくとも、最初にドメインに参加しておく)十分である。その後、ワークステーションは開いているコネクションを維持し、smbdプロセスが走り出す(短い、smbdのアイドルタイムアウトを設定していないと仮定する)。<code class="literal">ctrl-alt-delete</code>を押してからパスワードを実際に入力するまでの間に、<code class="literal">gdb</code>をアタッチでき、そのあと継続できる。</p><p>調べてみる価値のある便利なSambaのコマンドのいくつかは以下の通り:<a class="indexterm" name="id2709733"></a><a class="indexterm" name="id2709740"></a></p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>testparm | more</code></strong><code class="prompt">$ </code><strong class="userinput"><code>smbclient -L //{サーバのnetbios名}</code></strong></pre><p></p></div><div class="sect2" title="Tcpdump"><div class="titlepage"><div><div><h3 class="title"><a name="id2709776"></a>Tcpdump</h3></div></div></div><p><a class="indexterm" name="id2709784"></a><a class="indexterm" name="id2709790"></a><a class="indexterm" name="id2709797"></a><a class="ulink" href="http://www.tcpdump.org/" target="_top">Tcpdump</a>はSMBをサポートした最初のUNIX上でのsnifferである。これはコマンドラインユーティリティで、現在、そのSMBサポートは、<code class="literal">ethereal</code>や<code class="literal">tethereal</code>よりは若干遅れている。</p></div><div class="sect2" title="Ethereal"><div class="titlepage"><div><div><h3 class="title"><a name="id2709827"></a>Ethereal</h3></div></div></div><p><a class="indexterm" name="id2709835"></a><a class="ulink" href="http://www.ethereal.com/" target="_top">Ethereal</a>は、GUIのsnifferで、UNIX(Gtk)とWindows両方で使える。EtherealのSMBサポートはとても良い。<code class="literal">ethereal</code>の使用法の詳細は、良くできているEthereal User Guideを読むこと。</p><div class="figure"><a name="ethereal1"></a><p class="title"><b>Figure 39.1. キャプチャの開始</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/ethereal1.png" alt="キャプチャの開始"></div></div></div><br class="figure-break"><p><a class="indexterm" name="id2709898"></a>ポート137,138,139,445をリッスン。例えば、<a class="link" href="problems.html#ethereal1" title="Figure 39.1. キャプチャの開始">キャプチャの開始</a>画面であるように、<strong class="userinput"><code>port 137, port 138,port 139,か port 445</code></strong>をフィルタとして使う。</p><p><code class="literal">tethereal</code>という名前のコンソールバージョンのecherealもある。</p><div class="figure"><a name="ethereal2"></a><p class="title"><b>Figure 39.2. Etherealメインデータウィンドウ</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/ethereal2.png" alt="Etherealメインデータウィンドウ"></div></div></div><br class="figure-break"></div><div class="sect2" title="Windowsのネットワークモニタ"><div class="titlepage"><div><div><h3 class="title"><a name="id2709975"></a>Windowsのネットワークモニタ</h3></div></div></div><p><a class="indexterm" name="id2709983"></a><a class="indexterm" name="id2709990"></a><a class="indexterm" name="id2709997"></a><a class="indexterm" name="id2710004"></a><a class="indexterm" name="id2710011"></a><a class="indexterm" name="id2710018"></a>Microsoft Windows NT上での同等品は、ネットワークモニタ(Netmonとして知られる)が、Microsoft Developer Network CD、Windows NTサーバインストールCDとSMSのCD中ににある。SMSに同梱されているnetmonは任意の2つのコンピュータ間のパケットをダンプできる(すなわち、ネットワークインタフェースをpromiscuousモードにする)。NTサーバインストールCDに同梱されているものは、ローカルのNTマシンに直接来るネットワークトラフィックとローカルなサブネットのブロードキャストのみモニタできる。etherealはnetmon形式のファイルを読み書き出来る事に注意。</p><div class="sect3" title="NTワークステーション上へのネットワークモニタのインストール"><div class="titlepage"><div><div><h4 class="title"><a name="id2710051"></a>NTワークステーション上へのネットワークモニタのインストール</h4></div></div></div><p><a class="indexterm" name="id2710061"></a>NTワークステーション上へのインストールには、多くの手順が必要である。以下は、Microsoft Windows Workstation 4.0上にMicrosoft Windows NT Server 4.0から持ってきたNetmon V4.00.349をインストールする手順である。この手順はNetmonの、他のWindows NTバージョンからのものと同等である。Microsoft Windows NT Server 4.0インストールCDとWorkstation 4.0のインストールCDの両方が必要である。</p><p><a class="indexterm" name="id2710082"></a>最初に、以下のようにして、NTサーバ上に<span class="application">ネットワークモニタツールとエージェント</span>をインストールする必要がある:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="guibutton">スタート</span>-><span class="guibutton">設定</span>-><span class="guibutton">コントロールパネル</span>->	<span class="guibutton">ネットワーク</span>-><span class="guibutton">サービス</span>-><span class="guibutton">追加</span>	を表示する。</p></li><li class="listitem"><p><span class="guilabel">ネットワークモニタツールとエージェント</span>を選択し、<span class="guibutton">OK</span>を	クリックする。</p></li><li class="listitem"><p>ネットワークコントロールパネル上の<span class="guibutton">OK</span>をクリックする。</p></li><li class="listitem"><p>要求されたならば、Microsoft NT Server 4.0のインストールCDを挿入する。</p></li></ul></div><p>この時点で、Netmonファイルは<code class="filename">%SYSTEMROOT%\System32\netmon\*.*</code>に存在すべきである。Netmonがパケットダンプを解析するために必要なDLLを含む<code class="filename">parsers\</code>と、<code class="filename">captures\</code>という2つのサブディレクトリも同様に存在する。</p><p>NT ワークステーション上にNetmonをインストールするためには、ワークステーションインストールCDかr、ネットワークモニタエージェントを最初にインストールする必要がある。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="guibutton">スタート</span>-><span class="guibutton">設定</span>->	<span class="guibutton">コントロールパネル</span>-><span class="guibutton">ネットワーク</span>->	<span class="guibutton">サービス</span>-><span class="guibutton">追加</span>を表示する。</p></li><li class="listitem"><p><span class="guilabel">ネットワークモニタエージェント</span>を選択し、	<span class="guibutton">OK</span>をクリックする。</p></li><li class="listitem"><p>ネットワークコントロールパネル上の<span class="guibutton">OK</span>を	クリックする。</p></li><li class="listitem"><p>要求されたならば、Windows NT Workstation 4.0インストールCDを挿入する。</p></li></ul></div><p>そうすると、ワークステーション上の<code class="filename">%SYSTEMROOT%\System32\netmon</code>に、NTサーバ上の<code class="filename">%SYSTEMROOT%\System32\netmon</code>からファイルをコピーし、使用しているサイトに適切と見なされるアクセス許可を設定する。NetmonをNTマシン上で動作させるには、管理者権限が必要である。</p></div><div class="sect3" title="Windows 9x/Meへのネットワークモニタのインストール"><div class="titlepage"><div><div><h4 class="title"><a name="id2710314"></a>Windows 9x/Meへのネットワークモニタのインストール</h4></div></div></div><p>NetmonをWindows 9x/Meにインストールするためには、Windows 9x/Me CD(<code class="filename">\admin\nettools\netmon</code>)からネットワークモニタエージェントをインストールする。どのようにこれを行うかについて情報が必要であれば、CD上のNetmonドライバファイルと一緒にreadmeファイルが用意されている。Netmonインストール先からファイルをコピーする。</p></div></div></div><div class="sect1" title="参考となる外部情報(URL)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2710347"></a>参考となる外部情報(URL)</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>BDCの動作をScott Merrillがシミュレートしたかについては       <a class="ulink" href="http://www.skippy.net/linux/smb-howto.html" target="_top">       http://www.skippy.net/linux/smb-howto.html</a>を参照(訳注:現存せず)。</p></li><li class="listitem"><p>古いSMBの仕様については       <a class="ulink" href="ftp://ftp.microsoft.com/developr/drg/CIFS/" target="_top">       ftp://ftp.microsoft.com/developr/drg/CIFS/</a>というFTPサイトにある(訳注:現存せず)。</p></li></ul></div></div><div class="sect1" title="メーリングリストにからの助言"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2710388"></a>メーリングリストにからの助言</h2></div></div></div><p>Sambaに関連した数多くのメーリングリストがある。<a class="ulink" href="http://samba.org" target="_top">http://samba.org</a>に移動し、最も近いミラーサーバを選択し、<code class="literal">Support</code>をクリックする。次に、<code class="literal">Samba-related mailing lists</code>をクリックする。</p><p>Samba TNGに関連する質問は、<a class="ulink" href="http://www.samba-tng.org/" target="_top">http://www.samba-tng.org/</a>にある。メインストリームのSambaメーリングリストには、Samba-TNGに関連する質問を投稿しないこと。</p><p>メーリングリストのどれかに投稿したいのであれば、以下のガイドラインをよく読んでほしい:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2710450"></a>	いつも覚えておいてほしいのは、開発者はボランティアであるということである。	ある時点までに特定の機能を作る事について、開発者はお金をもらっているわけでも、	保証しているわけでもない。どの予定も<span class="quote">“<span class="quote">希望的観測</span>”</span>であり、それ以上の	ものではない。	</p></li><li class="listitem"><p><a class="indexterm" name="id2710476"></a>	常時、どのバージョンのSambaを使っていて、それが動いているOSが何かと言うことを	説明すること。使用している<code class="filename">smb.conf</code>の適切なセクションを、少なくともPDCサポートに	影響する<em class="parameter"><code>[global]</code></em>中のオプションは提示すること。	</p></li><li class="listitem"><p>バージョンについては、もしもCVS(訳注:現在はgit)経由でSambaを	入手したならば、最後にチェックアウトした日付を提示すること。</p></li><li class="listitem"><p>質問を明確に、手短にするよう心がけること。とても長い、複雑な	質問は、それが完全に読まれる前に捨てられてしまう!HTMLエンコードして投稿しないこと。	メーリングリストを購読しているほとんどの人は、それを読まないで捨ててしまう。	</p></li><li class="listitem"><p>もしも、不在時に、<span class="quote">“<span class="quote">ただいま留守にしております</span>”</span>	 というような気の利いたメッセージを返しているのであれば、メーリングリストに	 返信しないように設定すること。メーリングリストへの自動応答は、このような	 ネット上での好まれない対応に応対しなければならない、何千もの人々をいらつかせて	 しまう。	</p></li><li class="listitem"><p><a class="indexterm" name="id2710548"></a>	クロスポストしないこと。どのメーリングリストが最適かを調べて投稿し、何が	起きたかを確かめてみること。samba-ntdomとsamba-technical両方に投稿しないこと。	多くの人は、1つ以上のメーリングリストに参加していて、2回以上同じ記事を	見るといらだってくる。他のメーリングリストで、記事を取り扱った方がよいと	考えている誰かは、しばしばその投稿記事を転送してくれている。	</p></li><li class="listitem"><p>おおよそ20でログレベルが設定されて記録されたログファイルを	<span class="emphasis"><em>部分的に</em></span>含めても良い。ログ全体を送ってはならないが、	エラーメッセージが分かるためのひとまとまりの部分ならばよい。	</p></li><li class="listitem"><p>もしも、完全なNetmonトレース(開始からエラー時点まで)が	あるならば、同じように*.CAPファイルを投稿しても良いだろう。</p></li><li class="listitem"><p>メールにドキュメントを添付する前に熟考すること。投稿記事	本体中に適切な部分を貼り付けることを考えること。Sambaメーリングリストは	とても多くの人に配信している。使用している<code class="filename">smb.conf</code>のコピーが、すべての	人に必要だろうか?</p></li></ul></div></div><div class="sect1" title="メーリングリストからの脱退方法"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2710603"></a>メーリングリストからの脱退方法</h2></div></div></div><p>Sambaメーリングリストから脱退するには、参加申し込みをしたと同じページ、<a class="ulink" href="http://lists.samba.org/" target="_top">http://lists.samba.org</a>の最も近いミラーに行き、<code class="literal">Support</code>をクリックし、<code class="literal">Samba-related mailing lists</code>をクリックする。</p><p>脱退方法についてメーリングリストに投稿しないこと。(何らかの理由で処理がうまく行かなかった場合を除いて)上記のアドレスのみを参照すべきである。</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="diagnosis.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="troubleshooting.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="bugreport.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 38. Sambaチェックリスト </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 40. バグの報告</td></tr></table></div></body></html>