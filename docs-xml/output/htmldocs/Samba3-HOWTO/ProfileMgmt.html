<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 27. デスクトッププロファイルの管理</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="PolicyMgmt.html" title="Chapter 26. システムとアカウントポリシー"><link rel="next" href="pam.html" title="Chapter 28. PAM ベースの分散型認証"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 27. デスクトッププロファイルの管理</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="PolicyMgmt.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="pam.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 27. デスクトッププロファイルの管理"><div class="titlepage"><div><div><h2 class="title"><a name="ProfileMgmt"></a>Chapter 27. デスクトッププロファイルの管理</h2></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">April 3 2003</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="ProfileMgmt.html#id2681712">その特長と利点</a></span></dt><dt><span class="sect1"><a href="ProfileMgmt.html#id2681779">移動プロファイル</a></span></dt><dd><dl><dt><span class="sect2"><a href="ProfileMgmt.html#id2681852">プロファイル処理のための Samba の設定</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2682544">Windows クライアントのプロファイル設定に関する情報</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2684078">User Profile Hive Cleanup Service</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2684122">Windows 9x/Me と NT4/200x/XP ワークステーション間でプロファイルを共有する</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2684250">Windows NT4/200x サーバーから Samba にプロファイルを移行する</a></span></dt></dl></dd><dt><span class="sect1"><a href="ProfileMgmt.html#id2684654">必須プロファイル</a></span></dt><dt><span class="sect1"><a href="ProfileMgmt.html#id2684816">グループプロファイルの作成と管理</a></span></dt><dt><span class="sect1"><a href="ProfileMgmt.html#id2684914">Windows ユーザーのデフォルトプロファイル</a></span></dt><dd><dl><dt><span class="sect2"><a href="ProfileMgmt.html#id2684950">MS Windows 9x/Me</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2685144">MS Windows NT4 Workstation</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2685784">MS Windows 200x/XP</a></span></dt></dl></dd><dt><span class="sect1"><a href="ProfileMgmt.html#id2686392">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="ProfileMgmt.html#id2686406">少人数のユーザやグループのための移動プロファイルの設定</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2686489">移動プロファイルを使えない</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2686735">デフォルトプロファイルを変更する</a></span></dt><dt><span class="sect2"><a href="ProfileMgmt.html#id2686926">移動プロファイルと NT4 スタイルのドメインポリシーのデバッグ</a></span></dt></dl></dd></dl></div><div class="sect1" title="その特長と利点"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2681712"></a>その特長と利点</h2></div></div></div><p><a class="indexterm" name="id2681720"></a>移動プロファイルは一部の人にとっては恐れられており、これを忌み嫌う人もいないではないが、また多くの人に愛されてもいる。これを天の恵みだと考えている管理者もいる。</p><p><a class="indexterm" name="id2681738"></a>ユーザーが使用するマシンを毎回変えるような環境であっても、ローミングプロファイルを使えば管理者は常に同じユーザーデスクトップ環境を提供できる。この章では移動プロファイルの構成と管理の手法に関する多くの情報を提供する。</p><p><a class="indexterm" name="id2681759"></a>移動プロファイルはある種、楽園のように聞こえる人もいるかもしれないが、その他の人々にとっては、これは現実の、そして目に見える問題でもある。特に、接続状態が安定しないモバイルコンピューティング機器を利用するユーザーは、純粋なローカルプロファイルを使うケースが多いであろう。この章では Samba の管理者がこのような状況に対処するための手助けになるような情報を提供する。</p></div><div class="sect1" title="移動プロファイル"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2681779"></a>移動プロファイル</h2></div></div></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>移動プロファイルのサポートは、Windows 9x/Me と Windows NT4/200x でそれぞれ異なる。</p></div><p>移動プロファイルの構成方法について論じるのに先立って、Windows 9x/Me と Windows NT4/200x クライアントが、それぞれどのようにこれらの機能を実装しているのかを知ることもまた有用であろう。</p><p><a class="indexterm" name="id2681809"></a>Windows 9x/Me クライアントは NetUserGetInfo リクエストをサーバーに送り、ユーザープロファイルの場所を取得する。しかしながら、その応答の中には分割されたプロファイルの位置を保持するためのフィールドを格納する領域はなく、単にそのユーザーの home 共有が渡されるだけである。つまり、Windows 9x/Me のプロファイルでは、プロファイルをユーザーのホームディレクトリーに格納することしかできない。</p><p><a class="indexterm" name="id2681830"></a><a class="indexterm" name="id2681836"></a>Windows NT4/200x クライアントは NetSAMLogon RPC リクエストを送る。これには多くのフィールドがあり、分割されたユーザープロファイルの位置を表す情報も含まれている。</p><div class="sect2" title="プロファイル処理のための Samba の設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2681852"></a>プロファイル処理のための Samba の設定</h3></div></div></div><p>この章では MS Windows クライアントのプロファイルサポートのためのSamba の設定について解説する。</p><div class="sect3" title="NT4/200x のユーザープロファイル"><div class="titlepage"><div><div><h4 class="title"><a name="id2681866"></a>NT4/200x のユーザープロファイル</h4></div></div></div><p>たとえば、Windows NT4/200x をサポートする場合、以下の設定を<code class="filename">smb.conf</code> ファイルの [global] セクションに書けばよい。</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2681893"></a><em class="parameter"><code>logon path =  \\profileserver\profileshare\profilepath\%U\moreprofilepath</code></em></td></tr></table><p>これは一般に以下のような実装を表している：</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2681915"></a><em class="parameter"><code>logon path = \\%L\Profiles\%U</code></em></td></tr></table><p>ここで<span class="quote">“<span class="quote">%L</span>”</span>は Samba サーバーの名前に置き換えられ、<span class="quote">“<span class="quote">%U</span>”</span>はユーザー名に置き換えられる。</p><p>このオプションのデフォルトは <code class="filename">\\%N\%U\profile</code>すなわち <code class="filename">\\sambaserver\username\profile</code> である。<code class="filename">\\%N\%U</code> サービスは [homes] サービスにより自動的に生成される。Samba サーバー経由でプロファイルを使う場合は、logon path で指定された共有をブラウズ可能にしておかなければならない。<span class="quote">“<span class="quote">%L</span>”</span> と <span class="quote">“<span class="quote">%N</span>”</span> の違いや <span class="quote">“<span class="quote">%U</span>”</span> と<span class="quote">“<span class="quote">%u</span>”</span> の違いについては <code class="filename">smb.conf</code> の man ページを参照してほしい。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2681995"></a><a class="indexterm" name="id2682002"></a>MS Windows NT/200x クライアントは、時々ログオン完了後もサーバーへのコネクションを切断しないことがある。プロファイルの共有パスにはメタサービス名である <em class="parameter"><code>homes</code></em> を使用しない方がよいだろう。</p></div></div><div class="sect3" title="Windows 9x/Me ユーザープロファイル"><div class="titlepage"><div><div><h4 class="title"><a name="id2682026"></a>Windows 9x/Me ユーザープロファイル</h4></div></div></div><p><a class="indexterm" name="id2682035"></a><a class="indexterm" name="id2682042"></a>Windows 9x/Me クライアントをサポートするには、<a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home</a>パラメータを使用すること。Sambaが修正され、<em class="parameter"><code>logon home</code></em>パラメータを信頼する<strong class="userinput"><code>net use /home</code></strong>も動作するようになった。</p><p><a class="indexterm" name="id2682079"></a><a class="indexterm" name="id2682086"></a><a class="indexterm" name="id2682093"></a><em class="parameter"><code>logon home</code></em> パラメータを指定すると Windows 9x/Me のプロファイルの格納位置はユーザーのホームディレクトリーに制限される。しかし待って欲しい。実はこれは裏技的なやり方である。<code class="filename">smb.conf</code> ファイルの<em class="parameter"><code>[global]</code></em> セクションに</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2682132"></a><em class="parameter"><code>logon home = \\%L\%U\.profiles</code></em></td></tr></table><p>を記載すると、Windows 9x/Me クライアントはちゃんと自分のプロファイルをホームディレクトリー配下の <code class="filename">.profiles</code> という隠しディレクトリーに正しく保存するようになる。</p><p><a class="indexterm" name="id2682160"></a>これだけではなく、<strong class="userinput"><code>net use /home</code></strong> は Windows 9x/Meにおける機能のためにもなる。これはホームディレクトリーにあるすべてのディレクトリーを削除し、サーバーと共有部分のみを使用する。すなわち、あたかも <a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home</a> に<code class="filename">\\%L\%U</code> を指定したように振舞う。</p></div><div class="sect3" title="Windows Windows 9x/Me と NT4/200x のユーザープロファイルの混在"><div class="titlepage"><div><div><h4 class="title"><a name="id2682203"></a>Windows Windows 9x/Me と NT4/200x のユーザープロファイルの混在</h4></div></div></div><p><a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home</a> と<a class="link" href="smb.conf.5.html#LOGONPATH" target="_top">logon path</a> 両方のパラメータをセットすると、Windows 9x と Windows NT クライアントの両方をサポートできるようになる。たとえば、</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2682248"></a><em class="parameter"><code>logon home = \\%L\%U\.profiles</code></em></td></tr><tr><td><a class="indexterm" name="id2682260"></a><em class="parameter"><code>logon path = \\%L\profiles\%U</code></em></td></tr></table><p><a class="indexterm" name="id2682274"></a>Windows 9x/Me と NT4 およびそれより新しいプロファイルは、同じ位置に格納するべきではない。なぜなら、Windows NT4 とそれ以降のクライアントはプロファイルが混在した環境で問題を起こすからである。</p></div><div class="sect3" title="移動プロファイルサポートを無効にする"><div class="titlepage"><div><div><h4 class="title"><a name="id2682293"></a>移動プロファイルサポートを無効にする</h4></div></div></div><p><a class="indexterm" name="id2682301"></a>しばしば行われる質問として、<span class="quote">“<span class="quote">強制的にローカルプロファイルにするには？</span>”</span>や<span class="quote">“<span class="quote">どうやったら移動プロファイルを無効にできるか？</span>”</span>といったものがある。</p><p><a class="indexterm" name="id2682323"></a>これには、３つのやり方がある：</p><a class="indexterm" name="id2682333"></a><div class="variablelist"><dl><dt><span class="term"><code class="filename">smb.conf</code> において</span></dt><dd><p><a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home =  </a> および <a class="link" href="smb.conf.5.html#LOGONPATH" target="_top">logon path =  </a>を適用すると、すべてのクライアントがローカルプロファイルを使うようになる。        </p><p>これらのパラメータへの引数はブランクのままにしておかなければならない。空の値を設定する場合でも <code class="constant">=</code> 記号は必要である。		</p></dd><dt><span class="term">MS Windows レジストリ:</span></dt><dd><p><a class="indexterm" name="id2682413"></a><a class="indexterm" name="id2682420"></a>マイクロソフト管理コンソール(MMC)の <code class="literal">gpedit.msc</code>を使って、その Windows XP マシンがローカルプロファイルだけを使うようにする。もちろんこれはレジストリの設定を変更する。オプションへのフルパスは以下の通り：</p><pre class="screen">ローカル・コンピュータ・ポリシー\	コンピュータの構成\		管理用テンプレート\			システム\				ユーザープロファイル\無効: ローカルユーザープロファイルのみを許可する無効: 移動プロファイルへの変更をサーバーに伝達しない</pre><p>	</p></dd><dt><span class="term">プロファイルタイプの変更：</span></dt><dd><p>スタートメニューのマイコンピュータ・アイコンで右クリックし、<span class="guimenuitem">プロパティ</span>の詳細設定タブを開く。<span class="guilabel">ユーザープロファイル</span>の設定で変更したいプロファイルを選んで「種類の変更」をクリックし、<span class="guimenu">移動プロファイル</span>を<span class="guimenu">ローカルプロファイル</span>に変更する。		</p></dd></dl></div><p>特定バージョンの MS Windows において、どのレジストリキーを変更すれば強制的にローカルプロファイルになるのかは、MS Windows レジストリガイドを参照のこと。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2682523"></a>ローカルプロファイルを移動プロファイルに、もしくはその逆方向に変換する方法は、稼働中の MS Windows のバージョンに大きく依存する。バージョン固有の情報については MS Windows リソースキットを参照してほしい。</p></div></div></div><div class="sect2" title="Windows クライアントのプロファイル設定に関する情報"><div class="titlepage"><div><div><h3 class="title"><a name="id2682544"></a>Windows クライアントのプロファイル設定に関する情報</h3></div></div></div><div class="sect3" title="Windows 9x/Me のプロファイル設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2682552"></a>Windows 9x/Me のプロファイル設定</h4></div></div></div><p>ユーザーが最初に Windows 9x にログインすると、user.DAT ファイルが生成される。その中には <code class="filename">スタートメニュー</code>, <code class="filename">デスクトップ</code>, <code class="filename">プログラム</code>, <code class="filename">近くのコンピュータ</code> というフォルダーが入る。二度目以降のログイン時は、これらのディレクトリーとその中身がマージされて <code class="filename">c:\windows\profiles\ユーザー名</code> に格納される。これらにはそれぞれ最新の情報が入る。	ここで、プロファイルフォルダー内のショートカットを常に大文字で見せるために<em class="parameter"><code>[global]</code></em> オプションを、それぞれ<a class="link" href="smb.conf.5.html#PRESERVECASE" target="_top">preserve case = yes</a>, <a class="link" href="smb.conf.5.html#SHORTPRESERVECASE" target="_top">short preserve case = yes</a>, and <a class="link" href="smb.conf.5.html#CASESENSITIVE" target="_top">case sensitive = no</a> のように設定する必要がある。</p><p><a class="indexterm" name="id2682656"></a><a class="indexterm" name="id2682662"></a><code class="filename">user.DAT</code> ファイルにはそれぞれのユーザーの設定項目が入っている。これらの設定を強制したい場合は、それぞれの<code class="filename">user.DAT</code> ファイルを <code class="filename">user.MAN</code> にリネームし、さらにこれらのファイルを書き込み禁止にしておく。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Windows 9x/Me マシンでは、<span class="guimenu">コントロールパネル</span> -><span class="guimenuitem">パスワード</span> に入って<span class="guilabel">ユーザー・プロファイル</span>タブを選ぶ。要求する移動設定のレベルを選択して<span class="guibutton">OK</span> を押すが、ここではコンピュータのリブートを行わない。	</p></li><li class="listitem"><p>Windows 9x/Me マシンでは、<span class="guimenu">コントロールパネル</span> -><span class="guimenuitem">ネットワーク</span> -> <span class="guimenuitem">マイクロソフトネットワークのクライアント</span> -><span class="guilabel">Preferences</span>に行き、<span class="guilabel">NTドメインにログオン</span>を選択する。そしてプライマリログオン（通常のログオン方法？）が<span class="guimenuitem">マイクロソフトネットワークのクライアント</span>になっていることを確認して<span class="guibutton">OK</span> を押す。ここでコンピュータをリブートする。	</p></li></ol></div><p><a class="indexterm" name="id2682800"></a><a class="indexterm" name="id2682807"></a><a class="indexterm" name="id2682814"></a><a class="indexterm" name="id2682821"></a>Windows 9x/Me では、プロファイルはプライマリ・ログオンからダウンロードされる。プライマリ・ログオンが<span class="quote">“<span class="quote">ノベルネットワーク用クライアント</span>”</span>になっている場合、プロファイルとログオンスクリプトは使用中のノベルサーバーからダウンロードされる。プライマリ・ログオンが<span class="quote">“<span class="quote">Windows ログオン</span>”</span>になっている場合、プロファイルは移動プロファイルの考え方から少しはずれてローカルマシンの  からロードされる。</p><p><a class="indexterm" name="id2682860"></a>マイクロソフトネットワークのログインダイアログには<code class="constant">[ユーザー名, パスワード]</code>だけに代わって<code class="constant">[ユーザー名, パスワード, ドメイン]</code>が表示されていることにお気づきだろうか？ここで Samba サーバーのドメイン名、およびユーザー名、パスワードを入力する。なお、Samba サーバーの代わりに存在することがわかっているドメイン名を入力してもよい。その場合、そのドメインによってユーザー認証が行われ、さらにそのドメインのログオンサーバーがサポートしていれば、プロファイルがそのサーバーからダウンロードされる。</p><p>そのユーザーの正当性が確認されると、Windows 9x/Me マシンは<code class="computeroutput">このユーザーは過去に一度もログインされていません</code>を表示し、<code class="computeroutput">このユーザーの設定情報を保存しますか？</code>と聞いてくるので<span class="guibutton">Yes</span>で答える。</p><p>Windows 9x/Me のデスクトップが起動したら、Samba サーバー上の<a class="link" href="smb.conf.5.html#LOGONPATH" target="_top">logon path</a> にあるディレクトリーの中に<code class="filename">デスクトップ</code>, <code class="filename">スタートメニュー</code>,<code class="filename">プログラム</code>, <code class="filename">近くのコンピュータNethood</code> フォルダー群が作られていることがわかるだろう。</p><p><a class="indexterm" name="id2682972"></a><a class="indexterm" name="id2682979"></a><a class="indexterm" name="id2682986"></a>これらのフォルダーはクライアント上でローカルでキャッシュされ、（事前にリードオンリーに設定しておかない限り）ユーザーのログオフ時に更新される。ユーザーがさらにフォルダーやショートカットを作ると、クライアントはこれらをすでにダウンロード済みのプロファイルの中身とマージして、それらの中から最新のフォルダーやショートカットを選択する。</p><p><a class="indexterm" name="id2683006"></a><a class="indexterm" name="id2683013"></a><a class="indexterm" name="id2683020"></a><a class="indexterm" name="id2683027"></a>Samba サーバー上のフォルダー／ファイルをリードオンリーにしていた場合、Windows 9x/Me はログオンやログアウト時にローカルとリモートのプロファイルをマージしようとしてエラーが発生する。基本的にWindows 9x/Me でエラーが出たら、Samba サーバー上のプロファイルディレクトリーで、UNIX 側のファイルのパーミッションや所有者の権限をチェックしてみてほしい。</p><p><a class="indexterm" name="id2683048"></a><a class="indexterm" name="id2683056"></a><a class="indexterm" name="id2683063"></a><a class="indexterm" name="id2683070"></a><a class="indexterm" name="id2683078"></a>ユーザープロファイルの生成で失敗する場合、そのユーザーのローカルデスクトップのキャッシュを後述の要領でリセットしてやるとよい。このユーザーが次回ログオンした時、<span class="quote">“<span class="quote">今回はじめて</span>”</span>ログオンした旨のメッセージが表示される。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>    [ユーザー名, パスワード, ドメイン] ダイアログでログオンする代わりに    <span class="guibutton">エスケープ</span>を押す。	</p></li><li class="listitem"><p>	<code class="literal">regedit.exe</code> を起動して以下のエントリを探す：	</p><p>	<code class="filename">HKEY_LOCAL_MACHINE\Windows\CurrentVersion\ProfileList</code>	</p><p>	ここに各ユーザーの ProfilePath があるので（このキーの内容は	<code class="filename">c:\windows\profiles\ユーザー名</code>と同様である）、この中で	該当するユーザーの <em class="parameter"><code>ProfilePath</code></em> キーを削除する。	</p></li><li class="listitem"><p>	レジストリエディタを終了する。	</p></li><li class="listitem"><p>	<code class="filename">c:\windows</code> ディレクトリー配下から当該ユーザーの	パスワードチェインファイル .PWL を見つけ、これを削除する。	</p></li><li class="listitem"><p>	Windows 9x/Me クライアントをログオフする。	</p></li><li class="listitem"><p>	プロファイルパスの中身（前述の <a class="link" href="smb.conf.5.html#LOGONPATH" target="_top">logon path</a>	を参照）を確認し、ユーザーの <code class="filename">user.DAT</code> または	<code class="filename">user.MAN</code> を、必要であればバックアップを取ってから	削除する。	</p></li></ol></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a class="indexterm" name="id2683233"></a><em class="parameter"><code>ProfilePath</code></em>（おそらく <code class="filename">c:\windows\profiles\username</code>）の一覧にあるディレクトリーの中身を削除する前に、各ユーザーのデスクトップやスタートメニューに重要なファイルがないかどうかを確認しておく。<em class="parameter"><code>ProfilePath</code></em> ディレクトリーの中身を（必要であればバックアップを取ってから）削除する。</p><p>これで、各ユーザーのプロファイルディレクトリーにある（それぞれがリードオンリーでかつ隠しファイル、システムファイルである）ローカルの<code class="filename">user.DAT</code>, <span class="quote">“<span class="quote">desktop</span>”</span>, <span class="quote">“<span class="quote">nethood</span>”</span>, <span class="quote">“<span class="quote">start menu</span>”</span>, <span class="quote">“<span class="quote">programs</span>”</span>といったフォルダーが削除される。</p></div><p><a class="indexterm" name="id2683300"></a><a class="indexterm" name="id2683307"></a><a class="indexterm" name="id2683314"></a><a class="indexterm" name="id2683321"></a>八方手を尽くしてもだめなら、Samba のログレベルを 3 から 10 まで増やしてみて、さらに ethereal や <code class="literal">netmon.exe</code> といったコマンドでパケットをキャプチャしてエラーメッセージ等を捕捉してみる。</p><p><a class="indexterm" name="id2683346"></a><a class="indexterm" name="id2683353"></a>Windows NT4/200x サーバーへのアクセス権を持っている場合は、まず Windows NT4/200x サーバー上で移動プロファイルや netlogon の設定を行う。その後 Windows NT4/200x サーバーが吐きだすパケットを解析して、Samba のトレース結果と照合し、何が違うのかを調べてみる。</p></div><div class="sect3" title="Windows NT4 workstation"><div class="titlepage"><div><div><h4 class="title"><a name="id2683373"></a>Windows NT4 workstation</h4></div></div></div><p>ユーザーが最初に Windows NT workstation にログインした時、NTuser.DAT というプロファイルが生成される。プロファイルの場所は<a class="link" href="smb.conf.5.html#LOGONPATH" target="_top">logon path</a> パラメータで指定できる。</p><p>現在は、NT プロファイルを利用可能にするための<a class="link" href="smb.conf.5.html#LOGONDRIVE" target="_top">logon drive</a> というパラメータもある。これは <code class="filename">H:</code> もしくは他のドライブ名に向けておき、また <a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home</a> パラメータと組み合わせて使用する。</p><p><a class="indexterm" name="id2683442"></a><a class="indexterm" name="id2683449"></a>NT4 プロファイルのエントリはファイルではなくディレクトリーである。プロファイルに関する NT のヘルプによれば、.PDS という拡張子を持つディレクトリーが同時に作られるらしい。ログイン時、当該ユーザーは完全なプロファイルパス（および、.PDS 拡張子を持つディレクトリーが作られるのでそれも）を作るための書き込み権が必要である。</p><p><a class="indexterm" name="id2683469"></a>Windows NT4 では、プロファイルディレクトリーに Windows 9x/Me で作られる<code class="filename">デスクトップ</code>, <code class="filename">ネットワークコンピュータ</code>, <code class="filename">スタートメニュー</code>,<code class="filename">プログラム</code> 以外に<code class="filename">アプリケーションデータ</code> フォルダーが作られる。プロファイル自体は <code class="filename">NTuser.DAT</code> ファイルに格納される。.PDS ディレクトリには何も書き込まれないようで、現時点でここの目的は謎である。</p><p><a class="indexterm" name="id2683525"></a><a class="indexterm" name="id2683532"></a><span class="application">システム コントロール パネル</span> を使ってローカルプロファイルを Samba サーバーにコピーすることができる（プロファイルに関する NT のヘルプを参照のこと：さらに、これで<span class="application">システム コントロール パネル</span>の中で正確な位置を確認することもできる）。NT のヘルプによれば、残りの<code class="filename">NTuser.DAT</code> から <code class="filename">NTuser.MAN</code> は、プロファイルを強制するためのものであるらしい。</p><p>プロファイル名の大文字小文字は重要である。このファイル名は<code class="filename">NTuser.DAT</code>、強制用ファイルであれば<code class="filename">NTuser.MAN</code> でなければならない。</p></div><div class="sect3" title="Windows 2000/XP Professional"><div class="titlepage"><div><div><h4 class="title"><a name="id2683597"></a>Windows 2000/XP Professional</h4></div></div></div><p>まずローカルプロファイルを MS Windows ワークステーション上で以下のようにドメインプロファイルに変換しなければならない：</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="emphasis"><em>ローカルの</em></span>ワークステーション管理者	としてログイン</p></li><li class="step" title="Step 2"><p><span class="guiicon">マイコンピュータ</span>アイコンで	右クリックして<span class="guimenuitem">プロパティ</span>を選択	</p></li><li class="step" title="Step 3"><p><span class="guilabel">ユーザープロファイル</span>タブをクリック	</p></li><li class="step" title="Step 4"><p>変換したいプロファイルを選択（一回クリック）	</p></li><li class="step" title="Step 5"><p><span class="guibutton">コピー先</span>ボタンをクリック	</p></li><li class="step" title="Step 6"><p><span class="guilabel">使用を許可するユーザ/グループ</span>	ボックスの<span class="guibutton">変更</span>ボタンをクリック	</p></li><li class="step" title="Step 7"><p>マシン名の一覧が出る<span class="guilabel">場所</span>をクリック。    ここをクリックすると選択ボックスが開くので、プロファイルを    アクセス可能にするべきドメインをクリック。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>ログオンボックスが表示された場合はそこでログオンする。	たとえば <em class="replaceable"><code>DOMAIN</code></em>\root に	パスワード：<em class="replaceable"><code>mypassword</code></em>	で接続する。</p></div></li><li class="step" title="Step 8"><p>プロファイルを誰でも使えるようにする場合は	<span class="quote">“<span class="quote">Everyone</span>”</span> を選択</p></li><li class="step" title="Step 9"><p><span class="guibutton">OK</span>を押すと選択ボックスが閉じる	</p></li><li class="step" title="Step 10"><p>これで <span class="guibutton">OK</span> を押すと、	指定した場所にプロファイルが作られる</p></li></ol></div><p>これで Samba の <code class="literal">profiles</code> ツールから編集可能なプロファイルの作成ができた。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Windows NT/200x では、必須プロファイルを使うとメールデータとしてMS Exchange のストレージを使うことしかできなくなり、またこれはデスクトッププロファイルからは除外される。これにより、デスクトッププロファイルを使用不可にできない。</p></div><div class="sect4" title="Windows XP サービスパック 1"><div class="titlepage"><div><div><h5 class="title"><a name="id2683792"></a>Windows XP サービスパック 1</h5></div></div></div><p>	Windows XP （もしくは Windows XP サービスパック 1 のみ？）では	セキュリティーチェックが追加された。これは Active Directory	のグループポリシー経由で無効にできる。このポリシーは、以下の	手順で呼び出せる：</p><pre class="screen">コンピュータの設定\  管理用テンプレート\    システム\      ユーザープロファイル\        移動プロファイルフォルダのユーザー所有権を確認しない</pre><p>	</p><p>	これは <code class="constant">有効</code> にしておく	</p><p>	新しいバージョンの Samba には Active Directory と似たような	仕組みがあるだろうか？もしあるなら、前述の手順に従って	このポリシーを設定できるだろう。	</p><p>	Samba ではグループポリシーが設定できないようでも、各マシンで	ローカルに設定することは可能である。もしこの作業を行いたければ	以下のようにすればよい：	</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>XP workstation に管理者権限でログインする</p></li><li class="step" title="Step 2"><p><span class="guimenu">スタート</span> -> 	<span class="guimenu">名前を指定して実行</span>をクリック</p></li><li class="step" title="Step 3"><p><code class="literal">mmc</code>とタイプする</p></li><li class="step" title="Step 4"><p><span class="guibutton">OK</span>をクリック</p></li><li class="step" title="Step 5"><p>マイクロソフト管理コンソールが起動する</p></li><li class="step" title="Step 6"><p><span class="guimenu">ファイル</span> -> 	<span class="guimenuitem">スナップインの追加と削除</span> -> 	<span class="guimenuitem">追加</span>をクリック</p></li><li class="step" title="Step 7"><p><span class="guiicon">グループポリシー</span>をダブルクリック	</p></li><li class="step" title="Step 8"><p><span class="guibutton">完了</span> -> 	<span class="guibutton">閉じる</span>をクリック</p></li><li class="step" title="Step 9"><p><span class="guibutton">OK</span>をクリック</p></li><li class="step" title="Step 10"><p><span class="quote">“<span class="quote">コンソールルート</span>”</span> ウィンドウで		<span class="guiicon">ローカルコンピュータポリシー</span> ->		<span class="guiicon">コンピュータの構成</span> -> 		<span class="guiicon">管理用テンプレート</span> -> 		<span class="guiicon">システム</span> -> 		<span class="guiicon">ユーザープロファイル</span>を展開</p></li><li class="step" title="Step 11"><p>	<span class="guilabel">移動プロファイルフォルダのユーザー所有権を確認しない</span>	をダブルクリック</p></li><li class="step" title="Step 12"><p><span class="guilabel">有効</span>を選択</p></li><li class="step" title="Step 13"><p><span class="guibutton">OK</span>をクリック</p></li><li class="step" title="Step 14"><p>コンソール全体を閉じる。設定を保存する必要はない	（「保存」は変更したポリシーのことでではなく、コンソール設定の	ことを指している）	</p></li><li class="step" title="Step 15"><p>リブート</p></li></ol></div></div></div></div><div class="sect2" title="User Profile Hive Cleanup Service"><div class="titlepage"><div><div><h3 class="title"><a name="id2684078"></a>User Profile Hive Cleanup Service</h3></div></div></div><p>終了時に、移動プロファイルのキャッシュされたローカルコピーを強制削除する設定になっているにも関わらず、それらが消されないという状況がありうる。このような現象に対処するために、特別なサービスが作られた。Windows NT4/2000/XP Professional と Windows 2003 には<code class="literal">UPHClean</code> (User Profile Hive Cleanup) というアプリケーションをサービスとしてインストールできる。</p><p>UPHClean のソフトウェアパッケージはthe User Profile Hive Cleanup Service<sup>[<a name="id2684112" href="#ftn.id2684112" class="footnote">7</a>]</sup>というWebサイトからダウンロードできる。</p></div><div class="sect2" title="Windows 9x/Me と NT4/200x/XP ワークステーション間でプロファイルを共有する"><div class="titlepage"><div><div><h3 class="title"><a name="id2684122"></a>Windows 9x/Me と NT4/200x/XP ワークステーション間でプロファイルを共有する</h3></div></div></div><p><a class="indexterm" name="id2684133"></a><a class="indexterm" name="id2684140"></a>Windows の異なったバージョン間でデスクトップを共有することは推奨されない。デスクトッププロファイル領域は未だ進化の途上であり、新しいバージョンの Windows プロファイルで追加された機能は、それまでのバージョンの動作を阻害する。新旧のプロファイルを混在させるべきではないより大きな理由は、古いバージョンの Windows をログオフする際、古いフォーマットを持つプロファイルの中身が新しいバージョンに属する情報を上書きしてしまい、結果的にユーザが新しいバージョンの Windows でログオンし直した際に必要なプロファイル情報が失われてしまうからである。</p><p>Windows 9x/Me とスタートメニューやデスクトップを共有させたい場合は、プロファイルの共通領域を指定してやらなければならない。<code class="filename">smb.conf</code> で同じにしなければならないパラメータは <a class="link" href="smb.conf.5.html#LOGONPATH" target="_top">logon path</a>と <a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home</a>である。</p><p><a class="indexterm" name="id2684217"></a><a class="indexterm" name="id2684224"></a>これらが正しく設定されていれば、同じプロファイルディレクトリの中に別々の<code class="filename">user.DAT</code> と <code class="filename">NTuser.DAT</code> ファイルが見えるはずである。</p></div><div class="sect2" title="Windows NT4/200x サーバーから Samba にプロファイルを移行する"><div class="titlepage"><div><div><h3 class="title"><a name="id2684250"></a>Windows NT4/200x サーバーから Samba にプロファイルを移行する</h3></div></div></div><p><a class="indexterm" name="id2684260"></a>ユーザプロファイルの位置に関しては、どこのパスを指定してもよい。つまりプロファイルを保存する場所は、その SMB サーバーが暗号化パスワードをサポートしている限り、Samba サーバーでもそれ以外のその SMBサーバーでもかまわない。</p><div class="sect3" title="Windows NT4 のプロファイル管理ツール"><div class="titlepage"><div><div><h4 class="title"><a name="profilemigrn"></a>Windows NT4 のプロファイル管理ツール</h4></div></div></div><p><a class="indexterm" name="id2684292"></a>残念なことに、現在のリソースキットの情報は Windows NT4/200x に特化したものとなっている。各プラットフォームに対応したリソースキットの存在が望まれる。</p><p>クイックガイド</p><div class="procedure" title="Procedure 27.1. プロファイルの移行手順"><a name="id2684311"></a><p class="title"><b>Procedure 27.1. プロファイルの移行手順</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>NT4 のドメインコントローラーの	<span class="guiicon">マイコンピュータ</span>で右クリックして	<span class="guilabel">プロパティ</span> の	<span class="guilabel">ユーザープロファイル</span> タブを選ぶ	</p></li><li class="step" title="Step 2"><p>移行したいユーザープロファイルを選んでクリック</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>ここでご紹介するのはゆるやかな<span class="quote">“<span class="quote">移行</span>”</span>	方法である。プロファイルをコピーしてグループプロファイルを作成し、	このプロファイルへのアクセス権を <em class="parameter"><code>Everyone</code></em>	ユーザに与える。Samba ドメインが NT4 の PDC と信頼関係を結んでいない	場合は、単にこれだけでよい。</p></div></li><li class="step" title="Step 3"><p><span class="guibutton">コピー先</span>ボタンをクリック</p></li><li class="step" title="Step 4"><p><span class="guilabel">プロファイルのコピー先</span>ボックスで、	<code class="filename">c:\temp\foobar</code>のように新しいパスを追加する	</p></li><li class="step" title="Step 5"><p><span class="guilabel">使用を許可するユーザ/グループ</span>	ボックスの<span class="guibutton">変更</span>をクリック</p></li><li class="step" title="Step 6"><p>グループ<span class="quote">“<span class="quote">Everyone</span>”</span>をクリックし、	<span class="guibutton">OK</span>をクリック。これで<span class="quote">“<span class="quote">ユーザを選択</span>”</span>	ボックスが閉じられる</p></li><li class="step" title="Step 7"><p>これで<span class="guibutton">OK</span>をクリック</p></li></ol></div><p>全てのプロファイル移行について、以下の手順に従う。</p></div><div class="sect3" title="補足事項"><div class="titlepage"><div><div><h4 class="title"><a name="id2684470"></a>補足事項</h4></div></div></div><p><a class="indexterm" name="id2684478"></a><a class="indexterm" name="id2684484"></a>NT4 ドメイン側の SID を取得するには<code class="literal">net rpc info</code>コマンドが使える。詳細は<a class="link" href="NetCommand.html" title="Chapter 13. リモートとローカル管理:Netコマンド">The Net Command Chapter</a>, <a class="link" href="NetCommand.html#netmisc1" title="その他の雑多な操作">Other Miscellaneous Operations</a>を参照されたい。</p></div><div class="sect3" title="moveuser.exe"><div class="titlepage"><div><div><h4 class="title"><a name="id2684525"></a>moveuser.exe</h4></div></div></div><p><a class="indexterm" name="id2684532"></a>Windows 200x のリソースキットには <code class="literal">moveuser.exe</code>が含まれる。<code class="literal">moveuser.exe</code> はあるプロファイルのセキュリティをあるユーザーから別のユーザに変更する。これによりアカウントのドメインを変更したりユーザ名を変更したりできる。</p><p>このコマンドは Samba の<code class="literal">profiles</code>コマンドのようなものである。</p></div><div class="sect3" title="SID の取得"><div class="titlepage"><div><div><h4 class="title"><a name="id2684574"></a>SID の取得</h4></div></div></div><p><a class="indexterm" name="id2684582"></a><a class="indexterm" name="id2684588"></a>Windows NT Server 4.0 のリソースキットに含まれる<code class="literal">GetSID.exe</code>を使って SID を取得できる。</p><p>Windows NT 4.0 ではローカルプロファイルの情報はレジストリキー<code class="filename">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList</code>配下に格納される。</p><p>ProfileList キー配下には、現在このコンピュータにログオンしているユーザーが、SID をサブキー名として格納されている。（ローカルにキャッシュされているプロファイルから移動したいユーザのプロファイル情報を見つけるには、<code class="literal">GetSID.exe</code>ユーティリティーでこのユーザーの SID を見つければよい）。適切なユーザーのサブキーの中に<em class="parameter"><code>ProfileImagePath</code></em>という名前の文字列値があるはずである。</p></div></div></div><div class="sect1" title="必須プロファイル"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2684654"></a>必須プロファイル</h2></div></div></div><p><a class="indexterm" name="id2684662"></a>必須プロファイルとは、ユーザーが上書きできないプロファイルのことである。ユーザーセッションが有効の間、デスクトップ環境の変更が可能である。しかしながら、ユーザーがログアウトするとすべての変更内容は失われてしまう。ユーザーにデスクトップ環境を変更させたくない場合は、この設定をポリシー設定を通して行うことができる。<a class="link" href="PolicyMgmt.html" title="Chapter 26. システムとアカウントポリシー">System and Account Policies</a>を参照のこと。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p> <a class="indexterm" name="id2684692"></a><a class="indexterm" name="id2684699"></a><a class="indexterm" name="id2684706"></a>どのような状況においてもプロファイルディレクトリー（もしくはそのファイル）をリードオンリーにはできない。なぜならそのプロファイルが使用できなくなってしまうからである。ただし UNIX ファイルシステム配下であればプロファイルをリードオンリーにできなくもない。この場合、<code class="literal">fake-permissions</code> VFS モジュールを使用する必要がある。これは Windows NT/200x/XP クライアントに対して、そのユーザのプロファイルに書き込み権があるようにふるまう。<a class="link" href="VFS.html#fakeperms" title="fake_perms">fake_perms VFS module</a>を参照のこと。</p></div><p><a class="indexterm" name="id2684748"></a><a class="indexterm" name="id2684755"></a>Windows NT4/200x/XP では、必須プロファイルを作るのに<a class="link" href="ProfileMgmt.html#profilemigrn" title="Windows NT4 のプロファイル管理ツール">Windows NT4/200x サーバーから Sambaへのプロファイルの移行</a>にあるような手順が使える。グループプロファイルを必須プロファイルに変換するには、単にコピー先にプロファイルに<code class="filename">NTUser.DAT</code>ファイルを入れ、それを<code class="filename">NTUser.MAN</code>にリネームすればよい。</p><p><a class="indexterm" name="id2684793"></a>Windows 9x/Me の場合は<code class="filename">User.DAT</code>ファイルを<code class="filename">User.MAN</code>にリネームすることで必須プロファイルを作成できる。</p></div><div class="sect1" title="グループプロファイルの作成と管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2684816"></a>グループプロファイルの作成と管理</h2></div></div></div><p><a class="indexterm" name="id2684824"></a><a class="indexterm" name="id2684832"></a><a class="indexterm" name="id2684839"></a><a class="indexterm" name="id2684846"></a>多くの組織は部署に分かれている。ひとつの部署内のユーザは同じデスクトップアプリケーションや同じデスクトップレイアウトを要求することが多いので、部署単位で管理できるといろいろと都合のよいことが多い。Windows NT4/200x/XP では、グループプロファイルが利用できる。グループプロファイルは、まずテンプレート（例示）ユーザを使って作られる。その後、後述のプロファイル移行ツールを使ってそのユーザーグループからグループプロファイルに対する必要なアクセス権が設定される。</p><p><a class="indexterm" name="id2684879"></a>次のステップはもっと重要である。グループプロファイルを（ユーザーマネージャーを使って）各ユーザーに<span class="quote">“<span class="quote">ユーザー単位で</span>”</span>割り当てるのではなく、そのグループ自体を更新されたプロファイルに割り当てるのである。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>グループプロファイルには注意すること。個人プロファイルをすでに持っているグループのメンバーがユーザーである場合、その結果は２つを統合（マージ）したものとなる。</p></div></div><div class="sect1" title="Windows ユーザーのデフォルトプロファイル"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2684914"></a>Windows ユーザーのデフォルトプロファイル</h2></div></div></div><p><a class="indexterm" name="id2684924"></a><a class="indexterm" name="id2684931"></a>Windows 9x/Me および NT4/200x/XP では、プロファイルが存在しないユーザーについてはデフォルトプロファイルを使用する。デフォルトプロファイルがWindows workstation 上にあるとわかっている場合、およびデフォルトプロファイルを作るパスを示すレジストリキーがわかっている場合、使用するデフォルトプロファイルをこのサイト用に最適化されたものに変更できる。これは管理上重要な利点である。</p><div class="sect2" title="MS Windows 9x/Me"><div class="titlepage"><div><div><h3 class="title"><a name="id2684950"></a>MS Windows 9x/Me</h3></div></div></div><p><a class="indexterm" name="id2684957"></a><a class="indexterm" name="id2684965"></a>Windows 9x/Me でユーザごとのデフォルトプロファイルを有効にするには、<span class="application">Windows 98 システムポリシーエディター</span> を使うか、またはレジストリを直接変更する。</p><p>Windows 9x/Me でユーザごとのデフォルトプロファイルを有効にするには<span class="application">システムポリシーエディタ</span>を起動し、<span class="guimenu">ファイル</span> -> <span class="guimenu">レジストリを開く</span>を選択する。次に<span class="guiicon">ローカルコンピュータ</span>アイコンをクリックし、<span class="guilabel">Windows 98 システム</span>をクリックして「有効」ボックスの<span class="guilabel">ユーザープロファイル</span>を選択する。レジストリの変更を保存するのを忘れないこと。</p><p><a class="indexterm" name="id2685036"></a>レジストリを直接変更するには<span class="application">レジストリーエディター</span>(<code class="literal">regedit.exe</code>) を起動し、<code class="filename">HKEY_LOCAL_MACHINE\Network\Logon</code>ハイブを選択する。ここで<span class="quote">“<span class="quote">User Profiles</span>”</span>キーのところに DWORD を追加する。ユーザープロファイルを有効にするには 1 を、無効にするには 0 をセットする。</p><div class="sect3" title="Windows 9x/Me におけるユーザープロファイルの取り扱い"><div class="titlepage"><div><div><h4 class="title"><a name="id2685072"></a>Windows 9x/Me におけるユーザープロファイルの取り扱い</h4></div></div></div><p>ユーザーが Windows 9x/Me マシンにログオンすると、そのユーザーに関する既存のエントリを処置するのにローカルプロファイルのパス<code class="filename">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\ProfileList</code>がチェックされる。</p><p>レジストリのこの位置にユーザのエントリがある場合、Windows 9x/Me はユーザープロファイルのキャッシュされたバージョンをローカルでチェックする。Windows 9x/Me では、さらにサーバー上にあるユーザーのホームディレクトリー（場所が変更されている場合は指定されたディレクトリー）にある（かもしれない）ユーザープロファイルもチェックする。プロファイルがどちらにもある場合は、新しい方が使われる。プロファイルがサーバー上にあるがローカルマシン上にはない場合は、サーバー上のプロファイルをダウンロードして使用する。ユーザープロファイルがローカルマシン上のみにある場合は、そのコピーが使われる。</p><p>ユーザープロファイルがこれらのどちらにもない場合は、Windows 9x/Me マシンのデフォルトユーザープロファイルが使われ、ログインしているユーザの新しく作られたディレクトリにこのプロファイルのコピーが作られる。ログオフの際、ユーザが行った変更がすべてこのユーザーのローカルプロファイルに書きこまれる。このユーザーが移動プロファイルを使っている場合、変更内容はサーバ上あるこのユーザのプロファイルに書きこまれる。</p></div></div><div class="sect2" title="MS Windows NT4 Workstation"><div class="titlepage"><div><div><h3 class="title"><a name="id2685144"></a>MS Windows NT4 Workstation</h3></div></div></div><p>Windows NT4 の場合、デフォルトユーザープロファイルは<code class="filename">%SystemRoot%\Profiles</code> から読みこまれる。インストール時のデフォルト設定では、ここは<code class="filename">C:\Windows NT\Profiles</code>となる。クリーンインストール後におけるこのディレクトリの中身は<code class="filename">Administrator</code>, <code class="filename">All Users</code>,<code class="filename">Default User</code>という３つのディレクトリから構成される。</p><p><code class="filename">All Users</code> ディレクトリにはシステムユーザすべてで共通で使われるメニュー設定が入る。<code class="filename">Default User</code> ディレクトリには、各ユーザーが自分で選択したり作成したりしたプロファイル設定に依存する、カスタマイズ可能なメニューエントリが入る。</p><p>新しいユーザーが最初に Windows NT4 のマシンにログオンする際、以下を元に新しいプロファイルが作られる。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>All Users の設定</p></li><li class="listitem"><p>Default User（デフォルトの	<code class="filename">NTUser.DAT</code> ファイルを含む）の設定</p></li></ul></div><p><a class="indexterm" name="id2685248"></a>あるユーザーがマイクロソフトのセキュリティードメインのメンバーであるWindows NT4 マシンにログオンする際は、プロファイルの扱いに関して以下の手順を踏む：</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>	ログオンプロセスを通して得られるユーザーのアカウント情報には、その	ユーザーのデスクトッププロファイルの場所も入っている。プロファイルの	パスはマシンのローカルにある場合もあるし、ネットワーク共有の中かも	しれない。プロファイルがユーザーアカウントから得られたパスの位置に	ある場合、このプロファイルは	<code class="filename">%SystemRoot%\Profiles\%USERNAME%</code>	という位置にコピーされる。そしてこのプロファイルの内容は、	<code class="filename">%SystemRoot%\Profiles</code>にある	<code class="filename">All Users</code>プロファイルの設定を継承する。	</p></li><li class="step" title="Step 2"><p>     ユーザーアカウントがプロファイルへのパスを持っているが、そこに    プロファイルが存在しない場合、<code class="filename">Default User</code>    プロファイルが参照され、それを元にして新しいプロファイルが	<code class="filename">%SystemRoot%\Profiles\%USERNAME%</code>    に作られる。	</p></li><li class="step" title="Step 3"><p><a class="indexterm" name="id2685343"></a><a class="indexterm" name="id2685350"></a><a class="indexterm" name="id2685357"></a><a class="indexterm" name="id2685364"></a><a class="indexterm" name="id2685371"></a>    認証サーバー（ログオンサーバー）上の NETLOGON 共有内にポリシー    ファイル(<code class="filename">NTConfig.POL</code>)がある場合、その内容は    <code class="filename">NTUser.DAT</code>に適用され、最終的にはレジストリの    <code class="filename">HKEY_CURRENT_USER</code>部分に適用される。	</p></li><li class="step" title="Step 4"><p>    ユーザーがログアウトする際、そのプロファイルが移動プロファイルで    あれば、指定されたプロファイルの場所に書き出される。その後    <code class="filename">HKEY_CURRENT_USER</code>の内容から    <code class="filename">NTuser.DAT</code>ファイルが再度作成される。つまり、    次回のログイン時には NETLOGON 共有内に    <code class="filename">NTConfig.POL</code>が存在するべきではなく、そのひとつ    前の<code class="filename">NTConfig.POL</code> がプロファイル内にあれば、    それが有効になる。この効果はタトゥーイング（入れ墨）と呼ばれる。	</p></li></ol></div><p>Windows NT4 のプロファイルのタイプは<span class="emphasis"><em>ローカル</em></span>か<span class="emphasis"><em>移動</em></span>のどちらかである。ローカルプロファイルは<code class="filename">%SystemRoot%\Profiles\%USERNAME%</code>に置かれる。以下のレジストリキーを作っておかない限り、移動プロファイルも同様に残ったままとなる。</p><pre class="screen">HKEY_LOCAL_MACHINE\SYSTEM\Software\Microsoft\Windows NT\CurrentVersion\winlogon\"DeleteRoamingCache"=dword:0000000</pre><p>このケースでは、（<code class="filename">%SystemRoot%\Profiles\%USERNAME%</code>にある）ローカルのコピーは、ログアウト時に削除される。</p><p><a class="indexterm" name="id2685494"></a>Windows NT4 では後述のレジストリキーを変更することで、<code class="filename">マイドキュメント</code>といった共有リソースのデフォルト位置をネットワーク共有上にリダイレクトすることができる。これらの変更はシステムポリシーエディターを使って行える。これを GUI 上で行いたい場合は、ポリシーエディタで自分自身のテンプレート拡張を作る必要があるかもしれない。別の方法としては、まずデフォルトのユーザープロファイルを作成し、そのユーザーでログインしてから<code class="literal">regedt32</code> でキー設定の編集を行う。</p><p>あるフォルダをデフォルトのユーザプロファイルとしたい場合のレジストリハイブキーは、Windows NT4 の場合以下で制御できる：</p><pre class="screen">HKEY_CURRENT_USER	\Software		\Microsoft			\Windows				\CurrentVersion					\Explorer						\User Shell Folders</pre><p><a class="indexterm" name="id2685551"></a></p><p>前述のハイブキーには自動的に管理されるフォルダがある。デフォルトのエントリは<a class="link" href="ProfileMgmt.html#ProfileLocs" title="Table 27.1. User Shell Folder レジストリキーのデフォルト値">the next table</a>にある。</p><div class="table"><a name="ProfileLocs"></a><p class="title"><b>Table 27.1. User Shell Folder レジストリキーのデフォルト値</b></p><div class="table-contents"><table summary="User Shell Folder レジストリキーのデフォルト値" border="1"><colgroup><col align="left"><col align="left"></colgroup><thead><tr><th align="left">名前</th><th align="left">デフォルト値</th></tr></thead><tbody><tr><td align="left">AppData</td><td align="left">%USERPROFILE%\Application Data</td></tr><tr><td align="left">Desktop</td><td align="left">%USERPROFILE%\Desktop</td></tr><tr><td align="left">Favorites</td><td align="left">%USERPROFILE%\Favorites</td></tr><tr><td align="left">NetHood</td><td align="left">%USERPROFILE%\NetHood</td></tr><tr><td align="left">PrintHood</td><td align="left">%USERPROFILE%\PrintHood</td></tr><tr><td align="left">Programs</td><td align="left">%USERPROFILE%\Start Menu\Programs</td></tr><tr><td align="left">Recent</td><td align="left">%USERPROFILE%\Recent</td></tr><tr><td align="left">SendTo</td><td align="left">%USERPROFILE%\SendTo</td></tr><tr><td align="left">Start Menu </td><td align="left">%USERPROFILE%\Start Menu</td></tr><tr><td align="left">Startup</td><td align="left">%USERPROFILE%\Start Menu\Programs\Startup</td></tr></tbody></table></div></div><br class="table-break"><p>デフォルトプロファイルの場所の設定を含むレジストリキー：</p><pre class="screen">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders</pre><p></p><p>デフォルトのエントリは<a class="link" href="ProfileMgmt.html#regkeys" title="Table 27.2. デフォルトのプロファイル設定用のレジストリキー">デフォルトのプロファイル設定用のレジストリキー</a>にある。</p><div class="table"><a name="regkeys"></a><p class="title"><b>Table 27.2. デフォルトのプロファイル設定用のレジストリキー</b></p><div class="table-contents"><table summary="デフォルトのプロファイル設定用のレジストリキー" border="1"><colgroup><col align="left"><col align="left"></colgroup><tbody><tr><td align="left">Common Desktop</td><td align="left">%SystemRoot%\Profiles\All Users\Desktop</td></tr><tr><td align="left">Common Programs</td><td align="left">%SystemRoot%\Profiles\All Users\Programs</td></tr><tr><td align="left">Common Start Menu</td><td align="left">%SystemRoot%\Profiles\All Users\Start Menu</td></tr><tr><td align="left">Common Startup</td><td align="left">%SystemRoot%\Profiles\All Users\Start Menu\Programs\Startup</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="MS Windows 200x/XP"><div class="titlepage"><div><div><h3 class="title"><a name="id2685784"></a>MS Windows 200x/XP</h3></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2685793"></a><a class="indexterm" name="id2685800"></a><a class="indexterm" name="id2685807"></a><a class="indexterm" name="id2685813"></a>Windows XP Home Edition ではユーザーごとのデフォルトプロファイルは使われず、ドメインセキュリティにも参加できず、NT/ADS スタイルのドメインにもログインできないので、プロファイル情報は自分自身で持っておくしかない。デフォルトプロファイルを設定できるといろいろと便利なので、ドメインログオン処理に参加できるような上位レベルの Windows クライアントでは、管理者がグローバルのデフォルトプロファイルを事前に作っておき、グループポリシーオブジェクト(GPO)を経由してそれらを強制的に適用するという仕組みを備えている。</p></div><p><a class="indexterm" name="id2685849"></a>新しいユーザーが最初に Windows 200x/XP マシンにログインすると、デフォルトプロファイルは<code class="filename">C:\Documents and Settings\Default User</code>から読みこまれる。システム管理者が必要に応じてこの中身を変更していても、Windows 200x/XP は喜んでその指示に従う。これは最善の処置とはとても言えるものではない。なぜなら、このデフォルトプロファイルをすべての Windows 200x/XP クライアントマシンにコピーして回らなければならないからである。</p><p><a class="indexterm" name="id2685880"></a>Windows 200x/XP がドメインレベルのセキュリティに参加する際、デフォルトのユーザプロファイルが見つからなければ、クライアントはデフォルトプロファイルを探すために認証サーバーの NETLOGON 共有を見に行く。ここで Windows の元々の動きとしては、まず<code class="filename">%LOGONSERVER%\NETLOGON\Default User</code>を見に行き、もしこのディレクトリがあればこの配下のファイルがクライアント側の<code class="filename">C:\Documents and Settings\</code>直下にある現在 Windows にログイン中のユーザー名にコピーされる。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>一方 Samba 側の動きとしては、このパスは <code class="filename">smb.conf</code> の<em class="parameter"><code>[NETLOGON]</code></em> 共有に読み替えられる。このディレクトリはこの共有の直下に<code class="filename">Default User</code>という名前で作っておかなければならない。</p></div><p>この場所にデフォルトプロファイルが存在しない場合、Windows 200x/XP はローカルのデフォルトプロファイルを使用する。</p><p>ログアウトの際、ユーザーのデスクトッププロファイルはそのユーザーに関連するレジストリ設定で指定された場所に格納される。（Samba では自動的に行われるが）ログイン処理の際に特定のポリシーが作られもしくは渡されない場合、ユーザのプロファイルはローカルマシンの<code class="filename">C:\Documents and Settings\%USERNAME%</code>パス配下にのみ書きこまれる。</p><p>デフォルトの振る舞いを変更したい場合は、以下の３つの方法を使えばよい：</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	ローカルマシンのレジストリキーを手作業で変更し、NETLOGON 共有の	直下に新しいデフォルトプロファイルを置く。保守でいっせいに行う	必要があるので、この方法はお勧めしない。	</p></li><li class="listitem"><p>	この振る舞いを指定した NT4 スタイルの NTConfig.POL ファイルを	作成し、それを新しいデフォルトプロファイルと共に NETLOGON 	共有の直下に置く。	</p></li><li class="listitem"><p>	これを Active Directory を通して行うように強制する GPO を	作成し、新しいデフォルトプロファイルを NETLOGON に置く。	 </p></li></ul></div><p>Windows 200x/XP において、デフォルトユーザープロファイルの一部となるフォルダーに関する振る舞いに影響を与えるレジストリのハイブキーは以下のエントリーである：</p><p><code class="filename">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\</code></p><p>このハイブキーには自動的に管理されるフォルダーのリストが含まれる。デフォルトのエントリーは<a class="link" href="ProfileMgmt.html#defregpthkeys" title="Table 27.3. デフォルトユーザプロファイルへのパスのデフォルト値 を持つレジストリエントリー">次の表</a>にある。<a class="indexterm" name="id2686062"></a></p><div class="table"><a name="defregpthkeys"></a><p class="title"><b>Table 27.3. デフォルトユーザプロファイルへのパスのデフォルト値	を持つレジストリエントリー</b></p><div class="table-contents"><table summary="デフォルトユーザプロファイルへのパスのデフォルト値	を持つレジストリエントリー" border="1"><colgroup><col align="left"><col align="left"></colgroup><thead><tr><th align="left">名前</th><th align="left">デフォルト値</th></tr></thead><tbody><tr><td align="left">AppData</td><td align="left">%USERPROFILE%\Application Data</td></tr><tr><td align="left">Cache</td><td align="left">%USERPROFILE%\Local Settings\Temporary Internet Files</td></tr><tr><td align="left">Cookies</td><td align="left">%USERPROFILE%\Cookies</td></tr><tr><td align="left">Desktop</td><td align="left">%USERPROFILE%\Desktop</td></tr><tr><td align="left">Favorites</td><td align="left">%USERPROFILE%\Favorites</td></tr><tr><td align="left">History</td><td align="left">%USERPROFILE%\Local Settings\History</td></tr><tr><td align="left">Local AppData</td><td align="left">%USERPROFILE%\Local Settings\Application Data</td></tr><tr><td align="left">Local Settings</td><td align="left">%USERPROFILE%\Local Settings</td></tr><tr><td align="left">My Pictures</td><td align="left">%USERPROFILE%\My Documents\My Pictures</td></tr><tr><td align="left">NetHood</td><td align="left">%USERPROFILE%\NetHood</td></tr><tr><td align="left">Personal</td><td align="left">%USERPROFILE%\My Documents</td></tr><tr><td align="left">PrintHood</td><td align="left">%USERPROFILE%\PrintHood</td></tr><tr><td align="left">Programs</td><td align="left">%USERPROFILE%\Start Menu\Programs</td></tr><tr><td align="left">Recent</td><td align="left">%USERPROFILE%\Recent</td></tr><tr><td align="left">SendTo</td><td align="left">%USERPROFILE%\SendTo</td></tr><tr><td align="left">Start Menu</td><td align="left">%USERPROFILE%\Start Menu</td></tr><tr><td align="left">Startup</td><td align="left">%USERPROFILE%\Start Menu\Programs\Startup</td></tr><tr><td align="left">Templates</td><td align="left">%USERPROFILE%\Templates</td></tr></tbody></table></div></div><br class="table-break"><p>値がセットされていない、<span class="quote">“<span class="quote">Default</span>”</span>と呼ばれるエントリーもある。デフォルトのえんとりーの型は<code class="constant">REG_SZ</code>である。これ以外の全ての型は<code class="constant">REG_EXPAND_SZ</code>である。</p><p>全てのフォルダーがネットワークサーバー上の特定の場所に格納されている場合、移動プロファイルを処理するスピードには大きな違いが出る。つまり、ログインやログアウトのたびに Outlook の PST ファイルをネットワークの向こうに書き出す必要はないということだ。</p><p>これをネットワーク上の場所にするには、以下の例に従えばよい：</p><pre class="screen">%LOGONSERVER%\%USERNAME%\Default Folders</pre><p>これにより、フォルダーはユーザーのホームディレクトリーにある<code class="filename">Default Folders</code>という名前のディレクトリー配下に格納される。また以下の書式で指定してもよい：</p><pre class="screen">\\<em class="replaceable"><code>SambaServer</code></em>\<em class="replaceable"><code>FolderShare</code></em>\%USERNAME%</pre><p></p><p>この場合、デフォルトフォルダーは<em class="replaceable"><code>SambaServer</code></em>という名前のサーバ上にある<em class="replaceable"><code>FolderShare</code></em>という名前の共有の下の、Linux/UNIX ファイルシステムによって Windows ユーザーの名前をつけられたディレクトリーに格納される。</p><p>いったんデフォルトプロファイルの共有を作ったら、その中に移行するユーザーのプロファイルを（デフォルト値であれカスタマイズしたものであれ）を<span class="emphasis"><em>置かなければならない</em></span>ことに注意して欲しい。</p><p> Windows 200x/XP のプロファイルは<span class="emphasis"><em>ローカル</em></span>または<span class="emphasis"><em>移動</em></span>のいずれかである。移動プロファイルは以下のレジストリキーが作られていない限りローカルにキャッシュされる：<a class="indexterm" name="id2686364"></a></p><p></p><pre class="programlisting">HKEY_LOCAL_MACHINE\SYSTEM\Software\Microsoft\Windows NT\CurrentVersion\winlogon\"DeleteRoamingCache"=dword:00000001</pre><p></p><p>この設定をすると、ログアウト時にローカルのキャッシュは削除されるようになる。</p></div></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2686392"></a>よくあるエラー</h2></div></div></div><p>Samba のメーリングリストで質問があった典型的なエラーや問題、質問内容を以下に示す。</p><div class="sect2" title="少人数のユーザやグループのための移動プロファイルの設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2686406"></a>少人数のユーザやグループのための移動プロファイルの設定</h3></div></div></div><p>Samba-2.2.x では、移動プロファイルをサポートするか否かという選択肢しかない。これはグローバル設定である。デフォルトでは移動プロファイルを持つことになっており、デフォルトのパスはユーザーのホームディレクトリー配下にある。</p><p>グローバルで無効にすると、誰も移動プロファイルを持てなくなる。移動プロファイル自身は有効にするが、これを特定のマシンにしか適用させたくない場合は、移動プロファイルサポートをしたくない個々のマシンにおいて、これを無効にする設定をレジストリに書き込んでやらなければならない。</p><p>Samba-3 では、グローバル設定を <code class="filename">smb.conf</code> に書いておき、各ユーザーごとの設定を（Windows NT4/200x の）ドメインユーザーマネージャで上書きすることができる。</p><p>どのケースにおいても、各ユーザーごとにひとつのプロファイルしか持てない。このプロファイルは以下のいずれかになる：</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>そのユーザ固有のプロファイル</p></li><li class="listitem"><p>必須プロファイル（ユーザーは変更できない）</p></li><li class="listitem"><p>グループプロファイル	（実際は必須となる  すなわち変更不可）</p></li></ul></div></div><div class="sect2" title="移動プロファイルを使えない"><div class="titlepage"><div><div><h3 class="title"><a name="id2686489"></a>移動プロファイルを使えない</h3></div></div></div><p>あるユーザーからの要求：<span class="quote">“<span class="quote">移動プロファイルを実装して欲しくない。各ユーザーにローカルプロファイルだけを与えたい。私はこのエラーでひどく損害を受けた。この２日間、あらゆることを試してみた。Google を検索したりもしてみたが、役に立つ情報はなかった。助けてください。</span>”</span></p><p>選択肢としては、以下のようになるだろう：</p><div class="variablelist"><dl><dt><span class="term">ローカルプロファイル</span></dt><dd><p>ログアウト時に「ローカルの」プロファイルを		自動で消すようなレジストリキーがないことがわかっている。		</p></dd><dt><span class="term">移動プロファイル</span></dt><dd><p>		ユーザーがネットワークにログオンすると、中央に格納された		プロファイルがワークステーションにコピーされてローカルの		プロファイルが作られる。このローカルプロファイルは、		レジストリキーが変更されてログアウト時の自動削除が有効に		ならない限りは永続的になる（ワークステーションのディスク		上に残る）。</p></dd></dl></div><p>移動プロファイルの選択をする場合：</p><div class="variablelist"><dl><dt><span class="term">個人の移動プロファイル</span></dt><dd><p>一般的には中央の（もしくは便宜上ローカルにある）		サーバー上のプロファイル用共有に格納されている。</p><p>ワークステーションはプロファイルのローカルコピーを		キャッシュ（格納）する。このキャッシュされたコピーは、		次回のログイン時にプロファイルがダウンロードできなかった		場合に使用される。</p></dd><dt><span class="term">グループプロファイル</span></dt><dd><p>		これらは中央のプロファイルサーバーから読み込まれる。		</p></dd><dt><span class="term">必須プロファイル</span></dt><dd><p>必須プロファイルはユーザ用としてだけではなく、		そのユーザが属するすべてのグループのためにも作られる。		必須プロファイルを通常のユーザーが変更することはできない。		これを変更したり再構成したりできるのは、システム管理者に限られる。		</p></dd></dl></div><p>Windows NT4/200x/XP のプロファイルは、そのサイズが最低 130KB から巨大なサイズまで変動する。プロファイルの中の多くを占めるのは、往々にして Outlook の PST ファイルであり、これはギガバイトレベルまで膨らむこともある。（好ましい状態で運用されている環境における）平均的な移動プロファイルのサイズは、計画段階では 2MB 程度であると考えればよいだろう。きちんと管理されていない環境では、プロファイルが2GB まで膨れ上がったのを見たことがある。こうなるとログオンに１時間くらいもかかってユーザーからの不満が出るかもしれないが、おおかたくだらないごみファイルをため込んでいるのであろう。</p><p> この議論のポイントは、移動プロファイルを使って変更できる設定とできない設定をうまくコントロールしてやれば、問題の少ないサイト運用ができるということである。</p><p> PST 問題に対するマイクロソフトの回答は、すべての電子メールを MSExchange Server バックエンドに格納するべき、というものである。これを使えば PST ファイルが必要なくなる。</p><p>ローカルプロファイルの意味するところは：</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>	それぞれのマシンが多くのユーザーによって使用されるなら、ローカル	プロファイルを格納するために多くのディスク領域が必要になる。	</p></li><li class="listitem"><p>	ユーザーがログインするそれぞれのワークステーションにはそれぞれの	プロファイルが格納されている。これらはマシン間で全く別物に	なっているかもしれない。	</p></li></ul></div><p>一方、移動プロファイルの意味するところは：</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ネットワーク管理者は、全ユーザーのデスクトップ	環境をコントロールできる。</p></li><li class="listitem"><p>移動プロファイルを使うと、ネットワーク管理の	オーバーヘッドを劇的に削減できる。</p></li><li class="listitem"><p>長時間のスパンで考えれば、ユーザが問題に直面する	危険性が減るだろう。</p></li></ul></div></div><div class="sect2" title="デフォルトプロファイルを変更する"><div class="titlepage"><div><div><h3 class="title"><a name="id2686735"></a>デフォルトプロファイルを変更する</h3></div></div></div><p><span class="quote">“<span class="quote">クライアントがドメインコントローラーにログオンする際、クライアントはダウンロードするべきプロファイルを検索する。我々はデフォルトプロファイルをどこに置くべきだろうか？</span>”</span></p><p><a class="indexterm" name="id2686756"></a>まず Samba サーバーはドメインコントローラーとして構成する必要がある。そのためには <code class="filename">smb.conf</code> に以下の設定を行う：</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2686781"></a><em class="parameter"><code>security = user</code></em></td></tr><tr><td><a class="indexterm" name="id2686792"></a><em class="parameter"><code>os level = 32 (or more)</code></em></td></tr><tr><td><a class="indexterm" name="id2686804"></a><em class="parameter"><code>domain logons = Yes</code></em></td></tr></table><p> 次に <em class="parameter"><code>[netlogon]</code></em> が必須で、ここは全ユーザが読めるようになっていなければならない。ここに既存のプリンタやドライブの割り当てをするためのログオンスクリプトを追加しておくのもよいだろう。ワークステーションの時刻をログオンサーバーと自動的に同期させる仕組みもある（これもやっておくことが好ましい）。</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p> ローカルワークステーションのキャッシュ（＝ディスク領域）から移動プロファイルを自動検出させるには、<span class="application">グループポリシーエディタ</span>を使って<code class="filename">NTConfig.POL</code>と呼ばれるファイルを作成し、この中で適切な設定を行っておく。このファイルは<em class="parameter"><code>netlogon</code></em>共有の直下に置いておかなければならない。</p></div><p>Windows クライアントはドメインのメンバーである必要がある。ワークグループのマシンではネットワークログオンが使えないのでドメインプロファイルによる運用はできない。</p><p>移動プロファイル用に <code class="filename">smb.conf</code> に追加する項目：</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2686893"></a><em class="parameter"><code>logon path = \\%N\profiles\%U</code></em></td></tr><tr><td># Default logon drive is Z:</td></tr><tr><td><a class="indexterm" name="id2686909"></a><em class="parameter"><code>logon drive = H:</code></em></td></tr><tr><td># This requires a PROFILES share that is world writable.</td></tr></table></div><div class="sect2" title="移動プロファイルと NT4 スタイルのドメインポリシーのデバッグ"><div class="titlepage"><div><div><h3 class="title"><a name="id2686926"></a>移動プロファイルと NT4 スタイルのドメインポリシーのデバッグ</h3></div></div></div><p>移動プロファイルとドメインポリシーは <code class="literal">USERENV.DLL</code>により実装されている。この DLL をデバッグしてログインプロセスを解析するためのやり方は、Microsoft Knowledge Base の<a class="ulink" href="http://support.microsoft.com/default.aspx?scid=kb;en-us;221833" target="_top">221833</a>と<a class="ulink" href="http://support.microsoft.com/default.aspx?scid=kb;en-us;154120" target="_top">154120</a>という記事に解説がある。</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="PolicyMgmt.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="pam.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 26. システムとアカウントポリシー </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 28. PAM ベースの分散型認証</td></tr></table></div></body></html>