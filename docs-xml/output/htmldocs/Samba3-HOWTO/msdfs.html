<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 20. Microsoft 分散ファイルシステムツリーのホスティング</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="InterdomainTrusts.html" title="Chapter 19. ドメイン間の信頼関係"><link rel="next" href="classicalprinting.html" title="Chapter 21. 旧式の印刷サポート"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 20. Microsoft 分散ファイルシステムツリーのホスティング</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="InterdomainTrusts.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="classicalprinting.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 20. Microsoft 分散ファイルシステムツリーのホスティング"><div class="titlepage"><div><div><h2 class="title"><a name="msdfs"></a>Chapter 20. Microsoft 分散ファイルシステムツリーのホスティング</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Shirish</span> <span class="surname">Kalele</span></h3><div class="affiliation"><span class="orgname">Samba Team & Veritas Software<br></span><div class="address"><p><br>				<code class="email"><<a class="email" href="mailto:samba@samba.org">samba@samba.org</a>></code><br>			</p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><p class="pubdate">12 Jul 2000</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="msdfs.html#id2636995">特徴と利点</a></span></dt><dt><span class="sect1"><a href="msdfs.html#id2637457">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="msdfs.html#id2637500">MSDFSのUNIXパスは大文字小文字を識別する</a></span></dt></dl></dd></dl></div><div class="sect1" title="特徴と利点"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2636995"></a>特徴と利点</h2></div></div></div><p><a class="indexterm" name="id2637003"></a><a class="indexterm" name="id2637012"></a><a class="indexterm" name="id2637019"></a><a class="indexterm" name="id2637026"></a><a class="indexterm" name="id2637033"></a>	分散ファイルシステム (DFS) はネットワーク上にある資源について実際の物理的な配置	から、ユーザが見ているファイルとディレクトリの論理的ビューを切り離す手	段を提供する。	高い可用性と円滑なストレージ拡張、負荷分散などを可能にする。	</p><p><a class="indexterm" name="id2637054"></a><a class="indexterm" name="id2637060"></a><a class="indexterm" name="id2637067"></a>	DFS の情報について、<a class="ulink" href="http://www.microsoft.com/NTServer/nts/downloads/winfeatures/NTSDistrFile/AdminGuide.asp" target="_top">Microsoft	documentation</a>を参照のこと。 この文書は、 Samba を利用している	UNIX で (DFS対応クライアントがブラウズするため) DFS ツリーを	どのようにホスティングするか説明する。	</p><p><a class="indexterm" name="id2637090"></a><a class="indexterm" name="id2637097"></a><a class="indexterm" name="id2637104"></a><a class="indexterm" name="id2637111"></a>	Samba サーバは、<code class="filename">smb.conf</code> ファイルのグローバル Boolean パラメータ	<a class="link" href="smb.conf.5.html#HOSTMSDFS" target="_top">host msdfs</a>を設定することで DFS サーバにできる。	共有レベルの論理値パラメータ<a class="link" href="smb.conf.5.html#MSDFSROOT" target="_top">msdfs root</a>によっ	て共有を DFS ルートとして指定できる。	Samba 上の DFS ルートディレクトリはシンボリックリンクの形式で DFS リンクを提供	できる。例えば、共有ディレクトリ内のシンボリックリンク 	<code class="filename">junction->msdfs:storage1\share1</code> は DFS ジャン	クション (接点) として機能する。 DFS 対応クライアントがジャンクションリ	ンクにアクセスしようとするとき、それらは実際のストレージ ( この場合	は <em class="parameter"><code>\\storage1\share1</code></em> ) にリダイレクトされる。	</p><p><a class="indexterm" name="id2637183"></a><a class="indexterm" name="id2637190"></a><a class="indexterm" name="id2637197"></a><a class="indexterm" name="id2637204"></a>	Samba 上の DFS ツリーは、 Windows 95 から Windows 200x までの DFS 対応クライア	ントをサポートしている。	<a class="link" href="msdfs.html#dfscfg" title="Example 20.1. DFS が設定された smb.conf">以下の設定例</a>は、 Samba サーバでどのよう	に DFS ツリーを設定するかを示す。	ディレクトリ<code class="filename">/export/dfsroot</code> 内で、他のネットワーク上のサー	バへの DFS リンクを設定する。</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>cd /export/dfsroot</code></strong><code class="prompt">root# </code><strong class="userinput"><code>chown root /export/dfsroot</code></strong><code class="prompt">root# </code><strong class="userinput"><code>chmod 755 /export/dfsroot</code></strong><code class="prompt">root# </code><strong class="userinput"><code>ln -s msdfs:storageA\\shareA linka</code></strong><code class="prompt">root# </code><strong class="userinput"><code>ln -s msdfs:serverB\\share,serverC\\share linkb</code></strong></pre><p></p><div class="example"><a name="dfscfg"></a><p class="title"><b>Example 20.1. DFS が設定された smb.conf</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2637319"></a><em class="parameter"><code>netbios name = GANDALF</code></em></td></tr><tr><td><a class="indexterm" name="id2637331"></a><em class="parameter"><code>host msdfs   = yes</code></em></td></tr><tr><td> </td></tr><tr><td><em class="parameter"><code>[dfs]</code></em></td></tr><tr><td><a class="indexterm" name="id2637352"></a><em class="parameter"><code>path = /export/dfsroot</code></em></td></tr><tr><td><a class="indexterm" name="id2637364"></a><em class="parameter"><code>msdfs root = yes</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2637378"></a><a class="indexterm" name="id2637385"></a><a class="indexterm" name="id2637393"></a>	DFS ルートとして使用しているディレクトリのパーミションと所有者の設定を行い、 	特定のユーザだけが msdfs リンクを作成、削除、変更できるように設定すべきであ	る。	シンボリックリンク名は、すべて小文字にすべきことに留意すること。この制約は、	Samba が、リンク名を取得するために、すべての大文字、小文字の組み合わせを試	すことを避けるために設けられている。	最後に、ネットワーク上の共有したいところへシンボリックリンクを張り、Sambaを起動する。	</p><p><a class="indexterm" name="id2637425"></a><a class="indexterm" name="id2637432"></a>	これで DFS 対応クライアントは、 <code class="constant">\\samba\dfs</code> にある Samba	サーバー上の DFS ツリーをブラウズすることができる．	リンクa,リンクb（クライアントからはディレクトリとしてみることができる）	に アクセスすると、ユーザーは直接ネットワーク上の共有資源にアクセスす	ることになる。	</p></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2637457"></a>よくあるエラー</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Windows　クライアントは、以前 DFS でなくマウン		トされていたものが、 DFS ルートとしてマウントされたり、その逆		を行ったりすると、		リブートする必要がある． よりよい解決方法は、新規の共有として		公開し、DFS ルートとすることである。</p></li><li class="listitem"><p>現状では制約事項として、msdfs シンボリックリン		ク名はすべて小文字で記述される必要がある。</p></li><li class="listitem"><p>セキュリティのために、DFS ツリーのルートとな		るディレクトリは、特定のユーザのみがそのディレクトリ内でシンボ		リックリンクを変更できるように所有者とパーミッションを設定する		必要がある。</p></li></ul></div><div class="sect2" title="MSDFSのUNIXパスは大文字小文字を識別する"><div class="titlepage"><div><div><h3 class="title"><a name="id2637500"></a>MSDFSのUNIXパスは大文字小文字を識別する</h3></div></div></div><p>		あるネットワーク管理者は何故 DFS が機能しなかったかを究明しようとした長い会議		の後に Samba メーリングリストにアドバイスを送った。		彼のアドバイスには注意する価値がある。		</p><p><span class="quote">“<span class="quote">		私の特定の DFS ルートが機能しない理由を解明するためにいくらかの時間を費やした。		私はシンボリックリンクはすべて小文字で記述するべきであると文書に書かれているこ		とに気がついた。シンボリックリンクへのフルパスをも小文字で書き直すことにした。		</span>”</span></p><p>		<span class="quote">“<span class="quote">設定例： 以下のように定義された共有がある</span>”</span>		</p><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[pub]</code></em></td></tr><tr><td><a class="indexterm" name="id2637554"></a><em class="parameter"><code>path = /export/home/Shares/public_share</code></em></td></tr><tr><td><a class="indexterm" name="id2637566"></a><em class="parameter"><code>msdfs root = yes</code></em></td></tr></table><p>		<span class="quote">“<span class="quote">そして (DFS クライアントがインストールされた) Windows		で、以下のシンボリックリンクをたどることができなかった。		</span>”</span>		</p><pre class="screen">		damage1 -> msdfs:damage\test-share		</pre><p>		</p><p>		<span class="quote">“<span class="quote">デバッグレベルを10にして実行して明らかになったこと</span>”</span>		</p><pre class="programlisting">		[2003/08/20 11:40:33, 5] msdfs/msdfs.c:is_msdfs_link(176)		  is_msdfs_link: /export/home/shares/public_share/* does not exist.		</pre><p>		<span class="quote">“<span class="quote">気になる。 私はディレクトリ名		を <code class="constant">.../Shares/...</code> から		<code class="constant">.../shares/...</code> に変更した。 (サービス定義		に伴って) そして、機能するようになった!</span>”</span>		</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="InterdomainTrusts.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="classicalprinting.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 19. ドメイン間の信頼関係 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 21. 旧式の印刷サポート</td></tr></table></div></body></html>