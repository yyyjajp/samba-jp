<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 11. アカウント情報データベース</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="公式のSamba 3.2.x HOWTOとリファレンスガイド"><link rel="up" href="optional.html" title="Part III. 詳細な設定方法"><link rel="prev" href="NetworkBrowsing.html" title="Chapter 10. ネットワークブラウジング"><link rel="next" href="groupmapping.html" title="Chapter 12. グループのマッピング: Microsoft Windows と UNIX"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 11. アカウント情報データベース</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="NetworkBrowsing.html">Prev</a> </td><th width="60%" align="center">Part III. 詳細な設定方法</th><td width="20%" align="right"> <a accesskey="n" href="groupmapping.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 11. アカウント情報データベース"><div class="titlepage"><div><div><h2 class="title"><a name="passdb"></a>Chapter 11. アカウント情報データベース</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jelmer@samba.org">jelmer@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jht@samba.org">jht@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Gerald</span> <span class="othername">(Jerry)</span> <span class="surname">Carter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jerry@samba.org">jerry@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jeremy</span> <span class="surname">Allison</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:jra@samba.org">jra@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Guenther</span> <span class="surname">Deschner</span></h3><span class="contrib">LDAP updates</span> <div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:gd@samba.org">gd@samba.org</a>></code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Olivier (lem)</span> <span class="surname">Lemaire</span></h3><div class="affiliation"><span class="orgname">IDEALX<br></span><div class="address"><p><code class="email"><<a class="email" href="mailto:olem@IDEALX.org">olem@IDEALX.org</a>></code></p></div></div></div></div><div><p class="pubdate">May 24, 2003</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="passdb.html#id2598086">機能と利便性</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2598124">下位互換性のあるバックエンド</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2598343">新しいアカウント格納システム</a></span></dt></dl></dd><dt><span class="sect1"><a href="passdb.html#passdbtech">技術情報</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2598990">セキュリティに関する重要な注意事項</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2599616">Microsoft Windows と UNIX の間の、ユーザ識別子のマッピング</a></span></dt><dt><span class="sect2"><a href="passdb.html#idmapbackend">分散マシン上の共通のUID/GIDマッピング</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2600228">LDAPに関するコメント</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2600731">LDAPディレクトリとWindowsのコンピュータアカウント</a></span></dt></dl></dd><dt><span class="sect1"><a href="passdb.html#acctmgmttools">アカウント管理ツール</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2601226"><code class="literal">smbpasswd</code>ツール</a></span></dt><dt><span class="sect2"><a href="passdb.html#pdbeditthing"><code class="literal">pdbedit</code>ツール</a></span></dt></dl></dd><dt><span class="sect1"><a href="passdb.html#id2603934">パスワードバックエンド</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2603996">平文</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2604082">smbpasswd: 暗号化したパスワードデータベース</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2604378">tdbsam</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2604563">ldapsam</a></span></dt></dl></dd><dt><span class="sect1"><a href="passdb.html#id2607386">よくあるエラー</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2607392">ユーザがログオンできない</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2607432"><em class="parameter"><code>auth methods</code></em>の設定</a></span></dt></dl></dd></dl></div><p><a class="indexterm" name="id2597858"></a><a class="indexterm" name="id2597866"></a><a class="indexterm" name="id2597873"></a><a class="indexterm" name="id2597880"></a>以前のSamba3リリースでは複数のアカウント情報バックエンドを同時に動作させることができた。この機能はSamba3.0.23からなくなった。Samba3.0.23からは、passdbバックエンドは1つのみ指定できる。</p><p><a class="indexterm" name="id2597898"></a><a class="indexterm" name="id2597905"></a><a class="indexterm" name="id2597912"></a><a class="indexterm" name="id2597919"></a><a class="indexterm" name="id2597926"></a><a class="indexterm" name="id2597932"></a>3つのpassdbバックエンドがSambaチームで完全なメンテナンスが行われており、それは以下である:<code class="literal">smbpasswd</code> (旧式)、<code class="literal">tdbsam</code>(tdbベースのバイナリファイル形式)と<code class="literal">ldapsam</code>(LDAP)。もちろん、<code class="literal">ldapsam</code>バックエンドのみが、POSIX(UNIX)とSambaのユーザとグループアカウント情報を単一のリポジトリに格納できる。<code class="literal">smbpasswd</code>と<code class="literal">tdbsam</code>バックエンドはSambaユーザアカウントのみ格納する。</p><p>厳密な意味で、3つのアカウントストレージとアクセスシステムがサポートされている。それらの1つは旧式である(smbpasswd)。すべての簡単なシステムには <code class="literal">tdbsam</code>方式を使用することを推奨する。<code class="literal">ldapsam</code>はもっと大規模か、複雑なネットワークで使用すること。</p><p><a class="indexterm" name="id2598013"></a><a class="indexterm" name="id2598020"></a><a class="indexterm" name="id2598027"></a><a class="indexterm" name="id2598034"></a><a class="indexterm" name="id2598042"></a><a class="indexterm" name="id2598049"></a><a class="indexterm" name="id2598056"></a>厳格かつ文字通りの意味で、passdbバックエンドはアカウント格納メカニズム(あるいは方法)のみである。技術の選択はミスリードの可能性があるが、言い回しの選択で困っている。この章では、ユーザと信頼アカウントにフォーカスをあてたアカウント格納システムの本質について記述する。信頼アカウントは2つの形式があり、それはマシン信頼アカウント(コンピュータアカウント)とドメイン間信頼アカウントである。それらはユーザのようなエントリとして扱われる。</p><div class="sect1" title="機能と利便性"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2598086"></a>機能と利便性</h2></div></div></div><p>Samba-3 は Samba-2.2.x の以下の機能について完全な下位互換性を提供する:<a class="indexterm" name="id2598097"></a><a class="indexterm" name="id2598106"></a><a class="indexterm" name="id2598116"></a></p><div class="sect2" title="下位互換性のあるバックエンド"><div class="titlepage"><div><div><h3 class="title"><a name="id2598124"></a>下位互換性のあるバックエンド</h3></div></div></div><div class="variablelist"><dl><dt><span class="term">平文</span></dt><dd><p><a class="indexterm" name="id2598141"></a><a class="indexterm" name="id2598148"></a><a class="indexterm" name="id2598155"></a><a class="indexterm" name="id2598162"></a><a class="indexterm" name="id2598168"></a>		これは全く持ってバックエンドではないが、単純化のためにここに表示する。		Sambaは伝統的なUNIX/Linuxの<code class="filename">/etc/passwd</code>と                <code class="filename">/etc/shadow</code>形式のサブシテムに平文認証要求を渡す		ように設定できる。Pluggable Authentication Modules (PAM) サポートが		あるシステム上では、 全てのPAMモジュールがサポートされる。動作は、		Samba-2.2.x の場合と全く同様で、Microsoft Windowsクライアントにより		課されるプロトコルの制約も同様に適用される。平文パスワードの使用に		関する制約に関する詳細情報は、		<a class="link" href="passdb.html#passdbtech" title="技術情報">技術情報の項</a>を参照のこと。			</p></dd><dt><span class="term">smbpasswd</span></dt><dd><p><a class="indexterm" name="id2598228"></a><a class="indexterm" name="id2598235"></a><a class="indexterm" name="id2598242"></a><a class="indexterm" name="id2598250"></a>		このオプションは、Microsoft Windows LanMan と NT の暗号化パスワード		及び一部のアカウント情報を格納するフィールドを含む平文ASCII(テキスト)		レイアウトを維持する<code class="filename">smbpasswd</code>ファイルの継続的		使用を可能にする。この種のパスワードバックエンドは、Microsoft 		Windows NT4/200xサーバと包括的な相互運用を行うために必要な拡張		コントロールを提供するための、Microsoft Windows NT/200x SAM		(Security Account Manager)情報を一切格納しない。			</p><p>		このバックエンドは、Samba のより古いバージョンとの下位互換性のために		のみ使用するべきである。将来のリリースでは、切り捨てられていくかもしれない。			</p></dd><dt><span class="term">ldapsam_compat (Samba-2.2 LDAP互換)</span></dt><dd><p><a class="indexterm" name="id2598305"></a><a class="indexterm" name="id2598312"></a><a class="indexterm" name="id2598320"></a>		これは、Samba-2.2.x LDAP スキーマ拡張を使用する、既存のOpenLDAP		バックエンドとの継続的運用を可能にするパスワードバックエンドの		オプションである。このオプションはマイグレーションツールとして		提供されているが、この時点で強制的にマイグレーションする意味はない。		このツールは最終的には切り捨てられることになる。			</p></dd></dl></div></div><div class="sect2" title="新しいアカウント格納システム"><div class="titlepage"><div><div><h3 class="title"><a name="id2598343"></a>新しいアカウント格納システム</h3></div></div></div><p>Samba-3では多数の新しいパスワードバックエンド機能が導入された。<a class="indexterm" name="id2598355"></a><a class="indexterm" name="id2598364"></a></p><div class="variablelist"><dl><dt><span class="term">tdbsam</span></dt><dd><p><a class="indexterm" name="id2598385"></a><a class="indexterm" name="id2598392"></a><a class="indexterm" name="id2598399"></a>		このバックエンドは、ローカルサーバに、リッチなデータベースバックエンドを		提供する。このバックエンドは、複数のドメインコントローラ（つまり、PDC+		一つ以上のBDCをインストールしている場合には適さない。			</p><p><a class="indexterm" name="id2598419"></a><a class="indexterm" name="id2598426"></a><a class="indexterm" name="id2598432"></a><a class="indexterm" name="id2598439"></a><a class="indexterm" name="id2598446"></a><a class="indexterm" name="id2598453"></a>		<span class="emphasis"><em>tdbsam</em></span>パスワードバックエンドは古い		<span class="emphasis"><em>smbpasswd</em></span>情報のほかに、拡張された		Microsoft Windows NT/200xのSAM情報をバイナリ形式のTDB(トリビアルデータベース)		ファイルに格納する。拡張情報を含むことで、Samba-3が、Microsoft Windows NT4/200x		ベースのシステムと同様のアカウントアクセス及びシステムアクセス制御を実現する		ことを可能にする。			</p><p><a class="indexterm" name="id2598485"></a><a class="indexterm" name="id2598492"></a><a class="indexterm" name="id2598498"></a>		<span class="emphasis"><em>tdbsam</em></span>を入れたのは、OpenLDAPを稼動する伴う		複雑性と、その間接費用を発生させずに、シンプルななサイト運用を		可能にしたいというユーザからの要求にに直接応えるためである。これは、		ユーザー数250未満のサイトにのみ推奨する。これより大規模のサイト、		または実装では、OpenLDAP の使用またはActive Directoryへの統合を強く		推奨する。			</p></dd><dt><span class="term">ldapsam</span></dt><dd><p><a class="indexterm" name="id2598536"></a><a class="indexterm" name="id2598543"></a>		これは、分散アカウントを導入している場合に、リッチなディレクトリバックエンド		を提供する。			</p><p><a class="indexterm" name="id2598558"></a><a class="indexterm" name="id2598565"></a><a class="indexterm" name="id2598572"></a><a class="indexterm" name="id2598579"></a><a class="indexterm" name="id2598586"></a>		Samba-3ではLDAP用拡張の実装が新しくなり、これにより新しい形式のSambaスキーマを		持つOpenLDAPの設定を必要とする。新しい形式のスキーマファイルは、Samba		ディストリビューションの		<code class="filename">examples/LDAP</code>のディレクトリにある。			</p><p><a class="indexterm" name="id2598614"></a><a class="indexterm" name="id2598621"></a><a class="indexterm" name="id2598628"></a><a class="indexterm" name="id2598635"></a><a class="indexterm" name="id2598642"></a>		新しいLDAPの実装は、Sambaの過去のバージョンで可能だったコントロール能力を		著しく向上するものである。このバージョンでは、<span class="quote">“<span class="quote">ユーザーごとの</span>”</span>		プロファイル設定、ホームディレクトリ、アカウントアクセス制御、その他		多くの設定が可能になった。企業サイトでは、機能性と拡張性の向上要求に、		Sambaチームがしっかり耳を傾けたと いうことが理解できるはずである。			</p></dd></dl></div></div></div><div class="sect1" title="技術情報"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="passdbtech"></a>技術情報</h2></div></div></div><p><a class="indexterm" name="id2598687"></a><a class="indexterm" name="id2598694"></a>	古いWindowsクライアントは、平文パスワードを送信する。Sambaはこれらの	パスワードを暗号化し、UNIXユーザデータベースに格納されているハッシュと	比較することにより、確認することができる。	</p><p><a class="indexterm" name="id2598713"></a><a class="indexterm" name="id2598720"></a><a class="indexterm" name="id2598727"></a><a class="indexterm" name="id2598734"></a>	より新しいWindowsクライアントは、平文パスワードのかわりに、暗号化された	パスワード(Lanman及びNTハッシュと呼ばれるもの)を送信する。最新のクライアントは、	暗号化されたパスワードのみを送信し、クライアントのレジストリが改変されていない	限り、平文パスワードを送信することを拒否する。	</p><p><a class="indexterm" name="id2598754"></a><a class="indexterm" name="id2598762"></a>	Sambaはなぜ単純にUNIXパスワードデータベースを使うことが出来ないかという質問は	多くの人から聞く。Windowsは、パスワードに対してそれ固有の暗号化形式を要求する。	WindowsのパスワードはUNIX形式の暗号化パスワードに変換できない。そのため、標準	UNIXユーザデータベースを使うことが出来ず、Lanman ハッシュとNTハッシュは別の所に	格納しなければならない。	</p><p><a class="indexterm" name="id2598783"></a><a class="indexterm" name="id2598790"></a><a class="indexterm" name="id2598797"></a><a class="indexterm" name="id2598804"></a>	パスワードの暗号化方式が異なるのみならず、WindowsはUNIXユーザデータベースには	格納されないような各ユーザに関する特定のデータを格納する。例えば、ユーザが	ログインする可能性のあるワークステーション、ユーザのプロファイルが格納されて	いる場所等々である。Sambaは<a class="link" href="smb.conf.5.html#PASSDBBACKEND" target="_top">passdb backend</a>を使用して	この情報を取り出し、格納する。 通常、使用できるバックエンドは、LDAP、tdbsum	および平文ファイルである。<a class="link" href="smb.conf.5.html#PASSDBBACKEND" target="_top">passdb backend</a>のパラメーター	に関する詳細は、<code class="filename">smb.conf</code>のマニュアルページを参照のこと。	</p><div class="figure"><a name="idmap-sid2uid"></a><p class="title"><b>Figure 11.1. IDMAP: SIDのUIDへの解決</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/idmap-sid2uid.png" width="216" alt="IDMAP: SIDのUIDへの解決"></div></div></div><br class="figure-break"><p>	<a class="indexterm" name="id2598901"></a><a class="indexterm" name="id2598908"></a><a class="indexterm" name="id2598914"></a>	SIDのUIDへの解決は、Samba の適正運用の根幹を成す。以下の両例で、winbinddが	稼動していないか、あるいは、接続できない状況のとき、ローカルのSID/UID解決	のみが可能である。<a class="link" href="passdb.html#idmap-sid2uid" title="Figure 11.1. IDMAP: SIDのUIDへの解決">SIDのUIDへの解決</a>	および<a class="link" href="passdb.html#idmap-uid2sid" title="Figure 11.2. IDMAP: SIDのUIDへの解決">UIDのSIDへの解決</a>の図を参照のこと。	</p><div class="figure"><a name="idmap-uid2sid"></a><p class="title"><b>Figure 11.2. IDMAP: SIDのUIDへの解決</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/idmap-uid2sid.png" width="270" alt="IDMAP: SIDのUIDへの解決"></div></div></div><br class="figure-break"><div class="sect2" title="セキュリティに関する重要な注意事項"><div class="titlepage"><div><div><h3 class="title"><a name="id2598990"></a>セキュリティに関する重要な注意事項</h3></div></div></div><p><a class="indexterm" name="id2598998"></a><a class="indexterm" name="id2599006"></a><a class="indexterm" name="id2599013"></a><a class="indexterm" name="id2599020"></a><a class="indexterm" name="id2599027"></a>	UNIXとSMBのパスワード暗号化のテクニックは、一見、類似しているように見える。しかし、	この類似性は、皮一枚だけの表面的なものである。。UNIXのスキームでは、通常 ログインの際に、	平文パスワードをネットワークを通して送信します。これは悪い方法である。SMBの暗号化	スキームは、ネットワークを通して平文パスワードを送信することは絶対にないが、ディスク上に	16バイトのハッシュ値を格納する。これも悪い方法である。なぜか。それは、16バイトのハッシュ	値は、<span class="quote">“<span class="quote">パスワードと同等</span>”</span>だからである。ユーザのパスワードをハッシュ値から	導き出すことはできないが、クライアントに手を加えれば、サーバにアクセスするために使える	可能性がある。これは、侵入者の側にかなりの技術的知識があることを前提としてるが、それでも	可能であることは確かである。従って、(smbpasswdファイル、 LDAP)いずれのパスワードデータ	ベースバックエンドを使用していても、そこに格納されたデータが、全ユーザの平文パスワードを	持っているかのように、慎重に取り扱わなければならない。これらのデータベースの内容は極秘とし、	ファイルは、適切に保護されていなければならない。		</p><p><a class="indexterm" name="id2599083"></a><a class="indexterm" name="id2599090"></a><a class="indexterm" name="id2599097"></a>	理想的には、ネットワーク上でもディスク上でも平文パスワードを持ったり送信したり	しないようなパスワードのスキームが欲しいところである。残念ながら、Sambaは他の	SMBシステム(Windows NT、Windows for Workgroups、Windows 9x/Me)との互換性を	確保しなければならないという要件のために、これは実現できない。		</p><p><a class="indexterm" name="id2599117"></a><a class="indexterm" name="id2599124"></a>	Windows NT 4.0 サービスパック 3は既定値で平文パスワードの送信を無効化している。	これにより、暗号化されたパスワードのサポートを使用するか、平文パスワードを再度	有効化するように Windows NT レジストリを編集するか、どちらかが必要となる。		</p><p><a class="indexterm" name="id2599145"></a><a class="indexterm" name="id2599152"></a>	Microsoft Windowsの下記のバージョンは、ドメイン環境にログオンする可能性があるにも	かかわらず、完全なドメインセキュリティのプロトコルをサポートしていない:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>MS DOS ネットワーククライアント3.0で基本的なネットワーク リダイレクタがインストールされているもの</p></li><li class="listitem"><p>Windows 95で、アップデートされたネットワークリダイレクタがインストールされているもの</p></li><li class="listitem"><p>Windows 98 [Second Edition]</p></li><li class="listitem"><p>Windows Me</p></li></ul></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2599201"></a><a class="indexterm" name="id2599208"></a><a class="indexterm" name="id2599215"></a> 	MS Windows XP Home は、ドメインメンバになる機能はなく、ドメインログオンは実行できない。		</p></div><p>	下記のバージョンのMicrosoft Windowsは、ドメインセキュリティのプロトコルを完全にサポートしている。		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Windows NT 3.5x.</p></li><li class="listitem"><p>Windows NT 4.0.</p></li><li class="listitem"><p>Windows 2000 Professional.</p></li><li class="listitem"><p>Windows 200x Server/Advanced Server.</p></li><li class="listitem"><p>Windows XP Professional.</p></li></ul></div><p><a class="indexterm" name="id2599266"></a><a class="indexterm" name="id2599273"></a><a class="indexterm" name="id2599280"></a><a class="indexterm" name="id2599287"></a><a class="indexterm" name="id2599294"></a><a class="indexterm" name="id2599301"></a>	Microsoft SMB/CIFS クライアントの現在のリリース版は全て、ここに説明するSMBの	チャレンジ/ レスポンス認証の仕組みをサポートしている。平文認証を有効化しても、	クライアントが暗号化による認証に参加する能力を無効化するわけではない。そうではなく、	クライアントが平文でも暗号化でもどちらのパスワード認証方式にも対応できるようにする。		</p><p><a class="indexterm" name="id2599322"></a><a class="indexterm" name="id2599329"></a><a class="indexterm" name="id2599336"></a><a class="indexterm" name="id2599344"></a><a class="indexterm" name="id2599350"></a>	Microsoft Windowsのクライアントは、暗号化されたパスワードのみキャッシュする。	レジストリの変更により、平文パスワードが再度有効化されても、平文パスワードは	キャッシュされない。このことは、ネットワーク接続が切れた場合、 キャッシュされた	(即ち暗号化された)パスワードのみがリソースサーバに送られて、自動再接続を実行する	ために使用されるということを意味する。リソースサーバが暗号化された パスワードを	サポートしていない場合、自動再接続はできない。暗号化されたパスワードの使用を強く	推奨する。		</p><div class="sect3" title="暗号化されたパスワードの長所"><div class="titlepage"><div><div><h4 class="title"><a name="id2599384"></a>暗号化されたパスワードの長所</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2599395"></a><a class="indexterm" name="id2599402"></a><a class="indexterm" name="id2599410"></a>		平文パスワードがネットワーク経由で送信されない。誰かがネットワーク		スニファーを使用して、SMBサーバに送られるパスワードを記録することができない。				</p></li><li class="listitem"><p><a class="indexterm" name="id2599429"></a><a class="indexterm" name="id2599436"></a><a class="indexterm" name="id2599443"></a>		平文パスワードが、メモリにもディスクにも、どこにも保存されない。				</p></li><li class="listitem"><p><a class="indexterm" name="id2599457"></a><a class="indexterm" name="id2599464"></a><a class="indexterm" name="id2599472"></a><a class="indexterm" name="id2599479"></a>		Windows NTは暗号化パスワードをサポートしないサーバとやりとりする		ことを好まない。また、サーバーが「userレベル」のセキュリティモード		になっているとき、そのサーバを ブラウズすることを拒否する。そのため、		接続の度に、ユーザにパスワードを入力するように要求するので、大変厄介		である。 これを止めさせる唯一の方法は、SMB暗号を使用することである。				</p></li><li class="listitem"><p><a class="indexterm" name="id2599501"></a><a class="indexterm" name="id2599508"></a>		暗号化パスワードのサポートにより、共有(リソース)への自動再接続が可能になる。				</p></li><li class="listitem"><p><a class="indexterm" name="id2599523"></a><a class="indexterm" name="id2599530"></a>		PDC/BDC の運用に暗号化パスワードは不可欠である。 				</p></li></ul></div></div><div class="sect3" title="暗号化されていないパスワードの長所"><div class="titlepage"><div><div><h4 class="title"><a name="id2599542"></a>暗号化されていないパスワードの長所</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2599554"></a>		平文パスワードは、ディスクに保存されず、メモリにキャッシュされない。				</p></li><li class="listitem"><p><a class="indexterm" name="id2599569"></a><a class="indexterm" name="id2599576"></a>		平文パスワードは、LoginやFTPなどの、UNIXの他のサービスと同じパスワード		ファイルが使用できる。				</p></li><li class="listitem"><p><a class="indexterm" name="id2599592"></a><a class="indexterm" name="id2599599"></a>		TelnetやFTPなどの他のサービスが、平文パスワードをネットワーク上で		送信している。従って、SMBのために送信しても大勢に影響はない。				</p></li></ul></div></div></div><div class="sect2" title="Microsoft Windows と UNIX の間の、ユーザ識別子のマッピング"><div class="titlepage"><div><div><h3 class="title"><a name="id2599616"></a>Microsoft Windows と UNIX の間の、ユーザ識別子のマッピング</h3></div></div></div><p><a class="indexterm" name="id2599626"></a><a class="indexterm" name="id2599633"></a><a class="indexterm" name="id2599639"></a>	Microsoft Windows NT4/200xがセキュリティ識別子(SID)を要求するのと同様に、	UNIX/Linuxの全ての操作は、ユーザ識別子(UID)を要求する。SambaはMicrosoft Windows	のユーザーをUNIX/LinuxのUID にマッピングするために、二つの方法を提供する。	</p><p><a class="indexterm" name="id2599660"></a><a class="indexterm" name="id2599667"></a><a class="indexterm" name="id2599673"></a><a class="indexterm" name="id2599680"></a><a class="indexterm" name="id2599687"></a>	第一に、すべてのSamba SAM(セキュリティアカウントマネージャデータベース)	アカウントが、そのアカウントとマッピングされるべきUNIX/Linux UID を必要とする。	アカウント情報データベースにユーザが追加されるにつれ、SambaはSambaのホストOSに	そのアカウントを追加するために、<a class="link" href="smb.conf.5.html#ADDUSERSCRIPT" target="_top">add user script</a>	インタフェースを呼ぶ。本質的には、ローカルSAMの中の全アカウントが、	ローカルユーザアカウントを必要とする。	</p><p>	<a class="indexterm" name="id2599727"></a>	<a class="indexterm" name="id2599733"></a>	<a class="indexterm" name="id2599740"></a>	<a class="indexterm" name="id2599746"></a>	<a class="indexterm" name="id2599753"></a>	<a class="indexterm" name="id2599760"></a>	<a class="indexterm" name="id2599766"></a>	Windows SIDをUNIX UIDにマップする2番目の方法は、<code class="filename">smb.conf</code>中の	<span class="emphasis"><em>idmap uid</em></span>と<span class="emphasis"><em>idmap gid</em></span>パラメータを経由する	方法である。これらのパラメータの情報についてはマニュアルページを参照のこと。リモート	(非メンバのWindowsクライアントあるいは外部ドメイン)SAMサーバからのユーザマッピング	時にはこれらのパラメータは不可欠である。	</p></div><div class="sect2" title="分散マシン上の共通のUID/GIDマッピング"><div class="titlepage"><div><div><h3 class="title"><a name="idmapbackend"></a>分散マシン上の共通のUID/GIDマッピング</h3></div></div></div><p><a class="indexterm" name="id2599815"></a><a class="indexterm" name="id2599821"></a><a class="indexterm" name="id2599828"></a><a class="indexterm" name="id2599834"></a><a class="indexterm" name="id2599842"></a><a class="indexterm" name="id2599848"></a>	Samba-3は、分散ネットワーク環境中で、すべてのサーバ上で同一のUIDとGIDを使うことを	可能にする特別な機能を持っている。分散ネットワークとは、PDCが存在するもの、一つ以上の	BDCがあるもの、あるいは1つ以上のドメインメンバサーバがあるものである。なぜこれが	重要かというと、ファイルが1つ以上のプロトコル(たとえばNFS)で共有され、たとえば	<code class="literal">rsync</code>のようなツールを使ってUNIX/Linuxシステム間で、ユーザが	ファイルをコピーすることがあるからである。	</p><p><a class="indexterm" name="id2599877"></a><a class="indexterm" name="id2599884"></a><a class="indexterm" name="id2599891"></a><a class="indexterm" name="id2599898"></a><a class="indexterm" name="id2599904"></a><a class="indexterm" name="id2599911"></a><a class="indexterm" name="id2599919"></a>	<a class="indexterm" name="id2599926"></a>	<em class="parameter"><code>idmap backend</code></em>と呼ばれるパラメータを使って、	特別な機能を有効に出来る。このパラメータの既定値は空の文字列である。	技術的に、LDAPベースのidmapバックエンドをUIDとGID向けに使うことは可能	であるが、SAMバックエンド用にLDAPの使用も行うネットワーク設定用にこれを	使う時にこれは最も意味を持つ。この設定については	<a class="link" href="passdb.html#idmapbackendexample" title="Example 11.1. LDAP idmap バックエンドを使う設定例">LDAP idmap バックエンドを使う設定例</a>	にある。	</p><a class="indexterm" name="id2599965"></a><div class="example"><a name="idmapbackendexample"></a><p class="title"><b>Example 11.1. LDAP idmap バックエンドを使う設定例</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2600000"></a><em class="parameter"><code>idmap backend = ldap:ldap://ldap-server.quenya.org:636</code></em></td></tr><tr><td># Alternatively, this could be specified as:</td></tr><tr><td><a class="indexterm" name="id2600017"></a><em class="parameter"><code>idmap backend = ldap:ldaps://ldap-server.quenya.org</code></em></td></tr></table></div></div><br class="example-break"><p><a class="indexterm" name="id2600032"></a><a class="indexterm" name="id2600040"></a>	LDAPバックエンドに重要な仕事をさせたいネットワーク管理者は、遅かれ	早かれPADLソフトウェアによって優れた功績を知ることになろう。	PADL <a class="ulink" href="http://www.padl.com" target="_top">http://www.padl.com</a>はとても興味深い一連の	ツールをオープンソースで作成し、公開している。これらのツールは	以下を含む:	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2600068"></a><a class="indexterm" name="id2600075"></a><a class="indexterm" name="id2600082"></a><a class="indexterm" name="id2600089"></a><a class="indexterm" name="id2600095"></a><a class="indexterm" name="id2600102"></a><a class="indexterm" name="id2600109"></a><a class="indexterm" name="id2600116"></a>		<span class="emphasis"><em>nss_ldap:</em></span>AIX、Linux、Solarisやその他のOS向けの		ネイティブなネームサービスサポートを提供するLDAPネームサービススイッチ		(NSS)モジュール。このツールはUID/GIDの一元的な格納と検索に使う		ことができる。		</p></li><li class="listitem"><p><a class="indexterm" name="id2600141"></a><a class="indexterm" name="id2600148"></a><a class="indexterm" name="id2600154"></a><a class="indexterm" name="id2600161"></a>		<span class="emphasis"><em>pam_ldap:</em></span>PAMモジュールで、UNIX/Linuxシステムの		アクセス認証のLDAP統合を提供する。		</p></li><li class="listitem"><p><a class="indexterm" name="id2600182"></a><a class="indexterm" name="id2600188"></a><a class="indexterm" name="id2600196"></a><a class="indexterm" name="id2600203"></a>		<span class="emphasis"><em>idmap_ad:</em></span>PADL Web		<a class="ulink" href="http://www.padl.com/download/xad_oss_plugins.tar.gz" target="_top">サイト</a>		からの、Microsoftサービスのための、UNIX RFC2307スキーマを		サポートするIDMAPバックエンド。		</p></li></ul></div></div><div class="sect2" title="LDAPに関するコメント"><div class="titlepage"><div><div><h3 class="title"><a name="id2600228"></a>LDAPに関するコメント</h3></div></div></div><p><a class="indexterm" name="id2600237"></a><a class="indexterm" name="id2600246"></a><a class="indexterm" name="id2600253"></a><a class="indexterm" name="id2600260"></a>	現在の情報技術界で、多くの興奮と関心がLDAPディレクトリに向けられている。	LDAPアーキテクチャは高度に拡張性があるように設計された。また、広範囲な	OSとプラットフォームを取り巻く、非常にたくさんのアプリケーションの潜在的	な領域をまたがって使うようにも設計されている。LDAP技術は会社全体のシングル	サインオン(SSO)環境の基盤となる連携アイデンティティ管理(FIM)ソリューション	の中心部をなしている(訳注:TivoliとかRSAでこのような製品がある様子)。	</p><p><a class="indexterm" name="id2600291"></a><a class="indexterm" name="id2600298"></a><a class="indexterm" name="id2600305"></a><a class="indexterm" name="id2600311"></a>	LDAPの実装は広範囲な種類のプラットフォームで構築されている。これは、	Microsoft Windows Active Directory(ADS)、NovellのeDirectoryやその他の	もののの中心に位置する。LDAPによるディレクトリサービスの実装は、	新しい世代のアプリケーションと同様に古いものとも相互に関係し、	それらはすべて何らかの認証サービスに依存する。	</p><p><a class="indexterm" name="id2600332"></a><a class="indexterm" name="id2600339"></a><a class="indexterm" name="id2600346"></a><a class="indexterm" name="id2600353"></a><a class="indexterm" name="id2600360"></a><a class="indexterm" name="id2600367"></a><a class="indexterm" name="id2600374"></a><a class="indexterm" name="id2600381"></a><a class="indexterm" name="id2600388"></a><a class="indexterm" name="id2600395"></a><a class="indexterm" name="id2600402"></a><a class="indexterm" name="id2600409"></a><a class="indexterm" name="id2600416"></a><a class="indexterm" name="id2600423"></a>	UNIXのサービスは、ツールやユーティリティを介することによって、LDAPディレクトリ	の情報を認証のために利用することが出来る。LDAPディレクトリ	とミドルウェアのツールとユーティリティからなる統合環境により、すべての	ユーザが一元管理されたUNIXプラットフォームにアクセスすることが可能になる。	プラットフォームは、必要に応じて物理的に分散配置されてもよい。この機構の	恩恵を受けるアプリケーションとしては、UNIXログインシェル、メールとメッセージ	システム、quota制御、印刷システム、DNSサーバ、DHCPサーバやもちろんSambaも	含まれる。	</p><p><a class="indexterm" name="id2600459"></a><a class="indexterm" name="id2600466"></a><a class="indexterm" name="id2600473"></a><a class="indexterm" name="id2600480"></a><a class="indexterm" name="id2600486"></a><a class="indexterm" name="id2600493"></a>	多くのサイトが、Samba用に拡張性のあるpassdbバックエンドを提供するために、	まずはじめにLDAPをインストールする。その他はSamba SAMバックエンドのような	新しいユーザのために存在するLDAPディレクトリに適合することが必要な場面に	直面する。Sambaに対する特別な必要性と魅力が何であっても、LDAPディレクトリ	構造とその実装のデザインに関する決定は、そのサイトの永続的な本質である。	これらは、長期にわたる情報システム管理コストに影響する広範囲な影響がある。	</p><p><a class="indexterm" name="id2600526"></a><a class="indexterm" name="id2600532"></a>	LDAPの展開を急いではならない。どのように、ディレクトリ情報ツリーが現在と	将来のサイトのニーズに影響するかのデザインを、それらが使える可能性と同じ	ように理解する時間を取ること。SambaのSAM情報は、サイトからサイトに異なる	DIT内に格納すべきであり、おのおのの実装において新しい経験が得られる。	最初の実装で目が覚め、2番目の実装では心配事が出来、三世代目でやっとうまく	いくというのは、LDAPのベテランはよく理解していることである。	</p><div class="sect3" title="LDAPとSambaに対する注意"><div class="titlepage"><div><div><h4 class="title"><a name="id2600565"></a>LDAPとSambaに対する注意</h4></div></div></div><p><a class="indexterm" name="id2600573"></a><a class="indexterm" name="id2600580"></a><a class="indexterm" name="id2600587"></a><a class="indexterm" name="id2600594"></a><a class="indexterm" name="id2600601"></a><a class="indexterm" name="id2600609"></a><a class="indexterm" name="id2600616"></a>	SambaはUNIX POSIX識別情報を、SambaとWindowsネットワーク環境に特有の	情報を格納する場所と同様に必要とする。取り扱われなければならない、	最もよく使われる情報はユーザアカウント、グループアカウント、マシン	信頼アカウント、ドメイン間信頼アカウントとSamba内部で使う固有の中間	情報を含む。	</p><p><a class="indexterm" name="id2600637"></a><a class="indexterm" name="id2600644"></a><a class="indexterm" name="id2600651"></a>	この文書中の、展開ガイドラインは、他の本とインターネット上で公開されて	いるHOWTO文書と同じように、出来上がっているディレクトリデザインと実装に	適合するわけではない。存在するDITは、共通のソース中で提案された単純な	情報レイアウトに適合することが出来ないかもしれない。更に追加すると、	Samba用に使われるLDAPディレクトリを提供するのに使われる共通スクリプトと	ツールはあなたの要求に適合しないかもしれない。	</p><p><a class="indexterm" name="id2600671"></a>	これは一般的ではないが、存在するLDAP DITを持つサイトのために、サイト	固有のスクリプトとユーティリティ一式を作成する必要がある場合に、サイト	操作のスコープ内でSambaを供給することは可能である。DITを使ってユーザと	グループアカウントを配布する方法はこれをチャレンジングなことにさせる。	解決方法は、もちろん、価値があることであるが、それを行うための試行錯誤は	チャレンジングである。サイトの要求を理解する時間を取り、急いで提供する	ことは避けること。	</p><p><a class="indexterm" name="id2600704"></a><a class="indexterm" name="id2600711"></a>	上記から、サイトに適合しないスクリプトとツールをむやみやたらに使わないこと。	存在する基盤が、不適切なツールの不用意な使用によって被害を被らないことを	確実にするために、すべてのスクリプトを、それを実行する前に検査して検証すること。	</p></div></div><div class="sect2" title="LDAPディレクトリとWindowsのコンピュータアカウント"><div class="titlepage"><div><div><h3 class="title"><a name="id2600731"></a>LDAPディレクトリとWindowsのコンピュータアカウント</h3></div></div></div><p><a class="indexterm" name="id2600741"></a><a class="indexterm" name="id2600748"></a><a class="indexterm" name="id2600755"></a>	SambaはLDAPに対するターンキーソリューションを提供しない。Sambaとの統合の	前に、LDAPのデザインと設定を行う事は最も良いことである。LDAPの実用的な	知識はSambaの統合を容易にし、LDAPの知識がない場合には、いらいらした経験	しか得られない。		</p><p><a class="indexterm" name="id2600775"></a><a class="indexterm" name="id2600782"></a><a class="indexterm" name="id2600790"></a>	コンピュータ(マシン)アカウントは、この章で説明されている、若干の制約を	受けるLDAPディレクトリサブジェクト中の好みの位置に配置できる。		</p><p><a class="indexterm" name="id2600806"></a><a class="indexterm" name="id2600813"></a><a class="indexterm" name="id2600820"></a><a class="indexterm" name="id2600827"></a><a class="indexterm" name="id2600834"></a><a class="indexterm" name="id2600841"></a><a class="indexterm" name="id2600848"></a>	コンピュータ(マシン)アカウントのPOSIXとsambaSamAccountコンポーネントは、	両者ともSambaによって使われる。そのため、マシンアカウントは、Windows 	NT/200xが扱うのと同じ方法で、Samba内部で扱われる。ユーザアカウントと	マシンアカウントは、マシンアカウントが$文字で終わることを除いてお互い	を識別できず、信頼アカウントも同じである。		</p><p><a class="indexterm" name="id2600869"></a><a class="indexterm" name="id2600876"></a><a class="indexterm" name="id2600883"></a><a class="indexterm" name="id2600890"></a><a class="indexterm" name="id2600896"></a>	有効なUNIX uidに結びつくWindowsのユーザ、グループ、マシン、信頼およびその他の	アカウントの必要性は、遙か昔前のSambaの開発時に決められた。この決定が覆されたり	変更することは、Samba-3.x系列の間にはありそうもない。		</p><p><a class="indexterm" name="id2600916"></a><a class="indexterm" name="id2600923"></a><a class="indexterm" name="id2600929"></a>	Windows SIDからのUID解決はSambaが動作しているホストOSを参照しなければならない	メカニズムによって、Samba内で行われる。NSSは、それが動いているすべてのホスト	OSについて全部を知る必要があるということから、(Sambaのような)アプリケーション	を隠蔽する良いメカニズムである。		</p><p><a class="indexterm" name="id2600950"></a><a class="indexterm" name="id2600956"></a><a class="indexterm" name="id2600963"></a><a class="indexterm" name="id2600970"></a><a class="indexterm" name="id2600977"></a><a class="indexterm" name="id2600983"></a><a class="indexterm" name="id2600990"></a>	SambaはNSS制御(設定)ファイル中の<span class="quote">“<span class="quote">passwd</span>”</span>、<span class="quote">“<span class="quote">shadow</span>”</span>	と<span class="quote">“<span class="quote">group</span>”</span>機能経由でホストOSが提供するUIDを問い合わせる。これを	達成するための最適なツールはUNIX管理者の決定にゆだねられている。それはSamba	によっては強制されない。Sambaは1つの方法としてそのサポートライブラリとwinbindd	を提供する。これをLDAP経由で行う事は可能で、すべてのアカウントエンティティが	LDAPディレクトリ中にあることが可能なような適切なフックを提供する。		</p><p><a class="indexterm" name="id2601030"></a><a class="indexterm" name="id2601037"></a><a class="indexterm" name="id2601044"></a><a class="indexterm" name="id2601050"></a><a class="indexterm" name="id2601057"></a>	多くの人に対して、良い選択肢は、PADL nss_ldapライブラリを使うことである。	このユーティリティは、コンピュータアカウントがPOSIX/UNIXアカウントのUID	に解決できるように設定されねばならない。これは基本的にLDAPのデザインの問題	である。Sambaメーリングリストとドキュメントで提供される情報は役に立つ例だけ	を提供するようになっている。LDAPディレクトリのデザインは複雑な問題であり、	この文書の範囲外である。		</p></div></div><div class="sect1" title="アカウント管理ツール"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="acctmgmttools"></a>アカウント管理ツール</h2></div></div></div><p><a class="indexterm" name="id2601090"></a><a class="indexterm" name="id2601097"></a><a class="indexterm" name="id2601104"></a>Sambaはユーザとマシンアカウントを管理するための2つのツールを提供する:<code class="literal">smbpasswd</code>と<code class="literal">pdbedit</code>である。</p><p><a class="indexterm" name="id2601129"></a><a class="indexterm" name="id2601136"></a><a class="indexterm" name="id2601143"></a><code class="literal">pdbedit</code>はSambaユーザアカウント情報に加えてアカウントポリシーを管理するために使うことが出来る。ポリシー管理機能は、パスワードのエージングとログイン失敗の扱いの管理を行うドメインの既定値の設定を管理するために使われる。</p><p><a class="indexterm" name="id2601170"></a><a class="indexterm" name="id2601177"></a><a class="indexterm" name="id2601184"></a><a class="indexterm" name="id2601190"></a>何人かは、名前がSambaSAMAccount情報への格納メカニズムを参照しているために、参照が<code class="literal">smbpasswd</code>担っていることに困惑することがある。しかし、これはユーティリティツールの名前でもある。このツールは結局、<code class="literal">net</code>ツールセット(<a class="link" href="NetCommand.html" title="Chapter 13. リモートとローカル管理:Netコマンド">Netコマンド</a>を参照)という、新しく追加された新しい機能に取り替えられることになる。</p><div class="sect2" title="smbpasswdツール"><div class="titlepage"><div><div><h3 class="title"><a name="id2601226"></a><code class="literal">smbpasswd</code>ツール</h3></div></div></div><p><a class="indexterm" name="id2601238"></a><a class="indexterm" name="id2601245"></a><a class="indexterm" name="id2601251"></a><a class="indexterm" name="id2601258"></a><a class="indexterm" name="id2601265"></a>	<code class="literal">smbpasswd</code>は<code class="literal">passwd</code>と<code class="literal">yppasswd</code>	プログラムに似たユーティリティである。これはpassdbバックエンド中の2つの32バイト	パスワードフィールドを管理する。このユーティリティは実際のアカウントと、(<code class="filename">smb.conf</code>	ファイル中の <em class="parameter"><code>passdb backend</code></em>によって指定される)パスワード	格納方式とは独立して動作する。		</p><p><a class="indexterm" name="id2601315"></a><a class="indexterm" name="id2601322"></a>	<code class="literal">smbpasswd</code>は、ユーザのパスワードを変更する時に、ローカルのsmbd	に接続する時にクライアント-サーバモードで動作する。これは非常なメリットがある。		</p><p><a class="indexterm" name="id2601341"></a><a class="indexterm" name="id2601348"></a>	<code class="literal">smbpasswd</code>はWindows NT上のパスワードを変更する能力もある(これは	NTドメインのユーザのパスワードを変更する時に、NT PDCにその要求を送る時にのみ動作	する)。		</p><p>		<a class="indexterm" name="id2601368"></a>		<a class="indexterm" name="id2601375"></a>		<code class="literal">smbpasswd</code>は以下のように使うことが出来る:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ユーザまたはマシンアカウントの<span class="emphasis"><em>追加</em></span>。</p></li><li class="listitem"><p>ユーザまたはマシンアカウントの<span class="emphasis"><em>削除</em></span>。</p></li><li class="listitem"><p>ユーザまたはマシンアカウントの<span class="emphasis"><em>有効化</em></span>。</p></li><li class="listitem"><p>ユーザまたはマシンアカウントの<span class="emphasis"><em>無効化</em></span>。</p></li><li class="listitem"><p>ユーザパスワードの<span class="emphasis"><em>削除</em></span>。</p></li><li class="listitem"><p>ドメイン間信頼アカウントの<span class="emphasis"><em>管理</em></span>。</p></li></ul></div><p>		通常のユーザでsmbpasswdを実行するには、以下のように入力する:		</p><p></p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>smbpasswd</code></strong><code class="prompt">Old SMB password: </code><strong class="userinput"><code><em class="replaceable"><code>secret</code></em></code></strong></pre><p>		<em class="replaceable"><code>secret</code></em>には、古いパスワードを入力するか、もしも		古いパスワードがなければ単にリターンキーのみを入力する。</p><pre class="screen"><code class="prompt">New SMB Password: </code><strong class="userinput"><code><em class="replaceable"><code>new secret</code></em></code></strong><code class="prompt">Repeat New SMB Password: </code><strong class="userinput"><code><em class="replaceable"><code>new secret</code></em></code></strong></pre><p>		</p><p>		もしも古い値が、このユーザに対して格納されている現在の値と異なる場合か、		2つの新しい値が一致しない場合、パスワードは変更されない。		</p><p><a class="indexterm" name="id2601533"></a>		普通のユーザによって起動された場合、コマンドはそのユーザのみのSMBパスワード		のみ変更できる。		</p><p><a class="indexterm" name="id2601548"></a><a class="indexterm" name="id2601554"></a>		rootで実行される場合、<code class="literal">smbpasswd</code>はSMBパスワードを変更		したいユーザ名をオプションの引数として指定できる。rootで実行される場合、		<code class="literal">smbpasswd</code>は古いパスワードの値をチェックするための		プロンプトを出さないので、パスワードを忘れたユーザのパスワードを設定できる。		</p><p><a class="indexterm" name="id2601583"></a><a class="indexterm" name="id2601590"></a><a class="indexterm" name="id2601597"></a><a class="indexterm" name="id2601604"></a>		<code class="literal">smbpasswd</code>は、<code class="literal">passwd</code>や<code class="literal">yppasswd</code>		コマンドを使っているUNIXユーザに親しみやすい方法で動作するように設計されて		いる。管理用として設計されているが、このツールは基本的なユーザレベルの		パスワード変更機能を提供する。		</p><p><a class="indexterm" name="id2601641"></a>		<code class="literal">smbpasswd</code>,の使い方の詳細は、マニュアルページ(最終的な		参照)を参照すること。		</p></div><div class="sect2" title="pdbeditツール"><div class="titlepage"><div><div><h3 class="title"><a name="pdbeditthing"></a><code class="literal">pdbedit</code>ツール</h3></div></div></div><p>		<a class="indexterm" name="id2601676"></a>		<a class="indexterm" name="id2601682"></a>		<a class="indexterm" name="id2601689"></a>		<a class="indexterm" name="id2601696"></a>		<code class="literal">pdbedit</code>はrootでのみ使えるツールである。これは、		ドメイン全体でのアカウントポリシーの設定のようにpassdbバックエンド		を管理するのに使われる。<code class="literal">pdbedit</code>は以下のように使える:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ユーザアカウントの追加、削除および変更。</p></li><li class="listitem"><p>ユーザアカウントの表示。</p></li><li class="listitem"><p>ユーザアカウントの移行(migrate)。</p></li><li class="listitem"><p>グループアカウントの移行。</p></li><li class="listitem"><p>アカウントポリシーの管理。</p></li><li class="listitem"><p>ドメインアクセスポリー設定の管理。</p></li></ul></div><p>		<a class="indexterm" name="id2601759"></a>		上場企業会計改革および投資家保護法(いわゆる米国SOX法)下で、アメリカの企業と		組織は一連の<code class="literal">内部統制</code>と伝達手段、記録、会計データの		保護を実施することが必要となった。米国SOX法はさらに以下の点についても影響		する:		</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>財務データを格納する情報システムにだれがアクセスするかということ。</p></li><li class="listitem"><p>どのように個人情報と会計情報が、従業員とビジネスパートナーとの間で扱われるかと言うこと。</p></li><li class="listitem"><p>どのようにセキュリティの欠陥を管理するかと言うこと。</p></li><li class="listitem"><p>すべての情報システムへのセキュリティとパッチレベル管理。</p></li><li class="listitem"><p>どのように情報システムの変更が文書化され、追跡できるようになるかと言うこと。</p></li><li class="listitem"><p>どのように情報アクセス制御が実装されて管理されているかと言うこと。</p></li><li class="listitem"><p>変更点とセキュリティに関するすべての情報システムの監査機能。</p></li><li class="listitem"><p>プライバシーを確実にするための規律手順と制御。</p></li></ol></div><p>		<a class="indexterm" name="id2601838"></a>		<a class="indexterm" name="id2601845"></a>		手短に言うと、米国SOX法は、ビジネス関連の情報システムに関して責任を		強める道具である。特に会計データ処理と個人情報の記録に使われるすべての		情報システムのコンプライアンスを強化する。同様な責任は世界中で要求され		ている。		</p><p>		<a class="indexterm" name="id2601865"></a>		<a class="indexterm" name="id2601872"></a>		<a class="indexterm" name="id2601879"></a>		<a class="indexterm" name="id2601886"></a>		<a class="indexterm" name="id2601893"></a>		政府の法律に従って情報システム操作を許可するSambaのツールと機能に		精通している必要性は明らかである。<code class="literal">pdbedit</code>は		アカウントとシステムアクセス制御とポリシーを管理する能力を提供する		唯一のSambaツールである。Samba-3シリーズの残存ライフサイクル中、		この重要な領域で新しいツールが実装されることはあり得る。		</p><p>		Sambaと比較した場合のWindows NT4で有効なドメイングローバルポリシー		制御は<a class="link" href="passdb.html#policycontrols" title="Table 11.1. NT4ドメイン対Sambaポリシー制御">NT4 ドメイン対 Sambaポリシー制御</a>		中にある。		</p><div class="table"><a name="policycontrols"></a><p class="title"><b>Table 11.1. NT4ドメイン対Sambaポリシー制御</b></p><div class="table-contents"><table summary="NT4ドメイン対Sambaポリシー制御" border="1"><colgroup><col align="left"><col align="left"><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="left"><p>NT4ポリシー名</p></th><th align="left"><p>Sambaポリシー名</p></th><th align="center"><p>NT4 レンジ</p></th><th align="center"><p>Samba レンジ</p></th><th align="center"><p>Samba 既定値</p></th></tr></thead><tbody><tr><td align="left"><p>Maximum Password Age(パスワード有効期間)</p></td><td align="left"><p>maximum password age</p></td><td align="center"><p>0 - 999 (日)</p></td><td align="center"><p>0 - 4294967295 (秒)</p></td><td align="center"><p>4294967295</p></td></tr><tr><td align="left"><p>Minimum Password Age(パスワード変更禁止期間)</p></td><td align="left"><p>minimum password age</p></td><td align="center"><p>0 - 999 (日)</p></td><td align="center"><p>0 - 4294967295 (秒)</p></td><td align="center"><p>0</p></td></tr><tr><td align="left"><p>Mimimum Password Length(最小パスワード長)</p></td><td align="left"><p>min password length</p></td><td align="center"><p>1 - 14 (文字)</p></td><td align="center"><p>0 - 4294967295 (文字)</p></td><td align="center"><p>5</p></td></tr><tr><td align="left"><p>Password Uniqueness(パスワード履歴)</p></td><td align="left"><p>password history</p></td><td align="center"><p>0 - 23 (#)</p></td><td align="center"><p>0 - 4294967295 (#)</p></td><td align="center"><p>0</p></td></tr><tr><td align="left"><p>Account Lockout - Reset count after(アカウントロックアウト期間)</p></td><td align="left"><p>reset count minutes</p></td><td align="center"><p>1 - 99998 (分)</p></td><td align="center"><p>0 - 4294967295 (分)</p></td><td align="center"><p>30</p></td></tr><tr><td align="left"><p>Lockout after bad logon attempts(ロックアウトの閾値)</p></td><td align="left"><p>bad lockout attempt</p></td><td align="center"><p>0 - 998 (#)</p></td><td align="center"><p>0 - 4294967295 (#)</p></td><td align="center"><p>0</p></td></tr><tr><td align="left"><p>*** Not Known ***</p></td><td align="left"><p>disconnect time</p></td><td align="center"><p>TBA</p></td><td align="center"><p>0 - 4294967295</p></td><td align="center"><p>0</p></td></tr><tr><td align="left"><p>Lockout Duration(ロックアウト閾値のリセット)</p></td><td align="left"><p>lockout duration</p></td><td align="center"><p>1 - 99998 (min)</p></td><td align="center"><p>0 - 4294967295 (min)</p></td><td align="center"><p>30</p></td></tr><tr><td align="left"><p>Users must log on in order to change password</p></td><td align="left"><p>user must logon to change password</p></td><td align="center"><p>0/1</p></td><td align="center"><p>0 - 4294967295</p></td><td align="center"><p>0</p></td></tr><tr><td align="left"><p>*** Registry Setting ***</p></td><td align="left"><p>refuse machine password change(マシンパスワード変更の禁止)</p></td><td align="center"><p>0/1</p></td><td align="center"><p>0 - 4294967295</p></td><td align="center"><p>0</p></td></tr></tbody></table></div></div><br class="table-break"><p>		<a class="indexterm" name="id2602298"></a><a class="indexterm" name="id2602305"></a><a class="indexterm" name="id2602312"></a><a class="indexterm" name="id2602319"></a>		<code class="literal">pdbedit</code>ツールはアカウントセキュリティとポリシー		設定を管理できる唯一のツールである。これは、smbpasswdが出来ること		と同様のことを含むスーパーセットである。		</p><p>		<a class="indexterm" name="id2602339"></a><a class="indexterm" name="id2602345"></a><a class="indexterm" name="id2602353"></a>		<code class="literal">pdbedit</code>の用途の中で特に重要なものの一つとして、		passdbバックエンドから他へのアカウント情報のインポート/エクスポート		機能がある。		</p><div class="sect3" title="ユーザアカウントマネージャ"><div class="titlepage"><div><div><h4 class="title"><a name="id2602370"></a>ユーザアカウントマネージャ</h4></div></div></div><p><a class="indexterm" name="id2602379"></a><a class="indexterm" name="id2602386"></a><a class="indexterm" name="id2602392"></a><a class="indexterm" name="id2602399"></a><a class="indexterm" name="id2602406"></a><a class="indexterm" name="id2602414"></a><a class="indexterm" name="id2602421"></a>		<code class="literal">pdbedit</code>ツールは<code class="literal">smbpasswd</code>ツールと		同様、UNIX/Linuxシステムアカウントデータベース(バックエンド)中にすでに		存在するPOSIXユーザアカウントを必要とする。システム管理者の責任と		考えられるので、ユーザアカウントを作成するためにOSを呼び出すことは		どちらのツールも行わない。NT4のドメインユーザマネージャがアカウント		を追加するために使われた時、Sambaは、ユーザ、グループ、マシンアカウント		が正しく作成され、変更されることを行うために、(他のインタフェース		スクリプトと同様)<code class="literal">add user script</code>を使う。		 <code class="literal">pdbedit</code>ツールを使用しても、それらのインタフェース		 スクリプトは使わない。		</p><p><a class="indexterm" name="id2602477"></a><a class="indexterm" name="id2602484"></a>		<code class="literal">pdbedit</code>を、ユーザとマシンアカウントを管理		するために使うことを試みる前に、システム(POSIX)アカウントが		すでに作成されているかを確かめておくこと。		</p><div class="sect4" title="ユーザとマシンアカウントの表示"><div class="titlepage"><div><div><h5 class="title"><a name="id2602501"></a>ユーザとマシンアカウントの表示</h5></div></div></div><p><a class="indexterm" name="id2602510"></a><a class="indexterm" name="id2602516"></a>		以下は、tdbsamパスワードバックエンド中に格納されているユーザアカウント		情報の例である。表示は以下のコマンドを実行することで行える:</p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>pdbedit -Lv met</code></strong>UNIX username:        metNT username:          metAccount Flags:        [U          ]User SID:             S-1-5-21-1449123459-1407424037-3116680435-2004Primary Group SID:    S-1-5-21-1449123459-1407424037-3116680435-1201Full Name:            Melissa E TerpstraHome Directory:       \\frodo\met\Win9ProfileHomeDir Drive:        H:Logon Script:         scripts\logon.batProfile Path:         \\frodo\Profiles\metDomain:               MIDEARTHAccount desc:Workstations:         melbelleMunged dial:Logon time:           0Logoff time:          Mon, 18 Jan 2038 20:14:07 GMTKickoff time:         Mon, 18 Jan 2038 20:14:07 GMTPassword last set:    Sat, 14 Dec 2002 14:37:03 GMTPassword can change:  Sat, 14 Dec 2002 14:37:03 GMTPassword must change: Mon, 18 Jan 2038 20:14:07 GMT</pre><p>		</p><p><a class="indexterm" name="id2602563"></a>		アカウントは古い<code class="literal">smbpasswd</code>形式でも表示出来る:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>pdbedit -Lw</code></strong>root:0:84B0D8E14D158FF8417EAF50CFAC29C3:     AF6DD3FD4E2EA8BDE1695A3F05EFBF52:[U          ]:LCT-42681AB8:jht:1000:6BBC4159020A52741486235A2333E4D2:     CC099521AD554A3C3CF2556274DBCFBC:[U          ]:LCT-40D75B5B:rcg:1002:E95D4331A6F23AF8AAD3B435B51404EE:     BB0F2C39B04CA6100F0E535DF8314B43:[U          ]:LCT-40D7C5A3:afw:1003:1AAFA7F9F6DC1DEAAAD3B435B51404EE:     CE92C2F9471594CDC4E7860CA6BC62DB:[T          ]:LCT-40DA501F:met:1004:A2848CB7E076B435AAD3B435B51404EE:     F25F5D3405085C555236B80B7B22C0D2:[U          ]:LCT-4244FAB8:aurora$:1005:060DE593EA638B8ACC4A19F14D2FF2BB:     060DE593EA638B8ACC4A19F14D2FF2BB:[W          ]:LCT-4173E5CC:temptation$:1006:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:     A96703C014E404E33D4049F706C45EE9:[W          ]:LCT-42BF0C57:vaioboss$:1001:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:     88A30A095160072784C88F811E89F98A:[W          ]:LCT-41C3878D:frodo$:1008:15891DC6B843ECA41249940C814E316B:     B68EADCCD18E17503D3DAD3E6B0B9A75:[W          ]:LCT-42B7979F:marvel$:1011:BF709959C3C94E0B3958B7B84A3BB6F3:     C610EFE9A385A3E8AA46ADFD576E6881:[W          ]:LCT-40F07A4</pre><p><a class="indexterm" name="id2602612"></a><a class="indexterm" name="id2602619"></a><a class="indexterm" name="id2602625"></a><a class="indexterm" name="id2602633"></a><a class="indexterm" name="id2602640"></a><a class="indexterm" name="id2602647"></a>		このコマンドが返すアカウント情報は、左から右に、以下の、コロンで		分離されたデータを含む:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ログインID。</p></li><li class="listitem"><p>UNIX UID。</p></li><li class="listitem"><p>Microsoft LanManagerパスワードハッシュ(パスワードは大文字に変換された後ハッシュされる)。</p></li><li class="listitem"><p>Microsoft NTパスワードハッシュ(大文字小文字の状態を保持したパスワードのハッシュ)。</p></li><li class="listitem"><p>Samba SAM アカウントフラグ。</p></li><li class="listitem"><p>LCTデータ(パスワード最終変更時刻)。</p></li></ul></div><p><a class="indexterm" name="id2602708"></a><a class="indexterm" name="id2602715"></a>		アカウントフラグパラメータは<code class="literal">pdbedit</code>マニュアルページに		説明があり、		<a class="link" href="passdb.html#TOSHARG-acctflags" title="アカウントフラグ管理">アカウントフラグ管理の節</a>		で簡単に説明されている。		</p><p><a class="indexterm" name="id2602744"></a>		LCTデータは8桁の16進値で、最後にパスワードが変更された時刻の、		1970年1月1日からの値を保持している。		</p></div><div class="sect4" title="ユーザアカウントの追加"><div class="titlepage"><div><div><h5 class="title"><a name="id2602758"></a>ユーザアカウントの追加</h5></div></div></div><p><a class="indexterm" name="id2602766"></a><a class="indexterm" name="id2602773"></a><a class="indexterm" name="id2602780"></a><a class="indexterm" name="id2602787"></a><a class="indexterm" name="id2602794"></a>		<code class="literal">pdbedit</code>は、スタンドアロンサーバまたはドメインに		ユーザアカウントを追加する時に使える。ここで紹介する例では、		 <code class="literal">vlaan</code>というユーザのアカウントが、SambaSAMAccount		を追加する前に作成されている。</p><pre class="screen"><code class="prompt">root# </code> pdbedit -a vlaannew password: secretpwretype new password: secretpwUnix username:        vlaanNT username:          vlaanAccount Flags:        [U          ]User SID:             S-1-5-21-726309263-4128913605-1168186429-3014Primary Group SID:    S-1-5-21-726309263-4128913605-1168186429-513Full Name:            Victor LaanHome Directory:       \\frodo\vlaanHomeDir Drive:        H:Logon Script:         scripts\logon.batProfile Path:         \\frodo\profiles\vlaanDomain:               MIDEARTHAccount desc:         Guest UserWorkstations:Munged dial:Logon time:           0Logoff time:          Mon, 18 Jan 2038 20:14:07 GMTKickoff time:         Mon, 18 Jan 2038 20:14:07 GMTPassword last set:    Wed, 29 Jun 2005 19:35:12 GMTPassword can change:  Wed, 29 Jun 2005 19:35:12 GMTPassword must change: Mon, 18 Jan 2038 20:14:07 GMTLast bad password   : 0Bad password count  : 0Logon hours         : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</pre><p>		</p></div><div class="sect4" title="アカウントの削除"><div class="titlepage"><div><div><h5 class="title"><a name="id2602846"></a>アカウントの削除</h5></div></div></div><p><a class="indexterm" name="id2602854"></a><a class="indexterm" name="id2602862"></a><a class="indexterm" name="id2602868"></a><a class="indexterm" name="id2602875"></a>		以下のコマンドを実行することで、SambaSAMAccountデータベースから		アカウントを削除できる。</p><pre class="screen"><code class="prompt">root# </code> pdbedit -x vlaan</pre><p>		アカウントは出力結果なしで削除される。アカウントはSambaSAMAccount		(passdb バックエンド)データベースからのみ削除され、UNIXアカウント		バックエンドからは削除されない。		</p><p><a class="indexterm" name="id2602910"></a><a class="indexterm" name="id2602917"></a>		アカウントを削除するためにNT4ドメインユーザマネージャを使うと、		<em class="parameter"><code>delete user script</code></em>を起動するが、それは		<code class="literal">pdbedit</code>ツールではない。		</p></div><div class="sect4" title="ユーザアカウントの変更"><div class="titlepage"><div><div><h5 class="title"><a name="id2602942"></a>ユーザアカウントの変更</h5></div></div></div><p><a class="indexterm" name="id2602951"></a>		<code class="literal">pdbedit</code>マニュアルページにこのツールで有効な		すべての操作の完全な詳細が記述されている。		</p><p><a class="indexterm" name="id2602968"></a>		下記は、ユーザアカウント情報の、フルネーム情報を変更する例である:</p><pre class="screen"><code class="prompt">root# </code> pdbedit -r --fullname="Victor Aluicious Laan" vlaan...Primary Group SID:    S-1-5-21-726309263-4128913605-1168186429-513Full Name:            Victor Aluicious LaanHome Directory:       \\frodo\vlaan...</pre><p>		</p><p><a class="indexterm" name="id2602997"></a><a class="indexterm" name="id2603004"></a><a class="indexterm" name="id2603011"></a>		ユーザのパスワードが満了して、ユーザがパスワードを変更できなくなった		を仮定してみよう。そのアカウントと本来のパスワードで作業が出来るように		するには、ユーザに追加の猶予時間が必要かもしれない。これは、どのように		パスワード満了の設定を更新できるかの例を示している。</p><pre class="screen"><code class="prompt">root# </code> pdbedit -Lv vlaan...Password last set:    Sun, 09 Sep 2001 22:21:40 GMTPassword can change:  Thu, 03 Jan 2002 15:08:35 GMTPassword must change: Thu, 03 Jan 2002 15:08:35 GMTLast bad password   : Thu, 03 Jan 2002 15:08:35 GMTBad password count  : 2...</pre><p><a class="indexterm" name="id2603044"></a><a class="indexterm" name="id2603051"></a>		ユーザは2回ログオンに失敗し、次でアカウントがロックされるが、		パスワードはすでに満了している。以下で、どのようにこのアカウントを		リセットするかを示す。</p><pre class="screen"><code class="prompt">root# </code> pdbedit -z vlaan...Password last set:    Sun, 09 Sep 2001 22:21:40 GMTPassword can change:  Thu, 03 Jan 2002 15:08:35 GMTPassword must change: Thu, 03 Jan 2002 15:08:35 GMTLast bad password   : 0Bad password count  : 0...</pre><p>		<code class="literal">Password must change:</code>パラメータは以下のようにして		リセットする:</p><pre class="screen"><code class="prompt">root# </code> pdbedit --pwd-must-change-time=1200000000 vlaan...Password last set:    Sun, 09 Sep 2001 22:21:40 GMTPassword can change:  Thu, 03 Jan 2002 15:08:35 GMTPassword must change: Thu, 10 Jan 2008 14:20:00 GMT...</pre><p>		別の方法として、このツールで日付を設定する方法もある:</p><pre class="screen"><code class="prompt">root# </code> pdbedit --pwd-must-change-time="2010-01-01" \              --time-format="%Y-%m-%d" vlaan...Password last set:    Sun, 09 Sep 2001 22:21:40 GMTPassword can change:  Thu, 03 Jan 2002 15:08:35 GMTPassword must change: Fri, 01 Jan 2010 00:00:00 GMT...</pre><p><a class="indexterm" name="id2603122"></a><a class="indexterm" name="id2603129"></a>		時刻の形式についての情報は、strptimeマニュアルページを参照のこと。		</p><p><a class="indexterm" name="id2603142"></a><a class="indexterm" name="id2603149"></a>		SambaSAMAccountの操作に関するさらなる情報はpdbeditのマニュアルページ		を参照のこと。		</p><div class="sect5" title="アカウントフラグ管理"><div class="titlepage"><div><div><h6 class="title"><a name="TOSHARG-acctflags"></a>アカウントフラグ管理</h6></div></div></div><p><a class="indexterm" name="id2603173"></a><a class="indexterm" name="id2603181"></a><a class="indexterm" name="id2603190"></a><a class="indexterm" name="id2603197"></a>		Samba SAMアカウントフラグはSambaソースコード中で、ACB		(account control block)と呼ばれている。Sambaソースコードの一部では、		これらはaccount encode_bitsやaccount control flagsとしても参照される。		</p><p><a class="indexterm" name="id2603216"></a><a class="indexterm" name="id2603223"></a><a class="indexterm" name="id2603230"></a><a class="indexterm" name="id2603237"></a><a class="indexterm" name="id2603244"></a>		手動での、ユーザ、マシン(ワークステーションまたはサーバ)、あるいは		ドメイン間信頼アカウントのアカウントフラグの調整は、通常Sambaを		使用している場合には必要ない。別の観点からすると、何らかの理由で		この情報が壊れた場合、壊れたデータの修正ができる可能性があると便利で		ある。そのような修正のためのツールの選択枝は<code class="literal">pdbedit</code>		ユーティリティである。		</p><p><a class="indexterm" name="id2603271"></a><a class="indexterm" name="id2603278"></a>		固有のSamba管理ツールを作成する開発者からアカウントフラグの情報に関する		いくつかの要求があった。アカウントフラグの適切な管理に関する必要な情報		例は、LDAPディレクトリを管理するためのスクリプトの開発時に明白である。		</p><p><a class="indexterm" name="id2603299"></a><a class="indexterm" name="id2603306"></a>		アカウントフラグフィールドは最大16文字である。現在11個が使われている。		<a class="link" href="passdb.html#accountflags" title="Table 11.2. Samba SAM Accountコントロールブロックフラグ">Samba SAM Accountコントロールブロックフラグ</a>		に一覧がある。<code class="literal">pdbedit</code>コマンドによって指定されたフラグの		順番に意味はない。実際、LDAPディレクトリ中のSambaAcctFlagsレコード中を		どのような順番にしても問題はない。		</p><div class="table"><a name="accountflags"></a><p class="title"><b>Table 11.2. Samba SAM Accountコントロールブロックフラグ</b></p><div class="table-contents"><table summary="Samba SAM Accountコントロールブロックフラグ" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">フラグ</th><th align="center">説明</th></tr></thead><tbody><tr><td align="center">D</td><td align="left">アカウントが無効。</td></tr><tr><td align="center">H</td><td align="left">ホームディレクトリが必要。</td></tr><tr><td align="center">I</td><td align="left">ドメイン間信頼アカウント。</td></tr><tr><td align="center">L</td><td align="left">アカウントが自動ロックされている。</td></tr><tr><td align="center">M</td><td align="left">MNS (Microsoft network service)ログオンアカウント。</td></tr><tr><td align="center">N</td><td align="left">パスワードが不要。</td></tr><tr><td align="center">S</td><td align="left">サーバ信頼アカウント。</td></tr><tr><td align="center">T</td><td align="left">一時的な重複アカウントエントリ。</td></tr><tr><td align="center">U</td><td align="left">通常のユーザアカウント。</td></tr><tr><td align="center">W</td><td align="left">ワークステーション信頼アカウント。</td></tr><tr><td align="center">X</td><td align="left">パスワードは満了していない。</td></tr></tbody></table></div></div><br class="table-break"><p><a class="indexterm" name="id2603545"></a><a class="indexterm" name="id2603552"></a>		アカウントコントロールフラグを設定するための<code class="literal">pdbedit</code>		使用例は以下の通り:</p><pre class="screen"><code class="prompt">root# </code> pdbedit -r -c "[DLX]" jhtUnix username:        jhtNT username:          jhtAccount Flags:        [DHULX      ]User SID:             S-1-5-21-729263-4123605-1186429-3000Primary Group SID:    S-1-5-21-729263-4123605-1186429-513Full Name:            John H Terpstra,Utah OfficeHome Directory:       \\aurora\jhtHomeDir Drive:        H:Logon Script:         scripts\logon.batProfile Path:         \\aurora\profiles\jhtDomain:               MIDEARTHAccount desc:         BluntObjectWorkstations:Logon time:           0Logoff time:          Mon, 18 Jan 2038 20:14:07 GMTKickoff time:         0Password last set:    Sun, 03 Jul 2005 23:19:18 GMTPassword can change:  Sun, 03 Jul 2005 23:19:18 GMTPassword must change: Mon, 18 Jan 2038 20:14:07 GMTLast bad password   : 0Bad password count  : 0Logon hours         : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</pre><p><a class="indexterm" name="id2603594"></a>	以下を実行することでフラグを既定値に設定できる:</p><pre class="screen"><code class="prompt">root# </code> pdbedit -r -c "[]" jhtUnix username:        jhtNT username:          jhtAccount Flags:        [U          ]User SID:             S-1-5-21-729263-4123605-1186429-3000Primary Group SID:    S-1-5-21-729263-4123605-1186429-513Full Name:            John H Terpstra,Utah OfficeHome Directory:       \\aurora\jhtHomeDir Drive:        H:Logon Script:         scripts\logon.batProfile Path:         \\aurora\profiles\jhtDomain:               MIDEARTHAccount desc:         BluntObjectWorkstations:Logon time:           0Logoff time:          Mon, 18 Jan 2038 20:14:07 GMTKickoff time:         0Password last set:    Sun, 03 Jul 2005 23:19:18 GMTPassword can change:  Sun, 03 Jul 2005 23:19:18 GMTPassword must change: Mon, 18 Jan 2038 20:14:07 GMTLast bad password   : 0Bad password count  : 0Logon hours         : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</pre><p>		</p></div></div><div class="sect4" title="ドメインアカウントポリシー管理"><div class="titlepage"><div><div><h5 class="title"><a name="id2603633"></a>ドメインアカウントポリシー管理</h5></div></div></div><p><a class="indexterm" name="id2603641"></a><a class="indexterm" name="id2603649"></a>		設定されているドメインアカウントアクセスポリシーを見るためには以下を実行する:</p><pre class="screen"><code class="prompt">root# </code> pdbedit -P ?No account policy by that nameAccount policy names are :min password lengthpassword historyuser must logon to change passwordmaximum password ageminimum password agelockout durationreset count minutesbad lockout attemptdisconnect timerefuse machine password change</pre><p>		</p><p>		ドメインに対する以下の制御を確立するとする:		</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>min password length = 8 characters.</p></li><li class="listitem"><p>password history = last 4 passwords.</p></li><li class="listitem"><p>maximum password age = 90 days.</p></li><li class="listitem"><p>minimum password age = 7 days.</p></li><li class="listitem"><p>bad lockout attempt = 8 bad logon attempts.</p></li><li class="listitem"><p>lockout duration = forever, account must be manually reenabled.</p></li></ol></div><p>		以下のコマンドでこれらの設定を実行する:</p><pre class="screen"><code class="prompt">root# </code> pdbedit -P "min password length" -C 8account policy value for min password length was 5account policy value for min password length is now 8<code class="prompt">root# </code> pdbedit -P "password history" -C 4account policy value for password history was 0account policy value for password history is now 4<code class="prompt">root# </code> pdbedit -P "maximum password age" -C 7776000account policy value for maximum password age was 4294967295account policy value for maximum password age is now 7776000<code class="prompt">root# </code> pdbedit -P "minimum password age" -C 7account policy value for minimum password age was 0account policy value for minimum password age is now 7<code class="prompt">root# </code> pdbedit -P "bad lockout attempt" -C 8account policy value for bad lockout attempt was 0account policy value for bad lockout attempt is now 8<code class="prompt">root# </code> pdbedit -P "lockout duration" -C -1account policy value for lockout duration was 30account policy value for lockout duration is now 4294967295</pre><p>		</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>最大(無限)なロックアウト時間を設定するためには値として-1を使用する。</p></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>アカウントポリシーはおのおののPDCとBDC上で個別にに設定する必要がある。この時点(Samba 3.0.11からSamba3.0.14a)で、アカウントポリシーは自動的に複製されない。これはSamba3.0.20がリリースされるか、それより少し後に修正される予定である。Samba-3リリースファイル中の、この機能に関する特定の更新情報がある WHATSNEW.txtファイルをチェックしてみること。</p></div></div></div><div class="sect3" title="アカウントのインポート/エクスポート"><div class="titlepage"><div><div><h4 class="title"><a name="id2603807"></a>アカウントのインポート/エクスポート</h4></div></div></div><p>		<a class="indexterm" name="id2603815"></a><a class="indexterm" name="id2603822"></a><a class="indexterm" name="id2603829"></a>		<code class="literal">pdbedit</code>ツールはあるバックエンドからほかのものに		認証情報(アカウント)データベースのインポート/エクスポートができる。		例えば、古い<code class="filename">smbpasswd</code>データベースから		<em class="parameter"><code>tdbsam</code></em>バックエンドにアカウントをインポート/		エクスポートするためには以下のように行う:		</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><a class="indexterm" name="id2603868"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>pdbedit -i smbpasswd -e tdbsam</code></strong></pre><p>			</p></li><li class="step" title="Step 2"><p><a class="indexterm" name="id2603897"></a>		<code class="filename">smb.conf</code>中の<em class="parameter"><code>passdb backend</code></em>の設定を		<em class="parameter"><code>smbpasswd</code></em>から<em class="parameter"><code>tdbsam</code></em>に		置き換える。			</p></li></ol></div></div></div></div><div class="sect1" title="パスワードバックエンド"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2603934"></a>パスワードバックエンド</h2></div></div></div><p><a class="indexterm" name="id2603942"></a><a class="indexterm" name="id2603950"></a>Sambaはバックエンドアカウントデータベースのデザインに柔軟性を提供する。この柔軟性は探せばすぐに見つかる。Sambaにおける最近の変更(Samba 3.0.23以降)はいくつかのインストール時にうまくいかなくなる問題を単純化するために複数バックエンド機能が削除された。この削除によりSamba-3の内部動作はより首尾一貫し安定した。</p><p><a class="indexterm" name="id2603970"></a><a class="indexterm" name="id2603977"></a>Samba 3.0.23から、もはや複数のpassdbバックエンドを指定して使うことは出来なくなった。それ以前のSamba-3では、同じタイプのバックエンドを含む複数のpassdbバックエンドが指定できた。複数のpassdbバックエンド機能は名前->SID変換とSID->名前解決で多くの問題を引き起こした。Sambaチームはいろいろと検討した結果この機能を取り除く必要があると決定した。</p><div class="sect2" title="平文"><div class="titlepage"><div><div><h3 class="title"><a name="id2603996"></a>平文</h3></div></div></div><p><a class="indexterm" name="id2604004"></a><a class="indexterm" name="id2604011"></a><a class="indexterm" name="id2604018"></a><a class="indexterm" name="id2604025"></a><a class="indexterm" name="id2604032"></a><a class="indexterm" name="id2604039"></a>		古いバージョンのSambaではUNIXユーザデータベースからユーザ情報を検索し、		結局いくつかの他のフィールドは<code class="filename">/etc/samba/smbpasswd</code>		か<code class="filename">/etc/smbpasswd</code>ファイルから得ていた。パスワードの		暗号化が無効になっている時、SMB固有のデータは全く格納されない。その代わり、		すべての操作はSambaホストOSがその<code class="filename">/etc/passwd</code>		データベースによってアクセスする方法経由で制御される。ほとんどのLinux		システムでは、たとえば、すべてのユーザとグループの解決はPAM経由で行われる。		</p></div><div class="sect2" title="smbpasswd: 暗号化したパスワードデータベース"><div class="titlepage"><div><div><h3 class="title"><a name="id2604082"></a>smbpasswd: 暗号化したパスワードデータベース</h3></div></div></div><p>		<a class="indexterm" name="id2604091"></a><a class="indexterm" name="id2604101"></a><a class="indexterm" name="id2604108"></a><a class="indexterm" name="id2604116"></a>		伝統的に<a class="link" href="smb.conf.5.html#ENCRYPTPASSWORDS" target="_top">encrypt passwords = yes</a>		とSambaの<code class="filename">smb.conf</code>ファイル中で設定した時、ユーザ名、LM/NTパスワード		ハッシュ、パスワード変更時間とアカウントフラグのようなユーザアカウント		情報は<code class="filename">smbpasswd(5)</code>ファイルに格納される。これは、		たくさんのユーザ(数千くらい)を抱えるサイトに対するアプローチとしては		不利である。		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2604161"></a>		最初の問題は、すべての検索をシーケンシャルに行わなければならないという		ことである。ドメインログオン時におおよそ二つの検索(1つは最初のログオン		検証で、もう1つはセッション接続セットアップで、それはネットワーク		ドライブやプリンタのマッピング)が行われ、これは、大きなサイトでは、		性能のボトルネックになる。この場合必要なことは、データベースを使う		ような、インデックスを使うアプローチである。		</p></li><li class="listitem"><p><a class="indexterm" name="id2604182"></a><a class="indexterm" name="id2604189"></a><a class="indexterm" name="id2604196"></a><a class="indexterm" name="id2604202"></a><a class="indexterm" name="id2604209"></a>		二番目の問題は、一つ以上のSambaサーバにsmbpasswdファイルを複製しよう		とする管理者は、たとえば、<code class="literal">rsync(1)</code>と		<code class="literal">ssh(1)</code>と、内製したカスタムスクリプトのような		外部ツールを使う必要があるということである。		</p></li><li class="listitem"><p><a class="indexterm" name="id2604239"></a><a class="indexterm" name="id2604246"></a><a class="indexterm" name="id2604253"></a><a class="indexterm" name="id2604260"></a><a class="indexterm" name="id2604267"></a>		最後に、smbpasswdエントリ中に格納されている情報の量には、たとえば		ホームディレクトリ、パスワード満了時刻や相対識別子(RID)のような		追加の属性を入れる領域がない。		</p></li></ul></div><p><a class="indexterm" name="id2604288"></a><a class="indexterm" name="id2604295"></a><a class="indexterm" name="id2604302"></a><a class="indexterm" name="id2604309"></a>		上記のような機能不足の点から、ユーザ属性を格納するより堅牢な手段を		smbdによって使うことが開発されてきた。ユーザアカウントにアクセス		することを定義するAPIは、共通的にsamdbインタフェースとして参照される		(以前には、これはpassdb APIとして呼ばれていて、現在もSambaソース		コード中ではそのように名前が付けられている)。		</p><p><a class="indexterm" name="id2604330"></a><a class="indexterm" name="id2604338"></a><a class="indexterm" name="id2604345"></a><a class="indexterm" name="id2604352"></a><a class="indexterm" name="id2604359"></a>		Sambaは、Samba平文データベースの機能不足点を克服する一連の拡張された		passdbバックエンドを提供している。これらはtdbsamとldapsamである。		もちろん、ldapsamは、大きな会社や巨大サイトが興味を持つものである。		</p></div><div class="sect2" title="tdbsam"><div class="titlepage"><div><div><h3 class="title"><a name="id2604378"></a>tdbsam</h3></div></div></div><p>		<a class="indexterm" name="id2604386"></a><a class="indexterm" name="id2604396"></a><a class="indexterm" name="id2604405"></a>		Sambaは<span class="quote">“<span class="quote">TDB</span>”</span>(trivial database)中にユーザとマシンアカウント		を格納できる。このバックエンドを使う時には追加の設定は不要である。		このバックエンドはLDAPを必要としない、新しくインストールする場合に		推奨される。		</p><p><a class="indexterm" name="id2604428"></a><a class="indexterm" name="id2604435"></a><a class="indexterm" name="id2604442"></a><a class="indexterm" name="id2604448"></a>		一般的なガイドとして、Sambaチームは250人あるいはそれ以上のユーザが		いるサイトに、tdbsamバックエンドを使うことを推奨していない。さらに		追加で、tdbsamは、アカウントデータベースを複製することが要求される		PDC/BDC実装を要求するサイト中で使うための拡張性の能力はない。		明確にいうと、拡張性という理由で、ldapsamを使用すべきである。		</p><p><a class="indexterm" name="id2604469"></a><a class="indexterm" name="id2604476"></a><a class="indexterm" name="id2604483"></a>		250ユーザ制限は、純粋に、一般的に、おそらく一つ以上の物理配置		にまたがってばらけている、ルーティングネットワークを持つサイトを必要		とするという概念に基づく目安でしかない。Sambaチームは現時点で、tdbsam		アーキテクチャのパフォーマンスベースの拡張性制限を把握していない。		</p><p><a class="indexterm" name="id2604504"></a><a class="indexterm" name="id2604511"></a><a class="indexterm" name="id2604519"></a><a class="indexterm" name="id2604525"></a>		数千のユーザを抱えているが、1台のサーバだけを必要とするサイトがある。		1つのサイトは最近UNIXシステム上で4500ユーザを保持していることを報告し、		<code class="literal">tdbsam</code>passdbバックエンドでよい性能が出たことを		報告した。<code class="literal">tdbsam</code>passdbバックエンドを使う場合の制限は、		TDB格納場所の制限に関連し、それはSambaSAMAccountバックエンドのための		分散メカニズムの必要性にのみ基づく。		</p></div><div class="sect2" title="ldapsam"><div class="titlepage"><div><div><h3 class="title"><a name="id2604563"></a>ldapsam</h3></div></div></div><p><a class="indexterm" name="id2604571"></a><a class="indexterm" name="id2604578"></a>		<a class="indexterm" name="id2604584"></a>		ldapsamが提供しないいくつかの弱点がある。この文書で参照されるLDAP		サポートは以下を含まない:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Windows 200x Active Directoryサーバからの			ユーザアカウント情報を検索する手段。</p></li><li class="listitem"><p>/etc/passwdを置き換える手段。</p></li></ul></div><p><a class="indexterm" name="id2604618"></a><a class="indexterm" name="id2604625"></a><a class="indexterm" name="id2604632"></a><a class="indexterm" name="id2604638"></a>		2番目の項目はLDAP NSSとPAMモジュールを使うことにより達成できる。LGPL		バージョンのそれらのライブラリは		<a class="ulink" href="http://www.padl.com/" target="_top">PADL Software</a>で作成されて		いる。これらのパッケージに着いてのより詳細な情報は、		<a class="ulink" href="http://safari.oreilly.com/?XmlId=1-56592-491-6" target="_top">		Gerald Carterによる<span class="emphasis"><em>LDAP, System Administration</em></span>		の第6章、NISを置き換える</a>を参照のこと。		</p><p><a class="indexterm" name="id2604674"></a><a class="indexterm" name="id2604682"></a><a class="indexterm" name="id2604688"></a>		このドキュメントでは、伝統的にsmbpasswd(5)ファイルに格納されている		Sambaユーザアカウント情報をLDAPディレクトリに格納するための使い方に		ついて説明している。読者はすでに基本的なLDAPの概念とすでにインストール		している動作中のディレクトリサーバを持っていることを仮定している。		LDAPのアーキテクチャとディレクトリについてのより詳細な情報は、以下の		サイトを参照してほしい:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://www.openldap.org/" target="_top">OpenLDAP</a></p></li><li class="listitem"><p><a class="ulink" href="http://www.sun.com/software/products/directory_srvr_ee/index.xml" target="_top">				Sun One Directory Server</a></p></li><li class="listitem"><p><a class="ulink" href="http://www.novell.com/products/edirectory/" target="_top">Novell eDirectory</a></p></li><li class="listitem"><p><a class="ulink" href="http://www-306.ibm.com/software/tivoli/products/directory-server/" target="_top">IBM				Tivoli Directory Server</a></p></li><li class="listitem"><p><a class="ulink" href="http://www.redhat.com/software/rha/directory/" target="_top">Red Hat Directory Server</a></p></li><li class="listitem"><p><a class="ulink" href="http://www.linuxsecurity.com/content/view/119229" target="_top">Fedora Directory				Server</a></p></li></ul></div><p>		有効に使える2つのSambaリソースは以下の通り:		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="indexterm" name="id2604773"></a>			The <a class="ulink" href="http://www.unav.es/cti/ldap-smb/ldap-smb-3-howto.html" target="_top">Samba-PDC-LDAP-HOWTO</a>			Ignacio Coupeauによって管理されている。			</p></li><li class="listitem"><p><a class="indexterm" name="id2604793"></a><a class="indexterm" name="id2604800"></a><a class="indexterm" name="id2604808"></a>		<a class="ulink" href="http://samba.idealx.org/" target="_top">IDEALX</a>からのNTマイグレーション		スクリプトは、Samba-LDAPドメインコントローラ構成でユーザとグループの		管理に関連づけるものである。Idealxはsmbldap-toolsと対話的な		コンソール管理ツールも作成している。			</p></li></ul></div><div class="sect3" title="サポートしているLDAPサーバ"><div class="titlepage"><div><div><h4 class="title"><a name="id2604828"></a>サポートしているLDAPサーバ</h4></div></div></div><p><a class="indexterm" name="id2604836"></a><a class="indexterm" name="id2604843"></a><a class="indexterm" name="id2604850"></a><a class="indexterm" name="id2604857"></a>		LDAPのldapsamコードはOpenLDAP 2.xサーバとクライアントライブラリを		使って開発とテストが行われている。同じコードはNetscape's Directory Server		とクライアントSDKでも動作する。しかし、それらはコンパイルエラーとバグが		必ず生じる。それらを直すのはとても難しい。		<a class="link" href="bugreport.html" title="Chapter 40. バグの報告">バグ報告</a>中で概要が説明されている手順		経由で修正を投稿してほしい。			</p><p>			Sambaは任意の標準準拠のLDAPサーバとともに動作できる。			</p></div><div class="sect3" title="RFC 2307 posixAccountとの関係とスキーマ"><div class="titlepage"><div><div><h4 class="title"><a name="id2604891"></a>RFC 2307 posixAccountとの関係とスキーマ</h4></div></div></div><p>			Samba-3.0はソースコードディストリビューション中の			<code class="filename">examples/LDAP/samba.schema</code>中にある			OpenLDAP 2.x用に必要なスキーマファイルを用意している。			sambaSamAccountオブジェクトクラスのスキーマエントリは以下の通り:</p><pre class="programlisting">ObjectClass (1.3.6.1.4.1.7165.2.2.6 NAME 'sambaSamAccount' SUP top AUXILIARY    DESC 'Samba-3.0 Auxiliary SAM Account'    MUST ( uid $ sambaSID )    MAY  ( cn $ sambaLMPassword $ sambaNTPassword $ sambaPwdLastSet $          sambaLogonTime $ sambaLogoffTime $ sambaKickoffTime $          sambaPwdCanChange $ sambaPwdMustChange $ sambaAcctFlags $          displayName $ sambaHomePath $ sambaHomeDrive $ sambaLogonScript $          sambaProfilePath $ description $ sambaUserWorkstations $          sambaPrimaryGroupSID $ sambaDomainName ))</pre><p>			</p><p><a class="indexterm" name="id2604930"></a><a class="indexterm" name="id2604937"></a><a class="indexterm" name="id2604944"></a>			<code class="filename">samba.schema</code>ファイルはOpenLDAP 2.0/2.1			用の形式である。Sambaチームは上記のスキーマが使うOID空間を			所有し、この利用を推奨している。もしもNetscape DSが使うように			スキーマを変換したならば、			<a class="ulink" href="mailto:jerry@samba.org" target="_top">jerry@samba.org</a>			にパッチとしてスキーマファイルを送ってほしい。			</p><p><a class="indexterm" name="id2604973"></a><a class="indexterm" name="id2604980"></a><a class="indexterm" name="id2604986"></a><a class="indexterm" name="id2604993"></a><a class="indexterm" name="id2605000"></a><a class="indexterm" name="id2605007"></a><a class="indexterm" name="id2605014"></a>		smbpasswdファイルが、ユーザの<code class="filename">/etc/passwd</code>エントリ		に追加の情報を提供する情報を格納するように、sambaSamAccountアカウント		オブジェクトはUNIXユーザアカウント情報を補う。sambaSamAccountは		<code class="constant">補助型</code>オブジェクトクラスであるので、LDAP		ディレクトリ中の存在するユーザアカウント情報に付随するものとして		使うことが出来、Sambaアカウントの操作のために必要な情報を提供する。		しかし、RFC2307で定義されているposixAccountオブジェクトクラスと		重複するいくつかのフィールド(たとえばuid)がある。これは意図的なものである。			</p><p><a class="indexterm" name="id2605053"></a><a class="indexterm" name="id2605060"></a><a class="indexterm" name="id2605067"></a><a class="indexterm" name="id2605074"></a><a class="indexterm" name="id2605081"></a><a class="indexterm" name="id2605088"></a><a class="indexterm" name="id2605095"></a><a class="indexterm" name="id2605102"></a><a class="indexterm" name="id2605108"></a>		すべてのユーザアカウント情報(UNIXとSamba)をディレクトリ中に格納する		ために、sambaSamAccountとposixAccountオブジェクトクラスを組み合わせて		使う必要がある。しかし、<code class="literal">smbd</code>はそれでもgetpwnam()		のような標準Cライブラリコール経由でユーザのUNIXアカウント情報を、		得ることがある。これは、SambaサーバはLDAP NSSライブラリのインストールと		正しく動くための設定も必要とすることを意味する。このように情報を区分することで、		すべてのSambaアカウント情報をLDAP中に格納することが出来るようにするが、		ネットワークが完全なLDAP基盤に移行しながら、UNIX のアカウント情報は		NISで管理することができる。			</p></div><div class="sect3" title="OpenLDAPの設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2605151"></a>OpenLDAPの設定</h4></div></div></div><p><a class="indexterm" name="id2605159"></a><a class="indexterm" name="id2605166"></a><a class="indexterm" name="id2605172"></a><a class="indexterm" name="id2605179"></a>		OpenLDAPディレクトリサーバ中でsambaSamAccountのサポートを行うためには、		最初にsamba.schemaファイルをslapdの設定ディレクトリにコピーする。		samba.schemaファイルはSambaソースディストリビューション中の		<code class="filename">examples/LDAP</code>ディレクトリ中にある。</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>cp samba.schema /etc/openldap/schema/</code></strong></pre><p>		</p><p><a class="indexterm" name="id2605222"></a><a class="indexterm" name="id2605229"></a><a class="indexterm" name="id2605236"></a><a class="indexterm" name="id2605242"></a><a class="indexterm" name="id2605249"></a><a class="indexterm" name="id2605256"></a><a class="indexterm" name="id2605263"></a><a class="indexterm" name="id2605270"></a>		次に、<code class="filename">slapd.conf</code>中に<code class="filename">samba.schema</code>		ファイルを含める。sambaSamAccountオブジェクトは他のスキーマファイルに		依存する2つの属性を含んでいる。<em class="parameter"><code>uid</code></em>属性は		<code class="filename">cosine.schema</code>中で定義され、		<em class="parameter"><code>displayName</code></em>属性は		<code class="filename">inetorgperson.schema</code>中で定義されている。両方は		<code class="filename">samba.schema</code>ファイルの前で定義しておかなければならない。</p><pre class="programlisting">## /etc/openldap/slapd.conf## スキーマファイル(core.schemaは既定値で必要とされる)include	           /etc/openldap/schema/core.schema## sambaSamAccountに必要なものinclude            /etc/openldap/schema/cosine.schemainclude            /etc/openldap/schema/inetorgperson.schemainclude            /etc/openldap/schema/nis.schemainclude            /etc/openldap/schema/samba.schema....</pre><p>		</p><p><a class="indexterm" name="id2605346"></a><a class="indexterm" name="id2605353"></a><a class="indexterm" name="id2605360"></a><a class="indexterm" name="id2605367"></a>		以下の例のように、sambaSamAccountオブジェクトクラス上での検索のスピード		を上げるため、最もよく使う属性のいくつかにインデックスを付加することは		推奨される(そして、可能ならばそれはposixAccountとposixGroupも)。		</p><p></p><pre class="programlisting"># インデックスの管理## OpenLDAPで要求されるものindex objectclass             eqindex cn                      pres,sub,eqindex sn                      pres,sub,eq## pdb_getsampwnamをサポートするのに必要なものindex uid                     pres,sub,eq## pdb_getsambapwrid()をサポートするのに必要なものindex displayName             pres,sub,eq## uncomment these if you are storing posixAccount and## posixGroup entries in the directory as well##index uidNumber               eq##index gidNumber               eq##index memberUid               eqindex   sambaSID              eqindex   sambaPrimaryGroupSID  eqindex   sambaDomainName       eqindex   default               sub</pre><p></p><p>		以下を実行し新しいインデックスを作成する:</p><pre class="screen"><code class="prompt">root# </code>./sbin/slapindex -f slapd.conf</pre><p>		</p><p>		上記の変更後、slapdを再起動するのを忘れないこと:</p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>/etc/init.d/slapd restart</code></strong></pre><p>		</p></div><div class="sect3" title="LDAPデータベースの初期化"><div class="titlepage"><div><div><h4 class="title"><a name="id2605459"></a>LDAPデータベースの初期化</h4></div></div></div><p><a class="indexterm" name="id2605468"></a><a class="indexterm" name="id2605475"></a><a class="indexterm" name="id2605482"></a><a class="indexterm" name="id2605489"></a>		LDAPデータベースにアカウントが追加できる前に、格納するためのアカウント		コンテナを作成する必要がある。以下のLDIFファイルは必要に応じて変更		する必要がある(DNSエントリなど):</p><pre class="programlisting"># Organization for Samba Basedn: dc=quenya,dc=orgobjectclass: dcObjectobjectclass: organizationdc: quenyao: Quenya Org Networkdescription: The Samba-3 Network LDAP Example# Organizational Role for Directory Managementdn: cn=Manager,dc=quenya,dc=orgobjectclass: organizationalRolecn: Managerdescription: Directory Manager# Setting up container for Users OUdn: ou=People,dc=quenya,dc=orgobjectclass: topobjectclass: organizationalUnitou: People# Setting up admin handle for People OUdn: cn=admin,ou=People,dc=quenya,dc=orgcn: adminobjectclass: topobjectclass: organizationalRoleobjectclass: simpleSecurityObjectuserPassword: {SSHA}c3ZM9tBaBo9autm1dL3waDS21+JSfQVz# Setting up container for groupsdn: ou=Groups,dc=quenya,dc=orgobjectclass: topobjectclass: organizationalUnitou: Groups# Setting up admin handle for Groups OUdn: cn=admin,ou=Groups,dc=quenya,dc=orgcn: adminobjectclass: topobjectclass: organizationalRoleobjectclass: simpleSecurityObjectuserPassword: {SSHA}c3ZM9tBaBo9autm1dL3waDS21+JSfQVz# Setting up container for computersdn: ou=Computers,dc=quenya,dc=orgobjectclass: topobjectclass: organizationalUnitou: Computers# Setting up admin handle for Computers OUdn: cn=admin,ou=Computers,dc=quenya,dc=orgcn: adminobjectclass: topobjectclass: organizationalRoleobjectclass: simpleSecurityObjectuserPassword: {SSHA}c3ZM9tBaBo9autm1dL3waDS21+JSfQVz</pre><p>		</p><p><a class="indexterm" name="id2605536"></a><a class="indexterm" name="id2605543"></a>		上記で示されているuserPasswordは<code class="literal">slappasswd</code>を使って		生成する必要がある。		</p><p><a class="indexterm" name="id2605562"></a><a class="indexterm" name="id2605568"></a>		以下のコマンドでLDAPデータベース中にLDIFの内容をロードする。<a class="indexterm" name="id2605578"></a></p><pre class="screen"><code class="prompt">$ </code><strong class="userinput"><code>slapadd -v -l initldap.dif</code></strong></pre><p>		</p><p>		adminパスワードと同様に、アクセス制御リストを十分に使ってLDAPサーバの		安全性を確保することを忘れないこと。		</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a class="indexterm" name="id2605614"></a>		SambaがLDAPサーバにアクセスできる前に、Samba-3の		<code class="filename">secrets.tdb</code>データベース中にLDAP adminパスワード		を以下のようにして格納する必要がある:<a class="indexterm" name="id2605631"></a></p><pre class="screen"><code class="prompt">root# </code><strong class="userinput"><code>smbpasswd -w <em class="replaceable"><code>secret</code></em></code></strong></pre><p>		</p></div></div><div class="sect3" title="Sambaの設定"><div class="titlepage"><div><div><h4 class="title"><a name="id2605659"></a>Sambaの設定</h4></div></div></div><p><a class="indexterm" name="id2605667"></a><a class="indexterm" name="id2605674"></a>		以下の<code class="filename">smb.conf</code>中のパラメータは、SambaがLDAPサポートを出来るように		構築された場合にのみ有効である。Sambaは、LDAPライブラリを見つけると、		自動的にLDAPをサポートするように構築する。LDAPをサポートしているか		否かを調べる最も良い方法は以下の通り:</p><pre class="screen"><code class="prompt">root# </code> smbd -b | grep LDAP   HAVE_LDAP_H   HAVE_LDAP   HAVE_LDAP_DOMAIN2HOSTLIST   HAVE_LDAP_INIT   HAVE_LDAP_INITIALIZE   HAVE_LDAP_SET_REBIND_PROC   HAVE_LIBLDAP   LDAP_SET_REBIND_PROC_ARGS</pre><p>		もしも使用した<code class="literal">smbd</code>コマンドが<code class="literal">HAVE_LDAP_H</code>		を出力しない場合、なぜLDAPヘッダとライブラリがコンパイル中に見つから		なかったかということを調べる必要がある。			</p><p>LDAP関連のsmb.confオプションは以下の通り:			</p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="indexterm" name="id2605742"></a><em class="parameter"><code>passdb backend = ldapsam:url</code></em></td></tr><tr><td><a class="indexterm" name="id2605754"></a></td></tr><tr><td><a class="indexterm" name="id2605761"></a></td></tr><tr><td><a class="indexterm" name="id2605768"></a></td></tr><tr><td><a class="indexterm" name="id2605775"></a></td></tr><tr><td><a class="indexterm" name="id2605782"></a></td></tr><tr><td><a class="indexterm" name="id2605789"></a></td></tr><tr><td><a class="indexterm" name="id2605796"></a></td></tr><tr><td><a class="indexterm" name="id2605802"></a></td></tr><tr><td><a class="indexterm" name="id2605809"></a></td></tr><tr><td><a class="indexterm" name="id2605816"></a></td></tr><tr><td><a class="indexterm" name="id2605823"></a></td></tr><tr><td><a class="indexterm" name="id2605830"></a></td></tr><tr><td><a class="indexterm" name="id2605837"></a></td></tr></table><p>			</p><p>		これらは<code class="filename">smb.conf</code>マニュアルページに説明があり、ここでは繰り返さない。		しかし、LDAPディレクトリを使うための例は		<a class="link" href="passdb.html#confldapex" title="Example 11.2. LDAP使用の設定例">LDAP使用の設定例</a>にある。			</p><div class="example"><a name="confldapex"></a><p class="title"><b>Example 11.2. LDAP使用の設定例</b></p><div class="example-contents"><table border="0" summary="Simple list" class="simplelist"><tr><td> </td></tr><tr><td><em class="parameter"><code>[global]</code></em></td></tr><tr><td><a class="indexterm" name="id2605890"></a><em class="parameter"><code>security = user</code></em></td></tr><tr><td><a class="indexterm" name="id2605902"></a><em class="parameter"><code>encrypt passwords = yes</code></em></td></tr><tr><td><a class="indexterm" name="id2605914"></a><em class="parameter"><code>netbios name = MORIA</code></em></td></tr><tr><td><a class="indexterm" name="id2605926"></a><em class="parameter"><code>workgroup = NOLDOR</code></em></td></tr><tr><td># LDAP関連のパラメータ:</td></tr><tr><td># LDAPサーバにバインドする時に使うDNの定義。</td></tr><tr><td># smb.conf中にはこのDNのパスワードは格納されない。</td></tr><tr><td># これは'smbpasswd -w secret'を使って</td></tr><tr><td># secrets.tdbファイル中にパスフレーズを格納する。</td></tr><tr><td># "ldap admin dn"を変更する場合、再設定する必要がある。</td></tr><tr><td><a class="indexterm" name="id2605969"></a><em class="parameter"><code>ldap admin dn = "cn=Manager,dc=quenya,dc=org"</code></em></td></tr><tr><td># ディレクトリに接続ときのSSLオプションを設定する:</td></tr><tr><td># ('off', 'start tls', または 'on' (既定値))</td></tr><tr><td><a class="indexterm" name="id2605992"></a><em class="parameter"><code>ldap ssl = start tls</code></em></td></tr><tr><td># syntax: passdb backend = ldapsam:ldap://server-name[:port]</td></tr><tr><td><a class="indexterm" name="id2606008"></a><em class="parameter"><code>passdb backend = ldapsam:ldap://frodo.quenya.org</code></em></td></tr><tr><td># smbpasswd -x delete the entire dn-entry</td></tr><tr><td><a class="indexterm" name="id2606024"></a><em class="parameter"><code>ldap delete dn = no</code></em></td></tr><tr><td># マシンとユーザサフィックスはベースサフィックスに追加される</td></tr><tr><td># 引用符なしで記述すること。未定義状態が既定値である</td></tr><tr><td><a class="indexterm" name="id2606048"></a><em class="parameter"><code>ldap user suffix = ou=People</code></em></td></tr><tr><td><a class="indexterm" name="id2606060"></a><em class="parameter"><code>ldap group suffix = ou=Groups</code></em></td></tr><tr><td><a class="indexterm" name="id2606072"></a><em class="parameter"><code>ldap machine suffix = ou=Computers</code></em></td></tr><tr><td># LDAP中の信頼UNIXアカウント情報</td></tr><tr><td>#  (詳細はsmb.confマニュアルページを参照)</td></tr><tr><td># ディレクトリを検索する時に使うベースDNの指定</td></tr><tr><td><a class="indexterm" name="id2606100"></a><em class="parameter"><code>ldap suffix = dc=quenya,dc=org</code></em></td></tr></table></div></div><br class="example-break"></div><div class="sect3" title="アカウントとグループの管理"><div class="titlepage"><div><div><h4 class="title"><a name="id2606114"></a>アカウントとグループの管理</h4></div></div></div><p>			<a class="indexterm" name="id2606122"></a>			<a class="indexterm" name="id2606129"></a>			ユーザアカウントはsambaSamAccountオブジェクトクラスを通じて管理			されるため、使っている管理ツールをsambaSamAccount属性を扱えるよう			に修正する必要がある。			</p><p><a class="indexterm" name="id2606150"></a><a class="indexterm" name="id2606156"></a><a class="indexterm" name="id2606164"></a>			マシンアカウントはsambaSamAccountオブジェクトクラスを使って管理			されるため、ユーザアカウントと同じように扱われる。しかし、これらの			アカウントをLDAP名前空間の異なったツリーに格納することはそれも			可能である。グループを格納するために、			<span class="quote">“<span class="quote">ou=Groups,dc=quenya,dc=org</span>”</span>を使うべきであり、			ユーザのために<span class="quote">“<span class="quote">ou=People,dc=quenya,dc=org</span>”</span>を			使うべきである。NSSとPAMの設定をそれに合わせて設定すること			(通常は、<code class="filename">/etc/openldap/sldap.conf</code>設定			ファイル中で設定する)。			</p><p><a class="indexterm" name="id2606201"></a><a class="indexterm" name="id2606208"></a><a class="indexterm" name="id2606215"></a><a class="indexterm" name="id2606222"></a>			Samba-3では、グループ管理システムはPOSIXグループをベースにして			いる。これは、SambaはposixGroupオブジェクトクラスを使うという			ことを意味する。今の所、NT風のグループシステム管理はない(			グローバルとローカルグループという)。Samba-3は			<code class="constant">Domain Groups</code>のみを認識し、Microsoft			Windows 2000と Active Directoryとは異なり、Samba-3はネスト			されたグループをサポートしない。			</p></div><div class="sect3" title="セキュリティとsambaSamAccount"><div class="titlepage"><div><div><h4 class="title"><a name="id2606247"></a>セキュリティとsambaSamAccount</h4></div></div></div><p><a class="indexterm" name="id2606255"></a>			ディレクトリ中のsambaSAMAccountエントリについてのセキュリティに関する			議論の際に覚えておかなければならない2つの重要な観点がある。			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>絶対に</em></span>SambaLMPasswordか<a class="indexterm" name="id2606279"></a>				SambaNTPasswordの属性値を暗号化されていないLDAPセッション下で検索しない。</p></li><li class="listitem"><p><span class="emphasis"><em>絶対に</em></span>管理者以外のユーザに				SambaLMPasswordかSambaNTPasswordの属性値を閲覧させない。</p></li></ul></div><p><a class="indexterm" name="id2606302"></a><a class="indexterm" name="id2606309"></a><a class="indexterm" name="id2606316"></a>			これらのパスワードハッシュは平文と同等であり、オリジナルの平文			文字列を得ないでもユーザを詐称するために使える。LM/NTハッシュ			についてのより詳細な情報は、この章の			<a class="link" href="passdb.html" title="Chapter 11. アカウント情報データベース">アカウント情報データベース</a>			を参照のこと。			</p><p><a class="indexterm" name="id2606344"></a><a class="indexterm" name="id2606350"></a><a class="indexterm" name="id2606357"></a><a class="indexterm" name="id2606364"></a>			最初のセキュリティ問題に対応するため、<a class="link" href="smb.conf.5.html#LDAPSSL" target="_top">ldap ssl</a>			<code class="filename">smb.conf</code>パラメータは、ディレクトリサーバに接続する際に、			既定値のポート<code class="constant">636</code>を使う暗号化セッション			(<a class="link" href="smb.conf.5.html#LDAPSSL" target="_top">ldap ssl = on</a>)を既定値で			要求する。OpenLDAPサーバを使う場合、LDAPSを指定する場所で、			StartTLS LDAP拡張操作を使うことが可能である。この場合、安全な			通信プロトコルを使うことを強く推奨する(そのため、			<a class="link" href="smb.conf.5.html#LDAPSSL" target="_top">ldap ssl = off</a>を設定しては			ならない)。			</p><p><a class="indexterm" name="id2606432"></a><a class="indexterm" name="id2606438"></a><a class="indexterm" name="id2606445"></a>			LDAPSプロトコルはLDAPv3 StartTLS拡張オプションが優先されるので、非推奨			であることに注意。しかし、OpenLDAPライブラリは引き続きクライ			アントとサーバ間の古い安全な通信方法をサポートする。			</p><p><a class="indexterm" name="id2606464"></a><a class="indexterm" name="id2606471"></a><a class="indexterm" name="id2606478"></a>			次の安全対策は、管理者以外がディレクトリからパスワードハッシュを			得ることを防ぐことである。これは<code class="filename">slapd.conf</code>			中に以下のACLを設定することで行える:			</p><p></p><pre class="programlisting">## "ldap admin dn" アクセスは許可するがそれ以外は拒否access to attrs=SambaLMPassword,SambaNTPassword     by dn="cn=Samba Admin,ou=People,dc=quenya,dc=org" write     by * none</pre><p></p></div><div class="sect3" title="sambaSamAccountsのための特別なLDAP属性"><div class="titlepage"><div><div><h4 class="title"><a name="id2606515"></a>sambaSamAccountsのための特別なLDAP属性</h4></div></div></div><p>sambaSamAccountオブジェクトクラスは以下の表にあるような属性の集合である:			  <a class="link" href="passdb.html#attribobjclPartA" title="Table 11.3. Attributes in the sambaSamAccountのオブジェクトクラス(LDAP), Part A">Part A</a>と<a class="link" href="passdb.html#attribobjclPartB" title="Table 11.4. sambaSamAccountオブジェクトクラスの属性, Part B">Part B</a>。			</p><div class="table"><a name="attribobjclPartA"></a><p class="title"><b>Table 11.3. Attributes in the sambaSamAccountのオブジェクトクラス(LDAP), Part A</b></p><div class="table-contents"><table summary="Attributes in the sambaSamAccountのオブジェクトクラス(LDAP), Part A" border="1"><colgroup><col align="left"><col align="justify"></colgroup><tbody><tr><td align="left"><code class="constant">sambaLMPassword</code></td><td align="justify">16進文字列表現で格納されているLanManパスワードの16バイトハッシュ値。</td></tr><tr><td align="left"><code class="constant">sambaNTPassword</code></td><td align="justify">16進文字列表現で格納されているNTパスワードの16バイトハッシュ値。</td></tr><tr><td align="left"><code class="constant">sambaPwdLastSet</code></td><td align="justify"><code class="constant">sambaLMPassword</code>と<code class="constant">sambaNTPassword</code>が				       最後に設定された時刻の、1970年からの経過秒数(整数値)。</td></tr><tr><td align="left"><code class="constant">sambaAcctFlags</code></td><td align="justify">大カッコ[]で囲まれた11文字の文字列で、U(ユーザ)、W(ワークステーション)、				       X(パスワード満了なし)、I(ドメイン信頼アカウント)、H(ホームディレクトリが必要)、				       S(サーバ信頼アカウント)とD(無効)のようなアカウントフラグが格納。</td></tr><tr><td align="left"><code class="constant">sambaLogonTime</code></td><td align="justify">未使用(整数値)。</td></tr><tr><td align="left"><code class="constant">sambaLogoffTime</code></td><td align="justify">未使用(整数値)。</td></tr><tr><td align="left"><code class="constant">sambaKickoffTime</code></td><td align="justify">ユーザがロックされてログインできなくなる時刻(UNIX時刻形式)を指定。				       もしも属性が省略された場合、アカウントは決して満了しない。この				       属性をshadowAccountオブジェクトクラスのshadowExpire属性と一緒に				       使うことで正確な日時で完全にアカウントを満了できる。</td></tr><tr><td align="left"><code class="constant">sambaPwdCanChange</code></td><td align="justify">ユーザにパスワード変更が許可されている時刻(UNIX時刻形式)。				       もしもこの属性が設定されていない場合、ユーザは任意の時刻に				       パスワードを変更できる。</td></tr><tr><td align="left"><code class="constant">sambaPwdMustChange</code></td><td align="justify">パスワードを強制的に変更しなければならない時刻(UNIX時刻形式)。				    もしもこの値が0ならば、ユーザは最初のログイン時にパスワードを変更				    しなければならない。この属性が設定されていない場合、パスワードは				    決して満了しない。</td></tr><tr><td align="left"><code class="constant">sambaHomeDrive</code></td><td align="justify">sambaHomePathによって指定されるUNCパスにマップされるドライブ				    名を指定。ドライブ名はXがマップするドライブ名である、				    <span class="quote">“<span class="quote">X:</span>”</span>という形式で指定する必要がある。				    smb.conf(5)マニュアルページ中の<span class="quote">“<span class="quote">logon drive</span>”</span>				    パラメータにある詳細を参照のこと。</td></tr><tr><td align="left"><code class="constant">sambaLogonScript</code></td><td align="justify">sambaLogonScriptプロパティは、.CMD, .EXE, や .BATファイルの				    ようなユーザのログオンスクリプトのパスを指定する。文字列は空				    でもよい。パスはnetlogon共有からの相対パスである。詳細な情報は、				    <code class="filename">smb.conf</code>マニュアルページの<a class="link" href="smb.conf.5.html#LOGONSCRIPT" target="_top">logon script</a>				    パラメータを参照のこと。</td></tr><tr><td align="left"><code class="constant">sambaProfilePath</code></td><td align="justify">ユーザのプロファイルのパスを指定。この値は空、ローカル				    な絶対パス、あるいはUNCパスが使える。詳細な情報は、<code class="filename">smb.conf</code>				    マニュアルページの<a class="link" href="smb.conf.5.html#LOGONPATH" target="_top">logon path</a>パラメータ				    を参照のこと。</td></tr><tr><td align="left"><code class="constant">sambaHomePath</code></td><td align="justify">ユーザのホームディレクトリのパスを指定するsambaHomePath				    プロパティ。この値は空でも良い。もしもsambaHomeDriveが				    設定され、ドライブ名の場合、sambaHomePathはUNCパスである				    必要がある。パスは<code class="filename">\\server\share\directory</code>				    のようなネットワークUNCパスでなければならない。詳細な情報は、				    <code class="filename">smb.conf</code>マニュアルページの<code class="literal">logon home</code>				    パラメータを参照のこと。				</td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="attribobjclPartB"></a><p class="title"><b>Table 11.4. sambaSamAccountオブジェクトクラスの属性, Part B</b></p><div class="table-contents"><table summary="sambaSamAccountオブジェクトクラスの属性, Part B" border="1"><colgroup><col align="left"><col align="justify"></colgroup><tbody><tr><td align="left"><code class="constant">sambaUserWorkstations</code></td><td align="justify">ユーザのログイン可能な、カンマで分離されたマシンのリスト。				    Sambaドメインメンバに接続することを試みる時に問題が発生する				    かもしれない。なぜならば、ドメインメンバがこのリストになく、				    ドメインコントローラはそれを拒否するため。この属性が省略された				    場合、既定値は何の制限がないことを仮定する。				</td></tr><tr><td align="left"><code class="constant">sambaSID</code></td><td align="justify">ユーザのセキュリティ識別子(SID)。WindowsにおけるUNIX				    UID相当のもの。</td></tr><tr><td align="left"><code class="constant">sambaPrimaryGroupSID</code></td><td align="justify">ユーザのプライマリグループのセキュリティ識別子(SID)。</td></tr><tr><td align="left"><code class="constant">sambaDomainName</code></td><td align="justify">ユーザが属するドメイン。</td></tr></tbody></table></div></div><br class="table-break"><p><a class="indexterm" name="id2606940"></a><a class="indexterm" name="id2606946"></a>			これらのパラメータの大多数はSambaがドメイン			(どのようにSambaをPDCとして設定するかについての詳細がある			<a class="link" href="samba-pdc.html" title="Chapter 4. ドメイン制御">ドメイン制御</a>を参照)として振る舞う			時にのみ使われる。以下の4つの属性は、値が既定値でない場合にのみ			sambaSamAccountエントリに格納される。			</p><div class="itemizedlist"><a class="indexterm" name="id2606972"></a><a class="indexterm" name="id2606978"></a><a class="indexterm" name="id2606985"></a><a class="indexterm" name="id2606992"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p>sambaHomePath</p></li><li class="listitem"><p>sambaLogonScript</p></li><li class="listitem"><p>sambaProfilePath</p></li><li class="listitem"><p>sambaHomeDrive</p></li></ul></div><p><a class="indexterm" name="id2607021"></a><a class="indexterm" name="id2607028"></a><a class="indexterm" name="id2607035"></a>			これらの属性は、値が既定値でない場合にのみsambaSamAccountに			格納される。例えば、MORIAがPDCとして設定され、その<code class="filename">smb.conf</code>			ファイル中で<a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home = \\%L\%u</a>			が定義されているとする。<span class="quote">“<span class="quote">becky</span>”</span>という名前のユーザが			がドメインにログオンした時には<a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home</a>			文字列は\\MORIA\beckyに展開される。もしも、smbHome属性が			<span class="quote">“<span class="quote">uid=becky,ou=People,dc=samba,dc=org</span>”</span>エントリ中に			存在するならば、この値が使われる。しかし、もしもこの属性が存在			しない場合、<a class="link" href="smb.conf.5.html#LOGONHOME" target="_top">logon home</a>パラメータの値が			その場所に使われる。Sambaは、値が既定値以外の何かである場合			(例えば<code class="filename">\\MOBY\becky</code>)にのみ、属性値を			ディレクトリエントリに書き込む。			</p></div><div class="sect3" title="sambaSamAccountのLDIFエントリの例"><div class="titlepage"><div><div><h4 class="title"><a name="id2607117"></a>sambaSamAccountのLDIFエントリの例</h4></div></div></div><p>			以下は、SambaSamAccountオブジェクトクラスの、動作するLDIFの使用例である。</p><pre class="programlisting">dn: uid=guest2, ou=People,dc=quenya,dc=orgsambaLMPassword: 878D8014606CDA29677A44EFA1353FC7sambaPwdMustChange: 2147483647sambaPrimaryGroupSID: S-1-5-21-2447931902-1787058256-3961074038-513sambaNTPassword: 552902031BEDE9EFAAD3B435B51404EEsambaPwdLastSet: 1010179124sambaLogonTime: 0objectClass: sambaSamAccountuid: guest2sambaKickoffTime: 2147483647sambaAcctFlags: [UX         ]sambaLogoffTime: 2147483647sambaSID: S-1-5-21-2447931902-1787058256-3961074038-5006sambaPwdCanChange: 0</pre><p>			</p><p>			以下はsambaSamAccountとposixAccountオブジェクトクラスに対するLDIF			エントリである:</p><pre class="programlisting">dn: uid=gcarter, ou=People,dc=quenya,dc=orgsambaLogonTime: 0displayName: Gerald CartersambaLMPassword: 552902031BEDE9EFAAD3B435B51404EEsambaPrimaryGroupSID: S-1-5-21-2447931902-1787058256-3961074038-1201objectClass: posixAccountobjectClass: sambaSamAccountsambaAcctFlags: [UX         ]userPassword: {crypt}BpM2ej8Rkzogouid: gcarteruidNumber: 9000cn: Gerald CarterloginShell: /bin/bashlogoffTime: 2147483647gidNumber: 100sambaKickoffTime: 2147483647sambaPwdLastSet: 1010179230sambaSID: S-1-5-21-2447931902-1787058256-3961074038-5004homeDirectory: /home/moria/gcartersambaPwdCanChange: 0sambaPwdMustChange: 2147483647sambaNTPassword: 878D8014606CDA29677A44EFA1353FC7</pre><p>		</p></div><div class="sect3" title="パスワードの同期"><div class="titlepage"><div><div><h4 class="title"><a name="id2607170"></a>パスワードの同期</h4></div></div></div><p>		Samba-3以降のバージョンは、アカウントとして格納される非Samba(LDAP)パスワード		を更新できる。pam_ldapを使う場合、UNIXとWindowsパスワードを同時に変更できる。		</p><p>		<a class="link" href="smb.conf.5.html#LDAPPASSWDSYNC" target="_top">ldap passwd sync</a>オプションでは、		<a class="link" href="passdb.html#ldappwsync" title="Table 11.5. 設定可能なldap passwd syncの値">設定可能な<span class="emphasis"><em>ldap passwd sync</em></span>		  の値</a>にある値を使うことが出来る。</p><div class="table"><a name="ldappwsync"></a><p class="title"><b>Table 11.5. 設定可能な<em class="parameter"><code>ldap passwd sync</code></em>の値</b></p><div class="table-contents"><table summary="設定可能なldap passwd syncの値" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="left">値</th><th align="center">説明</th></tr></thead><tbody><tr><td align="left">yes</td><td align="justify"><p>ユーザがパスワード変更時に		      <code class="constant">SambaNTPassword</code>, <code class="constant">SambaLMPassword</code>		      と<code class="constant">password</code>フィールドを更新する。</p></td></tr><tr><td align="left">no</td><td align="justify"><p><code class="constant">SambaNTPassword</code>と					<code class="constant">SambaLMPassword</code>のみ更新する。</p></td></tr><tr><td align="left">only</td><td align="justify"><p>LDAPパスワードとLDAPサーバに他の		      フィールドについても更新を行う。このオプションはいくつかのLDAP		      サーバと、LDAPサーバがLDAP_EXOP_X_MODIFY_PASSWDをサポートする		      時のみ有効である。</p></td></tr></tbody></table></div></div><br class="table-break"><p>より詳細な情報は <code class="filename">smb.conf</code> マニュアルページにある。</p></div><div class="sect3" title="パスワード同期のためのOpenLDAPオーバレイの使用"><div class="titlepage"><div><div><h4 class="title"><a name="id2607332"></a>パスワード同期のためのOpenLDAPオーバレイの使用</h4></div></div></div><p>		Howard Chuは、<code class="literal">smbk5pwd</code>という特別なオーバレイを書いた。		このツールは、LDAP_EXOP_X_MODIFY_PASSWD操作が実行される時に、		OpenLDAPエントリ中の<code class="literal">SambaNTPassword</code>,		<code class="literal">SambaLMPassword</code>と<code class="literal">Heimdal</code>ハッシュを		変更する。		</p><p>		オーバレイはOpenLDAP-2.3に含まれ、		<code class="filename">contrib/slapd-modules/smbk5pwd</code>サブディレクトリ		にある。このモジュールはOpenLDAPでも使える。		</p></div></div></div><div class="sect1" title="よくあるエラー"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2607386"></a>よくあるエラー</h2></div></div></div><div class="sect2" title="ユーザがログオンできない"><div class="titlepage"><div><div><h3 class="title"><a name="id2607392"></a>ユーザがログオンできない</h3></div></div></div><p><span class="quote">“<span class="quote">Sambaをインストールしたが、UNIXアカウントを使ってログオンできない!</span>”</span></p><p>現在の<a class="link" href="smb.conf.5.html#PASSDBBACKEND" target="_top">passdb backend</a>にユーザが追加されて		  いるかを確認すること。詳細は		<a class="link" href="passdb.html#acctmgmttools" title="アカウント管理ツール">アカウント管理ツール</a>を読むこと。</p></div><div class="sect2" title="auth methodsの設定"><div class="titlepage"><div><div><h3 class="title"><a name="id2607432"></a><em class="parameter"><code>auth methods</code></em>の設定</h3></div></div></div><p>	明示的に<a class="link" href="smb.conf.5.html#AUTHMETHODS" target="_top">auth methods</a>パラメータを設定する場合、	<em class="parameter"><code>guest</code></em>はエントリの最初の行に指定しなければならない 	例えば、<a class="link" href="smb.conf.5.html#AUTHMETHODS" target="_top">auth methods = guest sam</a>である。	</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="NetworkBrowsing.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="groupmapping.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 10. ネットワークブラウジング </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 12. グループのマッピング: Microsoft Windows と UNIX</td></tr></table></div></body></html>