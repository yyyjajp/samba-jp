<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 2. NT&#12489;&#12513;&#12452;&#12531;&#12395;&#12362;&#12369;&#12427;RPC</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="SAMBA&#38283;&#30330;&#32773;&#12460;&#12452;&#12489;"><link rel="up" href="pt01.html" title="Part I. &#12503;&#12525;&#12488;&#12467;&#12523;"><link rel="prev" href="unix-smb.html" title="Chapter 1. UNIX&#38936;&#22495;&#12395;&#12362;&#12369;&#12427;NetBIOS"><link rel="next" href="pt02.html" title="Part II. Samba&#12398;&#22522;&#26412;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 2. NT&#12489;&#12513;&#12452;&#12531;&#12395;&#12362;&#12369;&#12427;RPC</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="unix-smb.html">Prev</a> </td><th width="60%" align="center">Part I. &#12503;&#12525;&#12488;&#12467;&#12523;</th><td width="20%" align="right"> <a accesskey="n" href="pt02.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 2. NT&#12489;&#12513;&#12452;&#12531;&#12395;&#12362;&#12369;&#12427;RPC"><div class="titlepage"><div><div><h2 class="title"><a name="ntdomain"></a>Chapter 2. NT&#12489;&#12513;&#12452;&#12531;&#12395;&#12362;&#12369;&#12427;RPC</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Luke</span> <span class="surname">Leighton</span></h3><div class="affiliation"><div class="address"><p><code class="email">&lt;<a class="email" href="mailto:lkcl@switchboard.net">lkcl@switchboard.net</a>&gt;</code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Paul</span> <span class="surname">Ashton</span></h3><div class="affiliation"><div class="address"><p><code class="email">&lt;<a class="email" href="mailto:paul@argo.demon.co.uk">paul@argo.demon.co.uk</a>&gt;</code></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Duncan</span> <span class="surname">Stansfield</span></h3><div class="affiliation"><div class="address"><p><code class="email">&lt;<a class="email" href="mailto:duncans@sco.com">duncans@sco.com</a>&gt;</code></p></div></div></div></div><div><p class="pubdate">01 November 97(version 0.0.24)</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="ntdomain.html#id2504987">&#27010;&#35201;</a></span></dt><dd><dl><dt><span class="sect2"><a href="ntdomain.html#id2505216">&#12477;&#12540;&#12473;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2505243">&#12463;&#12524;&#12472;&#12483;&#12488;</a></span></dt></dl></dd><dt><span class="sect1"><a href="ntdomain.html#id2505275">&#27880;&#24847;&#20107;&#38917;&#12392;&#27083;&#36896;</a></span></dt><dd><dl><dt><span class="sect2"><a href="ntdomain.html#id2505280">&#27880;&#24847;&#20107;&#38917;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2505380">&#21015;&#25369;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2505554">&#27083;&#36896;&#20307;</a></span></dt></dl></dd><dt><span class="sect1"><a href="ntdomain.html#id2558942">&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#19978;&#12391;&#12398;MSRPC</a></span></dt><dd><dl><dt><span class="sect2"><a href="ntdomain.html#id2558953">MSRPC &#12497;&#12452;&#12503;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2559082">&#12504;&#12483;&#12480;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2559766">Tail</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2559802">RPC Bind / Bind Ack</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2559945">NTLSA &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2560083">LSA&#12458;&#12540;&#12503;&#12531;&#12509;&#12522;&#12471;&#12540;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2560180">LSA Query Info &#12509;&#12522;&#12471;&#12540;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2560264">LSA &#12364;&#12456;&#12511;&#12517;&#12524;&#12540;&#12488;&#12377;&#12427;&#20449;&#38972;&#12377;&#12427;&#12489;&#12513;&#12452;&#12531;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2560335">LSA Open Secret</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2560418">LSA Close</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2560469">LSA Lookup SIDS</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2560630">LSA &#12523;&#12483;&#12463;&#12450;&#12483;&#12503;&#21517;</a></span></dt></dl></dd><dt><span class="sect1"><a href="ntdomain.html#id2560804">NETLOGON rpc &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;</a></span></dt><dd><dl><dt><span class="sect2"><a href="ntdomain.html#id2560948">LSA Request Challenge</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2561062">LSA Authenticate 2</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2561179">LSA Server Password Set</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2561274">LSA SAM Logon</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2561358">LSA SAM Logoff</a></span></dt></dl></dd><dt><span class="sect1"><a href="ntdomain.html#id2561432">\\MAILSLOT\NET\NTLOGON</a></span></dt><dd><dl><dt><span class="sect2"><a href="ntdomain.html#id2561447">PDC&#12398;&#12383;&#12417;&#12398;&#12463;&#12456;&#12522;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2561649">SAM Logon</a></span></dt></dl></dd><dt><span class="sect1"><a href="ntdomain.html#id2561900">SRVSVC &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;</a></span></dt><dd><dl><dt><span class="sect2"><a href="ntdomain.html#id2561936">Net Share Enum</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2562105">Net Server Get Info</a></span></dt></dl></dd><dt><span class="sect1"><a href="ntdomain.html#id2562195">NT&#12489;&#12513;&#12452;&#12531;&#35469;&#35388;&#12395;&#12362;&#12369;&#12427;&#26263;&#21495;&#21270;&#12398;&#20596;&#38754;</a></span></dt><dd><dl><dt><span class="sect2"><a href="ntdomain.html#id2562202">&#23450;&#32681;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2562328">&#12503;&#12525;&#12488;&#12467;&#12523;</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2562418">&#12467;&#12513;&#12531;&#12488;</a></span></dt></dl></dd><dt><span class="sect1"><a href="ntdomain.html#id2562489">SID&#12392;RID</a></span></dt><dd><dl><dt><span class="sect2"><a href="ntdomain.html#id2562527">&#12424;&#12367;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;SID</a></span></dt><dt><span class="sect2"><a href="ntdomain.html#id2562767">&#12424;&#12367;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;RID</a></span></dt></dl></dd></dl></div><div class="sect1" title="&#27010;&#35201;"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2504987"></a>&#27010;&#35201;</h2></div></div></div><p>
&#12371;&#12398;&#25991;&#26360;&#12395;&#12399;NT&#12469;&#12540;&#12496;&#12434;&#20351;&#12431;&#12394;&#12356;&#12391;NT&#12527;&#12540;&#12463;&#12473;&#12486;&#12540;&#12471;&#12519;&#12531;&#12398;&#12525;&#12464;&#12458;&#12531;&#12469;&#12540;&#12499;&#12473;&#12434;&#25552;&#20379;&#12377;&#12427;&#12383;&#12417;&#12398;
&#24773;&#22577;&#12364;&#35352;&#36848;&#12373;&#12428;&#12390;&#12356;&#12427;&#12290;&#12371;&#12428;&#12399;Luke&#12395;&#12424;&#12387;&#12390;&#31649;&#29702;&#12373;&#12428;&#12390;&#12356;&#12427;&#12289;
<a class="ulink" href="http://mailhost.cb1.com/~lkcl/cifsntdomain.txt" target="_top">http://mailhost.cb1.com/~lkcl/cifsntdomain.txt</a>
&#12398;sgml&#12496;&#12540;&#12472;&#12519;&#12531;&#12391;&#12354;&#12427;&#12290;
</p><p>
(NT&#12527;&#12540;&#12463;&#12473;&#12486;&#12540;&#12471;&#12519;&#12531;&#12398;TCP/IP&#35373;&#23450;&#20013;&#12391;)&#12527;&#12540;&#12463;&#12464;&#12523;&#12540;&#12503;&#12398;&#20195;&#12431;&#12426;&#12395;&#12489;&#12513;&#12452;&#12531;&#12434;&#36984;&#25246;&#12377;&#12427;&#12371;&#12392;&#12399;
&#21487;&#33021;&#12391;&#12354;&#12426;&#12289;&#24517;&#38920;&#12391;&#12354;&#12427;&#20877;&#36215;&#21205;&#24460;&#12395;&#12289;&#12518;&#12540;&#12470;&#21517;&#12392;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#20837;&#21147;&#12375;&#12289;&#12489;&#12513;&#12452;&#12531;&#12434;&#36984;&#25246;&#12377;&#12428;&#12400;
&#27491;&#12375;&#12367;&#12525;&#12464;&#12458;&#12531;&#12391;&#12365;&#12427;&#12290;&#12371;&#12398;&#25991;&#26360;&#12395;&#23550;&#12377;&#12427;&#12289;&#19978;&#35352;&#20316;&#26989;&#12398;&#32076;&#39443;&#12363;&#12425;&#12398;&#12289;&#20309;&#12425;&#12363;&#12398;&#12501;&#12451;&#12540;&#12489;&#12496;&#12483;&#12463;
&#12289;&#20309;&#12425;&#12363;&#12398;&#12467;&#12513;&#12531;&#12488;&#12289;&#20462;&#27491;&#12392;&#36861;&#21152;&#20107;&#38917;&#12399;&#27475;&#36814;&#12377;&#12427;&#12290;
</p><p>
&#12371;&#12371;&#12391;&#35500;&#26126;&#12377;&#12427;&#12497;&#12465;&#12483;&#12488;&#12399;Netmon.exe&#12395;&#12424;&#12387;&#12390;&#31777;&#21336;&#12395;(&#12381;&#12375;&#12390;&#12362;&#12381;&#12425;&#12367;&#12381;&#12428;&#12434;&#20351;&#12358;&#12371;&#12392;&#12391;&#12424;&#12426;
&#12424;&#12367;&#29702;&#35299;&#12391;&#12365;)&#24471;&#12425;&#12428;&#12427;&#12290;NETLOGON&#12289;lsarpc&#12392;srvsvc&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#12497;&#12452;&#12503;&#12434;&#27491;&#12375;&#12367;&#12487;&#12467;&#12540;&#12489;
&#12377;&#12427;&#12383;&#12417;&#12395;&#12289;&#20351;&#29992;&#12375;&#12390;&#12356;&#12427;&#12471;&#12473;&#12486;&#12512;&#12395;&#19968;&#33268;&#12377;&#12427;Netmon&#12398;&#12496;&#12540;&#12472;&#12519;&#12531;&#12434;&#20351;&#12358;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;
&#12371;&#12398;&#25991;&#26360;&#12399;&#12289;NT&#12469;&#12540;&#12499;&#12473;&#12497;&#12483;&#12463;1&#12398;&#12289;&#12381;&#12428;&#12395;&#36969;&#21512;&#12375;&#12383;&#12496;&#12540;&#12472;&#12519;&#12531;&#12398;Netmon&#12363;&#12425;&#24471;&#12425;&#12428;&#12390;&#12356;&#12427;&#12290;
&#12371;&#12428;&#12399;&#12289;&#12371;&#12398;&#25991;&#26360;&#12424;&#12426;&#12418;&#12424;&#12426;&#26377;&#30410;&#12391;&#12354;&#12429;&#12358;&#12289;&#27880;&#37320;&#20184;&#12365;&#12398;&#12497;&#12465;&#12483;&#12488;&#12488;&#12524;&#12540;&#12473;&#12364;&#29983;&#25104;&#12373;&#12428;&#12427;&#12371;&#12392;&#12434;
&#30446;&#30340;&#12392;&#12375;&#12390;&#12356;&#12427;&#12290;
</p><p>
&#12414;&#12383;&#12289;NT&#12489;&#12513;&#12452;&#12531;&#12525;&#12464;&#12458;&#12531;&#12469;&#12540;&#12499;&#12473;&#12434;&#23436;&#20840;&#12395;&#23455;&#35013;&#12377;&#12427;&#12383;&#12417;&#12289;NT&#12398;&#35469;&#35388;&#12398;&#26263;&#21495;&#21270;&#37096;&#20998;&#12434;
&#35500;&#26126;&#12377;&#12427;&#25991;&#26360;&#12418;&#24517;&#35201;&#12391;&#12354;&#12427;&#12290;&#12371;&#12398;&#25991;&#26360;&#12399; comp.protocols.smb&#12363;&#12425;&#20844;&#38283;&#12373;&#12428;&#12390;&#12356;&#12427;&#12289;
ntsecurity.net &#12398;&#12363;&#12425;&#12398;&#35201;&#32004;&#12392;samba digest&#12363;&#12425;&#12392;&#12381;&#12398;&#20182;&#12398;&#12477;&#12540;&#12473;&#12363;&#12425;&#12398;&#12418;&#12398;&#12434;&#20351;&#12387;&#12390;&#12356;&#12427;&#12290;
</p><p>
&#12467;&#12500;&#12540;&#12399;&#20197;&#19979;&#12395;&#12354;&#12427;:
</p><p><a class="ulink" href="http://ntbugtraq.rc.on.ca/SCRIPTS/WA.EXE?A2=ind9708;L=ntbugtraq;O=A;P=2935" target="_top">http://ntbugtraq.rc.on.ca/SCRIPTS/WA.EXE?A2=ind9708;L=ntbugtraq;O=A;P=2935</a></p><p><a class="ulink" href="http://mailhost.cb1.com/~lkcl/crypt.html" target="_top">http://mailhost.cb1.com/~lkcl/crypt.html</a></p><p>
<a class="ulink" href="mailto:linus@incolumitas.se" target="_top">Linus Nordberg</a>&#12395;&#12424;&#12427;&#12289;
&#12371;&#12398;&#12503;&#12525;&#12488;&#12467;&#12523;&#12395;&#38306;&#12377;&#12427;C&#35328;&#35486;&#12391;&#12398;&#23455;&#35013;&#12399;&#12289;&#20197;&#19979;&#12395;&#12354;&#12427;:
</p><p><a class="ulink" href="http://samba.org/cgi-bin/mfs/01/digest/1997/97aug/0391.html" target="_top">http://samba.org/cgi-bin/mfs/01/digest/1997/97aug/0391.html</a></p><p><a class="ulink" href="http://mailhost.cb1.com/~lkcl/crypt.txt" target="_top">http://mailhost.cb1.com/~lkcl/crypt.txt</a></p><p>
&#12487;&#12496;&#12483;&#12464;&#24773;&#22577;&#12398;&#25552;&#20379;&#12398;&#12383;&#12417;&#12395;&#12399;NT workstation&#12398;Check Build&#12496;&#12540;&#12472;&#12519;&#12531;&#12418;&#24517;&#35201;&#12391;&#12354;&#12426;&#12289;
NETLOGON&#20013;&#12391;&#23436;&#20840;&#12394;&#12487;&#12496;&#12483;&#12464;&#12434;&#26377;&#21177;&#12395;&#12377;&#12427;&#12290;&#12371;&#12428;&#12399;&#20197;&#19979;&#12398;&#12424;&#12358;&#12395;&#12375;&#12390;&#12289;REG_SZ
&#12524;&#12472;&#12473;&#12488;&#12522;&#12540;&#12461;&#12540;&#12434; 0x1ffffff &#12395;&#35373;&#23450;&#12377;&#12427;&#12371;&#12392;&#12391;&#34892;&#12360;&#12427;:
</p><p><code class="filename">HKLM\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters</code></p><p><span class="emphasis"><em>&#19981;&#27491;&#12395;&#12524;&#12472;&#12473;&#12488;&#12522;&#12434;&#32232;&#38598;&#12377;&#12427;&#12392;&#12289;&#20351;&#29992;&#12375;&#12390;&#12356;&#12427;&#12510;&#12471;&#12531;&#12434;&#21205;&#20316;&#19981;&#33021;&#12395;&#12373;&#12379;&#12427;
&#20107;&#12395;&#12394;&#12427;&#12290;&#12371;&#12398;&#12503;&#12525;&#12488;&#12467;&#12523;&#12398;&#19981;&#27491;&#12394;&#23455;&#35013;&#12395;&#12394;&#12427;&#12290;&#19978;&#35352;&#12398;"Liability:"&#12434;&#21442;&#29031;&#12398;&#12371;&#12392;&#12290;
</em></span></p><p>
&#12493;&#12483;&#12488;&#12527;&#12540;&#12463;&#19978;&#12398;&#21508;&#12497;&#12465;&#12483;&#12488;&#12399;API&#21628;&#12403;&#20986;&#12375;&#12395;&#12362;&#12356;&#12390;&#22266;&#26377;&#12398;&#12458;&#12522;&#12472;&#12531;&#12434;&#25345;&#12387;&#12390;&#12356;&#12427;&#12371;&#12392;&#12434;
&#24515;&#12395;&#12392;&#12417;&#12390;&#12362;&#12367;&#12371;&#12392;&#12290;&#12381;&#12398;&#12383;&#12417;&#12289;&#12381;&#12398;&#23450;&#32681;&#12364;&#12411;&#12363;&#12398;&#25152;&#12391;&#20415;&#21033;&#12395;&#25991;&#26360;&#21270;&#12373;&#12428;&#12390;&#12356;&#12427;&#12289;
&#27083;&#36896;&#20307;&#12420;&#21015;&#25369;&#22411;&#12363;&#12418;&#12375;&#12428;&#12394;&#12356;&#12290;
</p><p>
&#12371;&#12398;&#25991;&#26360;&#12399;&#12289;&#27770;&#12375;&#12390;&#23436;&#20840;&#12391;&#12418;&#27491;&#24335;&#12391;&#12418;&#12394;&#12356;&#12290;&#20197;&#19979;&#12398;&#12424;&#12358;&#12418;&#12398;&#12384;&#12369;&#12391;&#12399;&#12394;&#12367;&#12289;
&#25244;&#12369;&#12390;&#12356;&#12427;&#12392;&#12371;&#12429;&#12364;&#12354;&#12427;:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>&#12518;&#12540;&#12470;&#21517;&#12363;&#12425;RID(&#12420;&#12381;&#12398;&#20182;(&#12408;&#12398;&#12510;&#12483;&#12500;&#12531;&#12464;&#12290;</p></li><li class="listitem"><p>&#12518;&#12540;&#12470;ID&#12392;&#12464;&#12523;&#12540;&#12503;ID&#12364;&#20309;&#12391;&#12354;&#12427;&#12363;&#12392;&#12356;&#12358;&#12371;&#12392;&#12290;</p></li><li class="listitem"><p>&#31278;&#12293;&#12398;&#12289;&#29305;&#23450;&#12398;&#23450;&#25968;&#12414;&#12383;&#12399;&#21015;&#25369;&#22411;&#12398;&#27491;&#30906;&#12394;&#24847;&#21619;&#12392;&#23450;&#32681;&#12290;</p></li><li class="listitem"><p>&#12527;&#12540;&#12463;&#12473;&#12486;&#12540;&#12471;&#12519;&#12531;&#12364;&#12489;&#12513;&#12452;&#12531;&#12398;&#12513;&#12531;&#12496;&#12395;&#12394;&#12427;&#12392;&#12365;&#12398;&#12289;&#36820;&#12373;&#12428;&#12427;&#12456;&#12521;&#12540;&#12467;&#12540;&#12489;&#12392;
&#12456;&#12521;&#12540;&#12467;&#12540;&#12489;&#12398;&#20351;&#29992;&#27861;(&#24460;&#12391;&#35500;&#26126;)&#12290;&#22833;&#25943;&#26178;&#12395;&#36820;&#12373;&#12428;&#12427;&#12456;&#12521;&#12540;&#12467;&#12540;&#12489;&#12399;&#12289;&#12527;&#12540;&#12463;&#12473;&#12486;&#12540;&#12471;&#12519;&#12531;&#19978;&#12391;
&#12377;&#12391;&#12395;&#12489;&#12513;&#12452;&#12531;&#12398;&#12513;&#12531;&#12496;&#12395;&#12394;&#12387;&#12390;&#12356;&#12427;&#12392;&#12356;&#12358;&#34920;&#31034;&#12434;&#34892;&#12431;&#12379;&#12427;&#12290;
</p></li><li class="listitem"><p>&#12527;&#12540;&#12463;&#12473;&#12486;&#12540;&#12471;&#12519;&#12531;&#12395;&#12381;&#12398;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#22793;&#26356;&#12373;&#12379;&#12427;&#12371;&#12392;&#12364;&#20986;&#26469;&#12427;&#12424;&#12358;&#12395;&#12377;&#12427;&#12289;
NetrServerPasswordSet&#12467;&#12510;&#12531;&#12489;&#12398;&#26263;&#21495;&#21270;&#12398;&#20596;&#38754;&#12290;&#12371;&#12398;&#12497;&#12473;&#12527;&#12540;&#12489;&#12399;&#38263;&#26399;&#12391;&#12398;&#12475;&#12483;&#12471;&#12519;&#12531;&#12461;&#12540;
&#12434;&#29983;&#25104;&#12377;&#12427;&#12398;&#12395;&#20351;&#12431;&#12428;&#12427;[&#12371;&#12398;&#12467;&#12510;&#12531;&#12489;&#12434;&#25298;&#21542;&#12377;&#12427;&#12398;&#12418;&#21487;&#33021;&#12391;&#12289;&#12381;&#12398;&#22580;&#21512;&#12399;&#26082;&#23450;&#20516;&#12398;
&#12527;&#12540;&#12463;&#12473;&#12486;&#12540;&#12471;&#12519;&#12531;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#20445;&#25345;&#12377;&#12427;]&#12290;</p></li></ol></div><div class="sect2" title="&#12477;&#12540;&#12473;"><div class="titlepage"><div><div><h3 class="title"><a name="id2505216"></a>&#12477;&#12540;&#12473;</h3></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td>cket Traces from Netmonitor (Service Pack 1 and above)</td></tr><tr><td>ul Ashton and Luke Leighton's other "NT Domain" doc.</td></tr><tr><td>FS documentation - cifs6.txt</td></tr><tr><td>FS documentation - cifsrap2.txt</td></tr></table></div><div class="sect2" title="&#12463;&#12524;&#12472;&#12483;&#12488;"><div class="titlepage"><div><div><h3 class="title"><a name="id2505243"></a>&#12463;&#12524;&#12472;&#12483;&#12488;</h3></div></div></div><table border="0" summary="Simple list" class="simplelist"><tr><td>Paul Ashton: loads of work with Net Monitor; understanding the NT authentication system; reference implementation of the NT domain support on which this document is originally based.</td></tr><tr><td>Duncan Stansfield: low-level analysis of MSRPC Pipes.</td></tr><tr><td>Linus Nordberg: producing c-code from Paul's crypto spec.</td></tr><tr><td>Windows Sourcer development team</td></tr></table></div></div><div class="sect1" title="&#27880;&#24847;&#20107;&#38917;&#12392;&#27083;&#36896;"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2505275"></a>&#27880;&#24847;&#20107;&#38917;&#12392;&#27083;&#36896;</h2></div></div></div><div class="sect2" title="&#27880;&#24847;&#20107;&#38917;"><div class="titlepage"><div><div><h3 class="title"><a name="id2505280"></a>&#27880;&#24847;&#20107;&#38917;</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
SMB&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#12497;&#12452;&#12503;&#20013;&#12391;&#12289;&#12356;&#12367;&#12388;&#12363;&#12398;"&#27083;&#36896;&#20307;"&#12364;&#12371;&#12371;&#12391;&#35500;&#26126;&#12373;&#12428;&#12390;&#12356;&#12390;&#12289;
&#38283;&#22987;&#26178;&#12395;4&#12496;&#12452;&#12488;&#22659;&#30028;&#12391;&#25972;&#21015;&#12373;&#12428;&#12383;SMB&#12504;&#12483;&#12480;&#12364;&#12354;&#12427;&#12290;&#27491;&#30906;&#12395;"&#27083;&#36896;&#20307;"&#12434;&#25972;&#21015;&#12373;&#12379;&#12427;
&#24517;&#35201;&#24615;&#12399;&#12289;&#27491;&#30906;&#12395;&#12399;&#30693;&#12425;&#12428;&#12390;&#12418;&#12289;&#25991;&#26360;&#21270;&#12373;&#12428;&#12390;&#12418;&#12356;&#12394;&#12356;&#12290;
</p></li><li class="listitem"><p>
UDP NETLOGON Mailslot&#20013;&#12391;&#12289;&#12356;&#12367;&#12388;&#12363;&#12398;"&#27083;&#36896;&#20307;"&#12364;&#12371;&#12371;&#12391;&#35500;&#26126;&#12373;&#12428;&#12390;&#12356;&#12390;&#12289;&#38283;&#22987;&#26178;&#12395;&#12289;
mailslot&#12398;&#20808;&#38957;&#12395;2&#12496;&#12452;&#12488;&#22659;&#30028;&#12391;&#25972;&#21015;&#12373;&#12428;&#12390;&#12356;&#12427;&#12290;
</p></li><li class="listitem"><p>
Domain SID&#12399;S-revision-version-auth1-auth2...authN&#12392;&#12356;&#12358;&#24418;&#24335;&#12391;&#12354;&#12427;&#12290;&#12383;&#12392;&#12360;&#12400;&#12289;
Domain SID is of the format S-revision-version-auth1-auth2...authN.
S-1-5-123-456-789-123-456&#12391;&#12354;&#12427;&#12290;&#12371;&#12371;&#12391;&#12289;5&#12399;&#12469;&#12502;&#12496;&#12540;&#12472;&#12519;&#12531;&#12391;&#12418;&#12354;&#12426;&#12360;&#12427;&#12290;
</p></li><li class="listitem"><p>
&#21442;&#29031;&#12377;&#12427;&#25991;&#23383;&#12496;&#12483;&#12501;&#12449;&#12364;&#25991;&#23383;&#12434;&#21547;&#12416;&#12394;&#12425;&#12289;&#25991;&#26360;&#21270;&#12373;&#12428;&#12390;&#12356;&#12394;&#12356;&#12496;&#12483;&#12501;&#12449;&#12509;&#12452;&#12531;&#12479;&#12399;0&#20197;&#22806;&#12391;
&#12394;&#12369;&#12428;&#12400;&#12394;&#12425;&#12394;&#12356;&#12290;&#12381;&#12428;&#12364;&#27491;&#30906;&#12395;&#20309;&#12391;&#12354;&#12427;&#12363;&#12399;&#19981;&#26126;&#12391;&#12354;&#12427;&#12290;0x0000 0002&#12399;&#12289;&#12496;&#12483;&#12501;&#12449;&#12364;
&#23384;&#22312;&#12377;&#12427;&#12371;&#12392;&#12434;&#25351;&#31034;&#12377;&#12427;&#12383;&#12417;&#12398;&#12488;&#12522;&#12483;&#12463;&#12434;&#34892;&#12387;&#12390;&#12356;&#12427;&#12424;&#12358;&#12395;&#35211;&#12360;&#12427;&#12290;&#12418;&#12375;&#12418;&#12289;&#12496;&#12483;&#12501;&#12449;
&#12509;&#12452;&#12531;&#12479;&#12364;NULL&#12398;&#22580;&#21512;&#12289;&#27083;&#36896;&#20307;&#12364;&#21442;&#29031;&#12377;&#12427;&#12418;&#12398;&#12399;SMB&#12487;&#12540;&#12479;&#12473;&#12488;&#12522;&#12540;&#12512;&#12408;(&#12354;&#12427;&#12356;&#12399; &#12363;&#12425;)
&#32622;&#12363;&#12428;&#12394;&#12356;&#12290;&#12371;&#12428;&#12399;&#12289;&#32076;&#39443;&#30340;&#12395;&#24471;&#12425;&#12428;&#12383;&#12418;&#12398;&#12391;&#12354;&#12426;&#12289;&#20363;&#12360;&#12400;&#12289;&#12496;&#12483;&#12501;&#12449;&#12509;&#12452;&#12531;&#12479;&#12364;NULL&#12398;&#12289;
LSA SAM&#12525;&#12464;&#12458;&#12531;&#12524;&#12473;&#12509;&#12531;&#12473;&#12497;&#12465;&#12483;&#12488;&#12398;&#12518;&#12540;&#12470;&#24773;&#22577;&#12399;&#12487;&#12540;&#12479;&#12473;&#12488;&#12522;&#12540;&#12512;&#20013;&#12395;&#12399;&#25407;&#20837;&#12373;&#12428;&#12394;&#12356;&#12290;
&#12356;&#12429;&#12356;&#12429;&#12392;&#25512;&#28204;&#12377;&#12427;&#12371;&#12392;&#12399;&#20986;&#26469;&#12427;&#12364;&#12289;&#12496;&#12483;&#12501;&#12449;&#12509;&#12452;&#12531;&#12479;&#12398;&#37197;&#21015;&#12364;&#27491;&#30906;&#12395;&#12394;&#12435;&#12394;&#12398;&#12363;&#12399;
&#26410;&#30693;&#12391;&#12354;&#12427;&#12290;
</p></li><li class="listitem"><p>
&#27083;&#36896;&#20307;(&#12467;&#12531;&#12486;&#12490;)&#12398;&#37197;&#21015;&#12399;&#12289;&#12459;&#12454;&#12531;&#12479;&#12392;&#12509;&#12452;&#12531;&#12479;&#12434;&#25345;&#12388;&#12424;&#12358;&#12395;&#35211;&#12360;&#12427;&#12290;&#12418;&#12375;&#12418;&#12459;&#12454;&#12531;&#12479;&#12364;
&#12476;&#12525;&#12394;&#12425;&#12400;&#12289;&#12509;&#12452;&#12531;&#12479;&#12418;&#12476;&#12525;&#12391;&#12354;&#12427;&#12290;SMB&#12487;&#12540;&#12479;&#12473;&#12488;&#12522;&#12540;&#12512;&#12395;&#12373;&#12425;&#12394;&#12427;&#12487;&#12540;&#12479;&#12399;&#23384;&#22312;&#12375;&#12394;&#12356;&#12290;
&#12418;&#12375;&#12418;&#12289;&#12459;&#12454;&#12531;&#12479;&#12364;&#12476;&#12525;&#12391;&#12394;&#12356;&#22580;&#21512;&#12289;&#12509;&#12452;&#12531;&#12479;&#12418;&#12476;&#12525;&#12391;&#12399;&#12394;&#12356;&#12290;&#12509;&#12452;&#12531;&#12479;&#12398;&#30452;&#24460;&#12395;&#12399;
&#12414;&#12383;&#12289;&#12467;&#12531;&#12486;&#12490;&#12398;&#12469;&#12502;&#27083;&#36896;&#20307;&#12398;&#37197;&#21015;&#12364;&#32154;&#12367;&#12459;&#12454;&#12531;&#12479;&#12364;&#26469;&#12427;&#12290;&#12459;&#12454;&#12531;&#12479;&#12399;&#26368;&#24460;&#12398;&#12469;&#12502;&#27083;&#36896;&#20307;
&#12398;&#24460;&#12395;3&#22238;&#30446;&#12398;&#12459;&#12454;&#12531;&#12479;&#12364;&#26469;&#12427;&#12290;
</p></li></ol></div></div><div class="sect2" title="&#21015;&#25369;"><div class="titlepage"><div><div><h3 class="title"><a name="id2505380"></a>&#21015;&#25369;</h3></div></div></div><div class="sect3" title="MSRPC&#12504;&#12483;&#12480;&#12479;&#12452;&#12503;"><div class="titlepage"><div><div><h4 class="title"><a name="id2505385"></a>MSRPC&#12504;&#12483;&#12480;&#12479;&#12452;&#12503;</h4></div></div></div><p>msrpc&#12497;&#12465;&#12483;&#12488;&#12504;&#12483;&#12480;&#20013;&#12398;&#12467;&#12510;&#12531;&#12489;&#30058;&#21495;</p><div class="variablelist"><dl><dt><span class="term">MSRPC_Request:</span></dt><dd><p>0x00</p></dd><dt><span class="term">MSRPC_Response:</span></dt><dd><p>0x02</p></dd><dt><span class="term">MSRPC_Bind:</span></dt><dd><p>0x0B</p></dd><dt><span class="term">MSRPC_BindAck:</span></dt><dd><p>0x0C</p></dd></dl></div></div><div class="sect3" title="MSRPC &#12497;&#12465;&#12483;&#12488;&#24773;&#22577;"><div class="titlepage"><div><div><h4 class="title"><a name="id2505448"></a>MSRPC &#12497;&#12465;&#12483;&#12488;&#24773;&#22577;</h4></div></div></div><p>&#12371;&#12428;&#12425;&#12398;&#12501;&#12521;&#12464;&#12398;&#24847;&#21619;&#12399;&#25991;&#26360;&#21270;&#12373;&#12428;&#12390;&#12356;&#12394;&#12356;</p><div class="variablelist"><dl><dt><span class="term">FirstFrag:</span></dt><dd><p>0x01 </p></dd><dt><span class="term">LastFrag:</span></dt><dd><p>0x02 </p></dd><dt><span class="term">NotaFrag:</span></dt><dd><p>0x04  </p></dd><dt><span class="term">RecRespond:</span></dt><dd><p>0x08  </p></dd><dt><span class="term">NoMultiplex:</span></dt><dd><p>0x10  </p></dd><dt><span class="term">NotForIdemp:</span></dt><dd><p>0x20  </p></dd><dt><span class="term">NotforBcast:</span></dt><dd><p>0x40  </p></dd><dt><span class="term">NoUuid:</span></dt><dd><p>0x80 </p></dd></dl></div></div></div><div class="sect2" title="&#27083;&#36896;&#20307;"><div class="titlepage"><div><div><h3 class="title"><a name="id2505554"></a>&#27083;&#36896;&#20307;</h3></div></div></div><div class="sect3" title="VOID *"><div class="titlepage"><div><div><h4 class="title"><a name="id2505559"></a>VOID *</h4></div></div></div><p>sizeof VOID* &#12399; 32&#12499;&#12483;&#12488;&#12391;&#12354;&#12427;&#12290;</p></div><div class="sect3" title="char"><div class="titlepage"><div><div><h4 class="title"><a name="id2505570"></a>char</h4></div></div></div><p>sizeof char &#12399;8 &#12499;&#12483;&#12488;&#12391;&#12354;&#12427;&#12290;</p></div><div class="sect3" title="UTIME"><div class="titlepage"><div><div><h4 class="title"><a name="id2505580"></a>UTIME</h4></div></div></div><p>UTIME &#12399; 32 &#12499;&#12483;&#12488;&#12391;&#12354;&#12426;&#12289;1980&#24180;1&#26376;1&#26085;&#12363;&#12425;&#12398;&#31186;&#25968;&#12434;&#31034;&#12377;&#12290;cifs6.txt&#12391;&#35500;&#26126;&#12364;&#12354;&#12427; (section 3.5 page, page 30)&#12290;</p></div><div class="sect3" title="NTTIME"><div class="titlepage"><div><div><h4 class="title"><a name="id2505593"></a>NTTIME</h4></div></div></div><p>NTTIME &#12399; 64 &#12499;&#12483;&#12488;&#12391;&#12354;&#12427;&#12290;cifs6.txt&#12391;&#35500;&#26126;&#12364;&#12354;&#12427; (section 3.5 page, page 30)&#12290;</p></div><div class="sect3" title="DOM_SID (domain SID &#27083;&#36896;&#20307;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2505605"></a>DOM_SID (domain SID &#27083;&#36896;&#20307;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>num of sub-authorities in domain SID</p></dd><dt><span class="term">UINT8</span></dt><dd><p>SID revision number</p></dd><dt><span class="term">UINT8</span></dt><dd><p>num of sub-authorities in domain SID</p></dd><dt><span class="term">UINT8[6]</span></dt><dd><p>6 bytes for domain SID - Identifier Authority.</p></dd><dt><span class="term">UINT16[n_subauths]</span></dt><dd><p>domain SID sub-authorities</p></dd></dl></div><p><span class="emphasis"><em>&#27880;&#24847;:&#12489;&#12513;&#12452;&#12531; SID &#12399;&#12393;&#12371;&#12363;&#12391;&#25991;&#26360;&#21270;&#12373;&#12428;&#12390;&#12356;&#12427;&#12290;</em></span>
</p></div><div class="sect3" title="STR (&#25991;&#23383;&#21015;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2505680"></a>STR (&#25991;&#23383;&#21015;)</h4></div></div></div><p>STR (&#25991;&#23383;&#21015;) &#12399; char[] &#12391;&#12354;&#12427;: &#12371;&#12428;&#12399;null&#25991;&#23383;&#12391;&#32066;&#31471;&#12377;&#12427;ASCII&#25991;&#23383;&#21015;&#12391;&#12354;&#12427;&#12290;</p></div><div class="sect3" title="UNIHDR (UNICODE&#25991;&#23383;&#21015;&#12504;&#12483;&#12480;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2505693"></a>UNIHDR (UNICODE&#25991;&#23383;&#21015;&#12504;&#12483;&#12480;) </h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT16</span></dt><dd><p>length of unicode string</p></dd><dt><span class="term">UINT16</span></dt><dd><p>max length of unicode string</p></dd><dt><span class="term">UINT32</span></dt><dd><p>4 - undocumented.</p></dd></dl></div></div><div class="sect3" title="UNIHDR2 (UNICODE&#25991;&#23383;&#21015;&#12504;&#12483;&#12480;+&#12496;&#12483;&#12501;&#12449;&#12509;&#12452;&#12531;&#12479;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2505738"></a>UNIHDR2 (UNICODE&#25991;&#23383;&#21015;&#12504;&#12483;&#12480;+&#12496;&#12483;&#12501;&#12449;&#12509;&#12452;&#12531;&#12479;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UNIHDR</span></dt><dd><p>unicode string header</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd></dl></div></div><div class="sect3" title="UNISTR (UNICODE&#25991;&#23383;&#21015;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2505772"></a>UNISTR (UNICODE&#25991;&#23383;&#21015;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT16[]</span></dt><dd><p>null-terminated string of unicode characters.</p></dd></dl></div></div><div class="sect3" title="NAME (&#38263;&#12373;&#12364;&#25351;&#23450;&#12373;&#12428;&#12390;&#12356;&#12427;UNICODE&#25991;&#23383;&#21015;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2505794"></a>NAME (&#38263;&#12373;&#12364;&#25351;&#23450;&#12373;&#12428;&#12390;&#12356;&#12427;UNICODE&#25991;&#23383;&#21015;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>length of unicode string</p></dd><dt><span class="term">UINT16[]</span></dt><dd><p>null-terminated string of unicode characters.</p></dd></dl></div></div><div class="sect3" title="UNISTR2 (&#22659;&#30028;&#12395;&#25972;&#21512;&#12375;&#12390;&#12354;&#12427;UNICODE&#25991;&#23383;&#21015;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2505828"></a>UNISTR2 (&#22659;&#30028;&#12395;&#25972;&#21512;&#12375;&#12390;&#12354;&#12427;UNICODE&#25991;&#23383;&#21015;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT8[]</span></dt><dd><p>padding to get unicode string 4-byte aligned with the start of the SMB header.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>max length of unicode string</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - undocumented</p></dd><dt><span class="term">UINT32</span></dt><dd><p>length of unicode string</p></dd><dt><span class="term">UINT16[]</span></dt><dd><p>string of uncode characters</p></dd></dl></div></div><div class="sect3" title="OBJ_ATTR (&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#23646;&#24615;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2505897"></a>OBJ_ATTR (&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#23646;&#24615;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>0x18 - length (in bytes) including the length field.</p></dd><dt><span class="term">VOID*</span></dt><dd><p>0 - root directory (pointer)</p></dd><dt><span class="term">VOID*</span></dt><dd><p>0 - object name (pointer)</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - attributes (undocumented)</p></dd><dt><span class="term">VOID*</span></dt><dd><p>0 - security descriptior (pointer)</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - security quality of service</p></dd></dl></div></div><div class="sect3" title="POL_HND (LSA&#12509;&#12522;&#12471;&#12540;&#12495;&#12531;&#12489;&#12523;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557026"></a>POL_HND (LSA&#12509;&#12522;&#12471;&#12540;&#12495;&#12531;&#12489;&#12523;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">char[20]</span></dt><dd><p>policy handle</p></dd></dl></div></div><div class="sect3" title="DOM_SID2 (&#12489;&#12513;&#12452;&#12531;SID&#27083;&#36896;&#20307;&#12391;&#12289;SIDS&#12399;UNICODE&#12391;&#26684;&#32013;&#12373;&#12428;&#12427;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557047"></a>DOM_SID2 (&#12489;&#12513;&#12452;&#12531;SID&#27083;&#36896;&#20307;&#12391;&#12289;SIDS&#12399;UNICODE&#12391;&#26684;&#32013;&#12373;&#12428;&#12427;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>5 - SID type</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - undocumented</p></dd><dt><span class="term">UNIHDR2</span></dt><dd><p>domain SID unicode string header</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>domain SID unicode string</p></dd></dl></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#25991;&#23383;&#21015;&#12398;&#38263;&#12373;&#12434;&#25351;&#23450;&#31034;&#12377;&#12383;&#12417;&#12395;&#12289;&#12393;&#12385;&#12425;&#12434;&#20351;&#12358;&#12363;&#12395;&#12388;&#12356;&#12390;&#12289;
UNICODE&#25991;&#23383;&#21015;&#12504;&#12483;&#12480;&#12392;UNICODE&#25991;&#23383;&#21015;&#33258;&#36523;&#12392;&#12398;&#38291;&#12391;&#31478;&#21512;&#12364;&#12354;&#12427;&#12290;&#12371;&#12428;&#12399;&#35299;&#27770;&#12373;&#12428;&#12397;&#12400;&#12394;&#12425;&#12394;&#12356;&#12384;&#12429;&#12358;&#12290;
</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	SID&#12479;&#12452;&#12503;&#12399;&#12289;&#12383;&#12392;&#12360;&#12400;&#21029;&#21517;&#12289;&#26082;&#23450;&#12398;&#12464;&#12523;&#12540;&#12503;&#31561;&#12394;&#12393;&#12434;&#25351;&#31034;&#12377;&#12427;&#12290;&#12371;&#12428;&#12399;
&#12393;&#12371;&#12363;&#12391;&#25991;&#26360;&#21270;&#12373;&#12428;&#12390;&#12356;&#12427;&#12290;</em></span></p></div><div class="sect3" title="DOM_RID (&#12489;&#12513;&#12452;&#12531; RID &#27083;&#36896;&#20307;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557118"></a>DOM_RID (&#12489;&#12513;&#12452;&#12531; RID &#27083;&#36896;&#20307;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>5 - well-known SID.  1 - user SID (see ShowACLs)</p></dd><dt><span class="term">UINT32</span></dt><dd><p>5 - undocumented</p></dd><dt><span class="term">UINT32</span></dt><dd><p>domain RID </p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - domain index out of above reference domains</p></dd></dl></div></div><div class="sect3" title="LOG_INFO (&#12469;&#12540;&#12496;&#12289;&#12450;&#12459;&#12454;&#12531;&#12488;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#27083;&#36896;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557172"></a>LOG_INFO (&#12469;&#12540;&#12496;&#12289;&#12450;&#12459;&#12454;&#12531;&#12488;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#27083;&#36896;)</h4></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12525;&#12464;&#12458;&#12531;&#12469;&#12540;&#12496;&#21517;&#12399;&#12289;2&#12388;&#12398;'\'&#12391;&#22987;&#12414;&#12426;&#12289;&#22823;&#25991;&#23383;&#12391;&#12354;&#12427;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	&#12450;&#12459;&#12454;&#12531;&#12488;&#21517;&#12399;&#12289;LSA&#12522;&#12463;&#12456;&#12473;&#12488;&#12481;&#12515;&#12524;&#12531;&#12472;&#12363;&#12425;&#12398;&#12525;&#12464;&#12458;&#12531;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#21517;&#12391;&#12289;&#26368;&#24460;&#12395;$&#12364;&#12354;&#12426;&#12289;&#22823;&#25991;&#23383;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon server unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>account name unicode string</p></dd><dt><span class="term">UINT16</span></dt><dd><p>sec_chan - security channel type</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon client machine unicode string</p></dd></dl></div></div><div class="sect3" title="CLNT_SRV (&#12469;&#12540;&#12496;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12289;&#21517;&#21069;&#27083;&#36896;&#20307;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557252"></a>CLNT_SRV (&#12469;&#12540;&#12496;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12289;&#21517;&#21069;&#27083;&#36896;&#20307;)</h4></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12525;&#12464;&#12458;&#12531;&#12469;&#12540;&#12496;&#21517;&#12399;2&#12388;&#12398;'\'&#12391;&#22987;&#12414;&#12426;&#12289;&#22823;&#25991;&#23383;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon server unicode string</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon client machine unicode string</p></dd></dl></div></div><div class="sect3" title="CREDS (credentials + time stamp)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557312"></a>CREDS (credentials + time stamp)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">char[8]</span></dt><dd><p>credentials</p></dd><dt><span class="term">UTIME</span></dt><dd><p>time stamp</p></dd></dl></div></div><div class="sect3" title="CLNT_INFO2 (&#12469;&#12540;&#12496;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#27083;&#36896;&#20307;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#35469;&#35388;&#24773;&#22577;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557344"></a>CLNT_INFO2 (&#12469;&#12540;&#12496;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#27083;&#36896;&#20307;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#35469;&#35388;&#24773;&#22577;)</h4></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;: &#35201;&#27714;&#20013;&#12395;&#12371;&#12398;&#27083;&#36896;&#20307;&#12364;&#20351;&#12431;&#12428;&#12383;&#26178;&#12395;&#12399;&#12356;&#12388;&#12391;&#12418;&#12289;&#24341;&#12365;&#32154;&#12367;&#35469;&#35388;&#26908;&#26619;&#12391;&#20351;&#12431;&#12428;&#12427;&#12383;&#12417;&#12289;
&#21463;&#12369;&#21462;&#12387;&#12383;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12391;&#35336;&#31639;&#12373;&#12428;&#12383;&#35469;&#35388;&#24773;&#22577;&#12398;&#12467;&#12500;&#12540;&#12434;&#21462;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;&#20206;&#23450;&#12373;&#12428;&#12383;&#24847;&#22259;&#12399;&#12289;&#35469;&#35388;&#12373;&#12428;&#12383;
&#35201;&#27714;/&#24540;&#31572;&#12398;&#30165;&#36321;&#12434;&#32173;&#25345;&#12377;&#12427;&#12371;&#12392;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="variablelist"><dl><dt><span class="term">CLNT_SRV</span></dt><dd><p>client and server names</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>???? padding, for 4-byte alignment with SMB header.</p></dd><dt><span class="term">VOID*</span></dt><dd><p>pointer to client credentials.</p></dd><dt><span class="term">CREDS</span></dt><dd><p>client-calculated credentials + client time</p></dd></dl></div></div><div class="sect3" title="CLNT_INFO (&#12469;&#12540;&#12496;&#12289;&#12450;&#12459;&#12454;&#12531;&#12488;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#27083;&#36896;&#20307;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#35469;&#35388;&#24773;&#22577;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557417"></a>CLNT_INFO (&#12469;&#12540;&#12496;&#12289;&#12450;&#12459;&#12454;&#12531;&#12488;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#27083;&#36896;&#20307;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#35469;&#35388;&#24773;&#22577;)</h4></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;: &#35201;&#27714;&#20013;&#12395;&#12371;&#12398;&#27083;&#36896;&#20307;&#12364;&#20351;&#12431;&#12428;&#12383;&#26178;&#12395;&#12399;&#12356;&#12388;&#12391;&#12418;&#12289;&#24341;&#12365;&#32154;&#12367;&#35469;&#35388;&#26908;&#26619;&#12391;&#20351;&#12431;&#12428;&#12427;&#12383;&#12417;&#12289;
&#21463;&#12369;&#21462;&#12387;&#12383;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12391;&#35336;&#31639;&#12373;&#12428;&#12383;&#35469;&#35388;&#24773;&#22577;&#12398;&#12467;&#12500;&#12540;&#12434;&#21462;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;&#20206;&#23450;&#12373;&#12428;&#12383;&#24847;&#22259;&#12399;&#12289;&#35469;&#35388;&#12373;&#12428;&#12383;
&#35201;&#27714;/&#24540;&#31572;&#12398;&#30165;&#36321;&#12434;&#32173;&#25345;&#12377;&#12427;&#12371;&#12392;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="variablelist"><dl><dt><span class="term">LOG_INFO</span></dt><dd><p>logon account info</p></dd><dt><span class="term">CREDS</span></dt><dd><p>client-calculated credentials + client time</p></dd></dl></div></div><div class="sect3" title="ID_INFO_1 (id &#24773;&#22577;&#27083;&#36896;&#20307;&#12289;&#35469;&#35388;&#12524;&#12505;&#12523; 1)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557467"></a>ID_INFO_1 (id &#24773;&#22577;&#27083;&#36896;&#20307;&#12289;&#35469;&#35388;&#12524;&#12505;&#12523; 1)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>ptr_id_info_1</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>domain name unicode header</p></dd><dt><span class="term">UINT32</span></dt><dd><p>param control</p></dd><dt><span class="term">UINT64</span></dt><dd><p>logon ID</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>user name unicode header</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>workgroup name unicode header</p></dd><dt><span class="term">char[16]</span></dt><dd><p>arc4 LM OWF Password</p></dd><dt><span class="term">char[16]</span></dt><dd><p>arc4 NT OWF Password</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>domain name unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>user name unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>workstation name unicode string</p></dd></dl></div></div><div class="sect3" title="SAM_INFO (sam logon/logoff ID&#24773;&#22577;&#27083;&#36896;&#20307;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557598"></a>SAM_INFO (sam logon/logoff ID&#24773;&#22577;&#27083;&#36896;&#20307;)</h4></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;: &#12383;&#12406;&#12435;&#12289;&#25147;&#12373;&#12428;&#12427;&#35469;&#35388;&#24773;&#22577;&#12399;&#12289;&#12362;&#12381;&#12425;&#12367;&#35469;&#35388;&#12481;&#12455;&#12452;&#12531;&#12364;&#33030;&#24369;&#12391;&#12394;&#12356;&#20107;&#12434;&#12289;&#12469;&#12540;&#12496;&#12364;&#26908;&#26619;&#12377;&#12427;&#12383;&#12417;&#12398;&#12418;&#12398;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="variablelist"><dl><dt><span class="term">CLNT_INFO2</span></dt><dd><p>client identification/authentication info</p></dd><dt><span class="term">VOID*</span></dt><dd><p>pointer to return credentials.</p></dd><dt><span class="term">CRED</span></dt><dd><p>return credentials - ignored.</p></dd><dt><span class="term">UINT16</span></dt><dd><p>logon level</p></dd><dt><span class="term">UINT16</span></dt><dd><p>switch value</p></dd></dl></div><pre class="programlisting">
        switch (switch_value)
        case 1:
        {
            ID_INFO_1     id_info_1;
        }
</pre></div><div class="sect3" title="GID (&#12464;&#12523;&#12540;&#12503;ID&#24773;&#22577;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557679"></a>GID (&#12464;&#12523;&#12540;&#12503;ID&#24773;&#22577;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>group id</p></dd><dt><span class="term">UINT32</span></dt><dd><p>user attributes (only used by NT 3.1 and 3.51)</p></dd></dl></div></div><div class="sect3" title="DOM_REF (&#12489;&#12513;&#12452;&#12531;&#12522;&#12501;&#12449;&#12524;&#12531;&#12473;&#24773;&#22577;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557710"></a>DOM_REF (&#12489;&#12513;&#12452;&#12531;&#12522;&#12501;&#12449;&#12524;&#12531;&#12473;&#24773;&#22577;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num referenced domains?</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented domain name buffer pointer.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>32 - max number of entries</p></dd><dt><span class="term">UINT32</span></dt><dd><p>4 - num referenced domains?</p></dd><dt><span class="term">UNIHDR2</span></dt><dd><p>domain name unicode string header</p></dd><dt><span class="term">UNIHDR2[num_ref_doms-1]</span></dt><dd><p>referenced domain unicode string headers</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>domain name unicode string</p></dd><dt><span class="term">DOM_SID[num_ref_doms]</span></dt><dd><p>referenced domain SIDs</p></dd></dl></div></div><div class="sect3" title="DOM_INFO (&#12489;&#12513;&#12452;&#12531;&#24773;&#22577;&#12289;&#12524;&#12505;&#12523;3&#12392;5&#12399;&#21516;&#12376;))"><div class="titlepage"><div><div><h4 class="title"><a name="id2557820"></a>DOM_INFO (&#12489;&#12513;&#12452;&#12531;&#24773;&#22577;&#12289;&#12524;&#12505;&#12523;3&#12392;5&#12399;&#21516;&#12376;))</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT8[]</span></dt><dd><p>??? padding to get 4-byte alignment with start of SMB header</p></dd><dt><span class="term">UINT16</span></dt><dd><p>domain name string length * 2</p></dd><dt><span class="term">UINT16</span></dt><dd><p>domain name string length * 2</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented domain name string buffer pointer</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented domain SID string buffer pointer</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>domain name (unicode string)</p></dd><dt><span class="term">DOM_SID</span></dt><dd><p>domain SID</p></dd></dl></div></div><div class="sect3" title="USER_INFO (&#12518;&#12540;&#12470;&#12525;&#12464;&#12458;&#12531;&#24773;&#22577;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2557910"></a>USER_INFO (&#12518;&#12540;&#12470;&#12525;&#12464;&#12458;&#12531;&#24773;&#22577;)</h4></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;: 16&#12496;&#12452;&#12488;&#12398;&#12518;&#12540;&#12470;&#12475;&#12483;&#12471;&#12519;&#12531;&#12461;&#12540;&#12364;&#20309;&#12398;&#12383;&#12417;&#12363;&#12434;&#30693;&#12427;&#12371;&#12392;&#12399;&#12377;&#12390;&#12365;&#12391;&#12354;&#12429;&#12358;&#12290;</em></span></p><div class="variablelist"><dl><dt><span class="term">NTTIME</span></dt><dd><p>logon time</p></dd><dt><span class="term">NTTIME</span></dt><dd><p>logoff time</p></dd><dt><span class="term">NTTIME</span></dt><dd><p>kickoff time</p></dd><dt><span class="term">NTTIME</span></dt><dd><p>password last set time</p></dd><dt><span class="term">NTTIME</span></dt><dd><p>password can change time</p></dd><dt><span class="term">NTTIME</span></dt><dd><p>password must change time</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>username unicode string header</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>user's full name unicode string header</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>logon script unicode string header</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>profile path unicode string header</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>home directory unicode string header</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>home directory drive unicode string header</p></dd><dt><span class="term">UINT16</span></dt><dd><p>logon count</p></dd><dt><span class="term">UINT16</span></dt><dd><p>bad password count</p></dd><dt><span class="term">UINT32</span></dt><dd><p>User ID</p></dd><dt><span class="term">UINT32</span></dt><dd><p>Group ID</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num groups</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer to groups.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>user flags</p></dd><dt><span class="term">char[16]</span></dt><dd><p>user session key</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>logon server unicode string header</p></dd><dt><span class="term">UNIHDR</span></dt><dd><p>logon domain unicode string header</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented logon domain id pointer</p></dd><dt><span class="term">char[40]</span></dt><dd><p>40 undocumented padding bytes.  future expansion?</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - num_other_sids?</p></dd><dt><span class="term">VOID*</span></dt><dd><p>NULL - undocumented pointer to other domain SIDs.</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>username unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>user's full name unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon script unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>profile path unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>home directory unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>home directory drive unicode string</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num groups</p></dd><dt><span class="term">GID[num_groups]</span></dt><dd><p>group info</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon server unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon domain unicode string</p></dd><dt><span class="term">DOM_SID</span></dt><dd><p>domain SID</p></dd><dt><span class="term">DOM_SID[num_sids]</span></dt><dd><p>other domain SIDs?</p></dd></dl></div></div><div class="sect3" title="SH_INFO_1_PTR (&#12524;&#12505;&#12523;1&#20849;&#26377;&#24773;&#22577;&#25991;&#23383;&#21015;&#12408;&#12398;&#12509;&#12452;&#12531;&#12479;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2558344"></a>SH_INFO_1_PTR (&#12524;&#12505;&#12523;1&#20849;&#26377;&#24773;&#22577;&#25991;&#23383;&#21015;&#12408;&#12398;&#12509;&#12452;&#12531;&#12479;)</h4></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	cifsrap2.txt&#12398; section5, page 10&#12434;&#21442;&#29031;&#12290;</em></span></p><table border="0" summary="Simple list" class="simplelist"><tr><td>0 for shi1_type indicates a  Disk.</td></tr><tr><td>1 for shi1_type indicates a  Print Queue.</td></tr><tr><td>2 for shi1_type indicates a  Device.</td></tr><tr><td>3 for shi1_type indicates an IPC pipe.</td></tr><tr><td>0x8000 0000 (top bit set in shi1_type) indicates a hidden share.</td></tr></table><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>shi1_netname - pointer to net name</p></dd><dt><span class="term">UINT32</span></dt><dd><p>shi1_type    - type of share.  0 - undocumented.</p></dd><dt><span class="term">VOID*</span></dt><dd><p>shi1_remark  - pointer to comment.</p></dd></dl></div></div><div class="sect3" title="SH_INFO_1_STR (level 1 &#20849;&#26377;&#24773;&#22577;&#25991;&#23383;&#21015;)"><div class="titlepage"><div><div><h4 class="title"><a name="id2558420"></a>SH_INFO_1_STR (level 1 &#20849;&#26377;&#24773;&#22577;&#25991;&#23383;&#21015;)</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UNISTR2</span></dt><dd><p>shi1_netname - unicode string of net name</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>shi1_remark  - unicode string of comment.</p></dd></dl></div></div><div class="sect3" title="SHARE_INFO_1_CTR"><div class="titlepage"><div><div><h4 class="title"><a name="id2558455"></a>SHARE_INFO_1_CTR</h4></div></div></div><p>share container with 0 entries:</p><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>0 - EntriesRead</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - Buffer</p></dd></dl></div><p>share container with &gt; 0 entries:</p><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>EntriesRead</p></dd><dt><span class="term">UINT32</span></dt><dd><p>non-zero - Buffer</p></dd><dt><span class="term">UINT32</span></dt><dd><p>EntriesRead</p></dd><dt><span class="term">SH_INFO_1_PTR[EntriesRead]</span></dt><dd><p>share entry pointers</p></dd><dt><span class="term">SH_INFO_1_STR[EntriesRead]</span></dt><dd><p>share entry strings</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>padding to get unicode string 4-byte aligned with start of the SMB header.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>EntriesRead</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - padding</p></dd></dl></div></div><div class="sect3" title="SERVER_INFO_101"><div class="titlepage"><div><div><h4 class="title"><a name="id2558583"></a>SERVER_INFO_101</h4></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	cifs6.txt section 6.4&#12434;&#21442;&#29031; - &#12381;&#12398;&#20013;&#12391;&#35500;&#26126;&#12373;&#12428;&#12390;&#12356;&#12427;&#12501;&#12451;&#12540;&#12523;&#12489;&#12399;&#12371;&#12371;&#12391;&#35036;&#36275;&#12377;&#12427;&#12290;
&#20363;&#12360;&#12400;&#12289;&#20197;&#19979;&#12391;&#12522;&#12473;&#12488;&#12373;&#12428;&#12383;&#12479;&#12452;&#12503;&#12399;6.4.1&#12391;&#35500;&#26126;&#12373;&#12428;&#12390;&#12356;&#12427;fServerType&#12392;&#21516;&#12376;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="variablelist"><dl><dt><span class="term">SV_TYPE_WORKSTATION</span></dt><dd><p>0x00000001  All workstations</p></dd><dt><span class="term">SV_TYPE_SERVER</span></dt><dd><p>0x00000002  All servers</p></dd><dt><span class="term">SV_TYPE_SQLSERVER</span></dt><dd><p>0x00000004  Any server running with SQL server</p></dd><dt><span class="term">SV_TYPE_DOMAIN_CTRL</span></dt><dd><p>0x00000008  Primary domain controller</p></dd><dt><span class="term">SV_TYPE_DOMAIN_BAKCTRL</span></dt><dd><p>0x00000010  Backup domain controller</p></dd><dt><span class="term">SV_TYPE_TIME_SOURCE</span></dt><dd><p>0x00000020  Server running the timesource service</p></dd><dt><span class="term">SV_TYPE_AFP</span></dt><dd><p>0x00000040  Apple File Protocol servers</p></dd><dt><span class="term">SV_TYPE_NOVELL</span></dt><dd><p>0x00000080  Novell servers</p></dd><dt><span class="term">SV_TYPE_DOMAIN_MEMBER</span></dt><dd><p>0x00000100  Domain Member</p></dd><dt><span class="term">SV_TYPE_PRINTQ_SERVER</span></dt><dd><p>0x00000200  Server sharing print queue</p></dd><dt><span class="term">SV_TYPE_DIALIN_SERVER</span></dt><dd><p>0x00000400  Server running dialin service.</p></dd><dt><span class="term">SV_TYPE_XENIX_SERVER</span></dt><dd><p>0x00000800  Xenix server</p></dd><dt><span class="term">SV_TYPE_NT</span></dt><dd><p>0x00001000  NT server</p></dd><dt><span class="term">SV_TYPE_WFW</span></dt><dd><p>0x00002000  Server running Windows for </p></dd><dt><span class="term">SV_TYPE_SERVER_NT</span></dt><dd><p>0x00008000  Windows NT non DC server</p></dd><dt><span class="term">SV_TYPE_POTENTIAL_BROWSER</span></dt><dd><p>0x00010000  Server that can run the browser service</p></dd><dt><span class="term">SV_TYPE_BACKUP_BROWSER</span></dt><dd><p>0x00020000  Backup browser server</p></dd><dt><span class="term">SV_TYPE_MASTER_BROWSER</span></dt><dd><p>0x00040000  Master browser server</p></dd><dt><span class="term">SV_TYPE_DOMAIN_MASTER</span></dt><dd><p>0x00080000  Domain Master Browser server</p></dd><dt><span class="term">SV_TYPE_LOCAL_LIST_ONLY</span></dt><dd><p>0x40000000  Enumerate only entries marked "local"</p></dd><dt><span class="term">SV_TYPE_DOMAIN_ENUM</span></dt><dd><p>0x80000000  Enumerate Domains. The pszServer and pszDomain parameters must be NULL.</p></dd></dl></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>500 - platform_id</p></dd><dt><span class="term">VOID*</span></dt><dd><p>pointer to name</p></dd><dt><span class="term">UINT32</span></dt><dd><p>5 - major version</p></dd><dt><span class="term">UINT32</span></dt><dd><p>4 - minor version</p></dd><dt><span class="term">UINT32</span></dt><dd><p>type (SV_TYPE_... bit field)</p></dd><dt><span class="term">VOID*</span></dt><dd><p>pointer to comment</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>sv101_name - unicode string of server name</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>sv_101_comment  - unicode string of server comment.</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>padding to get unicode string 4-byte aligned with start of the SMB header.</p></dd></dl></div></div></div></div><div class="sect1" title="&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#19978;&#12391;&#12398;MSRPC"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2558942"></a>&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#19978;&#12391;&#12398;MSRPC</h2></div></div></div><p>&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;&#19978;&#12398;SMB&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#12398;&#35443;&#32048;&#12399;cifs6.txt&#12434;&#21442;&#29031;&#12290;</p><div class="sect2" title="MSRPC &#12497;&#12452;&#12503;"><div class="titlepage"><div><div><h3 class="title"><a name="id2558953"></a>MSRPC &#12497;&#12452;&#12503;</h3></div></div></div><p>
MSRPC&#12399;<code class="filename">\PIPE\</code>&#12392;&#12356;&#12358;&#21517;&#21069;&#12398;SMB&#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#12497;&#12452;&#12503;&#19978;&#12391;&#34892;&#12431;&#12428;&#12427;&#12290;
&#12383;&#12392;&#12360;&#12400;&#12289;&#12497;&#12452;&#12503;&#21517;<code class="filename">\PIPE\srvsvc</code>&#12391;SMBopenX&#12434;&#36865;&#20449;&#12377;&#12427;&#12371;&#12392;&#12391;&#12289;
&#12414;&#12378;&#21021;&#12417;&#12395;16&#12499;&#12483;&#12488;&#12398;&#12501;&#12449;&#12452;&#12523;&#12495;&#12531;&#12489;&#12523;&#12434;&#24471;&#12390;&#12362;&#12363;&#12397;&#12400;&#12394;&#12425;&#12394;&#12356;&#12290;&#12381;&#12358;&#12377;&#12427;&#12392;&#27425;&#12395;
SMB Trans&#12434;&#23455;&#34892;&#12391;&#12365;&#12289;&#20966;&#29702;&#12364;&#32066;&#20102;&#12375;&#12383;&#12425;&#12289;&#12501;&#12449;&#12452;&#12523;&#12495;&#12531;&#12489;&#12523;&#19978;&#12391;SMBClose&#12434;&#36865;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;
</p><p>
Trans Request&#12399;(&#12371;&#12428;&#12395;&#12388;&#12356;&#12390;&#12399;&#30693;&#12425;&#12428;&#12390;&#12356;&#12394;&#12356;&#12364;)1&#12388;&#12398;UINT16&#12391;&#12399;&#12394;&#12367;2&#12388;&#12398;UINT16
&#12475;&#12483;&#12488;&#12450;&#12483;&#12503;&#12497;&#12521;&#12513;&#12540;&#12479;&#12392;&#12289;MSRPC&#12504;&#12483;&#12480;&#12434;&#21547;&#12416;&#12383;&#12417;&#12395;&#21313;&#20998;&#12394;UINT8&#12487;&#12540;&#12479;&#12497;&#12521;&#12513;&#12540;&#12479;&#12392;
MSRPC&#12487;&#12540;&#12479;&#12434;&#36865;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;&#26368;&#21021;&#12398;UINT16&#12475;&#12483;&#12488;&#12450;&#12483;&#12503;&#12497;&#12521;&#12513;&#12540;&#12479;&#12399;RPC&#12434;&#25351;&#23450;&#12377;&#12427;&#12383;&#12417;&#12395;
0x0026&#12363;&#12289;Set Named Pipe Handle State&#12434;&#25351;&#31034;&#12377;&#12427;&#12383;&#12417;&#12395;&#12289;0x0001&#12398;&#12393;&#12385;&#12425;&#12363;&#12391;&#12394;&#12369;&#12428;&#12400;
&#12394;&#12425;&#12394;&#12356;&#12290;2&#30058;&#30446;&#12398;UINT16&#12497;&#12521;&#12513;&#12540;&#12479;&#12399;&#12289;&#19978;&#35352;&#12391;&#24471;&#12425;&#12428;&#12383;&#12289;&#12497;&#12452;&#12503;&#29992;&#12398;&#12501;&#12449;&#12452;&#12523;&#12495;&#12531;&#12489;&#12523;&#12391;
&#12394;&#12369;&#12428;&#12400;&#12394;&#12425;&#12394;&#12356;&#12290;
</p><p>
Trans Request&#20013;&#12398;&#12289;0x0026 (RPC pipe)&#12391;&#12354;&#12427;API&#12467;&#12510;&#12531;&#12489;&#29992;&#12398;&#12487;&#12540;&#12479;&#12475;&#12463;&#12471;&#12519;&#12531;&#12399;&#12289;RPC&#12487;&#12540;&#12479;&#12364;
&#24460;&#12395;&#26469;&#12427;RPC&#12504;&#12483;&#12480;&#12391;&#12354;&#12427;&#12290;0x0001&#12398;API&#12467;&#12510;&#12531;&#12489;(Set Named Pipe Handle state)&#12398;&#12383;&#12417;&#12398;
&#12487;&#12540;&#12479;&#12475;&#12463;&#12471;&#12519;&#12531;&#12399;&#12289;2&#12496;&#12452;&#12488;&#12391;&#12354;&#12427;&#12290;&#12381;&#12398;2&#12496;&#12452;&#12488;&#12398;&#20013;&#12395;&#29694;&#12428;&#12427;&#12418;&#12398;&#12399;&#12289;0x00 0x43&#12398;&#12415;&#12391;&#12354;&#12427;&#12290;
The Data section for an API Command of 0x0026 (RPC pipe) in the Trans
Request is the RPC Header, followed by the RPC Data.  The Data section for
an API Command of 0x0001 (Set Named Pipe Handle state) is two bytes.  The
only value seen for these two bytes is 0x00 0x43.
</p><p>
MSRPC Response&#12399;MSPRC&#12504;&#12483;&#12480;&#12289;MSRPC&#12487;&#12540;&#12479;&#12392;MSRPC&#12501;&#12483;&#12479;(&#35379;&#27880;:tail)&#12364;&#12354;&#12427;&#12289;&#27161;&#28310;
SMB Trans&#12524;&#12473;&#12509;&#12531;&#12473;&#20869;&#12391;&#12289;&#12524;&#12473;&#12509;&#12531;&#12473;&#12487;&#12540;&#12479;&#12392;&#12375;&#12390;&#36865;&#20449;&#12373;&#12428;&#12427;&#12290;
</p><p>
Trans Request&#12364;&#23569;&#12394;&#12367;&#12392;&#12418;2&#12496;&#12452;&#12488;&#22659;&#30028;(&#12362;&#12381;&#12425;&#12367;4&#12496;&#12452;&#12488;)&#12395;&#37197;&#32622;&#12373;&#12428;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12384;&#12429;&#12358;&#12392;
&#12356;&#12358;&#12371;&#12392;&#12399;&#12289;&#25512;&#28204;&#12373;&#12428;&#12427;&#12290;&#12371;&#12428;&#12399;&#12289;SMB&#12395;&#23550;&#12375;&#12390;&#27161;&#28310;&#30340;&#12394;&#24931;&#32722;&#12391;&#12354;&#12427;&#12290;&#12414;&#12383;&#12289;MSRPC&#12504;&#12483;&#12480;&#12392;
MSRPC&#12487;&#12540;&#12479;&#12398;&#38291;&#12391;&#12398;4&#12496;&#12452;&#12488;&#21336;&#20301;&#22659;&#30028;&#12434;&#21547;&#12416;&#12289;MSRPC&#12504;&#12483;&#12480;&#12398;4&#12496;&#12452;&#12488;&#21336;&#20301;&#22659;&#30028;&#12392;&#12399;&#29420;&#31435;&#12375;&#12390;&#12356;&#12427;&#12290;
It is suspected that the Trans Requests will need to be at least 2-byte
aligned (probably 4-byte).  This is standard practice for SMBs.  It is also
independent of the observed 4-byte alignments with the start of the MSRPC
header, including the 4-byte alignment between the MSRPC header and the
MSRPC data.
</p><p>
&#26368;&#21021;&#12395;&#12289;IPC$&#20849;&#26377;&#12395;&#23550;&#12375;&#12390;SMBtconX&#25509;&#32154;&#12364;&#34892;&#12431;&#12428;&#12427;&#12290;&#12467;&#12493;&#12463;&#12471;&#12519;&#12531;&#12399;&#12289;&#24179;&#25991;&#12391;&#12399;&#12394;&#12367;&#12289;
&#26263;&#21495;&#21270;&#12375;&#12383;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#20351;&#12387;&#12390;&#34892;&#12431;&#12394;&#12369;&#12428;&#12400;&#12394;&#12425;&#12394;&#12356;&#12290;&#27425;&#12395;&#12289;SMBOpenX&#12364;&#12497;&#12452;&#12503;&#19978;&#12391;&#34892;&#12431;&#12428;&#12427;&#12290;
&#27425;&#12395;&#12289;Set Named Pipe Handle State&#12364;&#12289;APC&#12467;&#12510;&#12531;&#12489;&#12434;&#21463;&#12369;&#21462;&#12428;&#12427;&#12424;&#12358;&#12395;&#12497;&#12452;&#12503;&#12364;&#12394;&#12387;&#12383;&#24460;&#12395;
&#36865;&#12425;&#12428;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;&#26368;&#24460;&#12395;&#12289;SMBclose&#12364;&#36865;&#12425;&#12428;&#12427;&#12290;
</p><p>
&#35299;&#27770;&#12373;&#12428;&#12427;&#12371;&#12392;:
</p><p>
lkcl/01nov97&#12395;&#12362;&#12356;&#12390;&#12289;RPC&#12497;&#12452;&#12503;&#12398;&#12383;&#12417;&#12398;NULL&#25991;&#23383;&#12391;&#32066;&#31471;&#12375;&#12390;&#12356;&#12427;\PIPE\&#21517;&#12398;&#24460;&#12395;2&#12496;&#12452;&#12488;&#12364;
&#23384;&#22312;&#12377;&#12427;&#12424;&#12358;&#12395;&#35211;&#12360;&#12427;&#12290;&#20170;&#12398;&#12392;&#12371;&#12429;&#20998;&#12363;&#12387;&#12390;&#12356;&#12427;&#20516;&#12399;&#20197;&#19979;&#12398;&#36890;&#12426;:</p><pre class="programlisting">
        initial SMBopenX request:         RPC API command 0x26 params:
        "\\PIPE\\lsarpc"                  0x65 0x63; 0x72 0x70; 0x44 0x65;
        "\\PIPE\\srvsvc"                  0x73 0x76; 0x4E 0x00; 0x5C 0x43;
</pre></div><div class="sect2" title="&#12504;&#12483;&#12480;"><div class="titlepage"><div><div><h3 class="title"><a name="id2559082"></a>&#12504;&#12483;&#12480;</h3></div></div></div><p>[Duncan Stansfield&#12395;&#12424;&#12427;&#20316;&#26989;&#12434;&#21463;&#12369;&#21462;&#12387;&#12383;&#24460;&#12289;&#12371;&#12398;&#31680;&#12399;&#26360;&#12365;&#30452;&#12373;&#12428;&#12427;&#20104;&#23450;]</p><p>&#33288;&#21619;&#28145;&#12356;&#27880;&#24847;:&#12418;&#12375;&#12418;&#12289;&#12497;&#12483;&#12463;&#12373;&#12428;&#12383;&#12487;&#12540;&#12479;&#12434;0x0100 0000&#12392;&#35373;&#23450;&#12375;&#12383;&#22580;&#21512;&#12289;
&#12377;&#12409;&#12390;&#12398;4&#12496;&#12452;&#12488;&#12392;2&#12496;&#12452;&#12488;&#12527;&#12540;&#12489;&#12398;&#38918;&#30058;&#12399;&#36870;&#36578;&#12377;&#12427;!</p><p>NTLSA&#12392;NETLOGON&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;&#12398;&#12362;&#12398;&#12362;&#12398;&#12398;&#38283;&#22987;&#12399;&#12289;&#20197;&#19979;&#12391;&#22987;&#12414;&#12427;:</p><div class="segmentedlist"><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>00</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT8</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>5 - RPC major version</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>01</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT8</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>0 - RPC minor version</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>02</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT8</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>2 - RPC response packet</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>03</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT8</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>3 - (FirstFrag bit-wise or with LastFrag)</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>04</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT32</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>0x1000 0000 - packed data representation</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>08</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT16</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>fragment length - data size (bytes) inc header and tail.</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>0A</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT16</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>0 - authentication length </div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>0C</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT32</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>call identifier. matches 12th UINT32 of incoming RPC data.</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>10</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT32</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>allocation hint - data size (bytes) minus header and tail.</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>14</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT16</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>0 - presentation context identifier</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>16</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT8</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>0 - cancel count</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>17</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>UINT8</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>in replies: 0 - reserved; in requests: opnum - see #defines.</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">&#12458;&#12501;&#12475;&#12483;&#12488;: </span></strong>18</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12479;&#12452;&#12503;: </span></strong>......</div><div class="seg"><strong><span class="segtitle">&#22793;&#25968;&#12398;&#12487;&#12540;&#12479;: </span></strong>start of data (goes on for allocation_hint bytes)</div></div></div><div class="sect3" title="&#35201;&#27714;&#12289;&#12524;&#12473;&#12509;&#12531;&#12473;&#12289;&#12496;&#12452;&#12531;&#12489;&#12392;&#12496;&#12452;&#12531;&#12489;&#25215;&#35469;&#12395;&#23550;&#12377;&#12427;RPC_Packet"><div class="titlepage"><div><div><h4 class="title"><a name="id2559235"></a>&#35201;&#27714;&#12289;&#12524;&#12473;&#12509;&#12531;&#12473;&#12289;&#12496;&#12452;&#12531;&#12489;&#12392;&#12496;&#12452;&#12531;&#12489;&#25215;&#35469;&#12395;&#23550;&#12377;&#12427;RPC_Packet</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT8 versionmaj</span></dt><dd><p>reply same as request (0x05)</p></dd><dt><span class="term">UINT8 versionmin</span></dt><dd><p>reply same as request (0x00)</p></dd><dt><span class="term">UINT8 type</span></dt><dd><p>one of the MSRPC_Type enums</p></dd><dt><span class="term">UINT8 flags</span></dt><dd><p>reply same as request (0x00 for Bind, 0x03 for Request)</p></dd><dt><span class="term">UINT32 representation</span></dt><dd><p>reply same as request (0x00000010)</p></dd><dt><span class="term">UINT16 fraglength</span></dt><dd><p>the length of the data section of the SMB trans packet</p></dd><dt><span class="term">UINT16 authlength</span></dt><dd><p></p></dd><dt><span class="term">UINT32 callid</span></dt><dd><p>call identifier. (e.g. 0x00149594)</p></dd><dt><span class="term">* stub USE TvPacket</span></dt><dd><p>the remainder of the packet depending on the "type"</p></dd></dl></div></div><div class="sect3" title="&#12452;&#12531;&#12479;&#12501;&#12455;&#12540;&#12473;&#35672;&#21029;"><div class="titlepage"><div><div><h4 class="title"><a name="id2559338"></a>&#12452;&#12531;&#12479;&#12501;&#12455;&#12540;&#12473;&#35672;&#21029;</h4></div></div></div><p>&#12452;&#12531;&#12479;&#12501;&#12455;&#12540;&#12473;&#12395;&#12399;&#30058;&#21495;&#12364;&#20184;&#12369;&#12425;&#12428;&#12390;&#12356;&#12427;&#12290;&#21516;&#12376;&#12497;&#12452;&#12503;&#21517;srvsvc&#19978;&#12391;1&#12388;&#12424;&#12426;&#22810;&#12356;
&#12452;&#12531;&#12479;&#12501;&#12455;&#12540;&#12473;&#12434;&#20351;&#12358;&#22580;&#38754;&#12395;&#12399;&#12414;&#12384;&#20986;&#20250;&#12387;&#12383;&#12371;&#12392;&#12364;&#12394;&#12356;&#12290;</p><pre class="programlisting">
abstract (0x4B324FC8, 0x01D31670, 0x475A7812, 0x88E16EBF, 0x00000003)
transfer (0x8A885D04, 0x11C91CEB, 0x0008E89F, 0x6048102B, 0x00000002)
</pre></div><div class="sect3" title="RPC_Iface RW"><div class="titlepage"><div><div><h4 class="title"><a name="id2559360"></a>RPC_Iface RW</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT8 byte[16]</span></dt><dd><p>16 bytes of number</p></dd><dt><span class="term">UINT32 version</span></dt><dd><p>the interface number</p></dd></dl></div></div><div class="sect3" title="RPC_ReqBind RW"><div class="titlepage"><div><div><h4 class="title"><a name="id2559389"></a>RPC_ReqBind RW</h4></div></div></div><p>"&#12479;&#12452;&#12503;"&#12364;&#12524;&#12473;&#12509;&#12531;&#12473;&#12504;&#12483;&#12480;&#12398;BIND&#12391;&#12354;&#12387;&#12383;&#22580;&#21512;&#12289;&#12504;&#12483;&#12480;&#12398;&#24460;&#12398;&#12497;&#12465;&#12483;&#12488;&#12398;&#27531;&#12426;&#12398;
"&#12479;&#12452;&#12503;"&#12399;&#12289;BindAck&#12391;&#12354;&#12427;&#12409;&#12365;&#12391;&#12354;&#12427;&#12290;</p><div class="variablelist"><dl><dt><span class="term">UINT16 maxtsize</span></dt><dd><p>maximum transmission fragment size (0x1630)</p></dd><dt><span class="term">UINT16 maxrsize</span></dt><dd><p>max receive fragment size (0x1630)</p></dd><dt><span class="term">UINT32 assocgid</span></dt><dd><p>associated group id (0x0)</p></dd><dt><span class="term">UINT32 numelements</span></dt><dd><p>the number of elements (0x1)</p></dd><dt><span class="term">UINT16 contextid</span></dt><dd><p>presentation context identifier (0x0)</p></dd><dt><span class="term">UINT8 numsyntaxes</span></dt><dd><p>the number of syntaxes (has always been 1?)(0x1)</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>4-byte alignment padding, against SMB header</p></dd><dt><span class="term">* abstractint USE RPC_Iface</span></dt><dd><p>num and vers. of interface client is using</p></dd><dt><span class="term">* transferint USE RPC_Iface</span></dt><dd><p>num and vers. of interface to use for replies</p></dd></dl></div></div><div class="sect3" title="RPC_Address RW"><div class="titlepage"><div><div><h4 class="title"><a name="id2559501"></a>RPC_Address RW</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT16 length</span></dt><dd><p>length of the string including null terminator</p></dd><dt><span class="term">* port USE string</span></dt><dd><p>the string above in single byte, null terminated form</p></dd></dl></div></div><div class="sect3" title="RPC_ResBind RW"><div class="titlepage"><div><div><h4 class="title"><a name="id2559532"></a>RPC_ResBind RW</h4></div></div></div><p>&#12522;&#12503;&#12521;&#12452;&#12497;&#12465;&#12483;&#12488;&#20013;&#12391;&#12504;&#12483;&#12480;&#12398;&#24460;&#12395;&#37197;&#32622;&#12373;&#12428;&#12427;&#12524;&#12473;&#12509;&#12531;&#12473;</p><div class="variablelist"><dl><dt><span class="term">UINT16 maxtsize</span></dt><dd><p>same as request</p></dd><dt><span class="term">UINT16 maxrsize</span></dt><dd><p>same as request</p></dd><dt><span class="term">UINT32 assocgid</span></dt><dd><p>zero</p></dd><dt><span class="term">* secondaddr USE RPC_Address</span></dt><dd><p>the address string, as described earlier</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>4-byte alignment padding, against SMB header</p></dd><dt><span class="term">UINT8 numresults</span></dt><dd><p>the number of results (0x01)</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>4-byte alignment padding, against SMB header</p></dd><dt><span class="term">UINT16 result</span></dt><dd><p>result (0x00 = accept)</p></dd><dt><span class="term">UINT16 reason</span></dt><dd><p>reason (0x00 = no reason specified)</p></dd><dt><span class="term">* transfersyntax USE RPC_Iface</span></dt><dd><p>the transfer syntax from the request</p></dd></dl></div></div><div class="sect3" title="RPC_ReqNorm RW"><div class="titlepage"><div><div><h4 class="title"><a name="id2559648"></a>RPC_ReqNorm RW</h4></div></div></div><p>
&#12377;&#12409;&#12390;&#12398;&#20182;&#12398;&#12497;&#12465;&#12483;&#12488;&#12398;&#12383;&#12417;&#12398;&#12504;&#12483;&#12480;&#12398;&#24460;&#12398;&#12497;&#12465;&#12483;&#12488;&#12398;&#27531;&#12426;</p><div class="variablelist"><dl><dt><span class="term">UINT32 allochint</span></dt><dd><p>the size of the stub data in bytes</p></dd><dt><span class="term">UINT16 prescontext</span></dt><dd><p>presentation context identifier (0x0)</p></dd><dt><span class="term">UINT16 opnum</span></dt><dd><p>operation number (0x15)</p></dd><dt><span class="term">* stub USE TvPacket</span></dt><dd><p>a packet dependent on the pipe name (probably the interface) and the op number)</p></dd></dl></div></div><div class="sect3" title="RPC_ResNorm RW"><div class="titlepage"><div><div><h4 class="title"><a name="id2559705"></a>RPC_ResNorm RW</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32 allochint</span></dt><dd><p># size of the stub data in bytes</p></dd><dt><span class="term">UINT16 prescontext</span></dt><dd><p># presentation context identifier (same as request)</p></dd><dt><span class="term">UINT8 cancelcount</span></dt><dd><p># cancel count? (0x0)</p></dd><dt><span class="term">UINT8 reserved</span></dt><dd><p># 0 - one byte padding</p></dd><dt><span class="term">* stub USE TvPacket</span></dt><dd><p># the remainder of the reply</p></dd></dl></div></div></div><div class="sect2" title="Tail"><div class="titlepage"><div><div><h3 class="title"><a name="id2559766"></a>Tail</h3></div></div></div><p>&#20197;&#19979;&#12391;&#32066;&#12431;&#12427;&#12289;&#21508;NTLSA&#12392;NETLOGON&#21517;&#21069;&#12388;&#12365;&#12497;&#12452;&#12503;&#12398;&#32066;&#20102;&#37096;&#20998;:</p><div class="variablelist"><dl><dt><span class="term">......</span></dt><dd><p>end of data</p></dd><dt><span class="term">UINT32</span></dt><dd><p>return code</p></dd></dl></div></div><div class="sect2" title="RPC Bind / Bind Ack"><div class="titlepage"><div><div><h3 class="title"><a name="id2559802"></a>RPC Bind / Bind Ack</h3></div></div></div><p>
RPC&#12496;&#12452;&#12531;&#12489;&#12399;&#12289;&#12354;&#12427;RPC&#12497;&#12452;&#12503;(&#20363;&#12360;&#12400;\PIPE\lsarpc)&#12392;"transfer syntax"(RPC_Iface
&#27083;&#36896;&#20307;&#12434;&#21442;&#29031;)&#12434;&#38306;&#36899;&#12389;&#12369;&#12427;&#25163;&#32154;&#12365;&#12391;&#12354;&#12427;&#12290;&#12371;&#12428;&#12434;&#34892;&#12358;&#30446;&#30340;&#12399;&#19981;&#26126;&#12391;&#12354;&#12427;&#12290;
</p><p><span class="emphasis"><em>Note: The RPC_ResBind SMB Transact request is sent with two uint16 setup parameters.  The first is 0x0026; the second is the file handle
	returned by the SMBopenX Transact response.</em></span></p><p><span class="emphasis"><em>Note:	The RPC_ResBind members maxtsize, maxrsize and assocgid are the same in the response as the same members in the RPC_ReqBind.  The
	RPC_ResBind member transfersyntax is the same in the response as
	the</em></span></p><p><span class="emphasis"><em>Note:	The RPC_ResBind response member secondaddr contains the name of what is presumed to be the service behind the RPC pipe.  The
	mapping identified so far is:</em></span></p><div class="variablelist"><dl><dt><span class="term">initial SMBopenX request:</span></dt><dd><p>RPC_ResBind response:</p></dd><dt><span class="term">"\\PIPE\\srvsvc"</span></dt><dd><p>"\\PIPE\\ntsvcs"</p></dd><dt><span class="term">"\\PIPE\\samr"</span></dt><dd><p>"\\PIPE\\lsass"</p></dd><dt><span class="term">"\\PIPE\\lsarpc"</span></dt><dd><p>"\\PIPE\\lsass"</p></dd><dt><span class="term">"\\PIPE\\wkssvc"</span></dt><dd><p>"\\PIPE\\wksvcs"</p></dd><dt><span class="term">"\\PIPE\\NETLOGON"</span></dt><dd><p>"\\PIPE\\NETLOGON"</p></dd></dl></div><p><span class="emphasis"><em>&#27880;&#24847;: &#12496;&#12452;&#12531;&#12489;&#35201;&#27714;&#12392;&#12496;&#12452;&#12531;&#12489;&#25215;&#35469;&#12398;&#20001;&#26041;&#12395;&#12362;&#12369;&#12427;RPC_Packet fraglength  &#12513;&#12531;&#12496;&#12399;&#12289;RPC_Packet header&#12434;&#21547;&#12417;&#12390;&#12289;RPC&#12487;&#12540;&#12479;&#20840;&#20307;&#12398;&#38263;&#12373;&#12434;&#21547;&#12414;&#12394;&#12369;&#12428;&#12400;&#12394;&#12425;&#12394;&#12356;&#12290;</em></span></p><p>Request:</p><table border="0" summary="Simple list" class="simplelist"><tr><td>RPC_Packet</td></tr><tr><td>RPC_ReqBind</td></tr></table><p>Response:</p><table border="0" summary="Simple list" class="simplelist"><tr><td>RPC_Packet</td></tr><tr><td>RPC_ResBind</td></tr></table></div><div class="sect2" title="NTLSA &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;"><div class="titlepage"><div><div><h3 class="title"><a name="id2559945"></a>NTLSA &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;</h3></div></div></div><p>&#12371;&#12398;&#12497;&#12452;&#12503;&#19978;&#12391;&#21462;&#12425;&#12428;&#12427;&#21205;&#20316;&#12398;&#38918;&#30058;&#12399;&#20197;&#19979;&#12398;&#36890;&#12426;:</p><table border="0" summary="Simple list" class="simplelist"><tr><td>IPC$ share (SMBtconX)&#12408;&#12398;&#25509;&#32154;&#12434;&#30906;&#31435;&#12377;&#12427;&#12290;&#26263;&#21495;&#21270;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#20351;&#29992;&#12290;</td></tr><tr><td>"\\PIPE\\lsarpc"&#12392;&#12356;&#12358;&#21517;&#21069;&#12391;RPC&#12497;&#12452;&#12503;&#12434;&#38283;&#12367;&#12290;&#12501;&#12449;&#12452;&#12523;&#12495;&#12531;&#12489;&#12523;&#12434;&#26684;&#32013;&#12377;&#12427;&#12290;</td></tr><tr><td>&#12501;&#12449;&#12452;&#12523;&#12495;&#12531;&#12489;&#12523;&#12434;&#20351;&#12356;&#12289;Named Pipe Handle state&#12434;0x4300&#12395;&#35373;&#23450;&#12377;&#12427;&#12290;</td></tr><tr><td>LSA Open Policy&#35201;&#27714;&#12434;&#36865;&#12427;&#12290;&#12509;&#12522;&#12471;&#12540;&#12495;&#12531;&#12489;&#12523;&#12434;&#26684;&#32013;&#12377;&#12427;&#12290;</td></tr><tr><td>&#12509;&#12522;&#12471;&#12540;&#12495;&#12531;&#12489;&#12523;&#12434;&#20351;&#12356;&#12289;LSA Query Info Policy&#35201;&#27714;&#12394;&#12393;&#12434;&#36865;&#12427;&#12290;</td></tr><tr><td>&#12509;&#12522;&#12471;&#12540;&#12495;&#12531;&#12489;&#12523;&#12434;&#20351;&#12356;&#12289;LSA Close&#12434;&#36865;&#12427;&#12290;</td></tr><tr><td>IPC$&#20849;&#26377;&#12434;&#12463;&#12525;&#12540;&#12474;&#12377;&#12427;&#12290;</td></tr></table><p>&#12371;&#12398;&#12497;&#12452;&#12503;&#12398;&#23450;&#32681;&#12398;&#12383;&#12417;&#12398;&#12289;&#21839;&#12356;&#21512;&#12431;&#12379;&#12398;&#35672;&#21029;&#23376;&#12399;&#20197;&#19979;&#12398;&#36890;&#12426;:</p><div class="variablelist"><dl><dt><span class="term">LSA Open Policy:</span></dt><dd><p>0x2c</p></dd><dt><span class="term">LSA Query Info Policy:</span></dt><dd><p>0x07</p></dd><dt><span class="term">LSA Enumerate Trusted Domains:</span></dt><dd><p>0x0d</p></dd><dt><span class="term">LSA Open Secret:</span></dt><dd><p>0xff</p></dd><dt><span class="term">LSA Lookup SIDs:</span></dt><dd><p>0xfe</p></dd><dt><span class="term">LSA Lookup Names:</span></dt><dd><p>0xfd</p></dd><dt><span class="term">LSA Close:</span></dt><dd><p>0x00</p></dd></dl></div></div><div class="sect2" title="LSA&#12458;&#12540;&#12503;&#12531;&#12509;&#12522;&#12471;&#12540;"><div class="titlepage"><div><div><h3 class="title"><a name="id2560083"></a>LSA&#12458;&#12540;&#12503;&#12531;&#12509;&#12522;&#12471;&#12540;</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12509;&#12522;&#12471;&#12540;&#12495;&#12531;&#12489;&#12523;&#12399;&#12393;&#12435;&#12394;&#22909;&#12415;&#12398;&#12418;&#12398;&#12391;&#12418;&#12354;&#12426;&#24471;&#12427;&#12290;</em></span></p><div class="sect3" title="Request"><div class="titlepage"><div><div><h4 class="title"><a name="id2560095"></a>Request</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>buffer pointer</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>server name - unicode string starting with two '\'s</p></dd><dt><span class="term">OBJ_ATTR</span></dt><dd><p>object attributes</p></dd><dt><span class="term">UINT32</span></dt><dd><p>1 - desired access</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560148"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">POL_HND</span></dt><dd><p>LSA policy handle</p></dd><dt><span class="term">return</span></dt><dd><p>0 - indicates success</p></dd></dl></div></div></div><div class="sect2" title="LSA Query Info &#12509;&#12522;&#12471;&#12540;"><div class="titlepage"><div><div><h3 class="title"><a name="id2560180"></a>LSA Query Info &#12509;&#12522;&#12471;&#12540;</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;info class&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12398;&#12418;&#12398;&#12392;&#21516;&#12376;&#12391;&#12354;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560193"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">POL_HND</span></dt><dd><p>LSA policy handle</p></dd><dt><span class="term">UINT16</span></dt><dd><p>info class (also a policy handle?)</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560222"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">UINT16</span></dt><dd><p>info class (same as info class in request).</p></dd></dl></div><pre class="programlisting">
switch (info class)
case 3:
case 5:
{
DOM_INFO domain info, levels 3 and 5 (are the same).
}

return    0 - indicates success
</pre></div></div><div class="sect2" title="LSA &#12364;&#12456;&#12511;&#12517;&#12524;&#12540;&#12488;&#12377;&#12427;&#20449;&#38972;&#12377;&#12427;&#12489;&#12513;&#12452;&#12531;"><div class="titlepage"><div><div><h3 class="title"><a name="id2560264"></a>LSA &#12364;&#12456;&#12511;&#12517;&#12524;&#12540;&#12488;&#12377;&#12427;&#20449;&#38972;&#12377;&#12427;&#12489;&#12513;&#12452;&#12531;</h3></div></div></div><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560271"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><p>no extra data</p></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560281"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>0 - enumeration context</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - entries read</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - trust information</p></dd><dt><span class="term">return</span></dt><dd><p>0x8000 001a - "no trusted domains" success code</p></dd></dl></div></div></div><div class="sect2" title="LSA Open Secret"><div class="titlepage"><div><div><h3 class="title"><a name="id2560335"></a>LSA Open Secret</h3></div></div></div><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560340"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><p>no extra data</p></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560350"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>0 - undocumented</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - undocumented</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - undocumented</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - undocumented</p></dd><dt><span class="term">UINT32</span></dt><dd><p>0 - undocumented</p></dd></dl></div><p>return    0x0C00 0034 - "no such secret" success code</p></div></div><div class="sect2" title="LSA Close"><div class="titlepage"><div><div><h3 class="title"><a name="id2560418"></a>LSA Close</h3></div></div></div><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560424"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">POL_HND</span></dt><dd><p>policy handle to be closed</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560444"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">POL_HND</span></dt><dd><p>0s - closed policy handle (all zeros)</p></dd></dl></div><p>return    0 - indicates success</p></div></div><div class="sect2" title="LSA Lookup SIDS"><div class="titlepage"><div><div><h3 class="title"><a name="id2560469"></a>LSA Lookup SIDS</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;num_entries&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12398;num_entries&#12392;&#21516;&#12376;&#12391;&#12394;&#12369;&#12428;&#12400;&#12394;&#12425;&#12394;&#12356;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560480"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">POL_HND</span></dt><dd><p>LSA policy handle</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented domain SID buffer pointer</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented domain name buffer pointer</p></dd><dt><span class="term">VOID*[num_entries] undocumented domain SID pointers to be looked up.
</span></dt><dd><p>DOM_SID[num_entries] domain SIDs to be looked up.</p></dd><dt><span class="term">char[16]</span></dt><dd><p>completely undocumented 16 bytes.</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560557"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">DOM_REF</span></dt><dd><p>domain reference response</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries (listed above)</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries (listed above)</p></dd><dt><span class="term">DOM_SID2[num_entries]</span></dt><dd><p>domain SIDs (from Request, listed above).</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries (listed above)</p></dd></dl></div><p>return                0 - indicates success</p></div></div><div class="sect2" title="LSA &#12523;&#12483;&#12463;&#12450;&#12483;&#12503;&#21517;"><div class="titlepage"><div><div><h3 class="title"><a name="id2560630"></a>LSA &#12523;&#12483;&#12463;&#12450;&#12483;&#12503;&#21517;</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;num_entries&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12398;num_entries&#12392;&#21516;&#12376;&#12391;&#12394;&#12369;&#12428;&#12400;&#12394;&#12425;&#12394;&#12356;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560643"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">POL_HND</span></dt><dd><p>LSA policy handle</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented domain SID buffer pointer</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented domain name buffer pointer</p></dd><dt><span class="term">NAME[num_entries]</span></dt><dd><p>names to be looked up.</p></dd><dt><span class="term">char[]</span></dt><dd><p>undocumented bytes - falsely translated SID structure?</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560730"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">DOM_REF</span></dt><dd><p>domain reference response</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries (listed above)</p></dd><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries (listed above)</p></dd><dt><span class="term">DOM_RID[num_entries]</span></dt><dd><p>domain SIDs (from Request, listed above).</p></dd><dt><span class="term">UINT32</span></dt><dd><p>num_entries (listed above)</p></dd></dl></div><p>return                0 - indicates success</p></div></div></div><div class="sect1" title="NETLOGON rpc &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2560804"></a>NETLOGON rpc &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;</h2></div></div></div><p>&#12371;&#12398;&#12497;&#12452;&#12503;&#19978;&#12398;&#21205;&#20316;&#12398;&#38918;&#30058;&#12399;&#20197;&#19979;&#12398;&#36890;&#12426;:</p><table border="0" summary="Simple list" class="simplelist"><tr><td>IPC$ &#20849;&#26377; (SMBtconX)&#12395;&#23550;&#12375;&#12390;&#25509;&#32154;&#12434;&#30906;&#31435;&#12377;&#12427;&#12290;&#26263;&#21495;&#21270;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#20351;&#29992;&#12290;</td></tr><tr><td>"\\PIPE\\NETLOGON"&#12392;&#12356;&#12358;&#21517;&#21069;&#12391;RPC&#12497;&#12452;&#12503;&#12434;&#38283;&#12367;&#12290;&#12501;&#12449;&#12452;&#12523;&#12495;&#12531;&#12489;&#12523;&#12434;&#26684;&#32013;&#12377;&#12427;&#12290;</td></tr><tr><td>&#12501;&#12449;&#12452;&#12523;&#12495;&#12531;&#12489;&#12523;&#12434;&#20351;&#12356;&#12289;Named Pipe Handle state&#12434;0x4300&#12395;&#35373;&#23450;&#12377;&#12427;&#12290;</td></tr><tr><td>&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#29992;&#12398;&#12481;&#12515;&#12524;&#12531;&#12472;&#12487;&#12540;&#12479;&#12434;&#20316;&#25104;&#12377;&#12427;&#12290;LSA Request Challenge&#12434;&#36865;&#20449;&#12377;&#12427;&#12290;Server Challenge&#12434;&#26684;&#32013;&#12377;&#12427;&#12290;</td></tr><tr><td>&#12475;&#12483;&#12471;&#12519;&#12531;&#12461;&#12540;&#12434;&#35336;&#31639;&#12377;&#12427;&#12290;LSA Auth 2 Challenge&#12434;&#36865;&#20449;&#12377;&#12427;&#12290;Auth2 Challenge&#12434;&#26684;&#32013;&#12377;&#12427;&#12290;</td></tr><tr><td>Client Creds&#12434;&#35336;&#31639;&#12375;&#12390;&#26908;&#35388;&#12377;&#12427;&#12290;LSA Srv PW Set&#12434;&#36865;&#20449;&#12377;&#12427;&#12290;Server Creds&#12434;&#35336;&#31639;&#12289;&#26908;&#35388;&#12377;&#12427;&#12290;</td></tr><tr><td>Client Creds&#12434;&#35336;&#31639;&#12375;&#12390;&#26908;&#35388;&#12377;&#12427;&#12290;LSA Srv Logon&#12434;&#36865;&#20449;&#12377;&#12427;&#12290;Server Creds&#12434;&#35336;&#31639;&#12289;&#26908;&#35388;&#12377;&#12427;&#12290;</td></tr><tr><td>Client Creds&#12434;&#35336;&#31639;&#12375;&#12390;&#26908;&#35388;&#12377;&#12427;&#12290;LSA Srv Logoff&#12434;&#36865;&#20449;&#12377;&#12427;&#12290;Server Creds&#12434;&#35336;&#31639;&#12289;&#26908;&#35388;&#12377;&#12427;&#12290;</td></tr><tr><td>IPC$&#20849;&#26377;&#12434;&#12463;&#12525;&#12540;&#12474;&#12377;&#12427;&#12290;</td></tr></table><p>&#12371;&#12398;&#12497;&#12452;&#12503;&#12398;&#23450;&#32681;&#12398;&#12383;&#12417;&#12398;&#12289;&#21839;&#12356;&#21512;&#12431;&#12379;&#35672;&#21029;&#23376;&#12399;&#20197;&#19979;&#12398;&#36890;&#12426;</p><div class="variablelist"><dl><dt><span class="term">LSA Request Challenge:</span></dt><dd><p>0x04</p></dd><dt><span class="term">LSA Server Password Set:</span></dt><dd><p>0x06</p></dd><dt><span class="term">LSA SAM Logon:</span></dt><dd><p>0x02</p></dd><dt><span class="term">LSA SAM Logoff:</span></dt><dd><p>0x03</p></dd><dt><span class="term">LSA Auth 2:</span></dt><dd><p>0x0f</p></dd><dt><span class="term">LSA Logon Control:</span></dt><dd><p>0x0e</p></dd></dl></div><div class="sect2" title="LSA Request Challenge"><div class="titlepage"><div><div><h3 class="title"><a name="id2560948"></a>LSA Request Challenge</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12525;&#12464;&#12458;&#12531;&#12469;&#12540;&#12496;&#21517;&#12399;2&#12388;&#12398;'\'&#12391;&#22987;&#12414;&#12426;&#12289;&#22823;&#25991;&#23383;&#12391;&#12354;&#12427;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	&#12525;&#12464;&#12458;&#12531;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12399;&#12510;&#12471;&#12531;&#12391;&#12354;&#12426;&#12289;&#12518;&#12540;&#12470;&#12391;&#12399;&#12394;&#12356;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	&#12481;&#12515;&#12524;&#12531;&#12472;&#12364;&#30330;&#34892;&#12373;&#12428;&#12383;&#12418;&#12398;&#12395;&#23550;&#12377;&#12427;&#26368;&#21021;&#12398;LanManager
    &#12497;&#12473;&#12527;&#12540;&#12489;&#12495;&#12483;&#12471;&#12517;&#12399;&#12289;(&#23567;&#25991;&#23383;&#12398;)&#12510;&#12471;&#12531;&#21517;&#12381;&#12428;&#33258;&#36523;&#12391;&#12354;&#12427;&#12290;&#12354;&#12392;&#12391;&#12289;&#12371;&#12428;&#12434;&#22793;&#26356;&#12377;&#12427;&#12391;&#12354;&#12429;&#12358;
    &#21628;&#12403;&#20986;&#12375;(LSA Server Password Set)&#12364;&#30330;&#34892;&#12373;&#12428;&#12427;&#12391;&#12354;&#12429;&#12358;&#12290;&#12371;&#12428;&#12425;&#12398;&#21628;&#12403;&#20986;&#12375;&#12434;&#25233;&#21046;&#12377;&#12427;&#12392;&#12289;
    &#24120;&#26178;&#21516;&#12376;&#12497;&#12473;&#12527;&#12540;&#12489;&#12391;&#25201;&#12358;&#12371;&#12392;&#12364;&#20986;&#26469;&#12427;&#12424;&#12358;&#12395;&#12394;&#12427;(&#12377;&#12394;&#12431;&#12385;&#12289;&#23567;&#25991;&#23383;&#12391;&#12398;&#12510;&#12471;&#12531;&#21517;&#12398;LM#)&#12290;
    </em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2560984"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon server unicode string</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>logon client unicode string</p></dd><dt><span class="term">char[8]</span></dt><dd><p>client challenge</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561037"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">char[8]</span></dt><dd><p>server challenge</p></dd></dl></div><p>return    0 - indicates success</p></div></div><div class="sect2" title="LSA Authenticate 2"><div class="titlepage"><div><div><h3 class="title"><a name="id2561062"></a>LSA Authenticate 2</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12522;&#12463;&#12456;&#12473;&#12488;&#12392;&#12524;&#12473;&#12509;&#12531;&#12473;&#12398;&#38291;&#12391;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12398;&#35469;&#35388;&#24773;&#22577;&#12434;&#35336;&#31639;&#12375;&#12289;
    &#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12364;&#35336;&#31639;&#12375;&#12383;&#35469;&#35388;&#24773;&#22577;&#12392;&#27604;&#36611;&#12377;&#12427;(&#12371;&#12398;&#25163;&#32154;&#12365;&#12399;&#20197;&#21069;&#12395;&#21463;&#12369;&#21462;&#12387;&#12383;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12398;
    &#35469;&#35388;&#24773;&#22577;&#12434;&#20351;&#12358;)&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	&#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;neg_flags&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12398;&#12418;&#12398;&#12392;&#21516;&#12376;&#12391;&#12354;&#12427;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	&#12381;&#12398;&#12354;&#12392;&#12398;&#35469;&#35388;&#12497;&#12465;&#12483;&#12488;&#20013;&#12391;&#20351;&#12431;&#12428;&#12427;&#12392;&#12356;&#12358;&#29702;&#30001;&#12391;&#12289;&#12371;&#12371;&#12391;&#21463;&#12369;&#21462;&#12387;&#12383;
    &#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12364;&#35336;&#31639;&#12375;&#12383;&#35469;&#35388;&#24773;&#22577;&#12398;&#12467;&#12500;&#12540;&#12434;&#21462;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561089"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">LOG_INFO</span></dt><dd><p>client identification info</p></dd><dt><span class="term">char[8]</span></dt><dd><p>client-calculated credentials</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>padding to 4-byte align with start of SMB header.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>neg_flags - negotiated flags (usual value is 0x0000 01ff)</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561142"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">char[8]</span></dt><dd><p>server credentials.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>neg_flags - same as neg_flags in request.</p></dd></dl></div><p>return    0 - indicates success.  failure value unknown.</p></div></div><div class="sect2" title="LSA Server Password Set"><div class="titlepage"><div><div><h3 class="title"><a name="id2561179"></a>LSA Server Password Set</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;: &#26032;&#12375;&#12356;&#12497;&#12473;&#12527;&#12540;&#12489;&#12399;&#12461;&#12540;&#12434;&#29983;&#25104;&#12377;&#12427;&#12383;&#12417;&#12395;&#21476;&#12356;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#20351;&#12387;&#12390;
    DES&#26263;&#21495;&#21270;&#12434;&#20351;&#12358;&#12371;&#12392;&#12364;&#25512;&#28204;&#12373;&#12428;&#12427;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;: &#12522;&#12463;&#12456;&#12473;&#12488;&#12392;&#12524;&#12473;&#12509;&#12531;&#12473;&#12398;&#38291;&#12391;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#35469;&#35388;&#24773;&#22577;&#12434;&#35336;&#31639;&#12375;&#12289;
    &#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12364;&#35336;&#31639;&#12375;&#12383;&#35469;&#35388;&#24773;&#22577;&#12392;&#27604;&#36611;&#12377;&#12427;(&#12371;&#12398;&#25163;&#32154;&#12365;&#12399;&#20197;&#21069;&#12395;&#21463;&#12369;&#21462;&#12387;&#12383;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12398;
    &#35469;&#35388;&#24773;&#22577;&#12434;&#20351;&#12358;)&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;: &#12469;&#12540;&#12496;&#12398;&#35469;&#35388;&#24773;&#22577;&#12399;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12364;&#35336;&#31639;&#12375;&#12383;&#35469;&#35388;&#24773;&#22577;&#12392;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#26178;&#38291;+1&#31186;&#12363;&#12425;&#27083;&#31689;&#12373;&#12428;&#12427;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;: &#12381;&#12398;&#12354;&#12392;&#12398;&#35469;&#35388;&#12497;&#12465;&#12483;&#12488;&#20013;&#12391;&#20351;&#12431;&#12428;&#12427;&#12392;&#12356;&#12358;&#29702;&#30001;&#12391;&#12289;&#12371;&#12371;&#12391;&#21463;&#12369;&#21462;&#12387;&#12383;
    &#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12364;&#35336;&#31639;&#12375;&#12383;&#35469;&#35388;&#24773;&#22577;&#12398;&#12467;&#12500;&#12540;&#12434;&#21462;&#12427;&#24517;&#35201;&#12364;&#12354;&#12427;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561214"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">CLNT_INFO</span></dt><dd><p>client identification/authentication info</p></dd><dt><span class="term">char[]</span></dt><dd><p>new password - undocumented.</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561247"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">CREDS</span></dt><dd><p>server credentials.  server time stamp appears to be ignored.</p></dd></dl></div><p>return    0 - indicates success; 0xC000 006a indicates failure</p></div></div><div class="sect2" title="LSA SAM Logon"><div class="titlepage"><div><div><h3 class="title"><a name="id2561274"></a>LSA SAM Logon</h3></div></div></div><p><span class="emphasis"><em>
&#27880;&#24847;:	valid_user &#12399;&#12289;&#12418;&#12375;&#12418;&#12518;&#12540;&#12470;&#21517;&#12392;&#12497;&#12473;&#12527;&#12540;&#12489;&#12495;&#12483;&#12471;&#12517;&#12364;&#12289;&#35201;&#27714;&#12373;&#12428;&#12383;&#12489;&#12513;&#12452;&#12531;&#12395;&#23550;&#12375;&#12390;
     &#26377;&#21177;&#12394;&#12425;&#12400;&#12289;True&#12391;&#12354;&#12427;&#12290;
</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561289"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">SAM_INFO</span></dt><dd><p>sam_id structure</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561309"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">CREDS</span></dt><dd><p>server credentials.  server time stamp appears to be ignored.</p></dd></dl></div><pre class="programlisting">
if (valid_user)
{
	UINT16      3 - switch value indicating USER_INFO structure.
    VOID*     non-zero - pointer to USER_INFO structure
    USER_INFO user logon information

    UINT32    1 - Authoritative response; 0 - Non-Auth?

    return    0 - indicates success
}
else
{
	UINT16    0 - switch value.  value to indicate no user presumed.
    VOID*     0x0000 0000 - indicates no USER_INFO structure.

    UINT32    1 - Authoritative response; 0 - Non-Auth?

    return    0xC000 0064 - NT_STATUS_NO_SUCH_USER.
}
</pre></div></div><div class="sect2" title="LSA SAM Logoff"><div class="titlepage"><div><div><h3 class="title"><a name="id2561358"></a>LSA SAM Logoff</h3></div></div></div><p><span class="emphasis"><em>
&#27880;&#24847;:	&#12362;&#12381;&#12425;&#12367;&#12289;SAM_INFO&#27083;&#36896;&#20307;&#12399;&#26908;&#35388;&#12373;&#12428;&#12289;Logoff&#12364;&#19981;&#27491;&#12394;&#22580;&#21512;&#12289;
	(&#29694;&#22312;&#25991;&#26360;&#21270;&#12373;&#12428;&#12390;&#12356;&#12394;&#12356;)&#12456;&#12521;&#12540;&#12467;&#12540;&#12489;&#12364;&#36820;&#12373;&#12428;&#12427;&#12290;
</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561373"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">SAM_INFO</span></dt><dd><p>sam_id structure</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561393"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>undocumented buffer pointer</p></dd><dt><span class="term">CREDS</span></dt><dd><p>server credentials.  server time stamp appears to be ignored.</p></dd></dl></div><p>return      0 - indicates success.  undocumented failure indication.</p></div></div></div><div class="sect1" title="\\MAILSLOT\NET\NTLOGON"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2561432"></a>\\MAILSLOT\NET\NTLOGON</h2></div></div></div><p><span class="emphasis"><em>
&#27880;&#24847;:	mailslots&#12399;&#12524;&#12473;&#12509;&#12531;&#12473;mailslot&#12434;&#21547;&#12415;&#12289;&#12381;&#12428;&#12399;&#36865;&#20449;&#12373;&#12428;&#12427;&#12409;&#12365;&#12524;&#12473;&#12509;&#12531;&#12473;&#12391;&#12354;&#12427;&#12290;
	&#12479;&#12540;&#12466;&#12483;&#12488;&#12398;NetBIOS&#21517;&#12399;REQUEST_NAME&lt;20&gt;&#12391;&#12354;&#12426;&#12289;&#12371;&#12371;&#12391;&#12289;REQUEST_NAME
	&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#12434;&#36865;&#20449;&#12375;&#12383;&#12510;&#12471;&#12531;&#12398;&#21517;&#21069;&#12391;&#12354;&#12427;&#12290;
</em></span></p><div class="sect2" title="PDC&#12398;&#12383;&#12417;&#12398;&#12463;&#12456;&#12522;"><div class="titlepage"><div><div><h3 class="title"><a name="id2561447"></a>PDC&#12398;&#12383;&#12417;&#12398;&#12463;&#12456;&#12522;</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;NTversion, LMNTtoken, LM20token&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12391;&#19982;&#12360;&#12425;&#12428;&#12383;&#12418;&#12398;&#12392;&#21516;&#12376;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561460"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT16</span></dt><dd><p>0x0007 - Query for PDC</p></dd><dt><span class="term">STR</span></dt><dd><p>machine name</p></dd><dt><span class="term">STR</span></dt><dd><p>response mailslot</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>padding to 2-byte align with start of mailslot.</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>machine name</p></dd><dt><span class="term">UINT32</span></dt><dd><p>NTversion</p></dd><dt><span class="term">UINT16</span></dt><dd><p>LMNTtoken</p></dd><dt><span class="term">UINT16</span></dt><dd><p>LM20token</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561555"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT16</span></dt><dd><p>0x000A - Respose to Query for PDC</p></dd><dt><span class="term">STR</span></dt><dd><p>machine name (in uppercase)</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>padding to 2-byte align with start of mailslot.</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>machine name</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>domain name</p></dd><dt><span class="term">UINT32</span></dt><dd><p>NTversion (same as received in request)</p></dd><dt><span class="term">UINT16</span></dt><dd><p>LMNTtoken (same as received in request)</p></dd><dt><span class="term">UINT16</span></dt><dd><p>LM20token (same as received in request)</p></dd></dl></div></div></div><div class="sect2" title="SAM Logon"><div class="titlepage"><div><div><h3 class="title"><a name="id2561649"></a>SAM Logon</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;: &#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;&#12510;&#12471;&#12531;&#21517;&#12399;&#20808;&#38957;&#12395;2&#12388;&#12398;'\'&#12364;&#20184;&#12367;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	&#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;NTversion, LMNTtoken, LM20token&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12398;&#12418;&#12398;&#12392;&#21516;&#12376;&#12391;&#12354;&#12427;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	&#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;&#12518;&#12540;&#12470;&#21517;&#12399;&#12362;&#12381;&#12425;&#12367;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12398;&#12418;&#12398;&#12392;&#21516;&#12376;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561672"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT16</span></dt><dd><p>0x0012 - SAM Logon</p></dd><dt><span class="term">UINT16</span></dt><dd><p>request count</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>machine name</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>user name</p></dd><dt><span class="term">STR</span></dt><dd><p>response mailslot</p></dd><dt><span class="term">UINT32</span></dt><dd><p>alloweable account</p></dd><dt><span class="term">UINT32</span></dt><dd><p>domain SID size</p></dd><dt><span class="term">char[sid_size]</span></dt><dd><p>domain SID, of sid_size bytes.</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>???? padding to 4? 2? -byte align with start of mailslot.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>NTversion</p></dd><dt><span class="term">UINT16</span></dt><dd><p>LMNTtoken</p></dd><dt><span class="term">UINT16</span></dt><dd><p>LM20token</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561812"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT16</span></dt><dd><p>0x0013 - Response to SAM Logon</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>machine name</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>user name - workstation trust account</p></dd><dt><span class="term">UNISTR</span></dt><dd><p>domain name </p></dd><dt><span class="term">UINT32</span></dt><dd><p>NTversion</p></dd><dt><span class="term">UINT16</span></dt><dd><p>LMNTtoken</p></dd><dt><span class="term">UINT16</span></dt><dd><p>LM20token</p></dd></dl></div></div></div></div><div class="sect1" title="SRVSVC &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2561900"></a>SRVSVC &#12488;&#12521;&#12531;&#12470;&#12463;&#12471;&#12519;&#12531;&#21517;&#21069;&#20184;&#12365;&#12497;&#12452;&#12503;</h2></div></div></div><p>&#12371;&#12398;&#12497;&#12452;&#12503;&#12398;&#12383;&#12417;&#12398;&#23450;&#32681;&#12391;&#12289;&#12463;&#12456;&#12522;&#12398;&#35672;&#21029;&#12399;&#20197;&#19979;&#12398;&#36890;&#12426;:</p><div class="variablelist"><dl><dt><span class="term">Net Share Enum</span></dt><dd><p>0x0f</p></dd><dt><span class="term">Net Server Get Info</span></dt><dd><p>0x15</p></dd></dl></div><div class="sect2" title="Net Share Enum"><div class="titlepage"><div><div><h3 class="title"><a name="id2561936"></a>Net Share Enum</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	&#12524;&#12473;&#12509;&#12531;&#12473;&#20013;&#12398;&#12473;&#12452;&#12483;&#12481;&#12398;&#20516;&#12392;&#20849;&#26377;&#12524;&#12505;&#12523;&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12398;&#12418;&#12398;&#12392;&#12362;&#12381;&#12425;&#12367;&#21516;&#12376;&#12391;&#12354;&#12427;&#12290;</em></span></p><p><span class="emphasis"><em>&#27880;&#24847;:	cifsrap2.txt (section 5)&#12399;&#12371;&#12371;&#12391;&#12289;&#38480;&#23450;&#30340;&#12395;&#25163;&#21161;&#12369;&#12392;&#12394;&#12427;&#12363;&#12418;&#12375;&#12428;&#12394;&#12356;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2561954"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">VOID*</span></dt><dd><p>pointer (to server name?)</p></dd><dt><span class="term">UNISTR2</span></dt><dd><p>server name</p></dd><dt><span class="term">UINT8[]</span></dt><dd><p>padding to get unicode string 4-byte aligned with the start of the SMB header.</p></dd><dt><span class="term">UINT32</span></dt><dd><p>share level</p></dd><dt><span class="term">UINT32</span></dt><dd><p>switch value</p></dd><dt><span class="term">VOID*</span></dt><dd><p>pointer to SHARE_INFO_1_CTR</p></dd><dt><span class="term">SHARE_INFO_1_CTR</span></dt><dd><p>share info with 0 entries</p></dd><dt><span class="term">UINT32</span></dt><dd><p>preferred maximum length (0xffff ffff)</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2562049"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>share level</p></dd><dt><span class="term">UINT32</span></dt><dd><p>switch value</p></dd><dt><span class="term">VOID*</span></dt><dd><p>pointer to SHARE_INFO_1_CTR</p></dd><dt><span class="term">SHARE_INFO_1_CTR</span></dt><dd><p>share info (only added if share info ptr is non-zero)</p></dd></dl></div><p>return            0 - indicates success</p></div></div><div class="sect2" title="Net Server Get Info"><div class="titlepage"><div><div><h3 class="title"><a name="id2562105"></a>Net Server Get Info</h3></div></div></div><p><span class="emphasis"><em>&#27880;&#24847;:	level&#12399;&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12398;&#12418;&#12398;&#12392;&#21516;&#12376;&#12391;&#12354;&#12427;&#12290;</em></span></p><div class="sect3" title="&#12522;&#12463;&#12456;&#12473;&#12488;"><div class="titlepage"><div><div><h4 class="title"><a name="id2562116"></a>&#12522;&#12463;&#12456;&#12473;&#12488;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UNISTR2</span></dt><dd><p>server name</p></dd><dt><span class="term">UINT32</span></dt><dd><p>switch level</p></dd></dl></div></div><div class="sect3" title="&#12524;&#12473;&#12509;&#12531;&#12473;"><div class="titlepage"><div><div><h4 class="title"><a name="id2562147"></a>&#12524;&#12473;&#12509;&#12531;&#12473;</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">UINT32</span></dt><dd><p>switch level</p></dd><dt><span class="term">VOID*</span></dt><dd><p>pointer to SERVER_INFO_101</p></dd><dt><span class="term">SERVER_INFO_101</span></dt><dd><p>server info (only added if server info ptr is non-zero)</p></dd></dl></div><p>return            0 - indicates success</p></div></div></div><div class="sect1" title="NT&#12489;&#12513;&#12452;&#12531;&#35469;&#35388;&#12395;&#12362;&#12369;&#12427;&#26263;&#21495;&#21270;&#12398;&#20596;&#38754;"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2562195"></a>NT&#12489;&#12513;&#12452;&#12531;&#35469;&#35388;&#12395;&#12362;&#12369;&#12427;&#26263;&#21495;&#21270;&#12398;&#20596;&#38754;</h2></div></div></div><div class="sect2" title="&#23450;&#32681;"><div class="titlepage"><div><div><h3 class="title"><a name="id2562202"></a>&#23450;&#32681;</h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Add(A1,A2)</span></dt><dd><p>Intel byte ordered addition of corresponding 4 byte words in arrays A1 and A2</p></dd><dt><span class="term">E(K,D)</span></dt><dd><p>DES ECB encryption of 8 byte data D using 7 byte key K</p></dd><dt><span class="term">lmowf()</span></dt><dd><p>Lan man hash</p></dd><dt><span class="term">ntowf()</span></dt><dd><p>NT hash</p></dd><dt><span class="term">PW</span></dt><dd><p>md4(machine_password) == md4(lsadump $machine.acc) ==
pwdump(machine$) (initially) == md4(lmowf(unicode(machine)))
</p></dd><dt><span class="term">ARC4(K,Lk,D,Ld)</span></dt><dd><p>ARC4 encryption of data D of length Ld with key K of length Lk</p></dd><dt><span class="term">v[m..n(,l)]</span></dt><dd><p>subset of v from bytes m to n, optionally padded with zeroes to length l</p></dd><dt><span class="term">Cred(K,D)</span></dt><dd><p>E(K[7..7,7],E(K[0..6],D)) computes a credential</p></dd><dt><span class="term">Time()</span></dt><dd><p>4 byte current time</p></dd><dt><span class="term">Cc,Cs</span></dt><dd><p>8 byte client and server challenges Rc,Rs: 8 byte client and server credentials</p></dd></dl></div></div><div class="sect2" title="&#12503;&#12525;&#12488;&#12467;&#12523;"><div class="titlepage"><div><div><h3 class="title"><a name="id2562328"></a>&#12503;&#12525;&#12488;&#12467;&#12523;</h3></div></div></div><pre class="programlisting">
C-&gt;S ReqChal,Cc
S-&gt;C Cs
</pre><pre class="programlisting">
C &amp; S compute session key Ks = E(PW[9..15],E(PW[0..6],Add(Cc,Cs)))
</pre><pre class="programlisting">
C: Rc = Cred(Ks,Cc)
C-&gt;S Authenticate,Rc
S: Rs = Cred(Ks,Cs), assert(Rc == Cred(Ks,Cc))
S-&gt;C Rs
C: assert(Rs == Cred(Ks,Cs))
</pre><p>
&#12489;&#12513;&#12452;&#12531;&#12408;&#12398;&#21442;&#21152;&#12395;&#12362;&#12356;&#12390;&#12289;&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12399;&#12458;&#12503;&#12471;&#12519;&#12531;&#12392;&#12375;&#12390;&#12381;&#12398;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#22793;&#26356;&#12375;&#12424;&#12358;&#12392;
&#12375;&#12289;&#12489;&#12513;&#12452;&#12531;&#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12399;&#12524;&#12472;&#12473;&#12488;&#12522;&#12398;&#35373;&#23450;&#12395;&#20381;&#23384;&#12375;&#12390;&#12289;&#12381;&#12398;&#26356;&#26032;&#12434;&#25233;&#21046;&#12377;&#12427;&#12363;&#12418;&#12375;&#12428;&#12394;&#12356;&#12290;
&#12371;&#12428;&#12399;&#20197;&#38477;&#27598;&#36913;&#27598;&#12395;&#36215;&#12365;&#12427;&#12391;&#12354;&#12429;&#12358;&#12290;
</p><pre class="programlisting">
C: Tc = Time(), Rc' = Cred(Ks,Rc+Tc)
C-&gt;S ServerPasswordSet,Rc',Tc,arc4(Ks[0..7,16],lmowf(randompassword())
C: Rc = Cred(Ks,Rc+Tc+1)
S: assert(Rc' == Cred(Ks,Rc+Tc)), Ts = Time()
S: Rs' = Cred(Ks,Rs+Tc+1)
S-&gt;C Rs',Ts
C: assert(Rs' == Cred(Ks,Rs+Tc+1))
S: Rs = Rs'
</pre><p>
&#12518;&#12540;&#12470;: &#12497;&#12473;&#12527;&#12540;&#12489;&#12364;P&#12398;&#12518;&#12540;&#12470;U&#12399;&#12489;&#12513;&#12452;&#12531;&#12395;&#12525;&#12464;&#12458;&#12531;&#12375;&#12424;&#12358;&#12392;&#12377;&#12427;(&#12527;&#12540;&#12463;&#12473;&#12486;&#12540;&#12471;&#12519;&#12531;&#12392;
&#12489;&#12513;&#12452;&#12531;&#12398;&#12424;&#12358;&#12394;&#20184;&#38543;&#30340;&#12394;&#12487;&#12540;&#12479;&#12399;&#30465;&#30053;&#12373;&#12428;&#12427;)
</p><pre class="programlisting">
C: Tc = Time(), Rc' = Cred(Ks,Rc+Tc)
C-&gt;S NetLogonSamLogon,Rc',Tc,U,arc4(Ks[0..7,16],16,ntowf(P),16), arc4(Ks[0..7,16],16,lmowf(P),16)
S: assert(Rc' == Cred(Ks,Rc+Tc)) assert(passwords match those in SAM)
S: Ts = Time()
</pre><pre class="programlisting">
S-&gt;C Cred(Ks,Cred(Ks,Rc+Tc+1)),userinfo(logon script,UID,SIDs,etc)
C: assert(Rs == Cred(Ks,Cred(Rc+Tc+1))
C: Rc = Cred(Ks,Rc+Tc+1)
</pre></div><div class="sect2" title="&#12467;&#12513;&#12531;&#12488;"><div class="titlepage"><div><div><h3 class="title"><a name="id2562418"></a>&#12467;&#12513;&#12531;&#12488;</h3></div></div></div><p>
&#26368;&#21021;&#12398;&#12489;&#12513;&#12452;&#12531;&#12408;&#12398;&#21442;&#21152;&#12395;&#12362;&#12356;&#12390;&#12289;&#12510;&#12471;&#12531;&#12497;&#12473;&#12527;&#12540;&#12489;&#12364;&#12424;&#12367;&#30693;&#12425;&#12428;&#12383;&#20516;&#12391;&#12354;&#12427;&#12424;&#12358;&#12395;&#12289;
&#12475;&#12483;&#12471;&#12519;&#12531;&#12461;&#12540;&#12399;&#12289;&#12493;&#12483;&#12488;&#12527;&#12540;&#12463;&#19978;&#12391;&#30423;&#32884;&#12375;&#12390;&#12356;&#12427;&#35504;&#12395;&#12391;&#12418;&#12289;&#35336;&#31639;&#12377;&#12427;&#12371;&#12392;&#12364;&#20986;&#26469;&#12383;&#12290;
&#12510;&#12471;&#12531;&#12364;&#12522;&#12502;&#12540;&#12488;&#12377;&#12427;&#12414;&#12391;&#12289;&#12497;&#12473;&#12527;&#12540;&#12489;&#12392;&#21516;&#31561;&#12398;&#12289;NT&#12392;LM&#12398;&#19968;&#26041;&#21521;&#38306;&#25968;&#12395;&#12424;&#12427;&#26263;&#21495;&#21270;
&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#12289;&#12371;&#12398;&#12475;&#12483;&#12471;&#12519;&#12531;&#12461;&#12540;&#12399;&#20351;&#12358;&#12391;&#12354;&#12429;&#12358;&#12290;&#12371;&#12398;&#12510;&#12471;&#12531;&#12364;2&#22238;&#30446;&#12395;&#12522;&#12502;&#12540;&#12488;&#12377;&#12427;
&#21069;&#12395;&#12525;&#12464;&#12452;&#12531;&#12377;&#12427;&#20219;&#24847;&#12398;&#12518;&#12540;&#12470;&#12399;&#12289;&#12497;&#12473;&#12527;&#12540;&#12489;&#12392;&#21516;&#31561;&#12398;&#12418;&#12398;&#12364;&#12400;&#12428;&#12390;&#12375;&#12414;&#12358;&#12391;&#12354;&#12429;&#12358;&#12290;
&#12418;&#12385;&#12429;&#12435;&#12289;&#26032;&#12375;&#12356;&#12510;&#12471;&#12531;&#12398;&#12497;&#12473;&#12527;&#12540;&#12489;&#12399;&#12392;&#12395;&#12363;&#12367;&#12371;&#12398;&#26178;&#28857;&#12391;&#12400;&#12428;&#12390;&#12375;&#12414;&#12358;&#12290;
</p><p>
&#12525;&#12464;&#12458;&#12531;&#12473;&#12463;&#12522;&#12503;&#12488;&#12289;&#12503;&#12525;&#12501;&#12449;&#12452;&#12523;&#12497;&#12473;&#12392;&#12289;SID&#12398;&#12424;&#12358;&#12394;&#25147;&#12426;&#24773;&#22577;&#12399;&#12289;TCP&#12481;&#12455;&#12483;&#12463;&#12469;&#12512;&#20197;&#22806;&#12398;
&#20309;&#12363;&#12395;&#12424;&#12387;&#12390;&#20445;&#35703;&#12373;&#12428;&#12427;&#12424;&#12358;&#12395;&#35211;&#12360;&#12394;&#12356;&#12290;
</p><p>
&#12469;&#12540;&#12496;&#12398;&#12479;&#12452;&#12512;&#12473;&#12479;&#12531;&#12503;&#12399;&#28961;&#35222;&#12373;&#12428;&#12427;&#12424;&#12358;&#12395;&#35211;&#12360;&#12427;&#12290;
</p><p>
&#12463;&#12521;&#12452;&#12450;&#12531;&#12488;&#12399;&#12289;&#12381;&#12428;&#12395;&#23550;&#12377;&#12427;&#20351;&#29992;&#27861;&#12364;&#20998;&#12363;&#12425;&#12394;&#12356;&#12289;SamLogon&#12522;&#12463;&#12456;&#12473;&#12488;&#20013;&#12391;
ReturnAuthenticator&#12434;&#36865;&#12427;&#12290;&#12375;&#12363;&#12375;&#12289;&#12381;&#12398;&#26178;&#38291;&#12399;&#12469;&#12540;&#12496;&#12395;&#12424;&#12387;&#12390;&#25147;&#12373;&#12428;&#12427;&#12479;&#12452;&#12512;&#12473;&#12479;&#12531;&#12503;
&#12392;&#12375;&#12390;&#20351;&#12431;&#12428;&#12427;&#12290;
</p><p>
&#12497;&#12473;&#12527;&#12540;&#12489;&#12398;OMF&#12399;&#35299;&#35501;&#12391;&#12365;&#12427;&#26263;&#21495;&#12391;&#12493;&#12483;&#12488;&#12527;&#12540;&#12463;&#19978;&#12395;&#36865;&#20449;&#12377;&#12409;&#12365;&#12391;&#12394;&#12356;&#12290;SAM&#20013;&#12398;owf&#20516;&#12434;
&#20351;&#12358;&#21516;&#12376;&#27231;&#33021;&#12391;&#12469;&#12540;&#12496;&#12364;&#35336;&#31639;&#12377;&#12427;ARC4(Ks,md4(owf))&#12434;&#20351;&#12387;&#12390;&#36865;&#12427;&#12409;&#12365;&#12391;&#12354;&#12427;&#12290;
</p></div></div><div class="sect1" title="SID&#12392;RID"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2562489"></a>SID&#12392;RID</h2></div></div></div><p>
SID&#12392;RID&#12399;&#12393;&#12371;&#12363;&#12391;&#35443;&#32048;&#12395;&#35500;&#26126;&#12364;&#12354;&#12427;&#12290;
</p><p>
SID&#12399;NT&#12475;&#12461;&#12517;&#12522;&#12486;&#12451;ID(DOM_SID&#27083;&#36896;&#21442;&#29031;)&#12391;&#12354;&#12427;&#12290;&#12371;&#12428;&#12425;&#12399;&#20197;&#19979;&#12398;&#24418;&#24335;&#12434;&#21462;&#12427;:
</p><table border="0" summary="Simple list" class="simplelist"><tr><td>revision-NN-SubAuth1-SubAuth2-SubAuth3... </td></tr><tr><td>revision-0xNNNNNNNNNNNN-SubAuth1-SubAuth2-SubAuth3...</td></tr></table><p>
&#29694;&#22312;&#12289;SID&#12398;&#12522;&#12499;&#12472;&#12519;&#12531;&#12399;1&#12391;&#12354;&#12427;&#12290;
Sub-Authorities&#12399;&#30456;&#23550;ID(RID)&#12392;&#12375;&#12390;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;&#12290;
</p><div class="sect2" title="&#12424;&#12367;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;SID"><div class="titlepage"><div><div><h3 class="title"><a name="id2562527"></a>&#12424;&#12367;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;SID</h3></div></div></div><div class="sect3" title="&#12518;&#12491;&#12496;&#12540;&#12469;&#12523;&#12395;&#12424;&#12427;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;SID"><div class="titlepage"><div><div><h4 class="title"><a name="id2562532"></a>&#12518;&#12491;&#12496;&#12540;&#12469;&#12523;&#12395;&#12424;&#12427;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;SID</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">Null SID</span></dt><dd><p>S-1-0-0</p></dd><dt><span class="term">World</span></dt><dd><p>S-1-1-0</p></dd><dt><span class="term">Local</span></dt><dd><p>S-1-2-0</p></dd><dt><span class="term">Creator Owner ID</span></dt><dd><p>S-1-3-0</p></dd><dt><span class="term">Creator Group ID</span></dt><dd><p>S-1-3-1</p></dd><dt><span class="term">Creator Owner Server ID</span></dt><dd><p>S-1-3-2</p></dd><dt><span class="term">Creator Group Server ID</span></dt><dd><p>S-1-3-3</p></dd><dt><span class="term">(Non-unique IDs)</span></dt><dd><p>S-1-4</p></dd></dl></div></div><div class="sect3" title="NT&#12395;&#12362;&#12369;&#12427;&#12424;&#12367;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;SID"><div class="titlepage"><div><div><h4 class="title"><a name="id2562628"></a>NT&#12395;&#12362;&#12369;&#12427;&#12424;&#12367;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;SID</h4></div></div></div><div class="variablelist"><dl><dt><span class="term">NT Authority</span></dt><dd><p>S-1-5</p></dd><dt><span class="term">Dialup</span></dt><dd><p>S-1-5-1</p></dd><dt><span class="term">Network</span></dt><dd><p>S-1-5-2</p></dd><dt><span class="term">Batch</span></dt><dd><p>S-1-5-3</p></dd><dt><span class="term">Interactive</span></dt><dd><p>S-1-5-4</p></dd><dt><span class="term">Service</span></dt><dd><p>S-1-5-6</p></dd><dt><span class="term">AnonymousLogon(aka null logon session)</span></dt><dd><p>S-1-5-7</p></dd><dt><span class="term">Proxy</span></dt><dd><p>S-1-5-8</p></dd><dt><span class="term">ServerLogon(aka domain controller account)</span></dt><dd><p>S-1-5-8</p></dd><dt><span class="term">(Logon IDs)</span></dt><dd><p>S-1-5-5-X-Y</p></dd><dt><span class="term">(NT non-unique IDs)</span></dt><dd><p>S-1-5-0x15-...</p></dd><dt><span class="term">(Built-in domain)</span></dt><dd><p>s-1-5-0x20</p></dd></dl></div></div></div><div class="sect2" title="&#12424;&#12367;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;RID"><div class="titlepage"><div><div><h3 class="title"><a name="id2562767"></a>&#12424;&#12367;&#30693;&#12425;&#12428;&#12390;&#12356;&#12427;RID</h3></div></div></div><p>
RID&#12399;sub-authority&#12391;&#12354;&#12426;&#12289;SID&#12398;&#19968;&#37096;&#12363;&#12289;&#12464;&#12523;&#12540;&#12503;RID&#12398;&#22580;&#21512;&#12399;&#12289;DOM_GID&#27083;&#36896;&#12398;&#19968;&#37096;&#12391;&#12354;&#12426;&#12289;
USER_INFO_1&#27083;&#36896;&#12391;&#12399;LSA SAM&#12525;&#12464;&#12458;&#12531;&#12524;&#12473;&#12509;&#12531;&#12473;&#12398;&#20013;&#12391;&#12354;&#12427;&#12290;
A RID is a sub-authority value, as part of either a SID, or in the case
of Group RIDs, part of the DOM_GID structure, in the USER_INFO_1
structure, in the LSA SAM Logon response.
</p><div class="sect3" title="&#12424;&#12367;&#30693;&#12425;&#12428;&#12383;RID&#12518;&#12540;&#12470;"><div class="titlepage"><div><div><h4 class="title"><a name="id2562786"></a>&#12424;&#12367;&#30693;&#12425;&#12428;&#12383;RID&#12518;&#12540;&#12470;</h4></div></div></div><div class="segmentedlist"><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>DOMAIN_USER_RID_ADMIN</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>01F4</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>DOMAIN_USER_RID_GUEST</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>01F5</div></div></div></div><div class="sect3" title="&#12424;&#12367;&#30693;&#12425;&#12428;&#12383;RID&#12464;&#12523;&#12540;&#12503;"><div class="titlepage"><div><div><h4 class="title"><a name="id2562823"></a>&#12424;&#12367;&#30693;&#12425;&#12428;&#12383;RID&#12464;&#12523;&#12540;&#12503;</h4></div></div></div><div class="segmentedlist"><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_GROUP_RID_ADMINS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0200</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_GROUP_RID_USERS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0201</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_GROUP_RID_GUESTS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0202</div></div></div></div><div class="sect3" title="&#12424;&#12367;&#30693;&#12425;&#12428;&#12383;RID&#21029;&#21517;"><div class="titlepage"><div><div><h4 class="title"><a name="id2562869"></a>&#12424;&#12367;&#30693;&#12425;&#12428;&#12383;RID&#21029;&#21517;</h4></div></div></div><div class="segmentedlist"><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_ADMINS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0220</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_USERS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0221</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_GUESTS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0222</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_POWER_USERS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0223</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_ACCOUNT_OPS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0224</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_SYSTEM_OPS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0225</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_PRINT_OPS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0226</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_BACKUP_OPS</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0227</div></div><div class="seglistitem"><div class="seg"><strong><span class="segtitle">Groupname: </span></strong>	DOMAIN_ALIAS_RID_REPLICATOR</div><div class="seg"><strong><span class="segtitle">????: </span></strong>0x0000</div><div class="seg"><strong><span class="segtitle">RID: </span></strong>0228</div></div></div></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="unix-smb.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="pt01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="pt02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 1. UNIX&#38936;&#22495;&#12395;&#12362;&#12369;&#12427;NetBIOS </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Part II. Samba&#12398;&#22522;&#26412;</td></tr></table></div></body></html>
