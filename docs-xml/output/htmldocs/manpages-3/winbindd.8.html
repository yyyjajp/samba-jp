<?xml version="1.0" encoding="UTF-8"?>
<html><head><title>winbindd</title><link rel="stylesheet" href="../samba.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="refentry" title="winbindd"><a name="winbindd.8"/><div class="titlepage"/><div class="refnamediv"><h2>Name</h2><p>winbindd — NT サーバからの名前解決を行う Name Service Switch (NSS)デーモン</p></div><div class="refsynopsisdiv" title="Synopsis"><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="literal">winbindd</code> [-F] [-S] [-i] [-Y] [-d &lt;debug level&gt;] [-s &lt;smb config file&gt;] [-n]</p></div></div><div class="refsect1" title="説明"><a name="id2489184"/><h2>説明</h2><p>このプログラムは、<a class="citerefentry" href="samba.7.html"><span class="citerefentry"><span class="refentrytitle">samba</span>(7)</span></a> システムの一部である。</p><p><code class="literal">winbindd</code> は、
	はデーモンであり、
	現在 C ライブラリの大半に実装されている NSS (ネームサービススイッチ) 機能、
	PAM を利用する任意のアプリケーション、
	<code class="literal">ntlm_auth</code> および Samba 自身に対する各種サービスを提供する。</p><p> NSS 機能を使用しない場合でも、
	winbindd はドメインコントローラとの通信を行い、
	<code class="literal">smbd</code> 、<code class="literal">ntlm_auth</code> 、
	PAM モジュールの <code class="literal">pam_winbind.so</code> に対するサービスを提供する。
	この場合、
	<a class="link" href="smb.conf.5.html#IDMAPUID" target="_top">idmap uid</a> および
	<a class="link" href="smb.conf.5.html#IDMAPGID" target="_top">idmap gid</a> パラメータは不要である
	(これは「netlogon [proxy only mode」と呼ばれる)。
	</p><p>
	NSS 機能は、ユーザーやシステムの情報を
	NIS や DNS などの様々なデータベースサービスから取得することを可能とする。
	実際の動作は、
	<code class="filename">/etc/nsswitch.conf</code>
	ファイルにて設定する。
	各ユーザやグループに対しては、
	Samba サーバの管理者が指定したユーザ ID とグループ ID の範囲から
	ID が割り当てられる。
	</p><p> <code class="literal">winbindd</code> によって提供されるサービスは「winbind」と呼ばれ、
	Windows NT サーバからユーザとグループの情報を取得するために用いられる。
	このサービスは関連する PAM モジュールを通じて、
	認証サービスを提供することも可能である。</p><p>
	<code class="filename">pam_winbind</code>
	モジュールは、
	<em class="parameter"><code>auth</code></em> 、 <em class="parameter"><code>account</code></em> 、 <em class="parameter"><code>password</code></em>
	の各モジュールタイプをサポートしている。
        <em class="parameter"><code>account</code></em> モジュールについては、システムによるユーザの UID の取得可否を確認するために getpwnam() を実行するだけの機能しかない。
	これは、ドメインコントローラにより既にアクセス制御が行われているためである。
	<code class="filename">libnss_winbind</code> もしくはシステムに応じた名称のライブラリが適切にインストールされていれば、このモジュールは必ず成功するはずである。
	</p><p>winbind サービスは、以下の NSS データベースを実装している:
 	</p><div class="variablelist"><dl><dt><span class="term">-D</span></dt><dd><p>もしも指定されたならば、このパラメータは、サーバをデーモンとして動かす。
		すなわち、それ自身をデタッチして、適合したポート上でバックグラウンドとして動く。
		このスイッチは、もしも、<code class="literal">winbindd</code> がシェルのコマンド行上で実行された事を仮定する。
		</p></dd><dt><span class="term">hosts</span></dt><dd><p>
		これは、 IRIX でのみ有効である。
		ユーザ情報(訳注: ホスト情報だと思われる)は、伝統的に
		<code class="filename">hosts(5)</code> ファイルに格納され、
		<code class="literal">gethostbyname(3)</code> 関数によって取得される。
		名前解決は WINS サーバ経由か、ブロードキャストによって行われる。
		</p></dd><dt><span class="term">passwd</span></dt><dd><p>
		ユーザ情報は、伝統的に
		<code class="filename">passwd(5)</code> ファイルに格納され、
		<code class="literal">getpwent(3)</code> 関数によって取得される。
		</p></dd><dt><span class="term">group</span></dt><dd><p>
		グループ情報は、伝統的に
		<code class="filename">group(5)</code> ファイルに格納され、
		<code class="literal">getgrent(3)</code> 関数によって取得される。
		</p></dd></dl></div><p>一例として、
	以下のような簡単な設定を
	<code class="filename">/etc/nsswitch.conf</code>
	ファイルに記述することで、
	ユーザ情報やグループ情報は、最初に
	<code class="filename">/etc/passwd</code> や <code class="filename">/etc/group</code> ファイルから、ついで Windows NT サーバから取得される。
</p><pre class="programlisting">
passwd:         files winbind
group:          files winbind
## IRIX においてのみ有効。hostを解決するためにwinbindを使う:
hosts:          files dns winbind
## その他のNSSが有効のシステムでは、以下のように libnss_wins.soを使う:
hosts:          files dns wins
</pre><p>
	以下のような簡単な設定を
	<code class="filename">/etc/nsswitch.conf</code>
	ファイルに記述することで、
	ホスト名は、最初に
	<code class="filename">/etc/hosts</code> ファイルから、ついで WINS サーバから取得される。
	</p><pre class="programlisting">
hosts:		files wins
</pre></div><div class="refsect1" title="オプション"><a name="id2487451"/><h2>オプション</h2><div class="variablelist"><dl><dt><span class="term">-F</span></dt><dd><p>
		このパラメータを指定すると、
		<code class="literal">winbindd</code>
		のメインプロセスがデーモンとして動作しなくなる。
		つまり、
		2 回の <code class="literal">fork(2)</code> と端末からの切り離しを行なわない。
		接続要求を処理するための子プロセスは通常どおり生成されるが、
		メインプロセスは終了しない。
		この動作モードは、
		Daniel J. Bernstein 作の <code class="literal">daemontools</code>
		パッケージに含まれる
		<code class="literal">supervise</code> と <code class="literal">svscan</code>
		や、
		AIX のプロセスモニタなどのプロセス監視機構配下で
		<code class="literal">winbindd</code>
		を動作させるためのものである。
		</p></dd><dt><span class="term">-S</span></dt><dd><p>
		このパラメータを指定すると、
		<code class="literal">winbindd</code>
		はファイルの代わりに標準出力にログを出力するようになる。
		</p></dd><dt><span class="term">-d|--debuglevel=level</span></dt><dd><p><em class="replaceable"><code>level</code></em> は0から10までの整数値である。
既定値の値は、パラメータが設定されていなければ0である。</p><p>この値を大きくするほど、サーバの動作に関するより詳細な情報が
ログファイルに記録される。レベル 0 では、致命的なエラーと重大な警告
のみが記録される。レベル 1 は日々の運用に適しており、少量の稼働状況
に関する情報を生成する。</p><p>1 より上のレベルは大量のログが生成されるので、問題解決の時にのみ
使用すべきである。 3 より上のレベルは開発者だけが利用するように設計されて
おり、莫大な量のログデータが生成される。そのほとんどは非常に謎めいた内容
となっている</p><p>このパラメータの指定は、<code class="filename">smb.conf</code> ファイル中の、
<a class="link" href="smb.conf.5.html#LOGLEVEL" target="_top">log level</a> パラメータの指定よりも優先する。</p></dd><dt><span class="term">-V</span></dt><dd><p>プログラムのバージョン番号を表示する。
</p></dd><dt><span class="term">-s &lt;configuration file&gt;</span></dt><dd><p>サーバーが必要とする詳細な設定を含む設定ファイルを
指定する。このファイルには、サーバーが提供するサービスに関する記述や、
どの printcap ファイルを利用するかといった情報が含まれている。詳細は
<code class="filename">smb.conf</code> を参照のこと。設定ファイルの名前の既定値は、コンパイル時
に決定される。
</p></dd><dt><span class="term">-l|--log-basename=logdirectory</span></dt><dd><p>ログ/デバッグファイルのファイル名。拡張子として
<code class="constant">".progname"</code> が追加される(例えば log.smbclient,
log.smbd,など)。ログファイルはクライアントによって削除されることはない。 
</p></dd><dt><span class="term">-h|--help</span></dt><dd><p>コマンドラインオプションの要約を表示する。
</p></dd><dt><span class="term">-i</span></dt><dd><p>
		<code class="literal">winbindd</code>
		にデーモンとしての動作と端末からの切り離しを行なわないように指示する。
		このオプションは、
		<code class="literal">winbindd</code>
		の対話的なデバッグが必要な開発者のためのものである。
		この際、<code class="literal">-S</code>
		パラメータが指定されたときと同じく、ログは標準出力に出力される。
		</p></dd><dt><span class="term">-n</span></dt><dd><p>
		キャッシュを無効にする。これにより、
		<code class="literal">winbindd</code> は、
		クライアントに応答する前にドメインコントローラからの応答を毎回待たなければならず動作が遅くなるが、
		キャッシュを使用しなくなるため、より厳密な結果を得られるようになる。
		なお、ドメインコントローラが応答するまで
		<code class="literal">winbindd</code> は処理を停止してしまう。
		</p></dd><dt><span class="term">-Y</span></dt><dd><p>
		単一デーモンモード。
		<code class="literal">winbindd</code>
		は単一のプロセスだけで動作する
		(Samba 2.2 での動作モード)。
		<code class="literal">winbindd</code> のデフォルトの動作では、
		期限切れのキャッシュエントリの更新を行う子プロセスが起動される。
		</p></dd></dl></div></div><div class="refsect1" title="名前と ID の解決"><a name="id2487793"/><h2>名前と ID の解決</h2><p>
	Windows NT サーバ上のユーザーとグループが作成された際には、全世界で一意な SID (セキュリティ識別子) が割り当てられる。
	Windows NT のユーザとグループを UNIX のユーザとグループに変換するには、
	SID とユーザ ID およびグループ ID 間のマッピングが必要となる。
	これは <code class="literal">winbindd</code> が行なう作業の一つである。
	</p><p>
	winbindd のユーザとグループが解決される際に、
	ユーザ ID とグループ ID が指定された範囲から割り当てられる。
	ID は解決された順に順番に割り当てられるが、
	クライアントがユーザやグループの列挙コマンドを実行すれば、存在するすべてのユーザとグループのマッピングが行われる。
	割り当てられた UNIX 側の ID は、
	Samba のロックディレクトリ配下のデータベースファイルに格納され、記憶される。
	</p><p><span class="emphasis"><em>警告:</em></span>
	SID と UNIX の ID を変換するデータベース以外に
	winbindd がユーザとグループのマッピング情報を格納している場所はない。
	このファイルが削除されたり壊れたりしてしまうと
	winbindd が、ユーザ ID やグループ ID と
	Windows NT のユーザあるいはグループの RID (訳注: SID) との対応を確認する手段はない。
	</p></div><div class="refsect1" title="設定"><a name="id2487850"/><h2>設定</h2><p>
	<code class="literal">winbindd</code> デーモンの設定は、
	<a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a>
	ファイルのパラメータで行う。
	すべてのパラメータは、
	smb.conf の [global] セクション内に記述しなければならない。
	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#WINBINDSEPARATOR" target="_top">winbind separator</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#IDMAPUID" target="_top">idmap uid</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#IDMAPGID" target="_top">idmap gid</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#IDMAPBACKEND" target="_top">idmap backend</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#WINBINDCACHETIME" target="_top">winbind cache time</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#WINBINDENUMUSERS" target="_top">winbind enum users</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#WINBINDENUMGROUPS" target="_top">winbind enum groups</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#TEMPLATEHOMEDIR" target="_top">template homedir</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#TEMPLATESHELL" target="_top">template shell</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#WINBINDUSEDEFAULTDOMAIN" target="_top">winbind use default domain</a></p></li><li class="listitem"><p>
		<a class="link" href="smb.conf.5.html#WINBIND:RPCONLY" target="_top">winbind: rpc only</a>
		このパラメータを設定すると、ドメインコントローラから情報を
		検索するため、LDAPの変わりにwinbindがRPCを使うことを強制
		する。
		</p></li></ul></div></div><div class="refsect1" title="設定例"><a name="id2538500"/><h2>設定例</h2><p>
	ユーザとグループ名の解決と認証をドメインコントローラで行うには、
	winbindd を以下のように設定する。
	この設定例は、古いバージョンの Red Hat Linux で動作を確認した。
	</p><p><code class="filename">/etc/nsswitch.conf</code> に以下の記述を行なう:
</p><pre class="programlisting">
passwd: files winbind
group:  files winbind
</pre><p>
	</p><p><code class="filename">/etc/pam.d/*</code> 内の
	<em class="parameter"><code>auth</code></em> 行を以下のような設定に置き換える:
</p><pre class="programlisting">
auth  required    /lib/security/pam_securetty.so
auth  required	  /lib/security/pam_nologin.so
auth  sufficient  /lib/security/pam_winbind.so
auth  required    /lib/security/pam_unix.so \
                  use_first_pass shadow nullok
</pre><p>
	</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	pam_unix PAM モジュールは、近年 pam_pwdb モジュールの代わりに用いられている。
	Linux システムによっては、pam_unix の代わりに pam_unix2 モジュールが用いられている。
	</p></div><p><em class="parameter"><code>sufficient</code></em> キーワードと
	<em class="parameter"><code>use_first_pass</code></em> キーワードを使用している点に注意すること。
	</p><p>ここで <em class="parameter"><code>account</code></em> 行を以下の設定に置き換える:</p><p><code class="literal">account    required	/lib/security/pam_winbind.so
	</code></p><p>次はドメインへの参加である。
	<code class="literal">net</code> プログラムを以下のように実行する:
	</p><p><code class="literal">net join -S PDC -U Administrator</code></p><p>
	<em class="parameter"><code>-U</code></em> に続くユーザ名は、
	PDC 上で administrator 権限を持つドメインのユーザであれば誰でもよい。
	「PDC」の部分は、実際の PDC の IP もしくは名前に置き換えること。
	</p><p>引き続き <code class="filename">libnss_winbind.so</code> を
	<code class="filename">/lib</code> に、
	<code class="filename">pam_winbind.so</code> を
	<code class="filename">/lib/security</code> にコピーする。
	<code class="filename">/lib/libnss_winbind.so</code> から
	<code class="filename">/lib/libnss_winbind.so.2</code>
	へのシンボリックリンクも用意する必要がある。
	ただし古いバージョンの glibc を使用しているなら、
	シンボリックリンク先は
	<code class="filename">/lib/libnss_winbind.so.1</code>
	にしなければならない。
	</p><p>最後に、
	<a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a>
	に以下のような設定を記述する:
</p><pre class="programlisting">
[global]
	winbind separator = +
        winbind cache time = 10
        template shell = /bin/bash
        template homedir = /home/%D/%U
        idmap uid = 10000-20000
        idmap gid = 10000-20000
        workgroup = DOMAIN
        security = domain
        password server = *
</pre><p>
	ここで winbindd を起動すると、ユーザおよびグループの対応を行うデータベースが
	Windows NT のユーザとグループの情報を取り込むに従い、大きくなっていくのが確認できる。
	また、「ドメイン名+ユーザー名」という形式でユーザ名を指定することで、
	ドメインのユーザが UNIX にログインできることも確認できるだろう。

	<code class="literal">getent passwd</code> と <code class="literal">getent group</code>
	コマンドを実行すれば、
	winbindd が正常に稼働していることを確認できる。
	</p></div><div class="refsect1" title="注意"><a name="id2538730"/><h2>注意</h2><p>以下の注意点は、
	<code class="literal">winbindd</code> の設定や実行の際に有用である:
	</p><p>
	<code class="literal">winbindd</code>
	が機能するには、同じマシン上で
	<a class="citerefentry" href="nmbd.8.html"><span class="citerefentry"><span class="refentrytitle">nmbd</span>(8)</span></a>
	を実行していなければならない。
	</p><p>
	PAM は非常に設定ミスを犯しやすい。
	PAM の設定ファイルを変更する際は、
	何を行なっているかをきちんと確認すること。
	PAM の設定を誤ることで、
	誰もシステムにログインできなくなってしまうこともあり得る。
	</p><p>
	複数の UNIX マシンで <code class="literal">winbindd</code>
	を実行した場合、一般的に
	winbindd によって割り当てられるユーザ ID とグループ ID はマシン毎に異なる。
	<a class="link" href="smb.conf.5.html#" target="_top"/> パラメータで、情報を共有する設定を行わない限り、
	ユーザ ID とグループ ID はローカルマシン内でのみ有効である。
	</p><p>
	Windows NT の SID と
	UNIX のユーザ ID とグループ ID 間のマッピングファイルが壊れたりなくなったりすると、
	マッピング情報は失われてしまう。
	</p></div><div class="refsect1" title="シグナル"><a name="id2538816"/><h2>シグナル</h2><p>
	以下のシグナルによって
	<code class="literal">winbindd</code> デーモンを操作することが
	可能である。
	</p><div class="variablelist"><dl><dt><span class="term">SIGHUP</span></dt><dd><p><a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a>
		ファイルを再読み込みさせ、
		実行中の <code class="literal">winbindd</code> にパラメータの変更を反映させる。
		このシグナルにより、
		ユーザ情報とグループ情報のキャッシュもクリアされる。
		また、winbindd が信頼するドメインの一覧も再取得される。
		</p></dd><dt><span class="term">SIGUSR2</span></dt><dd><p>
		ステータス情報を <code class="literal">winbindd</code> のログファイルに書き込ませる。
		</p><p>
		ログファイルは、
		log file パラメータで指定したファイルである。
		</p></dd></dl></div></div><div class="refsect1" title="ファイル"><a name="id2538895"/><h2>ファイル</h2><div class="variablelist"><dl><dt><span class="term"><code class="filename">/etc/nsswitch.conf(5)</code></span></dt><dd><p>ネームサービススイッチの設定ファイル。</p></dd><dt><span class="term">/tmp/.winbindd/pipe</span></dt><dd><p>
		クライアントが
		<code class="literal">winbindd</code>
		と通信するための UNIX パイプ。
		セキュリティ上の理由で、
		<code class="filename">/tmp/.winbindd</code> ディレクトリと
		<code class="filename">/tmp/.winbindd/pipe</code>
		ファイルの両方の所有者が root 以外の場合、クライアントは
		winbindd デーモンとの接続を行なわない。
		</p></dd><dt><span class="term">$LOCKDIR/winbindd_privileged/pipe</span></dt><dd><p>
		winbind の「特権」クライアントが
		<code class="literal">winbindd</code>
		と通信するための UNIX パイプ。
		セキュリティ上の理由で、
		winbindd のいくつかの機能
		(<code class="literal">ntlm_auth</code> ユーティリティが必要とする機能など)
		へのアクセスは制限されており、
		デフォルトでは、
		「root」グループに属するユーザだけがアクセスできる。
		管理者が $LOCKDIR/winbindd_privileged
		のグループパーミッションを変更することで、
		「squid」などのプログラムが ntlm_auth を利用できるようにすることなどが可能である。
		<code class="filename">$LOCKDIR/winbindd_privileged</code> ディレクトリと
		<code class="filename">$LOCKDIR/winbindd_privileged/pipe</code>
		ファイルの両方の所有者が root 以外の場合、winbindクライアントは
		winbindd デーモンとの接続を行なわない事に注意。
		</p></dd><dt><span class="term">/lib/libnss_winbind.so.X</span></dt><dd><p>ネームサービススイッチライブラリの実体。
		</p></dd><dt><span class="term">$LOCKDIR/winbindd_idmap.tdb</span></dt><dd><p>
		Windows NT の RID から
		UNIX の ユーザ/グループ ID へのマッピング情報の保管場所。
		ロックディレクトリは、Samba のコンパイル時に
		<em class="parameter"><code>--with-lockdir</code></em>
		オプションを用いて指定する。
		このディレクトリの既定値は
		<code class="filename">/usr/local/samba/var/locks</code>
		である。
		</p></dd><dt><span class="term">$LOCKDIR/winbindd_cache.tdb</span></dt><dd><p>キャッシュされたユーザ/グループ情報の保管場所。
		</p></dd></dl></div></div><div class="refsect1" title="バージョン"><a name="id2487249"/><h2>バージョン</h2><p>このマニュアルは、Samba システムのバージョン 3 に適用される。</p></div><div class="refsect1" title="参照"><a name="id2487260"/><h2>参照</h2><p><code class="filename">nsswitch.conf(5)</code>, <a class="citerefentry" href="samba.7.html"><span class="citerefentry"><span class="refentrytitle">samba</span>(7)</span></a>, <a class="citerefentry" href="wbinfo.1.html"><span class="citerefentry"><span class="refentrytitle">wbinfo</span>(1)</span></a>, <a class="citerefentry" href="ntlm_auth.8.html"><span class="citerefentry"><span class="refentrytitle">ntlm_auth</span>(8)</span></a>, <a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a>, <a class="citerefentry" href="pam_winbind.8.html"><span class="citerefentry"><span class="refentrytitle">pam_winbind</span>(8)</span></a></p></div><div class="refsect1" title="著者"><a name="id2539276"/><h2>著者</h2><p>オリジナルの Samba ソフトウェアと関連ユーティリティは、Andrew
	Tridgell によって作成された。現在 Samba は、Samba Team によって Linux
	カーネルの開発と同様に、オープンソースプロジェクトとして開発されている。
	</p><p><code class="literal">wbinfo</code> および <code class="literal">winbindd</code> コマンドは Tim Potter によって作成された。</p><p>
	Samba 2.2 のための DocBook 形式への変換は Gerald Carter が行った。 
	Samba 3.0 のための DocBook XML 4.2 形式の変換は Alexander Bokovoy によって行われた。
	</p></div><div class="refsect1" title="日本語訳"><a name="id2539314"/><h2>日本語訳</h2><p>このマニュアルページは Samba 3.3.6 - 3.5.6 対応のものである。</p><p>このドキュメントの Samba 3.0.24 対応の翻訳は
	</p><div class="itemizedlist"><p>たかはしもとのぶ (monyo@samba.gr.jp)</p><p>さとうふみやす</p><ul class="itemizedlist" type="disc"/></div><p>	
        によって行なわれた。</p><p>このドキュメントの Samba 3.2.4 - 3.5.6 対応の翻訳は 太田俊哉(ribbon@samba.gr.jp)によって行われた。</p></div></div></body></html>
