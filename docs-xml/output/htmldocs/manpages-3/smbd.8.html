<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>smbd</title><link rel="stylesheet" href="../samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="refentry" title="smbd"><a name="smbd.8"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>smbd — SMB/CIFS サービスをクライアントへ提供するサーバ</p></div><div class="refsynopsisdiv" title="Synopsis"><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="literal">smbd</code> [-D] [-F] [-S] [-i] [-h] [-V] [-b] [-d <debug level>] [-l <log directory>] [-p <port number>] [-O <socket option>] [-s <configuration file>]</p></div></div><div class="refsect1" title="説明"><a name="id2489228"></a><h2>説明</h2><p>このプログラムは <a class="citerefentry" href="Samba.7.html"><span class="citerefentry"><span class="refentrytitle">Samba</span>(7)</span></a>システムの一部である。</p><p><code class="literal">smbd</code> は、Windows クライアントにファイル共有と印刷サービスを提供するサーバデーモンである。	サーバは SMB (または CIFS) プロトコルを使用するクライアントに	ファイル・スペースと印刷サービスを提供する。サーバは 	LanManager プロトコルと互換性があり、LanManager クライアントに	対するサービスが可能である。クライアントには MSCLIENT 3.0 for 	DOS、Windows for Workgroups、Windows 95/98/Me、Windows 2000、	Windows NT、OS/2、DAVE for Macintosh、smbfs for Linux が含まれる。</p><p>サーバが提供できるサービスについての詳細な記述は、	それらサービスの属性を制御する設定ファイルの	マニュアルページにある	(<a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a>を参照)。このマニュアルページでは	サービスについて記述せず、サーバを動作させる上での	管理の面にしぼって記述する。</p><p>このサーバを動作させることは	重要なセキュリティーとの関係があること、そして <a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a>	のマニュアルページはインストールを進める前に	必ず読むべきものであることに注意すること。</p><p>セッションはクライアントに要求されるたびに作られる。	各クライアントは各セッション毎にサーバプロセスのコピーを得る。	このコピーはセッションの間、クライアントによるすべての	接続を提供する。クライアントのすべての接続が切断されると、	そのクライアントに対するサーバのコピーは終了する。</p><p>設定ファイルとそれに含まれるファイルが変更されると、	1分ごとに自動的に再読込される。サーバに SIGHUP を送ることにより	再読み込みを強制することもできる。設定ファイルの再読込は、	すでに確立されているサービスの接続には影響しない。	ユーザがサービスから切断するか、<code class="literal">smbd</code>	を終了して再起動するまで設定ファイルの変更は反映されない。</p></div><div class="refsect1" title="オプション"><a name="id2489468"></a><h2>オプション</h2><div class="variablelist"><dl><dt><span class="term">-D</span></dt><dd><p>このパラメータが指定されると、		サーバはデーモンとして動作することになる。つまり、自身を分離して		バックグラウンドで走らせ、適切なポートに対する要求を		処理するようになる。 臨時にファイルおよび印刷サービスを提供する		サーバとして利用する以外の場合は、サーバをデーモンとして		起動するのが <code class="literal">smbd</code> の起動方法として推奨される。		<code class="literal">smbd</code> がシェルのコマンドラインから		実行されたときはこのスイッチが指定されたと見なされる。		</p></dd><dt><span class="term">-F</span></dt><dd><p>		このパラメータを指定すると、		<code class="literal">smbd</code>		のメインプロセスはデーモン化しなくなる。		つまり、		2 回の <code class="literal">fork(2)</code> と端末からの切り離しを行なわない。		通常通り接続要求を処理するための子プロセスが生成されるが、		メインプロセスは終了しない。		この動作方式は、		Daniel J. Bernstein 作の <code class="literal">daemontools</code>		パッケージに含まれる		<code class="literal">supervise</code> と <code class="literal">svscan</code>		や、		AIX のプロセスモニターなど、プロセス監視の下で		<code class="literal">smbd</code>		を動作させるのに都合がよい。		</p></dd><dt><span class="term">-S</span></dt><dd><p>このパラメータが指定されると、<code class="literal">smbd</code> は		ファイルではなく標準出力にログを出力する。</p></dd><dt><span class="term">-i</span></dt><dd><p>このパラメータが指定されると、		サーバはコマンドラインでデーモンとして実行されていたとしても		デーモンではなく、"対話形式"で動作する。		このパラメータを設定することにより、コマンドラインからの起動により暗黙		的にデーモンモードとなることを無効にする。		また、<code class="literal">-S</code> パラメータが指定されているかのように、		<code class="literal">smbd</code> は標準出力にログを出力する。		</p></dd><dt><span class="term">-d|--debuglevel=level</span></dt><dd><p><em class="replaceable"><code>level</code></em> は0から10までの整数値である。既定値の値は、パラメータが設定されていなければ0である。</p><p>この値を大きくするほど、サーバの動作に関するより詳細な情報がログファイルに記録される。レベル 0 では、致命的なエラーと重大な警告のみが記録される。レベル 1 は日々の運用に適しており、少量の稼働状況に関する情報を生成する。</p><p>1 より上のレベルは大量のログが生成されるので、問題解決の時にのみ使用すべきである。 3 より上のレベルは開発者だけが利用するように設計されており、莫大な量のログデータが生成される。そのほとんどは非常に謎めいた内容となっている</p><p>このパラメータの指定は、<code class="filename">smb.conf</code>ファイル中の、 <a class="link" href="smb.conf.5.html#" target="_top"></a> パラメータの指定よりも優先する。</p></dd><dt><span class="term">-V</span></dt><dd><p>プログラムのバージョン番号を表示する。</p></dd><dt><span class="term">-s <configuration file></span></dt><dd><p>サーバーが必要とする詳細な設定を含む設定ファイルを指定する。このファイルには、サーバーが提供するサービスに関する記述や、どの printcap ファイルを利用するかといった情報が含まれている。詳細は<code class="filename">smb.conf</code> を参照のこと。設定ファイルの名前の既定値は、コンパイル時に決定される。</p></dd><dt><span class="term">-l|--log-basename=logdirectory</span></dt><dd><p>ログ/デバッグファイルのファイル名。拡張子として<code class="constant">".progname"</code> が追加される(例えば log.smbclient,log.smbd,など)。ログファイルはクライアントによって削除されることはない。 </p></dd><dt><span class="term">-h|--help</span></dt><dd><p>コマンドラインオプションの要約を表示する。</p></dd><dt><span class="term">-b</span></dt><dd><p>どのようにSambaがビルドされたか表示する。		</p></dd><dt><span class="term">-p|--port<port number(s)></span></dt><dd><p><em class="replaceable"><code>port number(s)</code></em> は		空白か、コンマで分離された、smbdがリッスンするTCPポート番号のリストである。		既定値は<code class="filename">smb.conf</code>中の<a class="link" href="smb.conf.5.html#PORTS" target="_top">ports</a>パラメータからとられる。</p><p>既定値は 139(NetBIOS over TCP上のSMBを使う場合)と445(TCP上での普通のSMBを使う場合)である。</p></dd><dt><span class="term">-P|--profiling-level<profiling level></span></dt><dd><p><em class="replaceable"><code>profiling level</code></em> は		収集するプロファイリングデータのレベルを指定する数値である。0はプロファイリングを		停止、1はプロファイリングカウンタのみONにする。2は完全なプロファイリングをONにし、3はすべてのプロファイリングデータをリセットする。		</p></dd></dl></div></div><div class="refsect1" title="関連ファイル"><a name="id2487630"></a><h2>関連ファイル</h2><div class="variablelist"><dl><dt><span class="term"><code class="filename">/etc/inetd.conf</code></span></dt><dd><p>サーバを		<code class="literal">inetd</code> メタ・デーモンによって動作させるには、このファイルに		メタ・デーモン用の適切な起動情報を含める必要がある。		</p></dd><dt><span class="term"><code class="filename">/etc/rc</code></span></dt><dd><p>(あるいは、あなたのシステムが		使用する初期化スクリプト)</p><p>システム起動時にデーモンとしてサーバを動作させるなら、		このファイルにサーバのための適切な起動手続きを		含める必要がある。</p></dd><dt><span class="term"><code class="filename">/etc/services</code></span></dt><dd><p> <code class="literal">inetd</code> メタ・デーモンを		介してサーバを動作させるなら、このファイルにサービスポート		(例:139)とプロトコルタイプ(例:tcp)に対するサービス名		(例:netbios-ssn)のマッピングを含める必要がある。		</p></dd><dt><span class="term"><code class="filename">/usr/local/samba/lib/smb.conf</code></span></dt><dd><p>このファイルはサーバの設定ファイルである <a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a> のデフォルトの位置である。その他、システムがこのファイルをインストール		しそうな場所としては、 <code class="filename">/usr/samba/lib/smb.conf</code> 		や <code class="filename">/etc/samba/smb.conf</code> がある。</p><p>このファイルにはサーバがクライアントから利用できるようにする		全てのサービスを記述する。さらなる情報は <a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a> を参照のこと。</p></dd></dl></div></div><div class="refsect1" title="制限"><a name="id2487774"></a><h2>制限</h2><p>いくつかのシステム上において、<code class="literal">smbd</code> は	setuid() を呼び出した後に uid を root に戻すことができない。この種のシステムは、トラップドア uid システムと呼ばれる。	そのようなシステムの場合、異なる二人のユーザとして (PC のような)	クライアントから同時に接続を行うことができない。	二人目のユーザ接続の試みは、「アクセス拒否」	または類似の結果となる。</p></div><div class="refsect1" title="環境変数"><a name="id2487801"></a><h2>環境変数</h2><div class="variablelist"><dl><dt><span class="term"><code class="envar">PRINTER</code></span></dt><dd><p>プリント・サービスでプリンタの名前が		指定されていないとき、多くのシステムでは使用するプリンタ名として、		この変数の値が(もしくは変数が定義されていないなら<code class="constant">lp</code> が)利用される。しかしながら		これはサーバの特性であるという訳ではない。</p></dd></dl></div></div><div class="refsect1" title="PAM との相互作用"><a name="id2487834"></a><h2>PAM との相互作用</h2><p>Samba はアカウントチェック(アカウントが無効か?)や	セッション管理のため(平文のパスワードが提供されたときに)	認証に PAM を使う。samba の PAM をサポートする程度は、	SMBプロトコルと<a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a>の	<a class="link" href="smb.conf.5.html#" target="_top"></a>の制限によって限定される。これが設定されると、以下の制限が適用される。	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>アカウントの妥当性確認</em></span>:  Samba	サーバに対するすべてのアクセスは、アカウントが妥当か、無効になっていないか、	その時間にログインが許可されているかを PAM と照らし合わせて	チェックされる。これは暗号化されたログインにも当てはまる。	</p></li><li class="listitem"><p><span class="emphasis"><em>セッション管理</em></span>:  共有レベルのセキュリティ	(訳注:smb.conf での security = share を指す)を使用していない場合、	ユーザはアクセスが許可される前に PAM のセッションチェックをパスしなくてはいけない。	一方、共有レベルのセキュリティではこれはスキップされることに注意。	また、いくつかの古い pam 設定ファイルではセッションをサポートするために	行の追加が必要かも知れないことにも注意。	</p></li></ul></div></div><div class="refsect1" title="バージョン"><a name="id2538374"></a><h2>バージョン</h2><p>このマニュアルページは Samba バージョン	3用にである。</p></div><div class="refsect1" title="診断"><a name="id2538385"></a><h2>診断</h2><p>サーバによって出力されたほとんどの診断は、指定されたログファイルに	記録される。ログファイルの名前はコンパイル時に指定されるが、	コマンドラインで変更することもできる。</p><p>利用できる診断の数と性質は、サーバで使用されるデバッグ・レベルに	依存する。もし問題を抱えているなら、デバッグ・レベルを 	3 に設定してログファイルに目を通すこと。</p><p>ほとんどのメッセージは充分に自明であろう。あいにく、	このマニュアルページ作成時にはあまりにもさまざまな診断メッセージが	存在しているため、診断メッセージをすべて記述することを保証できない。	そのような場合にもっともよい方法は、ソースコードを検索	(grep)することであり、着目している診断メッセージを引き起こした条件を	探すことである。</p></div><div class="refsect1" title="TDBファイル"><a name="id2538426"></a><h2>TDBファイル</h2><p>Sambaは通常<code class="filename">/var/lib/samba</code>にあるいくつかのTDB (Trivial Database) ファイルにそのデータを格納する。</p><p>	(*) 情報はリスタートをまたがって継続する(しかし、必ずしもバックアップが重要ではない)。	</p><div class="variablelist"><dl><dt><span class="term">account_policy.tdb*</span></dt><dd><p>パスワードの満了期間などのような、NTアカウントポリシーの設定</p></dd><dt><span class="term">brlock.tdb</span></dt><dd><p>バイトレンジロック</p></dd><dt><span class="term">browse.dat</span></dt><dd><p>ブラウズリスト</p></dd><dt><span class="term">connections.tdb</span></dt><dd><p>共有の接続(最大コネクションの強制などに使う)</p></dd><dt><span class="term">gencache.tdb</span></dt><dd><p>汎用キャッシュdb</p></dd><dt><span class="term">group_mapping.tdb*</span></dt><dd><p>グループマッピング情報</p></dd><dt><span class="term">locking.tdb</span></dt><dd><p>共有モードとoplocks</p></dd><dt><span class="term">login_cache.tdb*</span></dt><dd><p>不正なログイン記録</p></dd><dt><span class="term">messages.tdb</span></dt><dd><p>Sambaメッセージングシステム</p></dd><dt><span class="term">netsamlogon_cache.tdb*</span></dt><dd><p>net_samlogon() 要求 (ドメインメンバとして)からのユーザ net_info_3構造体のキャッシュ </p></dd><dt><span class="term">ntdrivers.tdb*</span></dt><dd><p>インストールされたプリンタドライバ</p></dd><dt><span class="term">ntforms.tdb*</span></dt><dd><p>インストールされたプリンタのフォーム</p></dd><dt><span class="term">ntprinters.tdb*</span></dt><dd><p>インストールされたプリンタの情報</p></dd><dt><span class="term">printing/</span></dt><dd><p>キャッシュされたlpq出力のプリンとキュー毎のtdbを含むディレクトリ</p></dd><dt><span class="term">registry.tdb</span></dt><dd><p>Windowsレジストリの骨格(regedit.exe経由)</p></dd><dt><span class="term">sessionid.tdb</span></dt><dd><p>セッション情報(すなわち'utmp = yes'のサポート)</p></dd><dt><span class="term">share_info.tdb*</span></dt><dd><p>共有のacl</p></dd><dt><span class="term">winbindd_cache.tdb</span></dt><dd><p>winbinddが使うユーザリストのキャッシュなど</p></dd><dt><span class="term">winbindd_idmap.tdb*</span></dt><dd><p>winbinddが使うローカルのidmap db</p></dd><dt><span class="term">wins.dat*</span></dt><dd><p>'wins support = yes'の時のwinsデータベース</p></dd></dl></div></div><div class="refsect1" title="シグナル"><a name="id2538669"></a><h2>シグナル</h2><p><code class="literal">smbd</code> に SIGHUP を送ることで、	<code class="filename">smb.conf</code> の内容を短時間の内に	再読み込みさせることができる。</p><p><code class="literal">smbd</code> のプロセスをシャットダウンさせるのに、	最後の手段として以外には <code class="literal">SIGKILL (-9)</code> は	<span class="emphasis"><em>使わない</em></span> ことを推奨する。共有メモリのエリアが不整合なままに	なってしまうことがあるためである。<code class="literal">smbd</code>	を安全に終了させる方法は、SIGTERM (-15) を送って、<code class="literal">smbd</code>	自身が終了するのを待つことである。</p><p><a class="citerefentry" href="smbcontrol.1.html"><span class="citerefentry"><span class="refentrytitle">smbcontrol</span>(1)</span></a>	を使うと <code class="literal">smbd</code> のデバッグ・ログ・レベルを上げたり下げたりできる	(SIGUSR[1|2] シグナルは Samba 2.2 ではもはや使用されない)。	これにより、低いログ・レベルで動作している間に発生する	一時的な問題を診断することができる。</p><p>デバッグ書き込みを送る <code class="literal">smbd</code> のシグナル・	ハンドラは再入可能になっていない。ゆえにシグナルを発行するときは、	<code class="literal">smbd</code> が SMB 待ちの状態になるまで待つ必要がある。	select 呼び出しの前にシグナルのブロッキングを解除し、呼び出しの後で再び	ブロッキングすればシグナル・ハンドラを安全にすることができるが、	これはパフォーマンスに影響するだろう。</p></div><div class="refsect1" title="関連項目"><a name="id2538782"></a><h2>関連項目</h2><p><a class="citerefentry" href="hosts_access.5.html"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a>, <a class="citerefentry" href="inetd.8.html"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>, <a class="citerefentry" href="nmbd.8.html"><span class="citerefentry"><span class="refentrytitle">nmbd</span>(8)</span></a>, <a class="citerefentry" href="smb.conf.5.html"><span class="citerefentry"><span class="refentrytitle">smb.conf</span>(5)</span></a>, <a class="citerefentry" href="smbclient.1.html"><span class="citerefentry"><span class="refentrytitle">smbclient</span>(1)</span></a>, <a class="citerefentry" href="testparm.1.html"><span class="citerefentry"><span class="refentrytitle">testparm</span>(1)</span></a>, <a class="citerefentry" href="testprns.1.html"><span class="citerefentry"><span class="refentrytitle">testprns</span>(1)</span></a>, and the 	およびインターネット RFC の	<code class="filename">rfc1001.txt</code>, <code class="filename">rfc1002.txt</code>. 	加えて CIFS(以前は SMB)の仕様は以下のWebページから入手できる:	<a class="ulink" href="http://samba.org/cifs/" target="_top"> http://samba.org/cifs/</a>.</p></div><div class="refsect1" title="著者"><a name="id2538865"></a><h2>著者</h2><p>オリジナルの Samba ソフトウェアと関連するユーティリティは、	Andrew Tridgell によって作られた。Samba は現在 Linux カーネルが	開発されているような方法でのオープンソースプロジェクトである 	Samba Team によって開発されている。</p><p>オリジナルの Samba の マニュアルページは Karl Auer によって書かれた。	マニュアルページは YODL 形式(別の、優秀なオープンソースソフトウェアで、 	(<a class="ulink" href="ftp://ftp.icce.rug.nl/pub/unix/" target="_top">ftp://ftp.icce.rug.nl/pub/unix/</a>にある)	で変換され、Jeremy Allison によって Samba 2.0 リリースのために更新された。	Samba 2.2 のための DocBook 形式への変換は Gerald Carter が行った。	Samba 3.0 のための DocBook XML 4.2 形式への変換は Alexander Bokovoy が行った。	</p></div><div class="refsect1" title="日本語訳"><a name="id2538903"></a><h2>日本語訳</h2><p>このマニュアルページは Samba 3.2.4-3.3.11  対応のものである。</p><p>このドキュメントの Samba 3.0.0 対応の翻訳は、ちかましゅうへいによって行なわれた。</p><p>このドキュメントの Samba 3.2.4-3.3.11 対応の翻訳は、太田俊哉(ribbon@samba.gr.jp)によって行なわれた。</p></div></div></body></html>