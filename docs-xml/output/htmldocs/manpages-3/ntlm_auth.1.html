<?xml version="1.0" encoding="UTF-8"?>
<html><head><title>ntlm_auth</title><link rel="stylesheet" href="../samba.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="refentry" title="ntlm_auth"><a name="ntlm-auth.1"/><div class="titlepage"/><div class="refnamediv"><h2>Name</h2><p>ntlm_auth — Winbind 機構の NTLM 認証機能を外部から利用可能とするツール
	</p></div><div class="refsynopsisdiv" title="Synopsis"><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="literal">ntlm_auth</code> [-d debuglevel] [-l logdir] [-s &lt;smb config file&gt;]</p></div></div><div class="refsect1" title="説明"><a name="id2529812"/><h2>説明</h2><p>このツールは <a class="citerefentry" href="samba.7.html"><span class="citerefentry"><span class="refentrytitle">samba</span>(7)</span></a> システムの一部である。</p><p><code class="literal">ntlm_auth</code> はユーザを NTLM 認証方式で認証するためのヘルパーユーティリティである。ユーザ認証が成功した場合 0 を返し、アクセスが拒否された
	場合は 0 を返す。ntlm_auth は winbind を使用してドメインのユーザと認証データに
	アクセスする。このユーティリティは外部プログラム（現在は 
	<a class="ulink" href="http://www.squid-cache.org/" target="_top">Squid</a>
	と <a class="ulink" href="http://download.samba.org/ftp/unpacked/lorikeet/trunk/mod_ntlm_winbind/" target="_top">mod_ntlm_winbind</a>) 
	で用いることを目的としている。
	</p></div><div class="refsect1" title="その他の必要条件"><a name="id2488691"/><h2>その他の必要条件</h2><p>
    多くの機能については、
    <a class="citerefentry" href="winbindd.8.html"><span class="citerefentry"><span class="refentrytitle">winbindd</span>(8)</span></a> デーモンが機能している必要がある。
    </p><p>幾つかの機能については、上記に加えて
    <code class="filename">$LOCKDIR</code> 中の
    <code class="filename">winbindd_privileged</code> ディレクトリへアクセスできることも必要である。
    これには、コマンドを root で実行するか、
    <code class="filename">winbindd_privileged</code> 
    ディレクトリにアクセス可能なグループに所属させる必要がある。
    セキュリティ上、
    このディレクトリは誰もがアクセス可能にすべきでない。
    </p></div><div class="refsect1" title="オプション"><a name="id2488747"/><h2>オプション</h2><div class="variablelist"><dl><dt><span class="term">--helper-protocol=PROTO</span></dt><dd><p>
	標準入出力を用いるヘルパープログラムとして動作させる。
	認識可能なプロトコルは以下のとおり:
        </p><div class="variablelist"><dl><dt><span class="term">squid-2.4-basic</span></dt><dd><p>
		Squid 2.4 のベーシック(平文)認証で用いるためのサーバ側ヘルパー
		</p></dd><dt><span class="term">squid-2.5-basic</span></dt><dd><p>
		Squid 2.5 のベーシック(平文)認証で用いるためのサーバ側ヘルパー
		</p></dd><dt><span class="term">squid-2.5-ntlmssp</span></dt><dd><p>
		Squid 2.5 の NTLMSSP 認証で用いるためのサーバ側ヘルパー
		</p><p> これは、
		<code class="filename">$LOCKDIR</code> 内の <code class="filename">winbindd_privileged</code> ディレクトリへのアクセスが必要である。
		利用されるプロトコルについての詳細は
		<a class="ulink" href="http://devel.squid-cache.org/ntlm/squid_helper_protocol.html" target="_top">http://devel.squid-cache.org/ntlm/squid_helper_protocol.html</a> を参照のこと。
		このプロトコルでは
		<code class="literal">YR</code> コマンドの引数として NTLMSSP のネゴシエートパケットが含まれるように拡張されている。
		(これにより、プロトコル情報の交換における情報の消失を回避している)。
                </p></dd><dt><span class="term">ntlmssp-client-1</span></dt><dd><p>
		Samba の NTLMSSP 認証の結果を用いる任意の外部プログラムのためのクライアント側ヘルパー
		</p><p>
		このヘルパーはクライアントであり、任意のユーザから実行可能である。
		用いられるプロトコルは前述したプロトコルを逆転させたものである。
		<code class="literal">YR</code> コマンド (引数無し) により、
		認証情報の交換が開始される。
                </p></dd><dt><span class="term">gss-spnego</span></dt><dd><p>
		GSS-SPNEGO を実装するサーバ側ヘルパー。
		これは
  		<code class="literal">squid-2.5-ntlmssp</code> とほぼ同様のプロトコルを用いるが、微妙な違いがある。この違いについては現時点ではドキュメント化されておらず、ソースコードを確認するしかない。
                </p><p> これは、
		<code class="filename">$LOCKDIR</code> 内の <code class="filename">winbindd_privileged</code> ディレクトリへのアクセスが必要である。
               </p></dd><dt><span class="term">gss-spnego-client</span></dt><dd><p>
		GSS-SPNEGO を実装するクライアント側ヘルパー。
		これは前述したヘルパーとほぼ同様のプロトコルを用いる。
		現在のところドキュメント化されていない。
                </p></dd><dt><span class="term">ntlm-server-1</span></dt><dd><p>
		RADIUS サーバ、もしくは pppd の「winbind」プラグインに、
		MSCHAP や MSCHAPv2 認証を提供するために用いられるサーバ側ヘルパー。
                </p><p>このプロトコルは、以下の形式の行からなる:
                <code class="literal">Parameter: 値</code> および <code class="literal">Paramter::
                Base64エンコード値</code>。単独のピリオド(
                <code class="literal">.</code>) は、(ヘルパーがユーザ認証を行なう際に)
		一方が他方へ提供するデータの終了を意味する。
                </p><p>外部プログラムからヘルパーに情報を提供するために現在実装されているパラメータは以下のとおりである:</p><div class="variablelist"><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
		実装の際は、改行文字のような微妙なデータが混入されることを考慮して、すべてのデータ(ユーザ名やパスワードを含む)を base64 エンコードするように考慮すべきである。
		ただしこの場合、ヘルパー側で base64 でエンコードされている文字列をデコードする必要が発生する。
		</div><dl><dt><span class="term">Username</span></dt><dd><p>ユーザ名。これは Samba の
                <a class="link" href="smb.conf.5.html#UNIXCHARSET" target="_top">unix charset</a> でエンコードされているとみなされる。
                </p><div class="example"><a name="id2489150"/><p class="title"><b>Example 1. </b></p><div class="example-contents">Username: bob</div></div><p><br class="example-break"/></p><div class="example"><a name="id2489156"/><p class="title"><b>Example 2. </b></p><div class="example-contents">Username:: Ym9i</div></div><p><br class="example-break"/></p></dd><dt><span class="term">Username (訳注: domain の誤りだと思われる)</span></dt><dd><p>ユーザの所属するドメイン。これは Samba の
                <a class="link" href="smb.conf.5.html#UNIXCHARSET" target="_top">unix charset</a> でエンコードされているとみなされる。
                </p><div class="example"><a name="id2489186"/><p class="title"><b>Example 3. </b></p><div class="example-contents">Domain: WORKGROUP</div></div><p><br class="example-break"/></p><div class="example"><a name="id2489191"/><p class="title"><b>Example 4. </b></p><div class="example-contents">Domain:: V09SS0dST1VQ</div></div><p><br class="example-break"/></p></dd><dt><span class="term">Full-Username</span></dt><dd><p>完全なユーザ名。これは Samba の
                <a class="link" href="smb.conf.5.html#UNIXCHARSET" target="_top">unix charset</a> でエンコードされているとみなされる。
		また、ディリミタには <a class="link" href="smb.conf.5.html#WINBINDSEPARATOR" target="_top">winbind separator</a> が用いられる。
                </p><div class="example"><a name="id2489231"/><p class="title"><b>Example 5. </b></p><div class="example-contents">Full-Username: WORKGROUP\bob</div></div><p><br class="example-break"/></p><div class="example"><a name="id2489235"/><p class="title"><b>Example 6. </b></p><div class="example-contents">Full-Username:: V09SS0dST1VQYm9i</div></div><p><br class="example-break"/></p></dd><dt><span class="term">LANMAN-Challenge</span></dt><dd><p> 8 バイトの <code class="literal">LANMAN Challenge</code> の値。
		これはサーバ側でランダムに生成されるか、サーバとクライアントの双方である規則に従って生成される(MSCHAPv2 の場合)。
                </p><div class="example"><a name="id2489263"/><p class="title"><b>Example 7. </b></p><div class="example-contents">LANMAN-Challege: 0102030405060708</div></div><p><br class="example-break"/></p></dd><dt><span class="term">LANMAN-Response</span></dt><dd><p>24 バイトの <code class="literal">LANMAN Response</code> の値。
		これはユーザのパスワードと提供された
                <code class="literal">LANMAN Challenge</code> から計算される。
		通常、この値は認証を受けようとするクライアントからネットワーク経由で提供される。
                </p><div class="example"><a name="id2489299"/><p class="title"><b>Example 8. </b></p><div class="example-contents">LANMAN-Response: 0102030405060708090A0B0C0D0E0F101112131415161718</div></div><p><br class="example-break"/></p></dd><dt><span class="term">NT-Response</span></dt><dd><p>24 バイト以上の <code class="literal">NT Response</code> 。
		これはユーザのパスワードと提供された
                <code class="literal">LANMAN Challenge</code> から計算される。
		通常、この値は認証を受けようとするクライアントからネットワーク経由で提供される。
                 </p><div class="example"><a name="id2489337"/><p class="title"><b>Example 9. </b></p><div class="example-contents">NT-Response: 0102030405060708090A0B0C0D0E0F101112131415161718</div></div><p><br class="example-break"/></p></dd><dt><span class="term">Password</span></dt><dd><p>ユーザのパスワード。
		これは、ヘルパーが平文のパスワードを用いるレガシーな環境で用いられている場合に、ネットワーククライアントから提供される。
                 </p><div class="example"><a name="id2489357"/><p class="title"><b>Example 10. </b></p><div class="example-contents">Password: samba2</div></div><p><br class="example-break"/></p><div class="example"><a name="id2489362"/><p class="title"><b>Example 11. </b></p><div class="example-contents">Password:: c2FtYmEy</div></div><p><br class="example-break"/></p></dd><dt><span class="term">Request-User-Session-Key</span></dt><dd><p>認証に成功した際に、ログインに対応するユーザのセッション鍵を返却するか。
                 </p><div class="example"><a name="id2489380"/><p class="title"><b>Example 12. </b></p><div class="example-contents">Request-User-Session-Key: Yes</div></div><p><br class="example-break"/></p></dd><dt><span class="term">Request-LanMan-Session-Key</span></dt><dd><p>認証に成功した際に、ログインに対応する LANMAN セッション鍵を返却するか。
                 </p><div class="example"><a name="id2489397"/><p class="title"><b>Example 13. </b></p><div class="example-contents">Request-LanMan-Session-Key: Yes</div></div><p><br class="example-break"/></p></dd></dl></div></dd></dl></div></dd><dt><span class="term">--username=USERNAME</span></dt><dd><p>
	認証するユーザのユーザ名を指定する
	</p></dd><dt><span class="term">--domain=DOMAIN</span></dt><dd><p>
	認証するユーザのドメイン名を指定する
	</p></dd><dt><span class="term">--workstation=WORKSTATION</span></dt><dd><p>
	認証するユーザが使用するワークステーション名を指定する
	</p></dd><dt><span class="term">--challenge=STRING</span></dt><dd><p>NTLM チャレンジ (HEXADECIMAL エンコード)</p></dd><dt><span class="term">--lm-response=RESPONSE</span></dt><dd><p>チャレンジに対する LM レスポンス (HEXADECIMAL エンコード)</p></dd><dt><span class="term">--nt-response=RESPONSE</span></dt><dd><p>チャレンジに対する NT もしくは NTLMv2 レスポンス (HEXADECIMAL エンコード)</p></dd><dt><span class="term">--password=PASSWORD</span></dt><dd><p>ユーザの平文パスワード</p><p>
	コマンドラインでこの指定がない場合、必要時にはプロンプトが表示される。
	</p><p>NTLMSSPベースのサーバロールのために、このパラメータは拡張
	されたパスワードを指定し、winbinddの動作なしでテストすることを可能
	にする。</p></dd><dt><span class="term">--request-lm-key</span></dt><dd><p>LMセッションキーの検索</p></dd><dt><span class="term">--request-nt-key</span></dt><dd><p>NTキーの要求</p></dd><dt><span class="term">--diagnostics</span></dt><dd><p>認証チェーン上での診断の実行。
	<code class="literal">--password</code>によるパスワードを使うか、
	パスワード要求のプロンプトを出す。</p></dd><dt><span class="term">--require-membership-of={SID|Name}</span></dt><dd><p>成功のために、認証のために指定したグループ
		(かSIDの名前)のメンバとなるユーザを要求する。</p></dd><dt><span class="term">-d|--debuglevel=level</span></dt><dd><p><em class="replaceable"><code>level</code></em> は0から10までの整数値である。
既定値の値は、パラメータが設定されていなければ0である。</p><p>この値を大きくするほど、サーバの動作に関するより詳細な情報が
ログファイルに記録される。レベル 0 では、致命的なエラーと重大な警告
のみが記録される。レベル 1 は日々の運用に適しており、少量の稼働状況
に関する情報を生成する。</p><p>1 より上のレベルは大量のログが生成されるので、問題解決の時にのみ
使用すべきである。 3 より上のレベルは開発者だけが利用するように設計されて
おり、莫大な量のログデータが生成される。そのほとんどは非常に謎めいた内容
となっている</p><p>このパラメータの指定は、<code class="filename">smb.conf</code>ファイル中の、 <a class="link" href="smb.conf.5.html#" target="_top"/> パラメータの
指定よりも優先する。</p></dd><dt><span class="term">-V</span></dt><dd><p>プログラムのバージョン番号を表示する。
</p></dd><dt><span class="term">-s &lt;configuration file&gt;</span></dt><dd><p>サーバーが必要とする詳細な設定を含む設定ファイルを
指定する。このファイルには、サーバーが提供するサービスに関する記述や、
どの printcap ファイルを利用するかといった情報が含まれている。詳細は
<code class="filename">smb.conf</code> を参照のこと。設定ファイルの名前の既定値は、コンパイル時
に決定される。
</p></dd><dt><span class="term">-l|--log-basename=logdirectory</span></dt><dd><p>ログ/デバッグファイルのファイル名。拡張子として
<code class="constant">".progname"</code> が追加される(例えば log.smbclient,
log.smbd,など)。ログファイルはクライアントによって削除されることはない。 
</p></dd><dt><span class="term">-h|--help</span></dt><dd><p>コマンドラインオプションの要約を表示する。
</p></dd></dl></div></div><div class="refsect1" title="セットアップ例"><a name="id2487168"/><h2>セットアップ例</h2><p>基本とNTLMSSP認証の両方でsquid 2.5用に設定するには、
	<code class="filename">squid.conf</code>ファイル中に以下を設定する。
</p><pre class="programlisting">
auth_param ntlm program ntlm_auth --helper-protocol=squid-2.5-ntlmssp
auth_param basic program ntlm_auth --helper-protocol=squid-2.5-basic
auth_param basic children 5
auth_param basic realm Squid proxy-caching web server
auth_param basic credentialsttl 2 hours
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>この例は、ntlm_authのパスが通っていることと、それが、上記で説明
	されている、<code class="filename">winbindd_privileged</code>上のグループ
	パーミッションが設定されていることを仮定している。</p></div><p>上記の例で、グループ制限を追加して、squid 2.5用にntlm_auth
	をセットアップするには、以下の記述を、<code class="filename">squid.conf</code>
	に書く。
</p><pre class="programlisting">
auth_param ntlm program ntlm_auth --helper-protocol=squid-2.5-ntlmssp --require-membership-of='WORKGROUP\Domain Users'
auth_param basic program ntlm_auth --helper-protocol=squid-2.5-basic --require-membership-of='WORKGROUP\Domain Users'
</pre></div><div class="refsect1" title="トラブルシューティング"><a name="id2487229"/><h2>トラブルシューティング</h2><p>もしも、ntlm_authの、NTLMSSP認証ヘルパ (--helper-protocol=squid-2.5-ntlmssp)
	に対して、MS Windows 9X または Millenium Edition 配下で
	MSIEを動かして認証の問題が発生したら、
<a class="ulink" href="http://support.microsoft.com/support/kb/articles/Q239/8/69.ASP" target="_top">
	の、Microsoft Knowledge Baseの#239869を見て，そこに書いてある
	ことを実行すること。</a></p></div><div class="refsect1" title="バージョン"><a name="id2487252"/><h2>バージョン</h2><p>このマニュアルページは Samba 3 対応のものである。</p></div><div class="refsect1" title="著者"><a name="id2487263"/><h2>著者</h2><p>オリジナルの Samba ソフトウェアと関連ユーティリティは、
	Andrew Tridgellによって作成された。 現在 Samba は、Samba Team
	 によってLinux カーネルの 開発と同様に、オープンソースプロジェク
	トとして開発されている。</p><p>The ntlm_authのマニュアルページは Jelmer Vernooij と
	Andrew Bartlett によって書かれた。</p></div><div class="refsect1" title="日本語訳"><a name="id2487285"/><h2>日本語訳</h2><p>このマニュアルページは Samba 3.0.23 - 3.4.7  対応のものである。</p><p>このドキュメントの Samba 3.0.24 対応の翻訳は
たかはしもとのぶ (monyo@samba.gr.jp) によって行なわれた。</p><p>このドキュメントの Samba 3.2.4 - 3.4.7 対応の翻訳は
太田俊哉 (ribbon@samba.gr.jp) によって行なわれた。</p></div></div></body></html>
