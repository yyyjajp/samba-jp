<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<chapter id="samba-pdc">

<chapterinfo>
	&author.jht;
	&author.jerry;
	&author.dbannon;
	<author>&person.gd; <contrib>LDAP updates</contrib></author>
</chapterinfo>

<title>ドメイン制御</title>

<para>
Microsoft Windows のネットワークの世界に考えられないような誤解をしている人が
たくさんいる。それは私たちが支援を提供できる機会が増えるということですからそれはそれでいいのだが、
この分野で本当にヘルプを必要とする人は、まず、既に一般向けに出されている情報に親しむことを
推奨する。
</para>

<para>
<indexterm><primary>ドメイン</primary><secondary>コントローラ</secondary></indexterm>
ある程度の基本を理解・修得されてからこの章を読み進めることを推奨する。Microsoft Windowsネットワーク
では、誤った設定の影響がはっきりと現れる。Microsoft Windows ネットワークのユーザーから、
ネットワーク設定の誤りに起因すると思われる細かなトラブルにしつこく悩まされるという
苦情が出ることがよくある。ところが、多くの人々にとって Microsoft Windowsネットワークの
世界というのはドメインコントローラーを知るところから始まり、それはネットワーク操作の障害を
魔法のように、すべて解決してくれそうに思えるてくるものである。
</para>

<para>
<link linkend="domain-example">ドメインの例の図解</link>は典型的な、Microsoft 
Windows ネットワーク ドメインセキュリティネットワーク環境を図示している。
ワークステーションA、BとCは多くの物理的なMicrosoft Windowsネットワーククライアント
を代表していると考えられたい。
</para>

<figure id="domain-example">
	<title>ドメインの例</title>
	<imagefile scale="40">domain</imagefile>
</figure>

<para>
Sambaメーリングリストから、よくあるネットワークに関する問題の多くを容易に特定できる。
もしも以下の話題についてよく分からないのであれば、それについて取り扱っている、
このHOWTO文書の節を読むことを強く勧める。以下は、最も一般的なMicrosoft Windows
ネットワークの問題である:
</para>

<itemizedlist>
	<listitem><para>基本的なTCP/IPの設定</para></listitem>
	<listitem><para>NetBIOS名の解決方法</para></listitem>
	<listitem><para>認証の設定</para></listitem>
	<listitem><para>ユーザとグループの設定</para></listitem>
	<listitem><para>UNIX/Linux上での基本的なファイルとディレクトリのアクセス制御</para></listitem>
	<listitem><para>ネットワーク環境中でMicrosoft Windowsクライアントがどのようにやりとりをするかの理解</para></listitem>
</itemizedlist>

<para>
がっくりする必要はない。Microsoft Windowsのネットワーク機能は、一見、大変シンプルで
誰でもできそうに見える。実際には、適切な研修と準備をしないで Microsoft Windows ネットワーク
を設定するのは、あまりよい考えとは言えない。とはいえ、なかなか払拭できない思い込みをちょっと
脇にどけることにしよう。<emphasis>ミスを犯すのもいいことです!</emphasis>時と場合によっては
失敗も教訓となる。しかし、生産性のロスを招き、組織に不可避の財政負担を強いるようなミスを
犯してもよいわけではない。
</para>

<para>
それでは、ミスを犯してもよい場所とはどこであろうか? それは実害のない場所である。ミスを犯すなら、
テストネットワーク上で、ユーザーから遠く離れた場所で、他の人に苦痛を与えない状況でやってほしい。
</para>

<sect1>
<title>機能と利便性</title>

<para>
<indexterm><primary>ドメインセキュリティ</primary></indexterm>
<emphasis>Microsoftドメインセキュリティの最も重要な利便性は何か?</emphasis>
</para>

<para>
<indexterm>シングルサインオン<primary></primary><see>SSO</see></indexterm>
<indexterm><primary>trust</primary></indexterm>
<indexterm><primary>アカウント</primary></indexterm>
<indexterm><primary>ドメイン</primary><secondary>セキュリティ</secondary><tertiary>プロトコル</tertiary></indexterm>
要するに、<emphasis>シングルサインオン</emphasis>、あるいは短く言えばSSO
である。これは多くの人にとって、Microsoft Windows NT 以後のネットワーキング
における聖杯である。SSOは、ユーザーのユーザーアカウントが存在するドメインの
メンバであるワークステーション(あるいは、アクセスするドメインとの間に適切な
信頼関係があるドメインに属するワークステーション)のいずれからも、ネットワーク
にログオンできるという優れた設計を可能にする。ユーザは、自分のホームの(個人の)
ワークステーションの前に座っているかのように、ネットワークにログオンでき、
リソース(共有、ファイル、プリンタ)にアクセスできる。これはドメインセキュリティ
プロトコルの一つの特長である。
</para>

<para>
<indexterm><primary>SID</primary></indexterm>
<indexterm><primary>RID</primary></indexterm>
<indexterm><primary>relative identifier</primary><see>RID</see></indexterm>
<indexterm><primary>セキュリティ識別子</primary><see>SID</see></indexterm>
<indexterm><primary>アクセス制御</primary></indexterm>
Samba PDCを実装するサイトは、ドメインセキュリティの利便性を享受できる。ドメイン
は、固有のネットワーク・セキュリティ識別子(SID)を提供する。ドメインユーザと
グループセキュリティの識別子は、ネットワーク SID に、アカウント毎に一意の
相対識別子(RID)を付け足したものである。ユーザとグループのSID(ネットワークSID
+RID)は、ネットワークリソースに付けられるアクセス制御リスト(ACL)を作成するのに
使用され、組織内のアクセス制御を可能にする。UNIXシステムは、ローカル
セキュリティ識別子のみ認識する。
</para>

<para>
<indexterm><primary>SID</primary></indexterm>
SIDはセキュリティコンテキストを表す。例をあげると、おのおののWindows
マシンは固有のSIDを持つローカルマシンのセキュリティコンテキストでの
ローカルアカウントを持つ。すべてのドメイン(NT4、ADS、Samba)は
ドメインSIDによって定義されるセキュリティドメインセキュリティコン
テキストで存在するアカウントを含む。
</para>

<para>
<indexterm><primary>SID</primary></indexterm>
<indexterm><primary>RID</primary></indexterm>
ドメインメンバサーバはドメインSIDとは異なるSIDを持つ。ドメインメンバ
サーバはすべてのドメインユーザをローカルユーザとして見なすように
設定できる。SIDは持続的である。標準的なドメインのユーザSIDは以下の
ようなものである:
<screen>
S-1-5-21-726309263-4128913605-1168186429
</screen>
すべてのアカウント(ユーザ、グループ、マシン、信頼関係など)はRIDが割り当てられる。
これは、アカウントが作成された時に自動的に行われる。UNIX OSはユーザとグループ
識別子に別々の名前空間を使う(UIDとGID)が、Windowsは同じ名前空間からRIDを
割り当てる。WindowsユーザとWindowsグループは同じRIDを持てない。ちょうどUNIX
ユーザ<literal>root</literal>がUID=0であるように、Windows Administrator
は、よく知られたRID=500を持つ。RIDはWindowsドメインRIDに連結され、そのため、
上記のSIDを持つドメインのAdministratorアカウントは下記のユーザSIDを持つ。
<screen>
S-1-5-21-726309263-4128913605-1168186429-500
</screen>
Windowsネットワーク領域中での残りのすべてのアカウントは全体で一意なセキュリティ
識別子を持つ。
</para>

<note><para>
<indexterm><primary>ドメイン</primary><secondary>メンバ</secondary></indexterm>
<indexterm><primary>マシンアカウント</primary></indexterm>
<indexterm><primary>domain</primary><secondary>trust account</secondary></indexterm>
Microsoft Windows ドメインセキュリティ環境でのネットワーククライアントは提供される
高度な機能にアクセス出来るためには、ドメインメンバでなければならない。ドメイン
メンバシップはワークグループ名をドメイン名に設定するだけではない。ワーク
ステーションに対する(マシンアカウントと呼ばれる)ドメイン信頼アカウントの作成
が必要である。より詳細については
<link linkend="domain-member">ドメインメンバシップ</link>を参照のこと。
</para></note>

<para>
以下の機能はSamba-3リリースで新規に追加された:
</para>

<itemizedlist>
	<listitem><para>
	<indexterm><primary>アカウント</primary><secondary>バックエンド</secondary></indexterm>
	Samba-3はユーザ、グループとマシンアカウントが格納される時に使われる
	バックエンドの選択を行う事をサポートしている。複数のパスワードバックエンド
	を、付加的なデータセット、あるいはフェールオーバデータセットのどちらでも、
	組み合わせて使うことが出来る(訳注:今は使えない)。
	</para>

	<para>
	<indexterm><primary>LDAP</primary></indexterm>
	<indexterm><primary>replicated</primary></indexterm>
	<indexterm><primary>distributed</primary></indexterm>
	<indexterm><primary>拡張性</primary></indexterm>
	<indexterm><primary>信頼性</primary></indexterm>
	LDAP passdbバックエンドは、拡張性と高いレベルでの信頼性を
	提供するという理由で、とても価値のある、アカウントバックエンドが
	分散かつ複製が出来るメリットを享受できる。
	</para></listitem>

	<listitem><para>
	<indexterm><primary>ドメイン間</primary><secondary>信頼</secondary><tertiary>アカウント</tertiary></indexterm>
	<indexterm><primary>信頼アカウント</primary><secondary>ドメイン間</secondary></indexterm>
	<indexterm><primary>相互運用性</primary></indexterm>
	Windows NT4のドメイン信頼関係である。Samba-3haワークステーションと
	サーバ(マシン)信頼アカウントをサポートする。これは、ネットワークの
	スケーラビリティと相互運用性をさらに支援する、NT4スタイルのドメイン
	間信頼アカウントをサポートする。
	</para></listitem>
	
	<listitem><para>
	<indexterm><primary>NetBIOS</primary></indexterm>
	<indexterm><primary>raw SMB</primary></indexterm>
	<indexterm><primary>active directory</primary></indexterm>
	<indexterm><primary>ドメイン</primary><secondary>メンバサーバ</secondary></indexterm>
	<indexterm><primary>ドメイン</primary><secondary>コントローラ</secondary></indexterm>
	<indexterm><primary>ネットワーク</primary><secondary>ブラウジング</secondary></indexterm>
	
	NetBIOS over TCP/IPなしの操作は、むしろraw SMB over TCP/IPを使うことである。注意:
	これはMicrosoft active directoryドメインメンバサーバとして操作する時にのみ
	実行可能である。Sambaドメインコントローラとして動作する時、NetBIOSの使用は、
	ネットワークブラウジングのサポートを提供するために必要である。
	</para></listitem>

	<listitem><para>
	<indexterm><primary>WINS</primary></indexterm>
	<indexterm><primary>TCPポート</primary></indexterm>
	<indexterm><primary>セッションサービス</primary></indexterm>
	Samba-3はNetBIOSネームサービス(WINS)、NetBIOS ever TCP/IP(TCPポート139)、
	SMB over TCP(TCP port 445)セッションサービスとMicrosoft互換のONC DCE 
	RPCサービス(TCPポート135)を提供する。
	</para></listitem>

	<listitem><para>
	<indexterm><primary>Nexus.exe</primary></indexterm>
	ドメインに対してユーザーマネージャ経由でユーザとグループを管理する。
	これは、Windows 9x/Meでは<filename>Nexus.exe</filename>を使い、
	Windows NT4/200x/XPプラットフォームではSRVTOOLS.EXEを使って任意の
	Microsoft Windows クライアントで行える(訳注:Windows Vista/7では
	使えません)。
	</para></listitem>

	<listitem><para>
	Unicodeの完全な実装。これは、ロケール間での国際化サポートを容易にする。
	これはまた完全なUnicodeサポートを必要とするためには使えないSamba-2.2.x
	のプロトコルの使用を開く(訳注:Opensの意味が....)。
	</para></listitem>
</itemizedlist>

<para>
以下の機能はSamba-3では提供されていない:
</para>

<itemizedlist>
	<listitem><para>
	<indexterm><primary>SAM</primary></indexterm>
	<indexterm><primary>複製</primary></indexterm>
	NT4ドメインコントローラ間でのSAMの複製(すなわちSamba PDCとWindows NT BDCまたはその他)。
	これは、Sambaが、PDCがMicrosoftベースのWindows NT PDCである時にBDCと
	して動作出来ないことを意味する。Samba-3はWindows PDCとBDCでのアカウント
	データの複製に参加できない。
	</para></listitem>
	
	<listitem><para>
	<indexterm><primary>kerberos</primary></indexterm>
	<indexterm><primary>active directory</primary></indexterm>
	Windows 2000 Active Directoryドメインコントローラとして振る舞う
	(すなわち、KerberosとActive Directory)。実際の所、Samba-3は
	現時点ではまだ実験的な、Active Directory ドメイン制御の機能を
	いくつか持っている。Active Directoryドメイン制御は次の世代の
	Sambaリリースである、Samba-4で現在開発中の機能である。現時点では
	Samba-3ライフサイクル中でActive Directoryドメイン制御を有効にする
	計画はない。
	</para></listitem>

	<listitem><para>
	<indexterm><primary>MMC</primary></indexterm>
	<indexterm><primary>SVRTOOLS.EXE</primary></indexterm>
	<indexterm><primary>Microsoft management console</primary><see>MMC</see></indexterm>
	Windows 200x/XPのMicrosoft管理コンソール(MMC)はSamba-3サーバの管理に
	は使えない。このために、Microsoft Windows NT4ドメインサーバマネージャと
	Microsoft Windows NT4ドメインユーザマネージャのみが使える。両者は
	この後説明するSVRTOOLS.EXEパッケージ中の一部である。
	</para></listitem>
</itemizedlist>

<para>
<indexterm><primary>Windows XP Home エディション</primary></indexterm>
<indexterm><primary>LanMan</primary></indexterm>
この章中で概要が説明されている理由により、ドメインの真のメンバに、
Windows 9x/Me/XP Homeクライアントはなれない。Windows9x/Meスタイルの
ネットワーク(ドメイン)ログオンプロトコルはNT4/Windows 200xスタイルの
ドメインログオンとは完全に異なり、それはいつか公式にサポートされる。
これらのクライアントはおおよそSamba-1.9.15シリーズからサポート
された古いLanManネットワークログイン機能を使う。
</para>

<para>
<indexterm><primary>グループ</primary><secondary>マッピング</secondary></indexterm>
Samba-3ではWindows NT グループとUNIXグループ間でのグループマッピングを実装
している(これは、小さなスペースでは説明できないくらい非常に複雑で
ある)。これについての詳細については
<link linkend="groupmapping">グループマッピング:Microsoft WindowsとUNIX</link>
を参照のこと。
</para>

<para>
<indexterm><primary>マシン信頼アカウント</primary></indexterm>
<indexterm><primary>信頼アカウント</primary><secondary>マシン</secondary></indexterm>
<indexterm><primary>マシンアカウント</primary></indexterm>
Samba-3はMicrosoft Windows NT4 PDCまたはWindows200x Active Directory
と同様に、それにふさわしいバックエンドデータベースにユーザとマシン
信頼アカウント情報を格納することを必要とする。これについては、
<link linkend="machine-trust-accounts">Microsoft Windows Workstation/Server マシン信頼アカウント</link>
を参照のこと。Samba-3では複数のバックエンドが用意されている。
完全なアカウントデータベースバックエンドについての解説は
<link linkend="passdb">アカウント情報データベース</link>にある。
</para>

</sect1>

<sect1>
<title>シングルサインオンとドメインセキュリティ</title>

<para>
<indexterm><primary>シングルサインオン</primary><see>SSO</see></indexterm>
<indexterm><primary>SSO</primary></indexterm>
<indexterm><primary>active directory</primary></indexterm>
<indexterm><primary>認証</primary></indexterm>
<indexterm><primary>validation</primary></indexterm>
<indexterm><primary>パスワードの一意性</primary></indexterm>
<indexterm><primary>パスワード履歴</primary></indexterm>
ネットワーク管理者が、Windows NT4とactive directoryネットワークの利点に
ついて説明を求められるとき、しばしば言及するのが、シングルサインオン
(SSO)を実装しているということである。多くの会社がSSOを実装している。
シングルサインオンソリューション実装のモードは、一般的に、ネットワーク
業務における重要な要因であり、Windowsネットワークに関してとても重要で
ある。会社には多くの種類の情報システムがあり、それぞれはユーザ認証と認可
(訳注:authentication and validation)を要求し、そのため、一般的
ではないが、ユーザは10以上のログインIDとパスワードを記憶する必要が
あるかもしれない。この問題は、おのおののシステムのパスワードが
一定期間で更新が必定で、パスワードの複雑さとパスワード履歴が
適用されるときには特に顕著となる。
</para>

<para>
<indexterm><primary>管理のオーバヘッド</primary></indexterm>
非常にたくさんの情報システムに対するアクセス権限(ユーザ名/パスワードペア)
を扱うユーザの問題に対する回答がSSOであるという認識を包括的に
持っている。多くの巧妙な案が、ユーザフレンドリーなSSOのソリューション
を提供可能にするために考案された。問題は、この導入がうまく終わって
いない場合、サイトは複雑さによるたくさんの費用と管理上のオーバヘッド
が起きるかもしれないということである。簡単言って、多くのSSOソリュー
ションは管理上の悪夢である。
</para>

<para>
<indexterm><primary>identity management</primary></indexterm>
<indexterm><primary>認証システム</primary></indexterm>
<indexterm><primary>SSO</primary></indexterm>
SSOを使うことですべてのユーザアカウント情報を集中管理できる。
環境の複雑さと、SSOを導入したシステムの稼働期間に依存して、
新しいアイデンティティ管理とユーザ認証システムを受け入れること
は可能ではないかもしれない。多くのSSOソリューションは、
ユーザのための認証を処理する新しい上位の構造から成り立つ
レガシーシステムを改良する。これは、SSOの追加は全体的な情報
システムの複雑さを増大することを意味する。理想的には、SSOの
導入は複雑さの低減と管理オーバヘッドの削減をすべきである。
</para>

<para>
<indexterm><primary>集中化したアイデンティティ管理</primary></indexterm>
<indexterm><primary>アイデンティティ管理</primary><secondary>集中化</secondary></indexterm>
<indexterm><primary>集中化</primary><secondary>認証</secondary></indexterm>
<indexterm><primary>レガシーシステム</primary></indexterm>
<indexterm><primary>アクセス制御</primary></indexterm>
たくさんのネットワーク管理の最初のゴールは、しばしば集中管理した
アイデンティティ管理システムを作り、使うことである。これは、
そのような集中化したシステムは、すべての情報システムによって
使うことが出来る単一の認証基盤を使うことをしばしば仮定している。
Microsoft Windows NT4セキュリティドメインアーキテクチャとMicrosoft
Active Directoryサービスは、そのようなシステムに対しての理想的な
基盤としてしばしば提供される。ユーザの認証とアクセス制御のために
Microsoft(NT4ドメインかadsサービス)を使うことが出来る単一の
認証基盤を使う、そのような集中化したシステムがしばしば仮定される。
単一の集中化した認証サービスのすばらしい幻想は一般的に、現実を
理解するときに一般的に壊れている。レガシーシステムを使うときの問題
は、その導入がリエンジニアリングの観点から、過度に侵略的になるか、
アプリケーションソフトが、設計されて実装されたユーザ認証の特定の
要素に依存して組み込まれているという理由により、認証とアクセス制御
を具体化する能力がしばしばないということである。
</para>

<para>
<indexterm><primary>メタディレクトリ</primary></indexterm>
<indexterm><primary>credentials</primary></indexterm>
<indexterm><primary>disparate information systems</primary></indexterm>
<indexterm><primary>管理手続き</primary></indexterm>
<indexterm><primary>ワークフロープロトコル</primary></indexterm>
<indexterm><primary>rights</primary></indexterm>
<indexterm><primary>privileges</primary></indexterm>
<indexterm><primary>provisioned</primary></indexterm>
これまでの10年間、産業が、レガシー名情報テクノロジーシステムの
制限の鍵となる点を回避するために作られた、いろいろな方法が開発
されてきた。しばしば使われるその1つの方法はメタディレクトリを
使うことである。メタディレクトリには、それぞれのシステムに固有な
形式で、すべての異なる情報システムのためにユーザ認証情報を保存
する。単一のユーザ認証情報を使うすべてのシステムのために、新しい
基盤がユーザアクセスを可能にさせることが提供されるシステムの
迷宮の中で、ユーザ権限と権利(rights and privileges)を管理する
ための厳格に実施されるワークフロープロトコルに、管理手続き
の巧妙なセットが結合される。
</para>

<para>
<indexterm><primary>Organization for the Advancement of Structured Information Standards</primary><see>OASIS</see></indexterm>
<indexterm><primary>Security Assertion Markup Language</primary><see>SAML</see></indexterm>
<indexterm><primary>Federated Identity Management</primary><see>FIM</see></indexterm>
<indexterm><primary>安全なアクセス</primary></indexterm>
Organization for the Advancement of Structured Information Standards (OASIS)
は、認証情報の通信のための構造化情報であるSecurity Assertion Markup Language (SAML)
を開発している。SAMLを配置するための全体的な技術と手法の包括的名称(訳注:umbrella name)は
Federated Identity Management (FIM)と呼ばれる。FIMはそれぞれのユーザを認証
するための異なった情報システムの複雑な迷宮中で、かつおのおのが提供するサービス
の安全なアクセスを請け負うために、おのおののシステムに依存する。
</para>

<para>
<indexterm><primary>Simple Object Access Protocol</primary><see>SOAP</see></indexterm>
<indexterm><primary>federated organizations</primary></indexterm>
<indexterm><primary>Liberty Alliance</primary></indexterm>
<indexterm><primary>federated-identity</primary></indexterm>
<indexterm><primary></primary></indexterm>
<indexterm><primary></primary></indexterm>
SAML文書はWebサービスのために必要なコンピュータ間通信のための
Simple Object Access Protocol (SOAP)メッセージ中に包むことが出来る。
あるいは、ライブサービスを共有する集合化したWebサービス間で渡される
かもしれない。リバティ・アライアンスは、SAML1.1をアプリケーション
フレームワークとして適用した、連携型アイデンティティ標準
(訳注:federated-identity standards)を普及させるために作られた
コンソーシアム(訳注:industry group)である。MicrosoftとIBMは
WS-Securityと呼ばれる別の方式を提案していた。ある人は、競合して
いる技術と手法がSAML 2.0標準が世に出るときにまとまるのではないか
と信じていた。現在ではごく少数のWebアクセス管理製品のみがSAMLを
サポートしているが、技術の実装は、アプリケーション統合のための
カスタマイズとユーザインタフェースの開発のために、主に必要と
される。要するに、それがなぜFIMが大木つて成長している産業である
かの理由である。
</para>

<para>
<indexterm><primary>相互運用性</primary></indexterm>
<indexterm><primary>ADS</primary></indexterm>
<indexterm><primary>LDAP</primary></indexterm>
<indexterm><primary>GSSAPI</primary></indexterm>
<indexterm><primary>general security service application programming interface</primary><see>GSSAPI</see></indexterm>
この本の向こうの範囲の大きな絵を無視し、集中したシステムへのすべての
ユーザとグループのマイグレーション管理は、正しい方向への第一歩である。
Microsoft Active Directoryサービス(ADS)やその他のプロプライエティな
ものか、general security service application programming interface
(GSSAPI)サービスによって定義されているプロトコルを使う数々の認証
メカニズム(kerberosのような)の柔軟な組み合わせができる情報アクセス
(LDAPのような)のための、標準プロトコルを提供するオープンソースシステム
のような、ディレクトリ中にアイデンティティ管理システムデータを位置づける
のは、相互運用性のための基本である。
</para>

<para>
<indexterm><primary>OpenLDAP</primary></indexterm>
<indexterm><primary>ADS</primary></indexterm>
<indexterm><primary>認証エージェント</primary></indexterm>
ますます多くの会社がLDAPシステムを使うことを許可するための異なったレガシー
プラットフォームのために認証エージェントを提供する。OpenLDAPの使用で、
LDAP標準のオープンソース実装が支配的である。実際、LDAPとMicrosoft
ADSを使うためにSambaで提供することは、Sambaが、高度な拡張性と
Sambaは、組織のネットワーク技術に届くように前進することを意味する。
</para>

<para>
<indexterm><primary>ADS</primary></indexterm>
<indexterm><primary>LDAP</primary></indexterm>
<indexterm><primary>認証アーキテクチャ</primary></indexterm>
<indexterm><primary>ntlm_auth</primary></indexterm>
<indexterm><primary>SQUID</primary></indexterm>
<indexterm><primary>FIM</primary></indexterm>
Microsoft ADSは、集中化した認証基盤を提供するために拡張できる、
制限付きの完全に商用なサービスを提供する。SambaとLDAPは、集中化した
認証基盤の拡張のための同様な機会を提供するが、実際、Sambaチームは、
LDAPあるいは他のものを使って、認証サービスの拡張の導入中で、
、持続可能な選択とFIMマーケットプレイス中での競合をより多く作成する、
<command>ntlm_auth</command>ユーティリティのような完全なツールを
SQUID(OSSのプロキシサーバ)のようなアプリケーションのために
先を見越している。
</para>

<para>
<indexterm><primary>LDAP</primary></indexterm>
<indexterm><primary>OpenLDAP</primary></indexterm>
<indexterm><primary>identity information</primary></indexterm>
もしも、プライマリドメインコントロールが大きなサイトに適合した拡張性
があれば、LDAPを使うことが出来るに違いない。それを使うためのすばやい
OpenLDAPとSambaの設定は、ディレクトリの時代が始まったことの十分な
証明である。Samba-3はLDAPの使用を要求しないが、分散可能なユーザと
グループのイデンティティ情報のメカニズムのための要求は、それを不可避の
選択としている。
</para>

<para>
<indexterm><primary>BDC</primary></indexterm>
<indexterm><primary>LDAP</primary></indexterm>
<indexterm><primary>e-Directory</primary></indexterm>
この時点で、SambaベースのBDCの使用は、LDAPアクセスありの使用を必要と
する。最も一般的な、Sambaサイトによって使われるLDAP実装はOpenLDAP
である。標準準拠の任意のLDAPサーバを使うことも可能である。それらは、
IBM、CA、Novell(e-Directory)とその他で知られている。
</para>

</sect1>

<sect1>
<title>ドメイン制御の基礎</title>

<para>
<indexterm><primary>ドメイン制御</primary></indexterm>
長年の間、一般的に、ドメイン制御が神秘的なものを持っているという
ことが認識されてきていた。ドメイン制御についての簡単な説明に
入る前に、ドメインコントローラに3種類があることについて説明する。
</para>

<sect2>
<title>ドメインコントローラの種類</title>

<itemizedlist>
	<listitem><para>NT4スタイルプライマリドメインコントローラ</para></listitem>
	<listitem><para>NT4スタイルバックアップドメインコントローラ</para></listitem>
	<listitem><para>ADSドメインコントローラ</para></listitem>
</itemizedlist>

<para>
<indexterm><primary>PDC</primary></indexterm>
<indexterm><primary>powerful</primary></indexterm>
<indexterm><primary>ネットワーク</primary><secondary>パフォーマンス</secondary></indexterm>
<indexterm><primary>ドメイン</primary><secondary>メンバ</secondary><secondary>サーバ</secondary></indexterm>
<emphasis>プライマリドメインコントローラ</emphasis>あるいはPDCはMicrosoft
Windows NTで重要な役割を演じる。Windows 200xドメインアーキテクチャ中では
この役割はドメインコントローラによって保持されている。Microsoft Windows
ネットワーク中の役割の理由から、フォークロアはそれを指示し(訳注:意味取れない)、
ドメインコントローラはネットワーク中で最も性能が高く、最も能力があるマシン
であるべきである。ここで言うのもとても奇妙に見えるが、ネットワーク全体での
よいパフォーマンスは、すべてのインフラストラクチャーがバランスされている
ことを必要とすることを指示する。ドメインコントローラ中よりもスタンドアロン
(ドメインメンバ)中でより投資することは賢明である。
</para>

<para>
<indexterm><primary>SAM</primary></indexterm>
<indexterm><primary>BDC</primary></indexterm>
<indexterm><primary>認証</primary></indexterm>
<indexterm><primary>同期</primary></indexterm>
<indexterm><primary>Security Account Manager</primary><see>SAM</see></indexterm>
Microsoft Windows NT4スタイルドメインの場合、新しいドメイン制御データベースを
初期化するのはPDCである。この形式は、Security Account Manager (SAM)と呼ばれる
Windowsレジストリの一部である。これは、NT4スタイルのドメインユーザの認証と
BDCのドメイン認証データベースとの同期で最も中心的な部分を行う。
</para>

<para>
<indexterm><primary>ドメイン</primary><secondary>コントローラ</secondary><tertiary>階層</tertiary></indexterm>
<indexterm><primary>LDAP</primary></indexterm>
<indexterm>アカウント<primary></primary><secondary>バックエンド</secondary></indexterm>
<indexterm><primary>マシンアカウント</primary></indexterm>
Microsoft Windows 200xサーバベースのActive Directoryドメインで、一つのドメイン
コントローラが、そのおのおのが委託された制御の固有領域であるドメインコント
ローラの潜在的な階層を初期化する。マスタドメインコントローラは任意の下位
コントローラを上書きする能力を持っているが、下位のコントローラはその下位の
コントローラのみ制御する。Samba-3では、この機能はLDAPベースのユーザとマシン
アカウントバックエンドを使うことで実現できる。
</para>

<para>
<indexterm><primary>バックエンドデータベース</primary></indexterm>
<indexterm><primary>レジストリ</primary></indexterm>
Samba-3では新規にNT4スタイルのSAMデータベース(レジストリファイルの1つ)で
同じタイプのデータを保持するバックエンドデータベースを使う能力を持つ。
<footnote><para><link linkend="passdb">アカウント情報データベース</link>
を参照のこと。</para></footnote>
</para>

<para>
<indexterm><primary>BDC</primary></indexterm>
<indexterm><primary>PDC</primary></indexterm>
<indexterm><primary>WINS</primary></indexterm>
<indexterm><primary>authentication</primary></indexterm>
<indexterm><primary>netlogon</primary></indexterm>
<indexterm><primary>name lookup</primary></indexterm>
<emphasis>バックアップドメインコントローラ</emphasis>またはBDCはネットワーク
認証サービス中で重要な役割を演じる。BDCはPDCに優先してログオン要求に答える
ために、バイアスをかけられる。BDCとPDCがあるネットワークセグメント上で、
BDCはネットワークログオン要求を最もサービスする。PDCはBDCがとても忙しい
(ロードアベレージが大きい)ときにログオン要求に応える。ユーザがWindows
ドメインメンバクライアントにログオンした時、ワークステーションは最も近い
ネットワークログオンサーバに位置づけるために、ネットワークに問い合わせを
行う。WINSサーバが使われている時、これは問い合わせを経由してWINSサーバ
で行われる。もしもネットログオンサーバがWINS問い合わせから見つからないか、
WINSサーバがない場合、ワークステーションはUDPブロードキャストプロトコル
上でmailslotブロードキャスト経由でNetBIOS名前検索を実行する。これは、
Windowsクライアントが使うことが出来るネットログオンサーバがたくさんの
変数によって影響され、それゆえ、PDCまたはBDCが特定のログオン認証要求
を処理する単純な決定要素はない。
</para>

<para>
<indexterm><primary>promote</primary></indexterm>
<indexterm><primary>demote</primary></indexterm>
Windows NT4 BDCはPDCに昇格することが出来る。BDCがPDCに昇格する時にPDC
がオンラインならば、以前のPDCは自動的にBDCに降格する。Samba-3では
これは自動的な操作ではない。PDCとBDCは手動で設定し、その他の適切な
変更も行う必要がある。
</para>

<para>
<indexterm><primary>ドメイン</primary><secondary>コントローラ</secondary><tertiary>変換</tertiary></indexterm>
Microsoft Windows NTPでは、サーバのマシンタイプが何になるかを決める
ためにインストール時に決定が行われる。BDCからPDCへの昇格やその他も
可能である。Windows NTPドメインコントローラからドメインメンバサーバ
かスタンドアロンサーバへの変換のためにMicrosoftが提供している唯一の
手法は、再インストールである。インストール時に提供されている選択肢
は以下の通り:
</para>

<itemizedlist>
	<listitem><para><emphasis>プライマリドメインコントローラ</emphasis> &smbmdash; ドメインSAMの頒布元。</para></listitem>
	<listitem><para><emphasis>バックアップドメインコントローラ</emphasis> &smbmdash; ドメインSAMのコピーを受け取る。</para></listitem>
	<listitem><para><emphasis>ドメインメンバサーバ</emphasis> &smbmdash; ドメインSAMのコピーを持たない。すべてのアクセス制御のためにドメインコントローラから認証を受け取る。</para></listitem>
	<listitem><para><emphasis>スタンドアロンサーバ</emphasis> &smbmdash; SAM同期を行わないサーバで、固有の認証データベースを持ち、ドメインセキュリティでは何の役割も担わない。</para></listitem>
</itemizedlist>

<note><para>
<indexterm><primary>promote</primary></indexterm>
Algin Technology LLC はWindows NT4スタンドアロンサーバをPDCまたはBDCに昇格
することとその逆ができるが可能な商用ツールを提供している。さらなる情報は
<ulink url="http://utools.com/UPromote.asp">Algin</ulink>のWebサイトを参照
のこと。
</para></note>

<para>
<indexterm><primary>ドメイン</primary><secondary>制御</secondary><tertiary>役割</tertiary></indexterm>
<indexterm><primary>native member</primary></indexterm>
Samba-3サーバは&smb.conf;ファイルに簡単な変更をすることで、ドメイン
コントローラへ、あるいはドメインコントローラから容易に変換できる。
Samba-3はWindows200xサーバのActive Directoryドメインでのネイティブ
なメンバとして完全に振る舞える。
</para>

<para>
<indexterm><primary>変換</primary><secondary>ドメインメンバサーバ</secondary></indexterm>
完全な図を提供するために、Microsoft Windows 2000 ドメイン制御の設定は
サーバがインストールされた後に行われる。ドメインメンバサーバへの変換、
あるいはドメイン制御からの変換を行うための手順と、Active Directory
サービスのサポートのインストール、あるいはActive Directoryから抜ける
ための方法については、Microsoftの資料を参照してほしい。
</para>

<para>
<indexterm><primary>複製</primary><secondary>SAM</secondary></indexterm>
<indexterm><primary>SAM</primary><secondary>複製</secondary></indexterm>
Samba-3での新機能として、SAM複製コンポーネントを除く、Microsoft Windows
NT4スタイルのドメインコントローラ機能の実装が上げられる。しかし、Samba-3
はMicrosoft Windows 200xドメイン制御プロトコルのサポートを行うことに
注目してほしい。
</para>

<para>
<indexterm><primary>ADS</primary></indexterm>
現時点で、ネイティブADSモード中での<emphasis>ドメインコントローラ</emphasis>
としてSamba-3は振る舞うことが出来る任意の外観(訳注:もっといい訳がありそう)は、本質的に制限されていて
実験的である。この機能はSambaチームがそれに対する公式のサポートを提供する
まで使うべきでない。その時点でドキュメントはすべての設定と管理要件を
正当に反映するために改訂されるだろう。SambaはWindows 2000/XP環境中
ではNT4スタイルのドメインコントローラとして振る舞うことが出来る。しかし、
ある程度の妥協がある:
</para>

<itemizedlist>
	<listitem><para>マシンポリシーファイルがない</para></listitem>
	<listitem><para>グループポリシーオブジェクトがない。</para></listitem>
	<listitem><para>同期して実行されるActive DirectoryNログオンスクリプトがない。</para></listitem>
	<listitem><para>ユーザとマシンを管理するためのActive directory管理ツールが使えない。</para></listitem>
	<listitem><para>レジストリの変更がメインのレジストリを修正するため、Active Directoryを使うときには、結果として恒久的な変更をしない(訳注:tattooの訳が微妙)。</para></listitem>
	<listitem><para>Active Directoryなしでユーザとグループを指定するための特定のアプリケーションをエクスポートする機能を実行できない。</para></listitem>
</itemizedlist>

</sect2>

<sect2>
<title>ドメイン制御の準備</title>

<para>
<indexterm><primary>スタンドアロン</primary></indexterm>
<indexterm><primary>ワークグループ</primary></indexterm>
<indexterm><primary>メンバ</primary></indexterm>
<indexterm><primary>セキュリティ</primary></indexterm>
その他のシステムと、ドメインコントローラやお互いに相互作用を
行う2つの方法がある:そのうちの1つはより一般的には、
<emphasis>ワークグループ</emphasis>メンバとして呼ばれている
<emphasis>スタンドアロン</emphasis>システムであり、もう1つは、
より一般的には<emphasis>ドメイン</emphasis>メンバと呼ばれている、
セキュリティシステム中で完全な参与者である。
</para>

<para>
<indexterm><primary>ワークグループ</primary></indexterm>
<indexterm><primary>ワークグループ</primary><secondary>メンバシップ</secondary></indexterm>
<indexterm><primary>マシン信頼アカウント</primary></indexterm>
ワークグループメンバシップは、マシンが設定されている以外の特別な設定を必要としない
ので、一般的にそのワークグループエントリに対して使われた名前を持つネットワーク設定
を持つことに注意すべきである。これに対してWORKGROUPという名前を使うのは一般的では
ない。このモードの設定では、マシン信頼アカウントも、ネットワークコンピュータ中に
論理的に一緒にグループ化されて現れるすべてのマシンに、実際制限されるようなメンバ
シップの任意のコンセプトもない。繰り返すが、明確にすると、
<emphasis>ワークグループモードは、セキュリティマシンアカウントを必要としない</emphasis>。
</para>

<para>
<indexterm><primary>ドメインメンバシップ</primary></indexterm>
<indexterm><primary>マシン信頼アカウント</primary><secondary>パスワード</secondary></indexterm>
<indexterm><primary>トリガ</primary></indexterm>
ドメインメンバのマシンは、ドメインアカウントデータベース中にマシン信頼
アカウントを持つ。ドメインメンバシップを作るためにおのおののマシン上で
以下の特別な手続きが必要である。この手続きは、ローカルマシンのAdministrator
アカウントによってのみ行うことが出来、ドメインマシンアカウント(もしも
存在しなければ)を作成し、次にそのアカウントを初期化する。クライアントが
最初にドメインにログオンするとき、マシンアカウントのパスワード変更処理は
自動的に起動される。
</para>

<note><para>
<indexterm><primary>ドメインメンバ</primary></indexterm>
Sambaがドメインコントローラとして設定されるとき、セキュアなネットワーク操作は
すべてのMicrosoft Windows NT4/200x/XP Professionalクライアントはドメインメンバ
として設定されることを要求する。もしもマシンがドメインのメンバでなければ、
それはワークグループ(スタンドアロン)マシンとして操作される。ドメインメンバシップ
に関係する情報は <link linkend="domain-member">ドメインメンバシップ</link>
を参照してほしい。
</para></note>

<para>
以下はMicrosoft Windows NT4/200x/XPクライアントのための、Microsoft Windows
NT4スタイルとしてSamba-3を設定するために必要なことである:
</para>

<itemizedlist>
	<listitem><para>基本的なTCP/IPとMicrosoft Windows ネットワークの設定。</para></listitem>
	<listitem><para>サーバの役割の指定を修正(<smbconfoption name="security">user</smbconfoption>)。</para></listitem>
	<listitem><para>矛盾のない名前解決の設定。<footnote><para><link linkend="NetworkBrowsing">ネットワークブラウジングNetwork Browsing</link>と 
		<link linkend="integrate-ms-networks">Microsoft Windows ネットワークとSambaの統合</link>を参照。</para></footnote></para></listitem>
	<listitem><para>Windows NT4/200x/XP Professionalクライアントのためのドメインログオン。</para></listitem>
	<listitem><para>移動プロファイルの設定か、明示的な、ローカルプロファイル強制使用の設定。</para></listitem>
	<listitem><para>network/systemポリシーの設定。</para></listitem>
	<listitem><para>ドメインユーザアカウントの追加と管理。</para></listitem>
	<listitem><para>Microsoft Windows NT4/2000 ProfessionalとWindows XP Professionalクライアントマシンがドメインメンバになるような設定。</para></listitem>
</itemizedlist>

<para>
以下の準備はMicrosoft 9x/Meクライアントに提供するために必要である:
</para>

<itemizedlist>
	<listitem><para>基本的なTCP/IPとMicrosoft Windowsネットワークの設定。</para></listitem>
	<listitem><para>サーバの役割の指定を修正(<smbconfoption name="security">user</smbconfoption>)。</para></listitem>
	<listitem><para>ネットワークログイン設定(Windows 9x/Me/XP Homeは技術的にドメインメンバに
	なれないため、それらはドメインログオンにおけるセキュリティ面には真に関わらない)。</para></listitem>
	<listitem><para>移動プロファイルの設定</para></listitem>
	<listitem><para>システムポリシーハンドリングの設定。</para></listitem>
	<listitem><para><quote>Microsoft Windowsネットワーク用のクライアント</quote>ネットワークドライバのインストール
	とドメインにログオンするための設定。</para></listitem>
	<listitem><para>Windows 9x/Meクライアントをユーザレベルのセキュリティに設定 &smbmdash; もしもすべての
	クライアント共有アクセスがドメインユーザ/グループ識別子に従って制御されることを可能にすることが
	求められるならば。</para></listitem>
	<listitem><para>ドメインユーザアカウントの追加と管理。</para></listitem>
</itemizedlist>

<note><para>
<indexterm><primary>移動プロファイル</primary></indexterm>
<indexterm><primary>アカウントポリシー</primary></indexterm>
ローミングプロファイルとシステム/ネットワークプロファイルはこのドキュメントの
<link linkend="ProfileMgmt">デスクトッププロファイル管理</link>と
<link linkend="PolicyMgmt">システムとアカウントポリシー</link>で触れられている
高度なネットワーク管理項目である。しかしながら、それらはWindows NT ネットワーク
のコンセプトに関連するほど、特にSamba PDCには必要ではない。
</para></note>

<para>
SMB/CIFSサーバでのドメインコントローラは下記の通り:
</para>

<itemizedlist>
	<listitem><para>
	<indexterm><primary>NetBIOS</primary><secondary>brooadcast</secondary></indexterm>
	<indexterm><primary>WINS</primary></indexterm>
	<indexterm><primary>UDP</primary></indexterm>
	<indexterm><primary>DNS</primary></indexterm>
	<indexterm><primary>active directory</primary></indexterm>
	それ自身の登録と広告をドメインコントローラとする(UDPブロードキャスト上でのMailslot
	ブロードキャストによって、UDPユニキャスト上でWINSサーバにか、DNSとActive Directory
	経由での名前登録の方法によるのと同じようなNetBIOSブロードキャストを通して)。
	</para></listitem>

	<listitem><para>
	<indexterm><primary>NETLOGON</primary></indexterm>
	<indexterm><primary>LanMan logon サービス</primary></indexterm>
	NETLOGON サービスの提供(これは実際、複数のプロトコル上で動くサービスの集合体である。
	それらにはLanManログオンサービス、Netlogonサービス、ローカルセキュリティアカウント
	サービスとそれらのバリエーションを含む。)。
	</para></listitem>

	<listitem><para>
	NETLOGONという共有が提供される。
	</para></listitem>
</itemizedlist>

<para>
<indexterm><primary>ドメイン</primary><secondary>マスタ</secondary><tertiary>ブラウザ</tertiary></indexterm>
<indexterm><primary>ローカル</primary><secondary>マスタ</secondary><tertiary>ブラウザ</tertiary></indexterm>
<indexterm><primary>DMB</primary></indexterm>
<indexterm><primary>LMB</primary></indexterm>
<indexterm><primary>ブラウズリスト</primary></indexterm>
それらを提供するためにSambaを設定することはむしろ容易である。おのおののSamba
ドメインコントローラは <smbconfoption name="domain logons"/>機能(&smb.conf;
ファイル中のパラメータの後)とSambaが呼ぶNETLOGONサービスを提供しなければな
らない。さらに、Samba-3ドメイン中の1つのサーバはドメインマスタブラウザとして
それ自身を公告しなければならない。<footnote><para><link linkend="NetworkBrowsing">
ネットワークのブラウジング</link>を参照。</para></footnote>これは、与えられた
ドメインまたはワークグループのためのDMBとして識別されるドメイン固有のNetBIOS名
をPDCが主張するようにさせる。ブロードキャストで分離されたサブネットの、同じドメイン
またはワークグループ上の複数のローカルマスタブラウザ(LMB)は完全な広範囲な領域の
ネットワークのためのブラウズリストの完全なコピーのために問い合わせを行う。
ブラウザクライアントは次にそれらのLMBに接続し、それらのブロードキャストで分離
されたサブネットのためのリストの代わりにドメイン全体のブラウズリストを受け取る。
</para>

</sect2>
</sect1>

<sect1>
<title>ドメイン制御: 設定例</title>

<para>
Samba PDCを作成するための作業の最初のステップは&smb.conf;中で必要なパラメータの
理解である。PDCとして振る舞うための&smb.conf;の例は<link linkend="pdc-example">
PDC用のsmb.confの例</link>にある。
</para>

<example id="pdc-example">
<title>PDC用のsmb.confの例</title>
<smbconfblock>
<smbconfsection name="[global]"/>
<smbconfoption name="netbios name"><replaceable>BELERIAND</replaceable></smbconfoption>
<smbconfoption name="workgroup"><replaceable>&example.workgroup;</replaceable></smbconfoption>
<smbconfoption name="passdb backend">tdbsam</smbconfoption>
<smbconfoption name="os level">33</smbconfoption>
<smbconfoption name="preferred master">auto</smbconfoption>
<smbconfoption name="domain master">yes</smbconfoption>
<smbconfoption name="local master">yes</smbconfoption>
<smbconfoption name="security">user</smbconfoption>
<smbconfoption name="domain logons">yes</smbconfoption>
<smbconfoption name="logon path">\\%N\profiles\%U</smbconfoption>
<smbconfoption name="logon drive">H:</smbconfoption>
<smbconfoption name="logon home">\\homeserver\%U\winprofile</smbconfoption>
<smbconfoption name="logon script">logon.cmd</smbconfoption>

<smbconfsection name="[netlogon]"/>
<smbconfoption name="path">/var/lib/samba/netlogon</smbconfoption>
<smbconfoption name="read only">yes</smbconfoption>
<smbconfoption name="write list"><replaceable>ntadmin</replaceable></smbconfoption>

<smbconfsection name="[profiles]"/>
<smbconfoption name="path">/var/lib/samba/profiles</smbconfoption>
<smbconfoption name="read only">no</smbconfoption>
<smbconfoption name="create mask">0600</smbconfoption>
<smbconfoption name="directory mask">0700</smbconfoption>
</smbconfblock>
</example>

<para>
<link linkend="pdc-example">this example</link>中で示される基本的なオプションの説明は以下の通り:
</para>

<variablelist>
	<varlistentry><term>passdb backend </term>
		<listitem><para>
		<indexterm><primary>グループ</primary><secondary>アカウント</secondary></indexterm>
		<indexterm><primary>smbpasswd</primary></indexterm>
		<indexterm><primary>tdbsam</primary></indexterm>
		<indexterm><primary>ldapsam</primary></indexterm>
		<indexterm><primary>guest</primary></indexterm>
		<indexterm><primary>default accounts</primary></indexterm>
		ここにすべてのユーザとグループアカウント情報が含まれている。PDCで使える値は:
		<emphasis>smbpasswd, tdbsam, and ldapsam</emphasis>である。<quote>guest</quote>
		エントリは既定値のアカウントを提供し、それは既定値で含まれている;明示的に
		追加する必要はない。
		</para>

		<para>
		<indexterm><primary>passdb backend</primary></indexterm>
		<indexterm><primary>distributed</primary></indexterm>
		<indexterm><primary>smbpasswd</primary></indexterm>
		<indexterm><primary>tdbsam</primary></indexterm>
		BDCを使う場合、passdb backendを配信できるため、LDAPの使用が論理的な唯一の
		選択肢である。tdbsamとsmbpasswdファイルは効果的に配信できないため、それを
		使うべきではない。
		</para></listitem>
	</varlistentry>

	<varlistentry><term>ドメイン制御パラメータ</term>
		<listitem><para>
		<indexterm><primary>os level</primary></indexterm>
		<indexterm><primary>preferred master</primary></indexterm>
		<indexterm><primary>domain master</primary></indexterm>
		<indexterm><primary>network</primary><secondary>logon</secondary></indexterm>
		パラメータ<emphasis>os level, preferred master, domain master, security, 
		encrypt passwords</emphasis>と<emphasis>domain logons</emphasis>はドメイン
		制御とネットワークログオンのサポートで中心的な役割を演じる。
		</para>

		<para>
		<indexterm><primary>DMB</primary></indexterm>
		<indexterm><primary>encryped password</primary></indexterm>
		<emphasis>os level</emphasis>は32以上に、<emphasis>user</emphasis>
		モードセキュリティに、Microsoft互換の暗号化パスワードサポートに、
		ネットワークログオンサービス(ドメインログオン)の提供にしなければ
		ならない。暗号化パスワードは有効にしなければならない。どのように
		これを行うかについての詳細は、
		<link linkend="passdb">アカウント情報データベース</link>を参照のこと。
		</para></listitem>
	</varlistentry>

	<varlistentry><term>Environment Parameters </term>
		<listitem><para>
		<indexterm><primary>logon path</primary></indexterm>
		<indexterm><primary>logon home</primary></indexterm>
		<indexterm><primary>logon drive</primary></indexterm>
		<indexterm><primary>logon script</primary></indexterm>
		パラメータ<emphasis>logon path, logon home, logon drive</emphasis>と<emphasis>logon script</emphasis>
		環境は、はクライアントログオン操作機能を手助けすることと、ネットワーク管理のオーバヘッドを
		簡単にするための自動コントロール機能の提供を手助けするための設定をサポートする。
		それらのパラメータのマニュアルページの情報を参照してほしい。
		</para></listitem>
	</varlistentry>

	<varlistentry><term>NETLOGON共有</term>
		<listitem><para>
		<indexterm><primary>NETLOGON</primary></indexterm>
		<indexterm><primary>logon処理</primary></indexterm>
		<indexterm><primary>ドメインログオン</primary></indexterm>
		<indexterm><primary>ドメインメンバシップ</primary></indexterm>
		<indexterm><primary>グループポリシー</primary></indexterm>
		<indexterm><primary>NTConfig.POL</primary></indexterm>
		NETLOGON共有はドメインログオンとドメインメンバシップサポートで中心的な役割を演じる。
		この共有はMicrosoftドメインコントローラ上で提供される。これは、ログオン処理のために
		必要となるかもしれない他の共通ツールに位置づけるのと同じように、ログオンスクリプト
		の提供と、グループポリシーファイル(NTConfig.POL)の格納のために使われる。これは、
		ドメインコントローラ上で不可欠な共有である。
		</para></listitem>
	</varlistentry>

	<varlistentry><term>PROFILE共有</term>
		<listitem><para>
		<indexterm><primary>デスクトッププロファイル</primary></indexterm>
		<indexterm><primary>VFS</primary></indexterm>
		<indexterm><primary>fake_permissions</primary></indexterm>
		<indexterm><primary>プロファイル</primary></indexterm>
		<indexterm><primary></primary></indexterm>
		この共有はユーザのデスクトッププロファイルを格納するために使われる。おのおののユーザ
		はこの共有をrootとするディレクトリを持たねばならない。このディレクトリはユーザが
		書き込み可能で、その他が読み込み可能でなければならない。Samba-3は
		<quote>fake_permissions</quote>と呼ばれる、この共有上にインストールしてもよい
		VFSモジュールを用意している。これはSambaの管理者が、全員に対してこのディレクトリを
		読み込みのみにすることを許可する。もちろん、これはプロファイルが適した形で作成された
		後にのみ便利である。
		</para></listitem>
	</varlistentry>
</variablelist>

<note><para>
上記のパラメータは、サーバの動作モードを決めるフルセットの機能を作り上げる。
以下の&smb.conf;パラメータは単独で重要である:
</para>

<para>
<smbconfblock>
<smbconfoption name="netbios name">BELERIAND</smbconfoption>
<smbconfoption name="workgroup">&example.workgroup;</smbconfoption>
<smbconfoption name="domain logons">Yes</smbconfoption>
<smbconfoption name="domain master">Yes</smbconfoption>
<smbconfoption name="security">User</smbconfoption>
</smbconfblock>
</para>

<para>
この節中で長いリスト中で示されている追加のパラメータは、より完全な
説明に役立つ。
</para></note>

</sect1>

<sect1>
<title>SambaによるADSドメイン制御</title>

<para>
<indexterm><primary>active directory</primary></indexterm>
Samba-3はActive Directoryサーバではなく、そのように振る舞えない。Active Directoryの
PDCとして本当に機能しない。Active Directoryドメインコントローラのいくつかの機能の
プロトコルは実験的のみのものとして部分的に実装されている。Samba-3がそれらのプロ
トコルをサポートするとは思わないでほしい。現在または将来にわたって、そのような
任意の機能に依存しない。Sambaチームはこれらの機能を取り除くかもしれないか、あるいは
それらの機能を変更するかもしれない。これはSamba-3の秘密の機能と、それらの機能
の完成を質問する人のために説明される。答えは、「出来るかもしれないし出来ないかも
しれない!」
</para>

<para>
<indexterm><primary>ドメインコントローラ</primary></indexterm>
<indexterm><primary>active directory</primary></indexterm>
たしかに、Samba-3はMicrosoft Windows NT4スタイルのドメインコントローラが持つ
大部分の機能を提供するように設計されている。Samba-3にはWindows NT4の全ての
機能があるわけではないが、一方Windows NT4 ドメインコントローラにはない
たくさんの特徴を持つ。要するに、Samba-3はNT4でもWindows Server 200xでもない。
もちろんActive Directoryサーバでもない。このことがすべての人に理解してもらう
ために、十分に単純で明白であることを望んでいる。
</para>

</sect1>

<sect1>
<title>ドメインとネットワークログインの設定</title>

<para>
<indexterm><primary>ドメインログオン</primary></indexterm>
ドメインコントローラによって提供される重要な機能の絶対必要な部分なので、
ネットワークまたはドメインログオンについてはここで説明する。
</para>

<sect2>
<title>ドメインネットワークログオンサービス</title>

<para>
<indexterm><primary>ドメインログオン</primary></indexterm>
すべてのドメインコントローラはネットログオンサービスを動かさなければ
ならない(Samba中での<emphasis>ドメインログオン</emphasis>)。
1つのドメインコントローラは
<smbconfoption name="domain master">Yes</smbconfoption>(PDC)と設定
しなければならない;すべてのBDCではパラメータを
<smbconfoption name="domain master">No</smbconfoption>と設定する。
</para>

<sect3>
<title>設定例</title>

<example id="PDC-config">
<title>PDCにするためのsmb.conf</title>
<smbconfblock>
<smbconfsection name="[global]"/>
<smbconfoption name="domain logons">Yes</smbconfoption>
<smbconfoption name="domain master">(PDCならYes, BDCならNo)</smbconfoption>

<smbconfsection name="[netlogon]"/>
<smbconfoption name="comment">Network Logon Service</smbconfoption>
<smbconfoption name="path">/var/lib/samba/netlogon</smbconfoption>
<smbconfoption name="guest ok">Yes</smbconfoption>
<smbconfoption name="browseable">No</smbconfoption>
</smbconfblock>
</example>

</sect3>
<sect3>
<title>Windows XP Home Editionにおける特別な例</title>

<para>
<indexterm><primary>Windows XP Home edition</primary></indexterm>
完全に明確にしよう:もしも、Microsoft Windows XP Home Editionを Microsoft 
Windows NT4またはActive Directoryドメインセキュリティに統合したいと思う
ならば、それが出来ないことを理解しなさい。唯一のオプションは、Microsoft 
Windows XP Home EditionからMicrosoft Windows XP Professional にお金を
払ってアップグレードすることである。
</para>

<note><para>
Microsoft Windows XP Home Editionはどのようなタイプのドメインセキュリティ
機能に参加する能力は持っていない。Microsoft Windows 9x/Meと異なり、
Microsoft Windows XP Home Edition はネットワークにログオンする機能も
完全に欠けている。
</para></note>

<para>
このことは前にも言ったが、これを行う事について、Sambaチームの誰かに
質問を問い合わせるか、メーリングリストに質問を投げないでほしい。それは
出来ないからである。それが出来るとなると、Microsoftとの間のライセンス
に違反することになるので、それをしないことを推奨する。
</para>

</sect3>

<sect3>
<title>Windows 9x/Meにおける特別な例</title>

<para>
<indexterm><primary>ドメイン</primary></indexterm>
<indexterm><primary>ワークグループ</primary></indexterm>
<indexterm><primary>認証</primary></indexterm>
<indexterm><primary>ブラウジング</primary></indexterm>
<indexterm><primary>rights</primary></indexterm>
ドメインとワークグループはネットワークブラウジングという言葉において
全く同等である。違いは、ネットワークに対する安全なログインのために、
分散認証データベースがドメインに関連づけられることである。
また、もしもドメインログオンサーバに対して認証が成功した場合に、
ユーザに許可されるアクセス権限が異なる。Samba-3はこれをMicrosoft 
Windows NT/200xと同じ方法で行う。
</para>

<para>
<indexterm><primary>ブラウジング</primary></indexterm>
SMBクライアントのドメインへのログオンは、ドメイン内のすべての他のサーバが
同じ認証情報を許可するべきであることを予想している。ドメインとワークグループ
のネットワークブラウズ機能は同一であり、、この文書内の、ブラウジングの議論
の中で説明される。ブラウジングはログインサポートとは直交する概念である。
</para>

<para>
<indexterm><primary>シングルログオン</primary></indexterm>
<indexterm><primary>ドメインログオン</primary></indexterm>
<indexterm><primary>ネットワークログオン</primary></indexterm>
シングルログオン(訳注:シングルサインオンか?)ネットワークモデルに関連する問題は
この節で議論される。Sambaはドメインログオン、ネットワークログオンスクリプト、
ユーザプロファイルを、この節で焦点を当てる、Microsoft Windows for Workgrops
とMicrosoft Windows 9x/Meクライアントに対してサポートする。
</para>

<para>
<indexterm><primary>ブロードキャストリクエスト</primary></indexterm>
ドメイン中のSMBクライアントがログオンしようとした時、ログオンサーバに向けと
要求をブロードキャストする。最初にリプライするものが処理を行い、Samba
管理者がインストールした何らかのメカニズムを使ってパスワードを検証する。
サーバ間でユーザデータベースが共有されていないドメインを作成することも
可能である(お勧めはしないが)。すなわち、それらはドメイン中に参加している
としてそれら自身を公告している有効なワークグループサーバである。これは
どのように認証がそれらと全く異なるか、しかし、ドメインと密接に関係して
いるかということを示している。
</para>

<para>
これらの機能を使うことで、Sambaサーバ経由でクライアントのログオンの検証を
させ、ネットワークにログオンし他時にバッチファイルをクライアントで実行させ、
プレファレンスとデスクトップとスタートメニューをダウンロードする。
</para>

<para><emphasis>
Microsoft Windows XP Home edition はドメインに参加できず、ドメインログオン
の使用が許可されない。
</emphasis></para>

<para>
設定手続きの話に入る前に、Windows 9x/Meクライアントがログオンをどのように
実行するかを見ておくことは価値がある:
</para>

<orderedlist>
<listitem>
	<para>
	<indexterm><primary>DOMAIN&lt;1C&gt;</primary></indexterm>
	<indexterm><primary>ログオンサーバ</primary></indexterm>
	クライアントは(それがいるサブネットのIPブロードキャストアドレスに
	対して)NetLogon要求をブロードキャストする。これは、NetBIOSレイヤ
	でNetBIOS名 DOMAIN&lt;1C&gt; を送る。クライアントは、
	<filename>\\SERVER</filename>という形式で、ログオンサーバのNetBIOS
	名を含む、最初に受け取ったものを選ぶ。<literal>1C</literal>という
	名前はドメインコントローラ(netlogonサービスを提供するSMB/CIFSサーバ)
	によって登録された名前のタイプである。
	</para>
</listitem>

<listitem>
	<para>
	<indexterm><primary>IPC$</primary></indexterm>
	<indexterm><primary>SMBsessetupX</primary></indexterm>
	<indexterm><primary>SMBtconX</primary></indexterm>
	クライアントがそのサーバに接続し、ログオンし(SMBsessetupXを実行)
	すると次にIPC$共有に接続する(SMBtconXを使って)。
	</para>
</listitem>

<listitem>
	<para>
	<indexterm><primary>NetWkstaUserLogon</primary></indexterm>
	クライアントは、ユーザのログオンスクリプトの名前を検索する
	NetWkstaUserLogon要求を送る。
	</para>
</listitem>

<listitem>
	<para>
	クライアントは次にNetLogon共有に接続し、そのスクリプトを検索する。
	もしも見つかり、読み出し可能ならば、クライアントによって検索され、
	実行される。その後、クライアントはNetLogon共有の接続を切る。
	</para>
</listitem>

<listitem>
	<para>
	<indexterm><primary>NetUserGetInfo</primary></indexterm>
	<indexterm><primary>profile</primary></indexterm>
	クライアントは、プロファイル検索のために使うユーザのホーム
	共有を検索するためにサーバにNetUserGetInfo要求を送る。
	NetUserGetInfo要求のレスポンスはユーザのホーム共有以外の
	ものが含まれていないので、Windows 9x用のプロファイルは
	ユーザのホームディレクトリ内になければならない。
	</para>
</listitem>

<listitem>
	<para>
	<indexterm><primary>profiles</primary></indexterm>
	クライアントはユーザのプロファイル検索のためにユーザのホーム共有に
	接続する。明確ではあるが、共有名とパスでユーザのホーム共有を指定する
	こともできる。例をあげると、<filename>\\server\fred\.winprofile</filename>
	である。もしもプロファイルが見つかれば、それを適用する。
	</para>
</listitem>

<listitem>
	<para>
	<indexterm><primary>CONFIG.POL</primary></indexterm>
	クライアントは次にユーザのホーム共有を切断し、NetLogon共有に再接続し、
	ポリシーファイル<filename>CONFIG.POL</filename>を探す。もしも見つかれば、
	それを読み、適用する。
	</para>
</listitem>
</orderedlist>

<para>
PDCとWindows 9x/Me ログオンサーバ設定の主要な違いは以下の通り:
</para>

<itemizedlist>
<listitem><para>
	<indexterm><primary>パスワード</primary><secondary>平文</secondary></indexterm>
	<indexterm><primary>平文パスワード</primary></indexterm>
	パスワード暗号化はWindows 9x/Me ログオンサーバのためには不要である。しかし、
	Microsoft Windows 98 の最初では、既定値が、平文パスワードサポートが無効化され
	ていることに注意。<link linkend="PolicyMgmt">システムとアカウントポリシー</link>
	で記述されているレジストリの変更で再度有効に出来る。
	</para></listitem>

	<listitem><para>
	<indexterm><primary>machine trust account</primary></indexterm>
	Windows 9x/Me クライアントはマシン信頼アカウントを必要とせず、かつ使わない。
	</para></listitem>
</itemizedlist>

<para>
<indexterm><primary>ネットワークログオンサービス</primary></indexterm>
Samba PDCは Windows 9x/Meログオンサーバとして振る舞う。その後、
Windows 9x/Meが見つけることを期待するネットワークログオンサービスを提供
する。
</para>

<note><para>
<indexterm><primary>sniffer</primary></indexterm>
平文パスワードの使用は思いとどまることを強く推奨する。それを使うと、
ネットワークトラフィックを解析するネットワークも似たツールを使うことで、
容易に検出できる。
</para></note>

</sect3>
</sect2>

<sect2>
<title>セキュリティモードとマスタブラウザ</title>

<para>
<indexterm><primary>security mode</primary></indexterm>
<indexterm><primary>user-mode security</primary></indexterm>
<indexterm><primary>share-mode security</primary></indexterm>
若干の未解決の問題と結びつけるためのいくつかのコメントがある。
ユーザモード以外でのセキュリティモードで、Sambaをドメインコントローラ
として操作するような設定を認めるかについての問題についてたくさんの議論
があった。技術的な理由で動作しない唯一のセキュリティモードは共有モード
である。ドメインとサーバモードセキュリティはSMBユーザレベルセキュリティ
の単なるバリエーションである。
</para>

<para>
<indexterm><primary>DOMAIN&lt;1C&gt;</primary></indexterm>
<indexterm><primary>DOMAIN&lt;1B&gt;</primary></indexterm>
<indexterm><primary>DMB</primary></indexterm>
<indexterm><primary>PDC</primary></indexterm>
<indexterm><primary>NetBIOS名</primary></indexterm>
<indexterm><primary>ドメインコントローラ</primary></indexterm>
<indexterm><primary>election</primary></indexterm>
実際、この問題は、ドメインコントローラとして動作しているとき、その
ワークグループのためのDMBがSambaであることに違いないことについて、
この問題も議論に密接に結びついている。純粋なMicrosoft Windows NT
ドメイン中では、PDCはDMBになるために選択に勝ち、次に、DOMAIN&lt;1B&gt;
というNetBIOS名を登録する。これはWindowsクライアントがDOMAIN&lt;1C&gt;
名を探すためにネットワークログオンサーバを位置づけるのには使われない
名前である。DMBはドメインマスタブラウザである。&smbmdash;
<link linkend="NetworkBrowsing">ネットワークブラウジングの章</link>、
<link linkend="DMB">WORKGROUPブラウジングの設定</link>を参照のこと。
Microsoft PDC はDMBになるためにelectionに勝つことを期待するが、もしも
勝てない場合、electionはDMBになるためのelectionに負けたという内容を
Windowsイベントロガー(訳注:イベントビューワ?)に、警告メッセージを
短い間隔で連続して出力する。この理由のため、SambaサーバがPDCである
ネットワーク中では、SambaドメインコントローラをDMBとして設定するのが
賢いやり方である。
</para>

<note><para>
<indexterm><primary>DOMAIN&lt;1D&gt;</primary></indexterm>
<indexterm><primary>動機</primary></indexterm>
<indexterm><primary>ドメイン制御</primary></indexterm>
<indexterm><primary>ブラウズリスト管理</primary></indexterm>
<indexterm><primary>ネットワーク</primary><secondary>ログオン</secondary><tertiary></tertiary></indexterm>
DOMAIN&lt;1C&gt;名を登録するSMB/CIFSサーバは、ネットワークログオン
サービスを提供するのでそのように処理する。DOMAIN&lt;1B&gt;名を
登録するサーバはDMBである&smbmdash;すなわち、DOMAIN&lt;1D&gt;名
を登録されたすべてのマシンを含んでのブラウズリスト同期の責任を
持つと言うことである。後者は、存在しているローカルネットワーク
セグメントで、すべてのNetBIOS名の登録監視に責任があるLMBである。
ネットワークログオンサービス(NETLOGON)はドメイン制御に関連して
いているが、ネットワークブラウジングとブラウズリスト管理には関係
していない。1Cと1B/1Dの名前サービスはお互いに無関係である。
</para></note>

<para>
<smbconfoption name="security">user</smbconfoption>以外のモードを
Sambaドメインコントローラで使うための設定の問題に戻ろう。もしも、
Sambaホストがユーザ接続要求を検証するために他のSMBサーバかドメイン
コントローラを使うように設定した場合、ネットワーク上の他のマシン
(<smbconfoption name="password server"/>)は、Sambaホストよりもより
詳しくユーザについて知っているということになる。時間のおおよそ99％は
この他のホストはドメインコントローラである。ドメインモードセキュリティ
で動作しているとした場合、<smbconfoption name="workgroup"/>パラメータ
はWindows NTドメインの名前にセットされなければならない(それはすでに
ドメインコントローラが持っている)。もしもドメインがドメインコントローラ
をまだ持っていない場合、まだドメインを持っていないことになる。
</para>

<para>
すでに定義上PDCを持つドメイン用にSambaサーバをドメインコントローラとして
設定することは災難を招く。それゆえ、そのドメインに対してDMBになるようにと
<smbconfoption name="security">user</smbconfoption>を設定するようにSamba
ドメインコントローラをいつでも設定すべきである。これのみが公式にサポート
される操作モードである。
</para>

</sect2>

</sect1>

<sect1>
<title>共通のエラー</title>

<sect2>
<title><quote>$</quote>マシン名中に$を含められない</title>

<para>
<indexterm><primary>BSD</primary></indexterm>
<indexterm><primary>FreeBSD</primary></indexterm>
<indexterm><primary>/etc/passwd</primary></indexterm>
通常<filename>/etc/passwd</filename>に格納されるマシンアカウントは、マシン名に
<quote>$</quote>を追加した形で通常格納される。いくつかのBSDシステムはユーザ名
に<quote>$</quote>を使うものが作成できない。最近のFreeBSDのバージョンはこの
制限が取り払われたが、それより古いものはまだ使われている。
</para>

<para>
<indexterm><primary>vipw</primary></indexterm>
問題はエントリを作る時に使われるプログラム中のみである。一度作成されると
問題なく動作する。まず<quote>$</quote>なしでユーザ名を作る。次に、エントリを
編集するために <command>vipw</command>を使い<quote>$</quote>を追加する。
あるいは、全部のエントリをvipwで作っても良い。固有のユーザログインIDを使うように
すること。
</para>

<note><para>マシンアカウントはワークステーションが持つ名前と同じ名前でなければならない。</para></note>

<note><para>
UNIXのツール<command>vipw</command>は直接<filename>/etc/passwd</filename>を修正
する共通的なツールである。vipwの使用は(もしも使われるならば)shadowファイルが
パスワードファイルと同じになることを保証する。これはセキュリティの観点から重要
である。
</para></note>

</sect2>

<sect2>
<title>存在するマシンアカウントがあるためにドメイン参加に失敗する</title>
		
<para>
<indexterm><primary>ドメインへの参加</primary></indexterm>
<quote>I get told,マシン信頼アカウント作成時に `You already have a connection to the Domain....'
か `Cannot join domain, the credentials supplied conflict with an existing set...'が出る
ことについては以前に話した。</quote>
</para>

<para>
これは、もしもそのマシン自身でマシン信頼アカウントの作成を試みるとき、
Samba PDC上の共有(かIPC$)に接続している(たとえばマップされたドライブ)
時に起きる。以下のコマンドはすべてのネットワークドライブ接続を切断する:
<screen>
&dosprompt;<userinput>net use * /d</userinput>
</screen>
これはすべてのネットワーク接続を切る。
</para>

<para>
さらに、もしもマシンがすでに(悪いアイデアだが)参加済みのドメインと同じ名前の
<quote>workgroupのメンバ</quote>ならば、このメッセージを受け取るだろう。
ワークグループを何か重要でない別の名前に変えて&smbmdash;再起動し、&smbmdash;
もう一度やってみる。
</para>

</sect2>

<sect2>
<title>システムにログオンできない(C000019B)</title>

<para><quote>
ドメイン参加に成功したが、Sambaのバージョンを新しくした後、ログオン時に
<errorname>`The system cannot log you on (C000019B). Please try again or consult your system
administrator</errorname>というメッセージが出た。'</quote>
</para>

<para>
<indexterm><primary>SID</primary></indexterm>
これはsecrets.tdbに格納されているドメインSIDが変わったことによって引き
起こされるものである。最も一般的なドメインSIDの変更理由は、ドメイン名
かサーバ名(NetBIOS名)が変わったことである。問題を解決する唯一の方法は
オリジナルのドメインSIDをリストアするか、ドメインと領域からドメイン
クライアントを削除することである。ドメインSIDは、netまたはrpcclient
ユーティリティによってリセットしても良い。
</para>

<para>
ドメインSIDをリセットしたり、変更するには、以下のようにnetコマンドを
使用する:

<screen>
&rootprompt;<userinput>net getlocalsid 'OLDNAME'</userinput>
&rootprompt;<userinput>net setlocalsid 'SID'</userinput>
</screen>
</para>

<para>
ワークステーションのマシン信頼アカウントはドメイン(またはネットワーク)
SIDとともにのみ動作する。もしもこのSIDが変更されたならば、ドメイン
メンバ(ワークステーション)はドメインにログオンできない。オリジナルの
ドメインSIDはsecrets.tdbファイルから復元できる。別の解は、おのおのの
ワークステーションが再度ドメインに参加することである。
</para>

</sect2>

<sect2>
<title>マシン信頼アカウントがアクセスできない</title>

<para>
<quote>ドメインに参加しようとした時 <errorname>"The machine account 
for this computer either does not exist or is not accessible</errorname>."
というメッセージが出た。何が悪い?</quote>
</para>

<para>
この問題は、PDCが適したマシン信頼アカウントを持っていないことによって
引き起こされる。もしもアカウント作成時に
<smbconfoption name="add machine script"/>という方法を使ったならば、
これは、それが動作していないことを示している。ドメイン管理ユーザが
動作しているかを確認して正常動作するようにすること。
</para>

<para>
かわりに、もしもアカウントエントリを手動で作成していた場合、それらは
正しく作られていない。Samba PDC上で<filename>smbpasswd</filename>ファイル
中のマシン信頼アカウントのエントリを正しくしなければならない。もしも、
smbpasswd ユーティリティを使わないでアカウントをエディタで追加した場合、
アカウント名をマシンのNetBIOS名に<quote>$</quote>を追加して(すなわち、
computer_name$)おくこと。これはSambaSAMAccountバックエンドと同じように
POSIX UNIXシステムアカウントバックエンドの両方の中に存在する必要がある。
Samba-3の既定値のバックエンド(すなわち、パラメータ
<parameter>passdb backend</parameter>)は&smb.conf;ファイル中で指定されて
おらず、また、もしも指定されているものが<literal>smbpasswd</literal>
だった場合、それらはそれぞれ<filename>/etc/passwd</filename>と
<filename>/etc/samba/smbpasswd</filename>(あるいはもしもSambaチームの
既定値の設定を使ってコンパイルした場合は
<filename>/usr/local/samba/lib/private/smbpasswd</filename>)である。
<filename>/etc/passwd</filename>の使用はNSS <filename>/etc/nsswitch.conf</filename>
ファイル中の別の設定で上書きすることが出来る。
</para>

<para>
ある人はSambaサーバとNTクライアントの間でのつじつまの合わないサブネットマスク
は、この問題を引き起こすことを報告している。両方のクライアントとサーバで整合性
を取るようにすること。
</para>
</sect2>

<sect2>
<title>アカウントが無効</title>

<para><quote>NT4/W200xワークステーションからSambaドメインにログオンしようとした
とき、アカウントが無効になっているメッセージが出た。</quote></para>

<para>
<userinput>smbpasswd -e <replaceable>username</replaceable>でユーザアカウントを有効化する
</userinput>。これは通常アカウント作成時に行われる。
</para>

</sect2>

<sect2>
<title>ドメインコントローラが無効</title>
		
<para><quote>Sambaが開始してから数分間、クライアントがエラー`Domain Controller Unavailable'を受け取る。</quote></para>

<para>
ドメインコントローラはネットワーク上にその役割をアナウンスする。これは通常しばらくかかる。最低15分は待ち、
再度試してみること。
</para>
</sect2>

<sect2>
<title>ドメイン参加後ドメインメンバワークステーションにログオンできない</title>

<para>
<indexterm><primary>schannel</primary></indexterm>
<indexterm><primary>signing</primary></indexterm>
ドメイン参加成功後、2つのメッセージのうちの1つが出てユーザログオンに失敗する:
1つはドメインコントローラが見つからないというもので、もう1つはアカウントが
ドメインにないか、パスワードが違うというものである。これは、<emphasis>schannel</emphasis>
(セキュアchannel)の設定か、<emphasis>smb 署名</emphasis>の設定について、
WindowsクライアントとSamba-3サーバの違いによる互換性のない設定によるものである。
以下を実行して、Sambaの
<emphasis>client schannel</emphasis>、<emphasis>server schannel</emphasis>、
<emphasis>client signing</emphasis>、<emphasis>server signing</emphasis>の設定と
それらの値について確認すること:
<screen>
<command>testparm -v | grep channel</command>
</screen>
</para>

<para>
また、MMC &smbmdash; ローカルセキュリティの設定を使うこと。このツールはコントロール
パネルにある。ポリシーの設定は、ローカルポリシー/セキュリティオプション領域にあり、
<emphasis>Secure Channel:..., and Digitally sign...</emphasis>というプレフィックスが
ついている(訳注:XPでは、管理ツール->ローカル セキュリティ ポリシーで、
ローカルポリシー/セキュリティオプションにあるはず....。)
</para>

<para>
これらを首尾一貫してSamba-3サーバに設定をするのは重要である。
</para>

</sect2>

</sect1>
</chapter>
