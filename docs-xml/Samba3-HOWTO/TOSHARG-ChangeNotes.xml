<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<chapter id="ChangeNotes">
<chapterinfo>
	&author.jht;
	&author.jerry;
</chapterinfo>

<title>Samba 3.xシリーズにおける重要で重大な変更点</title>
<para>
Sambaをアップデートまたはアップグレードする前に、この章を注意深く読んでほしい。
ここにはとても重大か、とても重要な情報のみが書いてある。包括的な変更記録とガイ
ダンス情報は
<link linkend="upgrading-to-3.0">Sambaのアップデートとアップグレード</link>
の章にある。
</para>

<sect1>

<title>重要な Samba-3.2.x の変更点</title>
<para>
!!!!!!!!!!!!Add all critical update notes here!!!!!!!!!!!!!
</para>

</sect1>

<sect1>

<title>重要な Samba-3.0.x の変更点</title>
<para>
以下の記述は、特にSamba 3.0.23からSamba 3.0.25c(あるいはより最新のSamba 3.0.25の更新版)
に関連する。Sambaは常に変化しているプロジェクトである。3.0.xシリーズ中での変更点は、
この文書中で記述されている。
<link linkend="oldupdatenotes">Upgrading from Samba-2.x to Samba-3.0.25</link>
を参照のこと。
</para>

<para>
時々、HOWTO文書の、新しい、あるいは変更された機能の影響を反映するために更新すべき部分を
指示するのが難しいことがある。あるいは別の時点では、この文書を再構成することが必要で
あることが明白になる。
</para>

<para>
近年では、Samba のユーザも <ulink url="http://wiki.samba.org/">Samba Wiki</ulink>
構築の推進に加わった。新しく作成される Samba ドキュメントは、すべてここに集約
される予定である。Wikiは規模の大きなコミュニティからの投稿に適していて、より
いっそう最新情報を提供できることを期待している。そのすばらしい夢が実現して、
十分な価値が出てくるまでは、このHOWTO文書を維持管理することは必要である。
この章では、このHOWTO文書の主要部分が再構成されるか変更される時点までの間
での主要な変更点を文書化する。
</para>

<para>
この章は、Samba 3.0.23リリースでHOTWOに加わった。ここにはSambaソースコードリリース
一式中に含まれる<filename>WHATSNEW.txt</filename>ファイル中で提供されているたくさんの
注意点を含んでいる。
</para>

<sect2>
<title>ユーザとグループの変更</title>

<para>
マップされていないユーザとグループアカウントのみに影響する変更点はここで文書化されている。
</para>

<para>
<indexterm><primary>ユーザ</primary></indexterm>
<indexterm><primary>グループ</primary></indexterm>
<indexterm><primary>相対識別子</primary><see>RID</see></indexterm>
<indexterm><primary>net</primary><secondary>groupmap</secondary></indexterm>
<indexterm><primary>net</primary><secondary>rpc</secondary><tertiary>vampire</tertiary></indexterm>
ユーザとグループに対する内部管理ルーチンは割り当てられた相対識別子(RID)
の重複を防ぐために書き直された。過去では、<command>net groupmap</command>コマンド
又は<command>net rpc vampire</command>コマンドで
<command>net rpc vampire</command>
を実行してWindowsドメインをSambaドメインにマイグレートすることによって、
手動でUnixグループにマッピングするときに問題が発生する可能性があった。
</para>

<para>
<indexterm><primary>SID</primary></indexterm>
<indexterm><primary>SAM</primary></indexterm>
<indexterm><primary>RID</primary></indexterm>
<indexterm><primary>net</primary><secondary>getlocalsid</secondary></indexterm>
マップされていないユーザは、今回から<literal>S-1-22-1</literal>ドメイン中の
SIDが割り当てられ、マップされていないグループは<literal>S-1-22-2</literal>ドメイン
中のSIDを割り当てられる。以前はSambaサーバ上のSAM内のRIDを割り当てていた。
ドメインコントローラにとって、これは、メンバサーバかスタンドアロンサーバ上のような
ドメインSIDの権限の配下にあり、これはローカルSAM(<command>net getlocalsid</command>
マニュアルページを参照)の権限下にあった。
</para>

<para>
<indexterm><primary>マップされていないユーザ</primary></indexterm>
<indexterm><primary>マップされていないグループ</primary></indexterm>
<indexterm><primary>SID</primary></indexterm>
<indexterm><primary>NTFS</primary></indexterm>
<indexterm><primary>GID</primary></indexterm>
結果は、アップグレードされたSambaドメインコントローラ上の、あるマップされていない
ユーザ又はグループは新しいSIDを割り当てられることになる。Windowsセキュリティ
記述子中に名前というかSIDが格納されるので、これは、そのユーザが
たとえば、Sambaファイルサーバからローカルの
WindowsクライアントNTFSパーティションにファイルがコピーされた場合、もはやリソースに
アクセスできないという現象を引き起こす。Sambaサーバ上自身で格納された任意のファイル
は、UNIXがUNIXのGIDを格納し、権限の検査にSIDを使わないために引き続きアクセスできる。
</para>

<para>
変更を図示するのに例題が役立つ:
</para>

<para>
<indexterm><primary>グループマッピング</primary></indexterm>
<indexterm><primary>GID</primary></indexterm>
<indexterm><primary>ACL</primary></indexterm>
<indexterm><primary>SID</primary></indexterm>
Assume that a group named <emphasis>developers</emphasis> exists with a UNIX GID of 782. In this
case this user does not exist in Samba's group mapping table. It would be perfectly normal for
this group to be appear in an ACL editor.  Prior to Samba-3.0.23, the group SID might appear as
<literal>S-1-5-21-647511796-4126122067-3123570092-2565</literal>.
</para>

<para>
<indexterm><primary>SID</primary></indexterm>
<indexterm><primary>NTFS</primary></indexterm>
<indexterm><primary>access</primary></indexterm>
<indexterm><primary>group permissions</primary></indexterm>
With the release of Samba-3.0.23, the group SID would be reported as <literal>S-1-22-2-782</literal>.  Any
security descriptors associated with files stored on a Windows NTFS disk partition will not allow access based
on the group permissions if the user was not a member of the
<literal>S-1-5-21-647511796-4126122067-3123570092-2565</literal>  group.  Because this group SID is
<literal>S-1-22-2-782</literal> and not reported in a user's token, Windows would fail the authorization check
even though both SIDs in some respect refer to the same UNIX group.
</para>

<para>
<indexterm><primary>group mapping</primary></indexterm>
<indexterm><primary>SID</primary></indexterm>
The workaround for versions of Samba prior to 3.0.23, is to create a manual domain group mapping
entry for the group <emphasis>developers</emphasis> to point at the
<literal>S-1-5-21-647511796-4126122067-3123570092-2565</literal> SID. With the release of Samba-3.0.23 this
workaround is no longer needed.
</para>
</sect2>

<sect2>
<title>Essential Group Mappings</title>
<para>
Samba 3.0.x series  releases before 3.0.23 automatically created group mappings for the essential Windows
domain groups <literal>Domain Admins, Domain Users, Domain Guests</literal>. Commencing with Samba 3.0.23
these mappings need to be created by the Samba administrator. Failure to do this may result in a failure to
correctly authenticate and recoognize valid domain users. When this happens users will not be able to log onto
the Windows client.
</para>

<note><para>
Group mappings are essentail only if the Samba servers is running as a PDC/BDC. Stand-alone servers do not
require these group mappings.
</para></note>

<para>
The following mappings are required:
</para>

<table frame="all" id="TOSH-domgroups">
	<title>Essential Domain Group Mappings</title>
	<tgroup align="center" cols="3">
	<thead>
		<row><entry>Domain Group</entry><entry>RID</entry><entry>Example UNIX Group</entry></row>
	</thead>
	<tbody>
		<row><entry>Domain Admins</entry><entry>512</entry><entry>root</entry></row>
		<row><entry>Domain Users</entry><entry>513</entry><entry>users</entry></row>
		<row><entry>Domain Guests</entry><entry>514</entry><entry>nobody</entry></row>
	</tbody>
	</tgroup>
</table>

<para>
When the POSIX (UNIX) groups are stored in LDAP, it may be desirable to call these <literal>domadmins, domusers,
domguests</literal> respectively.
</para>

<para>
For further information regarding group mappings see <link linkend="groupmapping">Group Mapping: MS Windows
and UNIX</link>.
</para>

</sect2>

<sect2>
<title>Passdb Changes</title>

<para>
<indexterm><primary>backends</primary></indexterm>
<indexterm><primary>GID</primary></indexterm>
<indexterm><primary>SQL</primary></indexterm>
<indexterm><primary>XML</primary></indexterm>
The <smbconfoption name="passdb backend"/> parameter no long accepts multiple passdb backends in a
chained configuration.  Also be aware that the SQL and XML based passdb modules have been
removed in the Samba-3.0.23 release.  More information regarding external support for a SQL
passdb module can be found on the  <ulink url="http://pdbsql.sourceforge.net/">pdbsql</ulink> web site.
</para>

</sect2>

<sect2>
<title>Group Mapping Changes in Samba-3.0.23</title>

<para>
<indexterm><primary>default mapping</primary></indexterm>
<indexterm><primary>Domain Admins</primary></indexterm>
<indexterm><primary>smbpasswd</primary></indexterm>
<indexterm><primary>tdbsam</primary></indexterm>
<indexterm><primary>passdb backend</primary></indexterm>
<indexterm><primary>group mappings</primary></indexterm>
<indexterm><primary>GID</primary></indexterm>
<indexterm><primary>SID</primary></indexterm>
<indexterm><primary>IDMAP</primary></indexterm>
<indexterm><primary>winbindd</primary></indexterm>
<indexterm><primary>domain groups</primary></indexterm>
The default mapping entries for groups such as <literal>Domain Admins</literal> are no longer
created when using an <literal>smbpasswd</literal> file or a <literal>tdbsam</literal> passdb
backend.  This means that it is necessary to explicitly execute the <command>net groupmap add</command>
to create group mappings, rather than use the <command>net groupmap modify</command> method to create the
Windows group SID to UNIX GID mappings.  This change has no effect on winbindd's IDMAP functionality
for domain groups.
</para>

</sect2>

<sect2>
<title>LDAP Changes in Samba-3.0.23</title>

<para>
<indexterm><primary>LDAP schema</primary></indexterm>
<indexterm><primary>sambaSID</primary></indexterm>
<indexterm><primary>OpenLDAP</primary></indexterm>
<indexterm><primary>slapindex</primary></indexterm>
<indexterm><primary>slapd.conf</primary></indexterm>
There has been a minor update the Samba LDAP schema file. A substring matching rule has been
added to the <literal>sambaSID</literal> attribute definition.  For OpenLDAP servers, this
will require the addition of <literal>index sambaSID sub</literal> to the
<filename>slapd.conf</filename> configuration file.  It will be necessary to execute the
<command>slapindex</command> command after making this change. There has been no change to the
actual data storage schema.
</para>

</sect2>
</sect1>

</chapter>
