<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<chapter id="tdb">

<chapterinfo>
	&author.jht;
	
	<pubdate>May 28, 2008</pubdate>
</chapterinfo>

<title>TDB ファイルの管理</title>

<sect1>
<title>特徴と利点</title>

	<para>
<indexterm><primary>tdb</primary></indexterm>
<indexterm><primary>Trivial Database</primary></indexterm>
	Samba は軽量なデータベース Trivial Database (tdb) を利用する。一時的、
	永続的なデータをそこに格納する。
	一部の tdb ファイルは samba を再起動する前に破棄できるが、その他は
	Samba の設定や振る舞いにとって重要な情報を格納するために利用される。
	下記の情報は、Sabma のインストールをよりよく管理を摸索している管理者を
	助となるように提供される。
	</para>

	<para>
<indexterm><primary>tdb</primary></indexterm>
<indexterm><primary>corrupted</primary></indexterm>
<indexterm><primary>バックアップ</primary></indexterm>
<indexterm><primary>レストア</primary></indexterm>
	オペレーティングシステムとアプライアンスへの商用配布のために Samba を
	パッケージする人は十分に注意するとよいだろう tdb ファイルは破損されるこ
	とがあるため定期的にバックアップするべきである。適切なタイミングはシス
	テムシャットダウン(バックアップ)とスタートアップ(バックアップからのレ
	ストア)。
	</para>

<table frame="all" id="TOSH-TDB">
                <title>Samba の Trivial Database ファイル</title>
                <tgroup align="center" cols="2">
                <thead>
                <row><entry>ファイル名</entry><entry>保存 Preserve</entry><entry>説明</entry></row>
                </thead>

                <tbody>
                        <row><entry>account_policy.tdb</entry><entry>Y</entry>
				<entry><para>NT アカウントポリシー設定たとえばパスワード有効期限など。</para></entry></row>
                        <row><entry>brlock.tdb</entry><entry>N</entry>
				<entry><para>バイトレンジロック。</para></entry></row>
                        <row><entry>browse.dat</entry><entry>N</entry>
				<entry><para>ブラウズリスト - 自動的に再構築される。</para></entry></row>
                        <row><entry>connections.tdb</entry><entry>N</entry>
				<entry><para>各共有への接続。最大接続数までに制限するためなどに利用される。</para></entry></row>
                        <row><entry>gencache.tdb</entry><entry>N</entry>
				<entry><para>汎用のキャッシュ用データベース。</para></entry></row>
                        <row><entry>group_mapping.tdb</entry><entry>Y</entry>
				<entry><para>
					Stores グループマッピング情報を格納する。
					LDAP バックエンドを利用する際には使わない。
				</para></entry></row>
                        <row><entry>lang_en.tdb</entry><entry>Y</entry>
				<entry><para>ランゲージエンコーディング情報を格納する。</para></entry></row>
                        <row><entry>locking.tdb</entry><entry>N</entry>
				<entry><para>共有モードと oplock 情報を格納する。</para></entry></row>
                        <row><entry>login_cache.tdb</entry><entry>N</entry>
				<entry><para>パスワードの失敗のログを保管する。</para></entry></row>
                        <row><entry>messages.tdb</entry><entry>N</entry>
				<entry><para>Samba 内部メッセージングの追跡に使用する。</para></entry></row>
                        <row><entry>netsamlogon_cache.tdb</entry><entry>Y</entry>
				<entry><para>
					ドメインメンバからのリクエスト<emphasis>net_samlogon()</emphasis>
					からのユーザ net_info_3 構造体のキャッシュ。
				</para></entry></row>
                        <row><entry>ntdrivers.tdb</entry><entry>Y</entry>
				<entry><para>インストールされたプリンタドライバ情報の格納する。</para></entry></row>
                        <row><entry>ntforms.tdb</entry><entry>Y</entry>
				<entry><para>インストールされたプリンタのフォーム情報を格納する。</para></entry></row>
                        <row><entry>ntprinters.tdb</entry><entry>Y</entry>
				<entry><para>インストールされたプリンタ情報を格納する。</para></entry></row>
                        <row><entry>printing ディレクトリ</entry><entry>Y</entry>
				<entry><para>
					キャッシュされた lpq 出力のプリントキュー毎の
					tdb ファイルを含むディレクトリ。
				</para></entry></row>
                        <row><entry>registry.tdb</entry><entry>Y</entry>
				<entry><para>Windows レジストリスケルトン
				(connect regedit.exeを経由して接続)。</para></entry></row>
                        <row><entry>sessionid.tdb</entry><entry>N</entry>
				<entry><para><literal>utmp = yes</literal>機能
				をサポートするためのセッション情報</para></entry></row>
                        <row><entry>share_info.tdb</entry><entry>Y</entry>
				<entry><para>共有レベルの ACL 構成設定を格納する。デフォルトの ACL は
					<emphasis>全員 - フルコントロール</emphasis>である。
				</para></entry></row>
                        <row><entry>unexpected.tdb</entry><entry>N</entry>
				<entry><para>
					Unexpected packet queue needed to support windows clients that respond on a 
					different port that the originating reques.
				</para></entry></row>
                        <row><entry>winbindd_cache.tdb</entry><entry>N</entry>
				<entry><para>Winbind's cache of user lists.</para></entry></row>
                        <row><entry>winbindd_idmap.tdb</entry><entry>Y</entry>
				<entry><para>Winbind's local IDMAP database.</para></entry></row>
                        <row><entry>wins.dat</entry><entry>N</entry>
				<entry><para>
				WINS database iused only when <parameter>wins support = yes</parameter>
				has been set. This gets rebuilt or updated at every restart.
				</para></entry></row>
                        <row><entry>wins.tdb</entry><entry>Y</entry>
				<entry><para>
				The working permanent storage for all WINS data. This database is used only
				when <parameter>wins support = yes</parameter> has been set in the &smb.conf; file.
				Note: This retains all manually configured WINS entries. Manual setting can be done use the net utility.
				</para></entry></row>
                        <row><entry>secrets.tdb</entry><entry>Y</entry>
				<entry><para>
				This tdb file stores internal settings such as the machine and the domain SID, secret passwords
				that are used with LDAP, the machine secret token, etc. This is an essential file that is stored
				in a secure area. Vendors locate this in various folders. Check <command>smbd -b</command> to
				find its location on your system.
				</para></entry></row>
                        <row><entry>schannel_store.tdb</entry><entry>Y</entry>
				<entry><para>
				This stores secure channel access token information used with SMB signing.
				</para></entry></row>
                        <row><entry>passdb.tdb</entry><entry>Y</entry>
				<entry><para>
				This stores the Samba SAM account information when using a tdbsam password backend.
				</para></entry></row>
                </tbody>
        </tgroup>
        </table>

</sect1>

<sect1>
<title>Managing TDB Files</title>

	<para>
	The <command>tdbbackup</command> utility is a tool that may be used to backup samba tdb files.
	This tool may also be used to verify the integrity of the tdb files prior to Samba startup or
	during normal operation. If it finds file damage it will search for a prior backup the backup
	file from which the damaged tdb file will be restored. The <command>tdbbackup</command>
	utility can safely be run at any time. It was designed so that it can be used at any time to
	validate the integrity of tdb files, even during Samba operation.
	</para>

	<para>
	It is recommended to backup all tdb files as part of the Samba start-up scripts on a Samba
	server. The following command syntax can be used:
	</para>
<screen>
myserver# > cd /var/lib/samba
myserver@ > tdbbackup *.tdb
</screen>
	<para>
	The default extension is <filename>.bak</filename>. Any alternate extension can be specified
	by executing <literal>tdbbackup -s 'new_extension' *.tdb</literal> as part of your startup script.
	</para>

</sect1>

</chapter>
