<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<chapter id="StandAloneServer">
<chapterinfo>
	&author.jht;
</chapterinfo>
<title>スタンドアロンサーバ</title>

<para>
<indexterm><primary>スタンドアロンサーバ</primary></indexterm>
<indexterm><primary>非ドメインメンバ</primary></indexterm>
<indexterm><primary>最小のセキュリティ制御</primary></indexterm>
スタンドアロンサーバは、ネットワーク上での独立したドメインコントローラである。
それらはドメインメンバではなく、ワークグループサーバのように機能する。
多くの場合、スタンドアロンサーバは、提供されたデータが容易にすべての利用者
からアクセス可能という意図で、最低限のセキュリティ制御で設定されている
サーバである。
</para>

<sect1>
<title>機能と利便性</title>

<para>
<indexterm><primary>セキュア</primary></indexterm>
<indexterm><primary>非セキュア</primary></indexterm>
スタンドアロンサーバは、必要性によって、セキュアにも非セキュアにもできる。
単純あるいは複雑な設定を取ることが出来る。上記のように、ドメインセキュリティ
について、過大な説明にもかかわらず、多くは普通のインストールのままである。
</para>

<para>
<indexterm><primary>読み込み専用ファイル</primary></indexterm>
<indexterm><primary>シェアモード</primary></indexterm>
<indexterm><primary>リードオンリ</primary></indexterm>
<indexterm><primary>スタンドアロンサーバ</primary></indexterm>
もしも、サーバに必要とされるものがすべて読み込み専用ファイルか、プリンタ
のみならば、複雑な設定をするのは意味をなさない。たとえば、設計事務所
が古い設計図と設計標準を格納しておく必要があるとする。すべての文書が
変更されないままでいることが法律的に重要なので、誰もサーバにファイルを
書き込めない。シェアモードのリードオンリスタンドアロンサーバは理想的
な解決方法である。
</para>

<para>
<indexterm><primary>単純さ</primary></indexterm>
<indexterm><primary>プリンタ</primary></indexterm>
<indexterm><primary>シェアモードサーバ</primary></indexterm>
単純さを正当化するもう1つの状態は、一つの中央サーバから待ち行列に入れられる
多くのプリンタを持っているオフィスである。全員がプリンタに印刷出来る要求が
あるが、アクセス制御の必要がなく、プリンタサーバにはファイルがない場合である。
繰り返すと、シェアモードスタンドアロンサーバはとても優れた解決方法を提供する。
</para>
</sect1>

<sect1>
<title>背景</title>

<para>
<indexterm><primary>スタンドアロンサーバ</primary></indexterm>
<indexterm><primary>ローカル認証</primary></indexterm>
<indexterm><primary>アクセス制御</primary></indexterm>
<emphasis>standalone server</emphasis>という言葉は、ローカルな認証とその上で
有効なすべてのリソースのアクセスを制御する機能を提供するという意味である。
一般的に、これは、ローカルユーザデータベースがあると言うことを意味する。
もう少し技術的な言葉で言うと、これは、マシン上のリソースは、
emphasis>share</emphasis>モードか<emphasis>user</emphasis>モードのいずれか
が有効であるということである。
</para>

<para>
<indexterm><primary>ユーザアカウントの作成</primary></indexterm>
<indexterm><primary>ネットワークログオンサービスがない</primary></indexterm>
<indexterm><primary>独立</primary></indexterm>
ユーザアカウントを作成するため以外に特別な操作は必要ない。スタンドアロンサーバ
はネットワークログオンサービスを提供しない。これは、このサーバを使うマシンは
これに対するドメインログオンを実行しないことを意味する。ワークステーションが
使うどんなログオン機能も、このマシンからは独立している。しかし、使用する
ログオン名がローカルで持っているユーザ名をスタンドアロンサーバ上でローカルに
変換(マップ)するために、任意のネットワークユーザを一致させることは必要である。
このことを実行するためにはいくつかの方法がある。
</para>

<para>
<indexterm><primary>ローカル認証データベース</primary></indexterm>
<indexterm><primary>SMB</primary></indexterm>
<indexterm><primary>非ドメインメンバ</primary></indexterm>
Sambaはスタンドアロンサーバの定義中で少しだけ区別を曖昧にするのに
役立つ。これは、SMBプロトコルの視点から、Sambaサーバがドメイン
セキュリティコンテキストのメンバでないとしても、認証データベース
がローカルかリモートサーバ上にあるという理由である。
</para>

<para>
<indexterm><primary>PAM</primary></indexterm>
<indexterm><primary>NSS</primary></indexterm>
<indexterm><primary>UNIXユーザデータベース</primary></indexterm>
<indexterm><primary>/etc/passwd</primary></indexterm>
<indexterm><primary>/etc/shadow</primary></indexterm>
<indexterm><primary>ローカルのsmbpasswdファイル</primary></indexterm>
<indexterm><primary>LDAPバックエンド</primary></indexterm>
<indexterm><primary>Winbind</primary></indexterm>
UNIXユーザデータベースを操作するPAMとネームサービススイッチ(NSS)を使って
(<link linkend="pam">PAMに付いての節</link>を参照)、認証のソースは
別のサーバ上にあってもよい。これを認証サーバと呼ぶ傾向がある。これは、
SambaサーバはローカルのUNIX/Linuxシステムパスワードデータベース
(<filename>/etc/passwd</filename>か<filename>/etc/shadow</filename>)か、
ローカルのsmbpasswdファイルか、LDAPバックエンドか、認証のために、
PAMとWinbind経由で他のCIFS/SMBサーバを使っても良いことを意味する。
</para>

</sect1>

<sect1>
<title>設定例</title>

<para>
<indexterm><primary>inspire simplicity</primary></indexterm>
<indexterm><primary>complexity</primary></indexterm>
<link linkend="simplynice">The example Reference Documentation Server</link> and <link
linkend="SimplePrintServer">Central Print Serving</link> are designed to inspire simplicity. It is too easy to
attempt a high level of creativity and to introduce too much complexity in server and network design.
</para>

<sect2 id="RefDocServer">
<title>Reference Documentation Server</title>

<para>
<indexterm><primary>read-only</primary></indexterm>
<indexterm><primary>reference documents</primary></indexterm>
<indexterm><primary>/export</primary></indexterm>
<indexterm><primary>/etc/passwd</primary></indexterm>
Configuration of a read-only data server that everyone can access is very simple. By default, all shares are
read-only, unless set otherwise in the &smb.conf; file. <link linkend="simplynice">The example - Reference
Documentation Server</link> is the &smb.conf; file that will do this. Assume that all the reference documents
are stored in the directory <filename>/export</filename>, and the documents are owned by a user other than
nobody. No home directories are shared, and there are no users in the <filename>/etc/passwd</filename> UNIX
system database. This is a simple system to administer.
</para>

<example id="simplynice">
<title>smb.conf for Reference Documentation Server</title>
<smbconfblock>
<smbconfcomment> Global parameters</smbconfcomment>
<smbconfsection name="[global]"/>
<smbconfoption name="workgroup">&example.workgroup;</smbconfoption>
<smbconfoption name="netbios name">&example.server.samba;</smbconfoption>
<smbconfoption name="security">SHARE</smbconfoption>
<smbconfoption name="passdb backend">guest</smbconfoption>
<smbconfoption name="wins server">192.168.1.1</smbconfoption>
<smbconfsection name="[data]"/>
<smbconfoption name="comment">Data</smbconfoption>
<smbconfoption name="path">/export</smbconfoption>
<smbconfoption name="guest only">Yes</smbconfoption>
</smbconfblock>
</example>

<blockquote>
<attribution>Mark Twain</attribution>
<para>
I would have spoken more briefly, if I'd had more time to prepare.
</para>
</blockquote>

<para>
<indexterm><primary>password backend</primary></indexterm>
<indexterm><primary>guest</primary></indexterm>
<indexterm><primary>unprivileged account names</primary></indexterm>
<indexterm><primary>WINS</primary></indexterm>
In <link linkend="simplynice">this example</link>, the machine name is set to &example.server.samba;, and the
workgroup is set to the name of the local workgroup (&example.workgroup;) so the machine will appear together
with systems with which users are familiar. The only password backend required is the <quote>guest</quote>
backend to allow default unprivileged account names to be used. As there is a WINS server on this network, we
of course make use of it.
</para>

<para>
A US Air Force Colonel was renowned for saying: <quote>Better is the enemy of good enough!</quote> There are often
sound reasons for avoiding complexity as well as for avoiding a technically perfect solution. Unfortunately,
many network administrators still need to learn the art of doing just enough to keep out of trouble.
</para>

</sect2>

<sect2 id="SimplePrintServer">
<title>Central Print Serving</title>

<para>
<indexterm><primary>simple print server</primary></indexterm>
<indexterm><primary>tools</primary></indexterm>
Configuration of a simple print server is easy if you have all the right tools on your system.
</para>

<orderedlist>
<title> Assumptions</title>
	<listitem><para>
	The print server must require no administration.
	</para></listitem>

	<listitem><para>
	The print spooling and processing system on our print server will be CUPS.
	(Please refer to <link linkend="CUPS-printing">CUPS Printing Support</link>, for more information).
	</para></listitem>

	<listitem><para>
	The print server will service only network printers. The network administrator
	will correctly configure the CUPS environment to support the printers.
	</para></listitem>

	<listitem><para>
	All workstations will use only PostScript drivers. The printer driver
	of choice is the one shipped with the Windows OS for the Apple Color LaserWriter.
	</para></listitem>
</orderedlist>

<para>
<indexterm><primary>print server</primary></indexterm>
<indexterm><primary>/var/spool/samba</primary></indexterm>
<indexterm><primary>anonymous</primary></indexterm>
In this example our print server will spool all incoming print jobs to
<filename>/var/spool/samba</filename> until the job is ready to be submitted by
Samba to the CUPS print processor. Since all incoming connections will be as
the anonymous (guest) user, two things will be required to enable anonymous printing.
</para>

<itemizedlist>
<title>Enabling Anonymous Printing</title>
	<listitem><para>
<indexterm><primary>guest account</primary></indexterm>
<indexterm><primary>nobody</primary></indexterm>
<indexterm><primary>testparm</primary></indexterm>
	The UNIX/Linux system must have a <command>guest</command> account.
	The default for this is usually the account <command>nobody</command>.
	To find the correct name to use for your version of Samba, do the 
	following:
<screen>
&prompt;<userinput>testparm -s -v | grep "guest account"</userinput>
</screen>
<indexterm><primary>/etc/passwd</primary></indexterm>
	Make sure that this account exists in your system password
	database (<filename>/etc/passwd</filename>).
	</para>

	<para>
<indexterm><primary>set a password</primary></indexterm>
<indexterm><primary>lock password</primary></indexterm>
<indexterm><primary>passwd</primary></indexterm>
	It is a good idea either to set a password on this account, or else to lock it
	from UNIX use. Assuming that the guest account is called <literal>pcguest</literal>,
	it can be locked by executing:
<screen>
&rootprompt; passwd -l pcguest
</screen>
	The exact command may vary depending on your UNIX/Linux distribution.
	</para></listitem>

	<listitem><para>
<indexterm><primary>directory</primary></indexterm>
<indexterm><primary>guest account</primary></indexterm>
<indexterm><primary>available</primary></indexterm>
<indexterm><primary>mkdir</primary></indexterm>
<indexterm><primary>chown</primary></indexterm>
<indexterm><primary>chmod</primary></indexterm>
	The directory into which Samba will spool the file must have write
	access for the guest account. The following commands will ensure that
	this directory is available for use:
<screen>
&rootprompt;<userinput>mkdir /var/spool/samba</userinput>
&rootprompt;<userinput>chown nobody.nobody /var/spool/samba</userinput>
&rootprompt;<userinput>chmod a+rwt /var/spool/samba</userinput>
</screen>
	</para></listitem>
</itemizedlist>

<para>
The contents of the &smb.conf; file is shown in <link linkend="AnonPtrSvr">the Anonymous Printing example</link>.
</para>

<example id="AnonPtrSvr">
<title>&smb.conf; for Anonymous Printing</title>
<smbconfblock>
<smbconfcomment> Global parameters</smbconfcomment>
<smbconfsection name="[global]"/>
<smbconfoption name="workgroup">&example.workgroup;</smbconfoption>
<smbconfoption name="netbios name">&example.server.samba;</smbconfoption>
<smbconfoption name="security">SHARE</smbconfoption>
<smbconfoption name="passdb backend">guest</smbconfoption>
<smbconfoption name="printing">cups</smbconfoption>
<smbconfoption name="printcap name">cups</smbconfoption>

<smbconfsection name="[printers]"/>
<smbconfoption name="comment">All Printers</smbconfoption>
<smbconfoption name="path">/var/spool/samba</smbconfoption>
<smbconfoption name="printer admin">root</smbconfoption>
<smbconfoption name="guest ok">Yes</smbconfoption>
<smbconfoption name="printable">Yes</smbconfoption>
<smbconfoption name="use client driver">Yes</smbconfoption>
<smbconfoption name="browseable">No</smbconfoption>
</smbconfblock>
</example>


<note><para>
<indexterm><primary>MIME</primary><secondary>raw</secondary></indexterm>
<indexterm><primary>raw printing</primary></indexterm>
<indexterm><primary>/etc/mime.conv</primary></indexterm>
<indexterm><primary>/etc/mime.types</primary></indexterm>
<indexterm><primary>CUPS print filters</primary></indexterm>
On CUPS-enabled systems there is a facility to pass raw data directly to the printer without intermediate
processing via CUPS print filters. Where use of this mode of operation is desired, it is necessary to
configure a raw printing device. It is also necessary to enable the raw mime handler in the
<filename>/etc/mime.conv</filename> and <filename>/etc/mime.types</filename> files. Refer to <link
linkend="CUPS-printing">CUPS Printing Support</link>, <link linkend="cups-raw">Explicitly Enable raw Printing
for application/octet-stream</link>.
</para></note>

<para>
<indexterm><primary>CUPS libarary API</primary></indexterm>
<indexterm><primary>no printcap file</primary></indexterm>
<indexterm><primary>PDF filter</primary></indexterm>
<indexterm><primary>printcap name</primary></indexterm>
The example in <link linkend="AnonPtrSvr">the Anonymous Printing example</link> uses CUPS for direct printing
via the CUPS libarary API. This means that all printers will be exposed to Windows users without need to
configure a printcap file. If there is necessity to expose only a sub-set of printers, or to define a special
type of printer (for example, a PDF filter) the <parameter>printcap name = cups</parameter> can be replaced
with the entry <parameter>printcap name = /etc/samba/myprintcap</parameter>. In this case the file specified
should contain a list of the printer names that should be exposed to Windows network users.
</para>

</sect2>

</sect1>

<sect1>
<title>Common Errors</title>

<para>
<indexterm><primary>greatest mistake</primary></indexterm>
<indexterm><primary>configuration too complex</primary></indexterm>
The greatest mistake so often made is to make a network configuration too complex.
It pays to use the simplest solution that will meet the needs of the moment.
</para>

</sect1>
</chapter>
