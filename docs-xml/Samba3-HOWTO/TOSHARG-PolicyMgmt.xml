<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<chapter id="PolicyMgmt">
<chapterinfo>
	&author.jht;
    <pubdate>April 3 2003</pubdate>
</chapterinfo>

<title>システムとアカウントポリシー</title>

<para>
<indexterm><primary>検証</primary></indexterm>
この章では、Sambaメーリングリストの投稿者による、個人的な経験と知識に由来する知識の
現状について要約する。投稿された情報を再構築する前に、すべての効果に、与えられた情報
を検証することが行われた。この検証を通じては、追加の情報はカバーされていないので、
それも提供している。
</para>

<sect1>
<title>機能と利便性</title>

<para>
<indexterm><primary>グループポリシー</primary></indexterm>
<indexterm><primary>users</primary></indexterm>
<indexterm><primary>groups</primary></indexterm>
Microsoft Windows NT 3.5が発表された時、ホットな新しい話題は、ユーザとグループに対する
グループポリシーの実装であった。次にMicrosoft Windows NT4が来て、いくつかのサイトがこの
機能を適用し始めた。どうやって知ったかって?数多くの<quote>ドジな</quote>(あるいは
間違った)管理者はそれを行い、解決のために助けを求めたからである。
</para>

<para>
<indexterm><primary>グループポリシー</primary></indexterm>
<indexterm><primary>グループポリシーオブジェクト</primary><see>GPO</see></indexterm>
<indexterm><primary>GPOs</primary></indexterm>
<indexterm><primary>ADS</primary></indexterm>
<indexterm><primary>group policy objects</primary><see>GPOs</see></indexterm>
Microsoft Windows 2000とアクティブディレクトリがリリースされるようになると、管理者は
グループポリシーは良いものだ!ということを聞くようになった。これは管理コスト低減を
手助けし、実際にユーザの利便性を向上させた。しかし、ユーザのための、
Microsoft Windows 200x アクティブディレクトリとグループポリシーオブジェクト(GPO)と
マシンの、真の素質の適用は、むしろ遅くなったことに気がついた。
これは、Sambaメーリングリストの2000と2001年頃の、GPOに関連することと、
Samba環境でどのようにそれを複製するかという事についてのわずかな投稿から明白である。
By the time that MS Windows 2000 and Active Directory was released, administrators
got the message: Group Policies are a good thing! They can help reduce administrative
costs and actually make happier users. But adoption of the true
potential of MS Windows 200x Active Directory and Group Policy Objects (GPOs) for users
and machines were picked up on rather slowly. This was obvious from the Samba
mailing list back in 2000 and 2001 when there were few postings regarding GPOs and
how to replicate them in a Samba environment.
</para>

<para>
<indexterm><primary>exploit opportunities</primary></indexterm>
2002年の中盤からのトラフィックの領から判断して、GPOは多くのサイトで標準的に使われる
ようになった。この章では、ユーザデスクトップとネットワーククライアントワークステーション
上の自動制御のためのexploit opportunitiesとして使えるテクニックと方法についてチェック
する。
Judging by the traffic volume since mid 2002, GPOs have become a standard part of
the deployment in many sites. This chapter reviews techniques and methods that can
be used to exploit opportunities for automation of control over user desktops and
network client workstations.
</para>

</sect1>

<sect1>
<title>システムポリシーの作成と運用</title>

<para>
<indexterm><primary>NETLOGON</primary></indexterm>
<indexterm><primary>ドメインコントローラ</primary></indexterm>
<indexterm><primary>レジストリ</primary></indexterm>
<indexterm><primary>affect users</primary></indexterm>
Microsoft Windowsプラットフォーム配下、特にMicrosoft NT4とMicrosoft Windows 95の
リリースに従ったものは、ドメインコントローラのNETLOGON共有中に配置できるタイプの
ファイルを作成することが可能である。クライアントがネットワークにログオンすると、
このファイルは読み取られ、その内容で、クライアントマシンのレジストリの変更を開始する。
このファイルはユーザ、ユーザのグループかマシンに影響するレジストリを変更させる
ことを許可する。
</para>

<para>
<indexterm><primary>Config.POL</primary></indexterm>
<indexterm><primary>poledit.exe</primary></indexterm>
<indexterm><primary>ポリシーエディタ</primary></indexterm>
Microsoft Windows 9x/Meようには、このファイルは<filename>Config.POL</filename>と
しなければならず、ポリシーエディタとしてよく知られている
<filename>poledit.exe</filename>というツールを使って作成できる。ポリシーエディタは
Windows 98インストール用CD-ROMで提供されているが、Microsoft Windows Meでは提供
されなくなった。Microsoft Windowsネットワーク管理者からのコメントによると、
これはMicrosoft Windows Me リソースキットに含まれるようになったとのこと。
</para>

<para>
<indexterm><primary>システムポリシーエディタ</primary></indexterm>
Microsoft Windows NT4サーバ製品には、
<guimenu>スタート -> プログラム -> 管理ツール</guimenu>配下に
<emphasis>システムポリシーエディタ</emphasis>が含まれている。
Microsoft Windows NT4とその後のクライアント用に、このファイルは
<filename>NTConfig.POL</filename>という名前にしなければならない。
</para>

<para>
<indexterm><primary>MMC</primary></indexterm>
Microsoft Windows 2000からは、Microsoft管理コンソールまたはMMCが新たに導入された。
このツールはネットワークアクセスとセキュリティの管理のための、絶えず変わるMicrosoft
手法の展望における新しい流れである。すべての新しいMicrosoft製品または技術は、
古いルールを無効にし、新しい、より複雑なツールと手法を導入するように見える。
Microsoftの信用のために、MMCは進歩のように見えるが、改良された機能は大きな代価
を得る。
New with the introduction of MS Windows 2000 was the Microsoft Management Console
or MMC. This tool is the new wave in the ever-changing landscape of Microsoft
methods for management of network access and security. Every new Microsoft product
or technology seems to make the old rules obsolete and introduces newer and more
complex tools and methods. To Microsoft's credit, the MMC does appear to
be a step forward, but improved functionality comes at a great price.
</para>

<para>
<indexterm><primary>ネットワークポリシー</primary></indexterm>
<indexterm><primary>システムポリシー</primary></indexterm>
<indexterm><primary>プロファイル</primary></indexterm>
<indexterm><primary>ポリシー</primary></indexterm>
ネットワークとシステムポリシーの設定に着手する前に、
<ulink url="http://www.microsoft.com/ntserver/techresources/management/prof_policies.asp">
Implementing Profiles and Policies in Windows NT 4.0</ulink>
という、MicrosoftのWebサイトで提供されている文書を読むことを強く推奨する(訳注:現存しない)。
これらは、四で理解すべきである、古いものに対する大量の追加文書である。
<quote>グループポリシー</quote>をMicrosoftのWebサイト上で探してみること。
</para>

<para>
以下で説明するものは、いくつかの有用な注意事項に関する短い議論である。ここで提供される
情報は不完全であることを警告する&smbmdash;。
</para>

	<sect2>
	<title>Windows 9x/ME ポリシー</title>

	<para>
<indexterm><primary>グループポリシーエディタ</primary></indexterm>
<indexterm><primary>tools\reskit\netadmin\poledit</primary></indexterm>
	Windows 9x/Meは以下でWindows 98のグループポリシーエディタを使ってグループ
	プロファイルを作成する必要があるとする。これはオリジナルの完全なWindows 98
	インストールCD-ROM配下の<filename>tools\reskit\netadmin\poledit</filename>
	ディレクトリ中にある。プログラムの追加と削除機能を使ってこれをインストールし、
	次に、<guiicon>Have Disk</guiicon>をクリックする。
	</para>


	<para>
<indexterm><primary>NTConfig.POL</primary></indexterm>
<indexterm><primary>Config.POL</primary></indexterm>
	ユーザポリシーまたは<filename>マイドキュメント</filename>などの位置を指定する
	ポリシーファイルを作成するために、グループポリシーエディタを使う。次に、
	<smbconfsection name="[NETLOGON]"/>共有のrootに配置する必要がある、
	<filename>Config.POL</filename>というファイルにこれらの設定をセーブする。
	もしもWindows98がSambaドメインにログオンするように設定されていたならば、これは
	自動的にこのファイルを読み、ログオンしようとするマシンの、Windows 9x/Me
	レジストリを更新する。
	</para>

	<para>
	さらなる詳細はWindows98リソースキットの文書中で説明されている。
	</para>

	<para>
<indexterm><primary>registry</primary></indexterm>
	もしも、正しい手順を踏まない場合、時々Windows 9x/Meはレジストリの正当性を検査し、
	各Windows 9x/Meマシンに格納されているレジストリのバックアップコピーから、その
	設定をリストアする。そのため、時々、オリジナルの設定に戻ってしまうと言うことに
	気がつくだろう。
	</para>

	<para>
<indexterm><primary>grouppol.inf</primary></indexterm>
<indexterm><primary>Group Policy</primary></indexterm>
	グループポリシーを適用するために、Windows 9x/Me用のグループポリシーハンドラを
	インストールする。Windows 98 CD-ROMの
	<filename>\tools\reskit\netadmin\poledit</filename>を参照。
	<filename>grouppol.inf</filename>をダブルクリックして、Windows 9x/Meにグループ
	ポリシーをインストールする。不幸にも、これはグループポリシーを使うWindows 98/Me
	マシンすべてで行う必要がある。
	</para>

	</sect2>
	<sect2>
	<title>Windows NT4形式のポリシーファイル</title>

	<para>
<indexterm><primary>ntconfig.pol</primary></indexterm>
<indexterm><primary>poledit.exe</primary></indexterm>
<indexterm><primary>ポリシーエディタ</primary></indexterm>
<indexterm><primary>ドメインプロファイル</primary></indexterm>
	<filename>ntconfig.pol</filename>を作成あるいは編集するために、NT4サーバには
	同梱されているが、NTワークステーションには含まれていない、
	<command>poledit.exe</command>というNTサーバポリシーエディタを使う必要がある。
	NT4ワークステーションにもポリシーエディタはあるが、ドメインポリシーを作成する
	のには適していない。さらに、Windows 95のポリシーエディタはNT4ワークステーション
	あるいはサーバにインストールできるが、NTクライアントではこれは動作しない。
	しかし、NTサーバからのファイルはNT4ワークステーション上でも問題なく動く。
	</para>

	<para>
<indexterm><primary>poledit.exe</primary></indexterm>
<indexterm><primary>common.adm</primary></indexterm>
<indexterm><primary>winnt.adm</primary></indexterm>
<indexterm><primary>c:\winnt\inf</primary></indexterm>
	<filename>poledit.exe</filename>, <filename>common.adm</filename>と
	<filename>winnt.adm</filename>を必要とする。2つの<filename>*.adm</filename>
	ファイルを<filename>c:\winnt\inf</filename>に配置するのは、プログラムが他の場所を
	指定されない限り既定値で探しに行く場所であるので、都合がよい。このディレクトリは
	通常<quote>hidden</quote>である。
	</para>

	<para>
<indexterm><primary>ポリシーエディタ</primary></indexterm>
<indexterm><primary>Nt4sp6ai.exe</primary></indexterm>
<indexterm><primary>poledit.exe</primary></indexterm>
<indexterm><primary>Zero Administration Kit</primary></indexterm>
	Windows NTポリシーエディタは、Windows NT4.0のサービスパック3(とそれ以降)にも
	同梱されている。<command>servicepackname /x</command>を使ってファイルを
	解凍する。&smbmdash;たとえばサービスパック6aでは<command>Nt4sp6ai.exe /x</command>
	である。ポリシーエディタ<command>poledit.exe</command>と関連するテンプレート
	ファイル (*.adm)が解凍される。office97用のテンプレートファイルとポリシーエディタの
	コピーをダウンロードすることも可能である。他の場所としては、Microsoftから
	ダウンロードできるZero Administration Kitがあげられる。
	</para>

		<sect3>
		<title>腐ったレジストリ</title>

			<para>
<indexterm><primary>NTConfig.POL</primary></indexterm>
<indexterm><primary>HKEY_LOCAL_MACHINE</primary></indexterm>
		NT4形式ベースのポリシーの変更で、大量の設定は自動的にユーザのログオフでは
		戻されない。<filename>NTConfig.POL</filename>ファイル中にある設定は
		クライアントマシンのレジストリに適用され、細かな項目がたくさんある
		HKEY_LOCAL_MACHINEキーへの適用は、明示的に戻されない限りそのままになる。
		これは入れ墨として知られている。これはその下部に対して重大な影響を及ぼす
		事が可能となり、管理者は後々そのマシンのを管理する能力を失わないように、
		とても注意しなければならない。
			</para>

		</sect3>
	</sect2>
	<sect2>
	<title>Microsoft Windows 200x/XP Professionalのポリシー</title>

	<para>
<indexterm><primary>レジストリ</primary></indexterm>
	Windows NTpシステムポリシーは、NT4形式のドメイン中のメンバである、ユーザ、
	グループとコンピュータ(クライアントワークステーション)に指定するレジストリ
	パラメータの設定が出来る。このようなポリシーファイルはMicrosoft Windows 200x/XP
	でも動作する。
	</para>

	<para>
	Microsoft Windows 2000では、最近新たにNT4形式のポリシーと比べて上位互換の機能を
	提供する、形式のグループポリシーを導入した。もちろん、ポリシーを作るツールは
	異なり、それを実装するメカニズムはもっと改良されている。
	</para>

	<para>
	<indexterm><primary>GPOs</primary></indexterm>
<indexterm><primary>管理用テンプレート</primary></indexterm>
	古いNT4形式のレジストリベースポリシーは、Microsoft Windows 2000/XP GPO中では
	<emphasis>管理用テンプレート(Administrative Templates)</emphasis>として
	知られている。前者は種々のセキュリティ設定の設定機能、インターネット
	エクスプローラの設定の強制、ユーザデスクトップ(スタートメニュー中に現れる
	メニュー項目に設定されるのと同じような<filename>マイドキュメント</filename>
	ファイルの配置を含む)の変更と外観の切り替え(redirect)を含む。
	追加の新しい機能は、特定のWindowsアプリケーションソフトを特定のユーザ/グループに
	有効化する事を行うことである。
	</para>

	<para>
<indexterm><primary>NTConfig.POL</primary></indexterm>
<indexterm><primary>NETLOGON</primary></indexterm>
<indexterm><primary>local registry values</primary></indexterm>
	思い出してほしいが、NT4のポリシーファイルは<filename>NTConfig.POL</filename>
	という名前で、ドメインコントローラ上のNETLOGON共有のルートに格納される。Windows NT4
	ユーザはユーザ名とパスワードを入力し、ログオンを行うドメイン名を選択する。ログオン
	プロセス処理の間、クライアントマシンは、認証サーバ上のNETLOGON共有から
	<filename>NTConfig.POL</filename>を読み、このファイル中にある設定に従い、ローカルの
	レジストリ値を変更する。
	</para>

	<para>
<indexterm><primary>SYSVOL</primary></indexterm>
<indexterm><primary>NETLOGON</primary></indexterm>
<indexterm><primary>replicated</primary></indexterm>
<indexterm><primary>ADS</primary></indexterm>
<indexterm><primary>ドメインコントローラ</primary></indexterm>
<indexterm><primary>グループポリシーコンテナ</primary><see>GPC</see></indexterm>
<indexterm><primary>グループポリシーテンプレート</primary><see>GPT</see></indexterm>
<indexterm><primary>replicated SYSVOL</primary></indexterm>
	Windows 200x GPOは機能がたくさんある。これらは、NETLOGON共有には格納されないが、
	一部はActive Directoryそれ自身にWindows200x ポリシーファイルとして格納され、
	残りはSYSVOLフォルダと呼ばれる共有(かつ複製される)ボリューム中に格納される。
	このフォルダはすべてのActive Directoryドメインコントローラ上に存在する。
	Active Directoryそれ自身に格納される部分は、グループポリシーコンテナ(GPC)と
	呼ばれ、SYSVOLと呼ばれる複製された共有中に格納されるものは、グループポリシー
	テンプレート(GPT)として知られる。
	</para>

	<para>
<indexterm><primary>GPOs</primary></indexterm>
	NT4クライアントでは、ポリシーファイルは読み取られるが、各ユーザがネットワークに
	ログオンする時のみ実行される。Microsoft Windows 200xポリシーは、もっと
	複雑である。&smbmdash;GPOはクライアントマシン起動時(マシン固有の部分)で処理、
	適用され、ユーザがネットワークにログオンする時、ユーザ個別の部分が適用される。
	Microsoft Windows 200x形式のポリシー管理では、各マシンあるいはユーザは、
	限りなく多くの、同時に適用可能な(かつ、適用される)ポリシーセット(GPO)の適用を
	受けるかもしれない。NT4形式のポリシーファイルでは、これと同様の能力をもつものは
	存在しない。
	</para>

		<sect3>
		<title>Windows 200x/XPポリシーの管理</title>

		<para>
		<indexterm><primary>GPOs</primary></indexterm>
		<indexterm><primary>System Policy Editor</primary></indexterm>
<indexterm><primary>poledit.exe</primary></indexterm>
<indexterm><primary>MMC snap-in</primary></indexterm>
<indexterm><primary>Poledit</primary></indexterm>
		Instead of using the tool called <application>the System Policy Editor</application>, commonly called Poledit (from the
		executable name <command>poledit.exe</command>), <acronym>GPOs</acronym> are created and managed using a 
		<application>Microsoft Management Console</application> <acronym>(MMC)</acronym> snap-in as follows:</para>
		<procedure>
			<step><para>
			Go to the Windows 200x/XP menu <guimenu>Start->Programs->Administrative Tools</guimenu>
			and select the MMC snap-in called <guimenuitem>Active Directory Users and Computers</guimenuitem>
			</para></step>

			<step><para>
<indexterm><primary>organizational unit</primary><see>OU</see></indexterm>
			Select the domain or organizational unit (OU) that you wish to manage, then right-click
			to open the context menu for that object, and select the <guibutton>Properties</guibutton>.
			</para></step>

			<step><para>
			Left-click on the <guilabel>Group Policy</guilabel> tab, then
			left-click on the New tab. Type a name
			for the new policy you will create.
			</para></step>

			<step><para>
			 Left-click on the <guilabel>Edit</guilabel> tab to commence the steps needed to create the GPO.
			</para></step>
		</procedure>

		<para>
		All policy configuration options are controlled through the use of policy administrative
		templates. These files have an .adm extension, both in NT4 as well as in Windows 200x/XP.
		Beware, however, the .adm files are not interchangeable across NT4 and Windows 200x.
		The latter introduces many new features as well as extended definition capabilities. It is
		well beyond the scope of this documentation to explain how to program .adm files; for that,
		refer to the Microsoft Windows Resource Kit for your particular
		version of MS Windows.
		</para>

		<note>
		<para>
<indexterm><primary>gpolmig.exe</primary></indexterm>
<indexterm><primary>NTConfig.POL</primary></indexterm>
<indexterm><primary>resource kit</primary></indexterm>
		The MS Windows 2000 Resource Kit contains a tool called <command>gpolmig.exe</command>. This tool can be used
		to migrate an NT4 <filename>NTConfig.POL</filename> file into a Windows 200x style GPO. Be VERY careful how you
		use this powerful tool. Please refer to the resource kit manuals for specific usage information.
		</para>
		</note>

		</sect3>

		<sect3>
		<title>Custom System Policy Templates</title>

		<para>
		Over the past year, there has been a bit of talk regarding the creation of customized
		templates for the Windows Sytem Policy Editor. A recent announcement on the Samba mailing
		list is worthy of mention.
		</para>

		<para>
		Mike Petersen has announced the availability of a template file he has created. This custom System Policy
		Editor Template will allow you to successfully control Microsoft Windows workstations from an SMB server, such
		as Samba. This template has been tested on a few networks, although if you find any problems with any of these
		policies, or have any ideas for additional policies, let me know at mailto:mgpeter@pcc-services.com.  This
		Template includes many policies for Windows XP to allow it to behave better in a professional environment.
		</para>

		<para>
		For further information please see the <ulink
		url="http://www.pcc-services.com/custom_poledit.html">Petersen</ulink> Computer Consulting web site. There is
		a download link for the template file.
		</para>

		</sect3>
	</sect2>
</sect1>

<sect1>
<title>Managing Account/User Policies</title>

<para>
<indexterm><primary>Policies</primary></indexterm>
<indexterm><primary>policy file </primary></indexterm>
<indexterm><primary>registry settings</primary></indexterm>
Policies can define a specific user's settings or the settings for a group of users. The resulting
policy file contains the registry settings for all users, groups, and computers that will be using
the policy file. Separate policy files for each user, group, or computer are not necessary.
</para>

<para>
<indexterm><primary>NTConfig.POL</primary></indexterm>
If you create a policy that will be automatically downloaded from validating domain controllers,
you should name the file <filename>NTConfig.POL</filename>. As system administrator, you have the option of renaming the
policy file and, by modifying the Windows NT-based workstation, directing the computer to update
the policy from a manual path. You can do this by either manually changing the registry or by using
the System Policy Editor. This can even be a local path such that each machine has its own policy file,
but if a change is necessary to all machines, it must be made individually to each workstation.
</para>

<para>
<indexterm><primary>NTConfig.POL</primary></indexterm>
<indexterm><primary>NETLOGON</primary></indexterm>
When a Windows NT4/200x/XP machine logs onto the network, the client looks in the NETLOGON share on
the authenticating domain controller for the presence of the <filename>NTConfig.POL</filename> file. If one exists, it is 
downloaded, parsed, and then applied to the user's part of the registry.
</para>

<para>
<indexterm><primary>GPOs</primary></indexterm>
<indexterm><primary>ADS</primary></indexterm>
<indexterm><primary>NTConfig.POL</primary></indexterm>
<indexterm><primary>NT4 style policy updates</primary></indexterm>
MS Windows 200x/XP clients that log onto an MS Windows Active Directory security domain may additionally
acquire policy settings through GPOs that are defined and stored in Active Directory
itself. The key benefit of using AD GPOs is that they impose no registry <emphasis>spoiling</emphasis> effect.
This has considerable advantage compared with the use of <filename>NTConfig.POL</filename> (NT4) style policy updates.
</para>

<para>
<indexterm><primary>account restrictions</primary></indexterm>
<indexterm><primary>Common restrictions</primary></indexterm>
In addition to user access controls that may be imposed or applied via system and/or group policies
in a manner that works in conjunction with user profiles, the user management environment under
MS Windows NT4/200x/XP allows per-domain as well as per-user account restrictions to be applied.
Common restrictions that are frequently used include:
</para>

<para>
<indexterm><primary>Account Controls</primary></indexterm>
<itemizedlist>
	<listitem><para>Logon hours</para></listitem>
	<listitem><para>Password aging</para></listitem>
	<listitem><para>Permitted logon from certain machines only</para></listitem>
	<listitem><para>Account type (local or global)</para></listitem>
	<listitem><para>User rights</para></listitem>
</itemizedlist>
</para>

<para>
<indexterm><primary>Domain User Manager</primary></indexterm>
<indexterm><primary>NTConfig.POL</primary></indexterm>
Samba-3.0.20 does not yet implement all account controls that are common to MS Windows NT4/200x/XP.
While it is possible to set many controls using the Domain User Manager for MS Windows NT4, only password
expiry is functional today. Most of the remaining controls at this time have only stub routines
that may eventually be completed to provide actual control. Do not be misled by the fact that a
parameter can be set using the NT4 Domain User Manager or in the <filename>NTConfig.POL</filename>.
</para>

</sect1>
<sect1>
<title>Management Tools</title>

<para>
Anyone who wishes to create or manage Group Policies will need to be familiar with a number of tools.
The following sections describe a few key tools that will help you to create a low-maintenance user
environment.
</para>

	<sect2>
	<title>Samba Editreg Toolset</title>

	<para>
	<indexterm><primary>editreg</primary></indexterm>
	<indexterm><primary>NTUser.DAT</primary></indexterm>
	<indexterm><primary>NTConfig.POL</primary></indexterm>
	A new tool called <command>editreg</command> is under development. This tool can be used
	to edit registry files (called <filename>NTUser.DAT</filename>) that are stored in user
	and group profiles. <filename>NTConfig.POL</filename> files have the same structure as the
	<filename>NTUser.DAT</filename> file and can be edited using this tool. <command>editreg</command>
	is being built with the intent to enable <filename>NTConfig.POL</filename> files to be saved in text format and to
	permit the building of new <filename>NTConfig.POL</filename> files with extended capabilities. It is proving difficult
	to realize this capability, so do not be surprised if this feature does not materialize. Formal
	capabilities will be announced at the time that this tool is released for production use.
	</para>

	</sect2>

	<sect2>
	<title>Windows NT4/200x</title>

	<para>
<indexterm><primary>regedt32.exe</primary></indexterm>
<indexterm><primary>Group Policy Editor</primary></indexterm>
<indexterm><primary>MMC</primary></indexterm>
	The tools that may be used to configure these types of controls from the MS Windows environment are
	the NT4 User Manager for Domains, the NT4 System and Group Policy Editor, and the Registry Editor (regedt32.exe).
	Under MS Windows 200x/XP, this is done using the MMC with appropriate
	<quote>snap-ins,</quote> the registry editor, and potentially also the NT4 System and Group Policy Editor.
	</para>
	</sect2>

	<sect2>
	<title>Samba PDC</title>

	<para>
<indexterm><primary>smbpasswd</primary></indexterm>
<indexterm><primary>pdbedit</primary></indexterm>
<indexterm><primary>NET</primary></indexterm>
<indexterm><primary>rpcclient</primary></indexterm>
	With a Samba domain controller, the new tools for managing user account and policy information include:
	<command>smbpasswd</command>, <command>pdbedit</command>, <command>net</command>, and <command>rpcclient</command>. 
	The administrator should read the man pages for these tools and become familiar with their use.
	</para>

	</sect2>
</sect1>

<sect1>
<title>System Startup and Logon Processing Overview</title>

<para>
The following attempts to document the order of processing the system and user policies following a system
reboot and as part of the user logon:
</para>

<orderedlist>
	<listitem><para>
<indexterm><primary>Remote Procedure Call System Service</primary><see>RPCSS</see></indexterm>
<indexterm><primary>multiple universal naming convention provider</primary><see>MUP</see></indexterm>
	Network starts, then Remote Procedure Call System Service (RPCSS) and multiple universal naming
	convention provider (MUP) start.
	</para></listitem>

	<listitem><para>
<indexterm><primary>ADS</primary></indexterm>
<indexterm><primary>GPOs</primary></indexterm>
	Where Active Directory is involved, an ordered list of GPOs is downloaded
	and applied. The list may include GPOs that:
<itemizedlist>
	<listitem><para>Apply to the location of machines in a directory.</para></listitem>
	<listitem><para>Apply only when settings have changed.</para></listitem>
	<listitem><para>Depend on configuration of the scope of applicability: local,
	site, domain, organizational unit, and so on.</para></listitem>
</itemizedlist>
	No desktop user interface is presented until the above have been processed.
	</para></listitem>

	<listitem><para>
	Execution of startup scripts (hidden and synchronous by default).
	</para></listitem>

	<listitem><para>
	A keyboard action to effect start of logon (Ctrl-Alt-Del).
	</para></listitem>

	<listitem><para>
	User credentials are validated, user profile is loaded (depends on policy settings).
	</para></listitem>

	<listitem><para>
	An ordered list of user GPOs is obtained. The list contents depends on what is configured in respect of:

<itemizedlist>
	<listitem><para>Is the user a domain member, thus subject to particular policies?</para></listitem>
	<listitem><para>Loopback enablement, and the state of the loopback policy (merge or replace).</para></listitem>
	<listitem><para>Location of the Active Directory itself.</para></listitem>
	<listitem><para>Has the list of GPOs changed? No processing is needed if not changed.</para></listitem>
</itemizedlist>
	</para></listitem>

	<listitem><para>
	User policies are applied from Active Directory. Note: There are several types.
	</para></listitem>

	<listitem><para>
	Logon scripts are run. New to Windows 200x and Active Directory, logon scripts may be obtained based on GPOs
	(hidden and executed synchronously). NT4-style logon scripts are then run in a normal
	window.
	</para></listitem>

	<listitem><para>
	The user interface as determined from the GPOs is presented. Note: In a Samba domain (like an NT4
	domain), machine (system) policies are applied at startup; user policies are applied at logon.
	</para></listitem>
</orderedlist>

</sect1>

<sect1>
<title>Common Errors</title>

<para>
Policy-related problems can be quite difficult to diagnose and even more difficult to rectify. The following
collection demonstrates only basic issues.
</para>

<sect2>
<title>Policy Does Not Work</title>

<para>
<quote>We have created the <filename>Config.POL</filename> file and put it in the <emphasis>NETLOGON</emphasis> share.
It has made no difference to our Win XP Pro machines, they just do not see it. It worked fine with Win 98 but does not
work any longer since we upgraded to Win XP Pro. Any hints?</quote>
</para>

<para>
Policy files are not portable between Windows 9x/Me and MS Windows NT4/200x/XP-based platforms. You need to
use the NT4 Group Policy Editor to create a file called <filename>NTConfig.POL</filename> so it is in the
correct format for your MS Windows XP Pro clients.
</para>

</sect2>

</sect1>

</chapter>
