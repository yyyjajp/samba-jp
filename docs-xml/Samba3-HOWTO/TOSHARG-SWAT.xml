<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<chapter id="SWAT">
<chapterinfo>
	&author.jht;
	<pubdate>April 21, 2003</pubdate>
</chapterinfo>

<title>SWAT: Samba Web 管理ツール</title>

<para>
<indexterm><primary>設定ツール</primary></indexterm>
<indexterm><primary>SWAT</primary></indexterm>
<indexterm><primary>Webベースの設定</primary></indexterm>
SWATの有用性に関連しては、数多くの様々な意見がある。完璧な設定ツールを作ろうとする
試みはとても大変な事なのにもかかわらず、個人的な興味の対象として存在している。
SWATはSambaをWebベースで設定するためのツールである。これは、Sambaを簡単に設定する
ための手助けとなりえるウィザードであり、場面に応じて各&smb.conf;パラメータの
ヘルプをWebベースで表示し、現在の接続状況をモニタリングする機能を提供し、ネットワーク
全体の、Microsoft Windowsネットワークパスワード管理ができる。
</para>

<sect1>
<title>機能と利便性</title>

<para>
<indexterm><primary>internetworking super daemon</primary></indexterm>
SWATはSambaシステムの一部である。基本となるプログラム名は<command>swat</command>であり、
これはinetdのようなスーパーデーモンによって起動される。詳細は
<link linkend="xinetd">説明の節</link>を参照のこと。
</para>

<para>
<indexterm><primary>マニュアル</primary></indexterm>
SWATは特定のバージョンのSambaによってサポートされる、パラメータを使うために、
Sambaコンポーネント全体を使う。Samba外部のツールとユーティリティとは異なり、
SWATは常時Sambaパラメータが変更されることに追従している。SWATは各設定パラメータに
対して、場面に応じて、<command>マニュアル</command>ページのエントリから、直接
ヘルプを提供する。
</para>

<para>
<indexterm><primary>文書化</primary></indexterm>
<indexterm><primary>設定ファイル</primary></indexterm>
<indexterm><primary>内部順</primary></indexterm>
ネットワーク管理者の何人かは、設定ファイル中にシステムの説明を書き込むことは良いアイデア
だと思っている人もいるが、そういう人にとって、SWATは常にひどいツールである。SWATは、
何らかの中間的な形式でも、設定ファイルに格納しない。というよりは、パラメータの設定のみを
書き込む。SWATが&smb.conf;ファイルをディスクに書き込むときには、既定値の設定以外の
パラメータのみを書き込む。結果、パラメータと同じように、すべてのコメントは保持されず、
&smb.conf;ファイル中から無くなってしまう。おまけに、パラメータは内部での順番に
書き戻される。
</para>

<note><para>
<indexterm><primary>コメントの削除</primary></indexterm>
SWATを使う前には、&smbmdash; SWATは、書き込んだであろうすべてのコメントを削除した、完全に
最適化されたファイルで、&smb.conf;ファイルを完全に置き換え、ファイルには既定値の設定以外の
設定のみが書かれる。
</para></note>

</sect1>

<sect1>
<title>ガイドラインと技術的なTips</title>

<para>
<indexterm><primary>国際化サポート</primary></indexterm>
この節では、どのようにSWATが動くかせるかという仕掛けの背景にある、秘密の闇を明らかにする
事と、どのようにセキュアに出来るかということと、どのように国際化のサポートを解決するか
という事を説明する。
</para>

<sect2>
<title>SWATインストールの有効か</title>

<para>
<indexterm><primary>SWATバイナリサポート</primary></indexterm>
SWAT操作のためにホストシステムを設定する試みの前にやるべきである、ごく最初のステップは、
それがインストールされているかを調べることである。これは、ある人にとっては取るに足らない
ことに見えるかもしれないが、いくつかのLinuxディストリビューションでは、
ディストリビューションメディア上で、SWATを含む、インストール可能なバイナリパッケージを
提供しているにもかかわらず、SWATを既定値ではインストールしていない。
</para>

<para>
<indexterm><primary>swat</primary></indexterm>
SWATがインストールされていることを確認したら、すべてのサポートしているテキストとWeb
ファイルと同じように、インストールされているバイナリ<command>swat</command>ファイルを
有効化することが必要である。過去、多くのOSディストリビューションが、
<command>swat</command>バイナリ実行形式ファイルがインストールされているのにも
かかわらず、サポートに必要なファイルを含めることに失敗している。
</para>

<para>
<indexterm><primary>inetd</primary></indexterm>
<indexterm><primary>xinetd</primary></indexterm>
最後に、SWATが完全にインストールされたと思ったら、使用しているOSプラットフォームで
使われているinetd系スーパーデーモン(inetdかxinetd)用の制御ファイルで、SWATが
有効になっているかを調べてほしい。
</para>

<sect3>
<title><command>SWAT</command>ファイルの配置</title>

<para>
<indexterm><primary>/usr/local/samba/bin</primary></indexterm>
<indexterm><primary>/usr/sbin</primary></indexterm>
<indexterm><primary>/opt/samba/bin</primary></indexterm>
SWATがインストールされたかを検証するため、最初に、システム上の<command>swat</command>
バイナリファイルを捜す。それはおそらく以下のディレクトリ配下にあるだろう:</para>
<para><simplelist>
	<member><filename>/usr/local/samba/bin</filename> &smbmdash; 既定値のSambaでの位置</member>
	<member><filename>/usr/sbin</filename> &smbmdash; ほとんどのLinuxシステムでの既定値の位置</member>
	<member><filename>/opt/samba/bin</filename></member>
</simplelist>
</para>

<para>
実際の位置はOSベンダの選択か、Sambaをコンパイルしてインストールした管理者の決定によって
大きく変わる。
</para>

<para>
<command>swat</command>バイナリファイルを見つけるために使う方法にはいろいろある。
以下の方法を使うと便利である。
</para>

<para>
<indexterm><primary>swat</primary></indexterm>
<indexterm><primary>OSサーチパス</primary></indexterm>
<indexterm><primary>swatコマンドラインオプション</primary></indexterm>
もしも、<command>swat</command>が現在のOSサーチパス中にあるならば、それを見つけるのは
簡単である。以下のように、<command>swat</command>が、どのようなコマンドラインオプションを
持っているかを調べてみればよい:
<screen>
frodo:~ # swat -?
Usage: swat [OPTION...]
  -a, --disable-authentication         Disable authentication (demo mode)

Help options:
  -?, --help                           Show this help message
  --usage                              Display brief usage message

Common samba options:
  -d, --debuglevel=DEBUGLEVEL          Set debug level
  -s, --configfile=CONFIGFILE          Use alternative configuration file
  -l, --log-basename=LOGFILEBASE       Basename for log/debug files
  -V, --version                        Print version
</screen>
</para>

</sect3>

<sect3>
<title>SWATサポートファイルの配置</title>

<para>
<command>swat</command>がサーチパス中に見つかったならば、ファイルがどこに
配置されているかを識別するのは簡単である。これを行う簡単な別解は以下の通り:
<screen>
frodo:~ # whereis swat
swat: /usr/sbin/swat /usr/share/man/man8/swat.8.gz
</screen>
</para>

<para>
もしも上記による調査で、<command>swat</command>バイナリを見つけるのに失敗したら、
他の方法が必要である。以下が使える:
<screen>
frodo:/ # find / -name swat -print
/etc/xinetd.d/swat
/usr/sbin/swat
/usr/share/samba/swat
frodo:/ #
</screen>
</para>

<para>
この一覧は、このサーバにインストールされているinetd系スーパーデーモン
<command>xinetd</command>の制御ファイルを表示している。SWATバイナリファイルの位置は
<filename>/usr/sbin/swat</filename>であり、それがサポートしているファイルはディレクトリ
<filename>/usr/share/samba/swat</filename>配下にあることを表示している。
</para>

<para>
次に、<command>swat</command>が使うサポートファイルがどこにあるかを調べる。これは
以下のやり方で行う:
<screen>
frodo:/ # strings /usr/sbin/swat | grep "/swat"
/swat/
...
/usr/share/samba/swat
frodo:/ #
</screen>
</para>

<para>
この一覧の中にある<filename>/usr/share/samba/swat/</filename>エントリは、サポートファイルの
位置である。このディレクトリ配下にサポートファイルが存在しているかを調べるべきである。
以下は一覧の例である:
<screen>
jht@frodo:/> find /usr/share/samba/swat -print
/usr/share/samba/swat
/usr/share/samba/swat/help
/usr/share/samba/swat/lang
/usr/share/samba/swat/lang/ja
/usr/share/samba/swat/lang/ja/help
/usr/share/samba/swat/lang/ja/help/welcome.html
/usr/share/samba/swat/lang/ja/images
/usr/share/samba/swat/lang/ja/images/home.gif
...
/usr/share/samba/swat/lang/ja/include
/usr/share/samba/swat/lang/ja/include/header.nocss.html
...
/usr/share/samba/swat/lang/tr
/usr/share/samba/swat/lang/tr/help
/usr/share/samba/swat/lang/tr/help/welcome.html
/usr/share/samba/swat/lang/tr/images
/usr/share/samba/swat/lang/tr/images/home.gif
...
/usr/share/samba/swat/lang/tr/include
/usr/share/samba/swat/lang/tr/include/header.html
/usr/share/samba/swat/using_samba
...
/usr/share/samba/swat/images
/usr/share/samba/swat/images/home.gif
...
/usr/share/samba/swat/include
/usr/share/samba/swat/include/footer.html
/usr/share/samba/swat/include/header.html
jht@frodo:/>
</screen>
</para>

<para>
もしも必要とされるファイルが内ならば、SWATを使う前に、それらを入手してインストールする
必要がある。
</para>

</sect3>
</sect2>

<sect2 id="xinetd">
<title>SWATを使用できるように有効化する</title>

<para>
SWAT should be installed to run via the network super-daemon. Depending on which system
your UNIX/Linux system has, you will have either an <command>inetd</command>- or
<command>xinetd</command>-based system.
</para>

<para>
The nature and location of the network super-daemon varies with the operating system
implementation. The control file (or files) can be located in the file 
<filename>/etc/inetd.conf</filename> or in the directory <filename>/etc/[x]inet[d].d</filename>
or in a similar location.
</para>

<para>
The control entry for the older style file might be:
<indexterm><primary>swat</primary><secondary>enable</secondary></indexterm>
</para>


<para><programlisting>
	# swat is the Samba Web Administration Tool
	swat stream tcp nowait.400 root /usr/sbin/swat swat
</programlisting></para>

<para>
A control file for the newer style xinetd could be:
</para>

<para>
<programlisting>
# default: off
# description: SWAT is the Samba Web Admin Tool. Use swat \
#              to configure your Samba server. To use SWAT, \
#              connect to port 901 with your favorite web browser.
service swat
{
	port    = 901
	socket_type     = stream
	wait    = no
	only_from = localhost
	user    = root
	server  = /usr/sbin/swat
	log_on_failure  += USERID
	disable = no
}
</programlisting>
In the above, the default setting for <parameter>disable</parameter> is <constant>yes</constant>.
This means that SWAT is disabled. To enable use of SWAT, set this parameter to <constant>no</constant>
as shown.
</para>

<para>
<indexterm><primary>swat</primary></indexterm>
<indexterm><primary>/usr/sbin</primary></indexterm>
<indexterm><primary>/usr/share/samba/swat</primary></indexterm>
<indexterm><primary>/usr/local/samba/swat</primary></indexterm>
Both of the previous examples assume that the <command>swat</command> binary has been
located in the <filename>/usr/sbin</filename> directory. In addition to the above,
SWAT will use a directory access point from which it will load its Help files
as well as other control information. The default location for this on most Linux
systems is in the directory <filename>/usr/share/samba/swat</filename>. The default
location using Samba defaults will be <filename>/usr/local/samba/swat</filename>.
</para>

<para>
<indexterm><primary>SWAT permission allowed</primary></indexterm>
<indexterm><primary>password change facility</primary></indexterm>
Access to SWAT will prompt for a logon. If you log onto SWAT as any non-root user,
the only permission allowed is to view certain aspects of configuration as well as
access to the password change facility. The buttons that will be exposed to the non-root
user are <guibutton>HOME</guibutton>, <guibutton>STATUS</guibutton>, <guibutton>VIEW</guibutton>, and 
<guibutton>PASSWORD</guibutton>. The only page that allows
change capability in this case is <guibutton>PASSWORD</guibutton>.
</para>

<para>
As long as you log onto SWAT as the user <emphasis>root</emphasis>, you should obtain
full change and commit ability. The buttons that will be exposed include
<guibutton>HOME</guibutton>, <guibutton>GLOBALS</guibutton>, <guibutton>SHARES</guibutton>, <guibutton>PRINTERS</guibutton>, 
<guibutton>WIZARD</guibutton>, <guibutton>STATUS</guibutton>, <guibutton>VIEW</guibutton>, and <guibutton>PASSWORD</guibutton>.
</para>

</sect2>

<sect2>
<title>Securing SWAT through SSL</title>


<para>
<indexterm><primary>SSL</primary></indexterm>
<indexterm><primary>swat</primary><secondary>security</secondary></indexterm>
Many people have asked about how to set up SWAT with SSL to allow for secure remote
administration of Samba. Here is a method that works, courtesy of Markus Krieger.
</para>

<para>
Modifications to the SWAT setup are as follows: 
</para>

<procedure>
	<step><para>
<indexterm><primary>OpenSSL</primary></indexterm>
	Install OpenSSL.
	</para></step>

	<step><para>
<indexterm><primary>certificate</primary></indexterm>
<indexterm><primary>private key</primary></indexterm>
	Generate certificate and private key.
<indexterm><primary>/usr/bin/openssl</primary></indexterm>
<screen>
&rootprompt;<userinput>/usr/bin/openssl req -new -x509 -days 365 -nodes -config \
	/usr/share/doc/packages/stunnel/stunnel.cnf \
	-out /etc/stunnel/stunnel.pem -keyout /etc/stunnel/stunnel.pem</userinput>
</screen></para></step>

	<step><para>
	Remove SWAT entry from [x]inetd.
	</para></step>

	<step><para>
<indexterm><primary>stunnel</primary></indexterm>
	Start <command>stunnel</command>.

<screen>
&rootprompt;<userinput>stunnel -p /etc/stunnel/stunnel.pem -d 901 \
	 -l /usr/local/samba/bin/swat swat </userinput>
</screen></para></step>
</procedure>

<para>
Afterward, simply connect to SWAT by using the URL <ulink noescape="1"
url="https://myhost:901">https://myhost:901</ulink>, accept the certificate, and the SSL connection is up.
</para>

</sect2>

<sect2>
<title>Enabling SWAT Internationalization Support</title>

<para>
SWAT can be configured to display its messages to match the settings of
the language configurations of your Web browser. It will be passed to SWAT 
in the Accept-Language header of the HTTP request.
</para>

<para>
To enable this feature:
</para>

<itemizedlist>
	<listitem><para>
	Install  the proper <command>msg</command> files from the Samba
	<filename>source/po</filename> directory into $LIBDIR.
	</para></listitem>

	<listitem><para>
	Set your browsers language setting.
	</para></listitem>
</itemizedlist>

<para>
<indexterm><primary>msg file</primary></indexterm>
<indexterm><primary>Japanese</primary></indexterm>
<indexterm><primary>French</primary></indexterm>
<indexterm><primary>English</primary></indexterm>
The name of the <command>msg</command> file is the same as the language ID sent by the browser. For
example, <emphasis>en</emphasis> means English, <emphasis>ja</emphasis> means Japanese, <emphasis>fr</emphasis> means French.
</para>

<para>
<indexterm><primary>locale</primary></indexterm>
If you do not like some of messages, or there are no <command>msg</command> files for
your locale, you can create them simply by copying the <command>en.msg</command> files
to the directory for <quote>your language ID.msg</quote> and filling in proper strings
to each <quote>msgstr</quote>. For example, in <filename>it.msg</filename>, the
<command>msg</command> file for the Italian locale, just set:
<screen>
msgid "Set Default"
msgstr "Imposta Default"
</screen>
<indexterm><primary>msg</primary></indexterm>
and so on. If you find a mistake or create a new <command>msg</command> file, please email it
to us so we will consider it in the next release of Samba. The <command>msg</command> file should be encoded in UTF-8.
</para>

<para>
<indexterm><primary>UTF-8 encoding</primary></indexterm>
Note that if you enable this feature and the <smbconfoption name="display charset"/> is not
matched to your browser's setting, the SWAT display may be corrupted.  In a future version of
Samba, SWAT will always display messages with UTF-8 encoding. You will then not need to set
this &smb.conf; file parameter.
</para>

</sect2>

</sect1>

<sect1>
<title>Overview and Quick Tour</title>

<para>
SWAT is a tool that may be used to configure Samba or just to obtain useful links
to important reference materials such as the contents of this book as well as other
documents that have been found useful for solving Windows networking problems.
</para>

<sect2>
<title>The SWAT Home Page</title>

<para>
The SWAT title page provides access to the latest Samba documentation. The manual page for
each Samba component is accessible from this page, as are the Samba3-HOWTO (this 
document) as well as the O'Reilly book <quote>Using Samba.</quote>
</para>

<para>
Administrators who wish to validate their Samba configuration may obtain useful information
from the man pages for the diagnostic utilities. These are available from the SWAT home page
also. One diagnostic tool that is not mentioned on this page but that is particularly
useful is <ulink url="http://www.ethereal.com/"><command>ethereal</command></ulink>.
</para>

<warning><para>
SWAT can be configured to run in <emphasis>demo</emphasis> mode. This is not recommended
because it runs SWAT without authentication and with full administrative ability. It allows
changes to &smb.conf; as well as general operation with root privileges. The option that
creates this ability is the <option>-a</option> flag to SWAT. <emphasis>Do not use this in a
production environment.</emphasis>
</para></warning>

</sect2>

<sect2>
<title>Global Settings</title>

<para>
The <guibutton>GLOBALS</guibutton> button exposes a page that allows configuration of the global parameters
in &smb.conf;. There are two levels of exposure of the parameters:
</para>

<itemizedlist>
	<listitem><para>
	<guibutton>Basic</guibutton> &smbmdash; exposes common configuration options.
	</para></listitem>

	<listitem><para>
	<guibutton>Advanced</guibutton> &smbmdash; exposes configuration options needed in more 
	complex environments.
	</para></listitem>
</itemizedlist>

<para>
To switch to other than <guibutton>Basic</guibutton> editing ability, click on <guibutton>Advanced</guibutton>.
You may also do this by clicking on the radio button, then click on the <guibutton>Commit Changes</guibutton> button.
</para>

<para>
After making any changes to configuration parameters, make sure that
you click on the 
<guibutton>Commit Changes</guibutton> button before moving to another area; otherwise,
your changes will be lost.
</para>

<note><para>
SWAT has context-sensitive help. To find out what each parameter is
for, simply click on the
<guibutton>Help</guibutton> link to the left of the configuration parameter.
</para></note>

</sect2>

<sect2>
<title>Share Settings</title>

<para>
To affect a currently configured share, simply click on the pull-down button between the
<guibutton>Choose Share</guibutton> and the <guibutton>Delete Share</guibutton> buttons and
select the share you wish to operate on. To edit the settings,
click on the
<guibutton>Choose Share</guibutton> button. To delete the share, simply press the
<guibutton>Delete Share</guibutton> button.
</para>

<para>
To create a new share, next to the button labeled <guibutton>Create Share</guibutton>, enter
into the text field the name of the share to be created, then click on the 
<guibutton>Create Share</guibutton> button.
</para>

</sect2>

<sect2>
<title>Printers Settings</title>

<para>
To affect a currently configured printer, simply click on the pull-down button between the
<guibutton>Choose Printer</guibutton> and the <guibutton>Delete Printer</guibutton> buttons and
select the printer you wish to operate on. To edit the settings,
click on the
<guibutton>Choose Printer</guibutton> button. To delete the share, simply press the
<guibutton>Delete Printer</guibutton> button.
</para>

<para>
To create a new printer, next to the button labeled <guibutton>Create Printer</guibutton>, enter
into the text field the name of the share to be created, then click on the 
<guibutton>Create Printer</guibutton> button.
</para>

</sect2>

<sect2>
<title>The SWAT Wizard</title>

<para>
The purpose of the SWAT Wizard is to help the Microsoft-knowledgeable network administrator
to configure Samba with a minimum of effort.
</para>

<para>
The Wizard page provides a tool for rewriting the &smb.conf; file in fully optimized format.
This will also happen if you press the <guibutton>Commit</guibutton> button. The two differ
because the <guibutton>Rewrite</guibutton> button ignores any changes that may have been made,
while the <guibutton>Commit</guibutton> button causes all changes to be affected.
</para>

<para>
The <guibutton>Edit</guibutton> button permits the editing (setting) of the minimal set of
options that may be necessary to create a working Samba server.
</para>

<para>
Finally, there are a limited set of options that determine what type of server Samba
will be configured for, whether it will be a WINS server, participate as a WINS client, or
operate with no WINS support. By clicking one button, you can elect to expose (or not) user
home directories.
</para>

</sect2>

<sect2>
<title>The Status Page</title>

<para>
The status page serves a limited purpose. First, it allows control of the Samba daemons.
The key daemons that create the Samba server environment are &smbd;, &nmbd;, and &winbindd;.
</para>

<para>
The daemons may be controlled individually or as a total group. Additionally, you may set
an automatic screen refresh timing. As MS Windows clients interact with Samba, new smbd processes
are continually spawned. The auto-refresh facility allows you to track the changing
conditions with minimal effort.
</para>

<para>
Finally, the status page may be used to terminate specific smbd client connections in order to
free files that may be locked.
</para>

</sect2>

<sect2>
<title>The View Page</title>

<para>
The view page allows you to view the optimized &smb.conf; file and, if you are
particularly masochistic, permits you also to see all possible global configuration
parameters and their settings.
</para>

</sect2>

<sect2>
<title>The Password Change Page</title>

<para>
The password change page is a popular tool that allows the creation, deletion, deactivation,
and reactivation of MS Windows networking users on the local machine. You can also use
this tool to change a local password for a user account.
</para>

<para>
When logged in as a non-root account, the user must provide the old password as well as
the new password (twice). When logged in as <emphasis>root</emphasis>, only the new password is
required.
</para>

<para>
One popular use for this tool is to change user passwords across a range of remote MS Windows
servers.
</para>

</sect2>
</sect1>

</chapter>
