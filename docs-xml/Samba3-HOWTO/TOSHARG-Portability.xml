<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<chapter id="Portability">
<chapterinfo>
	&author.jelmer;
	&author.jht;
	<!-- この文書がベースとしているテキストファイルに著者名がない何人か他
	の人々 -->
</chapterinfo>

<title>移植性</title>

<para>
<indexterm><primary>プラットフォーム</primary></indexterm>
<indexterm><primary>互換性</primary></indexterm>
Samba は広い範囲のプラットフォームで機能する。しかし、
すべてのプラットフォームの提供するインタフェースが常に互換性があるとは限らない。
この章は Samba のコンパイルと利用についてプラットフォームに特化した情報を含む。
</para>

<sect1>
<title>HPUX</title>

<para>
<indexterm><primary>/etc/logingroup</primary></indexterm>
<indexterm><primary>/etc/group</primary></indexterm>
ヒューレットパッカーの補助グループの実装が非標準である (歴史的な理由により)。
<filename>/etc/group</filename> と <filename>/etc/logingroup</filename> の
２つのグループファイルがある。システムは UID を前者のファイルを使用して割り当
てるが、 initgroups() は後者を参照する。
コツを知っている大抵のシステム管理者は、シンボリックリン
ク <filename>/etc/group</filename> 
を <filename>/etc/logingroup</filename> へ張る (ここに入ることができない愚鈍な
理由でハードリンクでは機能しない) 。
もし、所属しているグループのうちの一つが、<filename>/etc/logingroup</filename>
の中で、不正な ID であると考えられた場合はエラーを出す。
ここで言う不正な ID とは <constant>[0..UID_MAX]</constant> の範囲を超えた場合
であり、<constant>UID_MAX</constant> は HP-UX で現在のところ 60000 である。
この範囲は、-2 と 65534 を除外している。これは通常 <constant>nobody</constant>
GID である。
</para>

<para>
もしこの問題に遭遇した場合は、initgroups() に失敗するプログラムが、
実行しているユーザが許可された範囲外の GID のグループユーザによって実行されている
ことを確認すること。
If you encounter this problem, make sure the programs that are failing 
to initgroups() are run as users, not in any groups with GIDs outside the 
allowed range.
</para>

<para>
このことは、HP マニュアルページ setgroup(2) と passwd(4)に記述されている。
</para>

<para>
<indexterm><primary>gcc</primary></indexterm>
<indexterm><primary>ANSI コンパイラ</primary></indexterm>
HP-UX では、gcc または HP ANSI コンパイラを利用しなければならない。
HP-UX に付属する無償のコンパイラは ANSI に準拠していないため Samba をコンパイ
ルできない。
</para>

</sect1>

<sect1>
<title>SCO UNIX</title>

<para>
もし古いバージョンの SCO UNIX を稼働させているのなら、Samba を正常に
機能させるために TCP/IP の重要なパッチを入手する必要があるだろう。
そのパッチなしには、Samba を利用している際に転送データの破損に遭遇するだろう。
Without the patch, you may encounter corrupt data transfers using Samba.
</para>

<para>
必要とするパッチは UOD385 Connection Drivers SLS だ。
SCO <ulink noescape="1" url="ftp://ftp.sco.com/">ftp.sco.com</ulink> からダウ
ンロードできる。ディレクトリ SLS のファイル uod385a.Z と uod385a.ltr.Z 。
It is available from
SCO <ulink noescape="1" url="ftp://ftp.sco.com/">ftp.sco.com</ulink>, directory SLS,
files uod385a.Z and uod385a.ltr.Z).
</para>

<para>
ここで提供される情報は、SCO UNIX の古いバージョンを参照している。
もしより新しい SCO UNIX のバイナリを求めるならば、インストールする準備ができて
いるパッケージを入手するため SCO に連絡すること。
インストールするバイナリのためプラットフォームが最新であることも SCO で確認し
なければならない。
これはインストール作業にてデータ破損を避けるために重要なことだ。
SCO UNIX 製品のために Samba をビルドする場合、 Samba のソースに大幅なパッチが
必要となる。
SCO から直接バイナリパッケージを入手ことの方がとても容易である。
</para>

</sect1>

<sect1>
<title>DNIX</title>

<para>
DNIX は seteuid() と setegid() に問題がある。これらのルーチンは Samba が正しく
機能するために必要である。しかし、それらはいくつかの理由により DNIX の C ライ
ブラリから抜け落ちている。
</para>

<para>
この理由により Samba は includes.h の DNIX セクションにてデフォルトで NO_EID
マクロを定義している。
これは問題のまわりで、限られた方法で機能する。しかし理想からは程遠く
いくつかの事柄はまだ正しく機能しないだろう。
</para>

<para> 
この問題を正しく解決するため、以下の２つの関数をアセンブルする必要がある。
そしてそれらを C ライブラリに加えるか、 Samba にリンクすること。
以下のコードを <filename>setegid.s</filename> の中ににおくこと。
</para>

<para><programlisting>
        .globl  _setegid
_setegid:
        moveq   #47,d0
        movl    #100,a0
        moveq   #1,d1
        movl    4(sp),a1
        trap    #9
        bccs    1$
        jmp     cerror
1$:
        clrl    d0
        rts
</programlisting></para>

<para>
以下を <filename>seteuid.s</filename> の中におくこと。
</para>

<para><programlisting>
        .globl  _seteuid
_seteuid:
        moveq   #47,d0
        movl    #100,a0
        moveq   #0,d1
        movl    4(sp),a1
        trap    #9
        bccs    1$
        jmp     cerror
1$:
        clrl    d0
        rts
</programlisting></para>

<para>
ファイルを作成した後に、それらを以下のようにアセンブルする。
</para>

<screen>
&prompt;<userinput>as seteuid.s</userinput>
&prompt;<userinput>as setegid.s</userinput>
</screen>

<para>
which should produce the files <filename>seteuid.o</filename> and
<filename>setegid.o</filename>.
</para>

<para>
次に Samba の Makefile にて DNIX セクションの中の LIBSM 行にそれらを加える。
LIBSM 行は以下に多少似るだろう。
</para>

<para><programlisting>
LIBSM = setegid.o seteuid.o -ln
</programlisting></para>

<para>
次に以下の行を削除する。
</para>

<para><programlisting>
#define NO_EID
</programlisting></para>

<para><filename>includes.h</filename> の DNIX セクションから。</para>

</sect1>

<sect1>
<title>Red Hat Linux</title>

<para>
デフォルトにてインストール中に、Red Hat Linux のいくつかのバージョンでは以下の
ようなエントリを<filename>/etc/hosts</filename>に追加する。
<programlisting>
127.0.0.1 loopback "hostname"."domainname"
</programlisting>
</para>

<para>
<indexterm><primary>ループバックインタフェース</primary></indexterm>
これは Samba にループバックインタフェースへループバックすることを引き起こす。
結果として、Samba は他の PC と正常に通信することに失敗する。
ひいてはマスターブラウズリストを保有者 と マスターブラウザ
が誰なのか正常にネゴシエートすることも失敗するだろう。
</para>

<para>
修正措置: 127.0.0.1 で始まる行の中で "loopback" という語の後のエントリを削除する。
</para>
</sect1>

<sect1>
<title>AIX: シーケンシャル先読み</title>
<!-- William Jojo <jojowil@hvcc.edu> からのメールより -->
<para>
シーケンシャル先読みを無効にすると次の状況にて Samba のパフォーマンスを著しく
改善できる。相対的に高度なマルチプログラミング(多数の smbd プロセスや他の負荷と
の混合), 充分でない物理メモリ、またはより遅いディスク技術。
これらは AIX に高いウエイト値の原因となる。
シーケンシャル先読みを無効にすることはまたシステム上の他の負荷に対して反対の作用
を及ぼすことがあるため他のアプリケーションへのインパクトを評価する必要があるだ
ろう。
</para>

<para>
IBM によって提供されるデフォルトの利用が推奨される。しかし多数のウエイトタイム
を経験した場合、以下のコマンドで先読みを無効にすることを試すこと。
</para>

<para>
AIX 5.1 とそれ以前: <userinput>vmtune -r 0</userinput>
</para>

<para>
AIX 5.2 とそれ以降の jfs ファイルシステム: <userinput>ioo -o minpgahead=0</userinput>
</para>

<para>
AIX 5.2 とそれ以降の jfs2 ファイルシステム: <userinput>ioo -o j2_minPageReadAhead=0</userinput>
</para>

<para>
もし、jfs と jfs2 ファイルシステムが同一ホスト上に混合する場合、単純に
双方の ioo コマンドを利用する。
</para>
</sect1>

<sect1>
<title>Solaris</title>

<sect2>
<title>Locking Improvements</title>

<para>Some people have been experiencing problems with F_SETLKW64/fcntl 
when running Samba on Solaris. The built-in file-locking mechanism was
not scalable. Performance would degrade to the point where processes would
get into loops of trying to lock a file. It would try a lock, then fail,
then try again. The lock attempt was failing before the grant was
occurring. The visible manifestation of this was a handful of
processes stealing all of the CPU, and when they were trussed, they would
be stuck in F_SETLKW64 loops.
</para>

<para>
Please check with Sun support for current patches needed to fix this bug.
The patch revision for 2.6 is 105181-34, for 8 is 108528-19, and for 9 is 112233-04.
After the installation of these patches, it is recommended to reconfigure
and rebuild Samba.
</para>

<para>Thanks to Joe Meslovich for reporting this.</para>

</sect2>

<sect2 id="winbind-solaris9">
<title>Winbind on Solaris 9</title>
<para>
Nsswitch on Solaris 9 refuses to use the Winbind NSS module. This behavior
is fixed by Sun in patch <ulink
url="http://sunsolve.sun.com/search/advsearch.do?collection=PATCH&amp;type=collections&amp;max=50&amp;language=en&amp;queryKey5=112960;rev=14&amp;toDocument=yes">112960-14</ulink>.
</para>
</sect2>
</sect1>

</chapter>
