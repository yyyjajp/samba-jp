<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<refentry id="mount.cifs.8">

<refmeta>
	<refentrytitle>mount.cifs</refentrytitle>
	<manvolnum>8</manvolnum>
</refmeta>


<refnamediv>
	<refname>mount.cifs</refname>
	<refpurpose>Common Internet File System (CIFS) を使用したマウント
</refnamediv>

<refsynopsisdiv>
	<cmdsynopsis>

		<command>mount.cifs</command>
		<arg choice="req">service</arg>	
		<arg choice="req">mount-point</arg>	
		<arg choice="opt">-o options</arg>	
	</cmdsynopsis>
</refsynopsisdiv>

<refsect1>
	<title>解説</title>

	<para>このツールは <citerefentry><refentrytitle>samba</refentrytitle>
	<manvolnum>7</manvolnum></citerefentry> スイートの一部である。</para>

	<para>mount.cifs は Linux の CIFS ファイルシステムをマウントする。
	これは通常、"-t cifs" オプションが指定された場合に
	<citerefentry><refentrytitle>mount</refentrytitle>
	<manvolnum>8</manvolnum></citerefentry> によって間接的に呼び出される。
	このコマンドは Linux 上でしか動作せず、カーネルが CIFS
	ファイルシステムをサポートしていなければいけない。CFS プロトコルは SMB
	プロトコルの後継プロトコルであり、Samba の他にもほとんどの Windows 
	サーバや他の商用サーバ、ネットワーク・ストレージ機器などで
	サポートされている。</para>

	<para>
	mount.cifs ユーティリティは、UNC 名 (公開されたネットワークリソース)に
	ローカルディレクトリの <emphasis>mount-point</emphasis> を割り当てる。
	mount.cifs のモードを setuid root にすることで、root
	以外のユーザも書き込み権限のある共有をディレクトリにマウントすることが
	可能である。</para>

	<para>
	<emphasis>mount.cifs</emphasis> のオプションはカンマ「,」
		で区切られた key=value の組み合わせで指定される。
		ここで列挙されているオプション以外でも、CIFS
	ファイルシステムのカーネルモジュール (cifs.ko) がサポートしているオプションを指定することもできる。
		マウントに失敗した場合は、カーネルのログを参照して無効な
		オプションがないか探してみるといいだろう。
	</para>

	<para><emphasis>mount.cifs</emphasis> はデーモンである。
	マウント後は、マウントしたリソースが (通常 umount ユーティリティで)
	アンマウントされるまで実行されたままになる。
	</para>

</refsect1>

<refsect1>
	<title>オプション</title>
	<variablelist>
		<varlistentry><term>user=<replaceable>arg</replaceable></term>

		<listitem><para>接続する際に用いるユーザ名を指定する。
		指定されていないときは、環境変数 <envar>USER</envar>
		が使用される。このオプションは、"user%password" や
		"workgroup/user" もしくは "workgroup/user%password"
		という形で、ユーザ名の一部としてパスワードやワークグループを
		指定することも可能である。
		</para>


<note>
	<para>
	cifs VFS モジュールは、<parameter>user=</parameter> というパラメータの他に、
	smbfs に慣れたユーザのために <parameter>username=</parameter> という長い形式のパラメータも受け付ける。
	同様に、<parameter>pass=</parameter>、<parameter>dom=</parameter>、<parameter>cred=</parameter> といった短い cifs のパラメータの同義語として、smbfs 形式の長いパラメータ名も受け付けられる。
	</para>
</note>

		</listitem>
	</varlistentry>

	<varlistentry><term>password=<replaceable>arg</replaceable></term>

		<listitem><para>CIFS のパスワードを指定する。
		指定されていないときは、環境変数 <emphasis>PASSWD</emphasis>
		が使用される。パスワードが取得できなければ、guest
		オプションが指定されていない限り、<emphasis>mount.cifs</emphasis>
		はパスワードを求めるプロンプトを表示する。</para>
</para>

		<para>
		コマンドラインでは、(カンマ','のような) 引数の区切り文字を含む
		パスワードは、正しく認識できないことに注意すること。ただし、
		PASSWD 環境変数やパスワードを格納したファイル
		(以下「資格情報ファイル」と呼ぶ。詳しくは後述)もしくはパスワードプロンプトからの入力においては、
		そのようなパスワードも正しく認識できる。</para>
	</listitem></varlistentry>

	<varlistentry><term>credentials=<replaceable>filename</replaceable></term>

		<listitem><para>ユーザ名やパスワードを含む資格情報ファイルを指定する。
		ファイルのフォーマットは以下のとおり:
		</para>

<programlisting>
		username=<replaceable>value</replaceable>
		password=<replaceable>value</replaceable>
</programlisting>
		
		<para>資格情報ファイルを利用することは、
		<filename>/etc/fstab</filename> のような 共有されている
		ファイル中に平文でパスワードを記述するより好ましい。
		このファイルは適切に保護するように注意すること。
		</para>

	</listitem></varlistentry>

	<varlistentry>
		<term>uid=<replaceable>arg</replaceable></term>

		<listitem><para>マウント先のファイルの所有者として用いる uid
		を設定する。 これはユーザ名でも数値の uid でも指定できる。
		対象となるサーバが CIFS Unix extensions をサポートする場合、
		このパラメータは無視される。</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>gid=<replaceable>arg</replaceable></term>

		<listitem><para>マウント先のファイルの所有者として用いる gid
		を設定する。 これはグループ名でも数値の gid でも指定できる。
		対象となるサーバが CIFS Unix extensions をサポートする場合、
		このパラメータは無視される。
		</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>port=<replaceable>arg</replaceable></term>

		<listitem><para>CIFS サポートの手続きを行うためのサーバの
		ポート番号を指定する。もしサーバが指定されたポート番号を
		開いていない場合や、この値が指定されなかった場合には、
		デフォルトである 445 が試され、それでもレスポンスがなかった
		場合は 139 が試される。
		</para></listitem>
	</varlistentry>

        <varlistentry>
                <term>netbiosname=<replaceable>arg</replaceable></term>

                <listitem><para>ポート 139 でサーバにマウントされる場合、
		RFC1001 の NetBIOS セッション初期化中に
		クライアントの NetBIOS コンピュータ名として用いられる名前を指定する。
		</para></listitem>
        </varlistentry>

	<varlistentry>
		<term>file_mode=<replaceable>arg</replaceable></term>

		<listitem><para>サーバが CIFS Unix extensions を
		サポートしていない場合、指定された値がローカルで使用される
		デフォルトのファイルモードを上書きする。</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>dir_mode=<replaceable>arg</replaceable></term>

		<listitem><para>サーバが CIFS Unix extensions を
		サポートしていない場合、指定された値がローカルで使用される
		デフォルトのディレクトリモードを上書きする。</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>ip=<replaceable>arg</replaceable></term>

		<listitem><para>対象のホスト名か IP アドレスを指定する。
		</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>domain=<replaceable>arg</replaceable></term>

		<listitem><para>ユーザの所属するドメイン名 (ワークグループ名)
		を指定する。</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>guest</term>

		<listitem><para>パスワードプロンプトを表示しない。
		</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>iocharset</term>

		<listitem><para>
		Unicode と変換するローカルパス名の文字コードを設定する。
		Unicode は、サーバがサポートしている限り、ネットワークパス名のデフォルトの文字コードとして用いられる。
		iocharset が指定されておらず、nls_default がクライアントのカーネルビルド時に指定されている場合は、それが用いられる。
		サーバが Unicode をサポートしていない場合、このパラメータは用いられない。
		</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>ro</term>

		<listitem><para>read-only でマウントする。</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>rw</term>
		<listitem><para>read-write でマウントする。</para></listitem>
	</varlistentry>

        <varlistentry>
                <term>setuids</term>
                <listitem><para>
		CIFS Unix extension が有効化された場合、
		クライアントは新規に作成するファイル、ディレクトリ、デバイス (create / mkdir / mknod) に対して、ローカルプロセスの実効 uid および gid を設定しようとする。
		CIFS Unix Extension が無効な場合、新規に作成されるファイルやディレクトリには、
		マウント時に指定されたデフォルトの uid と gid を設定する代わりに、
		新規ファイルの uid と gid をローカルにキャッシュする。これは、inode 
		がリロードされる度に (つまりユーザが共有を再マウントする度に)
		ファイルの uid が変更されることを意味する。
                </para></listitem>
        </varlistentry>

        <varlistentry>
                <term>nosetuids</term>
                <listitem><para>
		クライアントは、新規に作成するファイル、ディレクトリ、デバイス (create / mkdir / mknod) に対して、uid や gid を設定しようとしない。
		これは、サーバが uid や gid をデフォルトの値 (通常共有をマウントしたユーザのもの) に設定することを意味する。
		デフォルトでは、(クライアントではなく) サーバが uid や gid を設定する。
		CIFS Unix Extension が無効の場合、新規ファイルの uid (gid) はマウントしたユーザ、もしくはマウント時にパラメータで指定した uid (gid) となる。
                </para></listitem>
        </varlistentry>

        <varlistentry>
                <term>perm</term>
                <listitem><para>
		Client does permission checks (vfs_permission check of uid
                and gid of the file against the mode and desired operation),
                Note that this is in addition to the normal ACL check on the
                target machine done by the server software.
                Client permission checking is enabled by default.</para></listitem>

        </varlistentry>

        <varlistentry>
                <term>noperm</term>
                <listitem><para>Client does not do permission checks.  This can expose
                files on this mount to access by other users on the local
                client system. It is typically only needed when the server
                supports the CIFS Unix Extensions but the UIDs/GIDs on the
                client and server system do not match closely enough to allow
                access by the user doing the mount.
                Note that this does not affect the normal ACL check on the
                target machine done by the server software (of the server
                ACL against the user name provided at mount time).</para></listitem>
        </varlistentry>

        <varlistentry>
                <term>directio</term>
                <listitem><para>
		マウント中にオープンされたファイルの inode 情報をキャッシュしない。
		これは、マウント中に mmap されたファイルも preclude する。
		高速なネットワーク環境で、キャッシュをほとんど、もしくは全く行なわないことによりクライアントにメリットがある場合 (例えば、アプリケーションがページサイズを越えるような大量のシーケンシャルな読み込みを行なっており、かつ読み込んだデータの再読み込みは行なっていないような状況) 、
		oplock が取得され、維持されている限りローカルな Linux クライアントのページキャッシュ経由で読み取り(先読み/readahead)や書き込み(writebehind)をキャッシュするデフォルトの挙動と比較してパフォーマンスの向上をもたらす場合がある。
		このパラメータを有効にすることで、ページサイズを越える書き込み処理は、直接サーバに送られるようになる。
		カーネルによっては、cifs.ko モジュールが CIFS_EXPERIMENTAL という configure オプションを有効にしてビルドされている必要がある。
		</para></listitem>
        </varlistentry>

        <varlistentry>
                <term>mapchars</term>
                <listitem><para>
		予約されている 7 文字の内 6 文字 (バックスラッシュ以外の、コロン、疑問符、パイプ、アスタリスク、＞、＜記号) を、remap range (0xF000 以上) に割り当てる。
		これにより、 CIFS クライアントは Windows の POSIX エミュレーション環境下で作成されたこれらの文字を含むファイル名を認識することが可能となる。
		このオプションは、 (これら 7 文字を含むファイル名の作成やオープンを禁止している) ほとんどのバージョンの Samba の共有をマウントする際にも有用である。
		サーバがネットワーク上で Unicode をサポートしていない場合、このオプションは無効となる。
                </para></listitem>
        </varlistentry>

        <varlistentry>
                <term>nomapchars</term>
                <listitem><para>これら 7 文字の割り当てを行なわない(デフォルト)。</para></listitem>
        </varlistentry>

        <varlistentry>
                <term>intr</term>
                <listitem><para>現在実装されていない</para></listitem>
        </varlistentry>

        <varlistentry>
                <term>nointr</term>
                <listitem><para>(デフォルト) 現在実装されていない</para></listitem>
        </varlistentry>

        <varlistentry>
                <term>hard</term>
                <listitem><para>CIFS でマウントされたファイルシステムにアクセスしているプログラムは、サーバがクラッシュすると、ハングアップする。
              server crashes.</para></listitem>
        </varlistentry>

        <varlistentry>
                <term>soft</term>
                <listitem><para>(デフォルト) CIFS でマウントされたファイルシステムにアクセスしているプログラムは、サーバがクラッシュしてもハングアップせず、ユーザアプリケーションにはエラーが返却される。</para></listitem>
        </varlistentry>

	<varlistentry>
                <term>noacl</term>
                <listitem><para>
		サーバがサポートしていた場合でも、POSIX ACL 機能を無効にする。</para>
		<para>
		CIFS クライアントは、バージョン3.10 以降の Samba サーバに対して POSIX ACL の取得や設定 (getfacl や setfacl) を行なうことができる。
		POSIX ACL の設定を行なうには、XATTR (拡張属性)のサポートに加え、CIFS モジュールのビルドの際、CIFS 設定オプション中の POSIX サポートを有効にしていることが必要である。
		POSIX ACL サポートはマウントの際に「noacl」を指定することでマウントtaNIに無効化することが可能である。
		</para>
		</listitem>
	</varlistentry>

        <varlistentry>
                <term>nocase</term>
                <listitem>
		<para>
		大文字小文字を区別しないパス名のマッチング処理を行なう (デフォルトでは、サーバがサポートしていれば、大文字小文字を区別した処理が行なわれる)。
		</para>
                </listitem>
        </varlistentry>

        <varlistentry>
                <term>sec=</term>
                <listitem>
                <para>セキュリティモード。以下の値を設定できる:</para>
			<itemizedlist>
                        <listitem><para>none    空のユーザ名で接続を行なう。</para></listitem>
                        <listitem><para>krb5    Kerberos 5 認証を用いる。</para></listitem>
                        <listitem><para>krb5i   Kerberos 認証とパケット署名(訳注: SMB署名?)を用いる。</para></listitem>
                        <listitem><para>ntlm    NTLM パスワードハッシュを用いる (デフォルト) 。</para></listitem>
                        <listitem><para>ntlmi   NTLM パスワードハッシュと署名を用いる (if
                                /proc/fs/cifs/PacketSigningEnabled on or if
                                server requires signing also can be the default)</para></listitem>
                        <listitem><para>ntlmv2  NTLMv2 パスワードハッシュを用いる。</para></listitem>
                        <listitem><para>ntlmv2i NTLMv2 パスワードハッシュといパケット署名を用いる。</para></listitem>
			</itemizedlist>

			<para>NB: この sec パラメータは開発中であり、cifs カーネルモジュール 1.40 以降で利用可能となる予定である。
                </para>
                </listitem>
        </varlistentry>

        <varlistentry>
                <term>nobrl</term>
                <listitem>
                <para>
		サーバにバイト範囲ロックの要求を送信しない。
		これは、CIFS 形式の強制的なバイト範囲ロックを無視する幾つかのアプリケーションにとって必要である (大半の CIFS サーバはアドバイザリなバイト範囲ロックをサポートしていない)。
                </para>
                </listitem>
        </varlistentry>

        <varlistentry>
                <term>sfu</term>
                <listitem>
                <para>
		CIFS Unix Extension が無効となっている場合に、デバイスファイルと fifo ファイルを Services for Unix (SFU) と互換性のある形式で作成する。
		In addition retrieve bits 10-12
                of the mode via the SETFILEBITS extended attribute (as
                SFU does).  In the future the bottom 9 bits of the mode
                mode also will be emulated using queries of the security
                descriptor (ACL). [NB: requires version 1.39 or later
		of the CIFS VFS.  To recognize symlinks and be able
		to create symlinks in an SFU interoperable form
		requires version 1.40 or later of the CIFS VFS kernel module.
                </para>
                </listitem>
        </varlistentry>

        <varlistentry>
                <term>serverino</term>
                <listitem><para>inode 番号 (一意で永続的なファイル識別子) として、クライアント側で一時的に自動生成された inode 番号ではなく、サーバ側から返却された番号を用いる。
		サーバ側の inode 番号を用いることで、ハードリンクされたファイル (同じ inode 番号を持っている) の処理が簡素化される他、inode 番号を永続的にすることが可能となる (ソフトウェアによっては有用である)。
                the server does not guarantee that the inode numbers
                are unique if multiple server side mounts are exported under a
                single share (since inode numbers on the servers might not
                be unique if multiple filesystems are mounted under the same
                shared higher level directory).  
		CIFS Unix Extension をサポートしている全てのサーバがサーバ側の inode 番号を返却するとは限らない。
		Windows 2000 以降のサーバは、これをサポートしている (ただしローカルサーバのファイルシステムではこれを必要としていない)。
		サーバ側で inode 番号の返却がサポートされていない場合、このパラメータは意味を持たない。
		</para></listitem>
        </varlistentry>

        <varlistentry>
                <term>noserverino</term>
                <listitem><para>inode 番号をクライアント側で生成する (サーバ側の inode 番号を用いない)。これがデフォルト値である。
		</para></listitem>
        </varlistentry>

        <varlistentry>
                <term>nouser_xattr</term>
                <listitem><para>(デフォルト値) サーバ側でサポートされていた場合でも、getfattr/setfattr を用いた拡張属性の参照、設定を許可しない。</para></listitem>
        </varlistentry>

	<varlistentry>
		<term>rsize=<replaceable>arg</replaceable></term>
		<listitem><para>ネットワークからの読み取りサイズのデフォルト値</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>wsize=<replaceable>arg</replaceable></term>

		<listitem><para>ネットワークへの書き込みサイズのデフォルト値</para></listitem>
	</varlistentry>
	 <varlistentry>
                <term>--verbose</term>
                <listitem><para>マウントの際に、デバッグ用の付加情報を出力する。
		このパラメータは -o の前に指定する必要があることに注意。以下に例を示す:
                </para>
                <para>mount -t cifs //server/share /mnt --verbose -o user=username</para></listitem>
        </varlistentry>

	</variablelist>
</refsect1>

<refsect1>
	<title>環境変数</title>

	<para><emphasis>USER</emphasis> 環境変数にはクライアントで使用される
	ユーザ名が含まれる。
	この変数にはユーザ名とパスワードの両方を username%password
	のフォーマットで設定することができる。</para>
	</para>
	
	<para><emphasis>PASSWD</emphasis> 環境変数にはクライアントで使用される
	パスワードが含まれる。
	</para>

	<para><emphasis>PASSWD_FILE</emphasis> 環境変数にはパスワードが読み込まれる
	ファイルのパス名が含まれる。
	1行目が読み取られ、パスワードとして使用される。</para>

</refsect1>

<refsect1>
	<title>注意</title>
	
	<para>setuid が設定されていない限り、このコマンドは root のみ使用できる。setuid が設定されている場合、noexec および nosuid のマウントフラグが有効化される。</para>
</refsect1>

<refsect1>
	<title>設定</title>
		<para>CIFS VFS の設定の変更やデバッグ情報を取得する機能は
		Linux の /proc ファイルシステムを利用して行われている。
		<filename>/proc/fs/cifs</filename> ディレクトリには、さまざまな設定ファイルや
		デバッグ情報を表示する仮想ファイルがある。
		カーネルの CIFS vfs (cifs.ko モジュール) がロードされている時のみ設定される、
		最大バッファサイズとバッファ数というオプションが存在する。
		これらは、cifs.ko ファイルに対して、modinfo ユーティリティを実行することで確認できる。
		このユーティリティにより、モジュールのインストール時(デバイスドライバのロード時)に CIFS モジュールに渡されるオプションが表示される。
		より詳細な情報はカーネルに含まれる <filename>fs/cifs/README</filename> ファイルを
		参照のこと。</para>
</para>
</refsect1>

<refsect1>
	<title>バグ</title>

	<para>マウントの際に CIFS URL で指定する形式は、現在サポートされていない。
	</para>

	<para>資格情報ファイルではスペースで始まるユーザ名やパスワードを
	扱うことができない。</para>

	<para>バグ報告に対してまず行われる返答は、とりあえず最新のバージョンで
	試してみるような提案である。まず最初にそのこと (最新バージョンへの更新)
	を試したうえで、バグを報告するときは関連するソフトウェアのバージョン情報
	(最低限でも mount.cifs (mount.cifs -V の結果)、カーネル (/proc/version の内容)) と接続しようとしているサーバの形式を含めること。
</para>
</refsect1>

<refsect1>
	<title>バージョン</title>

	<para>このマニュアルページは CIFS vfs ファイルシステム 1.39 (おおよそ Linux カーネル 2.6.15) 用である。</para>
</refsect1>

<refsect1>
	<title>関連項目</title>
	<para>
	Linux カーネルソースツリーの Documentation/filesystems/cifs.txt と
	fs/cifs/README には追加のオプションや情報がある。</para>
        <para><citerefentry><refentrytitle>umount.cifs</refentrytitle>
        <manvolnum>8</manvolnum></citerefentry></para>

</refsect1>

<refsect1>
	<title>作者</title>
	
	<para>Steve French</para>

	<para>構文やマニュアルページは smbmount のものをベースにしている。
	これは Jelmer Vernooij によって Docbook/XML 形式に変換された。</para>

	<para>現在の Linux cifs vfs とユーザスペースのツールの
	<emphasis>mount.cifs</emphasis> のメンテナーは
	<ulink url="mailto:sfrench@samba.org">Steve French</ulink> である。
	これらのプログラムについて質問するには、
	<ulink url="mailto:linux-cifs-client@lists.samba.org">Linux CIFS Mailing list</ulink> 
	が望ましい。 
	</para>

</refsect1>
<refsect1>
	<title>日本語訳</title>

	<para>このマニュアルページは Samba 3.0.23 - Samba 3.0.24  対応のものである。</para>

	<para>このドキュメントの Samba 3.0.0 対応の翻訳は、山田 史朗
	(shiro@miraclelinux.com)によって行なわれた。</para>

	<para>Samba 3.0.23 - Samba 3.0.24 対応の翻訳は、たかはしもとのぶ (monyo@samba.gr.jp) によって行なわれた。</para>
</refsect1>

</refentry>
